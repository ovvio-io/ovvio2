{
  "version": 3,
  "sources": ["../styles/utils/ssr.ts", "../styles/css-objects/context.tsx", "../styles/theme.tsx", "../styles/css-objects/index.ts", "../base/common.ts", "../styles/styleguide.ts", "../styles/layout.ts", "../styles/components/spinner-view.tsx", "../styles/utils/hooks/use-window-size.ts", "../styles/responsive.ts", "../styles/components/typography.tsx", "../styles/components/buttons.tsx", "../styles/utils/hooks/use-mounted-indicator.ts", "../styles/components/transition.tsx", "../styles/components/toast/index.tsx", "../styles/index.ts", "../logging/entry.ts", "../logging/stream.ts", "../logging/log.ts", "../base/error.ts", "../base/math.ts", "../base/array.ts", "../base/comparisons.ts", "../base/core-types/base.ts", "../base/collections/hash-map.ts", "../base/collections/dict.ts", "../base/core-types/utils.ts", "../base/core-types/clone.ts", "../base/hash.ts", "../base/date.ts", "../base/core-types/encoding/base-encoder.ts", "../external/md5.ts", "../base/core-types/encoding/checksum.ts", "../base/core-types/encoding/hash.ts", "../base/core-types/comparable.ts", "../base/set.ts", "../base/core-types/equals.ts", "../base/core-types/index.ts", "../base/core-types/encoding/utils.ts", "../base/core-types/encoding/index.ts", "../base/core-types/encoding/cyclical.ts", "../base/core-types/encoding/json.ts", "../cfds/change/index.ts", "../cfds/change/field-change.ts", "../cfds/base/types/core-type.ts", "../cfds/base/types/map-type.ts", "../cfds/base/types/primitive-type.ts", "../cfds/base/types/set-type.ts", "../cfds/base/types/string-type.ts", "../external/diff-match-patch.ts", "../cfds/base/defs.ts", "../cfds/richtext/string-rep.ts", "../cfds/richtext/merge-context.ts", "../cfds/richtext/flat-rep.ts", "../cfds/richtext/tree.ts", "../cfds/richtext/model.ts", "../cfds/change/richtext-change.ts", "../cfds/richtext/diff-patch.ts", "../cfds/richtext/normalize/setup.ts", "../cfds/richtext/normalize/rules.ts", "../cfds/richtext/normalize/index.ts", "../cfds/base/types/richtext3-type.ts", "../cfds/base/types/date-type.ts", "../cfds/base/types/index.ts", "../cfds/change/decode.ts", "../cfds/base/object.ts", "../cfds/base/scheme-types.ts", "../cfds/base/scheme-versions.ts", "../cfds/base/scheme.ts", "../cfds/base/record.ts", "../cfds/client/graph/mutations.ts", "../cfds/base/types/utils.ts", "../cfds/client/undo/single.ts", "../cfds/client/undo/context.ts", "../cfds/client/undo/manager.ts", "../cfds/richtext/composer.ts", "../cfds/client/graph/propagation-triggers.ts", "../cfds/client/graph/vertex.ts", "../base/string.ts", "../cfds/base/orderstamp.ts", "../cfds/client/graph/vertices/workspace.ts", "../cfds/client/graph/vertices/base.ts", "../cfds/richtext/tree-keys.ts", "../cfds/richtext/doc-state.ts", "../cfds/richtext/markdown.ts", "../cfds/client/graph/vertices/note.ts", "../cfds/client/graph/vertices/tag.ts", "../cfds/client/graph/vertices/user.ts", "../cfds/client/graph/vertices/user-settings.ts", "../cfds/client/graph/vertices/vertex-builder.ts", "../base/time.ts", "../base/algorithms.ts", "../base/collections/queue.ts", "../base/coroutine.ts", "../base/timer.ts", "../cfds/client/graph/vertex-manager.ts", "../cfds/client/graph/vertex-source.ts", "../cfds/client/graph/query.ts", "../cfds/client/graph/shared-queries.ts", "../cfds/client/graph/adj-list.ts", "../cfds/base/errors.ts", "../cfds/base/edit.ts", "../defs.ts", "../repo/commit.ts", "../base/collections/orderedmap.ts", "../base/collections/lru-cache.ts", "../repo/repo.ts", "../repo/idbbackup.ts", "../base/bloom.ts", "../net/message.ts", "../net/base-client.ts", "../net/repo-client.ts", "../cfds/client/graph/note-search.ts", "../cfds/client/graph/graph-manager.ts", "../net/log-client.ts", "../web-app/src/core/cfds/react/logger.tsx", "../web-app/src/core/cfds/react/vertex.ts", "../styles/components/logo.tsx", "../web-app/src/app/loading-view.tsx", "../styles/components/layer.tsx", "../styles/components/texts.tsx", "../web-app/src/core/cfds/react/query.ts", "../web-app/src/app/workspace-content/workspace-view/toolbar/changes-indicator/index.tsx", "../styles/components/icons/IconBase.tsx", "../styles/components/icons/IconAdd.tsx", "../styles/components/icons/IconCreateNew.tsx", "../styles/components/icons/IconFilter.tsx", "../styles/components/icons/IconMenu.tsx", "../styles/components/icons/IconNotifications.tsx", "../styles/components/icons/IconSearch.tsx", "../styles/components/icons/IconSettings.tsx", "../styles/components/icons/IconTag.tsx", "../styles/components/icons/IconAlignCenter.tsx", "../styles/components/icons/IconAlignLeft.tsx", "../styles/components/icons/IconAlignRight.tsx", "../styles/components/icons/IconBold.tsx", "../styles/components/icons/IconBulletList.tsx", "../styles/components/icons/IconItalic.tsx", "../styles/components/icons/IconLink.tsx", "../styles/components/icons/IconNumberList.tsx", "../styles/components/icons/IconStrikethrough.tsx", "../styles/components/icons/IconTask.tsx", "../styles/components/icons/IconUnderline.tsx", "../styles/components/icons/IconDropDown.tsx", "../styles/components/icons/IconGoogle.tsx", "../styles/components/icons/IconNote.tsx", "../styles/components/icons/IconDropDownArrow.tsx", "../styles/components/icons/IconTasksTick.tsx", "../styles/components/icons/IconOverflow.tsx", "../styles/components/icons/IconClose.tsx", "../styles/components/icons/IconDelete.tsx", "../styles/components/icons/IconEdit.tsx", "../styles/components/icons/IconViewNote.tsx", "../styles/components/icons/IconKeyboard.tsx", "../styles/components/icons/IconBack.tsx", "../styles/components/icons/IconContactUs.tsx", "../styles/components/icons/IconCalendar.tsx", "../styles/components/icons/IconSorting.tsx", "../styles/components/icons/IconImage.tsx", "../styles/components/icons/IconAssignee.tsx", "../styles/components/icons/IconDueDate.tsx", "../styles/components/icons/IconAttachment.tsx", "../styles/components/icons/IconCamera.tsx", "../styles/components/icons/IconExportMail.tsx", "../styles/components/icons/IconExportPdf.tsx", "../styles/components/icons/IconDuplicate.tsx", "../styles/components/icons/IconExpander.tsx", "../styles/components/icons/index.ts", "../styles/utils/scrolling/index.tsx", "../styles/components/popper.tsx", "../styles/components/menu.tsx", "../web-app/src/utils.ts", "../web-app/src/app/workspace-content/workspace-view/toolbar/header.tsx", "../web-app/src/app/workspace-content/workspace-view/toolbar/index.tsx", "../styles/components/new-icons/types.ts", "../styles/components/new-icons/icon-check.tsx", "../styles/components/inputs/CheckBox.tsx", "../styles/components/inputs/TextField.tsx", "../styles/utils/dateutils.ts", "../styles/components/inputs/date-picker.tsx", "../styles/components/inputs/partial-checkbox/states.tsx", "../styles/components/inputs/partial-checkbox/checkbox-icon.tsx", "../styles/components/inputs/partial-checkbox/index.tsx", "../styles/components/inputs/index.ts", "../web-app/src/app/new-workspace/create-workspace-illustration.tsx", "../web-app/src/core/localization/index.tsx", "../web-app/src/shared/workspace-icon/index.tsx", "../styles/components/inputs/drop-down.tsx", "../web-app/src/app/new-workspace/new-workspace.strings.json", "../web-app/src/app/new-workspace/workspaces-dropdown.tsx", "../web-app/src/app/new-workspace/duplicate-workspace.tsx", "../web-app/src/app/new-workspace/workspace-form.tsx", "../web-app/src/app/new-workspace/index.tsx", "../styles/components/dialog/index.tsx", "../web-app/src/shared/components/due-date-editor/index.tsx", "../web-app/src/shared/components/floating-back-button.tsx", "../web-app/src/core/react-utils/scrolling.tsx", "../web-app/src/core/slate/utils/hotkeys.ts", "../web-app/src/core/slate/mentions/mention-node.tsx", "../web-app/src/core/slate/utils/element-utils.ts", "../web-app/src/core/slate/utils/selection-utils.ts", "../cfds/client/suggestions.ts", "../web-app/src/core/slate/mentions/index.tsx", "../web-app/src/core/slate/mentions/tags.tsx", "../web-app/src/core/slate/plugins/index.ts", "../web-app/src/core/slate/utils/auto-replace.ts", "../styles/colors.ts", "../web-app/src/core/react-utils/animate.ts", "../styles/components/tooltip/index.tsx", "../web-app/src/shared/avatar/index.tsx", "../web-app/src/core/react-utils/index.ts", "../web-app/src/shared/card/mention.tsx", "../web-app/src/shared/utils/assignees.ts", "../web-app/src/shared/selection-button/index.tsx", "../styles/components/new-icons/icon-plus.tsx", "../web-app/src/shared/card/assignees-view.tsx", "../web-app/src/shared/card/placeholder.ts", "../web-app/src/shared/pill/index.tsx", "../web-app/src/shared/tags/tag-button.tsx", "../web-app/src/shared/tags/tag-view.tsx", "../web-app/src/core/slate/elements/card.element/assignees-icon.tsx", "../web-app/src/core/slate/elements/card.element/tag-icon.tsx", "../cfds/client/sorting.ts", "../cfds/client/duplicate.ts", "../styles/components/new-icons/icon-delete.tsx", "../styles/components/new-icons/icon-duplicate.tsx", "../styles/components/new-icons/icon-task.tsx", "../styles/components/new-icons/icon-note.tsx", "../styles/components/new-icons/icon-view-note.tsx", "../styles/components/new-icons/icon-open.tsx", "../styles/components/new-icons/icon-due-date.tsx", "../web-app/src/shared/item-menu/actions/index.tsx", "../web-app/src/shared/item-menu/index.tsx", "../web-app/src/core/slate/elements/card.element/card-node/card-actions.tsx", "../web-app/src/core/slate/elements/card.element/card-node/index.tsx", "../web-app/src/core/react-utils/base-utils.ts", "../web-app/src/core/slate/mentions/assignees.tsx", "../web-app/src/core/slate/elements/card.element/index.tsx", "../web-app/src/core/slate/cfds/with-cfds.tsx", "../web-app/src/core/cfds/react/graph-use.ts", "../web-app/src/core/slate/cfds/use-cfds-editor.ts", "../web-app/src/core/slate/utils/list-utils.ts", "../web-app/src/core/slate/elements/list-item.element.tsx", "../web-app/src/core/slate/elements/bullet-list.element.tsx", "../web-app/src/shared/card/create.ts", "../web-app/src/core/slate/elements/card.element/with-cards.ts", "../web-app/src/core/slate/elements/header.element.tsx", "../web-app/src/core/slate/elements/header2.element.tsx", "../web-app/src/core/slate/elements/numbered-list.element.tsx", "../web-app/src/core/slate/plugins/leaves.tsx", "../web-app/src/core/slate/plugins/base.tsx", "../web-app/src/core/slate/plugins/link-decoration/link-leaf.tsx", "../web-app/src/core/slate/plugins/link-decoration/index.tsx", "../web-app/src/core/slate/index.tsx", "../web-app/src/app/workspace-content/workspace-view/note-editor/focus-reporter.tsx", "../web-app/src/app/workspace-content/workspace-view/note-editor/body-editor/floating-menu.tsx", "../web-app/src/app/workspace-content/workspace-view/note-editor/body-editor/body-editor.strings.json", "../web-app/src/app/workspace-content/workspace-view/note-editor/body-editor/task-cta-view.tsx", "../web-app/src/app/workspace-content/workspace-view/note-editor/body-editor/index.tsx", "../web-app/src/app/workspace-content/workspace-view/note-editor/legend-view.tsx", "../styles/components/new-icons/icon-content.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/card-item/card-tag-view.tsx", "../web-app/src/shared/utils/move.ts", "../web-app/src/app/workspace-content/workspace-view/cards-display/card-item/workspace-indicator.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/card-item/index.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/card-item/card-footer.tsx", "../web-app/src/app/workspace-content/workspace-view/note-editor/title-editor/index.tsx", "../web-app/src/app/workspace-content/workspace-view/note-editor/content.tsx", "../web-app/src/app/workspace-content/workspace-view/note-editor/index.tsx", "../web-app/src/shared/dragndrop/context.tsx", "../web-app/src/shared/dragndrop/cancellation-reasons.tsx", "../web-app/src/shared/dragndrop/droppable.tsx", "../web-app/src/shared/dragndrop/util.ts", "../web-app/src/shared/dragndrop/draggable.tsx", "../web-app/src/shared/dragndrop/index.ts", "../web-app/src/app/workspace-content/workspace-view/cards-display/card-item/draggable-card.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/board-view/board-card.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/board-view/board-column.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/board-view/board.strings.json", "../web-app/src/app/workspace-content/workspace-view/cards-display/board-view/assignees-board-view.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/board-view/tag-board-view.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/board-view/workspace-board-view.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/board-view/index.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/cards-display.strings.json", "../styles/components/new-icons/icon-sort.tsx", "../styles/components/new-icons/icon-filter.tsx", "../styles/components/tabs/index.tsx", "../styles/components/new-icons/icon-compose.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/display-bar/compose-button.tsx", "../styles/components/new-icons/icon-group.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/display-bar/group-by-drop-down.tsx", "../styles/components/new-icons/icon-list-view.tsx", "../styles/components/new-icons/icon-board-view.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/display-bar/view-toggle.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/display-bar/index.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/display-bar/filters/filter-checkbox.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/display-bar/filters/filters.strings.json", "../web-app/src/app/workspace-content/workspace-view/cards-display/display-bar/filters/index.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/display-bar/filters/active-filters.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/display-bar/search-field.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/list-view/empty-illustration.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/list-view/empty-state.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/list-view/infinite-scroll.tsx", "../cfds/client/graph/vertices/filter.ts", "../cfds/client/graph/vertices/index.ts", "../styles/components/new-icons/icon-new-task.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/list-view/list.strings.json", "../web-app/src/app/workspace-content/workspace-view/cards-display/list-view/table/grid.tsx", "../styles/components/new-icons/icon-arrow-down.tsx", "../styles/components/new-icons/icon-pin-off.tsx", "../styles/components/new-icons/icon-pin-on.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/list-view/table/item.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/list-view/table/index.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/list-view/inline-task-button.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/list-view/index.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/search-results/index.tsx", "../web-app/src/app/workspace-content/workspace-view/cards-display/index.tsx", "../web-app/src/app/workspace-content/workspace-view/empty-state/empty-state.strings.json", "../web-app/src/app/workspace-content/workspace-view/empty-state/index.tsx", "../web-app/src/app/workspace-content/workspace-view/index.tsx", "../web-app/src/app/workspace-content/index.tsx", "../styles/components/backdrop.tsx", "../web-app/src/app/workspaces-bar/workspace-bar.strings.json", "../web-app/src/app/workspaces-bar/actions.tsx", "../web-app/src/app/workspaces-bar/ws-selection-utils.ts", "../web-app/src/app/workspaces-bar/index.tsx", "../web-app/src/app/index.tsx", "../web-app/src/core/cfds/react/graph.tsx", "../web-app/src/app/login/illustrations.tsx", "../web-app/src/app/login/AuthForm.tsx", "../web-app/src/app/login/index.tsx", "../web-app/src/core/feature-toggle/features.tsx", "../web-app/src/core/feature-toggle/index.tsx", "../web-app/src/app/mobile-blocker.tsx", "../web-app/src/app/login-async.tsx", "../web-app/src/index.tsx", "../web-app/src/app/app-async.tsx"],
  "sourcesContent": ["import {\n  DependencyList,\n  EffectCallback,\n  useLayoutEffect,\n} from 'https://esm.sh/react@18.2.0';\nimport ReactDOM from 'https://esm.sh/react-dom@18.2.0';\n\nexport const isServerSide =\n  typeof window === 'undefined' || typeof document === 'undefined';\n\nlet _isNextJs = false;\n\nexport const isNextJs = () => _isNextJs;\n\nexport const setNextJs = () => (_isNextJs = true);\n\nfunction useSSRInstantEffect(effect: EffectCallback, deps?: DependencyList) {\n  effect();\n}\n\nexport const useIsomorphicLayoutEffect = isServerSide\n  ? useSSRInstantEffect\n  : useLayoutEffect;\n\nexport const createUniversalPortal = (\n  children: React.ReactNode,\n  container?: Element,\n  key?: string\n) => {\n  if (isServerSide) {\n    return null;\n  }\n\n  if (!container) {\n    const rootKey = isNextJs() ? '__next' : 'root';\n    container = document.getElementById(rootKey);\n  }\n\n  return ReactDOM.createPortal(children, container, key);\n};\n", "import React, {\n  useContext,\n  useEffect,\n  useRef,\n} from 'https://esm.sh/react@18.2.0';\nimport { isServerSide } from '../utils/ssr.ts';\n\nexport interface CssClass {\n  styleRules: string[];\n  classes?: Record<string, CssClass>;\n  isAttached?: boolean;\n  basedOn?: CssClass[];\n}\n\ntype CssRegistryListener = (rule: string) => void;\n\nclass CssRegistry {\n  private rules: string[] = [];\n  private listeners: CssRegistryListener[] = [];\n  private cssQueue: string[] = [];\n\n  private append(css: string) {\n    this.rules.push(css);\n    this.listeners.forEach((fn) => fn(css));\n  }\n\n  getRules() {\n    return this.rules;\n  }\n\n  listen(listener: CssRegistryListener) {\n    this.listeners.push(listener);\n    return () => {\n      this.listeners.splice(this.listeners.indexOf(listener), 1);\n    };\n  }\n\n  appendCss(css: string) {\n    this.append(css);\n    // this.notify();\n  }\n\n  ensureAttached = (c: CssClass) => {\n    if (c.isAttached) {\n      return false;\n    }\n    (c.basedOn || []).forEach(this.ensureAttached);\n    const styles = getCss(c);\n    for (let i = 0; i < styles.length; i++) {\n      this.append(styles[i]);\n    }\n    c.isAttached = true;\n    return true;\n  };\n}\n\nexport const __CssRegistry = new CssRegistry();\n\nconst StyleContext = React.createContext(__CssRegistry);\n\nexport interface StyleProviderProps {\n  dev?: boolean;\n  children: React.ReactNode;\n}\n\nfunction StyleTag({ dev }: StyleProviderProps) {\n  const ctx = useContext(StyleContext);\n  const reffedDev = useRef(dev);\n  useEffect(() => {\n    reffedDev.current = dev;\n  }, [dev]);\n\n  useEffect(() => {\n    if (!isServerSide) {\n      const ssrStyle = document.getElementById('ssr-cso-styles');\n      if (ssrStyle) {\n        ssrStyle.remove();\n      }\n    }\n  }, []);\n  useEffect(() => {\n    if (isServerSide) {\n      return;\n    }\n    const style = document.createElement('style');\n\n    style.id = 'cso-objects';\n    style.type = 'text/css';\n    document.head.appendChild(style);\n\n    const initialRules = ctx.getRules();\n    style.appendChild(document.createTextNode(''));\n\n    const tryAppendRule = (rule: string, index?: number) => {\n      const sheet = style.sheet;\n      index = typeof index === 'undefined' ? sheet!.cssRules.length : index;\n      try {\n        sheet!.insertRule(rule, index);\n      } catch (error) {\n        if (error instanceof SyntaxError && !reffedDev.current) {\n          console.warn(`Received non-parsable rule: '${rule}'`);\n        } else {\n          throw error;\n        }\n      }\n    };\n\n    for (let i = 0; i < initialRules.length; i++) {\n      tryAppendRule(initialRules[i], i);\n    }\n\n    return ctx.listen((rule) => {\n      tryAppendRule(rule);\n    });\n  }, [ctx]);\n\n  return <React.Fragment />;\n}\nfunction getCss(c: CssClass) {\n  const res = [];\n  if (c.styleRules) {\n    res.push(...c.styleRules);\n  }\n  Object.values(c.classes || {}).forEach((x) => res.push(...getCss(x)));\n  return res;\n}\n\nexport function useEnsureAttached() {\n  return useContext(StyleContext).ensureAttached;\n}\n\nexport const StyleProvider: React.FC<StyleProviderProps> = ({\n  children,\n  dev = false,\n}) => {\n  // const [css, setCss] = useState('');\n  // const ensureAttached = useMemo(() => createEnsureAttached(setCss), []);\n  // const ctx = useMemo(\n  //   () => ({\n  //     ensureAttached,\n  //     css,\n  //   }),\n  //   [css, ensureAttached]\n  // );\n\n  return (\n    <React.Fragment>\n      <StyleTag dev={dev} children={undefined} />\n      {children}\n    </React.Fragment>\n  );\n};\n", "import React, {\n  useContext,\n  useEffect,\n  useMemo,\n} from 'https://esm.sh/react@18.2.0';\n\nexport interface NewTheme {\n  primary: {\n    p1: string;\n    p2: string;\n    p3: string;\n    p4: string;\n    p5: string;\n    p6: string;\n    p7: string;\n    p8: string;\n    p9: string;\n    p10: string;\n  };\n  secondary: {\n    s0: string;\n    s1: string;\n    s2: string;\n    s3: string;\n    s4: string;\n    s5: string;\n    s6: string;\n    s7: string;\n  };\n  mono: {\n    m0: string;\n    m1: string;\n    m2: string;\n    m3: string;\n    m4: string;\n    m5: string;\n    m6: string;\n    m10: string;\n  };\n  shadows: {\n    z1: string;\n    z2: string;\n    z3: string;\n    z4: string;\n  };\n  supporting: {\n    B1: string;\n    B2: string;\n    B3: string;\n    B4: string;\n    G1: string;\n    G2: string;\n    G3: string;\n    G4: string;\n    O1: string;\n    O2: string;\n    O3: string;\n    O4: string;\n    R1: string;\n    R2: string;\n    R3: string;\n    R4: string;\n    C1: string;\n    C2: string;\n    C4: string;\n    L1: string;\n    L2: string;\n    L4: string;\n    V1: string;\n    V2: string;\n    V4: string;\n    T1: string;\n    T2: string;\n    T4: string;\n  };\n  colors: {\n    text: string;\n    grayedText: string;\n    background: string;\n    main: string;\n    primaryButton: string;\n    primaryButtonText: string;\n    secondaryButton: string;\n    secondaryButtonActive: string;\n    barActionText: string;\n    placeholderText: string;\n    toggleButtonActiveIcon: string;\n    toggleButtonInactiveIcon: string;\n  };\n}\n\nconst lightColorWheel = {\n  primary: {\n    p1: '#f5f9fb',\n    p2: '#e0eef4',\n    p3: '#cce3ed',\n    p4: '#abd4ee',\n    p5: '#8bc5ee',\n    p6: '#6ab6ef',\n    p7: '#57a5e9',\n    p8: '#5793E0',\n    p9: '#3184DD',\n    p10: '#1960cf',\n  },\n  secondary: {\n    s0: '#FFFBF5',\n    s1: '#FBF6EF',\n    s2: '#f5ecdc',\n    s3: '#FBEAC8',\n    s4: '#FAE2B4',\n    s5: '#EFD2AB',\n    s6: '#F5C36A',\n    s7: '#f9b55a',\n  },\n  mono: {\n    m0: '#ffffff',\n    m1: '#e5e5e5',\n    m2: '#cccccc',\n    m3: '#B3B3B3',\n    m4: '#8c8c8c',\n    m5: '#4D4D4D',\n    m6: '#3f3f3f',\n    m10: '#262626',\n  },\n  supporting: {\n    B1: '#EDE1CB',\n    B2: '#CEBFA3',\n    B3: '#B4A68C',\n    B4: '#978461',\n    G1: '#C5D9BF',\n    G2: '#92AD8A',\n    G3: '#75A27E',\n    G4: '#4A6144',\n    O1: '#FDB797',\n    O2: '#E68B60',\n    O3: '#C25A3E',\n    O4: '#AA4428',\n    R1: '#E5AFA2',\n    R2: '#B78775',\n    R3: '#945A52',\n    R4: '#6C2C23',\n    C1: '#FBD5B6',\n    C2: '#F2B482',\n    C4: '#BE6F2F',\n    L1: '#E8ECF1',\n    L2: '#CDD3DC',\n    L4: '#8896AC',\n    V1: '#E7E0ED',\n    V2: '#C8B9D6',\n    V4: '#836C98',\n    T1: '#C5EAEC',\n    T2: '#8BC7CB',\n    T4: '#2B9CA3',\n  },\n};\n\nexport const brandLightTheme: NewTheme = {\n  ...lightColorWheel,\n  shadows: {\n    z1: '0 3px 6px 0 rgba(14, 30, 62, 0.08)',\n    z2: '0px 0px 4px rgba(151, 132, 97, 0.25)',\n    z3: '0 1px 2px 0 rgb(60 64 67 / 30%), 0 1px 3px 1px rgb(60 64 67 / 15%)',\n    z4: '0 1px 3px 0 rgb(60 64 67 / 30%), 0 4px 8px 3px rgb(60 64 67 / 15%)',\n  },\n  colors: {\n    text: lightColorWheel.mono.m10,\n    grayedText: lightColorWheel.mono.m3,\n    background: lightColorWheel.mono.m0,\n    main: lightColorWheel.primary.p6,\n    primaryButton: lightColorWheel.primary.p9,\n    primaryButtonText: lightColorWheel.mono.m0,\n    secondaryButton: lightColorWheel.secondary.s2,\n    secondaryButtonActive: lightColorWheel.secondary.s7,\n    barActionText: lightColorWheel.supporting.R4,\n    placeholderText: lightColorWheel.mono.m4,\n    toggleButtonActiveIcon: lightColorWheel.secondary.s1,\n    toggleButtonInactiveIcon: lightColorWheel.secondary.s5,\n  },\n};\n\ninterface BackgroundPallete {\n  0: string;\n  100: string;\n  200: string;\n  300: string;\n  400: string;\n  500: string;\n  600: string;\n  700: string;\n  800: string;\n  900: string;\n  text: string;\n  textSecondary: string;\n  placeholderText: string;\n}\n\ninterface ColorPallete {\n  200: string;\n  400: string;\n  500: string;\n}\n\nexport interface Theme {\n  background: BackgroundPallete;\n  primary: ColorPallete;\n  shadows: {\n    z1: string;\n    z2: string;\n    z3: string;\n    z4: string;\n  };\n}\n\nfunction componentToHex(component: number) {\n  const hex = component.toString(16);\n  return hex.length === 0 ? `0${hex}` : hex;\n}\n\nexport function rgbToHex([r, g, b]: [number, number, number]): string {\n  return `#${componentToHex(r)}${componentToHex(g)}${componentToHex(b)}`;\n}\n\nexport function hexToRgb(hex: string): [number, number, number] {\n  if (hex.startsWith('#')) {\n    hex = hex.slice(1);\n  }\n  const r = parseInt(hex.slice(0, 2), 16);\n  const g = parseInt(hex.slice(2, 4), 16);\n  const b = parseInt(hex.slice(4, 6), 16);\n  return [r, g, b];\n}\n\nexport function makeTransparent(\n  [r, g, b, a]: [number, number, number, number],\n  background: string\n) {\n  const [backR, backG, backB] = hexToRgb(background);\n  const diffAlpha = 1 - a;\n  const newColor: [number, number, number] = [\n    ~~(r * a + backR * diffAlpha),\n    ~~(g * a + backG * diffAlpha),\n    ~~(b * a + backB * diffAlpha),\n  ];\n  return rgbToHex(newColor);\n}\n\nexport function unTransparent(\n  [r, g, b]: [number, number, number],\n  background: string,\n  alpha: number\n) {\n  const [backR, backG, backB] = hexToRgb(background);\n  const diffAlpha = 1 - alpha;\n  const newColor: [number, number, number] = [\n    ~~((r - diffAlpha * backR) / alpha),\n    ~~((g - diffAlpha * backG) / alpha),\n    ~~((b - diffAlpha * backB) / alpha),\n  ];\n\n  return rgbToHex(newColor);\n}\n\nexport const lightTheme: Theme = {\n  background: {\n    '0': '#FFFFFF',\n    '100': brandLightTheme.secondary.s0,\n    '200': '#fbfcff',\n    '300': '#f0f3fa',\n    '400': brandLightTheme.secondary.s2,\n    '500': brandLightTheme.mono.m1,\n    '600': brandLightTheme.secondary.s7,\n    '700': '#4a4a4a',\n    '800': '#11082b',\n    '900': '#1e1b33',\n    text: brandLightTheme.mono.m10,\n    textSecondary: makeTransparent([...hexToRgb('#121212'), 0.6], '#FFFFFF'),\n    placeholderText: brandLightTheme.mono.m4,\n  },\n  primary: {\n    '200': brandLightTheme.primary.p1,\n    '400': brandLightTheme.primary.p6,\n    '500': brandLightTheme.primary.p9,\n  },\n  shadows: {\n    z1: '0 3px 6px 0 rgba(14, 30, 62, 0.08)',\n    z2: '0px 4px 4px rgba(0, 0, 0, 0.25), 0px 1px 2px rgba(0, 0, 0, 0.1)',\n    z3: '0 1px 2px 0 rgb(60 64 67 / 30%), 0 1px 3px 1px rgb(60 64 67 / 15%)',\n    z4: '0 1px 3px 0 rgb(60 64 67 / 30%), 0 4px 8px 3px rgb(60 64 67 / 15%)',\n  },\n};\n\nexport const darkTheme: Theme = {\n  background: {\n    '0': '#212121',\n    '100': '#424242',\n    '200': '#616161',\n    '300': '#757575',\n    '400': '#9E9E9E',\n    '500': '#BDBDBD',\n    '600': '#E0E0E0',\n    '700': '#EEEEEE',\n    '800': '#F5F5F5',\n    '900': '#FAFAFA',\n    text: '#EEEEEE',\n    textSecondary: '#121212',\n    placeholderText: '#f8faffb3',\n  },\n  primary: {\n    '200': '#fff9f6',\n    '400': '#ff8000',\n    '500': '#f96500',\n  },\n  shadows: {\n    z1: '0 3px 6px 0 rgba(14, 30, 62, 0.08)',\n    z2: '0px 4px 4px rgba(0, 0, 0, 0.25), 0px 1px 2px rgba(0, 0, 0, 0.1)',\n    z3: '0 1px 2px 0 rgb(60 64 67 / 30%), 0 1px 3px 1px rgb(60 64 67 / 15%)',\n    z4: '0 1px 3px 0 rgb(60 64 67 / 30%), 0 4px 8px 3px rgb(60 64 67 / 15%)',\n  },\n};\n\nexport const cssTheme: Theme = {\n  background: {\n    '0': `var(--background-0, ${lightTheme.background[0]})`,\n    '100': `var(--background-100, ${lightTheme.background[100]})`,\n    '200': `var(--background-200, ${lightTheme.background[200]})`,\n    '300': `var(--background-300, ${lightTheme.background[300]})`,\n    '400': `var(--background-400, ${lightTheme.background[400]})`,\n    '500': `var(--background-500, ${lightTheme.background[500]})`,\n    '600': `var(--background-600, ${lightTheme.background[600]})`,\n    '700': `var(--background-700, ${lightTheme.background[700]})`,\n    '800': `var(--background-800, ${lightTheme.background[800]})`,\n    '900': `var(--background-900, ${lightTheme.background[900]})`,\n    text: `var(--background-text, ${lightTheme.background.text})`,\n    textSecondary: `var(--text-secondary, ${lightTheme.background.textSecondary})`,\n    placeholderText: `var(--background-placeholder, ${lightTheme.background.placeholderText})`,\n  },\n  primary: {\n    '200': `var(--primary-200, ${lightTheme.primary[200]})`,\n    '400': `var(--primary-400, ${lightTheme.primary[400]})`,\n    '500': `var(--primary-500, ${lightTheme.primary[500]})`,\n  },\n  shadows: {\n    z1: `var(--shadow-z1, ${lightTheme.shadows.z1})`,\n    z2: `var(--shadow-z2, ${lightTheme.shadows.z2})`,\n    z3: `var(--shadow-z3, ${lightTheme.shadows.z3})`,\n    z4: `var(--shadow-z4, ${lightTheme.shadows.z4})`,\n  },\n};\n\nconst themeContext = React.createContext<Theme>(lightTheme);\n\nexport function useTheme() {\n  return useContext(themeContext);\n}\n\ninterface ThemeProviderProps {\n  theme: Theme;\n  children: ({ style }) => React.ReactNode;\n  isRoot?: boolean;\n}\nexport function ThemeProvider({\n  theme,\n  children,\n  isRoot = false,\n}: ThemeProviderProps) {\n  const style = useMemo(() => {\n    return {\n      '--background-0': theme.background[0],\n      '--background-100': theme.background[100],\n      '--background-200': theme.background[200],\n      '--background-300': theme.background[300],\n      '--background-400': theme.background[400],\n      '--background-500': theme.background[500],\n      '--background-600': theme.background[600],\n      '--background-700': theme.background[700],\n      '--background-800': theme.background[800],\n      '--background-900': theme.background[900],\n      '--background-text': theme.background.text,\n      '--background-text-secondary': theme.background.textSecondary,\n      '--background-placeholder': theme.background.placeholderText,\n      '--primary-200': theme.primary[200],\n      '--primary-400': theme.primary[400],\n      '--primary-500': theme.primary[500],\n      '--shadows-z1': theme.shadows.z1,\n      '--shadows-z2': theme.shadows.z2,\n      '--shadows-z3': theme.shadows.z3,\n      '--shadows-z4': theme.shadows.z4,\n    };\n  }, [theme]);\n  useEffect(() => {\n    if (!isRoot) {\n      return;\n    }\n\n    for (const [key, value] of Object.entries(style)) {\n      document.body.style.setProperty(key, value);\n    }\n  }, [isRoot, style]);\n  return (\n    <themeContext.Provider value={theme}>\n      {children({ style })}\n    </themeContext.Provider>\n  );\n}\n", "import { useMemo, useState } from 'https://esm.sh/react@18.2.0';\nimport { useEnsureAttached, __CssRegistry } from './context.tsx';\nimport { cssTheme, Theme } from '../theme.tsx';\nimport { isServerSide, useIsomorphicLayoutEffect } from '../utils/ssr.ts';\n\nfunction genId(): string {\n  const chars =\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  let autoId = '';\n  for (let i = 0; i < 20; i++) {\n    autoId += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n\n  return autoId;\n}\n\nfunction defaultUnitForProperty(prop: string): string {\n  if (\n    ['z-index', 'opacity', 'flex-shrink', 'flex-grow', 'line-height'].indexOf(\n      prop\n    ) !== -1\n  ) {\n    return '';\n  }\n\n  return 'px';\n}\n\nfunction getSeparatorForKey(key: string) {\n  switch (key) {\n    case 'transition':\n    case 'font-family':\n      return ',';\n    default:\n      return ' ';\n  }\n}\n\nfunction stringify(key: any, val: any): string {\n  if (typeof val === 'number') {\n    return val + defaultUnitForProperty(key);\n  }\n  if (Array.isArray(val)) {\n    return val.map((x) => stringify(key, x)).join(getSeparatorForKey(key));\n  }\n\n  return '' + val;\n}\n\nfunction formatKey(key: string): any {\n  if (key.startsWith('-')) {\n    return [key];\n  }\n  const kebab = key\n    .split('')\n    .map((x) => (x.toUpperCase() === x ? `-${x.toLowerCase()}` : x))\n    .join('');\n\n  return [kebab];\n}\n\nexport type CssClasses<T> = {\n  [K in keyof T]?: T[K] extends Record<string, any>\n    ? CssDefinitions<T[K]>\n    : any;\n};\n\nexport interface CssDefinitions<T> {\n  classes: CssClasses<T>;\n  styleRules: string[];\n  rules: Record<string, any>;\n  basedOn: any[];\n  className: string;\n}\n\ninterface CssClass {\n  basedOn?: any[];\n}\n\nfunction toCss<T extends Record<string, any> & CssClass>(\n  obj: T,\n  key: string,\n  currentSelector: string,\n  isClass: boolean,\n  keepSelector: boolean,\n  ns: string\n): CssDefinitions<T> {\n  const selector = key.startsWith(':') || keepSelector ? key : `${key}_${ns}`;\n  const isMediaQuery = key.startsWith('@media');\n  if (!key.endsWith('&') && !isMediaQuery) {\n    currentSelector = `${currentSelector}${\n      isClass && !keepSelector ? '.' : ''\n    }${selector}`;\n  } else {\n    currentSelector = `${isClass ? '.' : ''}${\n      isMediaQuery ? key.replace('&', '') : selector\n    }${isMediaQuery ? ' {\\n' : ''}${currentSelector}`;\n  }\n  let currentRuleBuilder = [`${currentSelector} {`];\n  const result: Partial<CssDefinitions<T>> = {\n    styleRules: [],\n    rules: {},\n    classes: {},\n  };\n\n  let basedOn = obj.basedOn || [];\n\n  if (!Array.isArray(basedOn)) {\n    basedOn = [basedOn];\n  }\n  result.basedOn = basedOn;\n\n  if (isClass) {\n    result.className = selector;\n  }\n\n  Object.keys(obj).forEach((key) => {\n    if (key === 'basedOn') {\n      return;\n    }\n    const val = obj[key];\n    if (typeof val === 'object' && !Array.isArray(val)) {\n      let sel = currentSelector;\n      if (!key.startsWith(':') && !key.startsWith('&')) {\n        sel += ' ';\n      }\n\n      const k = key.startsWith('&') ? key.substr(1) : key;\n      result.classes[k as keyof T] = toCss(\n        val,\n        k,\n        sel,\n        !key.startsWith(':') && !key.startsWith('@'),\n        key.startsWith('& '),\n        ns\n      );\n    } else {\n      result.rules[key] = val;\n      formatKey(key).forEach((k) => {\n        currentRuleBuilder.push(`  ${k}: ${stringify(k, val)};`);\n      });\n    }\n  });\n\n  if (currentRuleBuilder.length === 1 && !isMediaQuery) {\n    currentRuleBuilder = [];\n  } else {\n    currentRuleBuilder.push('}');\n    if (isMediaQuery) {\n      currentRuleBuilder.push('}');\n    }\n  }\n  const rule = currentRuleBuilder.join('');\n  if (rule) {\n    result.styleRules = [rule];\n  }\n\n  return result as CssDefinitions<T>;\n}\n\nfunction getStyle(object) {\n  const styles = [];\n  if (object.styleRules) {\n    styles.push(object.styleRules.join('\\n\\n'));\n  }\n\n  return Object.keys(object.classes)\n    .reduce((accum, x) => {\n      accum.push(getStyle(object.classes[x]));\n      return accum;\n    }, styles)\n    .join('\\n\\n');\n}\n\ntype CssObject<T> = { [K in keyof T]: CssDefinitions<T[K]> } & {\n  getCss(): string;\n};\n\ntype CssObjectCreator<T> = (\n  theme: Theme,\n  resolveClass?: (className: string) => string\n) => T;\n\nfunction isCssFn<T>(x: any): x is CssObjectCreator<T> {\n  return typeof x === 'function';\n}\n\nexport function classnames(...arr: any[]) {\n  // const arr = Array.prototype.slice.call(arguments);\n  return arr\n    .filter((x) => x)\n    .map((x) => {\n      if (typeof x === 'string') {\n        return x;\n      }\n      if (Array.isArray(x)) {\n        return classnames.apply(null, x);\n      }\n\n      return classnames.apply(null, [...(x.basedOn || []), x.className]);\n    })\n    .join(' ');\n}\n\nexport const cn = classnames;\n\nexport interface CssObjectsOptions {\n  debug?: boolean;\n}\n\nexport type UseStyles<T> = {\n  (): Record<keyof T, string>;\n} & CssObject<T>;\n\nfunction useStylesInternal<T>(obj: { [key in keyof T]: any }): Record<\n  keyof T,\n  string\n> {\n  const ctxAttach = useEnsureAttached();\n  useIsomorphicLayoutEffect(() => {\n    for (const val of Object.values(obj)) {\n      ctxAttach(val as any);\n    }\n  }, [obj, ctxAttach]);\n  const [styles] = useState(() =>\n    (Object.entries(obj) as [keyof T, any][]).reduce((accum, [key, val]) => {\n      accum[key] = cn(val);\n      return accum;\n    }, {} as Record<keyof T, string>)\n  );\n\n  return styles;\n}\n\nexport function makeStyles<T>(\n  obj: T | CssObjectCreator<T>,\n  ns = genId(),\n  opts?: CssObjectsOptions\n): UseStyles<T> {\n  if (isCssFn(obj)) {\n    obj = obj(cssTheme, (cname) => `${cname}_${ns}`);\n  }\n  const useStyles = () => {\n    return useStylesInternal(useStyles);\n  };\n  for (const [key, val] of Object.entries(obj)) {\n    useStyles[key] = toCss(val, key, '', true, false, ns);\n  }\n  Object.keys(obj).reduce((accum, key) => {\n    accum[key] = toCss(obj[key], key, '', true, false, ns);\n    return accum;\n  }, {} as CssObject<T>);\n\n  useStyles.getCss = () =>\n    Object.keys(useStyles)\n      .filter((x) => x !== 'getCss')\n      .map((k) => getStyle(useStyles[k]))\n      .join('\\n\\n');\n\n  return useStyles as unknown as UseStyles<T>;\n}\n\nexport function merge(...args: any[]): any {\n  // const args = Array.prototype.slice.call(arguments);\n  args.unshift({});\n\n  return Object.assign.apply(\n    null,\n    args.filter((x) => x)\n  );\n}\n\nexport function keyframes<T>(\n  def: T | CssObjectCreator<T>,\n  ns = genId()\n): string {\n  const name = `animation_${ns}`;\n  if (isCssFn(def)) {\n    def = def(cssTheme, (cname) => `${cname}_${ns}`);\n  }\n\n  const css = Object.keys(def).map((frame) => {\n    const style = [];\n    Object.keys(def[frame]).forEach((k) => {\n      const val = def[frame][k];\n      formatKey(k).forEach((x) => {\n        style.push(`  ${x}: ${stringify(x, val)};`);\n      });\n    });\n\n    return `${frame} { ${style.join('')} }`;\n  });\n\n  const animation = `@keyframes ${name} { ${css.join('\\n')}}`;\n  __CssRegistry.appendCss(animation);\n\n  return name;\n}\n", "import { ReadonlyJSONObject } from './interfaces.ts';\n\nexport function cartesianProduct<T>(...allEntries: T[][]): T[][] {\n  return allEntries.reduce<T[][]>(\n    (results, entries) =>\n      results\n        .map((result) => entries.map((entry) => result.concat([entry])))\n        .reduce((subResults, result) => subResults.concat(result), []),\n    [[]]\n  );\n}\n\nexport function count<T = unknown>(iter: Iterable<T>): number {\n  let count = 0;\n  for (const _ of iter) {\n    ++count;\n  }\n  return count;\n}\n\nexport function uniqueId(length = 20): string {\n  // Alphanumeric characters\n  const chars =\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  let autoId = '';\n  for (let i = 0; i < length; i++) {\n    autoId += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return autoId;\n}\n\nexport function prettyJSON(o: ReadonlyJSONObject): string {\n  if (o.toJSON instanceof Function) {\n    o = (o.toJSON as unknown as () => ReadonlyJSONObject)();\n  }\n  return JSON.stringify(o, null, 2);\n}\n\nexport function* keysOf<T extends Record<string, unknown>>(\n  obj: T\n): Generator<string> {\n  for (const k in obj) {\n    // deno-lint-ignore no-prototype-builtins\n    if (obj.hasOwnProperty(k)) {\n      yield k;\n    }\n  }\n}\n\nexport function allKeysOf<T extends Record<never, never>>(obj: T): (keyof T)[] {\n  return Object.keys(obj) as (keyof T)[];\n}\n\nexport function* unionIter<T>(...args: Iterable<T>[]): Iterable<T> {\n  for (const iter of args) {\n    for (const v of iter) {\n      yield v;\n    }\n  }\n}\n\nexport function newInstance<T = any>(instance: any, ...args: any[]): T {\n  return new (instance.constructor as any)(...args) as T;\n}\n\nexport function* mapIterable<IT, OT = IT>(\n  input: Iterable<IT>,\n  mapper: (v: IT, idx: number) => OT\n): Iterable<OT> {\n  let i = 0;\n  for (const v of input) {\n    yield mapper(v, i);\n    ++i;\n  }\n}\n\nexport function* filterIterable<IT>(\n  input: Iterable<IT>,\n  filter: (v: IT) => boolean\n): Iterable<IT> {\n  for (const v of input) {\n    if (filter(v)) {\n      yield v;\n    }\n  }\n}\n", "export const gridbase = 8;\n\nconst timing = {\n  standard: 'cubic-bezier(0.4, 0.0, 0.2, 1)',\n  in: 'cubic-bezier(0.0, 0.0, 0.2, 1)',\n  out: 'cubic-bezier(0.4, 0.0, 1, 1)',\n};\n\nconst duration = {\n  standard: 300,\n  short: 150,\n};\n\nexport const transition = {\n  timing,\n  duration,\n  standard: {\n    transitionDuration: duration.standard + 'ms',\n    transitionTimingFunction: timing.standard,\n  },\n  short: {\n    transitionDuration: duration.short + 'ms',\n    transitionTimingFunction: timing.standard,\n  },\n};\nconst styleguide = {\n  gridbase,\n  transition,\n};\n\nexport { styleguide };\n", "import { makeStyles } from './css-objects/index.ts';\n\nconst layout = makeStyles(\n  {\n    row: {\n      display: 'flex',\n      flexDirection: 'row',\n      '&startCenter': {\n        alignItems: 'flex-start',\n        justifyContent: 'center',\n      },\n    },\n    column: {\n      display: 'flex',\n      flexDirection: 'column',\n    },\n    centerCenter: {\n      alignItems: 'center',\n      justifyContent: 'center',\n    },\n    flex: {\n      flexGrow: '1',\n      flexShrink: '0',\n      flexBasis: 'auto',\n    },\n    flexSpacer: {\n      flexGrow: '1',\n      flexShrink: '1',\n      flexBasis: 'auto',\n    },\n  },\n  'layout_1535ab'\n);\n\nexport { layout };\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { makeStyles, cn, keyframes } from '../css-objects/index.ts';\n\nimport { styleguide } from '../styleguide.ts';\n\nconst rotator = keyframes(\n  {\n    '0%': {\n      transform: 'rotate(0deg)',\n    },\n    '100%': {\n      transform: 'rotate(270deg)',\n    },\n  },\n  'spinner-view_56211d'\n);\nconst offset = 187;\n\nconst dash = keyframes(\n  {\n    '0%': {\n      strokeDashoffset: `${offset}`,\n    },\n    '50%': {\n      strokeDashoffset: `${offset / 4}`,\n      transform: 'rotate(135deg)',\n    },\n    '100%': {\n      strokeDashoffset: `${offset}`,\n      transform: 'rotate(450deg)',\n    },\n  },\n  'spinner-view_93a725'\n);\n\nconst duration = '1.47s';\n\nconst useStyles = makeStyles((theme) => ({\n  spinner: {\n    animation: `${rotator} ${duration} linear infinite`,\n  },\n  path: {\n    strokeDasharray: `${offset}`,\n    strokeDashoffset: 0,\n    transformOrigin: 'center',\n    animation: `${dash} ${duration} ease-in-out infinite`,\n    stroke: theme.primary[500],\n  },\n}));\n\n// export interface SpinnerViewProps {\n// \tsize?: number,\n// \tcolor?: string\n// }\nexport const SpinnerView = ({\n  size = styleguide.gridbase * 8,\n  color = undefined,\n}) => {\n  const styles = useStyles();\n  const props: any = {};\n  const style: any = {};\n  if (color) {\n    props.stroke = color;\n    style.stroke = color;\n  }\n  return (\n    <svg\n      className={cn(styles.spinner)}\n      width={size}\n      height={size}\n      viewBox=\"0 0 66 66\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <circle\n        className={cn(styles.path)}\n        fill=\"none\"\n        strokeWidth=\"6\"\n        strokeLinecap=\"round\"\n        cx=\"33\"\n        cy=\"33\"\n        r=\"30\"\n        style={style}\n        {...props}\n      />\n    </svg>\n  );\n};\nexport default SpinnerView;\n", "import { useState, useEffect } from 'https://esm.sh/react@18.2.0';\n\nexport function useWindowSize() {\n  const [size, setSize] = useState({\n    width: window.innerWidth,\n    height: window.innerHeight,\n  });\n\n  useEffect(() => {\n    const handler = () => {\n      setSize({\n        width: window.innerWidth,\n        height: window.innerHeight,\n      });\n    };\n\n    window.addEventListener('resize', handler);\n    return () => {\n      window.removeEventListener('resize', handler);\n    };\n  }, []);\n\n  return size;\n}\n", "import { isServerSide } from './utils/ssr.ts';\nimport { useWindowSize } from './utils/hooks/use-window-size.ts';\n\nexport enum Breakpoints {\n  Small = 576,\n  Medium = 768,\n  Large = 992,\n  XLarge = 1200,\n}\n\nexport const MediaQueries = {\n  Mobile: `@media (max-width: ${Breakpoints.Medium}px)`,\n  Tablet: `@media (min-width: ${Breakpoints.Medium}px)`,\n  TabletOnly: `@media (min-width: ${Breakpoints.Medium}px) and (max-width: ${Breakpoints.Large}px)`,\n  TabletAndMobile: `@media (max-width: ${Breakpoints.Large}px)`,\n  Computer: `@media (min-width: ${Breakpoints.Large}px)`,\n  LaptopOnly: `@media (min-width: ${Breakpoints.Large}px) and (max-width: ${Breakpoints.XLarge}px)`,\n  Desktop: `@media (min-width: ${Breakpoints.XLarge}px)`,\n};\n\nexport enum Devices {\n  Mobile,\n  Tablet,\n  Laptop,\n  Desktop,\n}\n\nfunction getDevice(screenWidth: number) {\n  if (screenWidth < Breakpoints.Medium) {\n    return Devices.Mobile;\n  }\n  if (screenWidth < Breakpoints.Large) {\n    return Devices.Tablet;\n  }\n  if (screenWidth < Breakpoints.XLarge) {\n    return Devices.Laptop;\n  }\n  return Devices.Desktop;\n}\n\nexport function getCurrentDevice() {\n  return getDevice(window.innerWidth);\n}\n\nexport const useCurrentDevice = isServerSide\n  ? () => Devices.Laptop\n  : function () {\n      const { width } = useWindowSize();\n\n      return getDevice(width);\n    };\n", "import { cn, makeStyles } from '../css-objects/index.ts';\nimport React, { ElementType } from 'https://esm.sh/react@18.2.0';\nimport { MediaQueries } from '../responsive.ts';\nimport { brandLightTheme as theme } from '../theme.tsx';\n\nexport const FontFamily: readonly string[] = [\n  \"'Poppins'\",\n  \"'Heebo'\",\n  'sans-serif',\n];\n\nexport const useStyles = makeStyles(\n  () => ({\n    h1: {\n      margin: 0,\n      padding: 0,\n      fontWeight: '600',\n      fontSize: 34,\n      lineHeight: '40px',\n      color: theme.colors.text,\n      letterSpacing: 0.09,\n      [MediaQueries.LaptopOnly]: {\n        fontSize: 26,\n        lineHeight: '32px',\n        letterSpacing: 0.065,\n      },\n      [MediaQueries.TabletAndMobile]: {\n        fontSize: 24,\n        lineHeight: '30px',\n        letterSpacing: 0.06,\n      },\n      [MediaQueries.Mobile]: {\n        lineHeight: '22px',\n      },\n    },\n    h2: {\n      color: theme.colors.text,\n      margin: 0,\n      padding: 0,\n      fontWeight: '600',\n      fontSize: 24,\n      lineHeight: '30px',\n      letterSpacing: 0.15,\n      [MediaQueries.Mobile]: {\n        fontSize: 18,\n        lineHeight: '24px',\n        letterSpacing: 0.11,\n      },\n      [MediaQueries.Desktop]: {\n        fontSize: 30,\n        lineHeight: '32px',\n        letterSpacing: 0.19,\n      },\n    },\n    h3: {\n      color: theme.colors.text,\n      margin: 0,\n      padding: 0,\n    },\n    h4: {\n      color: theme.colors.text,\n      margin: 0,\n      padding: 0,\n      fontWeight: '400',\n      fontSize: 16,\n      lineHeight: '22px',\n      letterSpacing: 0.1,\n      [MediaQueries.TabletAndMobile]: {\n        fontSize: 14,\n        lineHeight: '20px',\n        letterSpacing: 0.09,\n      },\n    },\n    h5: {\n      fontSize: 16,\n      fontWeight: '400',\n      lineHeight: '22px',\n    },\n    label: {\n      color: theme.colors.text,\n      fontSize: 16,\n      lineHeight: '24px',\n      letterSpacing: 0.9,\n      fontWeight: '600',\n    },\n    labelSmall: {\n      fontSize: 14,\n      lineHeight: '20px',\n      fontWeight: '600',\n    },\n    button: {\n      fontSize: 14,\n      lineHeight: '20px',\n      fontWeight: '500',\n    },\n    text: {\n      color: theme.colors.text,\n      fontSize: 13,\n      lineHeight: '18px',\n      letterSpacing: 0.06,\n    },\n    textSmall: {\n      fontSize: 10,\n      lineHeight: '14px',\n      fontWeight: '400',\n    },\n    bold: {\n      color: theme.colors.text,\n      fontWeight: '600',\n      fontSize: 13,\n      lineHeight: '18px',\n      letterSpacing: 0.07,\n    },\n  }),\n  'typography_a4e47a'\n);\nexport { useStyles as useTypographyStyles };\ntype TypographyProps<T extends ElementType> =\n  React.ComponentPropsWithoutRef<T> & { className?: string };\n\nexport const H1 = React.forwardRef(\n  (\n    { children, className, ...props }: TypographyProps<'h1'>,\n    ref: React.ForwardedRef<HTMLHeadingElement>\n  ) => {\n    const styles = useStyles();\n\n    return (\n      <h1 ref={ref} {...props} className={cn(styles.h1, className)}>\n        {children}\n      </h1>\n    );\n  }\n);\n\nexport const H2 = React.forwardRef(\n  (\n    { children, className, ...props }: TypographyProps<'h2'>,\n    ref: React.ForwardedRef<HTMLHeadingElement>\n  ) => {\n    const styles = useStyles();\n\n    return (\n      <h2 ref={ref} {...props} className={cn(styles.h2, className)}>\n        {children}\n      </h2>\n    );\n  }\n);\n\nexport const H3 = React.forwardRef(\n  (\n    { children, className, ...props }: TypographyProps<'h3'>,\n    ref: React.ForwardedRef<HTMLHeadingElement>\n  ) => {\n    const styles = useStyles();\n\n    return (\n      <h3 ref={ref} {...props} className={cn(styles.h3, className)}>\n        {children}\n      </h3>\n    );\n  }\n);\n\nexport const H4 = React.forwardRef(\n  (\n    { children, className, ...props }: TypographyProps<'h4'>,\n    ref: React.ForwardedRef<HTMLHeadingElement>\n  ) => {\n    const styles = useStyles();\n\n    return (\n      <h4 ref={ref} {...props} className={cn(styles.h4, className)}>\n        {children}\n      </h4>\n    );\n  }\n);\n\nexport const Text = React.forwardRef(\n  (\n    { children, className, ...props }: TypographyProps<'span'>,\n    ref: React.ForwardedRef<HTMLSpanElement>\n  ) => {\n    const styles = useStyles();\n\n    return (\n      <span ref={ref} {...props} className={cn(styles.text, className)}>\n        {children}\n      </span>\n    );\n  }\n);\n\nexport const TextSm = React.forwardRef(\n  (\n    { children, className, ...props }: TypographyProps<'span'>,\n    ref: React.ForwardedRef<HTMLSpanElement>\n  ) => {\n    const styles = useStyles();\n\n    return (\n      <span ref={ref} {...props} className={cn(styles.textSmall, className)}>\n        {children}\n      </span>\n    );\n  }\n);\n\nexport const Bold = React.forwardRef(\n  (\n    { children, className, ...props }: TypographyProps<'span'>,\n    ref: React.ForwardedRef<HTMLSpanElement>\n  ) => {\n    const styles = useStyles();\n\n    return (\n      <span ref={ref} {...props} className={cn(styles.bold, className)}>\n        {children}\n      </span>\n    );\n  }\n);\n\nexport const Label = React.forwardRef(\n  (\n    { children, className, ...props }: TypographyProps<'span'>,\n    ref: React.ForwardedRef<HTMLSpanElement>\n  ) => {\n    const styles = useStyles();\n\n    return (\n      <span ref={ref} {...props} className={cn(styles.label, className)}>\n        {children}\n      </span>\n    );\n  }\n);\n\nexport const LabelSm = React.forwardRef(\n  (\n    { children, className, ...props }: TypographyProps<'span'>,\n    ref: React.ForwardedRef<HTMLSpanElement>\n  ) => {\n    const styles = useStyles();\n\n    return (\n      <span ref={ref} {...props} className={cn(styles.labelSmall, className)}>\n        {children}\n      </span>\n    );\n  }\n);\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { cn, makeStyles } from '../css-objects/index.ts';\nimport { styleguide } from '../styleguide.ts';\nimport { layout } from '../layout.ts';\nimport SpinnerView from './spinner-view.tsx';\nimport { FontFamily, useTypographyStyles } from './typography.tsx';\nimport { brandLightTheme as theme } from '../theme.tsx';\nexport enum RaisedButtonColor {\n  Primary = 'primary',\n  Secondary = 'secondary',\n}\nconst colorTransition = {\n  transitionDuration: styleguide.transition.duration.short + 'ms',\n  transitionProperty: 'background-color',\n  transitionTimingFunction: 'linear',\n};\n\nexport const useButtonStyles = makeStyles(\n  () => ({\n    button: {\n      fontFamily: FontFamily,\n      border: 'none',\n      outline: 'none',\n      backgroundColor: 'transparent',\n      cursor: 'pointer',\n      padding: 0,\n      basedOn: [layout.row, layout.centerCenter],\n    },\n  }),\n  'buttons_b9ffab'\n);\n\nexport const useFabStyles = makeStyles(\n  () => ({\n    fab: {\n      position: 'absolute',\n      right: styleguide.gridbase * 6,\n      bottom: styleguide.gridbase * 6,\n      width: styleguide.gridbase * 7,\n      height: styleguide.gridbase * 7,\n      zIndex: 100,\n      borderRadius: '50%',\n      backgroundColor: theme.primary[500],\n      ...colorTransition,\n      ':hover': {\n        backgroundColor: theme.primary['400'],\n      },\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'center',\n      justifyContent: 'center',\n      boxShadow: theme.shadows.z2,\n    },\n  }),\n  'buttons_f97674'\n);\n\nconst useIconButtonStyles = makeStyles(\n  () => ({\n    iconButton: {\n      width: styleguide.gridbase * 5,\n      height: styleguide.gridbase * 5,\n      borderRadius: '50%',\n      backgroundColor: 'transparent',\n      ...colorTransition,\n      ':hover': {\n        ':not(disabled)': {\n          backgroundColor: theme.colors.background,\n        },\n      },\n      ':focus': {\n        ':not(disabled)': {\n          backgroundColor: theme.colors.background,\n        },\n      },\n      basedOn: [useButtonStyles.button],\n    },\n  }),\n  'buttons_555432'\n);\n\nconst useSecondaryButtonStyles = makeStyles(\n  () => ({\n    secondaryButton: {\n      padding: styleguide.gridbase,\n      boxSizing: 'border-box',\n      height: styleguide.gridbase * 5,\n      borderRadius: 4,\n      color: theme.colors.text,\n      border: `1px solid ${theme.colors.background}`,\n      backgroundColor: theme.colors.background[0],\n      fontSize: 14,\n      fontWeight: 500,\n      fontStyle: 'normal',\n      fontStretch: 'normal',\n      lineHeight: 1.14,\n      letterSpacing: 'normal',\n      ...colorTransition,\n      ':hover': {\n        ':not(disabled)': {\n          backgroundColor: theme.mono.m2,\n        },\n      },\n      ':disabled': {\n        backgroundColor: theme.mono.m2,\n        color: theme.colors.placeholderText,\n        cursor: 'not-allowed',\n      },\n      basedOn: [useButtonStyles.button],\n    },\n  }),\n  'buttons_793301'\n);\n\nexport const useRaisedButtonStyles = makeStyles(\n  () => ({\n    raisedButton: {\n      padding: styleguide.gridbase,\n      boxSizing: 'border-box',\n      height: styleguide.gridbase * 4,\n      borderRadius: styleguide.gridbase * 2,\n      ...colorTransition,\n\n      basedOn: [useButtonStyles.button, useTypographyStyles.button],\n    },\n    [RaisedButtonColor.Primary]: {\n      color: theme.colors.background,\n      backgroundColor: theme.colors.primaryButton,\n      ':hover': {\n        ':not(disabled)': {\n          backgroundColor: theme.primary.p6,\n        },\n      },\n      ':disabled': {\n        backgroundColor: theme.primary.p6,\n        cursor: 'not-allowed',\n      },\n    },\n    [RaisedButtonColor.Secondary]: {\n      color: theme.colors.text,\n      backgroundColor: theme.colors.secondaryButtonActive,\n      ':hover': {\n        ':not(disabled)': {\n          backgroundColor: theme.secondary.s6,\n        },\n      },\n      ':disabled': {\n        backgroundColor: theme.secondary.s6,\n        cursor: 'not-allowed',\n      },\n    },\n  }),\n  'buttons_05a5fe'\n);\n\nconst useLinkButtonStyles = makeStyles(\n  (theme) => ({\n    linkButton: {\n      color: theme.primary[500],\n      textDecoration: 'underline',\n      fontSize: 16,\n      height: styleguide.gridbase * 3,\n      basedOn: [useButtonStyles.button],\n    },\n  }),\n  'buttons_8deff1'\n);\ntype ButtonProps = React.ComponentPropsWithoutRef<'button'>;\n\nfunction makeButton<TProps>(useStyles, className) {\n  return React.forwardRef<HTMLButtonElement, TProps>(\n    (props: ButtonProps, ref) => {\n      const styles = useStyles();\n      return (\n        <button\n          ref={ref}\n          {...props}\n          className={cn(props.className, styles[className])}\n        />\n      );\n    }\n  );\n}\n\nexport const Button = makeButton<ButtonProps>(useButtonStyles, 'button');\n\nexport const FabButton = makeButton<ButtonProps>(useFabStyles, 'fab');\n\nexport const IconButton = makeButton<ButtonProps>(\n  useIconButtonStyles,\n  'iconButton'\n);\n\nexport const LinkButton = makeButton<ButtonProps>(\n  useLinkButtonStyles,\n  'linkButton'\n);\n\ninterface RaisedButtonProps extends ButtonProps {\n  processing?: boolean;\n  color?: RaisedButtonColor;\n}\n\nexport const RaisedButton = React.forwardRef<\n  HTMLButtonElement,\n  RaisedButtonProps\n>(function (\n  {\n    className,\n    children,\n    disabled,\n    color = RaisedButtonColor.Primary,\n    processing,\n    ...rest\n  },\n  ref\n) {\n  const styles = useRaisedButtonStyles();\n  const disAttr = { disabled: disabled || processing };\n  return (\n    <button\n      ref={ref}\n      {...disAttr}\n      className={cn(className, styles.raisedButton, styles[color])}\n      {...rest}\n    >\n      {processing ? (\n        <SpinnerView size={styleguide.gridbase * 3} color=\"white\" />\n      ) : (\n        children\n      )}\n    </button>\n  );\n});\n\nexport const SecondaryButton = React.forwardRef<\n  HTMLButtonElement,\n  RaisedButtonProps\n>(function ({ className, children, disabled, processing, ...rest }, ref) {\n  const styles = useSecondaryButtonStyles();\n  const disAttr = { disabled: disabled || processing };\n  return (\n    <button\n      ref={ref}\n      {...disAttr}\n      className={cn(className, styles.secondaryButton)}\n      {...rest}\n    >\n      {processing ? (\n        <SpinnerView size={styleguide.gridbase * 3} color=\"white\" />\n      ) : (\n        children\n      )}\n    </button>\n  );\n});\n", "import { useRef, useEffect } from 'https://esm.sh/react@18.2.0';\n\nexport function useMountedIndicator() {\n  const isMountedRef = useRef(true);\n  useEffect(() => {\n    isMountedRef.current = true;\n    return () => {\n      isMountedRef.current = false;\n    };\n  }, []);\n\n  return isMountedRef;\n}\n", "import React, {\n  useEffect,\n  useRef,\n  useState,\n  useLayoutEffect,\n} from 'https://esm.sh/react@18.2.0';\nimport { styleguide } from '../styleguide.ts';\nimport { makeStyles, cn } from '../css-objects/index.ts';\nimport { useMountedIndicator } from '../utils/hooks/use-mounted-indicator.ts';\n\nconst useStyles = makeStyles(\n  (theme) => ({\n    collapseExpand: {\n      overflow: 'visible',\n      transition: `all ${styleguide.transition.duration.standard}ms ${styleguide.transition.timing.standard}`,\n    },\n    visible: {\n      // opacity: 1,\n      transform: 'translateX(0)',\n    },\n    entering: {\n      // opacity: 0,\n      minHeight: 0,\n      overflow: 'hidden',\n    },\n    exiting: {\n      // minHeight: 0,\n      overflow: 'hidden',\n      // opacity: 0,\n      // transform: 'translateX(-100%)',\n    },\n  }),\n  'transition_fe904c'\n);\n\nexport enum TRANSITION_STATES {\n  VISIBLE = 'VISIBLE',\n  ENTERING = 'ENTERING',\n  EXITING = 'EXITING',\n  REMOVED = 'REMOVED',\n}\n\nexport function useTransitionedOpen(\n  open: boolean,\n  animationDuration = styleguide.transition.duration.standard\n): [TRANSITION_STATES, React.MutableRefObject<boolean>] {\n  const [visibility, setVisibility] = useState(\n    open ? TRANSITION_STATES.ENTERING : TRANSITION_STATES.REMOVED\n  );\n  const prevOpen = useRef(open);\n  const isMounted = useMountedIndicator();\n  const animDuration = useRef(animationDuration);\n\n  useEffect(() => {\n    let nextState: TRANSITION_STATES;\n    if (!open && prevOpen.current) {\n      setVisibility(TRANSITION_STATES.EXITING);\n      nextState = TRANSITION_STATES.REMOVED;\n    } else if (open) {\n      setVisibility(TRANSITION_STATES.ENTERING);\n      nextState = TRANSITION_STATES.VISIBLE;\n    }\n    prevOpen.current = open;\n    const timeout = window.setTimeout(() => {\n      if (nextState && isMounted.current) {\n        setVisibility(nextState);\n      }\n    }, animDuration.current + 50);\n\n    return () => {\n      window.clearTimeout(timeout);\n    };\n  }, [open, isMounted]);\n\n  return [visibility, isMounted];\n}\n\nclass TimersCounter {\n  private _timers = {};\n\n  addTimer(key, timeoutId, action) {\n    if (this._timers[key]) {\n      this.removeTimer(key);\n    }\n    this._timers[key] = {\n      id: timeoutId,\n      action,\n    };\n  }\n\n  removeTimer(key) {\n    if (!this._timers[key]) {\n      return;\n    }\n\n    window.clearTimeout(this._timers[key]);\n    delete this._timers[key];\n  }\n\n  clear() {\n    Object.keys(this._timers).forEach((key) => this.removeTimer(key));\n  }\n}\n\nfunction useTransitioningChildren(children, duration) {\n  const timers = useRef(new TimersCounter());\n  const toArray = (x) => x;\n  const [newChildren, setNewChildren] = useState(children);\n\n  const setWrapped = (fn) =>\n    setNewChildren((...args) => {\n      const r = fn(...args);\n\n      return r;\n    });\n  useEffect(() => {\n    setWrapped((c) => {\n      const childArray = toArray(\n        children.map((item) => {\n          const newProps = {\n            transitionState:\n              item.props.transitionState || TRANSITION_STATES.VISIBLE,\n          };\n          if (c.every((x) => x.key !== item.key)) {\n            newProps.transitionState = TRANSITION_STATES.ENTERING;\n            const timerId = window.setTimeout(() => {\n              setWrapped((things) =>\n                things.map((i) => {\n                  if (i.key !== item.key) {\n                    return i;\n                  }\n                  timers.current.removeTimer(item.key);\n                  return React.cloneElement(i, {\n                    transitionState: TRANSITION_STATES.VISIBLE,\n                  });\n                })\n              );\n            }, duration);\n\n            timers.current.addTimer(item.key, timerId, 'enter');\n          }\n\n          const e = React.cloneElement(item, newProps);\n\n          return e;\n        })\n      );\n\n      c.forEach((existing, index) => {\n        const newItem = childArray.find((x) => {\n          return x.key === existing.key;\n        });\n\n        if (newItem) {\n          return;\n        }\n        console.log('removing ', existing);\n\n        if (\n          existing.props.transitionState === TRANSITION_STATES.VISIBLE ||\n          existing.props.transitionState === TRANSITION_STATES.ENTERING\n        ) {\n          existing = React.cloneElement(existing, {\n            transitionState: TRANSITION_STATES.EXITING,\n          });\n          const timerId = window.setTimeout(() => {\n            setWrapped((c) =>\n              c.filter((x) => {\n                console.log(x.key, existing.key);\n                return x.key !== existing.key;\n              })\n            );\n            timers.current.removeTimer(existing.key);\n          }, duration);\n          timers.current.addTimer(existing.key, timerId, 'exit');\n        }\n\n        childArray.splice(index, 0, existing);\n      });\n\n      return childArray;\n    });\n  }, [children, duration]);\n\n  return newChildren;\n}\n\nexport default function TransitionGroup({\n  children,\n  duration = styleguide.transition.duration.standard + 200,\n}) {\n  const newChildren = useTransitioningChildren(children, duration);\n\n  return <React.Fragment>{newChildren}</React.Fragment>;\n}\n\nexport function CollapseExpandTransition({\n  children,\n  transitionState,\n  className,\n  style = {},\n}) {\n  const styles = useStyles();\n  const elementRef = useRef();\n  const [expandStyle, setExpandStyle] = useState({});\n\n  useLayoutEffect(() => {\n    if (!elementRef.current) {\n      return;\n    }\n    const rect = (\n      elementRef.current as unknown as HTMLElement\n    ).getBoundingClientRect();\n    if (transitionState === TRANSITION_STATES.ENTERING) {\n      setExpandStyle({\n        height: 0,\n        padding: 0,\n      });\n      window.requestAnimationFrame((x) => {\n        setExpandStyle({\n          height: Math.max(rect.height),\n          opacity: 1,\n        });\n      });\n    } else if (transitionState === TRANSITION_STATES.VISIBLE) {\n      setExpandStyle({});\n    } else if (transitionState === TRANSITION_STATES.EXITING) {\n      setExpandStyle({\n        height: rect.height,\n      });\n\n      window.requestAnimationFrame((x) => {\n        setExpandStyle({\n          height: 0,\n          minHeight: 0,\n        });\n      });\n    }\n  }, [transitionState]);\n\n  return (\n    <div\n      ref={elementRef}\n      style={{ ...style, ...expandStyle }}\n      className={cn(\n        className,\n        styles.collapseExpand,\n        transitionState && styles[transitionState.toLowerCase()]\n      )}\n    >\n      {children}\n    </div>\n  );\n}\n", "import React, {\n  useEffect,\n  useState,\n  useRef,\n  useCallback,\n  useContext,\n} from 'https://esm.sh/react@18.2.0';\nimport ReactDOM from 'https://esm.sh/react-dom@18.2.0';\nimport { makeStyles, cn, keyframes } from '../../css-objects/index.ts';\nimport { uniqueId } from '../../../base/common.ts';\nimport { styleguide } from '../../styleguide.ts';\nimport { layout } from '../../layout.ts';\nimport { Button } from '../buttons.tsx';\nimport TransitionGroup, { TRANSITION_STATES } from '../transition.tsx';\n\nconst enterAnimation = keyframes(\n  {\n    from: {\n      transform: 'translateY(100%)',\n    },\n    to: {\n      transform: 'translateY(0)',\n    },\n  },\n  'toast_a27e92'\n);\n\nconst exitAnimation = keyframes(\n  {\n    from: {\n      transform: 'translateX(0)',\n      opacity: 1,\n    },\n    to: {\n      transform: 'translateX(-100%)',\n      opacity: 0,\n    },\n  },\n  'toast_a00e2d'\n);\n\nconst exitAnimationLast = keyframes(\n  {\n    from: {\n      transform: 'translateX(0)',\n      opacity: 1,\n    },\n    to: {\n      transform: 'translateY(100%)',\n      opacity: 0,\n    },\n  },\n  'toast_62f7a9'\n);\n\nconst useStyles = makeStyles(\n  (theme) => ({\n    toastList: {\n      position: 'absolute',\n      bottom: styleguide.gridbase * 8,\n      left: styleguide.gridbase * 8,\n      zIndex: 10,\n    },\n    toast: {\n      color: theme.background[0],\n      paddingLeft: styleguide.gridbase * 3,\n      borderRadius: 6,\n      alignItems: 'center',\n      backgroundColor: theme.background[800],\n      boxSizing: 'border-box',\n      height: styleguide.gridbase * 7,\n      width: styleguide.gridbase * 57,\n      animation: `${enterAnimation} ${styleguide.transition.duration.standard}ms ${styleguide.transition.timing.standard} forwards`,\n      boxShadow: theme.shadows.z2,\n      basedOn: [layout.row],\n    },\n    toastButton: {\n      color: theme.primary[500],\n      padding: styleguide.gridbase * 3,\n    },\n    [TRANSITION_STATES.EXITING.toLowerCase()]: {\n      animation: `${exitAnimation} ${styleguide.transition.duration.standard}ms ${styleguide.transition.timing.standard} forwards`,\n      ':last-child': {\n        animation: `${exitAnimationLast} ${styleguide.transition.duration.standard}ms ${styleguide.transition.timing.standard} forwards`,\n      },\n    },\n  }),\n  'toast_f4e0ae'\n);\n\ninterface ToastInfo {\n  id?: string;\n  duration?: number;\n  text: string;\n  action?: { text: string; fn: (dismiss: DismissFn) => void };\n}\n\ntype DismissFn = () => void;\n\ninterface ToastController {\n  displayToast: (info: ToastInfo) => DismissFn;\n}\n\nexport const toastContext = React.createContext<ToastController>({\n  displayToast: (x: ToastInfo) => {\n    return () => {};\n  },\n});\n\nexport const useToastController = () => useContext(toastContext);\n\nfunction Toast({\n  message,\n  dismiss,\n  transitionState = '',\n}: {\n  message: ToastInfo;\n  dismiss: DismissFn;\n  transitionState?: string;\n}) {\n  const styles = useStyles();\n  const [processing, setProcessing] = useState(false);\n  const onClick = () => {\n    setProcessing(true);\n    Promise.resolve(message.action.fn(dismiss)).finally(() =>\n      setProcessing(false)\n    );\n  };\n  return (\n    <div className={cn(styles.toast, styles[transitionState.toLowerCase()])}>\n      <span>{message.text}</span>\n      <div className={cn(layout.flexSpacer)} />\n      {message.action && (\n        <Button\n          className={cn(styles.toastButton)}\n          onClick={onClick}\n          disabled={processing}\n        >\n          {message.action.text}\n        </Button>\n      )}\n    </div>\n  );\n}\n\nfunction ToastsView({ messages, dismiss }) {\n  const styles = useStyles();\n  return ReactDOM.createPortal(\n    <div className={cn(styles.toastList)}>\n      <TransitionGroup>\n        {messages.map((msg) => (\n          <Toast message={msg} dismiss={() => dismiss(msg)} key={msg.id} />\n        ))}\n      </TransitionGroup>\n    </div>,\n    window.document.getElementById('root')\n  );\n}\n\nexport function ToastProvider({ children }) {\n  const [messages, setMessages] = useState([]);\n  let mounted = useRef(true);\n  useEffect(() => {\n    return () => {\n      mounted.current = false;\n    };\n  }, []);\n  const presentToast = useCallback((toastInfo) => {\n    if (!mounted.current) {\n      return () => {};\n    }\n    if (!toastInfo.id) {\n      toastInfo.id = uniqueId();\n    }\n    setMessages((msgs) => [...msgs, toastInfo]);\n    if (toastInfo.duration) {\n      window.setTimeout(() => {\n        dismiss(toastInfo);\n      }, toastInfo.duration);\n    }\n\n    return () => dismiss(toastInfo);\n  }, []);\n\n  const dismiss = (toastInfo) => {\n    if (!mounted) {\n      return;\n    }\n    setMessages((msgs) => msgs.filter((x) => x !== toastInfo));\n  };\n\n  return (\n    <toastContext.Provider\n      value={{\n        displayToast: presentToast,\n      }}\n    >\n      {children}\n      <ToastsView messages={messages} dismiss={dismiss} />\n    </toastContext.Provider>\n  );\n}\n", "import { layout } from './layout.ts';\n\nimport { styleguide } from './styleguide.ts';\n\nexport { layout, styleguide };\n", "import { CoreObject } from '../base/core-types/base.ts';\nimport { ReadonlyJSONObject } from '../base/interfaces.ts';\n\nexport type Severity =\n  | 'EMERGENCY'\n  | 'ALERT'\n  | 'CRITICAL'\n  | 'ERROR'\n  | 'WARNING'\n  | 'NOTICE'\n  | 'INFO'\n  | 'DEBUG'\n  | 'DEFAULT';\n\nexport const SeverityCodes: { [key in Severity]: number } = {\n  EMERGENCY: 800,\n  ALERT: 700,\n  CRITICAL: 600,\n  ERROR: 500,\n  WARNING: 400,\n  NOTICE: 300,\n  INFO: 200,\n  DEBUG: 100,\n  DEFAULT: 0,\n};\n\nexport function SeverityCodeFromSeverity(s: Severity): number {\n  return SeverityCodes[s];\n}\n\nexport function SeverityFromCode(code: number): Severity {\n  switch (code) {\n    case SeverityCodes.EMERGENCY:\n      return 'EMERGENCY';\n\n    case SeverityCodes.ALERT:\n      return 'ALERT';\n\n    case SeverityCodes.CRITICAL:\n      return 'CRITICAL';\n\n    case SeverityCodes.ERROR:\n      return 'ERROR';\n\n    case SeverityCodes.WARNING:\n      return 'WARNING';\n\n    case SeverityCodes.NOTICE:\n      return 'NOTICE';\n\n    case SeverityCodes.INFO:\n      return 'INFO';\n\n    case SeverityCodes.DEBUG:\n      return 'DEBUG';\n\n    case SeverityCodes.DEFAULT:\n    default:\n      return 'DEFAULT';\n  }\n}\nexport interface BaseLogEntry extends CoreObject {\n  severity: Severity;\n  message?: string;\n}\n\nexport interface GenericLogEntry extends BaseLogEntry {\n  severity: 'INFO' | 'DEBUG' | 'DEFAULT';\n  message: string;\n}\n\nexport interface NormalizedLogEntry extends BaseLogEntry {\n  severityCode: number;\n  timestamp: Date; // ISO 8601 string\n  logId: string;\n\n  t_denoVersion: string;\n  t_v8Version: string;\n  t_tsVersion: string;\n  // Hostname\n  t_hostname: string;\n  // OS Process ID\n  t_pid: number;\n  // OS Build information\n  t_osBuild: ReadonlyJSONObject;\n  // The main module that was executed, if available\n  t_mainUrl: string;\n  // Path to executable (deno/packaged)\n  t_execPath: string;\n}\n\nexport function normalizeLogEntry<T extends BaseLogEntry = BaseLogEntry>(\n  e: T\n): NormalizedLogEntry {\n  const res: NormalizedLogEntry = e as unknown as NormalizedLogEntry;\n  res.severityCode = SeverityCodes[e.severity];\n  res.timestamp = new Date();\n  res.logId = uniqueId();\n  res.t_denoVersion = Deno.version.deno;\n  res.t_v8Version = Deno.version.v8;\n  res.t_tsVersion = Deno.version.typescript;\n  res.t_hostname = Deno.hostname();\n  res.t_pid = Deno.pid;\n  res.t_osBuild = Deno.build;\n  res.t_mainUrl = Deno.mainModule;\n  res.t_execPath = Deno.execPath();\n  for (const field of Object.keys(res)) {\n    if (typeof res[field] === 'undefined') {\n      delete res[field];\n    }\n  }\n  return res as NormalizedLogEntry;\n}\n\nfunction uniqueId(length = 20): string {\n  // Alphanumeric characters\n  const chars =\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  let autoId = '';\n  for (let i = 0; i < length; i++) {\n    autoId += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return autoId;\n}\n", "import {\n  join as joinPath,\n  resolve as resolvePath,\n} from 'https://deno.land/std@0.160.0/path/mod.ts';\nimport {\n  NormalizedLogEntry,\n  Severity,\n  SeverityCodes,\n  SeverityFromCode,\n} from './entry.ts';\n\nconst kLogFileExpirationMs = 60 * 60 * 1000; // 1 hr\nconst kLogFileMaxSizeBytes = 1024 * 1024 * 100; // 1MB\n\nexport interface LogStream {\n  appendEntry(e: NormalizedLogEntry): void;\n}\n\nexport class ConsoleLogStream implements LogStream {\n  severity: Severity;\n  constructor(severity: Severity | number = 'DEFAULT') {\n    this.severity =\n      typeof severity === 'number' ? SeverityFromCode(severity) : severity;\n  }\n\n  appendEntry(e: NormalizedLogEntry): void {\n    let textLog = `[${e.timestamp.toISOString()}] `;\n    if (typeof e.message === 'string') {\n      textLog += e.message + ': ';\n    }\n    textLog += JSON.stringify(e, null, 2);\n    switch (e.severity as Severity) {\n      case 'EMERGENCY':\n      case 'ALERT':\n      case 'CRITICAL':\n      case 'ERROR':\n        console.error(textLog);\n        throw new Error(textLog);\n\n      case 'WARNING':\n      case 'NOTICE':\n        console.warn(textLog);\n        break;\n\n      case 'INFO':\n      case 'DEFAULT':\n        console.log(textLog);\n        break;\n\n      case 'DEBUG':\n        console.debug(textLog);\n        break;\n    }\n  }\n}\n\nexport class FileLogStream implements LogStream {\n  private readonly _dirPath: string;\n  private _file: Deno.FsFile;\n  private _pendingWritePromise: Promise<void>;\n  private _fileOpenTs: number;\n\n  constructor(outDirPath: string) {\n    this._dirPath = outDirPath;\n    this._file = openNewLogFile(this._dirPath);\n    this._fileOpenTs = Date.now();\n    this._pendingWritePromise = Promise.resolve();\n  }\n\n  appendEntry(e: NormalizedLogEntry): void {\n    this.scheduleWriteJob(() => this.writeLogEntry(e));\n  }\n\n  private scheduleWriteJob(job: () => Promise<void>): void {\n    this._pendingWritePromise\n      .finally(() => job())\n      .finally(() => (this._pendingWritePromise = Promise.resolve()));\n  }\n\n  private async writeLogEntry(e: NormalizedLogEntry): Promise<void> {\n    // Once in a while check if we need to close the current log file and open\n    // a new one.\n    if (\n      Date.now() - this._fileOpenTs >= kLogFileExpirationMs ||\n      randomInt(0, 100) === 0\n    ) {\n      await this.closeLogFileIfNeeded();\n    }\n\n    // Actually write the file\n    const bytesToWrite = new TextEncoder().encode(JSON.stringify(e));\n    let file = this._file;\n    let bytesWritten = 0;\n    do {\n      // Since we write our log in chunks (potentially), this loop may be\n      // paused while the current file is being closed and a new one is opened.\n      // If this happens we just write everything from the start again to the\n      // new log file. Entries have unique ids so readers can ignore double\n      // entries.\n      if (this._file !== file) {\n        bytesWritten = 0;\n        file = this._file;\n      }\n      bytesWritten += await file.write(bytesToWrite.subarray(bytesWritten));\n    } while (bytesWritten < bytesToWrite.length);\n  }\n\n  private async closeLogFileIfNeeded(): Promise<void> {\n    const file = this._file;\n    const fileInfo = await file.stat();\n    if (this._file !== file) {\n      return;\n    }\n    const creationTime = Math.min(\n      fileInfo.birthtime?.getTime() || 0,\n      this._fileOpenTs\n    );\n    if (\n      Date.now() - creationTime >= kLogFileExpirationMs ||\n      fileInfo.size >= kLogFileMaxSizeBytes\n    ) {\n      this._file.close();\n      this._file = openNewLogFile(this._dirPath);\n      this._fileOpenTs = Date.now();\n    }\n  }\n\n  close(): void {\n    this.scheduleWriteJob(() => {\n      this._file.close();\n      return Promise.resolve();\n    });\n  }\n}\n\nfunction openNewLogFile(dirPath: string): Deno.FsFile {\n  const fileName = `${new Date().getTime()}-${Deno.pid}.jsonl`;\n  return Deno.openSync(joinPath(resolvePath(dirPath), fileName), {\n    append: true,\n    createNew: true,\n  });\n}\n\n// min - inclusive, max - exclusive\n// See https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/random#Getting_a_random_integer_between_two_values\nexport function randomInt(min: number, max: number): number {\n  if (min === max) return min;\n\n  min = Math.ceil(min);\n  max = Math.floor(max);\n  return Math.floor(Math.random() * (max - min)) + min;\n}\n", "import {\n  LogEntryDeveloperError,\n  OperationalErrorLogEntry,\n  SystemErrorLogEntry,\n} from './errors.ts';\nimport { GenericLogEntry, normalizeLogEntry, SeverityCodes } from './entry.ts';\nimport { ConsoleLogStream, LogStream } from './stream.ts';\nimport { MetricLogEntry } from './metrics.ts';\nimport { ClientEventEntry } from './client-events.ts';\n\nexport type LogEntry =\n  | GenericLogEntry\n  | LogEntryDeveloperError\n  | OperationalErrorLogEntry\n  | SystemErrorLogEntry\n  | MetricLogEntry\n  | ClientEventEntry;\n\n// TODO: Capture anonymous logs on client and sync them with the server\nconst kDefaultLoggerStreams = [new ConsoleLogStream()];\n\nlet gLogStreams: LogStream[] = kDefaultLoggerStreams;\n\nlet gLogLevel = SeverityCodes.DEFAULT;\n\nexport function setGlobalLoggerStreams(streams: LogStream[]): void {\n  gLogStreams = streams;\n}\n\nexport function resetGlobalLoggerStreams(): void {\n  gLogStreams = kDefaultLoggerStreams;\n}\n\nexport function log(entry: LogEntry, outputStreams = gLogStreams): void {\n  if (SeverityCodes[entry.severity] >= gLogLevel) {\n    const e = normalizeLogEntry(entry);\n    for (const stream of outputStreams) {\n      stream.appendEntry(e);\n    }\n  }\n}\n\nexport interface Logger {\n  log(entry: LogEntry): void;\n}\n\nexport function newLogger(outputStreams: LogStream[]): Logger {\n  return {\n    log(entry: LogEntry): void {\n      log(entry, outputStreams);\n    },\n  };\n}\n\nexport const GlobalLogger = {\n  log(entry: LogEntry): void {\n    log(entry, gLogStreams);\n  },\n};\n", "import { log } from '../logging/log.ts';\n\nexport function notImplemented(): never {\n  const error = new Error('Not Implemented');\n  log({ severity: 'ERROR', error: 'NotImplemented', trace: error.stack });\n  throw error;\n}\n\nexport function notReached(msg?: string): never {\n  const error = new Error(msg);\n  log({\n    severity: 'ERROR',\n    error: 'NotReached',\n    message: msg,\n    trace: error.stack,\n  });\n  throw error;\n}\n\nexport function assert(\n  condition: boolean,\n  msg = 'Failed assertion'\n): asserts condition {\n  if (!condition) {\n    const error = new Error('Failed Assertion');\n    log({\n      severity: 'ERROR',\n      error: 'FailedAssertion',\n      message: msg,\n      trace: error.stack,\n    });\n    throw error;\n  }\n}\n", "export interface NumberAggregator {\n  get currentValue(): number;\n  addValue(v: number): void;\n}\n\nexport function avg(values: Iterable<number>): number {\n  let result = 0;\n  let count = 0;\n  for (const v of values) {\n    result += v;\n    ++count;\n  }\n  return count === 0 ? 0 : result / count;\n}\n\nexport class MovingAverage implements NumberAggregator {\n  private readonly _readingsCount: number;\n  private _values: number[];\n\n  constructor(readingsCount: number) {\n    this._readingsCount = readingsCount;\n    this._values = [];\n  }\n\n  get currentValue(): number {\n    return avg(this._values);\n  }\n\n  addValue(v: number): void {\n    const values = this._values;\n    if (values.length >= this._readingsCount) {\n      values.shift();\n    }\n    values.push(v);\n  }\n}\n\n// min - inclusive, max - exclusive\n// See https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/random#Getting_a_random_integer_between_two_values\nexport function randomInt(min: number, max: number): number {\n  if (min === max) return min;\n\n  min = Math.ceil(min);\n  max = Math.floor(max);\n  return Math.floor(Math.random() * (max - min)) + min;\n}\n", "import { randomInt } from './math.ts';\n\nexport function equal<T>(\n  arr1: T[],\n  arr2: T[],\n  comparator?: (a: T, b: T) => boolean\n) {\n  if (!!arr1 != !!arr2) {\n    return false;\n  }\n  if (arr1 === null || arr1 === undefined) {\n    return true;\n  }\n  if (arr1.length !== arr2.length) {\n    return false;\n  }\n  for (let i = 0; i < arr1.length; ++i) {\n    if (comparator) {\n      if (!comparator(arr1[i], arr2[i])) {\n        return false;\n      }\n    } else if (arr1[i] !== arr2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function append<T>(arr: T[], values: Iterable<T>): T[] {\n  for (const v of values) {\n    arr.push(v);\n  }\n  return arr;\n}\n\nexport function* iter<T>(arr: T[]) {\n  const len = arr.length;\n  for (let idx = 0; idx < len; ++idx) {\n    yield [idx, arr[idx]];\n  }\n}\n\nexport function lastValue<T>(arr: T[] | undefined): T | undefined {\n  if (!arr) {\n    return undefined;\n  }\n  return arr[arr.length - 1];\n}\n\nexport function* concatIter() {\n  const len = arguments.length;\n  for (let i = 0; i < len; ++i) {\n    const arr = arguments[i];\n    for (const v of arr) {\n      yield v;\n    }\n  }\n}\n\n// Fisher\u2013Yates shuffle.\n// See https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\nexport function shuffle<T>(arr: T[]): T[] {\n  if (!arr) {\n    return arr;\n  }\n  const len = arr.length;\n  for (let i = len - 1; i > 0; --i) {\n    const j = randomInt(0, i + 1);\n    const tmp = arr[i];\n    arr[i] = arr[j];\n    arr[j] = tmp;\n  }\n  return arr;\n}\n\nexport function* slices<T>(\n  values: T[] | Iterable<T>,\n  size: number\n): Generator<T[], void, void> {\n  if (values instanceof Array) {\n    for (let i = 0; i < values.length; i += size) {\n      yield values.slice(i, i + size);\n    }\n  } else {\n    let slice: T[] = [];\n    for (const v of values) {\n      slice.push(v);\n      if (slice.length >= size) {\n        yield slice;\n        slice = [];\n      }\n    }\n    if (slice.length > 0) {\n      yield slice;\n    }\n  }\n}\n\nexport function anyArrayIntersection<T1, T2>(\n  arr1: T1[],\n  arr2: T2[],\n  eq: (i1: T1, i2: T2) => boolean = (i1, i2) => (i1 as any) === (i2 as any)\n) {\n  for (const i1 of arr1) {\n    for (const i2 of arr2) {\n      if (eq(i1, i2)) {\n        return true;\n      }\n    }\n  }\n  return false;\n}\n\nexport function anyDuplicates<T>(arr: T[], eq?: (i1: T, i2: T) => boolean) {\n  if (!eq) {\n    //use set\n    const set = new Set<T>(arr);\n    return set.size < arr.length;\n  }\n\n  //using eq function\n  for (let i = 0; i < arr.length; i++) {\n    for (let j = 1; j < arr.length; j++) {\n      if (eq(arr[i], arr[j])) {\n        return true;\n      }\n    }\n  }\n  return false;\n}\n", "import * as ArrayUtils from './array.ts';\n\nexport function shallowEqual(a: any, b: any): boolean {\n  if (a === b) {\n    return true;\n  }\n\n  if (!a || !b) {\n    if (!a && !b) {\n      return true;\n    }\n    return false;\n  }\n\n  for (let key of Object.keys(a)) {\n    if (a[key] !== b[key]) {\n      return false;\n    }\n  }\n\n  for (let key of Object.keys(b)) {\n    if (a[key] !== b[key]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nexport function numbersEqual(n1: number, n2: number): boolean {\n  return Math.abs(n1 - n2) < Number.EPSILON;\n}\n\nexport function mapsEqual<K, V>(m1: Map<K, V>, m2: Map<K, V>): boolean {\n  if (m1 === m2) {\n    return true;\n  }\n  if (Boolean(m1) !== Boolean(m2)) {\n    return false;\n  }\n  if (!m1) {\n    return true;\n  }\n  if (m1.size !== m2.size) {\n    return false;\n  }\n  for (const [key, value] of m1) {\n    if (!deepEqual(value, m2.get(key))) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function objectsEqual(obj1: any, obj2: any): boolean {\n  if (obj1 === obj2) {\n    return true;\n  }\n\n  if (!obj1 !== !obj2) {\n    return false;\n  }\n  if (!obj1) {\n    return true;\n  }\n\n  const keys1 = Object.keys(obj1);\n  const keys2 = Object.keys(obj2);\n  if (keys1.length !== keys2.length) {\n    return false;\n  }\n\n  for (const k of keys1) {\n    if (!deepEqual(obj1[k], obj2[k])) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nexport function setsEqual<T>(s1: Set<T>, s2: Set<T>): boolean {\n  if (Boolean(s1) !== Boolean(s2)) {\n    return false;\n  }\n  if (s1.size !== s2.size) {\n    return false;\n  }\n  const s2Copy = new Set(s2);\n  for (const v1 of s1) {\n    let match = undefined;\n    for (const v2 of s2Copy) {\n      if (deepEqual(v1, v2)) {\n        match = v2;\n        break;\n      }\n    }\n    // No match found. Exit early\n    if (match === undefined) {\n      return false;\n    } else {\n      // Match found. Skip it in the next iteration\n      s2Copy.delete(match);\n    }\n  }\n  return true;\n}\n\nexport function deepEqual(a: any, b: any): boolean {\n  if (a === b) {\n    return true;\n  }\n\n  if (!a || !b) {\n    if (!a && !b) {\n      return true;\n    }\n    return false;\n  }\n\n  if (isNumber(a) && isNumber(b)) {\n    return numbersEqual(a, b);\n  }\n\n  if (isMapLike(a) && isMapLike(b)) {\n    return mapsEqual(a, b);\n  }\n\n  if (isArray(a) && isArray(b)) {\n    return ArrayUtils.equal(a, b, (x, y) => deepEqual(x, y));\n  }\n\n  if (isObject(a) && isObject(b)) {\n    return objectsEqual(a, b);\n  }\n\n  if (a instanceof Set && b instanceof Set) {\n    return setsEqual(a, b);\n  }\n\n  return false;\n}\n\nexport function isMapLike(v: any): boolean {\n  return v instanceof Map || Boolean(v.__IS_MAP_OBJ);\n}\n\nexport function isString(v: any): v is string {\n  return typeof v === 'string' || v instanceof String;\n}\n\nexport function isNumber(v: any): v is number {\n  return typeof v === 'number' || v instanceof Number;\n}\n\nexport function isObject(v: any): v is any {\n  return (\n    v &&\n    typeof v === 'object' &&\n    Object.getPrototypeOf(v).constructor === Object\n  );\n}\n\nexport function isArray<T>(v: any): v is T[] {\n  return v instanceof Array;\n}\n\nexport function isBoolean(v: any): v is boolean {\n  return v === true || v === false;\n}\n\nexport function isUndefined<T>(v: T | undefined): v is undefined {\n  return typeof v === 'undefined';\n}\n\nexport function isDefined<T>(v: T): boolean {\n  return !isUndefined(v);\n}\n\nexport function isNoValue(v: any): v is null | undefined {\n  return v === null || isUndefined(v);\n}\n\nexport function isImmutable(v: any): boolean {\n  return isString(v) || isNumber(v) || isBoolean(v) || isNoValue(v);\n}\n\nexport function isFunction(v: any): v is Function {\n  return typeof v === 'function';\n}\n\nexport function isEmptyObject(obj: any): boolean {\n  for (const k in obj) {\n    if (obj.hasOwnProperty(k)) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function isGenerator<T = unknown, TReturn = any, TNext = unknown>(\n  obj: any\n): obj is Generator<T, TReturn, TNext> {\n  return (\n    !isNoValue(obj) &&\n    typeof obj.next === 'function' &&\n    typeof obj.throw === 'function' &&\n    typeof obj.return === 'function'\n  );\n}\n", "import { Dictionary } from '../collections/dict.ts';\n\nexport type ReadonlyCoreObject = {\n  readonly [key: string]: CoreValue;\n};\n\nexport interface CoreObject<T extends CoreValue = CoreValue> {\n  [key: string]: T;\n}\n\nexport type ReadonlyCoreArray = readonly CoreValue[];\n\nexport type CoreArray = CoreValue[];\n\nexport type CoreSet = Set<CoreValue>;\n\nexport type CoreKey = keyof ReadonlyCoreObject & string;\n\nexport type CoreDictionary = Dictionary<CoreKey, CoreValue>;\n\nexport type ConcreteCoreValue =\n  | string\n  | number\n  | boolean\n  | null\n  | Date\n  | CoreArray\n  | CoreObject\n  | Set<ConcreteCoreValue>\n  | Dictionary<CoreKey, ConcreteCoreValue>\n  | Generator<ConcreteCoreValue>\n  | CoreClassObject\n  | ReadonlyCoreArray\n  | ReadonlyCoreObject;\n\nexport type CoreValue =\n  | undefined\n  | ConcreteCoreValue\n  | CoreSet\n  | CoreDictionary\n  | Generator<CoreValue>;\n\nexport enum CoreType {\n  String,\n  Number,\n  Boolean,\n  Null,\n  Date,\n  Array,\n  Object,\n  Set,\n  Dictionary,\n  Undefined,\n  Generator,\n  ClassObject,\n}\n\nexport type CoreClassObject = Comparable | Clonable | Equatable | Encodable;\n\nexport type ObjFieldsFilterFunc = (\n  key: string,\n  obj: ReadonlyCoreObject\n) => boolean;\n\nexport type IterableFilterFunc = (value: CoreValue) => boolean;\n\nexport interface CoreOptions {\n  objectFilterFields?: ObjFieldsFilterFunc;\n  iterableFilter?: IterableFilterFunc;\n}\n\nexport interface Comparable<T = unknown> {\n  compare(other: T): number;\n}\n\nexport interface Equatable<T = unknown> {\n  isEqual(other: T): boolean;\n}\n\nexport interface Clonable<T = unknown> {\n  clone(opts?: CoreValueCloneOpts): T;\n}\n\nexport interface CoreValueCloneOpts extends CoreOptions {\n  fieldCloneOverride?: (\n    obj: ReadonlyCoreObject | CoreDictionary,\n    key: string,\n    opts?: CoreValueCloneOpts\n  ) => CoreValue;\n  objectOverride?: (obj: CoreValue) => [boolean, CoreValue];\n  notClonableExt?: <T extends Object>(obj: T) => T | undefined;\n}\n\nexport interface Encoder<\n  K = CoreKey,\n  V = CoreValue,\n  T = CoreValue,\n  OT = unknown\n> {\n  set(key: K, value: V, options?: OT): void;\n  getOutput(): T;\n  newEncoder(): Encoder<K, V, T, OT>;\n}\n\nexport interface Encodable<\n  K = CoreKey,\n  V = CoreValue,\n  T = CoreValue,\n  OT = unknown\n> {\n  serialize(encoder: Encoder<K, V, T>, options?: OT): void;\n}\n", "import { Dictionary } from './dict.ts';\n\nexport interface HashFunction<V> {\n  (value: V): string;\n}\n\nexport interface EqualFunction<V> {\n  (v1: V, v2: V): boolean;\n}\n\nexport interface CloneFunction<V> {\n  (v: V): V;\n}\n\nfunction _noClone<T>(v: T): T {\n  return v;\n}\n\nexport class HashSet<V> implements Iterable<V> {\n  private readonly _map: Map<string, V[]>;\n  private readonly _hashFunc: HashFunction<V>;\n  private readonly _equalFunc: EqualFunction<V>;\n  private readonly _cloneFunc: CloneFunction<V>;\n\n  constructor(\n    hash: HashFunction<V>,\n    eq: EqualFunction<V>,\n    clone?: CloneFunction<V>\n  ) {\n    this._map = new Map();\n    this._hashFunc = hash;\n    this._equalFunc = eq;\n    this._cloneFunc = clone || _noClone;\n  }\n\n  get size(): number {\n    return this._map.size;\n  }\n\n  add(v: V): boolean {\n    const key = this._hashFunc(v);\n    const map = this._map;\n    let values = map.get(key);\n\n    // No entry for this hash. Create it and insert.\n    if (values === undefined) {\n      values = [this._cloneFunc(v)];\n      map.set(key, values);\n      return true;\n    }\n\n    // Entry exists. Check if v already exists\n    const eq = this._equalFunc;\n    for (let candidate of values) {\n      if (eq(candidate, v)) {\n        return false;\n      }\n    }\n\n    // If we got this far, v doesn't exist in the current list of values\n    values.push(this._cloneFunc(v));\n    return true;\n  }\n\n  delete(v: V): boolean {\n    const key = this._hashFunc(v);\n    const map = this._map;\n    const values = map.get(key);\n\n    // Nothing to do if entry doesn't exist\n    if (values === undefined) {\n      return false;\n    }\n\n    // Search for an equal value\n    const eq = this._equalFunc;\n    const len = values.length;\n    for (let i = 0; i < len; ++i) {\n      if (eq(values[i], v)) {\n        if (values.length === 1) {\n          map.delete(key);\n        } else {\n          values.splice(i, 1);\n        }\n        return true;\n      }\n    }\n\n    // No match found\n    return false;\n  }\n\n  clear(): void {\n    this._map.clear();\n  }\n\n  get(v: V): V | undefined {\n    const key = this._hashFunc(v);\n    const map = this._map;\n    const values = map.get(key);\n\n    // Entry doesn't exist\n    if (values === undefined) {\n      return undefined;\n    }\n\n    // Entry exists. Search for a matching value.\n    const eq = this._equalFunc;\n    for (let candidate of values) {\n      if (eq(candidate, v)) {\n        return candidate;\n      }\n    }\n\n    // No match found\n    return undefined;\n  }\n\n  has(v: V): boolean {\n    const key = this._hashFunc(v);\n    const map = this._map;\n    const values = map.get(key);\n\n    // Entry doesn't exist\n    if (values === undefined) {\n      return false;\n    }\n\n    // Entry exists. Search for a matching value.\n    const eq = this._equalFunc;\n    for (let candidate of values) {\n      if (eq(candidate, v)) {\n        return true;\n      }\n    }\n\n    // No match found\n    return false;\n  }\n\n  *values(): Generator<V> {\n    for (const arr of this._map.values()) {\n      for (const v of arr) {\n        // Guard against mutations during iteration\n        if (this.has(v)) {\n          yield v;\n        }\n      }\n    }\n  }\n\n  [Symbol.iterator](): Iterator<V> {\n    return this.values();\n  }\n}\n\ninterface MapEntry<K, V> {\n  key: K;\n  value?: V;\n}\n\nexport class HashMap<K = any, V = any> implements Dictionary<K, V> {\n  private _set: HashSet<MapEntry<K, V>>;\n\n  constructor(\n    hash: HashFunction<K>,\n    eq: EqualFunction<K>,\n    clone?: CloneFunction<K>\n  ) {\n    let entryClone: CloneFunction<MapEntry<K, V>> | undefined;\n    if (clone !== undefined) {\n      entryClone = (entry) => {\n        const result: MapEntry<K, V> = { key: clone(entry.key) };\n        if (entry.value !== undefined) {\n          result.value = entry.value;\n        }\n        return result;\n      };\n    }\n    this._set = new HashSet(\n      (entry) => hash(entry.key),\n      (e1, e2) => eq(e1.key, e2.key),\n      entryClone\n    );\n  }\n\n  get size(): number {\n    return this._set.size;\n  }\n\n  get(key: K): V | undefined {\n    return this._set.get({ key })?.value;\n  }\n\n  has(key: K): boolean {\n    return this._set.has({ key });\n  }\n\n  *entries(): Generator<[K, V]> {\n    for (const e of this._set) {\n      yield [e.key, e.value!];\n    }\n  }\n\n  *keys(): Generator<K> {\n    for (const e of this._set) {\n      yield e.key;\n    }\n  }\n\n  *values(): Generator<V> {\n    for (const e of this._set) {\n      yield e.value!;\n    }\n  }\n\n  [Symbol.iterator](): Iterator<[K, V]> {\n    return this.entries();\n  }\n\n  set(key: K, value: V): void {\n    let e = this._set.get({ key });\n    if (e === undefined) {\n      e = { key, value };\n      this._set.add(e);\n    } else {\n      e.value = value;\n    }\n  }\n\n  delete(key: K): boolean {\n    return this._set.delete({ key });\n  }\n\n  clear(): void {\n    this._set.clear();\n  }\n}\n", "import { HashMap } from './hash-map.ts';\n\nexport interface ReadonlyDict<K = any, V = any> extends Iterable<[K, V]> {\n  readonly size: number;\n  get(key: K): V | undefined;\n  has(key: K): boolean;\n\n  entries(): Iterable<[K, V]>;\n  keys(): Iterable<K>;\n  values(): Iterable<V>;\n}\n\nexport interface Dictionary<K = any, V = any> extends ReadonlyDict<K, V> {\n  set(key: K, value: V): void;\n  delete(key: K): boolean;\n  clear(): void;\n}\n\nexport interface PrimitiveMap<T = any> {\n  [k: string]: T;\n}\n\nexport function dictToPrimitive<K, T>(\n  map: Dictionary<K, T> | undefined\n): PrimitiveMap {\n  const result: PrimitiveMap = {};\n  if (map === undefined || map.size <= 0) {\n    return result;\n  }\n  for (const k of map.keys()) {\n    result[String(k)] = map.get(k);\n  }\n  return result;\n}\n\nexport function dictFromPrimitive<T>(\n  map: PrimitiveMap<T>\n): Dictionary<string, T> {\n  return new Map(Object.entries(map));\n}\n\nexport function dictEquals<K, T>(\n  dic1: Dictionary<K, T>,\n  dic2: Dictionary<K, T>,\n  comparer: (v1: T, v2: T) => boolean = (v1, v2) => v1 === v2\n) {\n  if (dic1.size !== dic2.size) return false;\n\n  for (const [key, value1] of dic1) {\n    const value2 = dic2.get(key);\n    if (value2 === undefined) {\n      return false;\n    }\n\n    if (!comparer(value1, value2)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nexport function isDictionary<K, V>(val: any): val is Dictionary<K, V> {\n  return val instanceof Map || val instanceof HashMap;\n}\n", "import { isGenerator } from '../comparisons.ts';\nimport { notReached } from '../error.ts';\nimport { isDictionary } from '../collections/dict.ts';\nimport {\n  Clonable,\n  Comparable,\n  CoreClassObject,\n  CoreType,\n  CoreValue,\n  Encodable,\n  Equatable,\n  ReadonlyCoreObject,\n} from './base.ts';\n\nexport function getCoreTypeOrUndef(value: any): CoreType | undefined {\n  if (value === undefined) {\n    return CoreType.Undefined;\n  }\n\n  if (value === null) {\n    return CoreType.Null;\n  }\n\n  if (typeof value === 'string') {\n    return CoreType.String;\n  }\n\n  if (typeof value === 'number') {\n    return CoreType.Number;\n  }\n\n  if (typeof value === 'boolean') {\n    return CoreType.Boolean;\n  }\n\n  if (value instanceof Date) {\n    return CoreType.Date;\n  }\n\n  if (value instanceof Array) {\n    return CoreType.Array;\n  }\n\n  if (value instanceof Set) {\n    return CoreType.Set;\n  }\n\n  if (isDictionary(value)) {\n    return CoreType.Dictionary;\n  }\n\n  if (isGenerator(value)) {\n    return CoreType.Generator;\n  }\n\n  if (typeof value === 'object') {\n    return Object.getPrototypeOf(value).constructor === Object\n      ? CoreType.Object\n      : CoreType.ClassObject;\n  }\n}\n\nexport function getCoreType(value: CoreValue): CoreType {\n  const type = getCoreTypeOrUndef(value);\n  return type !== undefined ? type : notReached('Unsupported value type');\n}\n\nexport function isCoreClassObject(v: any): v is CoreClassObject {\n  return isClonable(v) || isComparable(v) || isEquatable(v) || isEncodable(v);\n}\n\nexport function isClonable(v: any): v is Clonable {\n  return v !== undefined && typeof v.clone === 'function';\n}\n\nexport function isComparable(v: any): v is Comparable {\n  return v !== undefined && typeof v.compareTo === 'function';\n}\n\nexport function isEquatable(v: any): v is Equatable {\n  return v !== undefined && typeof v.isEqual === 'function';\n}\n\nexport function isEncodable<T extends Encodable<any, any>>(v: any): v is T {\n  if (v === undefined) {\n    return false;\n  }\n  return v.serialize !== undefined;\n}\n\nexport function isReadonlyCoreObject(v: any): v is ReadonlyCoreObject {\n  return getCoreTypeOrUndef(v) === CoreType.Object;\n}\n", "import { notReached } from '../error.ts';\nimport { Dictionary } from '../collections/dict.ts';\nimport {\n  CoreKey,\n  CoreObject,\n  CoreType,\n  CoreValue,\n  CoreValueCloneOpts,\n  ReadonlyCoreArray,\n} from './base.ts';\nimport { getCoreType, isClonable } from './utils.ts';\n\nexport function coreValueClone<T extends CoreValue>(\n  e: T,\n  opts?: CoreValueCloneOpts\n): T {\n  return internalCoreValueClone(e, undefined, opts);\n}\n\nexport function coreObjectClone<T extends Object>(\n  obj: T,\n  opts?: CoreValueCloneOpts\n) {\n  return internalCoreValueClone(obj as any, undefined, opts);\n}\n\nfunction internalCoreValueClone<T extends CoreValue>(\n  e: T,\n  objectsCache: Map<CoreObject, CoreObject> | undefined,\n  opts?: CoreValueCloneOpts\n): T {\n  switch (getCoreType(e)) {\n    case CoreType.String:\n    case CoreType.Number:\n    case CoreType.Boolean:\n    case CoreType.Null:\n    case CoreType.Undefined:\n      return e;\n\n    case CoreType.Date:\n      return new Date((e as Date).getTime()) as T;\n\n    case CoreType.Array: {\n      let arr = e as ReadonlyCoreArray;\n      if (opts !== undefined && opts.iterableFilter !== undefined) {\n        arr = arr.filter(opts.iterableFilter);\n      }\n      return arr.map((v) => internalCoreValueClone(v, objectsCache, opts)) as T;\n    }\n\n    case CoreType.Set: {\n      const set = e as Set<CoreValue>;\n      const result = new Set<CoreValue>();\n      for (const v of set) {\n        if (opts !== undefined && opts.iterableFilter !== undefined) {\n          if (!opts.iterableFilter(v)) continue;\n        }\n        result.add(internalCoreValueClone(v, objectsCache, opts));\n      }\n      return result as T;\n    }\n\n    case CoreType.Object: {\n      if (objectsCache === undefined)\n        objectsCache = new Map<CoreObject, CoreObject>();\n      const obj = e as { [key: string]: CoreValue };\n      const cached = objectsCache.get(obj);\n      if (cached !== undefined) return cached as T;\n\n      if (opts && opts.objectOverride) {\n        const [result, newObj] = opts.objectOverride(obj);\n        if (result) {\n          objectsCache.set(obj, newObj as CoreObject);\n          return newObj as T;\n        }\n      }\n\n      const result: { [key: string]: CoreValue } = {};\n      for (const k in obj) {\n        if (\n          obj.hasOwnProperty(k) &&\n          (opts === undefined ||\n            opts.objectFilterFields === undefined ||\n            opts.objectFilterFields(k, obj))\n        ) {\n          if (opts !== undefined && opts.fieldCloneOverride !== undefined) {\n            result[k] = opts.fieldCloneOverride(obj, k, opts);\n          } else {\n            result[k] = internalCoreValueClone(obj[k], objectsCache, opts);\n          }\n        }\n      }\n\n      objectsCache.set(obj, result);\n\n      return result as T;\n    }\n\n    case CoreType.Dictionary: {\n      const newMap = new Map<CoreKey, CoreValue>();\n      for (const [k, v] of e as Dictionary<CoreKey, CoreValue>) {\n        if (opts !== undefined && opts.fieldCloneOverride !== undefined) {\n          newMap.set(k, opts.fieldCloneOverride(e as Dictionary, k, opts));\n        } else {\n          newMap.set(k, internalCoreValueClone(v, objectsCache, opts));\n        }\n      }\n      return newMap as unknown as T;\n    }\n\n    case CoreType.Generator: {\n      const arr: CoreValue[] = [];\n      for (const item of e as Generator<CoreValue>) {\n        if (opts !== undefined && opts.iterableFilter !== undefined) {\n          if (opts.iterableFilter(item)) {\n            arr.push(internalCoreValueClone(item, objectsCache, opts));\n          }\n        } else {\n          arr.push(internalCoreValueClone(item, objectsCache, opts));\n        }\n      }\n\n      return arr as T;\n    }\n\n    case CoreType.ClassObject:\n      if (isClonable(e)) {\n        return e.clone(opts) as T;\n      }\n      if (opts && opts.notClonableExt) {\n        const fRes = opts.notClonableExt(e as Object);\n        if (fRes !== undefined) return fRes as T;\n      }\n      throw new Error(`${e?.constructor.name} must be Clonable`);\n\n    default:\n      notReached('clone failed');\n  }\n}\n", "import { randomInt } from './math.ts';\n\n/**\n * JS Implementation of MurmurHash2\n *\n * @author <a href=\"mailto:gary.court@gmail.com\">Gary Court</a>\n * @see http://github.com/garycourt/murmurhash-js\n * @author <a href=\"mailto:aappleby@gmail.com\">Austin Appleby</a>\n * @see http://sites.google.com/site/murmurhash/\n *\n * @param {string} str ASCII only\n * @param {number} seed Positive integer only\n * @return {number} 32-bit positive integer hash\n * \n * Modified by Ofri Wolfus: Added TS types.\n * \n * License:\nCopyright (c) 2011 Gary Court\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\nexport function murmurhash2_32_gc(str: string, seed: number): number {\n  let l = str.length,\n    h = seed ^ l,\n    i = 0,\n    k;\n\n  while (l >= 4) {\n    k =\n      (str.charCodeAt(i) & 0xff) |\n      ((str.charCodeAt(++i) & 0xff) << 8) |\n      ((str.charCodeAt(++i) & 0xff) << 16) |\n      ((str.charCodeAt(++i) & 0xff) << 24);\n\n    k =\n      (k & 0xffff) * 0x5bd1e995 + ((((k >>> 16) * 0x5bd1e995) & 0xffff) << 16);\n    k ^= k >>> 24;\n    k =\n      (k & 0xffff) * 0x5bd1e995 + ((((k >>> 16) * 0x5bd1e995) & 0xffff) << 16);\n\n    h =\n      ((h & 0xffff) * 0x5bd1e995 +\n        ((((h >>> 16) * 0x5bd1e995) & 0xffff) << 16)) ^\n      k;\n\n    l -= 4;\n    ++i;\n  }\n\n  switch (l) {\n    case 3:\n      h ^= (str.charCodeAt(i + 2) & 0xff) << 16;\n    case 2:\n      h ^= (str.charCodeAt(i + 1) & 0xff) << 8;\n    case 1:\n      h ^= str.charCodeAt(i) & 0xff;\n      h =\n        (h & 0xffff) * 0x5bd1e995 +\n        ((((h >>> 16) * 0x5bd1e995) & 0xffff) << 16);\n  }\n\n  h ^= h >>> 13;\n  h = (h & 0xffff) * 0x5bd1e995 + ((((h >>> 16) * 0x5bd1e995) & 0xffff) << 16);\n  h ^= h >>> 15;\n\n  return h >>> 0;\n}\n\n/*\nThe MIT License (MIT)\n\nCopyright (c) 2013 Gary Court, Jens Taylor\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of\nthis software and associated documentation files (the \"Software\"), to deal in\nthe Software without restriction, including without limitation the rights to\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\nthe Software, and to permit persons to whom the Software is furnished to do so,\nsubject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\nFOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\nCOPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\nIN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\nCONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n*/\n// https://github.com/jensyt/imurmurhash-js\n// Modified to a TypeScript class by Ofri Wolfus\nexport class MurmurHash3 {\n  private h1: number;\n  private rem: number;\n  private k1: number;\n  private len: number;\n\n  public seed: number;\n\n  constructor(seed?: number) {\n    if (seed === undefined) {\n      seed = randomInt(0, Number.MAX_SAFE_INTEGER);\n    }\n    this.seed = seed!;\n    this.h1 = seed!;\n    this.rem = this.k1 = this.len = 0;\n  }\n\n  /**\n   * Reset the hash object for reuse\n   * @param {number} seed An optional positive integer\n   */\n  reset(seed?: number): MurmurHash3 {\n    if (seed !== undefined) {\n      this.seed = seed;\n    }\n    this.h1 = this.seed;\n    this.rem = this.k1 = this.len = 0;\n    return this;\n  }\n\n  resetSeed(): MurmurHash3 {\n    return this.reset(randomInt(0, Number.MAX_SAFE_INTEGER));\n  }\n\n  /**\n   * Incrementally add a string to this hash\n   *\n   * @param {string} key A UTF-16 or ASCII string\n   * @return {object} this\n   */\n  hash(key: string): MurmurHash3 {\n    let h1, k1, i, top, len;\n\n    len = key.length;\n    this.len += len;\n\n    k1 = this.k1;\n    i = 0;\n    switch (this.rem) {\n      case 0:\n        k1 ^= len > i ? key.charCodeAt(i++) & 0xffff : 0;\n      case 1:\n        k1 ^= len > i ? (key.charCodeAt(i++) & 0xffff) << 8 : 0;\n      case 2:\n        k1 ^= len > i ? (key.charCodeAt(i++) & 0xffff) << 16 : 0;\n      case 3:\n        k1 ^= len > i ? (key.charCodeAt(i) & 0xff) << 24 : 0;\n        k1 ^= len > i ? (key.charCodeAt(i++) & 0xff00) >> 8 : 0;\n    }\n\n    this.rem = (len + this.rem) & 3; // & 3 is same as % 4\n    len -= this.rem;\n    if (len > 0) {\n      h1 = this.h1;\n      while (1) {\n        k1 = (k1 * 0x2d51 + (k1 & 0xffff) * 0xcc9e0000) & 0xffffffff;\n        k1 = (k1 << 15) | (k1 >>> 17);\n        k1 = (k1 * 0x3593 + (k1 & 0xffff) * 0x1b870000) & 0xffffffff;\n\n        h1 ^= k1;\n        h1 = (h1 << 13) | (h1 >>> 19);\n        h1 = (h1 * 5 + 0xe6546b64) & 0xffffffff;\n\n        if (i >= len) {\n          break;\n        }\n\n        k1 =\n          (key.charCodeAt(i++) & 0xffff) ^\n          ((key.charCodeAt(i++) & 0xffff) << 8) ^\n          ((key.charCodeAt(i++) & 0xffff) << 16);\n        top = key.charCodeAt(i++);\n        k1 ^= ((top & 0xff) << 24) ^ ((top & 0xff00) >> 8);\n      }\n\n      k1 = 0;\n      switch (this.rem) {\n        case 3:\n          k1 ^= (key.charCodeAt(i + 2) & 0xffff) << 16;\n        case 2:\n          k1 ^= (key.charCodeAt(i + 1) & 0xffff) << 8;\n        case 1:\n          k1 ^= key.charCodeAt(i) & 0xffff;\n      }\n\n      this.h1 = h1;\n    }\n\n    this.k1 = k1;\n    return this;\n  }\n\n  /**\n   * Get the result of this hash.\n   * @return {number} The 32-bit hash.\n   */\n  result(): number {\n    let k1, h1;\n\n    k1 = this.k1;\n    h1 = this.h1;\n\n    if (k1 > 0) {\n      k1 = (k1 * 0x2d51 + (k1 & 0xffff) * 0xcc9e0000) & 0xffffffff;\n      k1 = (k1 << 15) | (k1 >>> 17);\n      k1 = (k1 * 0x3593 + (k1 & 0xffff) * 0x1b870000) & 0xffffffff;\n      h1 ^= k1;\n    }\n\n    h1 ^= this.len;\n\n    h1 ^= h1 >>> 16;\n    h1 = (h1 * 0xca6b + (h1 & 0xffff) * 0x85eb0000) & 0xffffffff;\n    h1 ^= h1 >>> 13;\n    h1 = (h1 * 0xae35 + (h1 & 0xffff) * 0xc2b20000) & 0xffffffff;\n    h1 ^= h1 >>> 16;\n\n    return h1 >>> 0;\n  }\n}\n\nconst sharedMurmur3 = new MurmurHash3();\n\nexport function murmur3(value: string, seed?: number): number {\n  sharedMurmur3.reset(seed);\n  sharedMurmur3.hash(value);\n  return sharedMurmur3.result();\n}\n", "import { isNumber } from './comparisons.ts';\n\nexport function serializeDate(date: Date): number {\n  if (date instanceof Date) {\n    return date.getTime() / 1000;\n  } else if (isNumber(date)) {\n    return date;\n  }\n  throw new Error('Unsupported date value');\n}\n\nexport function deserializeDate(d: number | string | Date): Date {\n  if (typeof d === 'string') {\n    d = parseFloat(d);\n  }\n  if (typeof d === 'number') {\n    const r = new Date();\n    if (d < 1000000000000) {\n      d *= 1000;\n    }\n    r.setTime(d);\n    return r;\n  } else if (d instanceof Date) {\n    return d;\n  }\n  throw new Error('Unsupported date value');\n}\n\nexport function formatTimeDiff(date: Date) {\n  const now = new Date();\n  const year = date.getFullYear();\n  const month = date.getMonth();\n  const day = date.getDate();\n  if (year === now.getFullYear()) {\n    if (month === now.getMonth()) {\n      const daysDiff = now.getDate() - day;\n      if (daysDiff === 0) {\n        return 'Today';\n      }\n      if (daysDiff === 1) {\n        return 'Yesterday';\n      }\n    }\n  }\n\n  return date.toLocaleDateString(undefined, {\n    dateStyle: 'medium',\n  });\n}\n", "import { isGenerator, isObject } from '../../comparisons.ts';\nimport {\n  JSONArray,\n  JSONObject,\n  JSONValue,\n  ReadonlyJSONArray,\n  ReadonlyJSONObject,\n  ReadonlyJSONValue,\n} from '../../interfaces.ts';\nimport { serializeDate } from '../../date.ts';\nimport {\n  Dictionary,\n  dictToPrimitive,\n  isDictionary,\n} from '../../collections/dict.ts';\nimport {\n  CoreKey,\n  CoreOptions,\n  CoreType,\n  CoreValue,\n  Encodable,\n  Encoder,\n  IterableFilterFunc,\n  ObjFieldsFilterFunc,\n  ReadonlyCoreArray,\n  ReadonlyCoreObject,\n} from '../base.ts';\nimport { getCoreType, isEncodable } from '../utils.ts';\n\nexport abstract class BaseEncoder<\n  PT extends CoreValue,\n  T extends PT,\n  OT extends CoreOptions\n> implements Encoder<string, CoreValue, T, OT>\n{\n  readonly objectFilterFields: ObjFieldsFilterFunc;\n  readonly iterableFilter?: IterableFilterFunc;\n\n  constructor(opts?: OT) {\n    this.objectFilterFields = opts?.objectFilterFields || (() => true);\n    this.iterableFilter = opts?.iterableFilter;\n  }\n\n  abstract getOutput(): T;\n  abstract newEncoder(): BaseEncoder<PT, T, OT>;\n\n  protected abstract setPrimitive(key: string, value: PT, options?: OT): void;\n\n  set(key: CoreKey, value: CoreValue, options?: OT): void {\n    if (value === undefined) {\n      return;\n    }\n\n    this.setPrimitive(\n      this.convertKey(key),\n      this.convertValue(value, options),\n      options\n    );\n  }\n\n  protected abstract isNativeValue(value: CoreValue, options?: OT): value is PT;\n\n  protected convertKey(key: CoreKey): string {\n    return typeof key === 'string' ? key : String(key);\n  }\n\n  convertValue(value: CoreValue, options?: OT): PT {\n    if (this.isNativeValue(value, options)) {\n      return value as PT;\n    }\n\n    const type = getCoreType(value);\n\n    switch (type) {\n      case CoreType.String:\n        return this.convertString(value as string, options);\n\n      case CoreType.Number:\n        return this.convertNumber(value as number, options);\n\n      case CoreType.Boolean:\n        return this.convertBoolean(value as boolean, options);\n\n      case CoreType.Null:\n        return this.convertNull(options);\n\n      case CoreType.Undefined:\n        return this.convertUndefined(options);\n\n      case CoreType.Date:\n        return this.convertDate(value as Date, options);\n\n      case CoreType.Array:\n        return this.convertArray(value as ReadonlyCoreArray, options);\n\n      case CoreType.Set:\n        return this.convertSet(value as Set<CoreValue>, options);\n\n      case CoreType.Object:\n        return this.convertObject(value as ReadonlyCoreObject, options);\n\n      case CoreType.ClassObject:\n        if (isEncodable(value)) {\n          return this.convertEncodable(\n            value as Encodable<CoreKey, CoreValue>,\n            options\n          );\n        }\n        throw new Error(`${value?.constructor.name} must implement Encodable`);\n\n      case CoreType.Dictionary:\n        return this.convertDictionary(\n          value as Dictionary<CoreKey, CoreValue>,\n          options\n        );\n\n      case CoreType.Generator:\n        return this.convertGenerator(value as Generator<CoreValue>, options);\n    }\n  }\n\n  protected abstract convertString(str: string, options?: OT): PT;\n  protected abstract convertNumber(n: number, options?: OT): PT;\n  protected abstract convertBoolean(b: boolean, options?: OT): PT;\n  protected abstract convertNull(options?: OT): PT;\n  protected abstract convertUndefined(options?: OT): PT;\n  protected abstract convertDate(date: Date, options?: OT): PT;\n  protected abstract convertArray(arr: ReadonlyCoreArray, options?: OT): PT;\n  protected abstract convertSet(set: Set<CoreValue>, options?: OT): PT;\n  protected abstract convertObject(obj: ReadonlyCoreObject, options?: OT): PT;\n  protected abstract convertEncodable(\n    value: Encodable<string, CoreValue>,\n    options?: OT\n  ): PT;\n  protected abstract convertDictionary(\n    value: Dictionary<CoreKey, CoreValue>,\n    options?: OT\n  ): PT;\n\n  protected abstract convertGenerator(\n    g: Generator<CoreValue>,\n    options?: OT\n  ): PT;\n}\n\nexport interface EncodedSet extends ReadonlyJSONObject {\n  readonly __t: 'S';\n  readonly __v: ReadonlyJSONArray;\n}\n\nexport interface EncodedDate extends ReadonlyJSONObject {\n  readonly __t: 'D';\n  readonly __v: number;\n}\n\nexport interface EncodedEncodable extends ReadonlyJSONObject {\n  readonly __t: 'E';\n  readonly __v: ReadonlyJSONValue;\n}\n\nexport type EncodedJSONValue = EncodedSet | EncodedDate | EncodedEncodable;\n\nexport function isEncodedSet(v: ReadonlyJSONValue): v is EncodedSet {\n  if (getCoreType(v) === CoreType.Object) {\n    const obj = v as ReadonlyJSONObject;\n    if (obj.__t === 'S' && obj.__v instanceof Array) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function isEncodedDate(v: ReadonlyJSONValue): v is EncodedDate {\n  if (getCoreType(v) === CoreType.Object) {\n    const obj = v as ReadonlyJSONObject;\n    if (obj.__t === 'D' && typeof obj.__v === 'number') {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function isEncodedEncodable(\n  v: ReadonlyJSONValue\n): v is EncodedEncodable {\n  if (getCoreType(v) === CoreType.Object) {\n    const obj = v as ReadonlyJSONObject;\n    if (obj.__t === 'E' && getCoreType(obj.__v) === CoreType.Object) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport abstract class JSONBaseEncoder<\n  T extends ReadonlyJSONValue,\n  OT extends CoreOptions = CoreOptions\n> extends BaseEncoder<ReadonlyJSONValue, T, OT> {\n  abstract getOutput(): T;\n  abstract newEncoder(): JSONBaseEncoder<T, OT>;\n\n  protected abstract setPrimitive(\n    key: string,\n    value: ReadonlyJSONValue,\n    options?: OT\n  ): void;\n\n  set(key: string, value: CoreValue, options?: OT): void {\n    if (value === undefined) {\n      return;\n    }\n    this.setPrimitive(\n      key,\n      this.isNativeValue(value, options)\n        ? value\n        : this.convertValue(value, options),\n      options\n    );\n  }\n\n  protected isNativeValue(\n    value: CoreValue,\n    options?: OT\n  ): value is ReadonlyJSONValue {\n    if (value === undefined || value === null) {\n      return true;\n    }\n\n    const iterableFilter = options?.iterableFilter || this.iterableFilter;\n    if (isEncodable<Encodable<string, CoreValue>>(value)) {\n      // Encodable\n      return false;\n    } else if (value instanceof Array) {\n      // Array\n      for (const v of value) {\n        if (iterableFilter) {\n          if (!iterableFilter(v)) return false;\n        }\n        if (!this.isNativeValue(v, options)) {\n          return false;\n        }\n      }\n    } else if (value instanceof Set) {\n      // Set\n      return false;\n    } else if (value instanceof Date) {\n      // Date\n      return false;\n    } else if (isDictionary(value)) {\n      return false;\n    } else if (isObject(value)) {\n      // Object\n      const obj: ReadonlyCoreObject = value as ReadonlyCoreObject;\n\n      const keyFilter = options?.objectFilterFields || this.objectFilterFields;\n      for (const k in obj) {\n        if (obj.hasOwnProperty(k)) {\n          if (keyFilter && !keyFilter(k, obj)) {\n            return false;\n          }\n          if (!this.isNativeValue(obj[k], options)) {\n            return false;\n          }\n        }\n      }\n    } else if (isGenerator(value)) {\n      return false;\n    }\n    // Everything else\n    return true;\n  }\n\n  protected convertEncodable(\n    value: Encodable<string, CoreValue>,\n    options?: OT\n  ): EncodedEncodable {\n    const encoder = this.newEncoder();\n    value.serialize(encoder, options);\n    return {\n      __t: 'E',\n      __v: encoder.getOutput(),\n    };\n  }\n\n  private convertIterableWithFilter(\n    iterable: Iterable<CoreValue>,\n    iterableFilter: IterableFilterFunc,\n    options?: OT\n  ) {\n    const result: JSONValue[] = [];\n    for (const item of iterable) {\n      if (iterableFilter(item)) {\n        result.push(this.convertValue(item, options));\n      }\n    }\n    return result;\n  }\n\n  protected convertArray(\n    arr: ReadonlyCoreArray,\n    options?: OT\n  ): ReadonlyJSONValue {\n    if (arr.length === 0) {\n      return [];\n    }\n    const iterableFilter = options?.iterableFilter || this.iterableFilter;\n    if (iterableFilter) {\n      return this.convertIterableWithFilter(arr, iterableFilter, options);\n    }\n\n    const result = new Array(arr.length);\n    for (let i = 0; i < arr.length; i++) {\n      result[i] = this.convertValue(arr[i], options);\n    }\n    return result;\n  }\n\n  // Default implementation returns EncodedSet\n  protected convertSet(set: Set<CoreValue>, options?: OT): EncodedSet {\n    const iterableFilter = options?.iterableFilter || this.iterableFilter;\n    if (iterableFilter) {\n      const arr = this.convertIterableWithFilter(set, iterableFilter, options);\n\n      return {\n        __t: 'S',\n        __v: arr as ReadonlyJSONArray,\n      };\n    }\n\n    const arr: JSONArray = new Array(set.size);\n    let i = 0;\n\n    for (const v of set) {\n      arr[i] = this.convertValue(v, options);\n      i++;\n    }\n    return {\n      __t: 'S',\n      __v: arr as ReadonlyJSONArray,\n    };\n  }\n\n  protected convertObject(\n    obj: ReadonlyCoreObject,\n    options?: OT\n  ): ReadonlyJSONObject {\n    const result: JSONObject = {};\n    const keyFilter = options?.objectFilterFields || this.objectFilterFields;\n    for (const [k, v] of Object.entries(obj)) {\n      if (keyFilter(k, obj)) {\n        result[k] = this.convertValue(v, options);\n      }\n    }\n    return result;\n  }\n\n  protected convertNumber(n: number, _options?: OT): ReadonlyJSONValue {\n    return n;\n  }\n\n  protected convertString(str: string, _options?: OT): ReadonlyJSONValue {\n    return str;\n  }\n\n  protected convertBoolean(b: boolean, _options?: OT): ReadonlyJSONValue {\n    return b;\n  }\n\n  protected convertNull(_options?: OT): ReadonlyJSONValue {\n    return null;\n  }\n\n  protected convertUndefined(_options?: OT): ReadonlyJSONValue {\n    return null;\n  }\n\n  protected convertDate(date: Date, _options?: OT): EncodedDate {\n    return {\n      __t: 'D',\n      __v: serializeDate(date),\n    };\n  }\n\n  protected convertDictionary(\n    value: Dictionary<CoreKey, CoreValue>,\n    _options?: OT\n  ) {\n    return dictToPrimitive(value);\n  }\n\n  protected convertGenerator(g: Generator<CoreValue>, options?: OT) {\n    const iterableFilter = options?.iterableFilter || this.iterableFilter;\n    if (iterableFilter) {\n      return this.convertIterableWithFilter(g, iterableFilter, options);\n    }\n\n    const arr: JSONArray = [];\n    for (const v of g) {\n      arr.push(this.convertValue(v, options));\n    }\n    return arr;\n  }\n}\n", "/*\n * jMd5\n *\n * Based off js implementation at http://www.myersdaily.org/joseph/javascript/md5-text.html\n *\n * To hash a string call StreamMD5.hash(\"hello\")\n * If you wish to \"stream\" data use state = StreamMD5.init(), StreamMD5.update(state, 'new') and StreamMD5.finalize(state)\n *    It closely relates to how php's hash_init works\n *\n * Modified by James Hartig <fastest963@gmail.com>\n */\n\n/**\n * Converted to Typescript by Ofri Wolfus on 12/10/22. Also dropped support for\n * input types other than string which we don't use.\n */\n\nfunction md5cycle(x: MD5State, k: number[]) {\n  var a = x[0],\n    b = x[1],\n    c = x[2],\n    d = x[3];\n\n  a = ff(a, b, c, d, k[0], 7, -680876936);\n  d = ff(d, a, b, c, k[1], 12, -389564586);\n  c = ff(c, d, a, b, k[2], 17, 606105819);\n  b = ff(b, c, d, a, k[3], 22, -1044525330);\n  a = ff(a, b, c, d, k[4], 7, -176418897);\n  d = ff(d, a, b, c, k[5], 12, 1200080426);\n  c = ff(c, d, a, b, k[6], 17, -1473231341);\n  b = ff(b, c, d, a, k[7], 22, -45705983);\n  a = ff(a, b, c, d, k[8], 7, 1770035416);\n  d = ff(d, a, b, c, k[9], 12, -1958414417);\n  c = ff(c, d, a, b, k[10], 17, -42063);\n  b = ff(b, c, d, a, k[11], 22, -1990404162);\n  a = ff(a, b, c, d, k[12], 7, 1804603682);\n  d = ff(d, a, b, c, k[13], 12, -40341101);\n  c = ff(c, d, a, b, k[14], 17, -1502002290);\n  b = ff(b, c, d, a, k[15], 22, 1236535329);\n\n  a = gg(a, b, c, d, k[1], 5, -165796510);\n  d = gg(d, a, b, c, k[6], 9, -1069501632);\n  c = gg(c, d, a, b, k[11], 14, 643717713);\n  b = gg(b, c, d, a, k[0], 20, -373897302);\n  a = gg(a, b, c, d, k[5], 5, -701558691);\n  d = gg(d, a, b, c, k[10], 9, 38016083);\n  c = gg(c, d, a, b, k[15], 14, -660478335);\n  b = gg(b, c, d, a, k[4], 20, -405537848);\n  a = gg(a, b, c, d, k[9], 5, 568446438);\n  d = gg(d, a, b, c, k[14], 9, -1019803690);\n  c = gg(c, d, a, b, k[3], 14, -187363961);\n  b = gg(b, c, d, a, k[8], 20, 1163531501);\n  a = gg(a, b, c, d, k[13], 5, -1444681467);\n  d = gg(d, a, b, c, k[2], 9, -51403784);\n  c = gg(c, d, a, b, k[7], 14, 1735328473);\n  b = gg(b, c, d, a, k[12], 20, -1926607734);\n\n  a = hh(a, b, c, d, k[5], 4, -378558);\n  d = hh(d, a, b, c, k[8], 11, -2022574463);\n  c = hh(c, d, a, b, k[11], 16, 1839030562);\n  b = hh(b, c, d, a, k[14], 23, -35309556);\n  a = hh(a, b, c, d, k[1], 4, -1530992060);\n  d = hh(d, a, b, c, k[4], 11, 1272893353);\n  c = hh(c, d, a, b, k[7], 16, -155497632);\n  b = hh(b, c, d, a, k[10], 23, -1094730640);\n  a = hh(a, b, c, d, k[13], 4, 681279174);\n  d = hh(d, a, b, c, k[0], 11, -358537222);\n  c = hh(c, d, a, b, k[3], 16, -722521979);\n  b = hh(b, c, d, a, k[6], 23, 76029189);\n  a = hh(a, b, c, d, k[9], 4, -640364487);\n  d = hh(d, a, b, c, k[12], 11, -421815835);\n  c = hh(c, d, a, b, k[15], 16, 530742520);\n  b = hh(b, c, d, a, k[2], 23, -995338651);\n\n  a = ii(a, b, c, d, k[0], 6, -198630844);\n  d = ii(d, a, b, c, k[7], 10, 1126891415);\n  c = ii(c, d, a, b, k[14], 15, -1416354905);\n  b = ii(b, c, d, a, k[5], 21, -57434055);\n  a = ii(a, b, c, d, k[12], 6, 1700485571);\n  d = ii(d, a, b, c, k[3], 10, -1894986606);\n  c = ii(c, d, a, b, k[10], 15, -1051523);\n  b = ii(b, c, d, a, k[1], 21, -2054922799);\n  a = ii(a, b, c, d, k[8], 6, 1873313359);\n  d = ii(d, a, b, c, k[15], 10, -30611744);\n  c = ii(c, d, a, b, k[6], 15, -1560198380);\n  b = ii(b, c, d, a, k[13], 21, 1309151649);\n  a = ii(a, b, c, d, k[4], 6, -145523070);\n  d = ii(d, a, b, c, k[11], 10, -1120210379);\n  c = ii(c, d, a, b, k[2], 15, 718787259);\n  b = ii(b, c, d, a, k[9], 21, -343485551);\n\n  x[0] = add32(a, x[0]);\n  x[1] = add32(b, x[1]);\n  x[2] = add32(c, x[2]);\n  x[3] = add32(d, x[3]);\n}\n\nfunction cmn(q: number, a: number, b: number, x: number, s: number, t: number) {\n  a = add32(add32(a, q), add32(x, t));\n  return add32((a << s) | (a >>> (32 - s)), b);\n}\n\nfunction ff(\n  a: number,\n  b: number,\n  c: number,\n  d: number,\n  x: number,\n  s: number,\n  t: number\n) {\n  return cmn((b & c) | (~b & d), a, b, x, s, t);\n}\n\nfunction gg(\n  a: number,\n  b: number,\n  c: number,\n  d: number,\n  x: number,\n  s: number,\n  t: number\n) {\n  return cmn((b & d) | (c & ~d), a, b, x, s, t);\n}\n\nfunction hh(\n  a: number,\n  b: number,\n  c: number,\n  d: number,\n  x: number,\n  s: number,\n  t: number\n) {\n  return cmn(b ^ c ^ d, a, b, x, s, t);\n}\n\nfunction ii(\n  a: number,\n  b: number,\n  c: number,\n  d: number,\n  x: number,\n  s: number,\n  t: number\n) {\n  return cmn(c ^ (b | ~d), a, b, x, s, t);\n}\n\nexport type MD5State = [number, number, number, number, number, string | null];\n\nexport function init(): MD5State {\n  return [1732584193, -271733879, -1732584194, 271733878, 0, null];\n}\n\n//progressive md51\nexport function update(state: MD5State, s: string): MD5State {\n  let len = s.length;\n  if (!state) {\n    state = init();\n  }\n  state[4] += len;\n  //if we have trailing data\n  if (state[5] !== null) {\n    s = (state[5] || '') + s;\n    state[5] = null;\n    len = s.length;\n  }\n  for (var i = 64; i <= len; i += 64) {\n    md5cycle(state, md5blk(s.substring(i - 64, i)));\n  }\n  state[5] = (state[5] || '') + s.substring(i - 64);\n  return state;\n}\n\nexport function finalize(state: MD5State): string {\n  let n = state[4];\n  let s = state[5];\n  let i: number;\n  let l: number;\n  //if we have trailing data\n  if (s !== null && s.length >= 64) {\n    //clear out last buffer since we're sending it to update\n    state[5] = null;\n    state = update(state, s);\n    s = state[5];\n  }\n  const tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n  if (s !== null) {\n    for (i = 0, l = s.length; i < l; i++) {\n      tail[i >> 2] |= s.charCodeAt(i) << (i % 4 << 3);\n    }\n  }\n  tail[i! >> 2] |= 0x80 << (i! % 4 << 3);\n  if (i! > 55) {\n    md5cycle(state, tail);\n    for (i = 0; i < 16; i++) tail[i] = 0;\n  }\n  tail[14] = n * 8;\n  md5cycle(state, tail);\n\n  state.pop(); //get rid of the data count\n  state.pop(); //get rid of the cache\n  return hex(state);\n}\n\nexport function md51(s: string) {\n  var state = init();\n  state[4] = s.length;\n  state[5] = s;\n  return finalize(state);\n}\n\nfunction md5blk(s: string) {\n  /* I figured global was faster.   */\n  var md5blks = [],\n    i; /* Andy King said do it this way. */\n  for (i = 0; i < 64; i += 4) {\n    md5blks[i >> 2] =\n      s.charCodeAt(i) +\n      (s.charCodeAt(i + 1) << 8) +\n      (s.charCodeAt(i + 2) << 16) +\n      (s.charCodeAt(i + 3) << 24);\n  }\n  return md5blks;\n}\n\nconst hex_chr = '0123456789abcdef'.split('');\n\nfunction rhex(n: number) {\n  var s = '',\n    j = 0;\n  for (; j < 4; j++)\n    s += hex_chr[(n >> (j * 8 + 4)) & 0x0f] + hex_chr[(n >> (j * 8)) & 0x0f];\n  return s;\n}\n\nfunction hex(x: MD5State) {\n  for (var i = 0; i < x.length; i++) x[i] = rhex(x[i] as number);\n  return x.join('');\n}\n\nfunction add32(a: number, b: number) {\n  return (a + b) & 0xffffffff;\n}\n\nexport function hash(s: string) {\n  return md51(s);\n}\n", "import { randomInt } from '../../math.ts';\nimport { newInstance } from '../../common.ts';\nimport { MurmurHash3 } from '../../hash.ts';\nimport { serializeDate } from '../../date.ts';\nimport { BaseEncoder } from './base-encoder.ts';\nimport {\n  CoreDictionary,\n  CoreOptions,\n  CoreValue,\n  Encodable,\n  ReadonlyCoreArray,\n  ReadonlyCoreObject,\n} from '../base.ts';\nimport { getCoreType } from '../utils.ts';\nimport * as StreamMD5 from '../../../external/md5.ts';\n\nexport interface ChecksumEncoderOpts extends CoreOptions {\n  typeSafe?: boolean;\n}\n\nexport abstract class ChecksumEncoder<\n  ST,\n  OT extends ChecksumEncoderOpts = ChecksumEncoderOpts\n> extends BaseEncoder<string, string, OT> {\n  private _data: { [key: string]: string };\n  private _defaultOpts: OT | undefined;\n  readonly typeSafe: boolean;\n\n  constructor(opts?: OT) {\n    super(opts);\n    this._data = {};\n    this.typeSafe = opts?.typeSafe === true;\n    this._defaultOpts = opts;\n  }\n\n  newEncoder() {\n    return newInstance<ChecksumEncoder<ST, OT>>(this);\n  }\n\n  getOutput(): string {\n    const data = this._data;\n    const keys = Object.keys(data).sort();\n    const typeSafe = this.typeSafe;\n    let state = this.newState();\n    for (const k of keys) {\n      state = this.appendValue(state, typeSafe ? 'k' + k : k);\n      state = this.appendValue(state, data[k]);\n    }\n    return this.finalizeState(state);\n  }\n\n  protected getDefaultOpts(): OT | undefined {\n    return this._defaultOpts;\n  }\n\n  protected setPrimitive(key: string, value: string, _options?: OT): void {\n    this._data[key] = value;\n  }\n\n  protected isNativeValue(value: CoreValue, options?: OT): value is string {\n    const typeSafe =\n      typeof options?.typeSafe === 'boolean' ? options.typeSafe : this.typeSafe;\n    return typeSafe ? false : typeof value === 'string';\n  }\n\n  checksumForValue(value: CoreValue, options?: OT): string {\n    return this.checksumForString(this.convertValue(value, options));\n  }\n\n  convertValue(value: CoreValue, options?: OT): string {\n    const type = getCoreType(value);\n    const converted = super.convertValue(value, options);\n    const typeSafe =\n      typeof options?.typeSafe === 'boolean' ? options.typeSafe : this.typeSafe;\n    return typeSafe ? String(type) + converted : converted;\n  }\n\n  protected convertEncodable(\n    value: Encodable<string, CoreValue>,\n    options?: OT\n  ): string {\n    const encoder = this.newEncoder();\n    value.serialize(encoder, options);\n    return encoder.getOutput();\n  }\n\n  protected convertSet(set: Set<CoreValue>, options?: OT): string {\n    const checksums: string[] = [];\n\n    const iterableFilter = options?.iterableFilter || this.iterableFilter;\n    for (const v of set) {\n      if (iterableFilter === undefined || iterableFilter(v)) {\n        checksums.push(this.checksumForValue(v, options));\n      }\n    }\n    checksums.sort();\n    return this.convertArray(checksums);\n  }\n\n  protected convertArray(arr: ReadonlyCoreArray, options?: OT): string {\n    const state = this.newState();\n    const iterableFilter = options?.iterableFilter || this.iterableFilter;\n\n    for (const v of arr) {\n      if (iterableFilter === undefined || iterableFilter(v)) {\n        this.appendValue(state, this.convertValue(v, options));\n      }\n    }\n    return this.finalizeState(state);\n  }\n\n  protected convertGenerator(g: Generator<CoreValue>, options?: OT): string {\n    const state = this.newState();\n    const iterableFilter = options?.iterableFilter || this.iterableFilter;\n    for (const v of g) {\n      if (iterableFilter === undefined || iterableFilter(v)) {\n        this.appendValue(state, this.convertValue(v, options));\n      }\n    }\n    return this.finalizeState(state);\n  }\n\n  protected convertObject(obj: ReadonlyCoreObject, options?: OT): string {\n    const encoder = newInstance<ChecksumEncoder<ST, OT>>(this, {\n      ...this.getDefaultOpts(),\n      ...options,\n    });\n    // We use an inner encoder which sorts the keys and generates a consistent\n    // value.\n    const keyFilter = options?.objectFilterFields || this.objectFilterFields;\n    for (const [k, v] of Object.entries(obj)) {\n      if (keyFilter(k, obj)) {\n        encoder.set(k, v);\n      }\n    }\n    return encoder.getOutput();\n  }\n\n  protected convertNumber(n: number, _options?: OT): string {\n    return String(n);\n  }\n\n  protected convertBoolean(b: boolean, _options?: OT): string {\n    return b ? 'true' : 'false';\n  }\n\n  protected convertString(str: string, _options?: OT): string {\n    return str;\n  }\n\n  protected convertNull(_options?: OT): string {\n    return 'null';\n  }\n\n  protected convertUndefined(_options?: OT): string {\n    return 'undefined';\n  }\n\n  protected convertDate(date: Date, _options?: OT): string {\n    return String(serializeDate(date));\n  }\n\n  protected convertDictionary(value: CoreDictionary, _options?: OT) {\n    const encoder = newInstance<ChecksumEncoder<ST, OT>>(this);\n    for (const [k, v] of value) {\n      encoder.set(k, v);\n    }\n    return encoder.getOutput();\n  }\n\n  protected checksumForString(value: string, options?: OT): string {\n    return this.finalizeState(\n      this.appendValue(this.newState(options), value, options),\n      options\n    );\n  }\n\n  protected abstract newState(options?: OT): ST;\n  protected abstract appendValue(state: ST, value: string, options?: OT): ST;\n  protected abstract finalizeState(state: ST, options?: OT): string;\n}\n\nexport class MD5Checksum<\n  OT extends ChecksumEncoderOpts = ChecksumEncoderOpts\n> extends ChecksumEncoder<StreamMD5.MD5State, OT> {\n  protected newState() {\n    return StreamMD5.init();\n  }\n\n  protected appendValue(state: StreamMD5.MD5State, value: string) {\n    StreamMD5.update(state, value);\n    return state;\n  }\n  protected finalizeState(state: StreamMD5.MD5State): string {\n    return StreamMD5.finalize(state);\n  }\n}\n\nexport interface Murmur3Opts extends ChecksumEncoderOpts {\n  seed?: number;\n}\n\nexport class Murmur3Checksum extends ChecksumEncoder<MurmurHash3, Murmur3Opts> {\n  readonly _seed: number;\n\n  constructor(options?: Murmur3Opts) {\n    if (options === undefined) {\n      options = {};\n    }\n    if (options.seed === undefined) {\n      // By default, start with the same seed for everyone\n      // options.seed = 3172939476544195;\n      options.seed = randomInt(0, Number.MAX_SAFE_INTEGER);\n    }\n    super(options);\n    this._seed = options.seed;\n  }\n\n  protected newState(options?: Murmur3Opts): MurmurHash3 {\n    return new MurmurHash3(options?.seed || this._seed);\n  }\n\n  protected appendValue(\n    state: MurmurHash3,\n    value: string,\n    _options?: Murmur3Opts\n  ) {\n    state.hash(value);\n    return state;\n  }\n  protected finalizeState(state: MurmurHash3, _options?: Murmur3Opts): string {\n    return String(state.result());\n  }\n}\n", "import { CoreOptions, CoreValue } from '../base.ts';\nimport {\n  ChecksumEncoderOpts,\n  Murmur3Checksum,\n  Murmur3Opts,\n} from './checksum.ts';\n\nconst kMurmurEncoder = new Murmur3Checksum({ typeSafe: false });\n\nexport function encodableValueHash(\n  v: CoreValue,\n  options?: CoreOptions | ChecksumEncoderOpts\n): string {\n  return kMurmurEncoder.checksumForValue(v, options as Murmur3Opts);\n}\n", "import { notReached } from '../error.ts';\nimport { CoreOptions, CoreType, CoreValue } from './base.ts';\nimport { encodableValueHash } from './encoding/hash.ts';\nimport { Comparable } from './index.ts';\nimport { getCoreType, isEquatable, isComparable } from './utils.ts';\n\nexport const MinComparableValue = {};\nexport const MaxComparableValue = {};\n\nexport interface CompareOptions extends CoreOptions {\n  extendFunc?: (v1: CoreValue, v2: CoreValue) => number | undefined;\n}\n\n/**\n * WARNING: passing a Set/Dictionary/Object with a class: the class must be serializable.\n * @param v1\n * @param v2\n * @param options\n * @returns\n */\nexport function coreValueCompare(\n  v1: CoreValue,\n  v2: CoreValue,\n  options?: CompareOptions\n): number {\n  if (v1 === v2) return 0;\n  if (v1 === MinComparableValue) {\n    if (v2 === MinComparableValue) {\n      //Both are min\n      return 0;\n    }\n    //v1 is always smaller\n    return -1;\n  }\n  if (v2 === MinComparableValue) {\n    return 1;\n  }\n  if (v1 === MaxComparableValue) {\n    if (v2 === MaxComparableValue) {\n      //Both are max\n      return 0;\n    }\n    //v1 is always bigger\n    return 1;\n  }\n  if (v2 === MaxComparableValue) {\n    return -1;\n  }\n\n  if (v1 === undefined && v2 !== undefined) {\n    return -1;\n  }\n  if (v1 !== undefined && v2 === undefined) {\n    return 1;\n  }\n\n  if (v1 === null && v2 !== null) {\n    return -1;\n  }\n  if (v1 !== null && v2 === null) {\n    return 1;\n  }\n\n  if (options?.extendFunc) {\n    const extRes = options.extendFunc(v1, v2);\n    if (extRes !== undefined) return extRes;\n  }\n\n  const type1 = getCoreType(v1 as CoreValue);\n  let type2: CoreType | undefined;\n  switch (type1) {\n    case CoreType.Null:\n      if (v2 === null) return 0;\n      break;\n    case CoreType.Undefined:\n      if (v2 === undefined) return 0;\n      break;\n    case CoreType.Boolean:\n    case CoreType.Date:\n    case CoreType.Number:\n    case CoreType.String:\n      type2 = getCoreType(v2 as CoreValue);\n      if (type1 === type2) {\n        //@ts-ignore\n        if (v1 < v2) {\n          return -1;\n        }\n        //@ts-ignore\n        if (v1 > v2) {\n          return 1;\n        }\n        return 0;\n      }\n      break;\n\n    case CoreType.Array:\n    case CoreType.Generator:\n      type2 = getCoreType(v2 as CoreValue);\n      if (type2 === CoreType.Array || type2 === CoreType.Generator) {\n        return coreIterableCompare(\n          v1 as Iterable<CoreValue>,\n          v2 as Iterable<CoreValue>,\n          options\n        );\n      }\n      break;\n    case CoreType.ClassObject: {\n      if (isComparable(v1)) {\n        // if (v1.constructor === v2?.constructor) {\n        //   return v1.compare(v2);\n        // }\n        if (v2 instanceof v1.constructor) {\n          return v1.compare(v2);\n        } else if (v1 instanceof v2!.constructor) {\n          return -1 * (v2 as Comparable).compare(v1);\n        }\n      }\n\n      if (isEquatable(v1) && v1.constructor === v2?.constructor) {\n        if (v1.isEqual(v2)) return 0;\n      }\n\n      notReached(\n        `Incomparable classes ${v1?.constructor.name} and ${v2?.constructor.name}`\n      );\n      break;\n    }\n  }\n\n  const hash1 = encodableValueHash(v1 as CoreValue, options);\n  const hash2 = encodableValueHash(v2 as CoreValue, options);\n  if (hash1 > hash2) {\n    return 1;\n  }\n  if (hash1 < hash2) {\n    return -1;\n  }\n  return 0;\n}\n\nfunction coreIterableCompare(\n  i1: Iterable<CoreValue>,\n  i2: Iterable<CoreValue>,\n  options?: CompareOptions\n): number {\n  const iter1 = i1[Symbol.iterator]();\n  const iter2 = i2[Symbol.iterator]();\n\n  let val1 = iter1.next();\n  let val2 = iter2.next();\n\n  const iterableFilter = options && options.iterableFilter;\n\n  while (true) {\n    //Find arr1 next element\n    if (iterableFilter) {\n      while (val1.done !== true) {\n        if (!iterableFilter(val1.value)) {\n          val1 = iter1.next();\n        } else {\n          break;\n        }\n      }\n\n      //Find arr2 next element\n      while (val2.done !== true) {\n        if (!iterableFilter(val2.value)) {\n          val2 = iter2.next();\n        } else {\n          break;\n        }\n      }\n    }\n\n    if (val1.done === true && val2.done !== true) {\n      //i1 has less elements\n      return -1;\n    }\n\n    if (val1.done !== true && val2.done === true) {\n      //i1 has more elements\n      return 1;\n    }\n\n    if (val1.done === true && val2.done === true) {\n      //both are done\n      return 0;\n    }\n\n    const cmp = coreValueCompare(val1.value, val2.value, options);\n    if (cmp !== 0) return cmp;\n\n    val1 = iter1.next();\n    val2 = iter2.next();\n  }\n}\n", "import { deepEqual, isImmutable } from './comparisons.ts';\n\nexport function intersection<T>(s1: Set<T>, s2: Set<T>): Set<T> {\n  if (!(s1 instanceof Set)) {\n    s1 = new Set(s1);\n  }\n  if (!(s2 instanceof Set)) {\n    s2 = new Set(s2);\n  }\n  const result = new Set<T>();\n  for (const v of s1) {\n    if (s2.has(v)) {\n      result.add(v);\n    }\n  }\n  return result;\n}\n\nexport function intersects<T>(s1: Set<T>, s2: Set<T>): boolean {\n  // Make sure s1 is the smaller of the two sets\n  if (s1.size > s2.size) {\n    const tmp = s1;\n    s1 = s2;\n    s2 = tmp;\n  }\n  for (const v of s1) {\n    if (s2.has(v)) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function difference<T>(s1: Set<T>, s2: Set<T>): Set<T> {\n  if (!(s1 instanceof Set)) {\n    s1 = new Set(s1);\n  }\n  if (!(s2 instanceof Set)) {\n    s2 = new Set(s2);\n  }\n  const result = new Set<T>();\n  for (const v of s1) {\n    if (!s2.has(v)) {\n      result.add(v);\n    }\n  }\n  for (const v of s2) {\n    if (!s1.has(v)) {\n      result.add(v);\n    }\n  }\n  return result;\n}\n\n/**\n * Subtracts the values in s2 from s1 and returns the result\n * as new set. The original sets aren't modified.\n */\nexport function subtract<T>(v1: Iterable<T>, v2: Iterable<T>): Set<T> {\n  const s2 = v2 instanceof Set ? v2 : new Set(v2);\n\n  const result = new Set<T>();\n  for (const v of v1) {\n    if (!s2.has(v)) {\n      result.add(v);\n    }\n  }\n  return result;\n}\n\nexport function* subtractIter<T>(\n  v1: Iterable<T>,\n  v2: Iterable<T>\n): Generator<T> {\n  const s2 = v2 instanceof Set ? v2 : new Set(v2);\n\n  for (const v of v1) {\n    if (!s2.has(v)) {\n      yield v;\n    }\n  }\n}\n\nexport function equals<T>(\n  v1: Iterable<T>,\n  v2: Iterable<T>,\n  filter?: (v: T) => boolean\n): boolean {\n  const s1 = v1 instanceof Set ? v1 : new Set(v1);\n  const s2 = v2 instanceof Set ? v2 : new Set(v2);\n  if (filter === undefined && s1.size !== s2.size) {\n    return false;\n  }\n  let equalsC = 0;\n  for (const v of s1) {\n    if (filter && !filter(v)) {\n      //Don't need to check\n      continue;\n    }\n    if (!s2.has(v)) {\n      return false;\n    }\n    equalsC++;\n  }\n\n  if (filter && s2.size > equalsC) {\n    //There are items in s2 that have not been checked\n    for (const v of s2) {\n      if (filter(v)) {\n        if (!s1.has(v)) {\n          return false;\n        }\n      }\n    }\n  }\n\n  return true;\n}\n\nexport function union<T>(\n  i1: Iterable<T> | undefined,\n  i2: Iterable<T> | undefined,\n  inPlace = false\n): Set<T> {\n  let result: Set<T>;\n  if (inPlace) {\n    if (i1) {\n      if (i1 instanceof Set) {\n        result = i1;\n      } else {\n        result = new Set(i1);\n      }\n    } else {\n      result = new Set<T>();\n    }\n  } else {\n    result = new Set<T>(i1);\n  }\n\n  if (i2) {\n    for (const v of i2) {\n      result.add(v);\n    }\n  }\n  return result;\n}\n\nexport function* unionIter<T>(\n  i1: Iterable<T> | undefined,\n  i2: Iterable<T> | undefined\n) {\n  if (i1 === undefined || i2 === undefined) {\n    const iter = i1 !== undefined ? i1 : i2;\n    if (iter) {\n      for (const item of iter) {\n        yield item;\n      }\n    }\n    return;\n  }\n\n  let set: Set<T>;\n  let other: Iterable<T>;\n\n  if (i1 instanceof Set) {\n    set = i1;\n    other = i2;\n  } else if (i2 instanceof Set) {\n    set = i2;\n    other = i1;\n  } else {\n    set = new Set(i1);\n    other = i2;\n  }\n\n  for (const v of set) {\n    yield v;\n  }\n  for (const v of other) {\n    if (!set.has(v)) {\n      yield v;\n    }\n  }\n}\n\nexport function map<O, I>(input: Iterable<I>, mapper: (v: I) => O): Set<O> {\n  const result = new Set<O>();\n  for (const v of input) {\n    result.add(mapper(v));\n  }\n  return result;\n}\n\nexport function mapToArray<T>(s: Set<T>, mapper: (v: T) => any): any[] {\n  const result = [];\n  for (const v of s) {\n    result.push(mapper(v));\n  }\n  return result;\n}\n\n/**\n * Adds all items from the passed iterable to `s`, and returns `s`.\n * @param s The set to update.\n * @param iterable Items to add to the set.\n * @returns The updated set.\n */\nexport function update<T>(s: Set<T>, iterable: Iterable<T>): Set<T> {\n  for (const v of iterable) {\n    s.add(v);\n  }\n  return s;\n}\n\nexport function deleteAll<T>(s: Set<T>, iterable: Iterable<T>): Set<T> {\n  for (const v of iterable) {\n    s.delete(v);\n  }\n  return s;\n}\n\nexport function from<T>(\n  iterable: Iterable<T>,\n  mapper?: (v: T) => any\n): Set<any> {\n  // Shortcut - if no mapper was given, fall back to the native constructor\n  if (!mapper) {\n    return new Set(iterable);\n  }\n  const result = new Set();\n  for (const v of iterable) {\n    result.add(mapper(v));\n  }\n  return result;\n}\n\n/**\n * Returns a single value from a set or undefined if the set is empty. The\n * actual value being returned is undefined and will depend on the specific\n * JS runtime, version, and state at the call time.\n */\nexport function anyValue<T>(s?: Set<T>): T | undefined {\n  if (!s || !s.size) {\n    return undefined;\n  }\n  return s.values().next().value;\n}\n\n/**\n * Checks if a set contains a given value using deep equality.\n */\nexport function hasByValue<T>(s1: Set<T>, v: T): boolean {\n  if (s1.has(v)) {\n    return true;\n  }\n  // Shortcut: For immutable primitives, the builtin equality check properly\n  // handles by-value check as immutable primitives are guaranteed to be\n  // unique pointers by the runtime.\n  if (isImmutable(v)) {\n    return false;\n  }\n  // Mutable values must be searched for using linear search\n  for (const x of s1) {\n    if (deepEqual(x, v)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Delete a value from a set based on deep equality. The built in Set\n * implementation uses strict equality (===) for checking if values are equal.\n * This function does the same but with deepEqual() as a comparator.\n *\n * WARING: Unlike regular Set operations, this function is O(N) - linear in the\n * Set size.\n */\nexport function deleteByValue<T>(s: Set<T>, v: T): Set<T> {\n  if (!s) {\n    return s;\n  }\n  if (!(s instanceof Set)) {\n    s = new Set(s);\n  }\n  // Shortcut - exact match O(1)\n  if (s.has(v)) {\n    s.delete(v);\n  } else if (!isImmutable(v)) {\n    // No exact value - do it the hard way with a linear search.\n    // We only do this for values that are not immutable. Immutable values that\n    // failed the has() check are guaranteed not to exist in the set due to\n    // JS uniquing happening behind the scenes.\n    for (const x of s) {\n      if (deepEqual(x, v)) {\n        s.delete(x);\n        break;\n      }\n    }\n  }\n  return s;\n}\n\n/**\n * Insert a value to a set based on deep equality. The built in Set\n * implementation uses strict equality (===) for checking if values are equal.\n * This function does the same but with deepEqual() as a comparator.\n *\n * WARING: Unlike regular Set operations, this function is O(N) - linear in the\n * Set size.\n */\nexport function addByValue<T>(s: Set<T>, v: T): Set<T> {\n  if (!s) {\n    return s;\n  }\n  if (!(s instanceof Set)) {\n    s = new Set(s);\n  }\n  // If the value is an immutable primitive we can safely just add() it.\n  // The JS runtime will take care of uniquing for us.\n  if (isImmutable(v)) {\n    s.add(v);\n  } else {\n    // The value is mutable. First, check for exact match that's already\n    // present in the set.\n    if (!s.has(v)) {\n      // No exact match. Do a linear search and verify no equal value is present\n      // in our set.\n      let foundMatch = false;\n      for (const x of s) {\n        if (deepEqual(x, v)) {\n          foundMatch = true;\n          break;\n        }\n      }\n      // No equal value is present. Go ahead and add the value.\n      if (!foundMatch) {\n        s.add(v);\n      }\n    }\n  }\n  return s;\n}\n\nexport function subtractByValue<T>(s1: Set<T>, s2: Set<T>): Set<T> {\n  if (!(s1 instanceof Set)) {\n    s1 = new Set(s1);\n  }\n  if (!(s2 instanceof Set)) {\n    s2 = new Set(s2);\n  }\n  const result = new Set<T>();\n  for (const v of s1) {\n    if (!hasByValue(s2, v)) {\n      result.add(v);\n    }\n  }\n  return result;\n}\n\nexport function unionByValue<T>(\n  i1: Iterable<T>,\n  i2: Iterable<T>,\n  inPlace = false\n): Set<T> {\n  const result = inPlace && i1 instanceof Set ? i1 : new Set(i1);\n  for (const v of i2) {\n    addByValue(result, v);\n  }\n  return result;\n}\n\nexport function equalsByValue<T>(s1: Set<T>, s2: Set<T>): boolean {\n  if (!(s1 instanceof Set)) {\n    s1 = new Set(s1);\n  }\n  if (!(s2 instanceof Set)) {\n    s2 = new Set(s2);\n  }\n  if (s1.size !== s2.size) {\n    return false;\n  }\n  for (const v of s1) {\n    if (!hasByValue(s2, v)) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function toggleMembership<T>(s1: Set<T>, v: T): boolean {\n  if (s1.has(v)) {\n    s1.delete(v);\n    return false;\n  } else {\n    s1.add(v);\n    return true;\n  }\n}\n", "import { dictEquals, Dictionary } from '../collections/dict.ts';\nimport {\n  CoreKey,\n  CoreOptions,\n  CoreType,\n  CoreValue,\n  IterableFilterFunc,\n  ReadonlyCoreArray,\n  ReadonlyCoreObject,\n} from './base.ts';\nimport { getCoreType, isComparable, isEquatable } from './utils.ts';\nimport { numbersEqual } from '../comparisons.ts';\nimport * as SetUtils from '../set.ts';\n\nfunction coreIterableEquals(\n  i1: Iterable<CoreValue>,\n  i2: Iterable<CoreValue>,\n  iterableFilter: IterableFilterFunc,\n  options?: EqualOptions\n) {\n  const iter1 = i1[Symbol.iterator]();\n  const iter2 = i2[Symbol.iterator]();\n\n  let val1 = iter1.next();\n  let val2 = iter2.next();\n\n  while (true) {\n    //Find arr1 next element\n    while (val1.done !== true) {\n      if (!iterableFilter(val1.value)) {\n        val1 = iter1.next();\n      } else {\n        break;\n      }\n    }\n\n    //Find arr2 next element\n    while (val2.done !== true) {\n      if (!iterableFilter(val2.value)) {\n        val2 = iter2.next();\n      } else {\n        break;\n      }\n    }\n\n    if (\n      (val1.done === true && val2.done !== true) ||\n      (val2.done === true && val1.done !== true)\n    ) {\n      //One of the iterators is done\n      return false;\n    }\n\n    if (val1.done === true && val2.done === true) {\n      //both are done\n      return true;\n    }\n\n    if (!coreValueEquals(val1.value, val2.value, options)) {\n      return false;\n    }\n    val1 = iter1.next();\n    val2 = iter2.next();\n  }\n}\n\nfunction setLongMatch(\n  s1: Set<CoreValue>,\n  s2: Set<CoreValue>,\n  options?: EqualOptions\n) {\n  let matchCount = 0;\n  const iterableFilter = options && options.iterableFilter;\n  for (const v1 of s1) {\n    if (iterableFilter && !iterableFilter(v1)) {\n      continue;\n    }\n\n    let foundMatch = false;\n    for (const v2 of s2) {\n      if (coreValueEquals(v1, v2, options)) {\n        foundMatch = true;\n        break;\n      }\n    }\n    // If v1 is not in s2, our sets differ\n    if (!foundMatch) {\n      return -1;\n    }\n    matchCount++;\n  }\n\n  return matchCount;\n}\n\nexport interface EqualOptions extends CoreOptions {}\n\nexport function coreValueEquals(\n  e1: CoreValue,\n  e2: CoreValue,\n  options?: EqualOptions\n): boolean {\n  if (e1 === e2) {\n    return true;\n  }\n\n  const t1 = getCoreType(e1);\n  const t2 = getCoreType(e2);\n  if (t1 !== t2) {\n    return false;\n  }\n\n  switch (t1) {\n    case CoreType.String:\n    case CoreType.Boolean:\n    case CoreType.Null:\n    case CoreType.Undefined:\n      return e1 === e2;\n\n    case CoreType.Number:\n      return numbersEqual(e1 as number, e2 as number);\n\n    case CoreType.Date:\n      return numbersEqual((e1 as Date).getTime(), (e2 as Date).getTime());\n\n    case CoreType.Array: {\n      const arr1 = e1 as ReadonlyCoreArray;\n      const arr2 = e2 as ReadonlyCoreArray;\n\n      const iterableFilter = options && options.iterableFilter;\n      if (iterableFilter) {\n        return coreIterableEquals(arr1, arr2, iterableFilter, options);\n      }\n\n      if (arr1.length !== arr2.length) {\n        return false;\n      }\n\n      for (let i = 0; i < arr1.length; ++i) {\n        if (!coreValueEquals(arr1[i], arr2[i], options)) {\n          return false;\n        }\n      }\n\n      return true;\n    }\n\n    case CoreType.Set: {\n      const s1 = e1 as Set<CoreValue>;\n      const s2 = e2 as Set<CoreValue>;\n\n      const iterableFilter = options && options.iterableFilter;\n      if (iterableFilter === undefined && s1.size !== s2.size) {\n        return false;\n      }\n\n      // Shortcut: Linear scan of pointer inequality\n      if (SetUtils.equals(s1, s2, iterableFilter)) {\n        return true;\n      }\n      // Pointer mismatch. Must fall back to N^2 deep equality.\n      // WARNING: We assume distinct values as per the normal definition of a\n      // Set.\n      const matchCount = setLongMatch(s1, s2, options);\n      if (matchCount === -1) {\n        return false;\n      }\n\n      if (iterableFilter && s2.size > matchCount) {\n        if (setLongMatch(s2, s1, options) === -1) {\n          return false;\n        }\n      }\n      // All values matched. Sets are definitely equal\n      return true;\n    }\n\n    case CoreType.Object: {\n      const obj1 = e1 as ReadonlyCoreObject;\n      const obj2 = e2 as ReadonlyCoreObject;\n      for (const k in obj1) {\n        if (\n          obj1.hasOwnProperty(k) &&\n          (options === undefined ||\n            options.objectFilterFields === undefined ||\n            options.objectFilterFields(k, obj1)) &&\n          (!obj2.hasOwnProperty(k) ||\n            !coreValueEquals(obj1[k], obj2[k], options))\n        ) {\n          return false;\n        }\n      }\n      for (const k in obj2) {\n        if (\n          obj2.hasOwnProperty(k) &&\n          (options === undefined ||\n            options.objectFilterFields === undefined ||\n            options.objectFilterFields(k, obj1)) &&\n          !obj1.hasOwnProperty(k)\n        ) {\n          return false;\n        }\n      }\n      return true;\n    }\n\n    case CoreType.Dictionary:\n      return dictEquals(\n        e1 as Dictionary<CoreKey, CoreValue>,\n        e2 as Dictionary<CoreKey, CoreValue>\n      );\n\n    case CoreType.Generator: {\n      const g1 = e1 as Generator<CoreValue>;\n      const g2 = e2 as Generator<CoreValue>;\n\n      const iterableFilter = options && options.iterableFilter;\n      if (iterableFilter) {\n        return coreIterableEquals(g1, g2, iterableFilter, options);\n      }\n\n      while (true) {\n        const v1 = g1.next();\n        const v2 = g2.next();\n        if (v1.done !== v2.done) {\n          return false;\n        }\n        if (v1.done) {\n          return true;\n        }\n        if (!coreValueEquals(v1.value, v2.value, options)) {\n          return false;\n        }\n      }\n    }\n\n    case CoreType.ClassObject: {\n      if (isEquatable(e1) && e1.constructor === e2?.constructor) {\n        return e1.isEqual(e2);\n      }\n\n      if (isComparable(e1) && e1.constructor === e2?.constructor) {\n        return e1.compare(e2) === 0;\n      }\n\n      throw new Error(\n        `${e1?.constructor} and ${e2?.constructor} must be Equatable or Comparable`\n      );\n    }\n  }\n}\n", "export type {\n  CoreOptions,\n  Clonable,\n  Comparable,\n  CoreArray,\n  CoreClassObject,\n  CoreDictionary,\n  CoreObject,\n  CoreSet,\n  CoreValue,\n  Encodable,\n  Encoder,\n  Equatable,\n  ReadonlyCoreArray,\n  ReadonlyCoreObject,\n  CoreValueCloneOpts,\n  ConcreteCoreValue,\n  CoreKey,\n} from './base.ts';\n\nexport { CoreType } from './base.ts';\n\nexport {\n  getCoreType,\n  isReadonlyCoreObject,\n  getCoreTypeOrUndef,\n} from './utils.ts';\n\nexport { coreValueClone } from './clone.ts';\n\nexport { coreValueCompare } from './comparable.ts';\n\nexport { coreValueEquals } from './equals.ts';\n", "import { ConstructorDecoderConfig } from './types.ts';\n\nexport function isDecoderConfig<T extends ConstructorDecoderConfig<any>>(\n  v: any\n): v is T {\n  return v !== undefined && v.hasOwnProperty('decoder');\n}\n", "export type {\n  ReadonlyDecodedObject,\n  DecodedValue,\n  DecodableKey,\n  ReadonlyDecodedArray,\n  Decoder,\n  Decodable,\n  ConstructorDecoderConfig,\n} from './types.ts';\n\nexport { isDecoderConfig } from './utils.ts';\n\nexport { encodableValueHash } from './hash.ts';\n", "import {\n  JSONObject,\n  JSONValue,\n  ReadonlyJSONObject,\n  ReadonlyJSONValue,\n} from '../../interfaces.ts';\nimport { isObject } from '../../comparisons.ts';\nimport { Dictionary } from '../../collections/dict.ts';\nimport { coreValueClone } from '../clone.ts';\nimport {\n  CoreKey,\n  CoreOptions,\n  CoreType,\n  CoreValue,\n  Encoder,\n  ReadonlyCoreArray,\n  ReadonlyCoreObject,\n} from '../base.ts';\nimport { getCoreType } from '../utils.ts';\n\nclass RefSet {\n  private _firstSet?: Set<CoreValue>;\n  private _secondSet?: Set<CoreValue>;\n\n  get refValues(): Iterable<CoreValue> {\n    return this._secondSet ? this._secondSet : [];\n  }\n\n  get hasMultiRef() {\n    return this._secondSet !== undefined && this._secondSet.size > 0;\n  }\n\n  set(val: CoreValue) {\n    if (this._firstSet === undefined) this._firstSet = new Set<CoreValue>();\n    if (!this._firstSet.has(val)) {\n      this._firstSet.add(val);\n      return;\n    }\n\n    if (this._secondSet === undefined) this._secondSet = new Set<CoreValue>();\n    this._secondSet.add(val);\n  }\n}\n\nexport abstract class BaseCyclicalEncoder<\n  R extends JSONValue,\n  T,\n  OT extends CoreOptions = CoreOptions\n> implements Encoder<string, CoreValue, T, OT>\n{\n  set(key: string, value: CoreValue, options?: OT): void {\n    // TODO(ofri): Properly handle Encodable instances as values\n    if (isObject(value)) {\n      const refSet = new RefSet();\n      this.fillRefs(refSet, value, options);\n      if (refSet.hasMultiRef) {\n        const refsMap = new Map<CoreValue, R>();\n\n        let refId = this.initRefId;\n        for (const ref of refSet.refValues) {\n          refsMap.set(ref, refId);\n          refId = this.nextRefId(refId);\n        }\n\n        const refData = coreValueClone(value, {\n          objectOverride: (obj: any) => {\n            const refId = refsMap.get(obj as CoreValue);\n            if (refId !== undefined) {\n              return [true, this.convertRef(refId, options) as any];\n            }\n            return [false, undefined];\n          },\n          objectFilterFields: options?.objectFilterFields,\n          iterableFilter: options?.iterableFilter,\n        });\n\n        value = {\n          __r: this.convertRefsMap(refsMap, options),\n          __d: refData as CoreValue,\n        };\n      }\n    }\n\n    this.encoder.set(key, value, options);\n  }\n\n  private fillRefs(set: RefSet, value: CoreValue, options?: OT) {\n    const type = getCoreType(value);\n    switch (type) {\n      case CoreType.Array:\n      case CoreType.Set:\n        for (const item of value as ReadonlyCoreArray) {\n          const iterableFilter = options && options.iterableFilter;\n          if (iterableFilter) {\n            if (!iterableFilter(item)) continue;\n          }\n          this.fillRefs(set, item, options);\n        }\n        break;\n      case CoreType.Dictionary:\n        for (const [_, v] of value as Dictionary<CoreKey, CoreValue>) {\n          this.fillRefs(set, v);\n        }\n        break;\n      case CoreType.Object:\n        if (!isEncodedRef(value as ReadonlyJSONValue)) {\n          set.set(value);\n          for (const [k, v] of Object.entries(value as ReadonlyCoreObject)) {\n            this.fillRefs(set, v);\n          }\n        }\n        break;\n    }\n  }\n\n  abstract get encoder(): Encoder<string, CoreValue, T, OT>;\n  abstract get initRefId(): R;\n  abstract nextRefId(prev: R): R;\n  abstract convertRef(refId: R, options?: OT): T;\n  abstract convertRefsMap(map: Map<CoreValue, R>, options?: OT): CoreValue;\n\n  getOutput(): T {\n    return this.encoder.getOutput();\n  }\n  abstract newEncoder(): Encoder<string, CoreValue, T, OT>;\n}\n\nexport interface EncodedRef extends ReadonlyJSONObject {\n  readonly __rId: number;\n}\n\nexport function isEncodedRef(v: CoreValue): v is EncodedRef {\n  if (getCoreType(v) === CoreType.Object) {\n    const obj = v as ReadonlyJSONObject;\n    if (typeof obj.__rId === 'number') {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport interface EncodedRefObject extends ReadonlyJSONObject {\n  readonly __r: JSONObject[];\n  readonly __d: JSONObject;\n}\n\nexport function isEncodedRefObject(\n  v: ReadonlyJSONValue\n): v is EncodedRefObject {\n  if (getCoreType(v) === CoreType.Object) {\n    const obj = v as ReadonlyJSONObject;\n    if (\n      getCoreType(obj.__r) === CoreType.Array &&\n      getCoreType(obj.__d) === CoreType.Object\n    ) {\n      return true;\n    }\n  }\n  return false;\n}\n", "import {\n  JSONObject,\n  ReadonlyJSONObject,\n  ReadonlyJSONValue,\n} from '../../interfaces.ts';\nimport { CoreOptions, CoreType, CoreValue, Encoder } from '../base.ts';\nimport { getCoreType } from '../utils.ts';\nimport {\n  isEncodedDate,\n  isEncodedEncodable,\n  isEncodedSet,\n  JSONBaseEncoder,\n} from './base-encoder.ts';\nimport {\n  BaseCyclicalEncoder,\n  EncodedRef,\n  isEncodedRef,\n  isEncodedRefObject,\n} from './cyclical.ts';\nimport { DecodedValue, Decoder } from './types.ts';\nimport { newInstance } from '../../common.ts';\nimport { deserializeDate } from '../../date.ts';\nimport { Encodable } from '../index.ts';\n\nexport class JSONEncoder extends JSONBaseEncoder<ReadonlyJSONValue> {\n  private _encodedObj: JSONObject;\n\n  constructor() {\n    super();\n    this._encodedObj = {};\n  }\n\n  getOutput(): ReadonlyJSONObject {\n    return this._encodedObj;\n  }\n\n  newEncoder() {\n    return newInstance<JSONEncoder>(this);\n  }\n\n  static toJS(value: CoreValue): ReadonlyJSONValue {\n    const encoder = new this();\n    return encoder.convertValue(value);\n  }\n\n  protected setPrimitive(\n    key: string,\n    value: ReadonlyJSONValue,\n    _options?: unknown\n  ): void {\n    this._encodedObj[key] = value;\n  }\n}\n\nexport class JSONCyclicalEncoder extends BaseCyclicalEncoder<\n  number,\n  ReadonlyJSONValue\n> {\n  private _encoder: JSONEncoder;\n\n  constructor() {\n    super();\n    this._encoder = new JSONEncoder();\n  }\n\n  get encoder(): Encoder<string, CoreValue, ReadonlyJSONValue, CoreOptions> {\n    return this._encoder;\n  }\n  get initRefId(): number {\n    return 0;\n  }\n  nextRefId(prev: number): number {\n    return prev + 1;\n  }\n  convertRef(refId: number, _options?: CoreOptions): ReadonlyJSONValue {\n    const ref: EncodedRef = {\n      __rId: refId,\n    };\n    return ref;\n  }\n\n  convertRefsMap(\n    map: Map<CoreValue, number>,\n    options?: CoreOptions\n  ): CoreValue {\n    const refs = Array.from(map.entries())\n      .sort((a, b) => a[1] - b[1])\n      .map((e) => this._encoder.convertValue(e[0], options));\n\n    return refs;\n  }\n\n  newEncoder(): Encoder<string, CoreValue, ReadonlyJSONValue, CoreOptions> {\n    return new JSONCyclicalEncoder();\n  }\n\n  static serialize(obj: Encodable): ReadonlyJSONObject {\n    const encoder = new JSONCyclicalEncoder();\n    obj.serialize(encoder);\n    return encoder.getOutput() as ReadonlyJSONObject;\n  }\n}\n\nexport class JSONDecoder implements Decoder {\n  private readonly _data: ReadonlyJSONObject;\n\n  constructor(encodedValue: ReadonlyJSONObject | undefined) {\n    this._data = encodedValue || {};\n  }\n\n  get<T extends DecodedValue>(key: string, defaultValue?: T): T | undefined {\n    if (!this.has(key)) {\n      return defaultValue;\n    }\n    const val = this._data[key];\n    if (!this.needDecode(val)) {\n      return val as T;\n    }\n    return this.decodeValue(this._data[key]) as T;\n  }\n\n  protected needDecode(value: ReadonlyJSONValue) {\n    if (value instanceof Array) {\n      for (const item of value) {\n        if (this.needDecode(item)) {\n          return true;\n        }\n      }\n    }\n    if (isEncodedSet(value)) {\n      return true;\n    }\n    if (isEncodedDate(value)) {\n      return true;\n    }\n    if (isEncodedEncodable(value)) {\n      return true;\n    }\n    if (getCoreType(value) === CoreType.Object) {\n      for (const val of Object.values(value as ReadonlyJSONObject)) {\n        if (this.needDecode(val as ReadonlyJSONValue)) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  has(key: string): boolean {\n    // deno-lint-ignore no-prototype-builtins\n    return this._data.hasOwnProperty(key);\n  }\n\n  getDecoder(key: string, offset?: number): Decoder<string, ReadonlyJSONValue> {\n    let value = this.get(key);\n    if (offset !== undefined && value instanceof Array) {\n      value = value[offset];\n    }\n    if (value instanceof JSONDecoder) {\n      return value;\n    }\n\n    return newInstance(this, value);\n  }\n\n  decodeValue(value: ReadonlyJSONValue): DecodedValue {\n    if (value instanceof Array) {\n      return value.map((v) => this.decodeValue(v));\n    }\n    if (isEncodedSet(value)) {\n      const set = new Set<DecodedValue>();\n      for (const v of value.__v) {\n        set.add(this.decodeValue(v));\n      }\n      return set;\n    }\n    if (isEncodedDate(value)) {\n      return deserializeDate(value.__v);\n    }\n    if (isEncodedEncodable(value)) {\n      return newInstance<JSONDecoder>(this, value.__v);\n    }\n    if (getCoreType(value) === CoreType.Object) {\n      return this.decodeObject(value as ReadonlyJSONObject);\n    }\n    return value;\n  }\n\n  protected decodeObject(jsonObj: ReadonlyJSONObject): {\n    [key: string]: DecodedValue;\n  } {\n    const obj: { [key: string]: DecodedValue } = {};\n    for (const [k, v] of Object.entries(jsonObj)) {\n      obj[k] = this.decodeValue(v as ReadonlyJSONValue);\n    }\n    return obj;\n  }\n}\n\nexport class JSONCyclicalDecoder extends JSONDecoder {\n  private _tempRefs?: ReadonlyJSONObject[][];\n\n  constructor(encodedValue: ReadonlyJSONObject | undefined) {\n    super(encodedValue);\n  }\n\n  needDecode(value: ReadonlyJSONValue) {\n    if (isEncodedRefObject(value)) {\n      return true;\n    }\n    return super.needDecode(value);\n  }\n\n  decodeValue(value: ReadonlyJSONValue): DecodedValue {\n    if (isEncodedRefObject(value)) {\n      if (!this._tempRefs) this._tempRefs = [];\n      this._tempRefs.push(value.__r);\n      const obj = this.decodeObject(value.__d);\n      this._tempRefs.pop();\n      return obj;\n    }\n    return super.decodeValue(value);\n  }\n\n  protected decodeObject(jsonObj: ReadonlyJSONObject): {\n    [key: string]: DecodedValue;\n  } {\n    if (isEncodedRef(jsonObj) && this._tempRefs) {\n      const refs = this._tempRefs[this._tempRefs.length - 1];\n      return refs[jsonObj.__rId as number];\n    }\n    return super.decodeObject(jsonObj);\n  }\n}\n", "import { assert } from '../../base/error.ts';\nimport {\n  ConstructorDecoderConfig,\n  isDecoderConfig,\n} from '../../base/core-types/encoding/index.ts';\nimport {\n  CoreValue,\n  Encodable,\n  Encoder,\n  Equatable,\n  ReadonlyCoreObject,\n} from '../../base/core-types/index.ts';\n\nexport type ChangeType = 'fd' | 'rt' | 'rt-2';\n\nexport interface EncodedChange extends ReadonlyCoreObject {\n  readonly changeType: ChangeType;\n}\n\nexport interface ChangeValueConfig {}\n\nexport abstract class Change<EC extends EncodedChange>\n  implements Encodable<keyof EC, CoreValue>, Equatable\n{\n  constructor(config?: ChangeValueConfig | ConstructorDecoderConfig<EC>) {\n    if (isDecoderConfig(config)) {\n      assert(config.decoder.get('changeType') === this.getType());\n    }\n  }\n\n  abstract getType(): ChangeType;\n\n  serialize(encoder: Encoder<keyof EC, CoreValue>, _options?: unknown): void {\n    encoder.set('changeType', this.getType());\n  }\n\n  abstract isEqual(other: Change<EC>): boolean;\n}\n", "import { assert } from '../../base/error.ts';\nimport { JSONValue } from '../../base/interfaces.ts';\nimport {\n  getTypeOperations,\n  ValueType,\n  valueTypeEquals,\n} from '../base/types/index.ts';\nimport {\n  ConstructorDecoderConfig,\n  isDecoderConfig,\n} from '../../base/core-types/encoding/index.ts';\nimport {\n  Change,\n  ChangeType,\n  ChangeValueConfig,\n  EncodedChange,\n} from './index.ts';\nimport { CoreValue, Encoder } from '../../base/core-types/index.ts';\n\nexport enum FieldOperation {\n  Insert = 1,\n  Delete = -1,\n}\n\ninterface EncodedFieldChange extends EncodedChange {\n  operation: number;\n  value: JSONValue;\n  vType: string;\n}\n\nexport interface FieldChangeConfig<TValue> extends ChangeValueConfig {\n  operation: FieldOperation;\n  value: TValue;\n  valueType: ValueType;\n}\n\nexport class FieldChange<TValue> extends Change<EncodedFieldChange> {\n  readonly operation: FieldOperation;\n  readonly value: TValue;\n  readonly valueType: ValueType;\n\n  constructor(\n    config:\n      | FieldChangeConfig<TValue>\n      | ConstructorDecoderConfig<EncodedFieldChange>\n  ) {\n    super(config);\n\n    if (isDecoderConfig(config)) {\n      const decoder = config.decoder;\n\n      this.operation = decoder.get<number>('operation')!;\n\n      this.valueType = decoder.get('vType')! as ValueType;\n      const typeOP = getTypeOperations(this.valueType);\n      this.value = typeOP.deserialize(decoder.get('value'));\n    } else {\n      this.operation = config.operation;\n      this.valueType = config.valueType;\n\n      const typeOP = getTypeOperations(this.valueType);\n      assert(\n        typeOP.validate(config.value),\n        `Invalid Field value for type: ${this.valueType}`\n      );\n      this.value = config.value;\n    }\n  }\n\n  getType(): ChangeType {\n    return 'fd';\n  }\n\n  isEqual(other: FieldChange<TValue>): boolean {\n    if (this.constructor !== other.constructor) {\n      return false;\n    }\n    if (this.operation !== other.operation) {\n      return false;\n    }\n    if (this.valueType !== other.valueType) {\n      return false;\n    }\n    return valueTypeEquals(this.valueType, this.value, other.value);\n  }\n\n  serialize(\n    encoder: Encoder<keyof EncodedFieldChange, CoreValue>,\n    _options?: unknown\n  ): void {\n    super.serialize(encoder, _options);\n\n    encoder.set('operation', this.operation);\n    encoder.set('vType', this.valueType);\n\n    const typeOP = getTypeOperations(this.valueType);\n    typeOP.serialize('value', this.value, encoder);\n  }\n\n  static insert<TValue>(value: TValue, valueType: ValueType) {\n    return new FieldChange<TValue>({\n      operation: FieldOperation.Insert,\n      value,\n      valueType,\n    });\n  }\n\n  static delete<TValue>(value: TValue, valueType: ValueType) {\n    return new FieldChange<TValue>({\n      operation: FieldOperation.Delete,\n      value,\n      valueType,\n    });\n  }\n}\n", "import { IValueTypeOperations, ValueType, ValueTypeOptions } from './index.ts';\nimport { DecodedValue } from '../../../base/core-types/encoding/index.ts';\nimport { Change, EncodedChange } from '../../change/index.ts';\nimport { FieldChange } from '../../change/field-change.ts';\nimport {\n  ConcreteCoreValue,\n  CoreType,\n  coreValueClone,\n  coreValueEquals,\n  Encoder,\n  getCoreTypeOrUndef,\n} from '../../../base/core-types/index.ts';\n\nexport abstract class CoreTypeOperations<\n  TValue extends ConcreteCoreValue = ConcreteCoreValue\n> implements IValueTypeOperations<TValue>\n{\n  private _coreType: CoreType;\n  private _valueType: ValueType;\n\n  constructor(encType: CoreType, valueType: ValueType) {\n    this._coreType = encType;\n    this._valueType = valueType;\n  }\n\n  get valueType() {\n    return this._valueType;\n  }\n\n  normalize(value: TValue): TValue {\n    return value;\n  }\n\n  fillRefs(refs: Set<string>, value: TValue): void {}\n\n  validate(value: any): boolean {\n    return getCoreTypeOrUndef(value) === this._coreType;\n  }\n\n  equals(val1: TValue, val2: TValue, options?: ValueTypeOptions): boolean {\n    return coreValueEquals(val1, val2);\n  }\n\n  clone(value: TValue) {\n    return coreValueClone(value);\n  }\n\n  serialize(\n    key: string,\n    value: TValue,\n    encoder: Encoder,\n    options?: ValueTypeOptions\n  ): void {\n    encoder.set(key, value);\n  }\n\n  deserialize(value: DecodedValue, options?: ValueTypeOptions) {\n    return value as TValue;\n  }\n\n  valueAddedDiff(\n    value2: TValue,\n    options?: ValueTypeOptions\n  ): undefined | Change<EncodedChange> | Change<EncodedChange>[] {\n    return FieldChange.insert(value2, this._valueType);\n  }\n\n  valueRemovedDiff(\n    value1: TValue,\n    options?: ValueTypeOptions\n  ): undefined | Change<EncodedChange> | Change<EncodedChange>[] {\n    return FieldChange.delete(value1, this._valueType);\n  }\n\n  needGC(value: TValue): boolean {\n    return false;\n  }\n\n  gc(value: TValue): TValue | undefined {\n    return undefined;\n  }\n\n  rewriteRefs(\n    keyMapping: Map<string, string>,\n    value: TValue,\n    deleteRefs?: Set<string>\n  ): TValue | undefined {\n    if (deleteRefs && deleteRefs.has(value as string)) {\n      return undefined;\n    }\n    return (keyMapping.get(value as string) as TValue) || value;\n  }\n\n  abstract valueChangedDiff(\n    value1: TValue,\n    value2: TValue,\n    options?: ValueTypeOptions\n  ): Change<EncodedChange> | Change<EncodedChange>[] | undefined;\n\n  abstract patch(\n    curValue: TValue | undefined,\n    changes: Change<EncodedChange>[],\n    options?: ValueTypeOptions\n  ): TValue | undefined;\n\n  abstract isEmpty(value: TValue): boolean;\n}\n", "import { ValueType, ValueTypeOptions } from './index.ts';\nimport {\n  dictFromPrimitive,\n  Dictionary,\n  PrimitiveMap,\n} from '../../../base/collections/dict.ts';\nimport { DecodedValue } from '../../../base/core-types/encoding/index.ts';\nimport { Change, EncodedChange } from '../../change/index.ts';\nimport { CoreTypeOperations } from './core-type.ts';\nimport { FieldChange, FieldOperation } from '../../change/field-change.ts';\nimport {\n  ConcreteCoreValue,\n  CoreKey,\n  CoreType,\n  coreValueEquals,\n} from '../../../base/core-types/index.ts';\n\nexport class MapTypeOperations extends CoreTypeOperations<\n  Dictionary<CoreKey, ConcreteCoreValue>\n> {\n  constructor(readonly isRef: boolean, valueType: ValueType) {\n    super(CoreType.Dictionary, valueType);\n  }\n\n  patch(\n    curValue: Dictionary<CoreKey, ConcreteCoreValue> | undefined,\n    changes: Change<EncodedChange>[],\n    options?: ValueTypeOptions\n  ) {\n    for (const change of changes) {\n      if (change instanceof FieldChange) {\n        if (change.operation === FieldOperation.Insert) {\n          curValue = this.patchInsert(curValue, change);\n        } else if (change.operation === FieldOperation.Delete) {\n          curValue = this.patchDelete(curValue, change);\n        }\n      }\n    }\n    return curValue;\n  }\n\n  private patchInsert(\n    curMap: Dictionary<CoreKey, ConcreteCoreValue> | undefined,\n    change: FieldChange<Dictionary<CoreKey, ConcreteCoreValue>>\n  ) {\n    if (!curMap) {\n      curMap = this.createMap();\n    }\n\n    for (const [k, v] of change.value) {\n      curMap.set(k, v);\n    }\n    return curMap;\n  }\n\n  private patchDelete(\n    curMap: Dictionary<CoreKey, ConcreteCoreValue> | undefined,\n    change: FieldChange<Dictionary<CoreKey, ConcreteCoreValue>>\n  ) {\n    if (curMap === undefined) return curMap;\n\n    for (const [k, v] of change.value) {\n      const curValue = curMap.get(k);\n      if (coreValueEquals(curValue, v)) {\n        curMap.delete(k);\n      }\n    }\n    if (!curMap.size) {\n      return undefined;\n    }\n\n    return curMap;\n  }\n\n  valueChangedDiff(\n    map1: Dictionary<CoreKey, ConcreteCoreValue>,\n    map2: Dictionary<CoreKey, ConcreteCoreValue>,\n    options?: ValueTypeOptions\n  ) {\n    map1 = map1 || this.createMap();\n    map2 = map2 || this.createMap();\n\n    const insertMap = this.createMap();\n    const deleteMap = this.createMap();\n\n    for (const [key, value1] of map1) {\n      if (!map2.has(key)) {\n        deleteMap.set(key, value1);\n        continue;\n      }\n      if (!coreValueEquals(value1, map2.get(key))) {\n        insertMap.set(key, map2.get(key));\n      }\n    }\n\n    for (const [key, value2] of map2) {\n      if (!map1.has(key)) {\n        insertMap.set(key, value2);\n      }\n    }\n\n    if (insertMap.size === 0 && deleteMap.size === 0) return;\n\n    const changes: Change<EncodedChange>[] = [];\n    if (insertMap.size > 0) {\n      changes.push(FieldChange.insert(insertMap, this.valueType));\n    }\n\n    if (deleteMap.size > 0) {\n      changes.push(FieldChange.delete(deleteMap, this.valueType));\n    }\n    return changes;\n  }\n\n  deserialize(value: DecodedValue, options?: ValueTypeOptions) {\n    const prim = value as PrimitiveMap;\n\n    const dict = dictFromPrimitive(prim);\n    const newMap = this.createMap();\n\n    for (const [k, v] of dict) {\n      newMap.set(k, v);\n    }\n    return newMap;\n  }\n\n  isEmpty(value: Dictionary<CoreKey, ConcreteCoreValue>) {\n    return value.size === 0;\n  }\n\n  private createMap(): Dictionary {\n    return new Map();\n  }\n\n  gc(\n    value: Dictionary<CoreKey, ConcreteCoreValue>\n  ): Dictionary<CoreKey, ConcreteCoreValue> | undefined {\n    return undefined;\n  }\n\n  fillRefs(\n    refs: Set<string>,\n    dict: Dictionary<ConcreteCoreValue, ConcreteCoreValue>\n  ): void {\n    if (this.isRef && dict !== undefined) {\n      for (const [key, value] of dict) {\n        if (typeof key === 'string') {\n          refs.add(key);\n        }\n        if (typeof value === 'string') {\n          refs.add(value);\n        }\n      }\n    }\n  }\n\n  rewriteRefs(\n    keyMapping: Map<string, string>,\n    dict: Dictionary<string, ConcreteCoreValue>,\n    deleteRefs?: Set<string>\n  ): Dictionary<string, ConcreteCoreValue> {\n    if (!this.isRef) {\n      return dict;\n    }\n    const result = new Map<string, ConcreteCoreValue>();\n    for (const [key, value] of dict) {\n      if (deleteRefs?.has(key) || deleteRefs?.has(value as string)) {\n        continue;\n      }\n      result.set(\n        keyMapping.get(key as string) || key,\n        keyMapping.get(value as string) || value\n      );\n    }\n    return result;\n  }\n}\n", "import { valueTypeEquals, ValueTypeOptions } from './index.ts';\nimport { CoreTypeOperations } from './core-type.ts';\nimport { Change, EncodedChange } from '../../change/index.ts';\nimport { FieldChange, FieldOperation } from '../../change/field-change.ts';\nimport { ConcreteCoreValue } from '../../../base/core-types/index.ts';\n\nexport class PrimitiveTypeOperations<\n  TValue extends ConcreteCoreValue\n> extends CoreTypeOperations<TValue> {\n  patch(\n    curValue: TValue | undefined,\n    changes: Change<EncodedChange>[],\n    options?: ValueTypeOptions\n  ): TValue | undefined {\n    for (const change of changes) {\n      if (change instanceof FieldChange) {\n        if (change.operation === FieldOperation.Insert) {\n          curValue = change.value;\n        } else if (change.operation === FieldOperation.Delete) {\n          curValue = valueTypeEquals(change.valueType, curValue, change.value)\n            ? undefined\n            : curValue;\n        }\n      }\n    }\n\n    return curValue;\n  }\n\n  valueChangedDiff(value1: TValue, value2: TValue, options?: ValueTypeOptions) {\n    if (!this.equals(value1!, value2!, options)) {\n      return FieldChange.insert(value2, this.valueType);\n    }\n  }\n\n  isEmpty(value: TValue) {\n    return false;\n  }\n}\n", "import { ValueType, ValueTypeOptions } from './index.ts';\nimport { Change, EncodedChange } from '../../change/index.ts';\nimport { CoreTypeOperations } from './core-type.ts';\nimport { FieldChange, FieldOperation } from '../../change/field-change.ts';\nimport { ConcreteCoreValue, CoreType } from '../../../base/core-types/index.ts';\nimport { DecodedValue } from '../../../base/core-types/encoding/index.ts';\nimport * as SetUtils from '../../../base/set.ts';\n\nexport class SetTypeOperations extends CoreTypeOperations<\n  Set<ConcreteCoreValue>\n> {\n  constructor(readonly isRef: boolean, valueType: ValueType) {\n    super(CoreType.Set, valueType);\n  }\n\n  patch(\n    curValue: Set<ConcreteCoreValue> | undefined,\n    changes: Change<EncodedChange>[],\n    options?: ValueTypeOptions\n  ) {\n    for (const change of changes) {\n      if (change instanceof FieldChange) {\n        if (change.operation === FieldOperation.Insert) {\n          curValue = this.patchInsert(curValue, change);\n        } else if (change.operation === FieldOperation.Delete) {\n          curValue = this.patchDelete(curValue, change);\n        }\n      }\n    }\n    return curValue;\n  }\n\n  private patchInsert(\n    curValue: Set<ConcreteCoreValue> | undefined,\n    change: FieldChange<Set<ConcreteCoreValue>>\n  ) {\n    curValue = curValue || new Set<ConcreteCoreValue>();\n    return SetUtils.unionByValue(curValue, change.value);\n  }\n\n  private patchDelete(\n    curValue: Set<ConcreteCoreValue> | undefined,\n    change: FieldChange<Set<ConcreteCoreValue>>\n  ) {\n    if (curValue === undefined) return curValue;\n\n    const newValue = SetUtils.subtractByValue(curValue, change.value);\n    return newValue.size > 0 ? newValue : undefined;\n  }\n\n  fillRefs(refs: Set<string>, value: Set<ConcreteCoreValue>): void {\n    if (this.isRef && value && value instanceof Set) {\n      for (const val of value) {\n        if (typeof val === 'string') {\n          refs.add(val);\n        }\n      }\n    }\n  }\n\n  rewriteRefs(\n    keyMapping: Map<string, string>,\n    value: Set<ConcreteCoreValue>,\n    deleteRefs?: Set<string>\n  ): Set<ConcreteCoreValue> {\n    if (!this.isRef) {\n      return value;\n    }\n    const result = new Set<ConcreteCoreValue>();\n    for (const v of value) {\n      if (!deleteRefs?.has(v as string)) {\n        result.add(keyMapping.get(v as string) || v);\n      }\n    }\n    return result;\n  }\n\n  valueChangedDiff(\n    value1: Set<ConcreteCoreValue>,\n    value2: Set<ConcreteCoreValue>,\n    options?: ValueTypeOptions\n  ) {\n    const added = SetUtils.subtractByValue(value2, value1);\n    const removed = SetUtils.subtractByValue(value1, value2);\n\n    if (added.size === 0 && removed.size === 0) {\n      return;\n    }\n\n    const changes: Change<EncodedChange>[] = [];\n\n    if (added.size) {\n      changes.push(FieldChange.insert(added, this.valueType));\n    }\n\n    if (removed.size) {\n      changes.push(FieldChange.delete(removed, this.valueType));\n    }\n\n    return changes;\n  }\n\n  isEmpty(value: Set<ConcreteCoreValue>) {\n    return value.size === 0;\n  }\n\n  deserialize(value: DecodedValue, options?: ValueTypeOptions) {\n    const desValue = super.deserialize(value, options);\n    if (desValue instanceof Array) {\n      //Backward compatibility from old deserialize that save as array of json\n      return SetUtils.from(desValue, JSON.parse);\n    }\n    return desValue;\n  }\n}\n", "import { ValueType } from './index.ts';\nimport { CoreType } from '../../../base/core-types/index.ts';\nimport { PrimitiveTypeOperations } from './primitive-type.ts';\n\nexport class StringTypeOperations extends PrimitiveTypeOperations<string> {\n  constructor(readonly isRef: boolean) {\n    super(CoreType.String, isRef ? ValueType.REF : ValueType.STRING);\n  }\n\n  fillRefs(refs: Set<string>, value: string): void {\n    if (this.isRef) {\n      refs.add(value);\n    }\n  }\n}\n", "/* eslint-disable */\n/**\n * Diff Match and Patch\n * Copyright 2018 The diff-match-patch Authors.\n * https://github.com/google/diff-match-patch\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * This file has been modified from diff-match-patch.js to diff-match-patch.ts\n * by Ofri Wolfus on 12/10/22. Minimal changes have been made to provide Deno/TS\n * compatibility.\n */\n\n/**\n * @fileoverview Computes the difference between two texts to create a patch.\n * Applies the patch onto another text, allowing for errors.\n * @author fraser@google.com (Neil Fraser)\n */\n\n// Define some regex patterns for matching boundaries.\nconst kNonAlphaNumericRegex_ = /[^a-zA-Z0-9]/;\nconst kWhitespaceRegex_ = /\\s/;\nconst kLinebreakRegex_ = /[\\r\\n]/;\nconst kBlanklineEndRegex_ = /\\n\\r?\\n$/;\nconst kBlanklineStartRegex_ = /^\\r?\\n\\r?\\n/;\n\n//  DIFF FUNCTIONS\n\n/**\n * The data structure representing a diff is an array of tuples:\n * [[DIFF_DELETE, 'Hello'], [DIFF_INSERT, 'Goodbye'], [DIFF_EQUAL, ' world.']]\n * which means: delete 'Hello', add 'Goodbye' and keep ' world.'\n */\nexport enum DiffOp {\n  Delete = -1,\n  Insert = 1,\n  Equal = 0,\n}\n\nexport const DIFF_DELETE = DiffOp.Delete;\nexport const DIFF_INSERT = DiffOp.Insert;\nexport const DIFF_EQUAL = DiffOp.Equal;\n\n/**\n * Class representing one diff tuple.\n * Attempts to look like a two-element array (which is what this used to be).\n * @param {number} op Operation, one of: DIFF_DELETE, DIFF_INSERT, DIFF_EQUAL.\n * @param {string} text Text to be deleted, inserted, or retained.\n * @constructor\n */\nexport type Diff = [DiffOp, string];\n\n/**\n * Class containing the diff, match and patch methods.\n * @constructor\n */\nexport class DiffMatchPatch {\n  // Defaults.\n  // Redefine these in your program to override the defaults.\n\n  // Number of seconds to map a diff before giving up (0 for infinity).\n  public Diff_Timeout = 1.0;\n  // Cost of an empty edit operation in terms of edit characters.\n  public Diff_EditCost = 4;\n  // At what point is no match declared (0.0 = perfection, 1.0 = very loose).\n  public Match_Threshold = 0.5;\n  // How far to search for a match (0 = exact location, 1000+ = broad match).\n  // A match this many characters away from the expected location will add\n  // 1.0 to the score (0.0 is a perfect match).\n  public Match_Distance = 1000;\n  // When deleting a large block of text (over ~64 characters), how close do\n  // the contents have to be to match the expected contents. (0.0 = perfection,\n  // 1.0 = very loose).  Note that Match_Threshold controls how closely the\n  // end points of a delete need to match.\n  public Patch_DeleteThreshold = 0.5;\n  // Chunk size for context length.\n  public Patch_Margin = 4;\n\n  // The number of bits in an int.\n  public Match_MaxBits = 32;\n  /**\n   * Find the differences between two texts.  Simplifies the problem by stripping\n   * any common prefix or suffix off the texts before diffing.\n   * @param {string} text1 Old string to be diffed.\n   * @param {string} text2 New string to be diffed.\n   * @param {boolean=} opt_checklines Optional speedup flag. If present and false,\n   *     then don't run a line-level diff first to identify the changed areas.\n   *     Defaults to true, which does a faster, slightly less optimal diff.\n   * @param {number=} opt_deadline Optional time when the diff should be complete\n   *     by.  Used internally for recursive calls.  Users should set DiffTimeout\n   *     instead.\n   * @return {!Array.<!diff_match_patch.Diff>} Array of diff tuples.\n   */\n  diff_main(\n    text1: string,\n    text2: string,\n    opt_checklines?: boolean,\n    opt_deadline?: number\n  ): Diff[] {\n    // Set a deadline by which time the diff must be complete.\n    if (typeof opt_deadline == 'undefined') {\n      if (this.Diff_Timeout <= 0) {\n        opt_deadline = Number.MAX_VALUE;\n      } else {\n        opt_deadline = new Date().getTime() + this.Diff_Timeout * 1000;\n      }\n    }\n    const deadline = opt_deadline;\n\n    // Check for null inputs.\n    if (text1 == null || text2 == null) {\n      throw new Error('Null input. (diff_main)');\n    }\n\n    // Check for equality (speedup).\n    if (text1 == text2) {\n      if (text1) {\n        return [[DIFF_EQUAL, text1]];\n      }\n      return [];\n    }\n\n    if (typeof opt_checklines == 'undefined') {\n      opt_checklines = true;\n    }\n    const checklines = opt_checklines!;\n\n    // Trim off common prefix (speedup).\n    let commonlength = this.diff_commonPrefix(text1, text2);\n    const commonprefix = text1.substring(0, commonlength);\n    text1 = text1.substring(commonlength);\n    text2 = text2.substring(commonlength);\n\n    // Trim off common suffix (speedup).\n    commonlength = this.diff_commonSuffix(text1, text2);\n    const commonsuffix = text1.substring(text1.length - commonlength);\n    text1 = text1.substring(0, text1.length - commonlength);\n    text2 = text2.substring(0, text2.length - commonlength);\n\n    // Compute the diff on the middle block.\n    const diffs = this.diff_compute_(text1, text2, checklines, deadline);\n\n    // Restore the prefix and suffix.\n    if (commonprefix) {\n      diffs.unshift([DIFF_EQUAL, commonprefix]);\n    }\n    if (commonsuffix) {\n      diffs.push([DIFF_EQUAL, commonsuffix]);\n    }\n    this.diff_cleanupMerge(diffs);\n    return diffs;\n  }\n\n  /**\n   * Find the differences between two texts.  Assumes that the texts do not\n   * have any common prefix or suffix.\n   * @param {string} text1 Old string to be diffed.\n   * @param {string} text2 New string to be diffed.\n   * @param {boolean} checklines Speedup flag.  If false, then don't run a\n   *     line-level diff first to identify the changed areas.\n   *     If true, then run a faster, slightly less optimal diff.\n   * @param {number} deadline Time when the diff should be complete by.\n   * @return {!Array.<!diff_match_patch.Diff>} Array of diff tuples.\n   * @private\n   */\n  private diff_compute_(\n    text1: string,\n    text2: string,\n    checklines: boolean,\n    deadline: number\n  ): Diff[] {\n    let diffs: Diff[];\n\n    if (!text1) {\n      // Just add some text (speedup).\n      return [[DIFF_INSERT, text2]];\n    }\n\n    if (!text2) {\n      // Just delete some text (speedup).\n      return [[DIFF_DELETE, text1]];\n    }\n\n    const longtext = text1.length > text2.length ? text1 : text2;\n    const shorttext = text1.length > text2.length ? text2 : text1;\n    const i = longtext.indexOf(shorttext);\n    if (i != -1) {\n      // Shorter text is inside the longer text (speedup).\n      diffs = [\n        [DIFF_INSERT, longtext.substring(0, i)],\n        [DIFF_EQUAL, shorttext],\n        [DIFF_INSERT, longtext.substring(i + shorttext.length)],\n      ];\n      // Swap insertions for deletions if diff is reversed.\n      if (text1.length > text2.length) {\n        diffs[0][0] = diffs[2][0] = DIFF_DELETE;\n      }\n      return diffs;\n    }\n\n    if (shorttext.length == 1) {\n      // Single character string.\n      // After the previous speedup, the character can't be an equality.\n      return [\n        [DIFF_DELETE, text1],\n        [DIFF_INSERT, text2],\n      ];\n    }\n\n    // Check to see if the problem can be split in two.\n    const hm = this.diff_halfMatch_(text1, text2);\n    if (hm) {\n      // A half-match was found, sort out the return data.\n      const text1_a = hm[0];\n      const text1_b = hm[1];\n      const text2_a = hm[2];\n      const text2_b = hm[3];\n      const mid_common = hm[4];\n      // Send both pairs off for separate processing.\n      const diffs_a = this.diff_main(text1_a, text2_a, checklines, deadline);\n      const diffs_b = this.diff_main(text1_b, text2_b, checklines, deadline);\n      // Merge the results.\n      return diffs_a.concat([[DIFF_EQUAL, mid_common]], diffs_b);\n    }\n\n    if (checklines && text1.length > 100 && text2.length > 100) {\n      return this.diff_lineMode_(text1, text2, deadline);\n    }\n\n    return this.diff_bisect_(text1, text2, deadline);\n  }\n\n  /**\n   * Do a quick line-level diff on both strings, then rediff the parts for\n   * greater accuracy.\n   * This speedup can produce non-minimal diffs.\n   * @param {string} text1 Old string to be diffed.\n   * @param {string} text2 New string to be diffed.\n   * @param {number} deadline Time when the diff should be complete by.\n   * @return {!Array.<!diff_match_patch.Diff>} Array of diff tuples.\n   * @private\n   */\n  private diff_lineMode_(\n    text1: string,\n    text2: string,\n    deadline: number\n  ): Diff[] {\n    // Scan the text on a line-by-line basis first.\n    const a = this.diff_linesToChars_(text1, text2);\n    text1 = a.chars1;\n    text2 = a.chars2;\n    const linearray = a.lineArray;\n\n    const diffs = this.diff_main(text1, text2, false, deadline);\n\n    // Convert the diff back to original text.\n    this.diff_charsToLines_(diffs, linearray);\n    // Eliminate freak matches (e.g. blank lines)\n    this.diff_cleanupSemantic(diffs);\n\n    // Rediff any replacement blocks, this time character-by-character.\n    // Add a dummy entry at the end.\n    diffs.push([DIFF_EQUAL, '']);\n    let pointer = 0;\n    let count_delete = 0;\n    let count_insert = 0;\n    let text_delete = '';\n    let text_insert = '';\n    while (pointer < diffs.length) {\n      switch (diffs[pointer][0]) {\n        case DIFF_INSERT:\n          count_insert++;\n          text_insert += diffs[pointer][1];\n          break;\n        case DIFF_DELETE:\n          count_delete++;\n          text_delete += diffs[pointer][1];\n          break;\n        case DIFF_EQUAL:\n          // Upon reaching an equality, check for prior redundancies.\n          if (count_delete >= 1 && count_insert >= 1) {\n            // Delete the offending records and add the merged ones.\n            diffs.splice(\n              pointer - count_delete - count_insert,\n              count_delete + count_insert\n            );\n            pointer = pointer - count_delete - count_insert;\n            const subDiff = this.diff_main(\n              text_delete,\n              text_insert,\n              false,\n              deadline\n            );\n            for (let j = subDiff.length - 1; j >= 0; j--) {\n              diffs.splice(pointer, 0, subDiff[j]);\n            }\n            pointer = pointer + subDiff.length;\n          }\n          count_insert = 0;\n          count_delete = 0;\n          text_delete = '';\n          text_insert = '';\n          break;\n        default:\n          break;\n      }\n      pointer++;\n    }\n    diffs.pop(); // Remove the dummy entry at the end.\n\n    return diffs;\n  }\n\n  /**\n   * Find the 'middle snake' of a diff, split the problem in two\n   * and return the recursively constructed diff.\n   * See Myers 1986 paper: An O(ND) Difference Algorithm and Its Variations.\n   * @param {string} text1 Old string to be diffed.\n   * @param {string} text2 New string to be diffed.\n   * @param {number} deadline Time at which to bail if not yet complete.\n   * @return {!Array.<!diff_match_patch.Diff>} Array of diff tuples.\n   * @private\n   */\n  private diff_bisect_(text1: string, text2: string, deadline: number): Diff[] {\n    // Cache the text lengths to prevent multiple calls.\n    const text1_length = text1.length;\n    const text2_length = text2.length;\n    const max_d = Math.ceil((text1_length + text2_length) / 2);\n    const v_offset = max_d;\n    const v_length = 2 * max_d;\n    const v1 = new Array(v_length);\n    const v2 = new Array(v_length);\n    // Setting all elements to -1 is faster in Chrome & Firefox than mixing\n    // integers and undefined.\n    for (let x = 0; x < v_length; x++) {\n      v1[x] = -1;\n      v2[x] = -1;\n    }\n    v1[v_offset + 1] = 0;\n    v2[v_offset + 1] = 0;\n    const delta = text1_length - text2_length;\n    // If the total number of characters is odd, then the front path will collide\n    // with the reverse path.\n    const front = delta % 2 !== 0;\n    // Offsets for start and end of k loop.\n    // Prevents mapping of space beyond the grid.\n    let k1start = 0;\n    let k1end = 0;\n    let k2start = 0;\n    let k2end = 0;\n    for (let d = 0; d < max_d; d++) {\n      // Bail out if deadline is reached.\n      if (new Date().getTime() > deadline) {\n        break;\n      }\n\n      // Walk the front path one step.\n      for (let k1 = -d + k1start; k1 <= d - k1end; k1 += 2) {\n        const k1_offset = v_offset + k1;\n        let x1;\n        if (k1 === -d || (k1 !== d && v1[k1_offset - 1] < v1[k1_offset + 1])) {\n          x1 = v1[k1_offset + 1];\n        } else {\n          x1 = v1[k1_offset - 1] + 1;\n        }\n        let y1 = x1 - k1;\n        while (\n          x1 < text1_length &&\n          y1 < text2_length &&\n          text1.charAt(x1) === text2.charAt(y1)\n        ) {\n          x1++;\n          y1++;\n        }\n        v1[k1_offset] = x1;\n        if (x1 > text1_length) {\n          // Ran off the right of the graph.\n          k1end += 2;\n        } else if (y1 > text2_length) {\n          // Ran off the bottom of the graph.\n          k1start += 2;\n        } else if (front) {\n          const k2_offset = v_offset + delta - k1;\n          if (k2_offset >= 0 && k2_offset < v_length && v2[k2_offset] !== -1) {\n            // Mirror x2 onto top-left coordinate system.\n            const x2 = text1_length - v2[k2_offset];\n            if (x1 >= x2) {\n              // Overlap detected.\n              return this.diff_bisectSplit_(text1, text2, x1, y1, deadline);\n            }\n          }\n        }\n      }\n\n      // Walk the reverse path one step.\n      for (let k2 = -d + k2start; k2 <= d - k2end; k2 += 2) {\n        const k2_offset = v_offset + k2;\n        let x2;\n        if (k2 === -d || (k2 !== d && v2[k2_offset - 1] < v2[k2_offset + 1])) {\n          x2 = v2[k2_offset + 1];\n        } else {\n          x2 = v2[k2_offset - 1] + 1;\n        }\n        let y2 = x2 - k2;\n        while (\n          x2 < text1_length &&\n          y2 < text2_length &&\n          text1.charAt(text1_length - x2 - 1) ===\n            text2.charAt(text2_length - y2 - 1)\n        ) {\n          x2++;\n          y2++;\n        }\n        v2[k2_offset] = x2;\n        if (x2 > text1_length) {\n          // Ran off the left of the graph.\n          k2end += 2;\n        } else if (y2 > text2_length) {\n          // Ran off the top of the graph.\n          k2start += 2;\n        } else if (!front) {\n          const k1_offset = v_offset + delta - k2;\n          if (k1_offset >= 0 && k1_offset < v_length && v1[k1_offset] != -1) {\n            const x1 = v1[k1_offset];\n            const y1 = v_offset + x1 - k1_offset;\n            // Mirror x2 onto top-left coordinate system.\n            x2 = text1_length - x2;\n            if (x1 >= x2) {\n              // Overlap detected.\n              return this.diff_bisectSplit_(text1, text2, x1, y1, deadline);\n            }\n          }\n        }\n      }\n    }\n    // Diff took too long and hit the deadline or\n    // number of diffs equals number of characters, no commonality at all.\n    return [\n      [DIFF_DELETE, text1],\n      [DIFF_INSERT, text2],\n    ];\n  }\n\n  /**\n   * Given the location of the 'middle snake', split the diff in two parts\n   * and recurse.\n   * @param {string} text1 Old string to be diffed.\n   * @param {string} text2 New string to be diffed.\n   * @param {number} x Index of split point in text1.\n   * @param {number} y Index of split point in text2.\n   * @param {number} deadline Time at which to bail if not yet complete.\n   * @return {!Array.<!diff_match_patch.Diff>} Array of diff tuples.\n   * @private\n   */\n  private diff_bisectSplit_(\n    text1: string,\n    text2: string,\n    x: number,\n    y: number,\n    deadline: number\n  ): Diff[] {\n    const text1a = text1.substring(0, x);\n    const text2a = text2.substring(0, y);\n    const text1b = text1.substring(x);\n    const text2b = text2.substring(y);\n\n    // Compute both diffs serially.\n    const diffs = this.diff_main(text1a, text2a, false, deadline);\n    const diffsb = this.diff_main(text1b, text2b, false, deadline);\n\n    return diffs.concat(diffsb);\n  }\n\n  /**\n   * Split two texts into an array of strings.  Reduce the texts to a string of\n   * hashes where each Unicode character represents one line.\n   * @param {string} text1 First string.\n   * @param {string} text2 Second string.\n   * @return {{chars1: string, chars2: string, lineArray: !Array.<string>}}\n   *     An object containing the encoded text1, the encoded text2 and\n   *     the array of unique strings.\n   *     The zeroth element of the array of unique strings is intentionally blank.\n   * @private\n   */\n  private diff_linesToChars_(\n    text1: string,\n    text2: string\n  ): { chars1: string; chars2: string; lineArray: string[] } {\n    const lineArray = []; // e.g. lineArray[4] == 'Hello\\n'\n    const lineHash: { [key: string]: number } = {}; // e.g. lineHash['Hello\\n'] == 4\n\n    // '\\x00' is a valid character, but various debuggers don't like it.\n    // So we'll insert a junk entry to avoid generating a null character.\n    lineArray[0] = '';\n\n    /**\n     * Split a text into an array of strings.  Reduce the texts to a string of\n     * hashes where each Unicode character represents one line.\n     * Modifies linearray and linehash through being a closure.\n     * @param {string} text String to encode.\n     * @return {string} Encoded string.\n     * @private\n     */\n    function diff_linesToCharsMunge_(text: string): string {\n      let chars = '';\n      // Walk the text, pulling out a substring for each line.\n      // text.split('\\n') would would temporarily double our memory footprint.\n      // Modifying text would create many large strings to garbage collect.\n      let lineStart = 0;\n      let lineEnd = -1;\n      // Keeping our own length variable is faster than looking it up.\n      let lineArrayLength = lineArray.length;\n      while (lineEnd < text.length - 1) {\n        lineEnd = text.indexOf('\\n', lineStart);\n        if (lineEnd === -1) {\n          lineEnd = text.length - 1;\n        }\n        let line = text.substring(lineStart, lineEnd + 1);\n\n        if (\n          lineHash.hasOwnProperty\n            ? lineHash.hasOwnProperty(line)\n            : lineHash[line] !== undefined\n        ) {\n          chars += String.fromCharCode(lineHash[line]);\n        } else {\n          if (lineArrayLength === maxLines) {\n            // Bail out at 65535 because\n            // String.fromCharCode(65536) == String.fromCharCode(0)\n            line = text.substring(lineStart);\n            lineEnd = text.length;\n          }\n          chars += String.fromCharCode(lineArrayLength);\n          lineHash[line] = lineArrayLength;\n          lineArray[lineArrayLength++] = line;\n        }\n        lineStart = lineEnd + 1;\n      }\n      return chars;\n    }\n    // Allocate 2/3rds of the space for text1, the rest for text2.\n    let maxLines = 40000;\n    const chars1 = diff_linesToCharsMunge_(text1);\n    maxLines = 65535;\n    const chars2 = diff_linesToCharsMunge_(text2);\n    return { chars1: chars1, chars2: chars2, lineArray: lineArray };\n  }\n\n  /**\n   * Rehydrate the text in a diff from a string of line hashes to real lines of\n   * text.\n   * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n   * @param {!Array.<string>} lineArray Array of unique strings.\n   * @private\n   */\n  private diff_charsToLines_(diffs: Diff[], lineArray: string[]): void {\n    for (let i = 0; i < diffs.length; i++) {\n      const chars = diffs[i][1];\n      const text = [];\n      for (let j = 0; j < chars.length; j++) {\n        text[j] = lineArray[chars.charCodeAt(j)];\n      }\n      diffs[i][1] = text.join('');\n    }\n  }\n\n  /**\n   * Determine the common prefix of two strings.\n   * @param {string} text1 First string.\n   * @param {string} text2 Second string.\n   * @return {number} The number of characters common to the start of each\n   *     string.\n   */\n  diff_commonPrefix(text1: string, text2: string): number {\n    // Quick check for common null cases.\n    if (!text1 || !text2 || text1.charAt(0) != text2.charAt(0)) {\n      return 0;\n    }\n    // Binary search.\n    // Performance analysis: https://neil.fraser.name/news/2007/10/09/\n    let pointermin = 0;\n    let pointermax = Math.min(text1.length, text2.length);\n    let pointermid = pointermax;\n    let pointerstart = 0;\n    while (pointermin < pointermid) {\n      if (\n        text1.substring(pointerstart, pointermid) ==\n        text2.substring(pointerstart, pointermid)\n      ) {\n        pointermin = pointermid;\n        pointerstart = pointermin;\n      } else {\n        pointermax = pointermid;\n      }\n      pointermid = Math.floor((pointermax - pointermin) / 2 + pointermin);\n    }\n    return pointermid;\n  }\n\n  /**\n   * Determine the common suffix of two strings.\n   * @param {string} text1 First string.\n   * @param {string} text2 Second string.\n   * @return {number} The number of characters common to the end of each string.\n   */\n  diff_commonSuffix(text1: string, text2: string): number {\n    // Quick check for common null cases.\n    if (\n      !text1 ||\n      !text2 ||\n      text1.charAt(text1.length - 1) != text2.charAt(text2.length - 1)\n    ) {\n      return 0;\n    }\n    // Binary search.\n    // Performance analysis: https://neil.fraser.name/news/2007/10/09/\n    let pointermin = 0;\n    let pointermax = Math.min(text1.length, text2.length);\n    let pointermid = pointermax;\n    let pointerend = 0;\n    while (pointermin < pointermid) {\n      if (\n        text1.substring(text1.length - pointermid, text1.length - pointerend) ==\n        text2.substring(text2.length - pointermid, text2.length - pointerend)\n      ) {\n        pointermin = pointermid;\n        pointerend = pointermin;\n      } else {\n        pointermax = pointermid;\n      }\n      pointermid = Math.floor((pointermax - pointermin) / 2 + pointermin);\n    }\n    return pointermid;\n  }\n\n  /**\n   * Determine if the suffix of one string is the prefix of another.\n   * @param {string} text1 First string.\n   * @param {string} text2 Second string.\n   * @return {number} The number of characters common to the end of the first\n   *     string and the start of the second string.\n   * @private\n   */\n  private diff_commonOverlap_(text1: string, text2: string): number {\n    // Cache the text lengths to prevent multiple calls.\n    const text1_length = text1.length;\n    const text2_length = text2.length;\n    // Eliminate the null case.\n    if (text1_length == 0 || text2_length == 0) {\n      return 0;\n    }\n    // Truncate the longer string.\n    if (text1_length > text2_length) {\n      text1 = text1.substring(text1_length - text2_length);\n    } else if (text1_length < text2_length) {\n      text2 = text2.substring(0, text1_length);\n    }\n    const text_length = Math.min(text1_length, text2_length);\n    // Quick check for the worst case.\n    if (text1 == text2) {\n      return text_length;\n    }\n\n    // Start by looking for a single character match\n    // and increase length until no match is found.\n    // Performance analysis: https://neil.fraser.name/news/2010/11/04/\n    let best = 0;\n    let length = 1;\n    while (true) {\n      const pattern = text1.substring(text_length - length);\n      const found = text2.indexOf(pattern);\n      if (found == -1) {\n        return best;\n      }\n      length += found;\n      if (\n        found == 0 ||\n        text1.substring(text_length - length) == text2.substring(0, length)\n      ) {\n        best = length;\n        length++;\n      }\n    }\n  }\n\n  /**\n   * Do the two texts share a substring which is at least half the length of the\n   * longer text?\n   * This speedup can produce non-minimal diffs.\n   * @param {string} text1 First string.\n   * @param {string} text2 Second string.\n   * @return {Array.<string>} Five element Array, containing the prefix of\n   *     text1, the suffix of text1, the prefix of text2, the suffix of\n   *     text2 and the common middle.  Or null if there was no match.\n   * @private\n   */\n  private diff_halfMatch_(text1: string, text2: string): string[] | null {\n    if (this.Diff_Timeout <= 0) {\n      // Don't risk returning a non-optimal diff if we have unlimited time.\n      return null;\n    }\n    const longtext = text1.length > text2.length ? text1 : text2;\n    const shorttext = text1.length > text2.length ? text2 : text1;\n    if (longtext.length < 4 || shorttext.length * 2 < longtext.length) {\n      return null; // Pointless.\n    }\n    const dmp = this; // 'this' becomes 'window' in a closure.\n\n    /**\n     * Does a substring of shorttext exist within longtext such that the substring\n     * is at least half the length of longtext?\n     * Closure, but does not reference any external variables.\n     * @param {string} longtext Longer string.\n     * @param {string} shorttext Shorter string.\n     * @param {number} i Start index of quarter length substring within longtext.\n     * @return {Array.<string>} Five element Array, containing the prefix of\n     *     longtext, the suffix of longtext, the prefix of shorttext, the suffix\n     *     of shorttext and the common middle.  Or null if there was no match.\n     * @private\n     */\n    function diff_halfMatchI_(\n      longtext: string,\n      shorttext: string,\n      i: number\n    ): string[] | null {\n      // Start with a 1/4 length substring at position i as a seed.\n      const seed = longtext.substring(i, i + Math.floor(longtext.length / 4));\n      let j = -1;\n      let best_common = '';\n      let best_longtext_a: string,\n        best_longtext_b: string,\n        best_shorttext_a: string,\n        best_shorttext_b: string;\n      while ((j = shorttext.indexOf(seed, j + 1)) != -1) {\n        const prefixLength = dmp.diff_commonPrefix(\n          longtext.substring(i),\n          shorttext.substring(j)\n        );\n        const suffixLength = dmp.diff_commonSuffix(\n          longtext.substring(0, i),\n          shorttext.substring(0, j)\n        );\n        if (best_common.length < suffixLength + prefixLength) {\n          best_common =\n            shorttext.substring(j - suffixLength, j) +\n            shorttext.substring(j, j + prefixLength);\n          best_longtext_a = longtext.substring(0, i - suffixLength);\n          best_longtext_b = longtext.substring(i + prefixLength);\n          best_shorttext_a = shorttext.substring(0, j - suffixLength);\n          best_shorttext_b = shorttext.substring(j + prefixLength);\n        }\n      }\n      if (best_common.length * 2 >= longtext.length) {\n        return [\n          best_longtext_a!,\n          best_longtext_b!,\n          best_shorttext_a!,\n          best_shorttext_b!,\n          best_common,\n        ];\n      } else {\n        return null;\n      }\n    }\n\n    // First check if the second quarter is the seed for a half-match.\n    const hm1 = diff_halfMatchI_(\n      longtext,\n      shorttext,\n      Math.ceil(longtext.length / 4)\n    );\n    // Check again based on the third quarter.\n    const hm2 = diff_halfMatchI_(\n      longtext,\n      shorttext,\n      Math.ceil(longtext.length / 2)\n    );\n    let hm;\n    if (!hm1 && !hm2) {\n      return null;\n    } else if (!hm2) {\n      hm = hm1;\n    } else if (!hm1) {\n      hm = hm2;\n    } else {\n      // Both matched.  Select the longest.\n      hm = hm1[4].length > hm2[4].length ? hm1 : hm2;\n    }\n\n    // A half-match was found, sort out the return data.\n    let text1_a, text1_b, text2_a, text2_b;\n    if (text1.length > text2.length) {\n      text1_a = hm![0];\n      text1_b = hm![1];\n      text2_a = hm![2];\n      text2_b = hm![3];\n    } else {\n      text2_a = hm![0];\n      text2_b = hm![1];\n      text1_a = hm![2];\n      text1_b = hm![3];\n    }\n    const mid_common = hm![4];\n    return [text1_a, text1_b, text2_a, text2_b, mid_common];\n  }\n\n  /**\n   * Reduce the number of edits by eliminating semantically trivial equalities.\n   * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n   */\n  diff_cleanupSemantic(diffs: Diff[]): void {\n    let changes = false;\n    const equalities = []; // Stack of indices where equalities are found.\n    let equalitiesLength = 0; // Keeping our own length const is faster in JS.\n    /** @type {?string} */\n    let lastEquality = null;\n    // Always equal to diffs[equalities[equalitiesLength - 1]][1]\n    let pointer = 0; // Index of current position.\n    // Number of characters that changed prior to the equality.\n    let length_insertions1 = 0;\n    let length_deletions1 = 0;\n    // Number of characters that changed after the equality.\n    let length_insertions2 = 0;\n    let length_deletions2 = 0;\n    while (pointer < diffs.length) {\n      if (diffs[pointer][0] == DIFF_EQUAL) {\n        // Equality found.\n        equalities[equalitiesLength++] = pointer;\n        length_insertions1 = length_insertions2;\n        length_deletions1 = length_deletions2;\n        length_insertions2 = 0;\n        length_deletions2 = 0;\n        lastEquality = diffs[pointer][1];\n      } else {\n        // An insertion or deletion.\n        if (diffs[pointer][0] == DIFF_INSERT) {\n          length_insertions2 += diffs[pointer][1].length;\n        } else {\n          length_deletions2 += diffs[pointer][1].length;\n        }\n        // Eliminate an equality that is smaller or equal to the edits on both\n        // sides of it.\n        if (\n          lastEquality &&\n          lastEquality.length <=\n            Math.max(length_insertions1, length_deletions1) &&\n          lastEquality.length <= Math.max(length_insertions2, length_deletions2)\n        ) {\n          // Duplicate record.\n          diffs.splice(equalities[equalitiesLength - 1], 0, [\n            DIFF_DELETE,\n            lastEquality,\n          ]);\n          // Change second copy to insert.\n          diffs[equalities[equalitiesLength - 1] + 1][0] = DIFF_INSERT;\n          // Throw away the equality we just deleted.\n          equalitiesLength--;\n          // Throw away the previous equality (it needs to be reevaluated).\n          equalitiesLength--;\n          pointer =\n            equalitiesLength > 0 ? equalities[equalitiesLength - 1] : -1;\n          length_insertions1 = 0; // Reset the counters.\n          length_deletions1 = 0;\n          length_insertions2 = 0;\n          length_deletions2 = 0;\n          lastEquality = null;\n          changes = true;\n        }\n      }\n      pointer++;\n    }\n\n    // Normalize the diff.\n    if (changes) {\n      this.diff_cleanupMerge(diffs);\n    }\n    this.diff_cleanupSemanticLossless(diffs);\n\n    // Find any overlaps between deletions and insertions.\n    // e.g: <del>abcxxx</del><ins>xxxdef</ins>\n    //   -> <del>abc</del>xxx<ins>def</ins>\n    // e.g: <del>xxxabc</del><ins>defxxx</ins>\n    //   -> <ins>def</ins>xxx<del>abc</del>\n    // Only extract an overlap if it is as big as the edit ahead or behind it.\n    pointer = 1;\n    while (pointer < diffs.length) {\n      if (\n        diffs[pointer - 1][0] == DIFF_DELETE &&\n        diffs[pointer][0] == DIFF_INSERT\n      ) {\n        const deletion = diffs[pointer - 1][1];\n        const insertion = diffs[pointer][1];\n        const overlap_length1 = this.diff_commonOverlap_(deletion, insertion);\n        const overlap_length2 = this.diff_commonOverlap_(insertion, deletion);\n        if (overlap_length1 >= overlap_length2) {\n          if (\n            overlap_length1 >= deletion.length / 2 ||\n            overlap_length1 >= insertion.length / 2\n          ) {\n            // Overlap found.  Insert an equality and trim the surrounding edits.\n            diffs.splice(pointer, 0, [\n              DIFF_EQUAL,\n              insertion.substring(0, overlap_length1),\n            ]);\n            diffs[pointer - 1][1] = deletion.substring(\n              0,\n              deletion.length - overlap_length1\n            );\n            diffs[pointer + 1][1] = insertion.substring(overlap_length1);\n            pointer++;\n          }\n        } else {\n          if (\n            overlap_length2 >= deletion.length / 2 ||\n            overlap_length2 >= insertion.length / 2\n          ) {\n            // Reverse overlap found.\n            // Insert an equality and swap and trim the surrounding edits.\n            diffs.splice(pointer, 0, [\n              DIFF_EQUAL,\n              deletion.substring(0, overlap_length2),\n            ]);\n            diffs[pointer - 1][0] = DIFF_INSERT;\n            diffs[pointer - 1][1] = insertion.substring(\n              0,\n              insertion.length - overlap_length2\n            );\n            diffs[pointer + 1][0] = DIFF_DELETE;\n            diffs[pointer + 1][1] = deletion.substring(overlap_length2);\n            pointer++;\n          }\n        }\n        pointer++;\n      }\n      pointer++;\n    }\n  }\n\n  /**\n   * Look for single edits surrounded on both sides by equalities\n   * which can be shifted sideways to align the edit to a word boundary.\n   * e.g: The c<ins>at c</ins>ame. -> The <ins>cat </ins>came.\n   * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n   */\n  diff_cleanupSemanticLossless(diffs: Diff[]): void {\n    /**\n     * Given two strings, compute a score representing whether the internal\n     * boundary falls on logical boundaries.\n     * Scores range from 6 (best) to 0 (worst).\n     * Closure, but does not reference any external variables.\n     * @param {string} one First string.\n     * @param {string} two Second string.\n     * @return {number} The score.\n     * @private\n     */\n    function diff_cleanupSemanticScore_(one: string, two: string): number {\n      if (!one || !two) {\n        // Edges are the best.\n        return 6;\n      }\n\n      // Each port of this function behaves slightly differently due to\n      // subtle differences in each language's definition of things like\n      // 'whitespace'.  Since this function's purpose is largely cosmetic,\n      // the choice has been made to use each language's native features\n      // rather than force total conformity.\n      const char1 = one.charAt(one.length - 1);\n      const char2 = two.charAt(0);\n      const nonAlphaNumeric1 = char1.match(kNonAlphaNumericRegex_);\n      const nonAlphaNumeric2 = char2.match(kNonAlphaNumericRegex_);\n      const whitespace1 = nonAlphaNumeric1 && char1.match(kWhitespaceRegex_);\n      const whitespace2 = nonAlphaNumeric2 && char2.match(kWhitespaceRegex_);\n      const lineBreak1 = whitespace1 && char1.match(kLinebreakRegex_);\n      const lineBreak2 = whitespace2 && char2.match(kLinebreakRegex_);\n      const blankLine1 = lineBreak1 && one.match(kBlanklineEndRegex_);\n      const blankLine2 = lineBreak2 && two.match(kBlanklineStartRegex_);\n\n      if (blankLine1 || blankLine2) {\n        // Five points for blank lines.\n        return 5;\n      } else if (lineBreak1 || lineBreak2) {\n        // Four points for line breaks.\n        return 4;\n      } else if (nonAlphaNumeric1 && !whitespace1 && whitespace2) {\n        // Three points for end of sentences.\n        return 3;\n      } else if (whitespace1 || whitespace2) {\n        // Two points for whitespace.\n        return 2;\n      } else if (nonAlphaNumeric1 || nonAlphaNumeric2) {\n        // One point for non-alphanumeric.\n        return 1;\n      }\n      return 0;\n    }\n\n    let pointer = 1;\n    // Intentionally ignore the first and last element (don't need checking).\n    while (pointer < diffs.length - 1) {\n      if (\n        diffs[pointer - 1][0] == DIFF_EQUAL &&\n        diffs[pointer + 1][0] == DIFF_EQUAL\n      ) {\n        // This is a single edit surrounded by equalities.\n        let equality1 = diffs[pointer - 1][1];\n        let edit = diffs[pointer][1];\n        let equality2 = diffs[pointer + 1][1];\n\n        // First, shift the edit as far left as possible.\n        const commonOffset = this.diff_commonSuffix(equality1, edit);\n        if (commonOffset) {\n          const commonString = edit.substring(edit.length - commonOffset);\n          equality1 = equality1.substring(0, equality1.length - commonOffset);\n          edit = commonString + edit.substring(0, edit.length - commonOffset);\n          equality2 = commonString + equality2;\n        }\n\n        // Second, step character by character right, looking for the best fit.\n        let bestEquality1 = equality1;\n        let bestEdit = edit;\n        let bestEquality2 = equality2;\n        let bestScore =\n          diff_cleanupSemanticScore_(equality1, edit) +\n          diff_cleanupSemanticScore_(edit, equality2);\n        while (edit.charAt(0) === equality2.charAt(0)) {\n          equality1 += edit.charAt(0);\n          edit = edit.substring(1) + equality2.charAt(0);\n          equality2 = equality2.substring(1);\n          const score =\n            diff_cleanupSemanticScore_(equality1, edit) +\n            diff_cleanupSemanticScore_(edit, equality2);\n          // The >= encourages trailing rather than leading whitespace on edits.\n          if (score >= bestScore) {\n            bestScore = score;\n            bestEquality1 = equality1;\n            bestEdit = edit;\n            bestEquality2 = equality2;\n          }\n        }\n\n        if (diffs[pointer - 1][1] != bestEquality1) {\n          // We have an improvement, save it back to the diff.\n          if (bestEquality1) {\n            diffs[pointer - 1][1] = bestEquality1;\n          } else {\n            diffs.splice(pointer - 1, 1);\n            pointer--;\n          }\n          diffs[pointer][1] = bestEdit;\n          if (bestEquality2) {\n            diffs[pointer + 1][1] = bestEquality2;\n          } else {\n            diffs.splice(pointer + 1, 1);\n            pointer--;\n          }\n        }\n      }\n      pointer++;\n    }\n  }\n\n  /**\n   * Reduce the number of edits by eliminating operationally trivial equalities.\n   * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n   */\n  diff_cleanupEfficiency(diffs: Diff[]): void {\n    let changes = false;\n    const equalities = []; // Stack of indices where equalities are found.\n    let equalitiesLength = 0; // Keeping our own length const is faster in JS.\n    /** @type {?string} */\n    let lastEquality = null;\n    // Always equal to diffs[equalities[equalitiesLength - 1]][1]\n    let pointer = 0; // Index of current position.\n    // Is there an insertion operation before the last equality.\n    let pre_ins = 0;\n    // Is there a deletion operation before the last equality.\n    let pre_del = 0;\n    // Is there an insertion operation after the last equality.\n    let post_ins = 0;\n    // Is there a deletion operation after the last equality.\n    let post_del = 0;\n    while (pointer < diffs.length) {\n      if (diffs[pointer][0] == DIFF_EQUAL) {\n        // Equality found.\n        if (\n          diffs[pointer][1].length < this.Diff_EditCost &&\n          (post_ins || post_del)\n        ) {\n          // Candidate found.\n          equalities[equalitiesLength++] = pointer;\n          pre_ins = post_ins;\n          pre_del = post_del;\n          lastEquality = diffs[pointer][1];\n        } else {\n          // Not a candidate, and can never become one.\n          equalitiesLength = 0;\n          lastEquality = null;\n        }\n        post_ins = post_del = 0;\n      } else {\n        // An insertion or deletion.\n        if (diffs[pointer][0] == DIFF_DELETE) {\n          post_del = 1;\n        } else {\n          post_ins = 1;\n        }\n        /*\n         * Five types to be split:\n         * <ins>A</ins><del>B</del>XY<ins>C</ins><del>D</del>\n         * <ins>A</ins>X<ins>C</ins><del>D</del>\n         * <ins>A</ins><del>B</del>X<ins>C</ins>\n         * <ins>A</del>X<ins>C</ins><del>D</del>\n         * <ins>A</ins><del>B</del>X<del>C</del>\n         */\n        if (\n          lastEquality &&\n          ((pre_ins && pre_del && post_ins && post_del) ||\n            (lastEquality.length < this.Diff_EditCost / 2 &&\n              pre_ins + pre_del + post_ins + post_del == 3))\n        ) {\n          // Duplicate record.\n          diffs.splice(equalities[equalitiesLength - 1], 0, [\n            DIFF_DELETE,\n            lastEquality,\n          ]);\n          // Change second copy to insert.\n          diffs[equalities[equalitiesLength - 1] + 1][0] = DIFF_INSERT;\n          equalitiesLength--; // Throw away the equality we just deleted;\n          lastEquality = null;\n          if (pre_ins && pre_del) {\n            // No changes made which could affect previous entry, keep going.\n            post_ins = post_del = 1;\n            equalitiesLength = 0;\n          } else {\n            equalitiesLength--; // Throw away the previous equality.\n            pointer =\n              equalitiesLength > 0 ? equalities[equalitiesLength - 1] : -1;\n            post_ins = post_del = 0;\n          }\n          changes = true;\n        }\n      }\n      pointer++;\n    }\n\n    if (changes) {\n      this.diff_cleanupMerge(diffs);\n    }\n  }\n\n  /**\n   * Reorder and merge like edit sections.  Merge equalities.\n   * Any edit section can move as long as it doesn't cross an equality.\n   * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n   */\n  diff_cleanupMerge(diffs: Diff[]): void {\n    // Add a dummy entry at the end.\n    diffs.push([DIFF_EQUAL, '']);\n    let pointer = 0;\n    let count_delete = 0;\n    let count_insert = 0;\n    let text_delete = '';\n    let text_insert = '';\n    let commonlength;\n    while (pointer < diffs.length) {\n      switch (diffs[pointer][0]) {\n        case DIFF_INSERT:\n          count_insert++;\n          text_insert += diffs[pointer][1];\n          pointer++;\n          break;\n        case DIFF_DELETE:\n          count_delete++;\n          text_delete += diffs[pointer][1];\n          pointer++;\n          break;\n        case DIFF_EQUAL:\n          // Upon reaching an equality, check for prior redundancies.\n          if (count_delete + count_insert > 1) {\n            if (count_delete !== 0 && count_insert !== 0) {\n              // Factor out any common prefixies.\n              commonlength = this.diff_commonPrefix(text_insert, text_delete);\n              if (commonlength !== 0) {\n                if (\n                  pointer - count_delete - count_insert > 0 &&\n                  diffs[pointer - count_delete - count_insert - 1][0] ==\n                    DIFF_EQUAL\n                ) {\n                  diffs[pointer - count_delete - count_insert - 1][1] +=\n                    text_insert.substring(0, commonlength);\n                } else {\n                  diffs.splice(0, 0, [\n                    DIFF_EQUAL,\n                    text_insert.substring(0, commonlength),\n                  ]);\n                  pointer++;\n                }\n                text_insert = text_insert.substring(commonlength);\n                text_delete = text_delete.substring(commonlength);\n              }\n              // Factor out any common suffixies.\n              commonlength = this.diff_commonSuffix(text_insert, text_delete);\n              if (commonlength !== 0) {\n                diffs[pointer][1] =\n                  text_insert.substring(text_insert.length - commonlength) +\n                  diffs[pointer][1];\n                text_insert = text_insert.substring(\n                  0,\n                  text_insert.length - commonlength\n                );\n                text_delete = text_delete.substring(\n                  0,\n                  text_delete.length - commonlength\n                );\n              }\n            }\n            // Delete the offending records and add the merged ones.\n            pointer -= count_delete + count_insert;\n            diffs.splice(pointer, count_delete + count_insert);\n            if (text_delete.length) {\n              diffs.splice(pointer, 0, [DIFF_DELETE, text_delete]);\n              pointer++;\n            }\n            if (text_insert.length) {\n              diffs.splice(pointer, 0, [DIFF_INSERT, text_insert]);\n              pointer++;\n            }\n            pointer++;\n          } else if (pointer !== 0 && diffs[pointer - 1][0] == DIFF_EQUAL) {\n            // Merge this equality with the previous one.\n            diffs[pointer - 1][1] += diffs[pointer][1];\n            diffs.splice(pointer, 1);\n          } else {\n            pointer++;\n          }\n          count_insert = 0;\n          count_delete = 0;\n          text_delete = '';\n          text_insert = '';\n          break;\n      }\n    }\n    if (diffs[diffs.length - 1][1] === '') {\n      diffs.pop(); // Remove the dummy entry at the end.\n    }\n\n    // Second pass: look for single edits surrounded on both sides by equalities\n    // which can be shifted sideways to eliminate an equality.\n    // e.g: A<ins>BA</ins>C -> <ins>AB</ins>AC\n    let changes = false;\n    pointer = 1;\n    // Intentionally ignore the first and last element (don't need checking).\n    while (pointer < diffs.length - 1) {\n      if (\n        diffs[pointer - 1][0] == DIFF_EQUAL &&\n        diffs[pointer + 1][0] == DIFF_EQUAL\n      ) {\n        // This is a single edit surrounded by equalities.\n        if (\n          diffs[pointer][1].substring(\n            diffs[pointer][1].length - diffs[pointer - 1][1].length\n          ) == diffs[pointer - 1][1]\n        ) {\n          // Shift the edit over the previous equality.\n          diffs[pointer][1] =\n            diffs[pointer - 1][1] +\n            diffs[pointer][1].substring(\n              0,\n              diffs[pointer][1].length - diffs[pointer - 1][1].length\n            );\n          diffs[pointer + 1][1] = diffs[pointer - 1][1] + diffs[pointer + 1][1];\n          diffs.splice(pointer - 1, 1);\n          changes = true;\n        } else if (\n          diffs[pointer][1].substring(0, diffs[pointer + 1][1].length) ==\n          diffs[pointer + 1][1]\n        ) {\n          // Shift the edit over the next equality.\n          diffs[pointer - 1][1] += diffs[pointer + 1][1];\n          diffs[pointer][1] =\n            diffs[pointer][1].substring(diffs[pointer + 1][1].length) +\n            diffs[pointer + 1][1];\n          diffs.splice(pointer + 1, 1);\n          changes = true;\n        }\n      }\n      pointer++;\n    }\n    // If shifts were made, the diff needs reordering and another shift sweep.\n    if (changes) {\n      this.diff_cleanupMerge(diffs);\n    }\n  }\n\n  /**\n   * loc is a location in text1, compute and return the equivalent location in\n   * text2.\n   * e.g. 'The cat' vs 'The big cat', 1->1, 5->8\n   * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n   * @param {number} loc Location within text1.\n   * @return {number} Location within text2.\n   */\n  diff_xIndex(diffs: Diff[], loc: number): number {\n    let chars1 = 0;\n    let chars2 = 0;\n    let last_chars1 = 0;\n    let last_chars2 = 0;\n    let x: number;\n    for (x = 0; x < diffs.length; x++) {\n      if (diffs[x][0] !== DIFF_INSERT) {\n        // Equality or deletion.\n        chars1 += diffs[x][1].length;\n      }\n      if (diffs[x][0] !== DIFF_DELETE) {\n        // Equality or insertion.\n        chars2 += diffs[x][1].length;\n      }\n      if (chars1 > loc) {\n        // Overshot the location.\n        break;\n      }\n      last_chars1 = chars1;\n      last_chars2 = chars2;\n    }\n    // Was the location was deleted?\n    if (diffs.length != x && diffs[x][0] === DIFF_DELETE) {\n      return last_chars2;\n    }\n    // Add the remaining character length.\n    return last_chars2 + (loc - last_chars1);\n  }\n\n  /**\n   * Convert a diff array into a pretty HTML report.\n   * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n   * @return {string} HTML representation.\n   */\n  diff_prettyHtml(diffs: Diff[]): string {\n    const html = [];\n    const pattern_amp = /&/g;\n    const pattern_lt = /</g;\n    const pattern_gt = />/g;\n    const pattern_para = /\\n/g;\n    for (let x = 0; x < diffs.length; x++) {\n      const op = diffs[x][0]; // Operation (insert, delete, equal)\n      const data = diffs[x][1]; // Text of change.\n      const text = data\n        .replace(pattern_amp, '&amp;')\n        .replace(pattern_lt, '&lt;')\n        .replace(pattern_gt, '&gt;')\n        .replace(pattern_para, '&para;<br>');\n      switch (op) {\n        case DIFF_INSERT:\n          html[x] = '<ins style=\"background:#e6ffe6;\">' + text + '</ins>';\n          break;\n        case DIFF_DELETE:\n          html[x] = '<del style=\"background:#ffe6e6;\">' + text + '</del>';\n          break;\n        case DIFF_EQUAL:\n          html[x] = '<span>' + text + '</span>';\n          break;\n      }\n    }\n    return html.join('');\n  }\n\n  /**\n   * Compute and return the source text (all equalities and deletions).\n   * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n   * @return {string} Source text.\n   */\n  diff_text1(diffs: Diff[]): string {\n    const text = [];\n    for (let x = 0; x < diffs.length; x++) {\n      if (diffs[x][0] !== DIFF_INSERT) {\n        text[x] = diffs[x][1];\n      }\n    }\n    return text.join('');\n  }\n\n  /**\n   * Compute and return the destination text (all equalities and insertions).\n   * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n   * @return {string} Destination text.\n   */\n  diff_text2(diffs: Diff[]): string {\n    const text = [];\n    for (let x = 0; x < diffs.length; x++) {\n      if (diffs[x][0] !== DIFF_DELETE) {\n        text[x] = diffs[x][1];\n      }\n    }\n    return text.join('');\n  }\n\n  /**\n   * Compute the Levenshtein distance; the number of inserted, deleted or\n   * substituted characters.\n   * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n   * @return {number} Number of changes.\n   */\n  diff_levenshtein(diffs: Diff[]): number {\n    let levenshtein = 0;\n    let insertions = 0;\n    let deletions = 0;\n    for (let x = 0; x < diffs.length; x++) {\n      const op = diffs[x][0];\n      const data = diffs[x][1];\n      switch (op) {\n        case DIFF_INSERT:\n          insertions += data.length;\n          break;\n        case DIFF_DELETE:\n          deletions += data.length;\n          break;\n        case DIFF_EQUAL:\n          // A deletion and an insertion is one substitution.\n          levenshtein += Math.max(insertions, deletions);\n          insertions = 0;\n          deletions = 0;\n          break;\n      }\n    }\n    levenshtein += Math.max(insertions, deletions);\n    return levenshtein;\n  }\n\n  /**\n   * Crush the diff into an encoded string which describes the operations\n   * required to transform text1 into text2.\n   * E.g. =3\\t-2\\t+ing  -> Keep 3 chars, delete 2 chars, insert 'ing'.\n   * Operations are tab-separated.  Inserted text is escaped using %xx notation.\n   * @param {!Array.<!diff_match_patch.Diff>} diffs Array of diff tuples.\n   * @return {string} Delta text.\n   */\n  diff_toDelta(diffs: Diff[]): string {\n    const text = [];\n    for (let x = 0; x < diffs.length; x++) {\n      switch (diffs[x][0]) {\n        case DIFF_INSERT:\n          text[x] = '+' + encodeURI(diffs[x][1]);\n          break;\n        case DIFF_DELETE:\n          text[x] = '-' + diffs[x][1].length;\n          break;\n        case DIFF_EQUAL:\n          text[x] = '=' + diffs[x][1].length;\n          break;\n      }\n    }\n    return text.join('\\t').replace(/%20/g, ' ');\n  }\n\n  /**\n   * Given the original text1, and an encoded string which describes the\n   * operations required to transform text1 into text2, compute the full diff.\n   * @param {string} text1 Source string for the diff.\n   * @param {string} delta Delta text.\n   * @return {!Array.<!diff_match_patch.Diff>} Array of diff tuples.\n   * @throws {!Error} If invalid input.\n   */\n  diff_fromDelta(text1: string, delta: string): Diff[] {\n    const diffs: Diff[] = [];\n    let diffsLength = 0; // Keeping our own length const is faster in JS.\n    let pointer = 0; // Cursor in text1\n    const tokens = delta.split(/\\t/g);\n    for (let x = 0; x < tokens.length; x++) {\n      // Each token begins with a one character parameter which specifies the\n      // operation of this token (delete, insert, equality).\n      const param = tokens[x].substring(1);\n      switch (tokens[x].charAt(0)) {\n        case '+':\n          try {\n            diffs[diffsLength++] = [DIFF_INSERT, decodeURI(param)];\n          } catch (ex) {\n            // Malformed URI sequence.\n            throw new Error('Illegal escape in diff_fromDelta: ' + param);\n          }\n          break;\n        case '-':\n        // Fall through.\n        case '=':\n          const n = parseInt(param, 10);\n          if (isNaN(n) || n < 0) {\n            throw new Error('Invalid number in diff_fromDelta: ' + param);\n          }\n          const text = text1.substring(pointer, (pointer += n));\n          if (tokens[x].charAt(0) == '=') {\n            diffs[diffsLength++] = [DIFF_EQUAL, text];\n          } else {\n            diffs[diffsLength++] = [DIFF_DELETE, text];\n          }\n          break;\n        default:\n          // Blank tokens are ok (from a trailing \\t).\n          // Anything else is an error.\n          if (tokens[x]) {\n            throw new Error(\n              'Invalid diff operation in diff_fromDelta: ' + tokens[x]\n            );\n          }\n      }\n    }\n    if (pointer != text1.length) {\n      throw new Error(\n        'Delta length (' +\n          pointer +\n          ') does not equal source text length (' +\n          text1.length +\n          ').'\n      );\n    }\n    return diffs;\n  }\n\n  //  MATCH FUNCTIONS\n\n  /**\n   * Locate the best instance of 'pattern' in 'text' near 'loc'.\n   * @param {string} text The text to search.\n   * @param {string} pattern The pattern to search for.\n   * @param {number} loc The location to search around.\n   * @return {number} Best match index or -1.\n   */\n  match_main(text: string, pattern: string, loc: number): number {\n    // Check for null inputs.\n    if (text == null || pattern == null || loc == null) {\n      throw new Error('Null input. (match_main)');\n    }\n\n    loc = Math.max(0, Math.min(loc, text.length));\n    if (text == pattern) {\n      // Shortcut (potentially not guaranteed by the algorithm)\n      return 0;\n    } else if (!text.length) {\n      // Nothing to match.\n      return -1;\n    } else if (text.substring(loc, loc + pattern.length) == pattern) {\n      // Perfect match at the perfect spot!  (Includes case of null pattern)\n      return loc;\n    } else {\n      // Do a fuzzy compare.\n      return this.match_bitap_(text, pattern, loc);\n    }\n  }\n\n  /**\n   * Locate the best instance of 'pattern' in 'text' near 'loc' using the\n   * Bitap algorithm.\n   * @param {string} text The text to search.\n   * @param {string} pattern The pattern to search for.\n   * @param {number} loc The location to search around.\n   * @return {number} Best match index or -1.\n   * @private\n   */\n  private match_bitap_(text: string, pattern: string, loc: number): number {\n    if (pattern.length > this.Match_MaxBits) {\n      throw new Error('Pattern too long for this browser.');\n    }\n\n    // Initialise the alphabet.\n    const s = this.match_alphabet_(pattern);\n\n    const dmp = this; // 'this' becomes 'window' in a closure.\n\n    /**\n     * Compute and return the score for a match with e errors and x location.\n     * Accesses loc and pattern through being a closure.\n     * @param {number} e Number of errors in match.\n     * @param {number} x Location of match.\n     * @return {number} Overall score for match (0.0 = good, 1.0 = bad).\n     * @private\n     */\n    function match_bitapScore_(e: number, x: number): number {\n      const accuracy = e / pattern.length;\n      const proximity = Math.abs(loc - x);\n      if (!dmp.Match_Distance) {\n        // Dodge divide by zero error.\n        return proximity ? 1.0 : accuracy;\n      }\n      return accuracy + proximity / dmp.Match_Distance;\n    }\n\n    // Highest score beyond which we give up.\n    let score_threshold = this.Match_Threshold;\n    // Is there a nearby exact match? (speedup)\n    let best_loc = text.indexOf(pattern, loc);\n    if (best_loc != -1) {\n      score_threshold = Math.min(\n        match_bitapScore_(0, best_loc),\n        score_threshold\n      );\n      // What about in the other direction? (speedup)\n      best_loc = text.lastIndexOf(pattern, loc + pattern.length);\n      if (best_loc != -1) {\n        score_threshold = Math.min(\n          match_bitapScore_(0, best_loc),\n          score_threshold\n        );\n      }\n    }\n\n    // Initialise the bit arrays.\n    const matchmask = 1 << (pattern.length - 1);\n    best_loc = -1;\n\n    let bin_min: number, bin_mid: number;\n    let bin_max = pattern.length + text.length;\n    let last_rd: number[];\n    for (let d = 0; d < pattern.length; d++) {\n      // Scan for the best match; each iteration allows for one more error.\n      // Run a binary search to determine how far from 'loc' we can stray at this\n      // error level.\n      bin_min = 0;\n      bin_mid = bin_max;\n      while (bin_min < bin_mid) {\n        if (match_bitapScore_(d, loc + bin_mid) <= score_threshold) {\n          bin_min = bin_mid;\n        } else {\n          bin_max = bin_mid;\n        }\n        bin_mid = Math.floor((bin_max - bin_min) / 2 + bin_min);\n      }\n      // Use the result from this iteration as the maximum for the next.\n      bin_max = bin_mid;\n      let start = Math.max(1, loc - bin_mid + 1);\n      const finish = Math.min(loc + bin_mid, text.length) + pattern.length;\n\n      const rd = Array(finish + 2);\n      rd[finish + 1] = (1 << d) - 1;\n      for (let j = finish; j >= start; j--) {\n        // The alphabet (s) is a sparse hash, so the following line generates\n        // warnings.\n        const charMatch = s[text.charAt(j - 1)];\n        if (d === 0) {\n          // First pass: exact match.\n          rd[j] = ((rd[j + 1] << 1) | 1) & charMatch;\n        } else {\n          // Subsequent passes: fuzzy match.\n          rd[j] =\n            (((rd[j + 1] << 1) | 1) & charMatch) |\n            (((last_rd![j + 1] | last_rd![j]) << 1) | 1) |\n            last_rd![j + 1];\n        }\n        if (rd[j] & matchmask) {\n          const score = match_bitapScore_(d, j - 1);\n          // This match will almost certainly be better than any existing match.\n          // But check anyway.\n          if (score <= score_threshold) {\n            // Told you so.\n            score_threshold = score;\n            best_loc = j - 1;\n            if (best_loc > loc) {\n              // When passing loc, don't exceed our current distance from loc.\n              start = Math.max(1, 2 * loc - best_loc);\n            } else {\n              // Already passed loc, downhill from here on in.\n              break;\n            }\n          }\n        }\n      }\n      // No hope for a (better) match at greater error levels.\n      if (match_bitapScore_(d + 1, loc) > score_threshold) {\n        break;\n      }\n      last_rd = rd;\n    }\n    return best_loc;\n  }\n\n  /**\n   * Initialise the alphabet for the Bitap algorithm.\n   * @param {string} pattern The text to encode.\n   * @return {!Object} Hash of character locations.\n   * @private\n   */\n  private match_alphabet_(pattern: string): { [char: string]: number } {\n    const s: { [char: string]: number } = {};\n    for (let i = 0; i < pattern.length; i++) {\n      s[pattern.charAt(i)] = 0;\n    }\n    for (let i = 0; i < pattern.length; i++) {\n      s[pattern.charAt(i)] |= 1 << (pattern.length - i - 1);\n    }\n    return s;\n  }\n\n  //  PATCH FUNCTIONS\n\n  /**\n   * Increase the context until it is unique,\n   * but don't let the pattern expand beyond Match_MaxBits.\n   * @param {!diff_match_patch.patch_obj} patch The patch to grow.\n   * @param {string} text Source text.\n   * @private\n   */\n  private patch_addContext_(patch: Patch, text: string): void {\n    if (text.length == 0) {\n      return;\n    }\n    if (patch.start2 === null) {\n      throw Error('patch not initialized');\n    }\n    let pattern = text.substring(patch.start2, patch.start2 + patch.length1);\n    let padding = 0;\n\n    // Look for the first and last matches of pattern in text.  If two different\n    // matches are found, increase the pattern length.\n    while (\n      text.indexOf(pattern) != text.lastIndexOf(pattern) &&\n      pattern.length <\n        this.Match_MaxBits - this.Patch_Margin - this.Patch_Margin\n    ) {\n      padding += this.Patch_Margin;\n      pattern = text.substring(\n        patch.start2 - padding,\n        patch.start2 + patch.length1 + padding\n      );\n    }\n    // Add one chunk for good luck.\n    padding += this.Patch_Margin;\n\n    // Add the prefix.\n    const prefix = text.substring(patch.start2 - padding, patch.start2);\n    if (prefix) {\n      patch.diffs.unshift([DIFF_EQUAL, prefix]);\n    }\n    // Add the suffix.\n    const suffix = text.substring(\n      patch.start2 + patch.length1,\n      patch.start2 + patch.length1 + padding\n    );\n    if (suffix) {\n      patch.diffs.push([DIFF_EQUAL, suffix]);\n    }\n\n    // Roll back the start points.\n    patch.start1 = patch.start1 || 0 - prefix.length;\n    patch.start2 = patch.start2 || 0 - prefix.length;\n    // Extend the lengths.\n    patch.length1 += prefix.length + suffix.length;\n    patch.length2 += prefix.length + suffix.length;\n  }\n\n  /**\n   * Compute a list of patches to turn text1 into text2.\n   * Use diffs if provided, otherwise compute it ourselves.\n   * There are four ways to call this function, depending on what data is\n   * available to the caller:\n   * Method 1:\n   * a = text1, b = text2\n   * Method 2:\n   * a = diffs\n   * Method 3 (optimal):\n   * a = text1, b = diffs\n   * Method 4 (deprecated, use method 3):\n   * a = text1, b = text2, c = diffs\n   *\n   * @param {string|!Array.<!diff_match_patch.Diff>} a text1 (methods 1,3,4) or\n   * Array of diff tuples for text1 to text2 (method 2).\n   * @param {string|!Array.<!diff_match_patch.Diff>} opt_b text2 (methods 1,4) or\n   * Array of diff tuples for text1 to text2 (method 3) or undefined (method 2).\n   * @param {string|!Array.<!diff_match_patch.Diff>} opt_c Array of diff tuples\n   * for text1 to text2 (method 4) or undefined (methods 1,2,3).\n   * @return {!Array.<!diff_match_patch.patch_obj>} Array of Patch objects.\n   */\n  patch_make(\n    a: string | Diff[],\n    opt_b: string | Diff[],\n    opt_c: string | Diff[]\n  ): Patch[] {\n    let text1: string, diffs: Diff[];\n    if (\n      typeof a == 'string' &&\n      typeof opt_b == 'string' &&\n      typeof opt_c == 'undefined'\n    ) {\n      // Method 1: text1, text2\n      // Compute diffs from text1 and text2.\n      text1 = /** @type {string} */ a;\n      diffs = this.diff_main(text1, /** @type {string} */ opt_b, true);\n      if (diffs.length > 2) {\n        this.diff_cleanupSemantic(diffs);\n        this.diff_cleanupEfficiency(diffs);\n      }\n    } else if (\n      a &&\n      typeof a == 'object' &&\n      typeof opt_b == 'undefined' &&\n      typeof opt_c == 'undefined'\n    ) {\n      // Method 2: diffs\n      // Compute text1 from diffs.\n      diffs = /** @type {!Array.<!diff_match_patch.Diff>} */ a;\n      text1 = this.diff_text1(diffs);\n    } else if (\n      typeof a == 'string' &&\n      opt_b &&\n      typeof opt_b == 'object' &&\n      typeof opt_c == 'undefined'\n    ) {\n      // Method 3: text1, diffs\n      text1 = /** @type {string} */ a;\n      diffs = /** @type {!Array.<!diff_match_patch.Diff>} */ opt_b;\n    } else if (\n      typeof a == 'string' &&\n      typeof opt_b == 'string' &&\n      opt_c &&\n      typeof opt_c == 'object'\n    ) {\n      // Method 4: text1, text2, diffs\n      // text2 is not used.\n      text1 = /** @type {string} */ a;\n      diffs = /** @type {!Array.<!diff_match_patch.Diff>} */ opt_c;\n    } else {\n      throw new Error('Unknown call format to patch_make.');\n    }\n\n    if (diffs.length === 0) {\n      return []; // Get rid of the null case.\n    }\n    const patches = [];\n    let patch = new Patch();\n    let patchDiffLength = 0; // Keeping our own length const is faster in JS.\n    let char_count1 = 0; // Number of characters into the text1 string.\n    let char_count2 = 0; // Number of characters into the text2 string.\n    // Start with text1 (prepatch_text) and apply the diffs until we arrive at\n    // text2 (postpatch_text).  We recreate the patches one by one to determine\n    // context info.\n    let prepatch_text = text1;\n    let postpatch_text = text1;\n    for (let x = 0; x < diffs.length; x++) {\n      const diff_type = diffs[x][0];\n      const diff_text = diffs[x][1];\n\n      if (!patchDiffLength && diff_type !== DIFF_EQUAL) {\n        // A new patch starts here.\n        patch.start1 = char_count1;\n        patch.start2 = char_count2;\n      }\n\n      switch (diff_type) {\n        case DIFF_INSERT:\n          patch.diffs[patchDiffLength++] = diffs[x];\n          patch.length2 += diff_text.length;\n          postpatch_text =\n            postpatch_text.substring(0, char_count2) +\n            diff_text +\n            postpatch_text.substring(char_count2);\n          break;\n        case DIFF_DELETE:\n          patch.length1 += diff_text.length;\n          patch.diffs[patchDiffLength++] = diffs[x];\n          postpatch_text =\n            postpatch_text.substring(0, char_count2) +\n            postpatch_text.substring(char_count2 + diff_text.length);\n          break;\n        case DIFF_EQUAL:\n          if (\n            diff_text.length <= 2 * this.Patch_Margin &&\n            patchDiffLength &&\n            diffs.length != x + 1\n          ) {\n            // Small equality inside a patch.\n            patch.diffs[patchDiffLength++] = diffs[x];\n            patch.length1 += diff_text.length;\n            patch.length2 += diff_text.length;\n          } else if (diff_text.length >= 2 * this.Patch_Margin) {\n            // Time for a new patch.\n            if (patchDiffLength) {\n              this.patch_addContext_(patch, prepatch_text);\n              patches.push(patch);\n              patch = new Patch();\n              patchDiffLength = 0;\n              // Unlike Unidiff, our patch lists have a rolling context.\n              // https://github.com/google/diff-match-patch/wiki/Unidiff\n              // Update prepatch text & pos to reflect the application of the\n              // just completed patch.\n              prepatch_text = postpatch_text;\n              char_count1 = char_count2;\n            }\n          }\n          break;\n      }\n\n      // Update the current character count.\n      if (diff_type !== DIFF_INSERT) {\n        char_count1 += diff_text.length;\n      }\n      if (diff_type !== DIFF_DELETE) {\n        char_count2 += diff_text.length;\n      }\n    }\n    // Pick up the leftover patch if not empty.\n    if (patchDiffLength) {\n      this.patch_addContext_(patch, prepatch_text);\n      patches.push(patch);\n    }\n\n    return patches;\n  }\n\n  /**\n   * Given an array of patches, return another array that is identical.\n   * @param {!Array.<!diff_match_patch.patch_obj>} patches Array of Patch objects.\n   * @return {!Array.<!diff_match_patch.patch_obj>} Array of Patch objects.\n   */\n  patch_deepCopy(patches: Patch[]): Patch[] {\n    // Making deep copies is hard in JavaScript.\n    const patchesCopy = [];\n    for (let x = 0; x < patches.length; x++) {\n      const patch = patches[x];\n      const patchCopy = new Patch();\n      patchCopy.diffs = [];\n      for (let y = 0; y < patch.diffs.length; y++) {\n        patchCopy.diffs[y] = [patch.diffs[y][0], patch.diffs[y][1]];\n      }\n      patchCopy.start1 = patch.start1;\n      patchCopy.start2 = patch.start2;\n      patchCopy.length1 = patch.length1;\n      patchCopy.length2 = patch.length2;\n      patchesCopy[x] = patchCopy;\n    }\n    return patchesCopy;\n  }\n\n  /**\n   * Merge a set of patches onto the text.  Return a patched text, as well\n   * as a list of true/false values indicating which patches were applied.\n   * @param {!Array.<!diff_match_patch.patch_obj>} patches Array of Patch objects.\n   * @param {string} text Old text.\n   * @return {!Array.<string|!Array.<boolean>>} Two element Array, containing the\n   *      new text and an array of boolean values.\n   */\n  patch_apply(patches: Patch[], text: string): [string, boolean[]] {\n    if (patches.length == 0) {\n      return [text, []];\n    }\n\n    // Deep copy the patches so that no changes are made to originals.\n    patches = this.patch_deepCopy(patches);\n\n    const nullPadding = this.patch_addPadding(patches);\n    text = nullPadding + text + nullPadding;\n\n    this.patch_splitMax(patches);\n    // delta keeps track of the offset between the expected and actual location\n    // of the previous patch.  If there are patches expected at positions 10 and\n    // 20, but the first patch was found at 12, delta is 2 and the second patch\n    // has an effective expected position of 22.\n    let delta = 0;\n    const results = [];\n    for (let x = 0; x < patches.length; x++) {\n      const expected_loc = patches[x].start2 || 0 + delta;\n      const text1 = this.diff_text1(patches[x].diffs);\n      let start_loc: number;\n      let end_loc = -1;\n      if (text1.length > this.Match_MaxBits) {\n        // patch_splitMax will only provide an oversized pattern in the case of\n        // a monster delete.\n        start_loc = this.match_main(\n          text,\n          text1.substring(0, this.Match_MaxBits),\n          expected_loc\n        );\n        if (start_loc != -1) {\n          end_loc = this.match_main(\n            text,\n            text1.substring(text1.length - this.Match_MaxBits),\n            expected_loc + text1.length - this.Match_MaxBits\n          );\n          if (end_loc == -1 || start_loc >= end_loc) {\n            // Can't find valid trailing context.  Drop this patch.\n            start_loc = -1;\n          }\n        }\n      } else {\n        start_loc = this.match_main(text, text1, expected_loc);\n      }\n      if (start_loc == -1) {\n        // No match found.  :(\n        results[x] = false;\n        // Subtract the delta for this failed patch from subsequent patches.\n        delta -= patches[x].length2 - patches[x].length1;\n      } else {\n        // Found a match.  :)\n        results[x] = true;\n        delta = start_loc - expected_loc;\n        let text2: string;\n        if (end_loc == -1) {\n          text2 = text.substring(start_loc, start_loc + text1.length);\n        } else {\n          text2 = text.substring(start_loc, end_loc + this.Match_MaxBits);\n        }\n        if (text1 == text2) {\n          // Perfect match, just shove the replacement text in.\n          text =\n            text.substring(0, start_loc) +\n            this.diff_text2(patches[x].diffs) +\n            text.substring(start_loc + text1.length);\n        } else {\n          // Imperfect match.  Run a diff to get a framework of equivalent\n          // indices.\n          const diffs = this.diff_main(text1, text2, false);\n          if (\n            text1.length > this.Match_MaxBits &&\n            this.diff_levenshtein(diffs) / text1.length >\n              this.Patch_DeleteThreshold\n          ) {\n            // The end points match, but the content is unacceptably bad.\n            results[x] = false;\n          } else {\n            this.diff_cleanupSemanticLossless(diffs);\n            let index1 = 0;\n            let index2: number;\n            for (let y = 0; y < patches[x].diffs.length; y++) {\n              const mod = patches[x].diffs[y];\n              if (mod[0] !== DIFF_EQUAL) {\n                index2 = this.diff_xIndex(diffs, index1);\n              }\n              if (mod[0] === DIFF_INSERT) {\n                // Insertion\n                text =\n                  text.substring(0, start_loc + index2!) +\n                  mod[1] +\n                  text.substring(start_loc + index2!);\n              } else if (mod[0] === DIFF_DELETE) {\n                // Deletion\n                text =\n                  text.substring(0, start_loc + index2!) +\n                  text.substring(\n                    start_loc + this.diff_xIndex(diffs, index1 + mod[1].length)\n                  );\n              }\n              if (mod[0] !== DIFF_DELETE) {\n                index1 += mod[1].length;\n              }\n            }\n          }\n        }\n      }\n    }\n    // Strip the padding off.\n    text = text.substring(nullPadding.length, text.length - nullPadding.length);\n    return [text, results];\n  }\n\n  /**\n   * Add some padding on text start and end so that edges can match something.\n   * Intended to be called only from within patch_apply.\n   * @param {!Array.<!diff_match_patch.patch_obj>} patches Array of Patch objects.\n   * @return {string} The padding string added to each side.\n   */\n  patch_addPadding(patches: Patch[]): string {\n    let paddingLength = this.Patch_Margin;\n    let nullPadding = '';\n    for (let x = 1; x <= paddingLength; x++) {\n      nullPadding += String.fromCharCode(x);\n    }\n\n    // Bump all the patches forward.\n    for (let x = 0; x < patches.length; x++) {\n      patches[x].start1 = patches[x].start1 || 0 + paddingLength;\n      patches[x].start2 = patches[x].start2 || 0 + paddingLength;\n    }\n\n    // Add some padding on start of first diff.\n    let patch = patches[0];\n    let diffs = patch.diffs;\n    if (diffs.length == 0 || diffs[0][0] != DIFF_EQUAL) {\n      // Add nullPadding equality.\n      diffs.unshift([DIFF_EQUAL, nullPadding]);\n      patch.start1! -= paddingLength; // Should be 0.\n      patch.start2! -= paddingLength; // Should be 0.\n      patch.length1 += paddingLength;\n      patch.length2 += paddingLength;\n    } else if (paddingLength > diffs[0][1].length) {\n      // Grow first equality.\n      const extraLength = paddingLength - diffs[0][1].length;\n      diffs[0][1] = nullPadding.substring(diffs[0][1].length) + diffs[0][1];\n      patch.start1! -= extraLength;\n      patch.start2! -= extraLength;\n      patch.length1 += extraLength;\n      patch.length2 += extraLength;\n    }\n\n    // Add some padding on end of last diff.\n    patch = patches[patches.length - 1];\n    diffs = patch.diffs;\n    if (diffs.length == 0 || diffs[diffs.length - 1][0] != DIFF_EQUAL) {\n      // Add nullPadding equality.\n      diffs.push([DIFF_EQUAL, nullPadding]);\n      patch.length1 += paddingLength;\n      patch.length2 += paddingLength;\n    } else if (paddingLength > diffs[diffs.length - 1][1].length) {\n      // Grow last equality.\n      const extraLength = paddingLength - diffs[diffs.length - 1][1].length;\n      diffs[diffs.length - 1][1] += nullPadding.substring(0, extraLength);\n      patch.length1 += extraLength;\n      patch.length2 += extraLength;\n    }\n\n    return nullPadding;\n  }\n\n  /**\n   * Look through the patches and break up any which are longer than the maximum\n   * limit of the match algorithm.\n   * Intended to be called only from within patch_apply.\n   * @param {!Array.<!diff_match_patch.patch_obj>} patches Array of Patch objects.\n   */\n  patch_splitMax(patches: Patch[]): void {\n    const patch_size = this.Match_MaxBits;\n    for (let x = 0; x < patches.length; x++) {\n      if (patches[x].length1 <= patch_size) {\n        continue;\n      }\n      const bigpatch = patches[x];\n      // Remove the big old patch.\n      patches.splice(x--, 1);\n      let start1 = bigpatch.start1 || 0;\n      let start2 = bigpatch.start2 || 0;\n      let precontext: string = '';\n      while (bigpatch.diffs.length !== 0) {\n        // Create one of several smaller patches.\n        const patch = new Patch();\n        let empty = true;\n        patch.start1 = start1 - precontext.length;\n        patch.start2 = start2 - precontext.length;\n        if (precontext !== '') {\n          patch.length1 = patch.length2 = precontext.length;\n          patch.diffs.push([DIFF_EQUAL, precontext]);\n        }\n        while (\n          bigpatch.diffs.length !== 0 &&\n          patch.length1 < patch_size - this.Patch_Margin\n        ) {\n          const diff_type = bigpatch.diffs[0][0];\n          let diff_text = bigpatch.diffs[0][1];\n          if (diff_type === DIFF_INSERT) {\n            // Insertions are harmless.\n            patch.length2 += diff_text.length;\n            start2 += diff_text.length;\n            patch.diffs.push(bigpatch!.diffs!.shift()!);\n            empty = false;\n          } else if (\n            diff_type === DIFF_DELETE &&\n            patch.diffs.length == 1 &&\n            patch.diffs[0][0] == DIFF_EQUAL &&\n            diff_text.length > 2 * patch_size\n          ) {\n            // This is a large deletion.  Let it pass in one chunk.\n            patch.length1 += diff_text.length;\n            start1 += diff_text.length;\n            empty = false;\n            patch.diffs.push([diff_type, diff_text]);\n            bigpatch.diffs.shift();\n          } else {\n            // Deletion or equality.  Only take as much as we can stomach.\n            diff_text = diff_text.substring(\n              0,\n              patch_size - patch.length1 - this.Patch_Margin\n            );\n            patch.length1 += diff_text.length;\n            start1 += diff_text.length;\n            if (diff_type === DIFF_EQUAL) {\n              patch.length2 += diff_text.length;\n              start2 += diff_text.length;\n            } else {\n              empty = false;\n            }\n            patch.diffs.push([diff_type, diff_text]);\n            if (diff_text == bigpatch.diffs[0][1]) {\n              bigpatch.diffs.shift();\n            } else {\n              bigpatch.diffs[0][1] = bigpatch.diffs[0][1].substring(\n                diff_text.length\n              );\n            }\n          }\n        }\n        // Compute the head context for the next patch.\n        precontext = this.diff_text2(patch.diffs);\n        precontext = precontext.substring(\n          precontext.length - this.Patch_Margin\n        );\n        // Append the end context for this patch.\n        const postcontext = this.diff_text1(bigpatch.diffs).substring(\n          0,\n          this.Patch_Margin\n        );\n        if (postcontext !== '') {\n          patch.length1 += postcontext.length;\n          patch.length2 += postcontext.length;\n          if (\n            patch.diffs.length !== 0 &&\n            patch.diffs[patch.diffs.length - 1][0] === DIFF_EQUAL\n          ) {\n            patch.diffs[patch.diffs.length - 1][1] += postcontext;\n          } else {\n            patch.diffs.push([DIFF_EQUAL, postcontext]);\n          }\n        }\n        if (!empty) {\n          patches.splice(++x, 0, patch);\n        }\n      }\n    }\n  }\n\n  /**\n   * Take a list of patches and return a textual representation.\n   * @param {!Array.<!diff_match_patch.patch_obj>} patches Array of Patch objects.\n   * @return {string} Text representation of patches.\n   */\n  patch_toText(patches: Patch[]): string {\n    const text = [];\n    for (let x = 0; x < patches.length; x++) {\n      text[x] = patches[x];\n    }\n    return text.join('');\n  }\n\n  /**\n   * Parse a textual representation of patches and return a list of Patch objects.\n   * @param {string} textline Text representation of patches.\n   * @return {!Array.<!diff_match_patch.patch_obj>} Array of Patch objects.\n   * @throws {!Error} If invalid input.\n   */\n  patch_fromText(textline: string): Patch[] {\n    const patches: Patch[] = [];\n    if (!textline) {\n      return patches;\n    }\n    const text = textline.split('\\n');\n    let textPointer = 0;\n    const patchHeader = /^@@ -(\\d+),?(\\d*) \\+(\\d+),?(\\d*) @@$/;\n    while (textPointer < text.length) {\n      const m = text[textPointer].match(patchHeader);\n      if (!m) {\n        throw new Error('Invalid patch string: ' + text[textPointer]);\n      }\n      const patch = new Patch();\n      patches.push(patch);\n      patch.start1 = parseInt(m[1], 10);\n      if (m[2] === '') {\n        patch.start1--;\n        patch.length1 = 1;\n      } else if (m[2] == '0') {\n        patch.length1 = 0;\n      } else {\n        patch.start1--;\n        patch.length1 = parseInt(m[2], 10);\n      }\n\n      patch.start2 = parseInt(m[3], 10);\n      if (m[4] === '') {\n        patch.start2--;\n        patch.length2 = 1;\n      } else if (m[4] == '0') {\n        patch.length2 = 0;\n      } else {\n        patch.start2--;\n        patch.length2 = parseInt(m[4], 10);\n      }\n      textPointer++;\n\n      while (textPointer < text.length) {\n        const sign = text[textPointer].charAt(0);\n        const line = decodeURI(text[textPointer].substring(1));\n        if (sign == '-') {\n          // Deletion.\n          patch.diffs.push([DIFF_DELETE, line]);\n        } else if (sign == '+') {\n          // Insertion.\n          patch.diffs.push([DIFF_INSERT, line]);\n        } else if (sign == ' ') {\n          // Minor equality.\n          patch.diffs.push([DIFF_EQUAL, line]);\n        } else if (sign == '@') {\n          // Start of next patch.\n          break;\n        } else if (sign === '') {\n          // Blank line?  Whatever.\n        } else {\n          // WTF?\n          throw new Error('Invalid patch mode \"' + sign + '\" in: ' + line);\n        }\n        textPointer++;\n      }\n    }\n    return patches;\n  }\n}\n\n/**\n * Class representing one patch operation.\n * @constructor\n */\nexport class Patch {\n  diffs: Diff[];\n  start1: number | null = null;\n  start2: number | null = null;\n  length1: number = 0;\n  length2: number = 0;\n\n  constructor() {\n    this.diffs = [];\n  }\n\n  /**\n   * Emulate GNU diff's format.\n   * Header: @@ -382,8 +481,9 @@\n   * Indices are printed as 1-based, not 0-based.\n   * @return {string} The GNU diff string.\n   */\n  toString(): string {\n    let coords1: string | number, coords2: string | number;\n    if (this.length1 === 0) {\n      coords1 = this.start1 + ',0';\n    } else if (this.length1 == 1) {\n      coords1 = this.start1! + 1;\n    } else {\n      coords1 = this.start1! + 1 + ',' + this.length1;\n    }\n    if (this.length2 === 0) {\n      coords2 = this.start2 + ',0';\n    } else if (this.length2 == 1) {\n      coords2 = this.start2! + 1;\n    } else {\n      coords2 = this.start2! + 1 + ',' + this.length2;\n    }\n    const text = ['@@ -' + coords1 + ' +' + coords2 + ' @@\\n'];\n    let op;\n    // Escape the body of the patch with %xx notation.\n    for (let x = 0; x < this.diffs.length; x++) {\n      switch (this.diffs[x][0]) {\n        case DIFF_INSERT:\n          op = '+';\n          break;\n        case DIFF_DELETE:\n          op = '-';\n          break;\n        case DIFF_EQUAL:\n          op = ' ';\n          break;\n      }\n      text[x + 1] = op + encodeURI(this.diffs[x][1]) + '\\n';\n    }\n    return text.join('').replace(/%20/g, ' ');\n  }\n}\n", "import { DiffMatchPatch } from '../../external/diff-match-patch.ts';\n\nexport const kDMP = new DiffMatchPatch();\nkDMP.Diff_Timeout = 0.5;\n\nexport const CFDS_VERSION = '4.0.0';\nexport const CFDS_COMP_MIN_VERSION = '4.0.0';\nexport const CFDS_COMP_MAX_VERSION = '4.0.0';\n\nexport enum ChangeType {\n  Insert = 1,\n  Other = 2,\n  Equal = 0,\n  Delete = -1,\n  DeleteRange = -2,\n}\n\nexport enum Dir {\n  After = 1,\n  Before = -1,\n  Exact = 0,\n}\n", "import { assert } from '../../base/error.ts';\nimport { Dictionary } from '../../base/collections/dict.ts';\nimport { HashMap } from '../../base/collections/hash-map.ts';\nimport { CoreOptions } from '../../base/core-types/base.ts';\nimport { coreValueEquals } from '../../base/core-types/index.ts';\nimport { encodableValueHash } from '../../base/core-types/encoding/hash.ts';\nimport { FlatRepAtom, isElementSpacer, kElementSpacer } from './flat-rep.ts';\n\ntype ReverseMapping = (FlatRepAtom | null)[];\n\nconst kReservedCodePoints = new Set<string>(['\\0', '\\n']);\nconst kNewlineCodePoint = '\\n'.codePointAt(0);\n\n/**\n * A way to encode a stream of values as a continuous string. It constructs a\n * 2-way mapping from tree atoms to code points.\n *\n * WARNING: This class does not copy inserted values. It's the caller's\n * responsibility to ensure nothing mutates while in use.\n */\nexport class StringRep {\n  private readonly _dict: Dictionary<FlatRepAtom, string>;\n  private readonly _reverseMapping: ReverseMapping;\n\n  constructor(opts?: CoreOptions) {\n    this._dict = new HashMap<FlatRepAtom, string>(\n      (v) => encodableValueHash(v, opts),\n      (v1, v2) => coreValueEquals(v1, v2, opts)\n    );\n    this._reverseMapping = [];\n  }\n\n  encode(iter: Iterable<FlatRepAtom>): string {\n    const dict = this._dict;\n    const reverseMapping = this._reverseMapping;\n    let result = '';\n    for (const value of iter) {\n      if (isElementSpacer(value)) {\n        result += '\\n';\n        continue;\n      }\n      let encodedChar = dict.get(value);\n      if (encodedChar === undefined) {\n        // Skip reserved characters\n        do {\n          assert(reverseMapping.length < 65536, 'Max encoded values reached');\n          encodedChar = String.fromCodePoint(reverseMapping.length);\n          if (kReservedCodePoints.has(encodedChar)) {\n            reverseMapping.push(null);\n          } else {\n            break;\n          }\n        } while (true);\n        dict.set(value, encodedChar);\n        reverseMapping.push(value);\n      }\n      result += encodedChar;\n    }\n    return result;\n  }\n\n  *decode(str: string): Generator<FlatRepAtom> {\n    const reverseMapping = this._reverseMapping;\n    const len = str.length;\n    for (let i = 0; i < len; ++i) {\n      const codePoint = str.codePointAt(i)!;\n      if (codePoint === kNewlineCodePoint) {\n        yield kElementSpacer;\n      }\n      assert(\n        codePoint < reverseMapping.length ||\n          kReservedCodePoints.has(String.fromCodePoint(codePoint)),\n        'Unexpected code point'\n      );\n      const value = reverseMapping[codePoint];\n      // Skip reserved characters\n      if (value === undefined || value === null) {\n        continue;\n      }\n      yield value;\n    }\n  }\n}\n", "import {\n  Diff,\n  DIFF_DELETE,\n  DIFF_EQUAL,\n  DIFF_INSERT,\n} from '../../external/diff-match-patch.ts';\nimport { assert } from '../../base/error.ts';\nimport { kDMP } from '../base/defs.ts';\nimport {\n  CoreOptions,\n  CoreType,\n  CoreValue,\n  getCoreType,\n} from '../../base/core-types/index.ts';\nimport { FlatRepAtom, flattenTextNode } from './flat-rep.ts';\nimport { Dictionary } from '../../base/collections/dict.ts';\nimport { StringRep } from './string-rep.ts';\nimport { RichTextChange } from '../change/richtext-change.ts';\nimport { TreeNode, isTextNode, isElementNode } from './tree.ts';\nimport * as ArrayUtils from '../../base/array.ts';\n\nexport enum Operation {\n  Delete = -1,\n  DeleteRange = -2,\n  Insert = 1,\n}\n\nexport interface PatchCommand {\n  readonly operation: Operation;\n  readonly start: number;\n  readonly end?: number;\n  readonly value?: string;\n}\n\n/**\n * A context for merging changes into an existing stream of FlatRepAtoms.\n * This class only allocates memory linear to the number of changes making it\n * very lightweight. A side effect of this design is it's a disposable, one time\n * use, class. Once finalized, the context can't be used anymore and a new one\n * needs to be created.\n */\nexport class MergeContext {\n  private readonly _origValues: Iterable<FlatRepAtom>;\n  private readonly _deletions: Set<number>;\n  private readonly _insertions: Dictionary<number, FlatRepAtom[]>;\n  private readonly _eqOpts?: CoreOptions;\n  private _finalized: boolean;\n\n  constructor(origValues: Iterable<FlatRepAtom>, eqOpts?: CoreOptions) {\n    this._origValues = origValues;\n    this._deletions = new Set();\n    this._insertions = new Map();\n    this._eqOpts = eqOpts;\n    this._finalized = false;\n  }\n\n  delete(index: number): void {\n    this._deletions.add(index);\n  }\n\n  deleteRange(start: number, end: number): void {\n    for (let i = start; i < end; ++i) {\n      this.delete(i);\n    }\n  }\n\n  insert(index: number, value: FlatRepAtom | Iterable<FlatRepAtom>): void {\n    const insertions = this._insertions;\n    const curValue = insertions.get(index);\n    if (curValue === undefined) {\n      insertions.set(index, this.boxValueIfNeeded(value));\n    } else {\n      insertions.set(index, this.mergeValues(curValue, value));\n    }\n  }\n\n  apply(change: RichTextChange): void {\n    switch (change.op) {\n      case Operation.Insert: {\n        this.insert(change.start, recursiveFlattenTextNodes(change.values!));\n        break;\n      }\n\n      case Operation.Delete:\n        this.delete(change.start);\n        break;\n\n      case Operation.DeleteRange:\n        this.deleteRange(change.start, change.end!);\n        break;\n    }\n  }\n\n  *finalize(): Generator<FlatRepAtom> {\n    assert(!this._finalized);\n    const deletions = this._deletions;\n    const insertions = this._insertions;\n    let idx = 0;\n    for (const origAtom of this._origValues) {\n      const insertedValues = insertions.get(idx);\n      if (insertedValues !== undefined) {\n        for (const v of insertedValues) {\n          yield v;\n        }\n      }\n      if (!deletions.has(idx)) {\n        yield origAtom;\n      }\n      ++idx;\n    }\n    // Final insertion index after all existing values\n    const insertedValues = insertions.get(idx);\n    if (insertedValues !== undefined) {\n      for (const v of insertedValues) {\n        yield v;\n      }\n    }\n    this._finalized = true;\n  }\n\n  private boxValueIfNeeded(\n    value: FlatRepAtom | Iterable<FlatRepAtom>\n  ): FlatRepAtom[] {\n    const type = getCoreType(value as CoreValue);\n    switch (type) {\n      case CoreType.Array:\n        return value as FlatRepAtom[];\n\n      case CoreType.String:\n      case CoreType.Generator:\n      case CoreType.Dictionary:\n      case CoreType.Set:\n        return Array.from(value as Iterable<CoreValue>) as FlatRepAtom[];\n\n      default:\n        return [value] as FlatRepAtom[];\n    }\n  }\n\n  /**\n   * Merges values by attempting to remove duplicates. Multiple values inserted\n   * at the same index will be grouped as an array. Whenever a new value (or\n   * array/string of values) is being inserted, it'll be diff'ed against the\n   * existing values array to remove redundant runs.\n   *\n   * @param curValue\n   * @param insertedValue\n   * @returns An array of merged values\n   */\n  private mergeValues(\n    curValue: FlatRepAtom[],\n    insertedValue: FlatRepAtom | Iterable<FlatRepAtom>\n  ): FlatRepAtom[] {\n    const strRep = new StringRep(this._eqOpts);\n    const curStr = strRep.encode(curValue);\n    const newStr = strRep.encode(this.boxValueIfNeeded(insertedValue));\n    const textDiffs = kDMP.diff_main(curStr, newStr, true);\n\n    // For large diffs we perform semantic cleanup so things make more sense\n    // to the observing user. The result is, that if two insertions differ by\n    // more than a certain threshold (levenshtein distance > 3), the two will be\n    // split into different words that represent the different logical\n    // \"branches\" the users have created. For example, if user A inserted \"Cats\"\n    // and user B inserted \"Hats\", without cleanup the result would be either\n    // \"CHats\" or \"HCats\". However with cleanup, the result would be either\n    // \"CatsHats\" or \"HatsCats\" which better represent both users' intentions.\n    //\n    // This behavior allows us to do more aggressive merges while still getting\n    // correct results. This is the heart of our \"conflict-free\" approach.\n    //\n    // TODO(ofri): Properly tune the threshold\n    // if (kDMP.diff_levenshtein(textDiffs) > 3) {\n    //   kDMP.diff_cleanupSemantic(textDiffs);\n    // }\n\n    const result: FlatRepAtom[] = [];\n    for (const diff of textDiffs) {\n      ArrayUtils.append(result, strRep.decode(diff[1]));\n    }\n    return result;\n  }\n\n  static *diffToChanges(diffs: Diff[]): Generator<PatchCommand> {\n    const length = diffs.length;\n    let text1Idx = 0;\n    let text2Idx = 0;\n    for (let changeIdx = 0; changeIdx < length; ++changeIdx) {\n      const change = diffs[changeIdx];\n      const op = change[0];\n      const text = change[1];\n      if (text.length === 0) {\n        /**\n         * Empty diffs is a open bug in the diff-match-patch package:\n         * https://github.com/google/diff-match-patch/issues/105\n         * Currently the practice is to ignore it\n         *  */\n        continue;\n      }\n      switch (op) {\n        case DIFF_EQUAL:\n          text1Idx += text.length;\n          text2Idx += text.length;\n          break;\n\n        case DIFF_DELETE: {\n          if (text.length === 1) {\n            yield {\n              operation: Operation.Delete,\n              start: text1Idx,\n            };\n          } else {\n            yield {\n              operation: Operation.DeleteRange,\n              start: text1Idx,\n              end: text1Idx + text.length,\n            };\n          }\n          text1Idx += text.length;\n          break;\n        }\n\n        case DIFF_INSERT: {\n          yield {\n            operation: Operation.Insert,\n            start: text1Idx,\n            value: text,\n          };\n          text2Idx += text.length;\n          break;\n        }\n      }\n    }\n  }\n}\n\n/**\n * Break text nodes to their atoms so our merge context can correctly merge\n * changes on conflicts. Semantic cleanup is later applied to make sense of the\n * resulting merge.\n *\n * @param changeNodes An array of nodes.\n * @returns A flat rep with single character text nodes.\n */\nfunction* recursiveFlattenTextNodes(\n  changeNodes: TreeNode[]\n): Generator<FlatRepAtom> {\n  for (const node of changeNodes) {\n    if (isTextNode(node)) {\n      for (const atom of flattenTextNode(node, true, undefined, false)) {\n        yield atom;\n      }\n    } else {\n      yield node;\n      if (isElementNode(node)) {\n        for (const atom of recursiveFlattenTextNodes(node.children)) {\n          yield atom;\n        }\n      }\n    }\n  }\n}\n", "import { notReached } from '../../base/error.ts';\nimport { kDMP } from '../base/defs.ts';\nimport { Dictionary } from '../../base/collections/dict.ts';\nimport { HashMap, HashSet } from '../../base/collections/hash-map.ts';\nimport {\n  CoreDictionary,\n  CoreType,\n  CoreValue,\n  coreValueClone,\n  CoreValueCloneOpts,\n  coreValueEquals,\n  getCoreType,\n  isReadonlyCoreObject,\n  ReadonlyCoreObject,\n} from '../../base/core-types/index.ts';\nimport { EqualOptions } from '../../base/core-types/equals.ts';\nimport { encodableValueHash } from '../../base/core-types/encoding/index.ts';\nimport { MergeContext } from './merge-context.ts';\nimport { StringRep } from './string-rep.ts';\nimport {\n  kCoreValueTreeNodeOpts,\n  TextNode,\n  ElementNode,\n  isElementNode,\n  isTextNode,\n  Pointer,\n  RichText,\n  TreeNode,\n  comparePointers,\n  isPointer,\n  PointerDirection,\n  PointerType,\n  RichTextValue,\n  isExpiredPointer,\n  isTrivialTextNode,\n} from './tree.ts';\n\n/**\n * A representation of a pointer by value. The pointer points at the text node\n * that came right before it in the ordered stream. If no such node exists, an\n * implicit empty text node is assumed.\n */\nexport interface PointerValue extends RichTextValue {\n  key: string;\n  type: PointerType;\n  dir: PointerDirection;\n  expiration?: Date;\n}\n\n/**\n * A tree depth marker, used for rebuilding the tree from the flat\n * representation. It determines if newly discovered nodes in the stream will\n * attach inside the current node or next to it.\n */\nexport interface DepthMarker extends RichTextValue {\n  // A bit weird choice of field name, to allow clients to use the more likely\n  // 'depth' keyword as custom node property.\n  readonly depthMarker: number;\n}\n\n/**\n * Used to space element nodes from each other. When converting to a string,\n * spaces are replaced with newlines, which enables the diff match patch by-line\n * optimization to kick in.\n */\ninterface ElementSpacer extends ReadonlyCoreObject {\n  readonly __elementSpacer: true;\n}\n\nexport const kElementSpacer: ElementSpacer = { __elementSpacer: true };\n\nexport type FlatRepAtom = TreeNode | PointerValue | DepthMarker | ElementSpacer;\n\nexport function isTreeNode(node: CoreValue): node is TreeNode {\n  return (\n    isReadonlyCoreObject(node) &&\n    !isDepthMarker(node) &&\n    !isPointer(node) &&\n    !isPointerValue(node) &&\n    !isElementSpacer(node)\n  );\n}\n\nexport function isDepthMarker(obj: CoreValue): obj is DepthMarker {\n  return isReadonlyCoreObject(obj) && typeof obj.depthMarker === 'number';\n}\n\nexport function isElementSpacer(obj: CoreValue): obj is ElementSpacer {\n  return isReadonlyCoreObject(obj) && obj.__elementSpacer === true;\n}\n\nexport function isPointerValue<T extends PointerValue>(\n  obj: CoreValue\n): obj is T {\n  return (\n    isReadonlyCoreObject(obj) &&\n    typeof obj.key === 'string' &&\n    typeof obj.dir === 'number' &&\n    typeof obj.type === 'string'\n  );\n}\n\n/**\n * A pool of cached nodes with values adjusted to their flat rep (single char\n * text, empty children, etc). Used by getFrozenFlatRepNode().\n */\nconst gFrozenTextNodes: Dictionary<\n  TreeNode,\n  Dictionary<string | undefined, TreeNode>\n> = new HashMap(\n  (v) => encodableValueHash(v, kCoreValueTreeNodeOpts),\n  (v1, v2) => coreValueEquals(v1, v2, kCoreValueTreeNodeOpts),\n  (v) => {\n    return coreValueClone(v, {\n      ...kCoreValueTreeNodeOpts,\n      fieldCloneOverride: (\n        obj: ReadonlyCoreObject | CoreDictionary,\n        key: string\n      ) => {\n        if (getCoreType(obj) === CoreType.Dictionary) {\n          return key === 'children' ? [] : (obj as CoreDictionary).get(key);\n        }\n        return key === 'children' ? [] : (obj as ReadonlyCoreObject)[key];\n      },\n    });\n  }\n);\n\n/**\n * Given a text node and a specific character, this function returned a frozen\n * TextNode instance with its text set to the given character. The returned node\n * has the same properties as the provided text node, except its text field.\n * Used when flattening text nodes to avoid costly allocations.\n *\n * NOTE: Each character atom must also hold a full copy of the node's attributes\n * so markers like bold, underline, etc are properly preserved during a merge.\n *\n * @param node The given text node.\n * @param char A single character string.\n * @returns A cached TextNode object.\n */\nfunction getFrozenTextNode(node: TextNode, char: string): TextNode {\n  let dict = gFrozenTextNodes.get(node);\n  if (dict === undefined) {\n    dict = new Map<string, TreeNode>();\n    gFrozenTextNodes.set(node, dict);\n  }\n  let result = dict.get(char);\n  if (result === undefined) {\n    result = coreValueClone(node, kCoreValueTreeNodeOpts);\n    result.text = char;\n    result = Object.freeze(result);\n    dict.set(char, result);\n  }\n  return result as TextNode;\n}\n\nfunction unfreezeTextNode(node: TextNode): TextNode {\n  if (Object.isFrozen(node)) {\n    return coreValueClone(node);\n  }\n  return node;\n}\n\n/**\n * Filters and returns the pointers for a specific node:offset combination.\n *\n * @param ptrSet An iterable of pointers for the rich text.\n * @param node The specific text node.\n * @param local Flag indicating whether local pointers are returned or not.\n * @param offset The pointer's specific index.\n * @returns A stream of Pointer objects.\n */\nfunction* pointersForNode(\n  ptrSet: Iterable<Pointer> | undefined,\n  node: TextNode,\n  local: boolean,\n  offset?: number\n): Generator<Pointer> {\n  if (ptrSet === undefined) {\n    return;\n  }\n  for (const ptr of ptrSet) {\n    if (!local && ptr.isLocal === true) {\n      continue;\n    }\n    if (ptr.node === node && (offset === undefined || ptr.offset === offset)) {\n      yield ptr;\n    }\n  }\n}\n\n/**\n * Given a text node and all pointers, this function breaks it to a stream of\n * character and pointer atoms. Each output atom is a standalone unit and can\n * be reconstructed to a text node on its own. Multiple atoms may be grouped\n * to a single text node during reconstruction where appropriate.\n */\nexport function* flattenTextNode(\n  node: TextNode,\n  local: boolean,\n  sortedPointers?: Pointer[],\n  trailingTextNode = true\n): Generator<TextNode | PointerValue> {\n  // Go over each character in the text. We're using for...of on a string so the\n  // code natively accounts for unicode surrogate pairs.\n  let idx = 0;\n  for (const c of node.text) {\n    // Node comes before its pointers\n    yield getFrozenTextNode(node, c);\n    // Process all pointers on this character\n    if (sortedPointers !== undefined) {\n      for (const ptrAtom of pointersForNode(sortedPointers, node, local, idx)) {\n        // A Pointer is field-compatible with PointerValue so we just spit the\n        // original pointers unmodified\n        yield ptrAtom;\n      }\n    }\n    ++idx;\n  }\n  // Reserve an empty text node for pointers at the end of this text node\n  let emittedEmptyText = false;\n  if (trailingTextNode || node.text.length === 0) {\n    yield getFrozenTextNode(node, '');\n    emittedEmptyText = true;\n  }\n  if (sortedPointers !== undefined) {\n    for (const ptrAtom of pointersForNode(sortedPointers, node, local, idx)) {\n      if (!emittedEmptyText) {\n        yield getFrozenTextNode(node, '');\n        emittedEmptyText = true;\n      }\n      yield ptrAtom;\n    }\n  }\n}\n\n/**\n * If we're not interested in character level text node, we still want to break\n * text nodes on pointer edges so we can flatten their pointers. This\n * transformation is considerably faster than per character flattening, while\n * still being consistent with flat rep logic.\n *\n * @param node The node to split to atoms.\n * @param local Whether to include local pointers or not.\n * @param sortedPointers All pointers available in the rich text.\n */\nfunction* splitTextNodeOnPointers(\n  node: TextNode,\n  local: boolean,\n  sortedPointers?: Pointer[]\n): Generator<TextNode | PointerValue> {\n  if (!sortedPointers || !sortedPointers.length) {\n    yield Object.freeze(coreValueClone(node));\n    return;\n  }\n  // First, get a list of all pointers for this node sorted by offset\n  const sortedPtrsForNode = Array.from(\n    pointersForNode(sortedPointers, node, local)\n  ).sort((p1, p2) =>\n    p1.offset === p2.offset ? comparePointers(p1, p2) : p1.offset - p2.offset\n  );\n  // Break the node to a stream of text nodes and pointer values\n  const nodeText = node.text;\n  let start = 0;\n  for (const ptr of sortedPtrsForNode) {\n    const offset = ptr.offset;\n    if (offset >= start) {\n      // The reconstruction logic assumes pointer values appear after single\n      // character text nodes. Thus, we can keep everything before the pointer's\n      // offset as a single text node.\n      if (offset !== start) {\n        yield Object.freeze({\n          ...node,\n          text: nodeText.substring(start, offset),\n        });\n      }\n      // The actual single character target of our pointer\n      yield getFrozenTextNode(\n        node,\n        offset < nodeText.length ? nodeText[offset] : ''\n      );\n      // Don't repeat the text nodes if there are multiple pointers at the same\n      // offset\n      start = ptr.offset + 1;\n    }\n    // The actual pointer can be returned\n    yield ptr as PointerValue;\n  }\n  // Handle any remaining text after the last pointer\n  if (start < node.text.length) {\n    yield Object.freeze({\n      ...node,\n      text: nodeText.substring(start),\n    });\n  } else if (start === node.text.length) {\n    // If there are no pointers at the end of this node, then we need to produce\n    // an empty text node at the end so pointers can be placed there in future\n    // edits down the line\n    yield getFrozenTextNode(node, '');\n  }\n}\n\n/**\n * Given a parent node, this function yields all of its children's flat\n * representation, recursively.\n * @param parent Parent node.\n * @param parentDepth The depth of the parent node\n * @param local Whether to include local children or not.\n * @param sortedPointers Sorted array of pointers of the entire tree.\n */\nfunction* flattenChildNodes(\n  parent: ElementNode,\n  parentDepth: number,\n  local: boolean,\n  sortedPointers: Pointer[] | undefined,\n  flattenText: boolean\n): Generator<FlatRepAtom> {\n  const children = parent.children;\n  let didOpen = false;\n  for (const child of children) {\n    // Skip local children on non-local run\n    if (!local && child.isLocal === true) {\n      continue;\n    }\n    // Lazily create an opening depth marker. This won't generate any depth\n    // markers on parents where all children were skipped.\n    if (!didOpen) {\n      yield {\n        depthMarker: parentDepth + 1,\n      } as DepthMarker;\n      didOpen = true;\n    }\n    // Recursively flatten this child\n    for (const atom of flattenTreeNode(\n      child,\n      parentDepth + 1,\n      local,\n      sortedPointers,\n      flattenText\n    )) {\n      yield atom;\n    }\n  }\n  // Emit a closing depth marker if needed\n  if (didOpen) {\n    yield {\n      depthMarker: parentDepth,\n    } as DepthMarker;\n  }\n}\n\n/**\n * Recursively flattens a subtree, including the root.\n *\n * @param node The root of the subtree.\n * @param depth The depth of the root node in its parent tree. Pass 0 if its the\n *              actual root of the tree.\n * @param local Should local nodes be included or not.\n * @param sortedPointers A sorted array of all pointers in the tree.\n * @returns A stream of tree atoms.\n */\nfunction* flattenTreeNode(\n  node: TreeNode,\n  depth: number,\n  local: boolean,\n  sortedPointers: Pointer[] | undefined,\n  flattenText: boolean\n): Generator<FlatRepAtom> {\n  if (!local && node.isLocal === true) {\n    return;\n  }\n  if (isTextNode(node)) {\n    if (flattenText) {\n      for (const v of flattenTextNode(node, local, sortedPointers)) {\n        yield v;\n      }\n    } else {\n      // yield node;\n      for (const v of splitTextNodeOnPointers(node, local, sortedPointers)) {\n        yield v;\n      }\n    }\n  } else if (isElementNode(node)) {\n    yield kElementSpacer;\n    yield node;\n    for (const v of flattenChildNodes(\n      node,\n      depth,\n      local,\n      sortedPointers,\n      flattenText\n    )) {\n      yield v;\n    }\n  } else {\n    yield node;\n  }\n}\n/**\n * Flattens a given RichText to a linear stream of atoms.\n * @param rt The RichText to flatten.\n * @param local Whether to include local nodes or note.\n */\nexport function flattenRichText(\n  rt: RichText,\n  local: boolean,\n  flattenText = true\n): Generator<FlatRepAtom> {\n  return flattenSiblingNodes(\n    rt.root.children,\n    0,\n    local,\n    rt.pointers,\n    flattenText\n  );\n}\n\nfunction stripDuplicatePointers(ptrs: Set<Pointer>): Set<Pointer> {\n  const result = new HashSet<Pointer>(\n    encodableValueHash,\n    (p1, p2) => comparePointers(p1, p2) === 0\n  );\n  for (const p of ptrs) {\n    result.add(p);\n  }\n  return new Set(result);\n}\n\n/**\n * Flatten an iterable of sibling nodes.\n * @param iter All siblings\n * @param parentDepth The depth of the parent of all children\n * @param local Should local nodes be included\n * @param pointers All pointers of the tree\n */\nexport function* flattenSiblingNodes(\n  iter: Iterable<FlatRepAtom>,\n  parentDepth: number,\n  local: boolean,\n  pointers: Set<Pointer> | undefined,\n  flattenText: boolean\n): Generator<FlatRepAtom> {\n  // Sort all pointers so our flat representation is consistent where multiple\n  // pointers are present at the same location.\n  const sortedPointers =\n    pointers !== undefined\n      ? Array.from<Pointer>(stripDuplicatePointers(pointers)).sort(\n          comparePointers\n        )\n      : undefined;\n  for (const atom of iter) {\n    for (const flatAtom of flattenTreeNode(\n      atom,\n      parentDepth,\n      local,\n      sortedPointers,\n      flattenText\n    )) {\n      yield flatAtom;\n    }\n  }\n}\n\nfunction cleanCloneTreeAtomField(\n  obj: ReadonlyCoreObject | CoreDictionary,\n  key: string,\n  _opts?: CoreValueCloneOpts\n): CoreValue {\n  if (key === 'children' && isElementNode(obj as CoreValue)) {\n    return [];\n  }\n\n  const type = getCoreType(obj);\n  if (type === CoreType.Dictionary) {\n    return (obj as Dictionary).get(key);\n  } else {\n    return (obj as ReadonlyCoreObject)[key];\n  }\n}\n\n/**\n * Given a flat representation, this function filters out the pointer values\n * and reconstructs a set of pointers. It assumes the flat rep has text nodes\n * still broken to single char nodes. Yielded text nodes already have their\n * pointers populated in outPtrs at the time of yield.\n *\n * @param flatRep An existing flat representation.\n * @param outPtrs A mapping from text nodes to their pointers\n * @returns A filtered flat rep without pointer values.\n */\nfunction* reconstructPointers(\n  flatRep: Iterable<FlatRepAtom>,\n  outPtrs: Map<TextNode, Set<Pointer>>\n): Generator<FlatRepAtom> {\n  let pendingTextNode: TextNode | undefined;\n  for (const atom of flatRep) {\n    if (isPointerValue(atom)) {\n      // Create an implicit empty text node if no text node came before this\n      // pointer.\n      if (pendingTextNode === undefined) {\n        pendingTextNode = { text: '' };\n      }\n      // Get the set of pointers for our text node\n      let ptrSet = outPtrs.get(pendingTextNode);\n      if (ptrSet === undefined) {\n        ptrSet = new Set();\n        outPtrs.set(pendingTextNode, ptrSet);\n      }\n      // Add the pointer at offset 0 since we're still assuming single character\n      // text nodes at this point\n      ptrSet.add({\n        ...atom,\n        node: pendingTextNode,\n        offset: Math.max(pendingTextNode.text.length - 1, 0),\n      });\n    } else {\n      // Found a non-pointer value. Yield any pending text node\n      if (pendingTextNode !== undefined) {\n        yield pendingTextNode;\n      }\n      if (isTextNode(atom)) {\n        // New text node found. Wait for read ahead before doing anything with\n        // it\n        pendingTextNode = unfreezeTextNode(atom);\n      } else {\n        // Not a text node. Reset and yield unmodified.\n        pendingTextNode = undefined;\n        yield atom;\n      }\n    }\n  }\n  // Handle any pending text node at the end of the stream\n  if (pendingTextNode !== undefined) {\n    yield pendingTextNode;\n  }\n}\n\nconst kFilterTextField: EqualOptions = {\n  objectFilterFields: (key: string) => key !== 'text',\n};\n\n/**\n * Given a flat rep, this function reconstructs text nodes and their pointers.\n * It'll concat individual text nodes, and rebuild any pointer values.\n *\n * @param flatRep A flat rep.\n * @param ptrOffsetter An optional function used to correct pointers from\n *                     deleted text nodes to their new ones.\n * @returns A flat rep with full text nodes.\n */\nexport function* reconstructTextNodes(\n  flatRep: Iterable<FlatRepAtom>,\n  ptrOffsetter?: (\n    deletedNode: TextNode,\n    newNode: TextNode,\n    newOffset: number\n  ) => void\n): Generator<FlatRepAtom> {\n  let lastTextNode: TextNode | undefined;\n  for (const atom of flatRep) {\n    if (\n      isTextNode(atom) &&\n      // If we have an offsetter, we can handle empty text nodes that exist for\n      // pointers. Otherwise, we must leave them unmodified so later steps can\n      // handle them\n      (ptrOffsetter || atom.text.length > 0) &&\n      coreValueEquals(atom, lastTextNode, kFilterTextField)\n    ) {\n      // The current atom is equal (ignoring text field) to the last text node\n      // we yielded. We can safely append its text to the last node and skip it.\n      // NOTE: This mutates nodes that we have already yielded. Make sure the\n      // caller isn't copying nodes as it receives them.\n      lastTextNode!.text += atom.text;\n      if (ptrOffsetter !== undefined) {\n        // New pointer offset is length of string before concatenation\n        const offset = lastTextNode!.text.length - atom.text.length;\n        ptrOffsetter(atom, lastTextNode!, offset);\n      }\n    } else {\n      // Current text node isn't equal to last next node\n      if (isTextNode(atom)) {\n        // First, copy it as we're probably dealing with a frozen instance from\n        // getFrozenTextNode().\n        lastTextNode = unfreezeTextNode(atom);\n        // Yield it\n        yield lastTextNode;\n        // Fixup any pointers that pointed at the frozen text node.\n        if (ptrOffsetter !== undefined) {\n          ptrOffsetter(atom, lastTextNode!, 0);\n          for (let i = 1; i < lastTextNode!.text.length; ++i) {\n            ptrOffsetter(atom, lastTextNode!, i);\n          }\n        }\n      } else {\n        // Current node isn't a text node. Clear our state and spit it out\n        // unmodified.\n        lastTextNode = undefined;\n        yield atom;\n      }\n    }\n  }\n}\n\n/**\n * Given a flat rep, this function reconstructs a RichText representation from\n * it.\n *\n * @param flatRep A flat rep\n * @returns A new RichText object (with internal copies of the flat rep as\n *          needed).\n */\nexport function reconstructRichText(flatRep: Iterable<FlatRepAtom>): RichText {\n  const root: ElementNode = { children: [] };\n  const pointers = new Set<Pointer>();\n  const path: ElementNode[] = [root];\n  const charPointersMap = new Map<TextNode, Set<Pointer>>();\n  // Rebuild pointers from pointer values\n  flatRep = reconstructPointers(flatRep, charPointersMap);\n  // Concat single char text nodes to full text nodes while re-aligning pointers\n  flatRep = reconstructTextNodes(flatRep, (deletedNode, newNode, newOffset) => {\n    const ptrs = charPointersMap.get(deletedNode);\n    if (ptrs) {\n      for (const p of ptrs) {\n        p.node = newNode;\n        p.offset = newOffset;\n        pointers.add(p);\n      }\n    }\n  });\n  // At this point our flat rep has no pointers, and text nodes have been\n  // rebuilt with full length strings. Proceed to reconstruct the tree.\n  for (let value of flatRep) {\n    if (isElementSpacer(value)) {\n      continue; // Skip diff speedup spacers\n    } else if (isDepthMarker(value)) {\n      // Depth marker found. If it's bigger than current depth, try to drill one\n      // level in\n      if (value.depthMarker >= path.length) {\n        const curParent = path[path.length - 1];\n        const children = curParent.children;\n        if (children.length > 0) {\n          const lastChild = children[children.length - 1];\n          if (isElementNode(lastChild)) {\n            path.push(lastChild);\n          }\n        }\n      }\n      // As long as our marker is lesser than current depth, back up one level\n      while (value.depthMarker < path.length - 1) {\n        path.pop();\n      }\n    } else if (isTreeNode(value)) {\n      // Found a node. Append it to current parent\n      const parent = path[path.length - 1];\n      const children = parent.children;\n      if (!isTextNode(value)) {\n        // Next nodes have already been copied by reconstructTextNodes().\n        // We must copy other nodes ourselves.\n        value = coreValueClone(value, {\n          fieldCloneOverride: cleanCloneTreeAtomField,\n        });\n      }\n      children.push(value);\n    } else {\n      notReached('Unknown atom');\n    }\n  }\n  const result: RichText = {\n    root,\n  };\n  if (pointers.size > 0) {\n    result.pointers = pointers;\n  }\n  return result;\n}\n\nconst kCoreValuePtrToValue: CoreValueCloneOpts = {\n  objectFilterFields: (key: string) => key !== 'node' && key !== 'offset',\n};\n\n/**\n * Converts pointers to pointer values.\n */\nexport function* convertPtrsToValues(\n  flatRep: Iterable<FlatRepAtom>\n): Generator<FlatRepAtom> {\n  for (const atom of flatRep) {\n    if (isPointer(atom)) {\n      yield coreValueClone(atom, kCoreValuePtrToValue);\n    } else {\n      yield atom;\n    }\n  }\n}\n\n/**\n * @param pointers A set of pointers.\n * @returns A set of all pointer keys.\n */\nfunction keysFromPointers(pointers: Set<Pointer> | undefined): Set<string> {\n  const result = new Set<string>();\n  if (pointers === undefined) {\n    return result;\n  }\n  for (const ptr of pointers) {\n    result.add(ptr.key);\n  }\n  return result;\n}\n\n/**\n * An [index, pointer] tuple.\n */\ntype IndexedPointerValue = [index: number, ptr: PointerValue];\n\nfunction* filterExpiredPointers(\n  flatRep: Iterable<FlatRepAtom>\n): Generator<FlatRepAtom> {\n  for (const atom of flatRep) {\n    if (!isPointerValue(atom) || !isExpiredPointer(atom)) {\n      yield atom;\n    }\n  }\n}\n\n/**\n * Given a flat rep, this function filters out pointers as per the given filter\n * function.\n * @param flatRep The flat rep to filter.\n * @param outFilteredPointers An array to which the removed pointers and their\n *                            corresponding indexes will be added.\n * @param filter A filter function.\n */\nfunction* filteredPointersRep(\n  flatRep: Iterable<FlatRepAtom>,\n  filter: (ptr: PointerValue) => boolean,\n  outFilteredPointers?: IndexedPointerValue[]\n): Generator<FlatRepAtom> {\n  let idx = 0;\n  for (let atom of flatRep) {\n    if (isPointerValue(atom) && filter(atom)) {\n      // Convert pointers to values\n      if (isPointer(atom)) {\n        atom = coreValueClone(atom, kCoreValuePtrToValue);\n      }\n      if (outFilteredPointers) {\n        outFilteredPointers.push([Math.max(0, idx - 1), atom as PointerValue]);\n      }\n    } else {\n      yield atom;\n      ++idx;\n    }\n  }\n}\n\nfunction flatDestForPointerProjection(\n  dstRt: RichText,\n  needFilter: boolean,\n  filter: (ptr: PointerValue) => boolean\n) {\n  const flat = flattenRichText(dstRt, true, true);\n  if (needFilter) {\n    return filteredPointersRep(flat, filter);\n  }\n  return flat;\n}\n\nexport function pointerIsExpired(ptr: PointerValue): boolean {\n  const expiration = ptr.expiration;\n  return expiration !== undefined && expiration.getTime() < Date.now();\n}\n\nfunction hasPointersToProject(\n  ptrSet: Set<Pointer>,\n  filter: (ptr: PointerValue) => boolean,\n  skipExpired: boolean\n): boolean {\n  for (const ptr of ptrSet) {\n    if (filter(ptr) && (!skipExpired || !pointerIsExpired(ptr))) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Given two rich texts, this function:\n * 1. Finds which pointers are present in the source but are missing in the\n *    destination.\n * 2. Projects all missing pointers into the destination text's domain.\n * 3. Constructs and returns a new rich text containing all missing pointers\n *    from the source text.\n * @param srcRt The source text.\n * @param dstRt The destination text.\n * @returns A new RichText instance with all missing pointers.\n */\nexport function projectPointers(\n  srcRt: RichText,\n  dstRt: RichText,\n  filter: (ptr: PointerValue) => boolean,\n  skipExpired = true,\n  filterDest = false\n): RichText {\n  // Shortcut if we don't need to do any work\n  if (\n    srcRt.pointers === undefined ||\n    srcRt.pointers.size === 0 ||\n    !hasPointersToProject(srcRt.pointers, filter, skipExpired) ||\n    coreValueEquals(srcRt, dstRt)\n  ) {\n    return coreValueClone(dstRt);\n  }\n  const ptrsToProject: IndexedPointerValue[] = [];\n  // Flatten our source text while stripping out pointers that need to be\n  // projected. This transforms the src text to the same domain as the\n  // destination text, making a diff meaningful. Without filtering, all missing\n  // pointers would count as deleted in the destination.\n  let flatRepSrc: Iterable<FlatRepAtom> = flattenRichText(srcRt, true, true);\n  // flatRepSrc = Array.from(flatRepSrc);\n  if (skipExpired) {\n    flatRepSrc = filterExpiredPointers(flatRepSrc);\n    // flatRepSrc = Array.from(flatRepSrc);\n  }\n  flatRepSrc = filteredPointersRep(flatRepSrc, filter, ptrsToProject);\n  // flatRepSrc = Array.from(flatRepSrc);\n  // Flatten normally the destination text, including its pointers\n  const strRep = new StringRep(kCoreValueTreeNodeOpts);\n  const str1 = strRep.encode(flatRepSrc);\n\n  const str2 = strRep.encode(\n    flatDestForPointerProjection(dstRt, filterDest, filter)\n  );\n  // Compute a diff from our filtered source to our unmodified destination\n  const textDiffs = kDMP.diff_main(str1, str2, true);\n  const mergeCtx = new MergeContext(\n    flatDestForPointerProjection(dstRt, filterDest, filter),\n    kCoreValueTreeNodeOpts\n  );\n  // For every pointer that need to be projected, we take its index in the\n  // filtered source, project it to an index in the destination text, then\n  // merge the pointer in at that index.\n  for (const [srcIdx, ptrValue] of ptrsToProject) {\n    // PointerValue must appear after the text node it points at so add 1 to\n    // the destination index\n    mergeCtx.insert(kDMP.diff_xIndex(textDiffs, srcIdx) + 1, ptrValue);\n  }\n  // Now our merge context holds the destination text with projected pointers\n  // inserted in the correct places. We can safely reconstruct the updated tree.\n  return reconstructRichText(mergeCtx.finalize());\n  // const result = Array.from(mergeCtx.finalize());\n  // return reconstructRichText(result);\n}\n\n/**\n * Given a flat rep, this function filters out any non-local formatting. The\n * resulting representation contains a single paragraph with all leaf nodes,\n * as all as any local elements.\n * @param flatRep\n */\nexport function* stripFormattingFilter(\n  flatRep: Iterable<FlatRepAtom>\n): Generator<FlatRepAtom> {\n  let depth = 0;\n  let hasOpenParagraph = false;\n  for (const atom of flatRep) {\n    if (isDepthMarker(atom)) {\n      depth = atom.depthMarker;\n    }\n    if (!isTreeNode(atom)) {\n      yield atom;\n      continue;\n    }\n    if (isTextNode(atom) || !isElementNode(atom)) {\n      // Found a leaf. First open a paragraph if needed.\n      if (!hasOpenParagraph) {\n        ++depth;\n        yield {\n          tagName: 'p',\n          children: [],\n        } as ElementNode;\n        yield {\n          depthMarker: depth,\n        } as DepthMarker;\n        hasOpenParagraph = true;\n      }\n      // Trivial or non text nodes can be returned as is\n      if (isTrivialTextNode(atom) || !isElementNode(atom)) {\n        yield atom;\n      } else {\n        // Non-trivial text nodes need to have their formatting stripped out\n        // (i.e make them trivial)\n        const copy: TextNode = {\n          text: (atom as unknown as TextNode).text,\n        };\n        if (copy.isLocal === true) {\n          copy.isLocal = true;\n        }\n        yield copy;\n      }\n    } else if (isElementNode(atom) && atom.isLocal === true) {\n      // Close our open paragraph if we found a local element\n      if (hasOpenParagraph) {\n        yield {\n          depthMarker: --depth,\n        } as DepthMarker;\n        hasOpenParagraph = false;\n      }\n      yield atom;\n    }\n  }\n  if (hasOpenParagraph) {\n    yield {\n      depthMarker: --depth,\n    } as DepthMarker;\n    hasOpenParagraph = false;\n  }\n}\n", "import { assert, notReached } from '../../base/error.ts';\nimport { Dictionary } from '../../base/collections/dict.ts';\nimport {\n  coreValueClone,\n  isReadonlyCoreObject,\n  CoreObject,\n  CoreValue,\n  CoreDictionary,\n  CoreType,\n  CoreValueCloneOpts,\n  getCoreType,\n  ReadonlyCoreObject,\n} from '../../base/core-types/index.ts';\nimport { OrderedMap } from '../../base/collections/orderedmap.ts';\nimport { kElementSpacer, FlatRepAtom } from './flat-rep.ts';\n\nexport const kCoreValueTreeNodeOpts = {\n  objectFilterFields: treeAtomKeyFilterIgnoreText,\n};\n\nexport interface RichText extends CoreObject {\n  root: ElementNode;\n  pointers?: Set<Pointer>;\n}\n\nexport function isRichText(v: CoreValue): v is RichText {\n  return isReadonlyCoreObject(v) && isElementNode(v.root);\n}\n\nexport function onlyNoneLocal(v: CoreValue) {\n  return isReadonlyCoreObject(v) && v.isLocal !== true;\n}\n\n/**\n * Base type for all rich text values in both tree and flat representations.\n */\nexport interface RichTextValue extends CoreObject {\n  isLocal?: boolean;\n}\n\nexport type TreeNode = TextNode | ElementNode | RichTextValue;\n\nexport interface TextNode extends RichTextValue {\n  text: string;\n}\n\nexport interface ElementNode extends RichTextValue {\n  children: TreeNode[];\n}\n\nexport type PointerType = 'anchor' | 'focus';\n\nexport enum PointerDirection {\n  Forward = 1,\n  Backward = -1,\n  None = 0,\n}\n\nexport interface Point extends CoreObject {\n  local?: boolean;\n  node: TextNode;\n  offset: number;\n}\n\nexport interface Pointer extends Point {\n  key: string;\n  type: PointerType;\n  dir: PointerDirection;\n  expiration?: Date;\n}\n\nexport function treeAtomKeyFilterIgnoreText(\n  key: string,\n  obj: CoreValue\n): boolean {\n  if (key === 'children' && isElementNode(obj)) {\n    return false;\n  }\n  if ((key === 'node' || key === 'offset') && isPointer(obj)) {\n    return false;\n  }\n  return true;\n}\n\nexport function treeAtomKeyFilter(key: string, obj: CoreValue): boolean {\n  if (key === 'text' && isTextNode(obj)) {\n    return false;\n  }\n  return treeAtomKeyFilterIgnoreText(key, obj);\n}\n\nexport function isTextNode(node: CoreValue): node is TextNode {\n  return isReadonlyCoreObject(node) && typeof node.text === 'string';\n}\n\nexport function isElementNode(node: CoreValue): node is ElementNode {\n  return isReadonlyCoreObject(node) && node.children instanceof Array;\n}\n\nexport function isPointer(obj: CoreValue): obj is Pointer {\n  return isReadonlyCoreObject(obj) && isTextNode(obj.node);\n}\n\nexport function isNodeSameLocality(n1: TreeNode, n2: TreeNode) {\n  if (n1.isLocal === true) {\n    return n2.isLocal === true;\n  }\n\n  if (n2.isLocal === true) {\n    return false;\n  }\n\n  return true;\n}\n\nexport function isTrivialTextNode(node: TreeNode): node is TextNode {\n  if (!isTextNode(node)) {\n    return false;\n  }\n  for (const k in node) {\n    // deno-lint-ignore no-prototype-builtins\n    if (node.hasOwnProperty(k) && k !== 'text') {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function copyTreeAtom<T extends FlatRepAtom>(node: FlatRepAtom): T {\n  if (node === kElementSpacer) {\n    return node as T;\n  }\n  const result = coreValueClone(node, {\n    objectFilterFields: treeAtomKeyFilter,\n  });\n  if (isTextNode(node)) {\n    (result as TextNode).text = '';\n  } else if (isElementNode(node)) {\n    (result as ElementNode).children = [];\n  }\n  return result as T;\n}\n\nexport function comparePointers(ptr1: Pointer, ptr2: Pointer): number {\n  // Compare by keys\n  if (ptr1.key !== ptr2.key) {\n    if (ptr1.key < ptr2.key) {\n      return -1;\n    } else {\n      return 1;\n    }\n  }\n  // Keys equal. Compare by types\n  if (ptr1.type !== ptr2.type) {\n    if (ptr1.type < ptr2.type) {\n      return -1;\n    } else {\n      return 1;\n    }\n  }\n  // Types equal. Compare by directions\n  if (ptr1.dir !== ptr2.dir) {\n    return ptr1.dir - ptr2.dir;\n  }\n  // Directions equal. Compare by expiration\n  if (!ptr1.expiration) {\n    if (ptr2.expiration) {\n      return -1;\n    }\n  } else if (!ptr2.expiration) {\n    return 1;\n  } else if (ptr1.expiration.getTime() !== ptr2.expiration.getTime()) {\n    return ptr1.expiration.getTime() - ptr2.expiration.getTime();\n  }\n  return 0;\n}\n\nexport function initRichText(): RichText {\n  return {\n    root: initRichTextRoot(),\n  };\n}\n\nexport function initRichTextRoot(): ElementNode {\n  return {\n    children: [\n      {\n        tagName: 'p',\n        children: [\n          {\n            text: '',\n          },\n        ],\n      },\n    ],\n  };\n}\n\nexport function* dfs(\n  root: ElementNode,\n  mutate = false,\n  _depth = 0,\n  _path: ElementNode[] = []\n): Generator<readonly [TreeNode, number, readonly ElementNode[]]> {\n  const children = mutate ? Array.from(root.children) : root.children;\n  for (const child of children) {\n    yield [child, _depth, _path];\n    if (isElementNode(child)) {\n      _path.push(child);\n      for (const value of dfs(child, mutate, _depth + 1, _path)) {\n        yield value;\n      }\n      assert(_path.pop() === child);\n    }\n  }\n}\n\nexport function pointToAbsOffset(\n  offsetsMap: OrderedMap<TreeNode, number>,\n  ptr: Point\n): number {\n  const nodeOffset = offsetsMap.get(ptr.node);\n  assert(nodeOffset !== undefined);\n  return offsetsMap.get(ptr.node)! + ptr.offset;\n}\n\nfunction* lookupNeighbors(\n  offsetsMap: OrderedMap<TreeNode, number>,\n  src: TreeNode\n): Generator<[TreeNode, number]> {\n  let next = offsetsMap.next(src);\n  let prev = offsetsMap.prev(src);\n  while (!(next === undefined && prev === undefined)) {\n    if (prev !== undefined) {\n      yield [prev, -1];\n      prev = offsetsMap.prev(prev);\n    }\n    if (next !== undefined) {\n      yield [next, 1];\n      next = offsetsMap.next(next);\n    }\n  }\n}\n\n/**\n * Translates an absolute offset to a relative pointer.\n *\n * @param offsetsMap The offsets map of our rich text.\n * @param offset The offset to translate.\n * @returns A relative pointer.\n */\nexport function pointFromAbsOffset(\n  offsetsMap: OrderedMap<TreeNode, number>,\n  offset: number\n): Point {\n  // First, find the node which holds our absolute offset\n  let targetNodeOffset = 0;\n  let targetNode = offsetsMap.startKey!;\n  for (const [node, nodeOffset] of offsetsMap) {\n    if (nodeOffset > offset) {\n      break;\n    }\n    targetNode = node;\n    targetNodeOffset = nodeOffset;\n  }\n  // If we're lucky, our pointer falls inside a text node. Convert to relative\n  // offset and we're done.\n  if (isTextNode(targetNode)) {\n    return {\n      node: targetNode,\n      offset: offset - targetNodeOffset,\n    };\n  }\n  // Our target node isn't a text node. Start a lookup in both directions to\n  // find the nearest text node\n  for (const [candidate, dir] of lookupNeighbors(offsetsMap, targetNode)) {\n    if (isTextNode(candidate)) {\n      return {\n        node: candidate,\n        // If we landed on a previous node, place the pointer at its end.\n        // If we landed on a later node, place the pointer at its start.\n        offset:\n          offsetsMap.get(candidate)! + (dir < 0 ? candidate.text.length : 0),\n      };\n    }\n  }\n  // Lookup failed. A pointer can't be rebuilt from the given offset since the\n  // tree has no text nodes\n  notReached('Rich text has no text nodes');\n}\n\n/**\n *\n * @param v\n * @param buffer in milliseconds\n * @returns\n */\nexport function isExpiredPointer(v: CoreValue, buffer = 0): boolean {\n  return (\n    isPointer(v) &&\n    v.expiration !== undefined &&\n    v.expiration.getTime() + buffer < Date.now()\n  );\n}\n\n/**\n *\n * @param rt\n * @param buffer in milliseconds\n * @returns\n */\nexport function purgeExpiredPointers(\n  rt: RichText,\n  buffer = 0\n): RichText | undefined {\n  if (rt.pointers === undefined || rt.pointers.size === 0) {\n    return undefined;\n  }\n  const now = Date.now();\n  let foundExpired = false;\n  for (const ptr of rt.pointers) {\n    if (\n      ptr.expiration !== undefined &&\n      ptr.expiration.getTime() + buffer < now\n    ) {\n      foundExpired = true;\n      break;\n    }\n  }\n  if (foundExpired) {\n    const newPtrs = new Set<Pointer>();\n    for (const ptr of rt.pointers) {\n      if (ptr.expiration === undefined || ptr.expiration.getTime() >= now) {\n        newPtrs.add(ptr);\n      }\n    }\n    const result: RichText = {\n      root: rt.root,\n    };\n    if (newPtrs.size > 0) {\n      result.pointers = newPtrs;\n    }\n    return result;\n  }\n  return undefined;\n}\n\nexport function* pointersForNode(\n  ptrSet: Iterable<Pointer> | undefined,\n  node: TreeNode,\n  local: boolean,\n  offset?: number\n): Generator<Pointer> {\n  if (ptrSet === undefined) {\n    return;\n  }\n  for (const ptr of ptrSet) {\n    if (!local && ptr.isLocal === true) {\n      continue;\n    }\n    if (ptr.node === node && (offset === undefined || ptr.offset === offset)) {\n      yield ptr;\n    }\n  }\n}\n\nexport function cleanCloneTreeAtom(\n  obj: ReadonlyCoreObject | CoreDictionary,\n  key: string,\n  _opts?: CoreValueCloneOpts\n): CoreValue {\n  if (key === 'children' && isElementNode(obj as CoreValue)) {\n    return [];\n  }\n\n  if (key === 'text' && isTextNode(obj as CoreValue)) {\n    return '';\n  }\n\n  const type = getCoreType(obj);\n  if (type === CoreType.Dictionary) {\n    return (obj as Dictionary).get(key);\n  } else {\n    return (obj as ReadonlyCoreObject)[key];\n  }\n}\n\nexport function treeIsSubtree(root: ElementNode, subtree: TreeNode): boolean {\n  if (root === subtree) {\n    return true;\n  }\n  for (const [node] of dfs(root)) {\n    if (node === subtree) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function treeToPlaintext(root: ElementNode | undefined): string {\n  if (!root) {\n    return '';\n  }\n  let result = '';\n  let prevDepth = 1;\n  for (const [node, depth] of dfs(root)) {\n    if (depth !== prevDepth) {\n      result += '\\n';\n      prevDepth = depth;\n    }\n\n    if (isTextNode(node)) {\n      result += node.text;\n    }\n  }\n  return result.trim();\n}\n\n// export function isDuplicateTitleBug(rt: RichText): boolean {\n//   const txt = treeToPlaintext(rt.root);\n//   const len = txt.length;\n//   if (len <= 0 || len % 2 !== 0) {\n//     return false;\n//   }\n//   const mid = txt.length / 2;\n//   return txt.substring(0, mid) === txt.substring(mid);\n// }\n\n// export function fixDuplicateTitleBug(rt: RichText): RichText {\n//   while (isDuplicateTitleBug(rt)) {\n//     const txt = treeToPlaintext(rt.root);\n//     rt = {\n//       root: {\n//         tagName: 'p',\n//         children: [\n//           {\n//             text: txt.substring(0, txt.length / 2),\n//           },\n//         ],\n//       },\n//     };\n//   }\n//   return rt;\n// }\n", "import { AttachmentData } from '../base/scheme-types.ts';\nimport {\n  CoreValue,\n  isReadonlyCoreObject,\n} from '../../base/core-types/index.ts';\nimport { ElementNode, isTextNode, RichTextValue, TextNode } from './tree.ts';\n\nexport type MarkupNode =\n  | ParagraphNode\n  | Header1Node\n  | Header2Node\n  | UnorderedListNode\n  | OrderedListNode\n  | ListItemNode\n  | TableNode\n  | TableRowNode\n  | TableCellNode\n  | RefNode\n  | RefMarker\n  | SpanNode\n  | ObjectNode\n  | HyperlinkNode\n  | ImageNode\n  | MentionElement;\n\nexport interface ParagraphNode extends ElementNode {\n  readonly tagName: 'p';\n}\n\nexport interface Header1Node extends ElementNode {\n  readonly tagName: 'h1';\n}\n\nexport interface Header2Node extends ElementNode {\n  readonly tagName: 'h2';\n}\n\nexport interface UnorderedListNode extends ElementNode {\n  readonly tagName: 'ul';\n}\n\nexport interface OrderedListNode extends ElementNode {\n  readonly tagName: 'ol';\n}\n\nexport interface ListItemNode extends ElementNode {\n  readonly tagName: 'li';\n}\n\nexport interface TableNode extends ElementNode {\n  readonly tagName: 'table';\n}\n\nexport interface TableRowNode extends ElementNode {\n  readonly tagName: 'tr';\n}\n\nexport interface TableCellNode extends ElementNode {\n  readonly tagName: 'td';\n}\n\nexport enum RefType {\n  Link = 'link',\n  InternalDoc = 'inter-doc',\n}\n\n/**\n * A leaf node marker for a reference. It is used in the following cases:\n *\n * - In persistent, decomposed, rich text. This node is what's actually stored\n *   in the body field of a note.\n *\n * - During composition, to represent a reference that's still loading.\n */\nexport interface RefMarker extends RichTextValue {\n  ref: string;\n  readonly type: RefType;\n  readonly loading?: true;\n}\n\n/**\n * A composited reference node as an element. Its children hold a\n * representation of the reference's target.\n */\nexport interface RefNode extends ElementNode, RefMarker {\n  readonly tagName: 'ref';\n  ref: string;\n  type: RefType;\n}\n\nexport function isRefNode(atom: CoreValue): atom is RefNode {\n  return (\n    isReadonlyCoreObject(atom) &&\n    atom.tagName === 'ref' &&\n    typeof atom.ref === 'string' &&\n    typeof atom.type === 'string'\n  );\n}\n\nexport function isRefMarker(atom: CoreValue): atom is RefMarker {\n  return (\n    isReadonlyCoreObject(atom) &&\n    typeof atom.ref === 'string' &&\n    typeof atom.type === 'string' &&\n    (atom.local === undefined || atom.local === true)\n  );\n}\n\nexport interface SpanNode extends TextNode {\n  readonly tagName: 'span';\n  bold?: boolean;\n  underline?: boolean;\n  strike?: boolean;\n  italic?: boolean;\n}\n\nexport function isSpanNode(atom: CoreValue): atom is SpanNode {\n  return isTextNode(atom) && atom.tagName === 'span';\n}\n\nexport interface HyperlinkNode extends TextNode {\n  readonly tagName: 'a';\n  href: string;\n}\n\nexport interface ObjectNode extends RichTextValue {\n  readonly tagName: 'object';\n}\n\nexport interface ImageNode extends RichTextValue {\n  readonly tagName: 'img';\n  src: string;\n}\n\nexport interface InlineTaskNode extends ElementNode {\n  readonly tagName: 'inline-task';\n  assignees?: Set<string>;\n  attachments?: Set<AttachmentData>;\n  tags?: Set<string>;\n  dueDate?: Date;\n  status?: number;\n}\n\nexport interface MentionElement extends ElementNode {\n  tagName: 'mention';\n  pluginId: string;\n  isLocal: true;\n}\n", "import { EncodedChange, Change, ChangeType } from './index.ts';\nimport {\n  CoreValue,\n  Encoder,\n  coreValueClone,\n  CoreOptions,\n  coreValueEquals,\n} from '../../base/core-types/index.ts';\nimport {\n  ConstructorDecoderConfig,\n  isDecoderConfig,\n} from '../../base/core-types/encoding/index.ts';\nimport { Operation } from '../richtext/merge-context.ts';\nimport { TreeNode } from '../richtext/tree.ts';\n\nexport interface EncodedRTChange extends EncodedChange {\n  readonly changeType: 'rt';\n  readonly op: Operation;\n  readonly start: number;\n  readonly end?: number;\n  readonly values?: TreeNode[];\n}\n\nexport interface RichTextChangeConfig {\n  readonly op: Operation;\n  readonly start: number;\n  end?: number;\n  values?: TreeNode[];\n}\n\nexport class RichTextChange extends Change<EncodedRTChange> {\n  readonly op: Operation;\n  readonly start: number;\n  readonly end?: number;\n  readonly values?: TreeNode[];\n\n  constructor(\n    config: RichTextChangeConfig | ConstructorDecoderConfig<EncodedRTChange>\n  ) {\n    super(config);\n    if (isDecoderConfig(config)) {\n      this.op = config.decoder.get<Operation>('op')!;\n      this.start = config.decoder.get<number>('start')!;\n      if (config.decoder.has('end')) {\n        this.end = config.decoder.get<number>('end');\n      }\n      if (config.decoder.has('values')) {\n        this.values = config.decoder.get('values') as TreeNode[];\n      }\n    } else {\n      this.op = config.op;\n      this.start = config.start;\n      if (config.end !== undefined) {\n        this.end = config.end;\n      }\n      if (config.values !== undefined) {\n        this.values = config.values;\n      }\n    }\n  }\n\n  getType(): ChangeType {\n    return 'rt';\n  }\n\n  serialize(\n    encoder: Encoder<keyof EncodedRTChange, CoreValue>,\n    opts?: CoreOptions\n  ): void {\n    super.serialize(encoder, opts);\n    encoder.set('op', this.op);\n    encoder.set('start', this.start);\n    if (this.end !== undefined) {\n      encoder.set('end', this.end);\n    }\n    if (this.values !== undefined) {\n      encoder.set('values', coreValueClone(this.values, opts));\n    }\n  }\n\n  isEqual(other: RichTextChange): boolean {\n    return (\n      this.op === other.op &&\n      this.start === other.start &&\n      this.end === other.end &&\n      coreValueEquals(this.values, other.values)\n    );\n  }\n}\n", "import {\n  RichTextChange,\n  RichTextChangeConfig,\n} from '../change/richtext-change.ts';\nimport { isElementNode, kCoreValueTreeNodeOpts, RichText } from './tree.ts';\nimport { MergeContext } from './merge-context.ts';\nimport { StringRep } from './string-rep.ts';\nimport { kDMP } from '../base/defs.ts';\nimport {\n  convertPtrsToValues,\n  FlatRepAtom,\n  flattenRichText,\n  reconstructRichText,\n  reconstructTextNodes,\n} from './flat-rep.ts';\nimport { Diff } from '../../external/diff-match-patch.ts';\nimport {\n  coreValueClone,\n  coreValueEquals,\n} from '../../base/core-types/index.ts';\n\n/**\n * This function copies each element node and returns the copy with empty\n * children field.\n * @param flatRep Input flat rep.\n */\nfunction* cleanCopyElementNodes(\n  flatRep: Iterable<FlatRepAtom>\n): Generator<FlatRepAtom> {\n  for (const atom of flatRep) {\n    if (isElementNode(atom)) {\n      const copy = coreValueClone(atom, kCoreValueTreeNodeOpts);\n      copy.children = [];\n      yield copy;\n    } else {\n      yield atom;\n    }\n  }\n}\n\nexport function* decodeStringDiff(\n  diff: Diff[],\n  strRep: StringRep\n): Generator<RichTextChange> {\n  for (const cmd of MergeContext.diffToChanges(diff)) {\n    let values: FlatRepAtom[] | undefined;\n    if (cmd.value !== undefined) {\n      // Our diff works at the character level, but our patch works at the node\n      // level. To make them compatible we need to reconstruct text nodes from\n      // our character diff. The steps are as follows:\n      //\n      // 1. Convert back the string value to atoms (where text nodes are broken\n      //    to individual characters).\n      //\n      // 2. Up to this point we were using the actual node instances from the\n      //    original trees (zero-copy). This means that the `children` field of\n      //    element nodes, and the `text` field of text nodes point to values\n      //    that are correct in their original trees. To output a correct\n      //    change, we copy those nodes and reset their fields to an empty\n      //    state.\n      //\n      // 3. Re-group characters and reconstruct text nodes, which is now\n      //    possible since our text nodes have a correct, empty, `text` field.\n      //\n      // 4. Pack all TreeAtoms nice and warm in an array for our change to hold.\n      //    Up to this point everything used a pipeline of generators to reduce\n      //    large allocations during diffing (which turns out to be the major\n      //    performance bottleneck of the previous implementation).\n      values = Array.from(\n        convertPtrsToValues(\n          cleanCopyElementNodes(reconstructTextNodes(strRep.decode(cmd.value)))\n        )\n      );\n    }\n    const config: RichTextChangeConfig = {\n      op: cmd.operation,\n      start: cmd.start,\n    };\n    if (values !== undefined) {\n      config.values = values;\n    }\n    if (cmd.end !== undefined) {\n      config.end = cmd.end;\n    }\n    yield new RichTextChange(config);\n  }\n}\n\nexport function diff(\n  rt1: RichText,\n  rt2: RichText,\n  local = true\n): RichTextChange[] {\n  if (coreValueEquals(rt1, rt2)) {\n    return [];\n  }\n  const strRep = new StringRep(kCoreValueTreeNodeOpts);\n  // const flatRt1 = Array.from(flattenRichText(rt1, local, true));\n  // const flatRt2 = Array.from(flattenRichText(rt2, local, true));\n  // const str1 = strRep.encode(flatRt1);\n  // const str2 = strRep.encode(flatRt2);\n  const str1 = strRep.encode(flattenRichText(rt1, local, true));\n  const str2 = strRep.encode(flattenRichText(rt2, local, true));\n  const textDiffs = kDMP.diff_main(str1, str2, true);\n  // if (textDiffs.length > 2) {\n  //   kDMP.diff_cleanupSemantic(textDiffs);\n  // }\n  return Array.from(decodeStringDiff(textDiffs, strRep));\n}\n\nexport function patch(\n  base: RichText,\n  changes: RichTextChange[],\n  local = true\n): RichText {\n  //const flat = Array.from(flattenRichText(base, local));\n\n  const mergeCtx = new MergeContext(\n    flattenRichText(base, local),\n    kCoreValueTreeNodeOpts\n  );\n  for (const c of changes) {\n    mergeCtx.apply(c);\n  }\n  // const mergedAtoms = Array.from(mergeCtx.finalize());\n  // const result = reconstructRichText(mergedAtoms);\n  const result = reconstructRichText(mergeCtx.finalize());\n  // normalizeRichText(result);\n  return result;\n}\n", "import { ElementNode, isElementNode } from '../tree.ts';\nimport { RuleSetup } from './types.ts';\n\nexport const userDefinedRules: RuleSetup[] = [\n  {\n    node: { tags: ['p', 'h1', 'h2', 'ol', 'ul', 'li'] },\n    condition: { source: 'parent', tags: ['table', 'tr'] },\n    action: {\n      name: 'to-sibling-below',\n    },\n  },\n  {\n    node: { tag: 'p' },\n    condition: { source: 'parent', tag: 'li' },\n    action: {\n      name: 'remove-child',\n    },\n  },\n  {\n    node: { tags: ['p', 'h1', 'h2', 'ol', 'ul'] },\n    condition: { source: 'parent', tag: 'p' },\n    action: {\n      name: 'to-sibling-below',\n    },\n  },\n  {\n    node: { tag: 'li' },\n    condition: {\n      source: 'parent',\n      tags: ['p', 'h1', 'h2', 'td'],\n      hasTag: false,\n    },\n    action: {\n      name: 'add-parent',\n      tag: 'ul',\n    },\n  },\n  {\n    node: { tag: 'li' },\n    condition: { source: 'parent', tag: 'li' },\n    action: {\n      name: 'to-sibling-below',\n    },\n  },\n  {\n    node: { tag: 'table' },\n    condition: { source: 'parent', tags: ['table', 'tr'] },\n    action: {\n      name: 'remove-child',\n    },\n  },\n  {\n    node: { tag: 'tr' },\n    condition: { source: 'parent', tags: ['p', 'h1', 'h2', 'ul', 'ol', 'li'] },\n    action: {\n      name: 'add-parent',\n      tag: 'table',\n    },\n  },\n  {\n    node: { tag: 'tr' },\n    condition: { source: 'parent', tags: ['tr', 'td'] },\n    action: {\n      name: 'to-sibling-below',\n    },\n  },\n  {\n    node: { tag: 'td' },\n    condition: {\n      source: 'parent',\n      tags: ['p', 'h1', 'h2', 'ul', 'ol', 'li', 'table'],\n    },\n    action: {\n      name: 'add-parent',\n      tag: 'tr',\n    },\n  },\n  {\n    node: { tag: 'td' },\n    condition: { source: 'parent', tag: 'td' },\n    action: {\n      name: 'to-sibling-below',\n    },\n  },\n  {\n    node: { isRefMarker: true, tag: 'inline-task' },\n    condition: { source: 'grandparent', isDefined: true },\n    action: {\n      name: 'to-sibling-below',\n    },\n  },\n  {\n    node: { isText: true },\n    condition: { source: 'parent', tags: ['table', 'tr'] },\n    action: {\n      name: 'add-parent',\n      tag: 'td',\n    },\n  },\n  {\n    node: { tags: ['object', 'img'] },\n    condition: { source: 'parent', tags: ['table', 'tr'] },\n    action: {\n      name: 'add-parent',\n      tag: 'td',\n    },\n  },\n  {\n    node: { isText: true, tags: ['object', 'img'] },\n    condition: { source: 'grandparent', isDefined: false },\n    action: {\n      name: 'add-parent',\n      tag: 'p',\n    },\n  },\n  {\n    node: { tags: ['object', 'img'] },\n    action: {\n      name: 'wrap-text',\n    },\n  },\n  {\n    node: { isElement: true },\n    action: {\n      name: 'no-empty-element',\n    },\n  },\n  {\n    node: { tags: ['ref', 'inline-task'] },\n    condition: {\n      source: 'node',\n      func: (n) => {\n        //first child of ref must be a text node\n        const firstChild = (n as ElementNode).children[0];\n        return firstChild && isElementNode(firstChild);\n      },\n    },\n    action: {\n      name: 'add-to-element',\n      func: () => {\n        return { text: '' };\n      },\n      index: 0,\n    },\n  },\n  {\n    node: { isElement: true },\n    action: {\n      name: 'element-consistent-children',\n    },\n  },\n  {\n    node: { isText: true },\n    action: {\n      name: 'empty-local-text',\n    },\n  },\n  {\n    node: { isText: true },\n    action: {\n      name: 'single-local-text',\n    },\n  },\n  {\n    node: { tag: 'p' },\n    condition: { source: 'parent', tags: ['ul', 'ol'] },\n    action: {\n      name: 'replace-tag',\n      newTag: 'li',\n    },\n  },\n  {\n    node: { isText: true },\n    condition: { source: 'parent', tags: ['ul', 'ol'] },\n    action: {\n      name: 'add-parent',\n      tag: 'li',\n    },\n  },\n];\n\nexport const inlineElementTags = ['mention'];\n", "import { isRefMarker } from '../model.ts';\nimport { ElementNode, isElementNode, isTextNode, TreeNode } from '../tree.ts';\nimport { userDefinedRules } from './setup.ts';\nimport { ConditionSource, RuleAction } from './types.ts';\nimport * as SetUtils from '../../../base/set.ts';\n\ninterface SingleRuleCondition {\n  source: ConditionSource;\n  tags?: Set<string>;\n  isDefined?: boolean;\n  hasTag?: boolean;\n  isElement?: boolean;\n  func?: (node: TreeNode | undefined) => boolean;\n}\n\nexport interface Rule {\n  condition?: SingleRuleCondition;\n  action: RuleAction;\n}\n\nconst rules: { [key: string]: Rule[] } = {};\nconst tagsCache: { [key: string]: string[] } = {};\n\nconst ELEMENT_KEY = 'elem';\nconst NOT_ELEMENT_KEY = 'n_elem';\nconst TEXT_KEY = 'txt';\nconst NOT_TEXT_KEY = 'n_txt';\nconst REF_MARKER_KEY = 'rm';\nconst NOT_REF_MARKER_KEY = 'n_rm';\n\nconst ELEMENT_KEYS = [ELEMENT_KEY, NOT_TEXT_KEY, NOT_REF_MARKER_KEY];\nconst TEXT_KEYS = [TEXT_KEY, NOT_ELEMENT_KEY, NOT_REF_MARKER_KEY];\nconst REF_MARKER_KEYS = [REF_MARKER_KEY, NOT_ELEMENT_KEY, NOT_TEXT_KEY];\nconst NON_KEYS = [NOT_TEXT_KEY, NOT_ELEMENT_KEY, NOT_REF_MARKER_KEY];\n\nfunction getKeysForNode(node: TreeNode) {\n  if (typeof node.tagName === 'string') {\n    if (tagsCache[node.tagName] !== undefined) return tagsCache[node.tagName];\n\n    let tags: string[] = [];\n    if (isElementNode(node)) {\n      tags.push(...ELEMENT_KEYS);\n    } else if (isTextNode(node)) {\n      tags.push(...TEXT_KEYS);\n    } else if (isRefMarker(node)) {\n      tags.push(...REF_MARKER_KEYS);\n    } else {\n      tags.push(...NON_KEYS);\n    }\n\n    tags.push('t_' + node.tagName);\n\n    tagsCache[node.tagName] = tags;\n    return tags;\n  }\n\n  if (isElementNode(node)) {\n    return ELEMENT_KEYS;\n  } else if (isTextNode(node)) {\n    return TEXT_KEYS;\n  } else if (isRefMarker(node)) {\n    return REF_MARKER_KEYS;\n  }\n\n  return NON_KEYS;\n}\n\nexport function* getRuleActions(\n  node: TreeNode,\n  parent: ElementNode,\n  grandParent?: ElementNode\n): Generator<RuleAction, void, void> {\n  for (const key of getKeysForNode(node)) {\n    if (rules[key] !== undefined) {\n      for (const rule of rules[key]) {\n        if (rule.condition === undefined) {\n          yield rule.action;\n          continue;\n        }\n\n        switch (rule.condition.source) {\n          case 'node':\n            if (checkCondition(rule.condition, node)) {\n              yield rule.action;\n            }\n            break;\n          case 'parent':\n            if (checkCondition(rule.condition, parent)) {\n              yield rule.action;\n            }\n            break;\n          case 'grandparent':\n            if (checkCondition(rule.condition, grandParent)) {\n              yield rule.action;\n            }\n            break;\n          case 'first-sibling':\n            if (node !== parent.children[0]) {\n              if (checkCondition(rule.condition, parent.children[0])) {\n                yield rule.action;\n              }\n            }\n            break;\n        }\n      }\n    }\n  }\n}\n\nfunction checkCondition(\n  condition: SingleRuleCondition,\n  node: TreeNode | undefined\n) {\n  const nodeTagName =\n    node !== undefined && typeof node.tagName === 'string'\n      ? node.tagName\n      : undefined;\n\n  if (condition.tags !== undefined && nodeTagName !== undefined) {\n    if (condition.tags.has(nodeTagName)) {\n      return true;\n    }\n  }\n\n  if (condition.isElement !== undefined && node !== undefined) {\n    const nodeIsElement = isElementNode(node);\n    if (condition.isElement && nodeIsElement) {\n      return true;\n    }\n    if (!condition.isElement && !nodeIsElement) {\n      return true;\n    }\n  }\n\n  if (condition.isDefined !== undefined) {\n    if (condition.isDefined && node !== undefined) {\n      return true;\n    }\n    if (!condition.isDefined && node === undefined) {\n      return true;\n    }\n  }\n  if (condition.hasTag !== undefined) {\n    if (condition.hasTag && nodeTagName !== undefined) {\n      return true;\n    }\n    if (!condition.hasTag && nodeTagName === undefined) {\n      return true;\n    }\n  }\n  if (condition.func !== undefined) {\n    if (condition.func(node)) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction convertNodeCondition(node: any): string[] | undefined {\n  const keys: string[] = [];\n  if (typeof node.tag === 'string') {\n    keys.push('t_' + node.tag);\n  }\n  if (node.tags !== undefined && Array.isArray(node.tags)) {\n    keys.push(...(node.tags as string[]).map((t) => 't_' + t));\n  }\n  if (typeof node.isElement === 'boolean') {\n    if (node.isElement) {\n      keys.push(ELEMENT_KEY);\n    } else {\n      keys.push(NOT_ELEMENT_KEY);\n    }\n  }\n\n  if (typeof node.isText === 'boolean') {\n    if (node.isText) {\n      keys.push(TEXT_KEY);\n    } else {\n      keys.push(NOT_TEXT_KEY);\n    }\n  }\n\n  if (typeof node.isRefMarker === 'boolean') {\n    if (node.isRefMarker) {\n      keys.push(REF_MARKER_KEY);\n    } else {\n      keys.push(NOT_REF_MARKER_KEY);\n    }\n  }\n  return keys;\n}\n\nfunction convertRuleCondition(condition: any): SingleRuleCondition | undefined {\n  if (condition === undefined) return;\n  const converted: SingleRuleCondition = {\n    source: condition.source,\n  };\n  if (typeof condition.tag === 'string') {\n    converted.tags = new Set<string>([condition.tag]);\n  }\n  if (condition.tags !== undefined && Array.isArray(condition.tags)) {\n    converted.tags = SetUtils.union(\n      converted.tags || new Set<string>(),\n      condition.tags\n    );\n  }\n  if (typeof condition.isDefined === 'boolean') {\n    converted.isDefined = condition.isDefined;\n  }\n  if (typeof condition.hasTag === 'boolean') {\n    converted.hasTag = condition.hasTag;\n  }\n  if (typeof condition.isElement === 'boolean') {\n    converted.isElement = condition.isElement;\n  }\n  if (typeof condition.func === 'function') {\n    converted.func = condition.func;\n  }\n  return converted;\n}\n\nfunction convertSetupRules() {\n  for (const uRule of userDefinedRules) {\n    const keys = convertNodeCondition(uRule.node);\n    if (keys === undefined) continue;\n\n    const condition = convertRuleCondition(uRule.condition);\n\n    for (const key of keys) {\n      if (rules[key] === undefined) {\n        rules[key] = [];\n      }\n      rules[key].push({\n        condition,\n        action: uRule.action,\n      });\n    }\n  }\n}\n\nconvertSetupRules();\n", "import { assert } from '../../../base/error.ts';\nimport { coreValueClone } from '../../../base/core-types/index.ts';\nimport { flattenRichText, reconstructRichText } from '../flat-rep.ts';\nimport {\n  dfs,\n  ElementNode,\n  initRichTextRoot,\n  isElementNode,\n  isNodeSameLocality,\n  isTextNode,\n  isTrivialTextNode,\n  Pointer,\n  pointersForNode,\n  RichText,\n  TextNode,\n  TreeNode,\n} from '../tree.ts';\nimport { getRuleActions } from './rules.ts';\nimport { inlineElementTags } from './setup.ts';\n\nexport function normalizeRichText(richText: RichText): RichText {\n  // normalizeNodeText(richText, richText.root);\n  richText = coreValueClone(richText);\n  stripTrivialTextNodes(richText);\n  richText = reconstructRichText(\n    // stripTrivialTextNodes(\n    flattenRichText(richText, true, false)\n    // richText.pointers\n    // )\n  );\n  while (runNodeRules(richText.root) > 0) {}\n\n  if (richText.root.children.length === 0) {\n    richText.root = initRichTextRoot();\n  }\n\n  if (richText.pointers && richText.pointers.size === 0) {\n    delete richText.pointers;\n  }\n  return richText;\n}\n\nfunction hasPointers(\n  node: TextNode,\n  ptrSet: Set<Pointer> | undefined\n): boolean {\n  if (!ptrSet) {\n    return false;\n  }\n  for (const _ of pointersForNode(ptrSet, node, true)) {\n    return true;\n  }\n  return false;\n}\n\nfunction stripTrivialTextNodes(rt: RichText): void {\n  for (const [node, _depth, path] of dfs(rt.root, true)) {\n    if (\n      isTrivialTextNode(node) &&\n      node.text.length === 0 &&\n      !hasPointers(node, rt.pointers)\n    ) {\n      const parent = path[path.length - 1];\n      if (parent.children.length > 1) {\n        const idx = parent.children.indexOf(node);\n        assert(idx >= 0);\n        parent.children.splice(idx, 1);\n      }\n    }\n  }\n}\n\n// const kTextNodesEqOpts = {\n//   objectFilterFields: treeAtomKeyFilter,\n// };\n\n// function normalizeNodeText(richText: RichText, node: ElementNode) {\n//   let i = 0;\n//   let toNextChild = true;\n//   while (i < node.children.length) {\n//     //for (let i = 0; i < node.children.length; i++) {\n//     let curChild = node.children[i];\n//     toNextChild = true;\n\n//     if (isElementNode(curChild)) {\n//       normalizeNodeText(richText, curChild);\n//     } else {\n//       if (isTextNode(curChild)) {\n//         while (i + 1 < node.children.length) {\n//           const nextChild = node.children[i + 1]!;\n\n//           const delRes = canDeleteTextNode(curChild, nextChild);\n//           if (delRes === 0) {\n//             break;\n//           }\n\n//           let delIndex: number;\n//           let prevLength: number;\n//           let nodeToKeep: TextNode;\n//           let nodeToDelete: TextNode;\n\n//           if (delRes === -1) {\n//             //Merge Left to right\n//             delIndex = i;\n//             prevLength = 0;\n//             nodeToDelete = curChild;\n//             nodeToKeep = nextChild as TextNode;\n\n//             nextChild.text = curChild.text + nextChild.text;\n//           } else {\n//             //Merge right to left\n//             delIndex = i + 1;\n//             prevLength = curChild.text.length;\n//             nodeToDelete = nextChild as TextNode;\n//             nodeToKeep = curChild;\n\n//             curChild.text += nextChild.text;\n//           }\n\n//           if (richText.pointers) {\n//             for (const pointer of pointersForNode(\n//               richText.pointers,\n//               nodeToDelete,\n//               true\n//             )) {\n//               pointer.node = nodeToKeep;\n//               pointer.offset += prevLength;\n//             }\n//           }\n\n//           node.children.splice(delIndex, 1);\n\n//           if (delRes === -1) {\n//             toNextChild = false;\n//             break;\n//           }\n//         }\n//       }\n//     }\n\n//     if (toNextChild) i++;\n//   }\n// }\n\n// function canDeleteTextNode(left: TextNode, right: TreeNode): -1 | 0 | 1 {\n//   if (!isNodeSameLocality(left, right)) {\n//     return 0; //Can't delete because one is local and one is not\n//   }\n\n//   if (!isTextNode(right)) {\n//     return 0;\n//   }\n\n//   const leftEmpty = left.text === '' && isTrivialTextNode(left);\n//   const rightEmpty = right.text === '' && isTrivialTextNode(right);\n\n//   if (leftEmpty && !rightEmpty) {\n//     return -1;\n//   }\n//   if (rightEmpty && !leftEmpty) {\n//     return 1;\n//   }\n\n//   if (coreValueEquals(left, right, equalsOptions)) {\n//     return 1;\n//   }\n\n//   return 0;\n// }\n\nenum ActionResult {\n  CONTINUE,\n  RETURN_TO_PARENT,\n  SAME_CHILD,\n}\n\nfunction runNodeRules(\n  parent: ElementNode,\n  grandParent?: ElementNode,\n  gpIndex?: number\n): number {\n  let i = parent.children.length - 1;\n  let counter = 0;\n  let result: ActionResult;\n\n  while (i >= 0 && i < parent.children.length) {\n    const child = parent.children[i];\n    result = ActionResult.CONTINUE;\n\n    for (const action of getRuleActions(child, parent, grandParent)) {\n      switch (action.name) {\n        case 'add-parent': {\n          //Add parent between current parent and child\n          //return to parent\n          const newParent: ElementNode = {\n            children: [child],\n            tagName: action.tag,\n          };\n          if (child.isLocal !== undefined) newParent.isLocal = child.isLocal;\n          parent.children[i] = newParent;\n\n          counter++;\n          result = ActionResult.RETURN_TO_PARENT;\n          break;\n        }\n\n        case 'to-sibling-below': {\n          //moves child to be a sibling below\n          //return to parent\n          if (grandParent !== undefined && gpIndex !== undefined) {\n            let toI = gpIndex + 1;\n            //Remove from Parent\n            parent.children.splice(i, 1);\n\n            //Add to Grandparent\n            grandParent.children.splice(toI, 0, child);\n\n            //Will go over children in next run\n            counter++;\n            result = ActionResult.SAME_CHILD;\n          }\n          break;\n        }\n\n        case 'remove-child': {\n          //remove child from parent\n          //run child again\n          if (isElementNode(child)) {\n            parent.children.splice(i, 1, ...child.children);\n          } else {\n            parent.children.splice(i, 1);\n          }\n\n          counter++;\n          result = ActionResult.SAME_CHILD;\n          break;\n        }\n        case 'replace-tag': {\n          child.tagName = action.newTag;\n          break;\n        }\n        case 'wrap-text': {\n          //wrap text around non text nodes\n          //return to parent\n          if (i === 0 || !isTextNode(parent.children[i - 1])) {\n            //No Text From Above\n            const tIndex = i > 0 ? i - 1 : 0;\n            parent.children.splice(tIndex, 0, { text: '' });\n            i++;\n            counter++;\n            result = ActionResult.RETURN_TO_PARENT;\n          }\n\n          if (\n            i === parent.children.length - 1 ||\n            !isTextNode(parent.children[i + 1])\n          ) {\n            //No Text From Bottom\n            parent.children.splice(i + 1, 0, { text: '' });\n            counter++;\n            result = ActionResult.RETURN_TO_PARENT;\n          }\n\n          break;\n        }\n        case 'no-empty-element': {\n          //delete empty elements\n          //return to parent\n          if (isElementNode(child) && child.children.length === 0) {\n            parent.children.splice(i, 1);\n\n            //counter++;\n            result = ActionResult.SAME_CHILD;\n          }\n          break;\n        }\n        case 'add-to-element': {\n          //add element to parent\n          //continue\n          if (isElementNode(child)) {\n            const newNode = action.func();\n            delete newNode.isLocal;\n            if (child.isLocal !== undefined) newNode.isLocal = child.isLocal;\n\n            if (action.index !== undefined) {\n              child.children.splice(action.index, 0, newNode);\n            } else {\n              child.children.push(newNode);\n            }\n\n            counter++;\n          }\n          break;\n        }\n        case 'element-consistent-children': {\n          //fix inconsistent issues\n          //return to parent\n          if (isElementNode(child) && child.children.length >= 2) {\n            const fTextOrInline = isTextOrInline(child.children[0]);\n            let j = 1;\n            for (; j < child.children.length; j++) {\n              if (fTextOrInline !== isTextOrInline(child.children[j])) {\n                break;\n              }\n            }\n            if (j < child.children.length) {\n              //group them in a P\n              const newP: ElementNode = {\n                tagName: 'p',\n                children: child.children.slice(j),\n              };\n\n              //move the P to parent\n              parent.children.splice(i + 1, 0, newP);\n\n              //Remove from Child\n              child.children.splice(j, child.children.length);\n\n              //Will go over children in next run\n              counter++;\n              result = ActionResult.RETURN_TO_PARENT;\n            }\n          }\n          break;\n        }\n        case 'empty-local-text': {\n          if (\n            (i === 0 || i + 1 === parent.children.length) && //First or Last Child\n            isTextNode(child) &&\n            child.text === '' &&\n            child.isLocal === undefined\n          ) {\n            const brother =\n              i === 0 ? parent.children[1] : parent.children[i - 1];\n\n            if (i + 1 === parent.children.length) {\n              const firstChild = parent.children[0];\n              if (isTextNode(firstChild) && firstChild.text === '') {\n                //If both first and last are empty, only update the first to isLocal\n                continue;\n              }\n            }\n            if (brother) {\n              if (brother.isLocal === undefined) {\n                delete child.isLocal;\n              } else if (brother.isLocal !== child.isLocal) {\n                child.isLocal = brother.isLocal;\n              }\n            }\n          }\n\n          break;\n        }\n        case 'single-local-text': {\n          if (\n            parent.children.length === 1 && //Only Child\n            isTextNode(child) &&\n            child.text === '' &&\n            !isNodeSameLocality(parent, child)\n          ) {\n            if (parent.isLocal === undefined) {\n              delete child.isLocal;\n            } else {\n              child.isLocal = parent.isLocal;\n            }\n          }\n\n          break;\n        }\n        default: {\n          throw new Error(\n            `Rule action: ${(action as any).name} is not defined!`\n          );\n        }\n      }\n      if (result !== ActionResult.CONTINUE) {\n        break;\n      }\n    }\n\n    if (result === ActionResult.RETURN_TO_PARENT) {\n      break;\n    }\n\n    if (result === ActionResult.SAME_CHILD) {\n      continue;\n    }\n\n    if (isElementNode(child)) {\n      counter += runNodeRules(child, parent, i);\n    }\n\n    i--;\n  }\n\n  return counter;\n}\n\nfunction isTextOrInline(node: TreeNode) {\n  if (isElementNode(node)) {\n    return (\n      typeof node.tagName === 'string' &&\n      inlineElementTags.includes(node.tagName)\n    );\n  }\n  return true;\n}\n", "import { isRefMarker } from '../../richtext/model.ts';\nimport {\n  SerializeValueTypeOptions,\n  ValueType,\n  ValueTypeOptions,\n} from './index.ts';\nimport { Change, EncodedChange } from '../../change/index.ts';\nimport { RichTextChange } from '../../change/richtext-change.ts';\nimport {\n  CoreOptions,\n  CoreType,\n  coreValueClone,\n  coreValueEquals,\n  Encoder,\n} from '../../../base/core-types/index.ts';\nimport { DecodedValue } from '../../../base/core-types/encoding/index.ts';\nimport { diff, patch } from '../../richtext/diff-patch.ts';\nimport { flattenRichText } from '../../richtext/flat-rep.ts';\nimport { normalizeRichText } from '../../richtext/normalize/index.ts';\nimport {\n  initRichText,\n  isRichText,\n  RichText,\n  onlyNoneLocal,\n  purgeExpiredPointers,\n  isExpiredPointer,\n  treeAtomKeyFilterIgnoreText,\n  dfs,\n} from '../../richtext/tree.ts';\nimport { CoreTypeOperations } from './core-type.ts';\n\nconst kCoreValueOpts: CoreOptions = {\n  objectFilterFields: treeAtomKeyFilterIgnoreText,\n};\n\nconst expiredPointersBuffer = 1000 * 60 * 10; //10 minutes\n\nexport class RichText3TypeOperations extends CoreTypeOperations<RichText> {\n  constructor() {\n    super(CoreType.Object, ValueType.RICHTEXT_V3);\n  }\n  patch(\n    curValue: RichText | undefined,\n    changes: Change<EncodedChange>[],\n    _options?: ValueTypeOptions\n  ) {\n    if (curValue === undefined) {\n      curValue = initRichText();\n    }\n\n    const newValue = patch(curValue, changes as RichTextChange[], true);\n\n    return newValue;\n  }\n\n  normalize(val: RichText) {\n    return normalizeRichText(val);\n  }\n\n  getRefOperation() {\n    return undefined;\n  }\n\n  validate(value: any): boolean {\n    return isRichText(value);\n  }\n\n  serialize(\n    key: string,\n    value: RichText,\n    encoder: Encoder,\n    options?: SerializeValueTypeOptions\n  ): void {\n    const local = options?.local === true; //default false\n\n    if (options?.flatRep === true) {\n      // For checksum purposes we need to use the flat rep or we won't account\n      // for depth changes. Computing the checksum on a DFS run of the tree\n      // completely strips out the depth info.\n\n      //const flat = Array.from(flattenRichText(value, local));\n      const flat = flattenRichText(value, local, false);\n\n      encoder.set(key, flat, kCoreValueOpts);\n    } else {\n      const func = local ? undefined : onlyNoneLocal;\n      encoder.set(key, value, {\n        iterableFilter: func,\n      });\n    }\n  }\n\n  deserialize(value: DecodedValue, options?: ValueTypeOptions) {\n    return value as RichText;\n  }\n\n  valueAddedDiff(value2: RichText, options?: ValueTypeOptions) {\n    const local = options?.local === true; //Default is false\n\n    const empty = initRichText();\n\n    return diff(empty, value2, local);\n  }\n\n  valueRemovedDiff(\n    value1: RichText,\n    options?: ValueTypeOptions\n  ): Change<EncodedChange> | Change<EncodedChange>[] | undefined {\n    const local = options?.local === true; //Default is false\n\n    const empty = initRichText();\n\n    return diff(value1, empty, local);\n  }\n\n  valueChangedDiff(\n    value1: RichText,\n    value2: RichText,\n    options?: ValueTypeOptions\n  ) {\n    const local = options?.local === true; //Default is false\n    return diff(value1, value2, local);\n  }\n\n  isEmpty(_value: RichText): boolean {\n    return false;\n  }\n\n  equals(val1: RichText, val2: RichText, options?: ValueTypeOptions): boolean {\n    const local = options?.local === true; //Default is false\n\n    const func = local ? undefined : onlyNoneLocal;\n    return coreValueEquals(val1, val2, {\n      iterableFilter: func,\n    });\n  }\n\n  clone(value: RichText) {\n    return coreValueClone(value);\n  }\n\n  needGC(value: RichText): boolean {\n    if (value.pointers) {\n      for (const pointer of value.pointers) {\n        if (isExpiredPointer(pointer, expiredPointersBuffer)) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  gc(value: RichText): RichText | undefined {\n    return purgeExpiredPointers(value, expiredPointersBuffer);\n  }\n\n  fillRefs(refs: Set<string>, value: RichText): void {\n    for (const [node] of dfs(value.root)) {\n      if (isRefMarker(node)) {\n        refs.add(node.ref);\n      }\n    }\n  }\n\n  rewriteRefs(\n    keyMapping: Map<string, string>,\n    value: RichText,\n    deleteRefs?: Set<string>\n  ): RichText {\n    for (const [node, _depth, path] of dfs(value.root, true)) {\n      if (isRefMarker(node)) {\n        if (deleteRefs?.has(node.ref)) {\n          const children = path[path.length - 1].children!;\n          children.splice(children.indexOf(node), 1);\n        } else {\n          node.ref = keyMapping.get(node.ref) || node.ref;\n        }\n      }\n    }\n    return value;\n  }\n}\n", "import { deserializeDate } from '../../../base/date.ts';\nimport { ValueType, ValueTypeOptions } from './index.ts';\nimport { CoreType } from '../../../base/core-types/index.ts';\nimport { DecodedValue } from '../../../base/core-types/encoding/index.ts';\nimport { PrimitiveTypeOperations } from './primitive-type.ts';\n\nexport class DateTypeOperations extends PrimitiveTypeOperations<Date> {\n  constructor() {\n    super(CoreType.Date, ValueType.DATE);\n  }\n\n  deserialize(value: DecodedValue, options?: ValueTypeOptions) {\n    const date = super.deserialize(value, options);\n    if (typeof date === 'number') {\n      return deserializeDate(date);\n    }\n    return date;\n  }\n}\n", "import { DecodedValue } from '../../../base/core-types/encoding/index.ts';\nimport { Change, EncodedChange } from '../../change/index.ts';\nimport { MapTypeOperations } from './map-type.ts';\nimport { PrimitiveTypeOperations } from './primitive-type.ts';\nimport { SetTypeOperations } from './set-type.ts';\nimport { StringTypeOperations } from './string-type.ts';\n// import { RichText2TypeOperations } from './richtext2-type';\nimport { RichText3TypeOperations } from './richtext3-type.ts';\nimport {\n  CoreOptions,\n  CoreType,\n  CoreValue,\n  Encoder,\n  getCoreType,\n} from '../../../base/core-types/index.ts';\nimport { DateTypeOperations } from './date-type.ts';\nimport { ChecksumEncoderOpts } from '../../../base/core-types/encoding/checksum.ts';\n\nexport enum ValueType {\n  STRING = 'string',\n  NUMBER = 'number',\n  BOOLEAN = 'boolean',\n  DATE = 'date',\n  // RICHTEXT_V2 = 'richtext',\n  STR_SET = 'stringset',\n  SET = 'set',\n  REF = 'ref',\n  REF_SET = 'refset',\n  MAP = 'map',\n  REF_MAP = 'refmap',\n  RICHTEXT_V3 = 'richtext-3',\n}\n\nexport function isRefValueType(type: ValueType): boolean {\n  return (\n    type === ValueType.REF ||\n    type === ValueType.REF_SET ||\n    type === ValueType.RICHTEXT_V3\n  );\n}\n\nexport interface ValueTypeOptions {\n  local?: boolean;\n}\n\nexport interface SerializeValueTypeOptions extends ChecksumEncoderOpts {\n  local?: boolean;\n  flatRep?: boolean;\n}\n\nexport interface IValueTypeOperations<T = any> {\n  get valueType(): ValueType;\n\n  clone(value: T): T;\n\n  equals(val1: T, val2: T, options?: ValueTypeOptions): boolean;\n\n  validate(value: any): boolean;\n\n  serialize(\n    key: string,\n    value: T,\n    encoder: Encoder,\n    options?: SerializeValueTypeOptions\n  ): void;\n\n  deserialize(value: DecodedValue, options?: ValueTypeOptions): T;\n\n  /**\n   * value for data1 is undefined, value2 should be added by diff\n   * @param value2\n   * @param type\n   * @param options\n   */\n  valueAddedDiff(\n    value2: T,\n    options?: ValueTypeOptions\n  ): undefined | Change<EncodedChange> | Change<EncodedChange>[];\n\n  /**\n   * value for data2 is undefined, value1 should be deleted by diff\n   * @param value1\n   * @param type\n   * @param options\n   */\n  valueRemovedDiff(\n    value1: T,\n    options?: ValueTypeOptions\n  ): undefined | Change<EncodedChange> | Change<EncodedChange>[];\n\n  valueChangedDiff(\n    value1: T,\n    value2: T,\n    options?: ValueTypeOptions\n  ): undefined | Change<EncodedChange> | Change<EncodedChange>[];\n\n  patch(\n    curValue: T | undefined,\n    changes: Change<EncodedChange>[],\n    options?: ValueTypeOptions\n  ): T | undefined;\n\n  fillRefs(refs: Set<string>, value: T): void;\n\n  normalize(value: T): T;\n\n  isEmpty(value: T): boolean;\n\n  needGC(value: T): boolean;\n  gc(value: T): T | undefined;\n\n  rewriteRefs(\n    keyMapping: Map<string, string>,\n    value: T,\n    deleteRefs?: Set<string>\n  ): T | undefined;\n}\n\nconst typeOperations: { [key: string]: IValueTypeOperations } = {};\n\nexport function getTypeOperations<T = any>(\n  type: ValueType\n): IValueTypeOperations<T> {\n  const op = typeOperations[type];\n  if (op === undefined) {\n    throw new Error(`type operations for: ${type} has not been implemented`);\n  }\n  return op;\n}\n\nexport function getTypeOperationsByValue(\n  value: CoreValue\n): IValueTypeOperations {\n  for (const typeOP of Object.values(typeOperations)) {\n    if (typeOP.validate(value)) {\n      return typeOP;\n    }\n  }\n\n  throw new Error(`getTypeOperationsByValue failed for: ${value}`);\n}\n\nregisterTypeOperations();\n\nfunction registerTypeOperations() {\n  if (Object.entries(typeOperations).length === 0) {\n    const register = (op: IValueTypeOperations) => {\n      typeOperations[op.valueType] = op;\n    };\n\n    register(new StringTypeOperations(false));\n    register(new StringTypeOperations(true));\n    register(new PrimitiveTypeOperations(CoreType.Number, ValueType.NUMBER));\n    register(new PrimitiveTypeOperations(CoreType.Boolean, ValueType.BOOLEAN));\n    register(new DateTypeOperations());\n    register(new SetTypeOperations(false, ValueType.SET));\n    register(new SetTypeOperations(false, ValueType.STR_SET));\n    register(new SetTypeOperations(true, ValueType.REF_SET));\n    register(new MapTypeOperations(false, ValueType.MAP));\n    register(new MapTypeOperations(true, ValueType.REF_MAP));\n    // register(new RichText2TypeOperations());\n    register(new RichText3TypeOperations());\n\n    //Add Types Here\n  }\n}\n\nexport function valueTypeEquals<TValue>(\n  type: ValueType,\n  value1: TValue | undefined,\n  value2: TValue | undefined,\n  options?: ValueTypeOptions\n) {\n  if (value1 === undefined && value2 !== undefined) {\n    return false;\n  }\n  if (value1 !== undefined && value2 === undefined) {\n    return false;\n  }\n  if (value1 === undefined && value2 === undefined) {\n    return true;\n  }\n  const typeOP = getTypeOperations(type);\n  return typeOP.equals(value1, value2, options);\n}\n", "import { Change, ChangeType, EncodedChange } from './index.ts';\nimport { Decoder } from '../../base/core-types/encoding/index.ts';\nimport { FieldChange } from './field-change.ts';\nimport { RichTextChange } from './richtext-change.ts';\nimport { notReached } from '../../base/error.ts';\n\nexport function decodeChange<EC extends EncodedChange = EncodedChange>(\n  decoder: Decoder<keyof EC & string>\n): Change<EC> {\n  const type = decoder.get('changeType') as ChangeType;\n  switch (type) {\n    case 'fd':\n      return new FieldChange({ decoder });\n    case 'rt':\n      return new RichTextChange({ decoder });\n    default:\n      notReached('Unsupported format: ' + type);\n  }\n}\n", "import { assert } from '../../base/error.ts';\nimport {\n  DecodedValue,\n  Decoder,\n  ReadonlyDecodedArray,\n  ReadonlyDecodedObject,\n} from '../../base/core-types/encoding/index.ts';\nimport { Scheme } from './scheme.ts';\nimport { DataType, SchemeFields } from './scheme-types.ts';\nimport {\n  getTypeOperations,\n  SerializeValueTypeOptions,\n  ValueType,\n  valueTypeEquals,\n  ValueTypeOptions,\n} from './types/index.ts';\nimport { Change, EncodedChange } from '../change/index.ts';\nimport { decodeChange } from '../change/decode.ts';\nimport { CoreObject, Encoder } from '../../base/core-types/index.ts';\nimport { log } from '../../logging/log.ts';\n\nexport function isValidData(scheme: Scheme, data: DataType) {\n  const requiredFields = scheme.getRequiredFields();\n  if (requiredFields !== undefined) {\n    for (const k of requiredFields) {\n      if (!data.hasOwnProperty(k) && !scheme.hasInitForField(k)) {\n        return [false, `Missing required field \"${k}\"`];\n      }\n    }\n  }\n  return validateFieldTypes(scheme.getFields(), data);\n}\n\nexport function validateFieldTypes(\n  fieldsScheme: SchemeFields,\n  data: DataType\n): [boolean, string] {\n  for (const [key, value] of Object.entries(data)) {\n    const type = fieldsScheme[key];\n    if (!type) {\n      return [false, `Unknown field ${key}`];\n    }\n\n    const typeOP = getTypeOperations(type);\n    if (!typeOP.validate(value)) {\n      return [false, `Invalid value for field \"${key}\". Expected ${type}`];\n    }\n  }\n\n  return [true, ''];\n}\n\nexport function serialize(\n  encoder: Encoder,\n  fieldsScheme: SchemeFields,\n  data: DataType,\n  options: SerializeValueTypeOptions = {},\n  overrides: {\n    [key: string]: (\n      encoder: Encoder,\n      key: string,\n      value: any,\n      options: SerializeValueTypeOptions\n    ) => void;\n  } = {}\n) {\n  if (!data) {\n    return;\n  }\n  for (const [key, value] of Object.entries(data)) {\n    const type = fieldsScheme[key];\n    assert(type !== undefined, `Unknown field ${key}`);\n\n    if (overrides[type]) {\n      try {\n        overrides[type](encoder, key, value, options);\n        continue;\n      } catch (e) {\n        log({\n          severity: 'INFO',\n          error: 'SerializeError',\n          trace: e.stack,\n          message: e.message,\n          key: key,\n          valueType: type,\n        });\n      }\n    }\n\n    if (data[key] === undefined) {\n      continue;\n    }\n\n    const typeOP = getTypeOperations(type);\n    typeOP.serialize(key, value, encoder, options);\n  }\n}\n\nexport function deserialize(\n  decoder: Decoder,\n  fieldsScheme: SchemeFields,\n  options: ValueTypeOptions = {},\n  overrides: {\n    [key: string]: (value: DecodedValue, options: ValueTypeOptions) => any;\n  } = {}\n): DataType {\n  const data: DataType = {};\n\n  for (const [key, type] of Object.entries(fieldsScheme)) {\n    assert(type !== undefined, `Unknown field ${key}`);\n\n    const decValue = decoder.get(key);\n    if (decValue === undefined) continue;\n\n    if (overrides[type]) {\n      try {\n        const value = overrides[type](decValue, options);\n        if (value !== undefined) {\n          data[key] = value;\n        }\n        continue;\n      } catch (e) {\n        log({\n          severity: 'INFO',\n          error: 'SerializeError',\n          trace: e.stack,\n          message: e.message,\n          key,\n          valueType: type,\n        });\n      }\n    }\n\n    const typeOP = getTypeOperations(type);\n    const value = typeOP.deserialize(decValue, options);\n    if (value !== undefined) {\n      data[key] = value;\n    }\n  }\n\n  return data;\n}\n\nexport function equals(\n  fields: SchemeFields,\n  data1: DataType,\n  data2: DataType,\n  options: ValueTypeOptions = {}\n) {\n  if (!data1 && !data2) {\n    return true;\n  }\n  if (!data1 && data2) {\n    return false;\n  }\n  if (data1 && !data2) {\n    return false;\n  }\n\n  for (const [key, type] of Object.entries(fields)) {\n    if (!valueTypeEquals(type, data1[key], data2[key], options)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nexport function clone(\n  fieldsScheme: SchemeFields,\n  data: DataType,\n  onlyFields?: string[]\n): DataType {\n  const result: DataType = {};\n  for (const key of Object.keys(data)) {\n    const type = fieldsScheme[key];\n    if (!type) {\n      continue;\n    }\n\n    if (onlyFields && !onlyFields.includes(key)) {\n      continue;\n    }\n\n    const value = data[key];\n    if (value === undefined) {\n      result[key] = value;\n      continue;\n    }\n\n    const typeOP = getTypeOperations(type);\n    result[key] = typeOP.clone(value);\n  }\n  return result;\n}\n\nexport function diff(\n  schemeFields: SchemeFields,\n  data1: DataType,\n  data2: DataType,\n  options: ValueTypeOptions = {}\n): DataChanges {\n  const changes: DataChanges = {};\n\n  const addChanges = (\n    field: string,\n    fChanges: undefined | Change<EncodedChange> | Change<EncodedChange>[]\n  ) => {\n    if (fChanges === undefined) return;\n\n    if (Array.isArray(fChanges)) {\n      if (fChanges.length === 0) return;\n    } else {\n      fChanges = [fChanges];\n    }\n    for (const change of fChanges) {\n      if (changes[field] === undefined) changes[field] = [];\n      changes[field].push(change);\n    }\n  };\n\n  for (const [key, type] of Object.entries(schemeFields)) {\n    const value1 = data1[key];\n    const value2 = data2[key];\n\n    if (value1 === undefined && value2 === undefined) continue;\n\n    const typeOP = getTypeOperations(type);\n\n    let fChanges: undefined | Change<EncodedChange> | Change<EncodedChange>[];\n    if (value1 === undefined && value2 !== undefined) {\n      //New Value\n      fChanges = typeOP.valueAddedDiff(value2, options);\n    } else if (value1 !== undefined && value2 === undefined) {\n      //Value Removed\n      fChanges = typeOP.valueRemovedDiff(value1, options);\n    } else {\n      //Value Changed\n      fChanges = typeOP.valueChangedDiff(value1, value2, options);\n    }\n\n    addChanges(key, fChanges);\n  }\n\n  return changes;\n}\n\nexport function patch(\n  fieldsScheme: SchemeFields,\n  data: DataType,\n  changes: DataChanges,\n  options: ValueTypeOptions = {}\n) {\n  for (const [field, fChanges] of Object.entries(changes)) {\n    const type = fieldsScheme[field];\n\n    const typeOP = getTypeOperations(type);\n    const newValue = typeOP.patch(data[field], fChanges, options);\n\n    if (newValue === undefined) {\n      delete data[field];\n    } else {\n      data[field] = newValue;\n    }\n  }\n\n  return data;\n}\n\nexport function getRefs(\n  schemeFields: SchemeFields,\n  data: DataType\n): Set<string> {\n  const refs = new Set<string>();\n  for (const [key, type] of Object.entries(schemeFields)) {\n    getTypeOperations(type).fillRefs(refs, data[key]);\n  }\n\n  return refs;\n}\n\nexport function getRefsFromValue(type: ValueType, value: any): Set<string> {\n  const result = new Set<string>();\n  if (value === undefined) {\n    return result;\n  }\n  getTypeOperations(type).fillRefs(result, value);\n  return result;\n}\n\nexport function normalize(scheme: Scheme, data: DataType) {\n  for (const [key, type] of Object.entries(scheme.fields)) {\n    let value = data[key];\n\n    const typeOP = getTypeOperations(type as ValueType);\n\n    if (value === undefined || typeOP.isEmpty(value)) {\n      if (scheme.hasInitForField(key)) {\n        value = scheme.initValueForField(key, data);\n        data[key] = value;\n      }\n    }\n\n    if (value !== undefined) {\n      data[key] = typeOP.normalize(value);\n    }\n  }\n}\n\nexport function needGC(scheme: Scheme, data: DataType): boolean {\n  for (const [key, type] of Object.entries(scheme.fields)) {\n    let value = data[key];\n    if (value === undefined) continue;\n\n    const typeOP = getTypeOperations(type as ValueType);\n\n    if (typeOP.needGC(value)) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function gc(scheme: Scheme, data: DataType): boolean {\n  let result = false;\n  for (const [key, type] of Object.entries(scheme.fields)) {\n    let value = data[key];\n    if (value === undefined) continue;\n\n    const typeOP = getTypeOperations(type as ValueType);\n    const newValue = typeOP.gc(value);\n    if (newValue !== undefined) {\n      data[key] = newValue;\n      result = true;\n    }\n  }\n  return result;\n}\n\nexport function diffKeys(\n  schemeFields: SchemeFields,\n  data1: DataType,\n  data2: DataType,\n  options: ValueTypeOptions = {}\n) {\n  const result = new Set<string>();\n\n  for (const key of Object.keys(data1)) {\n    if (schemeFields[key] && !data2.hasOwnProperty(key)) {\n      //Key not found in data2\n      result.add(key);\n    }\n  }\n\n  for (const key of Object.keys(data2)) {\n    const type = schemeFields[key];\n    if (!type) {\n      continue;\n    }\n    if (!data1.hasOwnProperty(key)) {\n      //Key not found in data1\n      result.add(key);\n      continue;\n    }\n\n    const typeOP = getTypeOperations(type);\n    if (!typeOP.equals(data1[key], data2[key], options)) {\n      //Key found in both, but is not equal\n      result.add(key);\n    }\n  }\n  return Array.from(result);\n}\n\nexport interface DataChanges extends CoreObject {\n  [key: string]: Change<EncodedChange>[];\n}\n\nexport interface DecodedDataChange extends ReadonlyDecodedObject {\n  [key: string]: Decoder[];\n}\n\nexport function decodedDataChanges(dec: DecodedDataChange) {\n  const changes: DataChanges = {};\n\n  for (const key in dec) {\n    changes[key] = (dec[key] as ReadonlyDecodedArray).map((v) =>\n      decodeChange(v as Decoder)\n    );\n  }\n\n  return changes;\n}\n\nexport function concatChanges(changes1: DataChanges, changes2: DataChanges) {\n  const changes: DataChanges = {};\n\n  const addChanges = (fromChanges: DataChanges) => {\n    for (const key in fromChanges) {\n      if (changes[key] === undefined) {\n        changes[key] = [];\n      }\n      changes[key].push(...fromChanges[key]);\n    }\n  };\n\n  addChanges(changes1);\n  addChanges(changes2);\n\n  return changes;\n}\n\nexport function anyChanges(changes: DataChanges) {\n  for (const key in changes) {\n    if (changes[key] !== undefined && changes[key].length > 0) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function rewriteRefs(\n  scheme: Scheme,\n  data: DataType,\n  keyMapping: Map<string, string>,\n  deleteRefs?: Set<string>\n): DataType {\n  for (const [key, value] of Object.entries(data)) {\n    if (value === undefined || !scheme.hasField(key)) {\n      continue;\n    }\n    const type = scheme.getFieldType(key);\n    const newValue = getTypeOperations(type).rewriteRefs(\n      keyMapping,\n      data[key],\n      deleteRefs\n    );\n    if (newValue === undefined) {\n      delete data[key];\n    } else {\n      data[key] = newValue;\n    }\n  }\n  return data;\n}\n", "import { ConcreteCoreValue, CoreObject } from '../../base/core-types/index.ts';\n// import { COWMap } from '../collections/cow-map';\n\n// import { RichText as OldRichText } from '../primitives-old/richtext2';\nimport { RichText } from '../richtext/tree.ts';\nimport { Record as RecordObj } from './record.ts';\nimport { ValueType } from './types/index.ts';\nimport { Dictionary } from '../../base/collections/dict.ts';\n\nexport enum SchemeNamespace {\n  WORKSPACE = 'workspaces',\n  NOTES = 'notes',\n  TAGS = 'tags',\n  USERS = 'users',\n  USER_SETTINGS = 'user-settings',\n  ORGANIZATION = 'organization',\n  FILTER = 'filter',\n  Null = '',\n}\n\nconst namespaces: SchemeNamespace[] = [];\nfor (const key in SchemeNamespace) {\n  namespaces.push(SchemeNamespace[key as keyof typeof SchemeNamespace]);\n}\n\nexport function getAllSchemeNS() {\n  return namespaces;\n}\n\nexport const NS_WORKSPACE = SchemeNamespace.WORKSPACE;\nexport const NS_NOTES = SchemeNamespace.NOTES;\nexport const NS_TAGS = SchemeNamespace.TAGS;\nexport const NS_USERS = SchemeNamespace.USERS;\nexport const NS_USER_SETTINGS = SchemeNamespace.USER_SETTINGS;\nexport const NS_ORGANIZATION = SchemeNamespace.ORGANIZATION;\nexport const NS_FILTER = SchemeNamespace.FILTER;\n\nexport const TYPE_STR = ValueType.STRING;\nexport const TYPE_NUMBER = ValueType.NUMBER;\nexport const TYPE_DATE = ValueType.DATE;\n// export const TYPE_RICHTEXT = ValueType.RICHTEXT_V2;\nexport const TYPE_RICHTEXT_V3 = ValueType.RICHTEXT_V3;\nexport const TYPE_STR_SET = ValueType.STR_SET;\nexport const TYPE_SET = ValueType.SET;\nexport const TYPE_REF = ValueType.REF;\nexport const TYPE_REF_SET = ValueType.REF_SET;\nexport const TYPE_MAP = ValueType.MAP;\nexport const TYPE_REF_MAP = ValueType.REF_MAP;\n\nexport interface DataType extends CoreObject {\n  [key: string]: ConcreteCoreValue;\n}\n\nexport type FieldValue = {\n  [TYPE_STR]: string;\n  [TYPE_NUMBER]: number;\n  [TYPE_DATE]: Date;\n  // [TYPE_RICHTEXT]: OldRichText;\n  [TYPE_STR_SET]: Set<string>;\n  [TYPE_SET]: Set<ConcreteCoreValue>;\n  [TYPE_REF]: string;\n  [TYPE_REF_SET]: Set<string>;\n  [TYPE_MAP]: Dictionary<string, ConcreteCoreValue>;\n  [TYPE_REF_MAP]: Dictionary<string, ConcreteCoreValue>;\n  [TYPE_RICHTEXT_V3]: RichText;\n};\nexport type FieldType = keyof FieldValue;\n\nexport type ExtendedField<\n  T extends FieldType,\n  K extends FieldValue[T] = FieldValue[T]\n> = {\n  type: T;\n  default?: (rec: RecordObj) => K;\n  required?: boolean;\n};\ntype DefaultExtendedFields =\n  | ExtendedField<typeof TYPE_STR>\n  | ExtendedField<typeof TYPE_NUMBER>\n  | ExtendedField<typeof TYPE_DATE>\n  // | ExtendedField<typeof TYPE_RICHTEXT>\n  | ExtendedField<typeof TYPE_STR_SET>\n  | ExtendedField<typeof TYPE_SET>\n  | ExtendedField<typeof TYPE_REF>\n  | ExtendedField<typeof TYPE_REF_SET>\n  | ExtendedField<typeof TYPE_MAP>\n  | ExtendedField<typeof TYPE_REF_MAP>\n  | ExtendedField<typeof TYPE_RICHTEXT_V3>;\n\nexport type SchemeObject = Record<\n  string,\n  FieldType | DefaultExtendedFields | ExtendedField<any, any>\n>;\n\ntype Override<T1, T2> = Omit<T1, keyof T2> & T2;\n\nexport const kRecordIdField = '<id>';\n\nexport class SchemeDef<T extends SchemeObject> {\n  namespace: string;\n  fieldDescriptors: T;\n  repositoryFieldName: string;\n\n  constructor(\n    namespace: string,\n    fieldDescriptors: T,\n    repositoryFieldName?: string\n  ) {\n    this.namespace = namespace;\n    this.fieldDescriptors = fieldDescriptors;\n    this.repositoryFieldName = repositoryFieldName || kRecordIdField;\n  }\n\n  derive<B extends SchemeObject>(\n    namespace: string,\n    fields: B,\n    removeFields?: (keyof Omit<T, keyof B>)[],\n    repositoryFieldName?: keyof B\n  ): SchemeDef<Override<T, B>> {\n    const newFields = Object.assign(\n      Object.assign({}, this.fieldDescriptors),\n      fields\n    );\n    if (removeFields) {\n      for (const f of removeFields) {\n        delete newFields[f];\n      }\n    }\n    return new SchemeDef(\n      namespace || this.namespace,\n      newFields,\n      (repositoryFieldName || this.repositoryFieldName) as string\n    );\n  }\n}\n\ntype ExtendedFieldValue<A extends FieldType, B> = B extends FieldValue[A]\n  ? B\n  : FieldValue[A];\n\nexport type ObjectOf<T extends SchemeObject> = {\n  [K in keyof T]: T[K] extends FieldType\n    ? FieldValue[T[K]]\n    : T[K] extends ExtendedField<infer A, infer B>\n    ? ExtendedFieldValue<A, B>\n    : never;\n};\n\nexport type TypeOfScheme<T> = T extends SchemeDef<infer U>\n  ? ObjectOf<U>\n  : never;\n\nexport interface ISchemeManagerRegister {\n  register(\n    version: number,\n    schemeDefs: SchemeDef<any>[],\n    extraNamespaces: SchemeNamespace[],\n    upFunc?: (namespace: string, data: any) => void\n  ): void;\n}\n\nexport interface AttachmentData extends CoreObject {\n  filename: string;\n  fileId: string;\n  user?: string;\n  inProgress?: boolean;\n}\n\nexport type SchemeFields = { [key: string]: ValueType };\n\nexport type NoteStatus = 'ToDo' | 'InProgress' | 'Suspended' | 'Done';\n\nexport type FilterSortBy = typeof FilterSortByValues[number];\n\nexport const FilterSortByValues = [\n  'priority',\n  'created',\n  'modified',\n  'due',\n] as const;\n\nexport type FilterGroupBy = 'assignee' | 'workspace' | 'tag';\n\nexport interface TagValue extends CoreObject {\n  value: string;\n  sortStamp: string;\n}\n\nexport enum ViewType {\n  List = 'list',\n  Board = 'board',\n}\n", "import { isString } from '../../base/comparisons.ts';\nimport {\n  SchemeDef,\n  ISchemeManagerRegister,\n  NS_NOTES,\n  NS_TAGS,\n  NS_USERS,\n  NS_WORKSPACE,\n  TYPE_DATE,\n  TYPE_MAP,\n  TYPE_NUMBER,\n  TYPE_REF,\n  TYPE_REF_SET,\n  // TYPE_RICHTEXT,\n  TYPE_SET,\n  TYPE_STR,\n  TYPE_STR_SET,\n  AttachmentData,\n  TYPE_RICHTEXT_V3,\n  SchemeNamespace,\n  TYPE_REF_MAP,\n  NS_USER_SETTINGS,\n  NS_FILTER,\n} from './scheme-types.ts';\nimport { initRichText } from '../richtext/tree.ts';\nimport { notReached } from '../../base/error.ts';\nimport { Record } from './record.ts';\n\n//BASE SCHEMES\nconst SCHEME_BASE_1 = new SchemeDef('', {\n  creationDate: {\n    type: TYPE_DATE,\n    required: true,\n    default: () => new Date(),\n  },\n  isDeleted: {\n    type: TYPE_NUMBER,\n    default: () => 0,\n  },\n  lastModified: {\n    type: TYPE_DATE,\n    default: (rec: Record) => rec.get('creationDate'),\n  },\n  sortStamp: TYPE_STR,\n});\n\nconst SCHEME_CONTENT_BASE_1 = SCHEME_BASE_1.derive(\n  '',\n  {\n    createdBy: {\n      type: TYPE_STR,\n    },\n    workspace: {\n      type: TYPE_REF,\n    },\n  },\n  [],\n  'workspace'\n);\n\nconst SCHEME_WORKSPACE_1 = SCHEME_BASE_1.derive(NS_WORKSPACE, {\n  owner: {\n    type: TYPE_REF,\n    required: true,\n  },\n  name: {\n    type: TYPE_STR,\n    required: true,\n  },\n  users: TYPE_REF_SET,\n  icon: TYPE_STR,\n  noteTags: {\n    type: TYPE_MAP,\n    default: () => new Map(),\n  },\n  taskTags: {\n    type: TYPE_MAP,\n    default: () => new Map(),\n  },\n  exportImage: TYPE_STR,\n  footerHtml: TYPE_STR,\n});\n\nconst SCHEME_WORKSPACE_2 = SCHEME_WORKSPACE_1.derive(\n  NS_WORKSPACE,\n  {\n    createdBy: {\n      type: TYPE_REF,\n    },\n  },\n  ['owner']\n);\n\nconst SCHEME_WORKSPACE_3 = SCHEME_WORKSPACE_2.derive(NS_WORKSPACE, {\n  noteTags: {\n    type: TYPE_REF_MAP,\n    default: () => new Map(),\n  },\n  taskTags: {\n    type: TYPE_REF_MAP,\n    default: () => new Map(),\n  },\n});\n\nconst SCHEME_WORKSPACE_4 = SCHEME_WORKSPACE_3.derive(NS_WORKSPACE, {}, [\n  'noteTags',\n  'taskTags',\n]);\n\nexport enum OnboardingStep {\n  Start = 0,\n  Finish = 1,\n}\n\nconst SCHEME_USER_1 = SCHEME_BASE_1.derive(NS_USERS, {\n  avatarUrl: TYPE_STR,\n  email: TYPE_STR,\n  name: TYPE_STR,\n  lastLoggedIn: TYPE_DATE,\n  workspaces: {\n    type: TYPE_REF_SET,\n    init: () => new Set<string>(),\n  },\n  seenTutorials: {\n    type: TYPE_STR_SET,\n    init: () => new Set<string>(),\n  },\n  workspaceColors: {\n    type: TYPE_MAP,\n    init: () => new Map<string, number>(),\n  },\n  hiddenWorkspaces: {\n    type: TYPE_STR_SET,\n    init: () => new Set<string>(),\n  },\n  pinnedWorkspaces: {\n    type: TYPE_SET,\n    init: () => new Set<string>(),\n  },\n  onboardingStep: {\n    type: TYPE_NUMBER,\n    init: () => OnboardingStep.Start,\n  },\n});\n\nconst SCHEME_USER_2 = SCHEME_USER_1.derive(NS_USERS, {}, [\n  'lastLoggedIn',\n  'workspaces',\n  'workspaceColors',\n  'hiddenWorkspaces',\n  'pinnedWorkspaces',\n  'onboardingStep',\n  'seenTutorials',\n]);\n\nconst SCHEME_USER_SETTINGS_1 = SCHEME_BASE_1.derive(NS_USER_SETTINGS, {\n  passwordHash: TYPE_STR, // Hash + salt\n  lastLoggedIn: TYPE_DATE,\n  seenTutorials: {\n    type: TYPE_STR_SET,\n    default: () => new Set<string>(),\n  },\n  workspaceColors: {\n    type: TYPE_MAP,\n    default: () => new Map<string, number>(),\n  },\n  hiddenWorkspaces: {\n    type: TYPE_STR_SET,\n    default: () => new Set<string>(),\n  },\n  pinnedWorkspaces: {\n    type: TYPE_SET,\n    default: () => new Set<string>(),\n  },\n  onboardingStep: {\n    type: TYPE_NUMBER,\n    default: () => OnboardingStep.Start,\n  },\n});\n\nconst SCHEME_NOTE_1 = SCHEME_CONTENT_BASE_1.derive(NS_NOTES, {\n  assignees: {\n    type: TYPE_STR_SET,\n    default: () => new Set<string>(),\n  },\n  attachments: {\n    type: TYPE_SET,\n    default: () => new Set<AttachmentData>(),\n  },\n  // body: TYPE_RICHTEXT,\n  dueDate: TYPE_DATE, // Task only, zero on convert\n  // title: TYPE_RICHTEXT,\n  parentNote: TYPE_STR, // Let's debate\n  status: TYPE_NUMBER, // Task only, zero on convert\n  tags: {\n    type: TYPE_SET,\n    default: () => new Set(),\n  },\n  type: TYPE_STR, // Undo for convert\n});\n\nconst SCHEME_NOTE_2 = SCHEME_NOTE_1.derive(NS_NOTES, {\n  parentNote: TYPE_REF,\n  tags: {\n    type: TYPE_MAP,\n    default: () => new Map(),\n  },\n});\n\nconst SCHEME_NOTE_3 = SCHEME_NOTE_2.derive(NS_NOTES, {\n  title: {\n    type: TYPE_RICHTEXT_V3,\n    default: () => initRichText(),\n  },\n  body: {\n    type: TYPE_RICHTEXT_V3,\n    default: () => initRichText(),\n  },\n});\n\nconst SCHEME_NOTE_4 = SCHEME_NOTE_3.derive(NS_NOTES, {\n  assignees: {\n    type: TYPE_REF_SET,\n    default: () => new Set<string>(),\n  },\n  tags: {\n    type: TYPE_REF_MAP,\n    default: () => new Map(),\n  },\n  pinnedBy: {\n    type: TYPE_SET,\n    default: () => new Set<string>(),\n  },\n  parentNote: TYPE_REF,\n});\n\nconst SCHEME_NOTE_5 = SCHEME_NOTE_4.derive(NS_NOTES, {\n  status: TYPE_STR,\n});\n\nconst SCHEME_TAG_1 = SCHEME_CONTENT_BASE_1.derive(NS_TAGS, {\n  color: TYPE_STR,\n  name: TYPE_STR,\n  parentTag: TYPE_REF,\n});\n\nconst SCHEME_TAG_2 = SCHEME_TAG_1.derive(NS_TAGS, {}, ['color']);\n\nconst SCHEME_FILTER_1 = SCHEME_BASE_1.derive(\n  NS_FILTER,\n  {\n    owner: {\n      type: TYPE_REF,\n      required: true,\n    },\n    tags: TYPE_REF_SET,\n    assignees: TYPE_REF_SET,\n    workspaces: TYPE_REF_SET,\n    noteType: TYPE_STR,\n    statuses: TYPE_STR_SET,\n    sortBy: TYPE_STR,\n    pinned: TYPE_NUMBER,\n    groupBy: TYPE_STR,\n    groupByPivot: TYPE_REF,\n    textQuery: TYPE_STR,\n    viewType: TYPE_STR,\n  },\n  [],\n  // Filters are currently personal and live under the user's private repo\n  'owner'\n);\n\nexport {\n  SCHEME_BASE_1 as BASE_RECORD_SCHEME,\n  SCHEME_CONTENT_BASE_1 as BASE_CONTENT_SCHEME,\n  SCHEME_WORKSPACE_4 as WORKSPACE_SCHEME,\n  SCHEME_NOTE_5 as NOTE_SCHEME,\n  SCHEME_TAG_2 as TAG_SCHEME,\n  SCHEME_USER_2 as USER_SCHEME,\n  SCHEME_USER_SETTINGS_1 as USER_SETTINGS,\n  SCHEME_FILTER_1 as SCHEME_FILTER,\n};\n\nexport function runRegister(manager: ISchemeManagerRegister) {\n  //V1\n  manager.register(\n    1,\n    [SCHEME_WORKSPACE_1, SCHEME_USER_1, SCHEME_NOTE_1, SCHEME_TAG_1],\n    []\n  );\n\n  //V2\n  manager.register(\n    2,\n    [SCHEME_NOTE_2],\n    [SchemeNamespace.TAGS, SchemeNamespace.USERS, SchemeNamespace.WORKSPACE],\n    (namespace, data) => {\n      if (namespace === NS_NOTES) {\n        if (data.attachments) {\n          let att = data.attachments;\n          if (isString(att)) {\n            att = JSON.parse(att);\n          }\n          data.attachments = new Set(att);\n        }\n        if (data.tags) {\n          const tagMap = new Map();\n          for (const v of data.tags) {\n            tagMap.set(v, v);\n          }\n          data.tags = tagMap;\n        }\n      }\n    }\n  );\n\n  //V3\n  manager.register(\n    3,\n    [SCHEME_NOTE_3],\n    [SchemeNamespace.TAGS, SchemeNamespace.USERS, SchemeNamespace.WORKSPACE],\n    (namespace, data) => {\n      if (namespace === NS_NOTES) {\n        if (data.title) {\n          notReached('Unsupported old format RichText v2');\n          // data.title = migrationToRichtextV3(data.title);\n        }\n        if (data.body) {\n          notReached('Unsupported old format RichText v2');\n          // data.body = migrationToRichtextV3(data.body);\n        }\n      }\n    }\n  );\n\n  //V4\n  manager.register(\n    4,\n    [SCHEME_WORKSPACE_2],\n    [SchemeNamespace.TAGS, SchemeNamespace.USERS, SchemeNamespace.NOTES],\n    (namespace, data) => {\n      if (namespace === NS_WORKSPACE) {\n        data.createdBy = data.owner;\n        delete data.owner;\n      }\n    }\n  );\n\n  //V5\n  manager.register(\n    5,\n    [SCHEME_WORKSPACE_3, SCHEME_NOTE_4],\n    [SchemeNamespace.TAGS, SchemeNamespace.USERS],\n    (namespace, data) => {}\n  );\n\n  //V6\n  manager.register(\n    6,\n    [\n      SCHEME_WORKSPACE_4,\n      SCHEME_USER_2,\n      SCHEME_USER_SETTINGS_1,\n      SCHEME_TAG_2,\n      SCHEME_FILTER_1,\n      SCHEME_NOTE_5,\n    ],\n    [],\n    (namespace, data) => {\n      if (namespace === NS_TAGS) {\n        delete data.color;\n        delete data.workspace;\n        delete data.createdBy;\n      } else if (namespace === NS_USERS) {\n        delete data.lastLoggedIn;\n        delete data.workspaces;\n        delete data.workspaceColors;\n        delete data.hiddenWorkspaces;\n        delete data.pinnedWorkspaces;\n        delete data.onboardingStep;\n        delete data.seenTutorials;\n      } else if (namespace === NS_WORKSPACE) {\n        delete data.noteTags;\n        delete data.taskTags;\n        delete data.createdBy;\n      } else if (namespace === NS_NOTES) {\n        delete data.status;\n      }\n    }\n  );\n\n  //Next Version Here\n}\n\n/**\n * How to upgrade schemes:\n *\n * 2 scenarios:\n * 1. You want to add a new field to base or a specific scheme, without touching existing fields:\n *    Solution: add field where you need. no need to register new version.\n * 2. You want to change an existing field type, or upgrade record data:\n *    Solution:\n *      Create a new SchemeDef file with the changes.\n *      SchemeManager.register() with the new SchemeDef + the upFunc\n *      IMPORTANT: need to modify compatibilityVersion in package.json, this will cause webapp users to clear\n *                 their local cache and get the new record version.\n */\n", "import { assert } from '../../base/error.ts';\nimport { isString, isNoValue } from '../../base/comparisons.ts';\nimport { JSONValue, ReadonlyJSONObject } from '../../base/interfaces.ts';\nimport {\n  Encodable,\n  Encoder,\n  coreValueEquals,\n} from '../../base/core-types/index.ts';\nimport {\n  ConstructorDecoderConfig,\n  isDecoderConfig,\n} from '../../base/core-types/encoding/index.ts';\nimport {\n  JSONDecoder,\n  JSONEncoder,\n} from '../../base/core-types/encoding/json.ts';\nimport { clone } from './object.ts';\nimport {\n  SchemeDef,\n  ISchemeManagerRegister,\n  NS_NOTES,\n  NS_TAGS,\n  NS_USERS,\n  NS_WORKSPACE,\n  SchemeObject,\n  SchemeFields,\n  DataType,\n  kRecordIdField,\n  NS_ORGANIZATION,\n} from './scheme-types.ts';\nimport { runRegister } from './scheme-versions.ts';\nimport { isRefValueType, ValueType } from './types/index.ts';\n\nfunction normalizeFieldDescriptors(descriptors: any) {\n  const types: SchemeFields = {};\n  const requiredFields: string[] = [];\n  for (let [k, desc] of Object.entries<any>(descriptors)) {\n    if (isString(desc)) {\n      desc = {\n        type: desc,\n      };\n    }\n    descriptors[k] = desc;\n    types[k] = desc.type;\n    if (desc.required) {\n      requiredFields.push(k);\n    }\n  }\n  return [descriptors, types, requiredFields];\n}\n\nexport interface SchemeConfig {\n  namespace: string;\n  version?: number;\n  fieldDescriptors: any;\n  repositoryFieldName: string;\n}\n\nexport interface EncodedScheme {\n  ns: string;\n  version: number;\n}\n\nexport class Scheme implements Encodable {\n  private _namespace!: string;\n  private _version!: number;\n  private _fieldDescriptors: any;\n  private _fields!: SchemeFields;\n  private _requiredFields: string[] | undefined;\n  private _repoFieldName!: string;\n\n  constructor(config: SchemeConfig | ConstructorDecoderConfig<EncodedScheme>) {\n    if (isDecoderConfig(config)) {\n      const decoder = config.decoder;\n      const namespace: string = decoder.get<string>('ns')!;\n      const version: number = decoder.get<number>('version')!;\n\n      if (namespace === '' && version === 0) {\n        this.copyFrom(Scheme.nullScheme());\n        return;\n      }\n\n      const scheme = SchemeManager.instance.getScheme(namespace, version);\n      if (!scheme) {\n        throw new Error(`Unknown scheme ${namespace}/${version}`);\n      }\n      this.copyFrom(scheme);\n    } else {\n      this._namespace = config.namespace;\n      this._version = config.version || 0;\n      [this._fieldDescriptors, this._fields, this._requiredFields] =\n        normalizeFieldDescriptors(config.fieldDescriptors);\n      this._repoFieldName = config.repositoryFieldName;\n    }\n  }\n\n  get namespace() {\n    return this._namespace;\n  }\n\n  get version() {\n    return this._version;\n  }\n\n  get isNull() {\n    return Object.keys(this._fieldDescriptors).length === 0;\n  }\n\n  get fields() {\n    return this._fields;\n  }\n\n  get repositoryFieldName(): string {\n    return this._repoFieldName;\n  }\n\n  getFields(): SchemeFields {\n    return this._fields;\n  }\n\n  getRequiredFields(): string[] | undefined {\n    return this._requiredFields;\n  }\n\n  getVersion() {\n    return this._version;\n  }\n\n  getNamespace() {\n    return this._namespace;\n  }\n\n  getFieldType(fieldName: string): ValueType {\n    const type: ValueType | undefined = this.getFields()[fieldName];\n    assert(\n      !isNoValue(type),\n      `Unknown field ${this.getNamespace()}/${fieldName}`\n    );\n    return type;\n  }\n\n  hasField(fieldName: string): boolean {\n    const desc = this._fieldDescriptors[fieldName];\n    return !isNoValue(desc);\n  }\n\n  isRefField(fieldName: string): boolean {\n    const type: ValueType | undefined = this.getFields()[fieldName];\n    return !isNoValue(type) && isRefValueType(type);\n  }\n\n  isRequiredField(fieldName: string): boolean {\n    const requiredFields = this.getRequiredFields();\n    if (requiredFields === undefined) {\n      return false;\n    }\n    return requiredFields.indexOf(fieldName) >= 0;\n  }\n\n  hasInitForField(fieldName: string): boolean {\n    const desc = this._fieldDescriptors[fieldName];\n    return desc && desc.init;\n  }\n\n  initValueForField(fieldName: string, data: DataType) {\n    const desc = this._fieldDescriptors[fieldName];\n    if (!desc || !desc.init) {\n      return undefined;\n    }\n    return desc.init(data);\n  }\n\n  clone(version: number): Scheme {\n    return new Scheme({\n      namespace: this._namespace,\n      version: version || this._version,\n      fieldDescriptors: Object.assign({}, this._fieldDescriptors),\n      repositoryFieldName: this._repoFieldName,\n    });\n  }\n\n  allowsAutoUpgradeFrom(oldScheme: Scheme): boolean {\n    if (this.isNull) {\n      return false;\n    }\n\n    const oldNS = oldScheme.getNamespace();\n    assert(!oldNS || this.getNamespace() === oldScheme.getNamespace());\n\n    if (oldScheme.isNull) {\n      return true;\n    }\n\n    const oldVersion = oldScheme.getVersion();\n    if (oldVersion === this.getVersion()) {\n      return true;\n    }\n\n    if (oldVersion > this.getVersion()) {\n      // deno-lint-ignore no-debugger\n      debugger;\n      return false;\n    }\n\n    if (!SchemeManager.instance.schemeExists(oldNS, oldVersion + 1)) {\n      // deno-lint-ignore no-debugger\n      debugger;\n      return false;\n    }\n\n    if (!SchemeManager.instance.schemeExists(oldNS, this.getVersion())) {\n      // deno-lint-ignore no-debugger\n      debugger;\n      return false;\n    }\n\n    return true;\n  }\n\n  upgradeAvailable() {\n    const latest = Scheme.getLatestVersion(this._namespace);\n    return latest.version > this._version;\n  }\n\n  upgradeData(oldScheme: Scheme, oldData: DataType): DataType {\n    const oldNS = oldScheme.getNamespace();\n    assert(!oldNS || this.getNamespace() === oldScheme.getNamespace());\n\n    if (oldScheme.isNull) {\n      return oldData;\n    }\n\n    const oldVersion = oldScheme.getVersion();\n    const newVersion = this.getVersion();\n\n    const newData = clone(oldScheme.getFields(), oldData);\n\n    if (oldVersion === newVersion) {\n      return newData;\n    }\n\n    let curVersion = oldVersion + 1;\n\n    while (curVersion <= newVersion) {\n      if (SchemeManager.instance.schemeExists(this.namespace, curVersion)) {\n        const upFunc = SchemeManager.instance.getUpFunc(curVersion);\n        if (upFunc) {\n          upFunc(this.getNamespace(), newData);\n        }\n      }\n      curVersion++;\n    }\n\n    return newData;\n  }\n\n  isEqual(otherScheme: Scheme): boolean {\n    if (this._version !== otherScheme.getVersion()) {\n      return false;\n    }\n\n    return coreValueEquals(\n      this._fieldDescriptors,\n      otherScheme._fieldDescriptors\n    );\n  }\n\n  serialize(encoder: Encoder): void {\n    encoder.set('ns', this.getNamespace());\n    encoder.set('version', this.getVersion());\n  }\n\n  private copyFrom(other: Scheme) {\n    this._namespace = other._namespace;\n    this._fieldDescriptors = other._fieldDescriptors;\n    this._requiredFields = other._requiredFields;\n    this._version = other._version;\n    this._fields = other._fields;\n    this._repoFieldName = other._repoFieldName;\n  }\n\n  toJS(): JSONValue {\n    const encoder = new JSONEncoder();\n\n    this.serialize(encoder);\n\n    return encoder.getOutput();\n  }\n\n  static fromJS(obj: ReadonlyJSONObject): Scheme {\n    const decoder = new JSONDecoder(obj);\n    return new this({ decoder });\n  }\n\n  static nullScheme() {\n    return new this({\n      namespace: '',\n      version: 0,\n      fieldDescriptors: {},\n      repositoryFieldName: kRecordIdField,\n    });\n  }\n\n  static workspace(): Scheme {\n    const scheme = SchemeManager.instance.getScheme(NS_WORKSPACE);\n    if (!scheme) throw new Error('Workspace scheme not found');\n    return scheme;\n  }\n\n  static note(): Scheme {\n    const scheme = SchemeManager.instance.getScheme(NS_NOTES);\n    if (!scheme) throw new Error('Note scheme not found');\n    return scheme;\n  }\n\n  static tag(): Scheme {\n    const scheme = SchemeManager.instance.getScheme(NS_TAGS);\n    if (!scheme) throw new Error('Tag scheme not found');\n    return scheme;\n  }\n\n  static user(): Scheme {\n    const scheme = SchemeManager.instance.getScheme(NS_USERS);\n    if (!scheme) throw new Error('User scheme not found');\n    return scheme;\n  }\n\n  static organization(): Scheme {\n    const scheme = SchemeManager.instance.getScheme(NS_ORGANIZATION);\n    if (!scheme) throw new Error('Organization scheme not found');\n    return scheme;\n  }\n\n  static getLatestVersion(ns: string) {\n    const scheme = SchemeManager.instance.getScheme(ns);\n    if (!scheme) throw new Error(`Scheme namespace: ${ns} not found`);\n    return scheme;\n  }\n\n  static forKey(key: string) {\n    const keyLen = key.length;\n    let start = 0;\n    let end;\n    for (start = 0; start < keyLen && key[start] === '/'; ++start) {\n      // Skip leading slashes\n    }\n    for (end = start; end < keyLen && key[end] !== '/'; ++end) {\n      // Find the end of the type part\n    }\n    assert(start <= end || start >= keyLen, 'Unsupported key format');\n    const type = key.substring(start, end);\n    switch (type) {\n      case NS_WORKSPACE:\n        return this.workspace();\n\n      case NS_NOTES:\n        return this.note();\n\n      case NS_TAGS:\n        return this.tag();\n\n      case NS_USERS:\n        return this.user();\n\n      case NS_ORGANIZATION:\n        return this.organization();\n\n      default:\n        break;\n    }\n  }\n}\n\nclass SchemeVersion {\n  private _version: number;\n  private _namespaces: Map<string, Scheme>;\n  private _upFunc?: (namespace: string, data: DataType) => void;\n\n  constructor(\n    version: number,\n    upFunc?: (namespace: string, data: DataType) => void\n  ) {\n    this._version = version;\n    this._namespaces = new Map<string, Scheme>();\n    this._upFunc = upFunc;\n  }\n\n  get version() {\n    return this._version;\n  }\n\n  get upFunc() {\n    return this._upFunc;\n  }\n\n  get schemes() {\n    return Array.from(this._namespaces.values());\n  }\n\n  addDef(def: SchemeDef<any>) {\n    const scheme = new Scheme({\n      namespace: def.namespace,\n      version: this._version,\n      fieldDescriptors: def.fieldDescriptors,\n      repositoryFieldName: def.repositoryFieldName,\n    });\n\n    this._namespaces.set(scheme.namespace, scheme);\n  }\n\n  addScheme(scheme: Scheme) {\n    const newScheme = scheme.clone(this._version);\n    this._namespaces.set(newScheme.namespace, newScheme);\n  }\n\n  getScheme(namespace: string): Scheme | undefined {\n    return this._namespaces.get(namespace);\n  }\n\n  schemeExists(namespace: string) {\n    return this._namespaces.has(namespace);\n  }\n}\n\nlet managerLoadFunc = (manager: ISchemeManagerRegister) => {\n  runRegister(manager);\n};\n\nexport function overrideManagerRegistration(\n  func: (manager: ISchemeManagerRegister) => void\n) {\n  managerLoadFunc = func;\n}\n\nexport class SchemeManager implements ISchemeManagerRegister {\n  private static _instance: SchemeManager;\n\n  private _versions: Map<number, SchemeVersion>;\n  private _currVersion: number;\n\n  constructor() {\n    this._versions = new Map<number, SchemeVersion>();\n    this._currVersion = 0;\n  }\n\n  static get instance() {\n    if (!SchemeManager._instance) {\n      const instance = new SchemeManager();\n      managerLoadFunc(instance);\n      SchemeManager._instance = instance;\n    }\n    return SchemeManager._instance;\n  }\n\n  /**\n   * WARNING Use only for Testing!!!\n   * @param manager\n   */\n  static setCustomInstance(manager: SchemeManager) {\n    SchemeManager._instance = manager;\n  }\n\n  /**\n   * Register a new version of schemes\n   * @param version\n   * @param schemeDefs\n   * @param upFunc Function update the records data object\n   */\n\n  register(\n    version: number,\n    schemeDefs: SchemeDef<SchemeObject>[],\n    extraNamespaces: string[],\n    upFunc?: (namespace: string, data: any) => void\n  ) {\n    assert(this._currVersion + 1 === version);\n    if (version === 1) {\n      assert(isNoValue(upFunc));\n      assert(extraNamespaces.length === 0);\n    }\n    if (version > 1) {\n      assert(!isNoValue(upFunc));\n    }\n    const schVersion = new SchemeVersion(version, upFunc);\n\n    //Copy schemes from prev version\n    if (version > 1 && extraNamespaces.length > 0) {\n      for (const ns of extraNamespaces) {\n        const prevScheme = this.getScheme(ns);\n        if (prevScheme) {\n          schVersion.addScheme(prevScheme);\n        }\n      }\n    }\n\n    //Override new def\n    for (const def of schemeDefs) {\n      schVersion.addDef(def);\n    }\n\n    this._versions.set(version, schVersion);\n\n    this._currVersion++;\n  }\n\n  /**\n   * Get Scheme by namespace and version (optional)\n   * @param namespace\n   * @param version if version is not sent, will return the latest version\n   */\n  getScheme(namespace: string, version?: number): Scheme | undefined {\n    if (version !== undefined) {\n      return this._versions.get(version)?.getScheme(namespace);\n    }\n\n    for (let v = this._currVersion; v >= 1; v--) {\n      const version = this._versions.get(v);\n      if (version) {\n        const scheme = version.getScheme(namespace);\n        if (scheme) {\n          return scheme;\n        }\n      }\n    }\n  }\n\n  schemeExists(namespace: string, version: number): boolean {\n    return this._versions.get(version)?.schemeExists(namespace) || false;\n  }\n\n  getUpFunc(version: number) {\n    return this._versions.get(version)?.upFunc;\n  }\n}\n", "import { assert } from '../../base/error.ts';\nimport { isNoValue, isObject } from '../../base/comparisons.ts';\nimport { Scheme } from './scheme.ts';\nimport {\n  isValidData,\n  serialize,\n  equals as dataEqual,\n  deserialize,\n  clone,\n  diff as objectDiff,\n  patch as objectPatch,\n  getRefs,\n  normalize as normalizeObject,\n  diffKeys,\n  DataChanges,\n  gc,\n  needGC,\n  rewriteRefs,\n} from './object.ts';\nimport {\n  ConstructorDecoderConfig,\n  Decoder,\n  isDecoderConfig,\n  ReadonlyDecodedObject,\n} from '../../base/core-types/encoding/index.ts';\nimport {\n  JSONCyclicalDecoder,\n  JSONCyclicalEncoder,\n} from '../../base/core-types/encoding/json.ts';\nimport { DataType, kRecordIdField } from './scheme-types.ts';\nimport { MD5Checksum } from '../../base/core-types/encoding/checksum.ts';\nimport { ReadonlyJSONObject } from '../../base/interfaces.ts';\nimport {\n  ConcreteCoreValue,\n  CoreValue,\n  Encodable,\n  Encoder,\n} from '../../base/core-types/index.ts';\nimport { SerializeValueTypeOptions } from './types/index.ts';\n\nexport interface ReadonlyRecord {\n  readonly isNull: boolean;\n  readonly scheme: Scheme;\n  readonly isValid: boolean;\n  readonly checksum: string;\n  /**\n   * @deprecated No longer used. Assume undefined.\n   */\n  readonly serverTimestamp?: Date;\n  readonly refs: Set<string>;\n\n  get(key: string, defaultValue?: any): any;\n  has(key: string): boolean;\n  cloneData(): DataType;\n}\n\nexport interface RecordConfig {\n  scheme: Scheme;\n  data: DataType;\n}\n\nexport interface EncodedRecord {\n  s: Decoder;\n  data: ReadonlyDecodedObject;\n}\n\nconst checksumSerOptions: SerializeValueTypeOptions = {\n  // For checksum purposes we need to use the flat rep or we won't account\n  // for depth changes. Computing the checksum on a DFS run of the tree\n  // completely strips out the depth info.\n  flatRep: true,\n  local: false,\n  typeSafe: true,\n};\n\nexport class Record implements ReadonlyRecord, Encodable {\n  private _scheme!: Scheme;\n  private _data!: DataType;\n  private _checksum: string | undefined;\n  private _cachedRefs: Set<string> | undefined;\n  private _normalized = false;\n\n  constructor(config: RecordConfig | ConstructorDecoderConfig<EncodedRecord>) {\n    if (isDecoderConfig(config)) {\n      this.deserialize(config.decoder);\n    } else {\n      assert(isObject(config.data));\n      this._scheme = config.scheme;\n      this._data = config.data;\n    }\n    this.normalize();\n    this.assertValidData();\n  }\n\n  static nullRecord() {\n    return new this({ scheme: Scheme.nullScheme(), data: {} });\n  }\n\n  get isNull() {\n    return this.scheme.isNull;\n  }\n\n  get scheme() {\n    return this._scheme;\n  }\n\n  get isValid(): boolean {\n    return <boolean>isValidData(this.scheme, this._data)[0];\n  }\n\n  /**\n   * Returns a strong checksum that can be used to efficiently test for\n   * equality between two records. It is used to guard against diff/patch bugs\n   * that'd otherwise throw both ends of the diff-sync loop out of sync and lead\n   * to corruption. We use it as an alternative to the sequential versioning\n   * used in the original diff-sync paper by Neil Fraser.\n   *\n   * Any legacy cryptographic hash would probably do here. The current\n   * implementation uses MD5 simply because its so common.\n   *\n   * WARNING: Any change here may require to re-calculate checksums in the\n   * backend's DB for ALL records and their versions (lifetime).\n   */\n  get checksum(): string {\n    if (this._checksum === undefined) {\n      const csEncoder = new MD5Checksum();\n      serialize(csEncoder, this._scheme.fields, this._data, checksumSerOptions);\n      this._checksum = csEncoder.getOutput();\n    }\n    return this._checksum;\n  }\n\n  get refs(): Set<string> {\n    if (this._cachedRefs === undefined) {\n      this._cachedRefs = getRefs(this.scheme.fields, this._data);\n    }\n    return this._cachedRefs;\n  }\n\n  get keys(): string[] {\n    return Object.keys(this._data);\n  }\n\n  get repositoryId(): '<id>' | string {\n    const fieldName = this.scheme.repositoryFieldName;\n    if (fieldName === kRecordIdField) {\n      return kRecordIdField;\n    }\n    const repoId = this.get<string>(fieldName);\n    return repoId ? '/data/' + repoId : '/sys/dir';\n  }\n\n  get<T extends ConcreteCoreValue = ConcreteCoreValue>(\n    key: string,\n    defaultValue?: T\n  ): T {\n    assert(\n      this.scheme.hasField(key),\n      `Unknown field name '${key}' for scheme '${this.scheme.namespace}'`\n    );\n    const data = this._data;\n\n    if (data.hasOwnProperty(key)) {\n      return data[key] as T;\n    }\n    return (!isNoValue(defaultValue) ? defaultValue : undefined) as T;\n  }\n\n  has(key: string): boolean {\n    assert(\n      this.scheme.hasField(key),\n      `Unknown field name '${key}' for scheme '${this.scheme.namespace}'`\n    );\n    return this._data.hasOwnProperty(key);\n  }\n\n  set(key: string, value: any) {\n    assert(\n      this.scheme.hasField(key),\n      `Unknown field name '${key}' for scheme '${this.scheme.namespace}'`\n    );\n    if (value === undefined) {\n      this.delete(key);\n      return;\n    }\n    this._data[key] = value;\n    this._invalidateCaches();\n    this.normalize();\n  }\n\n  setMultiple(data: { [K in string]: any }) {\n    for (const [key, value] of Object.entries(data)) {\n      this.set(key, value);\n    }\n  }\n\n  delete(key: string): boolean {\n    assert(\n      this.scheme.hasField(key),\n      `Unknown field name '${key}' for scheme '${this.scheme.namespace}'`\n    );\n    const success = delete this._data[key];\n    this._invalidateCaches();\n    this.normalize();\n    return success;\n  }\n\n  touch() {\n    this._invalidateCaches();\n  }\n\n  isEqual(other: Record, local: boolean = false): boolean {\n    if (this === other) {\n      return true;\n    }\n    if (!this.scheme.isEqual(other.scheme)) {\n      return false;\n    }\n    this.normalize();\n    other.normalize();\n    return dataEqual(this.scheme.getFields(), this._data, other._data, {\n      local,\n    });\n  }\n\n  clone(): Record {\n    const scheme = this._scheme;\n    const result = new Record({\n      scheme,\n      data: clone(scheme.getFields(), this._data),\n    });\n    result._checksum = this._checksum;\n    return result;\n  }\n\n  cloneData(onlyFields?: string[]): any {\n    return clone(this._scheme.getFields(), this._data, onlyFields);\n  }\n\n  copyFrom(record: ReadonlyRecord | Record) {\n    this._scheme = record.scheme;\n    this._data = record.cloneData();\n    this._invalidateCaches();\n  }\n\n  diff(other: Record, local: boolean) {\n    assert(other instanceof Record);\n\n    this.normalize();\n    other.normalize();\n\n    other.assertValidData();\n    return objectDiff(other.scheme.getFields(), this._data, other._data, {\n      local,\n    });\n  }\n\n  patch(changes: DataChanges) {\n    const scheme = this.scheme;\n    this._data = objectPatch(scheme.getFields(), this._data, changes);\n    this._invalidateCaches();\n    this.normalize();\n  }\n\n  diffKeys(other: Record, local: boolean): string[] {\n    this.normalize();\n    other.normalize();\n    return diffKeys(other.scheme.fields, this._data, other._data, {\n      local,\n    });\n  }\n\n  upgradeScheme(newScheme: Scheme) {\n    assert(newScheme.allowsAutoUpgradeFrom(this.scheme));\n    this._data = newScheme.upgradeData(this.scheme, this._data);\n    this._scheme = newScheme;\n    this._invalidateCaches();\n    this.normalize();\n  }\n\n  upgradeSchemeToLatest() {\n    if (!this._scheme.upgradeAvailable()) {\n      return false; //No need to update\n    }\n    this.upgradeScheme(Scheme.getLatestVersion(this.scheme.namespace));\n    return true;\n  }\n\n  normalize(): void {\n    if (this._normalized) {\n      return;\n    }\n    this._invalidateCaches();\n    normalizeObject(this.scheme, this._data);\n    this._normalized = true;\n  }\n\n  gc(): boolean {\n    return gc(this._scheme, this._data);\n  }\n\n  needGC(): boolean {\n    return needGC(this._scheme, this._data);\n  }\n\n  serialize(\n    encoder: Encoder<string, CoreValue>,\n    options = { local: false }\n  ): void {\n    encoder.set('s', this.scheme);\n\n    const dataEncoder = encoder.newEncoder();\n    serialize(dataEncoder, this.scheme.getFields(), this._data, {\n      local: options.local,\n    });\n    encoder.set('d', dataEncoder.getOutput());\n  }\n\n  deserialize(decoder: Decoder): void {\n    this._scheme = new Scheme({ decoder: decoder.getDecoder('s') });\n    this._data = deserialize(decoder.getDecoder('d'), this.scheme.fields);\n    this._invalidateCaches();\n    this.normalize();\n    this.assertValidData();\n  }\n\n  toJS(local = false): ReadonlyJSONObject {\n    const encoder = new JSONCyclicalEncoder();\n    this.serialize(encoder, { local });\n    return encoder.getOutput() as ReadonlyJSONObject;\n  }\n\n  static fromJS(obj: ReadonlyJSONObject): Record {\n    const decoder = new JSONCyclicalDecoder(obj);\n    return new this({ decoder });\n  }\n\n  assertValidData() {\n    const [valid, msg] = isValidData(this.scheme, this._data);\n    assert(<boolean>valid, <string>msg);\n  }\n\n  private _invalidateCaches() {\n    this._checksum = undefined;\n    this._cachedRefs = undefined;\n    this._normalized = false;\n    this._cachedRefs = undefined;\n  }\n\n  rewriteRefs(keyMapping: Map<string, string>, deleteRefs?: Set<string>): void {\n    rewriteRefs(this.scheme, this._data, keyMapping, deleteRefs);\n    this._invalidateCaches();\n    this.normalize();\n  }\n}\n", "import * as ArrayUtils from '../../../base/array.ts';\nimport { CoreValue } from '../../../base/core-types/index.ts';\n\n// A tuple of [fieldName, local, oldValue]\nexport type Mutation = [fieldname: string, local: boolean, value: CoreValue];\n\nexport type MutationPack = Mutation | Mutation[] | undefined | void;\n\nfunction isMutation(pack: MutationPack): pack is Mutation {\n  return (\n    pack instanceof Array && pack.length === 3 && typeof pack[0] === 'string'\n  );\n}\n\nexport function mutationPackAppend(\n  pack: MutationPack,\n  mutation: MutationPack\n): MutationPack {\n  // NOP\n  if (mutation === undefined) {\n    return pack;\n  }\n  if (pack === undefined) {\n    return mutation;\n  }\n  // Both pack and mutation are not empty. Must allocate an array\n  if (isMutation(pack)) {\n    pack = [pack];\n  }\n  // Append the added mutations\n  if (isMutation(mutation)) {\n    pack.push(mutation);\n  } else {\n    ArrayUtils.append(pack, mutation);\n  }\n  return mutationPackOptimize(pack);\n}\n\nexport function* mutationPackIter(pack: MutationPack): Generator<Mutation> {\n  if (pack === undefined) {\n    return;\n  }\n  if (isMutation(pack)) {\n    yield pack;\n  } else {\n    for (const m of pack) {\n      yield m;\n    }\n  }\n}\n\nexport function mutationPackGetFirst(pack: MutationPack): Mutation | undefined {\n  if (pack === undefined) {\n    return undefined;\n  }\n  if (isMutation(pack)) {\n    return pack;\n  }\n  return pack[0];\n}\n\nexport function mutationPackLength(pack: MutationPack): number {\n  if (pack === undefined) {\n    return 0;\n  }\n  if (isMutation(pack)) {\n    return 1;\n  }\n  return pack.length;\n}\n\nexport function mutationPackGet(\n  pack: MutationPack,\n  idx: number\n): Mutation | undefined {\n  if (pack === undefined) {\n    return undefined;\n  }\n  if (isMutation(pack)) {\n    return idx === 0 ? pack : undefined;\n  }\n  return pack[idx];\n}\n\nexport function mutationPackDeleteFirst(pack: MutationPack): MutationPack {\n  if (pack === undefined || isMutation(pack) || pack.length <= 1) {\n    return undefined;\n  }\n  pack.shift();\n  return pack;\n}\n\nexport function mutationPackToArr(pack: MutationPack): Mutation[] {\n  if (pack === undefined) {\n    return [];\n  }\n  if (isMutation(pack)) {\n    return [pack];\n  }\n  return pack;\n}\n\nexport function mutationPackIsEmpty(pack: MutationPack): boolean {\n  return pack === undefined || pack.length === 0;\n}\n\n/**\n * Removes duplicate mutations for the same field.\n *\n * @param pack The pack to optimize.\n * @returns An optimized pack where each field appears only once.\n */\nexport function mutationPackOptimize(pack: MutationPack): MutationPack {\n  if (pack === undefined || isMutation(pack) || pack.length <= 1) {\n    return pack;\n  }\n\n  const seenFields: string[] = [];\n  for (let i = 0; i < pack.length; ++i) {\n    const [fieldName] = pack[i];\n    if (seenFields.indexOf(fieldName) > -1) {\n      pack.splice(i, 1);\n      --i;\n    } else {\n      seenFields.push(fieldName);\n    }\n  }\n  return pack;\n}\n\nexport function mutationPackClone(pack: MutationPack): MutationPack {\n  if (!pack) {\n    return undefined;\n  }\n  if (isMutation(pack)) {\n    return [pack[0], pack[1], pack[2]];\n  }\n  return (pack as Mutation[]).map((m) => [m[0], m[1], m[2]] as Mutation);\n}\n\nexport function mutationPackHasRemote(pack: MutationPack): boolean {\n  if (pack !== undefined) {\n    if (isMutation(pack)) {\n      return pack[1] === false;\n    }\n    for (const [_f, local] of pack) {\n      if (!local) {\n        return true;\n      }\n    }\n  }\n  return false;\n}\n\nexport function mutationPackHasField(\n  pack: MutationPack,\n  ...fields: string[]\n): boolean {\n  for (const [field] of mutationPackIter(pack)) {\n    if (fields.includes(field)) {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport function mutationPackIsLocal(pack: MutationPack): boolean {\n  for (const m of mutationPackIter(pack)) {\n    if (!m[1]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function mutationPackDeleteField(\n  pack: MutationPack,\n  fieldName: string\n): MutationPack {\n  if (pack === undefined) {\n    return undefined;\n  }\n  if (isMutation(pack) && pack[0] === fieldName) {\n    return undefined;\n  }\n  if (pack.length === 1 && pack[0][0] === fieldName) {\n    return undefined;\n  }\n  for (let i = 0; i < pack.length; ++i) {\n    if ((pack[i] as Mutation)[0] === fieldName) {\n      pack.splice(i, 1);\n      break;\n    }\n  }\n  return pack.length > 0 ? pack : undefined;\n}\n\nexport function mutationPackSubtractFields(\n  pack: MutationPack,\n  toRemoveField: MutationPack\n): MutationPack {\n  for (const m of mutationPackIter(toRemoveField)) {\n    pack = mutationPackDeleteField(pack, m[0]);\n  }\n  return pack;\n}\n", "import {\n  getTypeOperationsByValue,\n  IValueTypeOperations,\n  ValueTypeOptions,\n} from './index.ts';\nimport { Change, EncodedChange } from '../../change/index.ts';\nimport { CoreValue } from '../../../base/core-types/index.ts';\n\nexport function diff(\n  value1: CoreValue,\n  value2: CoreValue,\n  typeOP?: IValueTypeOperations,\n  options: ValueTypeOptions = {}\n): undefined | Change<EncodedChange> | Change<EncodedChange>[] {\n  if (value1 === undefined && value2 === undefined) return;\n\n  const lTypeOP = typeOP || getTypeOperationsByValue(value1);\n\n  if (value1 === undefined && value2 !== undefined) {\n    //New Value\n    return lTypeOP.valueAddedDiff(value2, options);\n  } else if (value1 !== undefined && value2 === undefined) {\n    //Value Removed\n    return lTypeOP.valueRemovedDiff(value1, options);\n  } else {\n    //Value Changed\n    return lTypeOP.valueChangedDiff(value1, value2, options);\n  }\n}\n\nexport function patch(\n  value: CoreValue,\n  changes: Change<EncodedChange>[],\n  typeOP?: IValueTypeOperations,\n  options: ValueTypeOptions = {}\n): CoreValue {\n  const lTypeOP = typeOP || getTypeOperationsByValue(value);\n  const newValue = lTypeOP.patch(value, changes, options);\n\n  return newValue;\n}\n\nexport function concatChanges(\n  changes1: undefined | Change<EncodedChange> | Change<EncodedChange>[],\n  changes2: undefined | Change<EncodedChange> | Change<EncodedChange>[]\n): Change<EncodedChange>[] {\n  const result: Change<EncodedChange>[] = [];\n  if (changes1) {\n    if (Array.isArray(changes1)) {\n      for (const c of changes1) {\n        result.push(c);\n      }\n    } else {\n      result.push(changes1);\n    }\n  }\n\n  if (changes2) {\n    if (Array.isArray(changes2)) {\n      for (const c of changes2) {\n        result.push(c);\n      }\n    } else {\n      result.push(changes2);\n    }\n  }\n\n  return result;\n}\n", "import { assert } from '../../../base/error.ts';\nimport { clone, concatChanges, diff, patch } from '../../base/object.ts';\nimport * as TypeUtils from '../../base/types/utils.ts';\nimport { Scheme } from '../../base/scheme.ts';\nimport { CoreObject, coreValueEquals } from '../../../base/core-types/index.ts';\nimport { EqualOptions } from '../../../base/core-types/equals.ts';\nimport { VertexSnapshot } from '../graph/types.ts';\n\nenum UndoType {\n  Local = 'l',\n  Remote = 'r',\n}\n\ninterface LocalUndo {\n  type: UndoType.Local;\n  snapshot: VertexSnapshot;\n  /**\n   * Group is to mark several undo's from several single-managers together.\n   * This puts all the undo's in a the same group.\n   * Also you can group several snapshots together on the same single-manger.\n   * Undo/Redo together.\n   */\n  group: number;\n}\n\ninterface RemoteUndo {\n  type: UndoType.Remote;\n  snapshot: VertexSnapshot;\n}\ntype UndoItem = LocalUndo | RemoteUndo;\n\ninterface RedoItem {\n  snapshot: VertexSnapshot;\n  group: number;\n  base: VertexSnapshot;\n}\n\nexport interface SingleUndoManagerOptions {\n  limit?: number;\n  equalsOptions?: EqualOptions;\n  initialSnapshot?: VertexSnapshot;\n  /**\n   * Limiting the fields for a snapshot. e.g: the undo on a Note title or body.\n   */\n  snapshotFields?: string[];\n}\n\nconst DEFAULT_LIMIT = 100;\n\n/**\n * Represents an object that you can do an undo to.\n * The Vertex-Manager implements this interface.\n * The abstraction helps with testing\n */\nexport interface UndoObject {\n  readonly scheme: Scheme;\n  getSnapshot(onlyFields?: string[]): VertexSnapshot;\n  updateBySnapshot(snapshot: VertexSnapshot): void;\n}\n\n/**\n * Single undo object manager.\n * For every Vertex-Manager there will be a SingleUndoManager\n */\nexport class SingleUndoManager {\n  private _latestSnapshot: VertexSnapshot;\n\n  private _undoList: UndoItem[];\n  private _redoList: RedoItem[];\n  private _object: UndoObject;\n  private _limit: number;\n  private _equalsOptions?: EqualOptions;\n  private _snapshotFields?: string[];\n\n  constructor(obj: UndoObject, options?: SingleUndoManagerOptions) {\n    this._object = obj;\n    options = options || {};\n    this._snapshotFields = options.snapshotFields;\n    this._latestSnapshot =\n      options.initialSnapshot || obj.getSnapshot(this._snapshotFields);\n    this._undoList = [\n      {\n        type: UndoType.Local,\n        snapshot: this._latestSnapshot,\n        group: 0,\n      },\n    ];\n    this._redoList = [];\n\n    this._limit =\n      (options.limit !== undefined && options.limit > 0\n        ? options.limit\n        : DEFAULT_LIMIT) + 1;\n    this._equalsOptions = options.equalsOptions;\n  }\n\n  get lastLocalUndo(): LocalUndo {\n    const last = this.lastUndo;\n    if (last.type === UndoType.Local) {\n      return last;\n    }\n\n    const prevLast = this._undoList[this._undoList.length - 2];\n    assert(prevLast.type === UndoType.Local);\n\n    return prevLast as LocalUndo;\n  }\n\n  get lastRedo(): RedoItem | undefined {\n    if (this._redoList.length === 0) return undefined;\n    return this._redoList[this._redoList.length - 1];\n  }\n\n  private get lastUndo(): UndoItem {\n    return this._undoList[this._undoList.length - 1];\n  }\n\n  private get scheme() {\n    return this._object.scheme;\n  }\n\n  /**\n   * Method is called after a local change has happened\n   * @param group\n   * @returns true if a new undo is added to the list\n   */\n  changedLocally(group: number) {\n    assert(group > 0, 'group must be larger than 0');\n\n    const snapshot = this._object.getSnapshot(this._snapshotFields);\n\n    if (snapshotEquals(this._latestSnapshot, snapshot, this._equalsOptions)) {\n      //Nothing changed from latest snapshot.\n      //We will update the last local undo\n      //But won't create a new undo\n\n      const lastLocal = this.lastLocalUndo;\n      lastLocal.snapshot = snapshot;\n      this._latestSnapshot = lastLocal.snapshot;\n\n      return false;\n    }\n\n    this.addToUndoList(snapshot, true, group, true);\n    this._latestSnapshot = snapshot;\n    return true;\n  }\n\n  /**\n   * Method is called after a remote change has happened\n   */\n  changedRemotely() {\n    const snapshot = this._object.getSnapshot(this._snapshotFields);\n    this.addToUndoList(snapshot, false, undefined, true);\n    this._latestSnapshot = snapshot;\n  }\n\n  private addToUndoList(\n    snapshot: VertexSnapshot,\n    local: boolean,\n    group: number | undefined,\n    resetRedoList: boolean\n  ) {\n    const last = this.lastUndo;\n\n    if (local) {\n      assert(group !== undefined);\n      group = group!;\n      if (last.type === UndoType.Local && last.group === group) {\n        //Undo with the same group\n        //Override last snapshot\n        last.snapshot = snapshot;\n      } else {\n        //Adding new local change\n        this._undoList.push({\n          type: UndoType.Local,\n          snapshot,\n          group,\n        });\n\n        this.ensureUndoSpace();\n      }\n\n      //resets the redo list\n      if (resetRedoList) this._redoList = [];\n    } else {\n      //Remote change\n      if (last.type === UndoType.Remote) {\n        //Override last item because keeping only one remote change between local\n        last.snapshot = snapshot;\n      } else {\n        //Add new remote change\n        this._undoList.push({\n          type: UndoType.Remote,\n          snapshot,\n        });\n\n        this.ensureUndoSpace();\n      }\n    }\n  }\n\n  /**\n   *\n   * @returns true if a undo has occurred\n   */\n  undo(): boolean {\n    const lastGroup = this.lastLocalUndo.group;\n    if (lastGroup === 0) {\n      //Initial state. nothing to undo\n      return false;\n    }\n\n    const snapList: VertexSnapshot[] = [];\n\n    this.internalUndo(lastGroup, snapList);\n\n    const last = snapList[snapList.length - 1];\n    if (last) {\n      this.updateSnapshot(last);\n      return true;\n    }\n\n    return false;\n  }\n\n  private updateSnapshot(newSnap: VertexSnapshot) {\n    this._latestSnapshot = newSnap;\n    this._object.updateBySnapshot(newSnap);\n  }\n\n  private internalUndo(group: number, snapList: VertexSnapshot[]): void {\n    const last = this.lastUndo;\n\n    if (last.type === UndoType.Local) {\n      if (last.group === 0) {\n        //Initial state. nothing to undo\n        return;\n      }\n      /**\n       * Local undo:\n       * 1. Remove from undo list\n       * 2. Add to redo list\n       * 3. update state with prev\n       */\n      this._undoList.splice(this._undoList.length - 1, 1);\n      const prevSnapshot = this.lastUndo.snapshot;\n      this._redoList.push({\n        snapshot: last.snapshot,\n        group: last.group,\n        base: prevSnapshot,\n      });\n      snapList.push(prevSnapshot);\n      return;\n    } else {\n      /**\n       * Remote Undo:\n       */\n\n      //1. get prev1 item. must be local\n      const prev1 = this._undoList[this._undoList.length - 2];\n\n      if (prev1.type === UndoType.Remote) {\n        throw new Error('remote undo, previous snapshot must be a local one');\n      }\n\n      if (prev1.group === 0) {\n        //1.1 prev is initial state. nothing to undo\n        return;\n      }\n\n      //2. get prev2 item. must exist\n      const prev2 = this._undoList[this._undoList.length - 3];\n      assert(prev2 !== undefined);\n\n      //3. 3 way merge: prev1 is base, prev2 and last are branches\n      const mergedSnapshot = this.threeWayMerge(\n        prev1.snapshot,\n        prev2.snapshot,\n        last.snapshot\n      );\n      if (snapshotEquals(mergedSnapshot, last.snapshot, this._equalsOptions)) {\n        //3.1 stale undo: has not changed current data\n        this._undoList.splice(this._undoList.length - 2, 1);\n        if (prev2.type === UndoType.Remote) {\n          //Need to merge remotes\n          prev2.snapshot = last.snapshot;\n          this._undoList.splice(this._undoList.length - 1, 1);\n        }\n\n        if (this.lastLocalUndo.group === group || snapList.length === 0) {\n          //3.2 rerun undo if:\n          //last local is in the same group\n          //or: dataList is empty, undo has not yet happened\n          this.internalUndo(group, snapList);\n          return;\n        }\n\n        //no need to rerun undo, return last result\n        return;\n      }\n\n      //4. add \"last\" to redo list\n      this._redoList.push({\n        snapshot: last.snapshot,\n        base: mergedSnapshot,\n        group: prev1.group,\n      });\n\n      //5. remove \"prev1\" and \"last\" from undo list\n      this._undoList.splice(this._undoList.length - 2, 2);\n\n      //6. add \"merged\" to undo list\n      this.addToUndoList(mergedSnapshot, false, undefined, false);\n\n      //7. update record state with \"merged\" data\n      snapList.push(mergedSnapshot);\n    }\n\n    if (this.lastLocalUndo.group === group) {\n      //Found another local undo that is the same group as the first undo\n      //Need to undo again\n      return this.internalUndo(group, snapList);\n    }\n  }\n\n  redo(): boolean {\n    if (this._redoList.length === 0) return false;\n\n    const snapList: VertexSnapshot[] = [];\n    this.internalRedo(snapList);\n    const last = snapList[snapList.length - 1];\n\n    if (last) {\n      this.updateSnapshot(last);\n      return true;\n    }\n\n    return false;\n  }\n\n  private internalRedo(snapList: VertexSnapshot[]): void {\n    const lastRedo = this._redoList[this._redoList.length - 1];\n    const lastGroup = lastRedo.group;\n\n    const lastUndo = this.lastUndo;\n\n    if (lastUndo.type === UndoType.Local) {\n      /**\n       * Simple Redo:\n       * 1. Add last redo data back to undo list\n       * 2. Update State with redo data\n       * 3. Remove last redo from list\n       */\n\n      this.addToUndoList(lastRedo.snapshot, true, lastRedo.group, false);\n\n      snapList.push(lastRedo.snapshot);\n\n      this._redoList.splice(this._redoList.length - 1, 1);\n    } else {\n      /**\n       * Complex Redo\n       */\n      const newRedoSnap = this.threeWayMerge(\n        lastRedo.base,\n        lastRedo.snapshot,\n        lastUndo.snapshot\n      );\n      if (snapshotEquals(newRedoSnap, lastUndo.snapshot, this._equalsOptions)) {\n        /**\n         * Stale Redo.\n         * Remove last redo\n         * restart redo process\n         */\n        this._redoList.splice(this._redoList.length - 1, 1);\n        this.internalRedo(snapList);\n        return;\n      }\n\n      this.addToUndoList(newRedoSnap, true, lastRedo.group, false);\n\n      snapList.push(newRedoSnap);\n\n      this._redoList.splice(this._redoList.length - 1, 1);\n    }\n\n    const lastAfter = this._redoList[this._redoList.length - 1];\n    if (lastAfter && lastAfter.group === lastGroup) {\n      //Found another redo that is the same group as this redo\n      //Need to redo again\n      this.internalRedo(snapList);\n    }\n\n    return;\n  }\n\n  private threeWayMerge(\n    base: VertexSnapshot,\n    snap1: VertexSnapshot,\n    snap2: VertexSnapshot\n  ): VertexSnapshot {\n    //Scheme data first\n    const baseClone = clone(this.scheme.fields, base.data);\n\n    const changes1 = diff(this.scheme.fields, baseClone, snap1.data);\n    const changes2 = diff(this.scheme.fields, baseClone, snap2.data);\n    const changes = concatChanges(changes1, changes2);\n\n    const newData = patch(this.scheme.fields, baseClone, changes);\n\n    //Local Data\n    const localFields = new Set<string>();\n    for (const key of Object.keys(base.local)) {\n      localFields.add(key);\n    }\n    for (const key of Object.keys(snap1.local)) {\n      localFields.add(key);\n    }\n    for (const key of Object.keys(snap2.local)) {\n      localFields.add(key);\n    }\n\n    const newLocal: CoreObject = {};\n    for (const field of localFields) {\n      const changes1 = TypeUtils.diff(base.local[field], snap1.local[field]);\n      const changes2 = TypeUtils.diff(base.local[field], snap2.local[field]);\n      const changes = TypeUtils.concatChanges(changes1, changes2);\n\n      newLocal[field] = TypeUtils.patch(base.local[field], changes);\n    }\n\n    return {\n      data: newData,\n      local: newLocal,\n    };\n  }\n\n  private ensureUndoSpace() {\n    if (this._undoList.length <= this._limit) return;\n\n    //Over limit, move up first;\n    let index = this._undoList.length - this._limit;\n    if (this._undoList[index].type !== UndoType.Local) {\n      index++; //This index is not local, so next index will be local\n    }\n\n    const item = ensureLocalItem(this._undoList[index]);\n\n    //Delete all of undo list before the index;\n    this._undoList.splice(0, index);\n\n    //Make item to be the new first item;\n    item.group = 0;\n  }\n}\n\nfunction ensureLocalItem(item: UndoItem): LocalUndo {\n  assert(item.type === UndoType.Local);\n  return item as LocalUndo;\n}\n\nfunction snapshotEquals(\n  snap1: VertexSnapshot,\n  snap2: VertexSnapshot,\n  options?: EqualOptions\n) {\n  if (!coreValueEquals(snap1.local, snap2.local, options)) {\n    return false;\n  }\n\n  if (!coreValueEquals(snap1.data, snap2.data, options)) {\n    return false;\n  }\n\n  return true;\n}\n", "import { EqualOptions } from '../../../base/core-types/equals.ts';\nimport { isRichText } from '../../richtext/tree.ts';\nimport { GraphManager } from '../graph/graph-manager.ts';\nimport { MutationPack, mutationPackHasRemote } from '../graph/mutations.ts';\nimport { IVertex, VertexSnapshot } from '../graph/types.ts';\nimport { VertexManager } from '../graph/vertex-manager.ts';\nimport { SingleUndoManager } from './single.ts';\n\nexport interface UndoContextOptions {\n  vertices?: UndoVertexOptions[];\n  filters?: UndoFilterOptions[];\n}\n\ninterface UndoVertexOptions {\n  keys: string[] | Iterable<string>;\n  filter?: (vertex: IVertex, mutations: MutationPack) => boolean;\n  limit?: number;\n  snapshotFields?: string[];\n}\n\ninterface UndoFilterOptions {\n  filter: (vertex: IVertex, mutations: MutationPack) => boolean;\n  limit?: number;\n  initialSnapshot?: VertexSnapshot;\n  snapshotFields?: string[];\n}\n\nconst equalsOptions: EqualOptions = {\n  objectFilterFields: (key, obj) => {\n    if (isRichText(obj)) {\n      return key !== 'pointers';\n    }\n    if (key === 'lastModified' && obj[key] instanceof Date) {\n      return false;\n    }\n    return true;\n  },\n};\n\n/**\n * A context of undo single managers.\n * e.g in the editor: note title + note body + each children title.\n */\nexport class UndoContext {\n  private _graph: GraphManager;\n  private _keyOptions: Map<string, UndoVertexOptions>;\n  private _filters: UndoFilterOptions[];\n  private _undoMap: Map<string, SingleUndoManager>;\n\n  private _curGroup: number;\n  private _groupStarted: boolean;\n\n  constructor(graph: GraphManager, options?: UndoContextOptions) {\n    this._graph = graph;\n\n    this._filters = options && options.filters ? options.filters : [];\n    this._keyOptions = new Map<string, UndoVertexOptions>();\n    this._undoMap = new Map<string, SingleUndoManager>();\n\n    this._curGroup = 1;\n    this._groupStarted = false;\n\n    if (options && options.vertices) {\n      for (const vOpt of options.vertices) {\n        for (const key of vOpt.keys) {\n          if (this._graph.hasVertex(key)) {\n            this._keyOptions.set(key, vOpt);\n            this._undoMap.set(\n              key,\n              new SingleUndoManager(this._graph.getVertexManager(key), {\n                limit: vOpt.limit,\n                equalsOptions,\n                snapshotFields: vOpt.snapshotFields,\n              })\n            );\n          } else {\n            throw new Error(`Undo Vertices key: ${key} is not found in graph`);\n          }\n        }\n      }\n    }\n  }\n\n  dispose(): void {\n    this._keyOptions.clear();\n    this._filters = [];\n    this._undoMap.clear();\n    this._graph.undoManager.removeContext(this);\n  }\n\n  update(mutations: [VertexManager, MutationPack][]) {\n    let changedLocally = false;\n    for (const [vMng, pack] of mutations) {\n      if (!this.isUpdateRelevant(vMng, pack)) continue;\n\n      const undoManager = this._undoMap.get(vMng.key);\n      if (undoManager === undefined) continue;\n\n      if (mutationPackHasRemote(pack)) {\n        undoManager.changedRemotely();\n      } else {\n        if (undoManager.changedLocally(this._curGroup)) {\n          changedLocally = true;\n        }\n      }\n    }\n\n    if (changedLocally) {\n      if (!this._groupStarted) this._curGroup++;\n    }\n  }\n\n  private isUpdateRelevant(vMng: VertexManager, pack: MutationPack) {\n    const keyOptions = this._keyOptions.get(vMng.key);\n    if (keyOptions) {\n      if (\n        !keyOptions.filter ||\n        keyOptions.filter(vMng.getVertexProxy(), pack)\n      ) {\n        return true;\n      }\n      return false;\n    }\n\n    for (const filter of this._filters) {\n      if (filter.filter(vMng.getVertexProxy(), pack)) {\n        if (!this._undoMap.has(vMng.key)) {\n          this._undoMap.set(\n            vMng.key,\n            new SingleUndoManager(this._graph.getVertexManager(vMng.key), {\n              limit: filter.limit,\n              equalsOptions,\n              initialSnapshot: filter.initialSnapshot,\n              snapshotFields: filter.snapshotFields,\n            })\n          );\n        }\n        this._keyOptions.set(vMng.key, {\n          keys: [vMng.key],\n          filter: filter.filter,\n          limit: filter.limit,\n          snapshotFields: filter.snapshotFields,\n        });\n        return true;\n      }\n    }\n    return false;\n  }\n\n  startGroup() {\n    this._groupStarted = true;\n    this._curGroup++;\n  }\n\n  endGroup() {\n    this._groupStarted = false;\n    this._curGroup++;\n  }\n\n  undo(): boolean {\n    //find max group\n    let maxGroup = 0;\n    for (const manager of this._undoMap.values()) {\n      const lastLocal = manager.lastLocalUndo;\n      if (lastLocal.group > maxGroup) maxGroup = lastLocal.group;\n    }\n\n    if (maxGroup === 0) return false; //No Undo to run\n\n    //Run Undo\n    let result = false;\n    for (const manager of this._undoMap.values()) {\n      if (manager.lastLocalUndo.group === maxGroup) {\n        if (manager.undo()) {\n          result = true;\n        }\n      }\n    }\n\n    this._curGroup++;\n\n    return result;\n  }\n\n  redo(): boolean {\n    //find max group\n    let maxGroup = 0;\n    for (const manager of this._undoMap.values()) {\n      const last = manager.lastRedo;\n      if (last && last.group > maxGroup) maxGroup = last.group;\n    }\n\n    if (maxGroup === 0) return false; //No Redo to run\n\n    //Run Undo\n    let result = false;\n    for (const manager of this._undoMap.values()) {\n      if (manager.lastRedo?.group === maxGroup) {\n        if (manager.redo()) {\n          result = true;\n        }\n      }\n    }\n\n    this._curGroup++;\n\n    return result;\n  }\n}\n", "import { GraphManager } from '../graph/graph-manager.ts';\nimport { MutationPack } from '../graph/mutations.ts';\nimport { VertexManager } from '../graph/vertex-manager.ts';\nimport { UndoContext, UndoContextOptions } from './context.ts';\n\nexport class UndoManager {\n  private _graph: GraphManager;\n  private _undoContexts: Set<UndoContext>;\n\n  constructor(graph: GraphManager) {\n    this._graph = graph;\n    this._undoContexts = new Set<UndoContext>();\n  }\n\n  createContext(options?: UndoContextOptions): UndoContext {\n    const context = new UndoContext(this._graph, options);\n    this._undoContexts.add(context);\n    return context;\n  }\n\n  removeContext(context: UndoContext): void {\n    this._undoContexts.delete(context);\n  }\n\n  update(mutations: [VertexManager, MutationPack][]) {\n    for (const context of this._undoContexts) {\n      context.update(mutations);\n    }\n  }\n}\n", "import { assert } from '../../base/error.ts';\nimport {\n  reconstructRichText,\n  flattenRichText,\n  FlatRepAtom,\n  DepthMarker,\n  isDepthMarker,\n} from './flat-rep.ts';\nimport {\n  isRefNode,\n  RefMarker,\n  RefNode,\n  RefType,\n  isRefMarker,\n} from './model.ts';\nimport {\n  ElementNode,\n  TextNode,\n  RichText,\n  dfs,\n  isElementNode,\n  isRichText,\n} from './tree.ts';\n\nexport enum RefPlaceholder {\n  Deleted,\n  Loading,\n}\n\n/**\n * A function that resolves a given ref value to RichText.\n */\nexport interface RefResolver {\n  (ref: string): RichText | RefPlaceholder;\n}\n\n/**\n * A function that writes an updated RichText value to a given reference.\n */\nexport interface RefUpdater {\n  (ref: string, rt: RichText): void;\n}\n\n/**\n * Converts all RefNode instances in the text to RefMarker elements.\n *\n * @param resolver A resolver function.\n * @param rt The text to convert.\n * @param local Include/exclude local tree elements.\n *\n * @returns A full RichText representation\n */\nexport function composeRichText(\n  resolver: RefResolver,\n  rt: RichText,\n  local = true\n): RichText {\n  // First, do a full tree scan and check if the composition will have pointers\n  // in it.\n  // if (compositeRichTextHasPointers(resolver, rt)) {\n  // If the result has pointers, we have no choice but to do a slow flat\n  // composition.\n  return reconstructRichText(composeFlatRichText(resolver, rt, local));\n  // }\n  // // If no pointers are found, we simply clone the tree and replace reference\n  // // nodes inline which is significantly faster than flat composition.\n  // const result: RichText = coreValueClone(rt);\n  // fastComposeRichTextTreeNoPointers(resolver, result.root);\n  // return result;\n}\n\nexport function decomposeRichText(\n  updater: RefUpdater,\n  rt: RichText,\n  local = true\n): RichText {\n  return reconstructRichText(decomposeFlatRichText(updater, rt, local));\n}\n\nfunction* composeFlatRichText(\n  resolver: RefResolver,\n  rt: RichText,\n  local: boolean\n): Generator<FlatRepAtom> {\n  let depth = 0;\n  for (const v of flattenRichText(rt, local, false)) {\n    if (isRefMarker(v)) {\n      const replacementRT = resolver(v.ref);\n      // Target is deleted. Skip this ref so it's also deleted in the composed\n      // result\n      if (replacementRT === RefPlaceholder.Deleted) {\n        continue;\n      }\n      // Target is loading. Spit a placeholder that works for Slate.\n      if (replacementRT === RefPlaceholder.Loading) {\n        yield {\n          ...v,\n          loading: true,\n          children: [],\n        } as RefMarker;\n        yield {\n          depthMarker: depth + 1,\n        } as DepthMarker;\n        yield {\n          text: '',\n        } as TextNode;\n        yield {\n          depthMarker: depth,\n        } as DepthMarker;\n        continue;\n      }\n      // Dynamically replace the ref marker with a RefNode element followed by\n      // the inner rich text contents\n      yield {\n        tagName: 'ref',\n        ref: v.ref,\n        type: v.type,\n        isLocal: v.isLocal === true,\n        children: [],\n      } as RefNode;\n      // Open a new level in the tree\n      yield {\n        depthMarker: depth + 1,\n      } as DepthMarker;\n      // Pass through all flat atoms of the resolved ref.\n      // Note: Replace flattenRichText() with a recursive call to\n      // composeRichText() if you wish to recursively resolve inner refs as well\n      for (const innerAtom of flattenRichText(replacementRT, local, false)) {\n        // Fixup inner depth markers' count\n        if (isDepthMarker(innerAtom)) {\n          yield {\n            depthMarker: depth + 1 + innerAtom.depthMarker,\n            isLocal: innerAtom.isLocal === true,\n          } as DepthMarker;\n        } else {\n          yield innerAtom;\n        }\n      }\n      // Close the tree level we opened\n      yield {\n        depthMarker: depth,\n      } as DepthMarker;\n    } else {\n      if (isDepthMarker(v)) {\n        depth = v.depthMarker;\n      }\n      yield v;\n    }\n  }\n}\n\nfunction fastComposeRichTextTreeNoPointers(\n  resolver: RefResolver,\n  parent: ElementNode\n): void {\n  const children = parent.children;\n  for (let idx = 0; idx < children.length; ++idx) {\n    const child = children[idx];\n    if (isElementNode(child)) {\n      fastComposeRichTextTreeNoPointers(resolver, child);\n    } else if (isRefMarker(child)) {\n      const replacementRT = resolver(child.ref);\n      if (replacementRT === RefPlaceholder.Deleted) {\n        // Target is deleted. Skip this ref so it's also deleted in the composed\n        // result\n        children.splice(idx, 1);\n        --idx;\n        continue;\n      } else if (replacementRT === RefPlaceholder.Loading) {\n        // Target is loading. Spit a placeholder that works for Slate.\n        children[idx] = {\n          tagName: 'ref',\n          type: child.type,\n          ref: child.ref,\n          loading: true,\n          isLocal: child.isLocal === true,\n          children: [\n            {\n              text: '',\n            },\n          ],\n        } as RefNode;\n      } else {\n        assert(\n          replacementRT.pointers === undefined ||\n            replacementRT.pointers.size === 0\n        );\n        // Dynamically replace the ref marker with a RefNode element followed by\n        // the inner rich text contents\n        children[idx] = {\n          tagName: 'ref',\n          ref: child.ref,\n          type: child.type,\n          isLocal: child.isLocal === true,\n          children: replacementRT.root.children,\n        } as RefNode;\n      }\n    }\n  }\n}\n\n/**\n * This function does a full tree scan and checks if the resulting composition\n * has pointers in it or not.\n * @param resolver A resolver function.\n * @param rt The base text.\n * @returns Whether the resulting composition has pointers or not.\n */\nfunction compositeRichTextHasPointers(\n  resolver: RefResolver,\n  rt: RichText\n): boolean {\n  if (rt.pointers !== undefined && rt.pointers.size > 0) {\n    return true;\n  }\n  for (const [node] of dfs(rt.root)) {\n    if (isRefMarker(node)) {\n      const replacementRT = resolver(node.ref);\n      if (\n        isRichText(replacementRT) &&\n        replacementRT.pointers !== undefined &&\n        replacementRT.pointers.size > 0\n      ) {\n        return true;\n      }\n    }\n  }\n  return false;\n}\n\nfunction* decomposeFlatRichText(\n  updater: RefUpdater,\n  rt: RichText,\n  local: boolean\n): Generator<FlatRepAtom> {\n  let depth = 0;\n  const flatRepGenerator = flattenRichText(rt, local, false);\n  for (let atom of flatRepGenerator) {\n    // Dynamically replace RefNode elements with a RefMarker leaf, while\n    // updating the subtree at the relevant target\n    if (isRefNode(atom)) {\n      yield _updateLinkedDoc(\n        updater,\n        atom.ref,\n        flatRepGenerator,\n        depth,\n        atom.isLocal === true\n      );\n    } else if (isRefMarker(atom)) {\n      // Clean the loading flag from ref markers\n      const copy: RefMarker = {\n        ref: atom.ref,\n        type: atom.type,\n      };\n      if (atom.isLocal) {\n        copy.isLocal = true;\n      }\n      yield copy;\n    } else {\n      // Keep track of current depth\n      if (isDepthMarker(atom)) {\n        depth = atom.depthMarker;\n      }\n      yield atom;\n    }\n  }\n}\n\nfunction _updateLinkedDoc(\n  updater: RefUpdater,\n  key: string,\n  flatRepGenerator: Iterator<FlatRepAtom>,\n  markerDepth: number,\n  local: boolean\n): RefMarker {\n  const innerAtoms: FlatRepAtom[] = [];\n  // Fast forward our flat rep until we reach the end of this ref element\n  let { value: innerAtm, done } = flatRepGenerator.next();\n  while (!done) {\n    if (isDepthMarker(innerAtm) && innerAtm.depthMarker <= markerDepth) {\n      // Reached a depth marker outside our parent.\n      // Apply updates\n      break;\n    } else {\n      // All inner atoms (including depth markers) pass unmodified.\n      // Inner nodes will naturally collapse into the root of the target.\n      innerAtoms.push(innerAtm);\n    }\n    const next = flatRepGenerator.next();\n    innerAtm = next.value;\n    done = next.done;\n  }\n\n  updater(key, reconstructRichText(innerAtoms));\n  // Generate a RefMarker\n  const refMarker: RefMarker = {\n    ref: key,\n    type: RefType.InternalDoc,\n  };\n  if (local) {\n    refMarker.isLocal = true;\n  }\n  return refMarker;\n}\n\nexport function extractRefs(\n  root: ElementNode,\n  local: boolean,\n  outSet?: Set<string>\n): Set<string> {\n  if (outSet === undefined) {\n    outSet = new Set();\n  }\n  for (const [node] of dfs(root)) {\n    if (node.isLocal === true && !local) {\n      continue;\n    }\n    if (isRefMarker(node) || isRefNode(node)) {\n      outSet.add(node.ref);\n    }\n  }\n  return outSet;\n}\n\n/**\n * <p>\n * <span>\n * <h1>\n * <h2>\n * <ul>\n * <ol>\n * <li>\n * <ref>\n * <img>\n * <table>\n * <tr>\n * <td>\n */\n", "/**\n * This file contains a set of common field triggers that can be installed\n * on specific Vertex fields.\n */\nimport { assert } from '../../../base/error.ts';\nimport { SchemeNamespace } from '../../base/scheme-types.ts';\nimport { CoreValue } from '../../../base/core-types/index.ts';\nimport { Mutation, MutationPack, mutationPackIsEmpty } from './mutations.ts';\nimport { FieldChangeTrigger, Vertex } from './vertex.ts';\n\n/**\n * An interface of a method that gets called in response to a neighboring\n * vertex's field mutation.\n */\nexport interface NeighborDidMutateCallback {\n  /**\n   * @param local Whether the change is local or remote.\n   * @param oldValue The old value of the field that triggered this change\n   *                 in the neighboring vertex.\n   * @param neighbor The neighbor that changed.\n   *\n   * @requires MutationPack A mutation pack with side effects of this.\n   */\n  (local: boolean, oldValue: CoreValue, neighbor: Vertex): MutationPack;\n}\n\n/**\n * Assuming two vertices P and C, where P is the parent of C, this function\n * returns a trigger that can be installed on C's field change. This trigger\n * will invoke P.vertCallback() whenever C mutates.\n *\n * @param vertCallback A method name on the parent vertex that conforms to\n *                     NeighborDidMutateCallback.\n * @param parentScheme An optional scheme that the parent must match in order\n *                     for the trigger to fire.\n *\n * @returns A field trigger function that propagates the vertex's mutation to\n *          its parent.\n */\nexport function triggerParent<T extends Vertex>(\n  vertCallback: keyof T,\n  parentScheme?: SchemeNamespace\n): FieldChangeTrigger<T> {\n  return (vert: T, mutation: Mutation) => {\n    const parent = vert.parent as T | undefined;\n    if (\n      parent !== undefined &&\n      (parentScheme === undefined ||\n        parent.manager.scheme.namespace === parentScheme)\n    ) {\n      const callback: NeighborDidMutateCallback = parent[vertCallback] as any;\n      assert(\n        callback !== undefined,\n        `Parent mutation handler '${String(\n          vertCallback\n        )}' does not exist on vertex of type '${vert.namespace}'`\n      );\n      const sideEffects = callback.call(parent, mutation[1], mutation[2], vert);\n      if (!mutationPackIsEmpty(sideEffects)) {\n        parent.manager.vertexDidMutate(sideEffects);\n      }\n    }\n  };\n}\n\n/**\n * Assuming two vertices P and C, where P is the parent of C, this function\n * returns a trigger that can be installed on P's field change. This trigger\n * will invoke C.vertCallback() on each of P's children..\n *\n * @param vertCallback A method name on the child vertex that conforms to\n *                     NeighborDidMutateCallback.\n * @param childScheme  An optional scheme that the a child must match in order\n *                     for the trigger to fire. Only children that match the\n *                     scheme will receive the trigger.\n *\n * @returns A field trigger function that propagates the vertex's mutation to\n *          its children.\n */\nexport function triggerChildren<T extends Vertex>(\n  vertCallback: keyof T,\n  childScheme?: SchemeNamespace\n): FieldChangeTrigger<T> {\n  return (vert: T, mutation: Mutation) => {\n    for (const [child] of vert.inEdges('parent')) {\n      // Skip children that don't match the provided scheme\n      if (\n        childScheme !== undefined &&\n        child.manager.scheme.namespace !== childScheme\n      ) {\n        continue;\n      }\n      const callback: NeighborDidMutateCallback = (child as T)[\n        vertCallback\n      ] as any;\n      assert(\n        callback !== undefined,\n        `Parent mutation handler '${String(\n          vertCallback\n        )}' does not exist on vertex of type '${vert.namespace}'`\n      );\n      const sideEffects = callback.call(child, mutation[1], mutation[2], vert);\n      if (!mutationPackIsEmpty(sideEffects)) {\n        child.manager.vertexDidMutate(sideEffects);\n      }\n    }\n  };\n}\n\n/**\n * Given two field triggers `t1` and `t2`, this function creates and returns a\n * composite trigger that fires both triggers one after the other.\n * @param t1 First trigger.\n * @param t2 Second trigger.\n * @returns A composite trigger.\n */\nexport function triggerCompose<T extends Vertex>(\n  t1: FieldChangeTrigger<T>,\n  t2: FieldChangeTrigger<T>\n): FieldChangeTrigger<T> {\n  return (vert: T, mutation: Mutation) => {\n    t1(vert, mutation);\n    t2(vert, mutation);\n  };\n}\n", "import { Record } from '../../base/record.ts';\nimport { VertexManager } from './vertex-manager.ts';\nimport { GraphManager } from './graph-manager.ts';\nimport {\n  Dictionary,\n  isDictionary,\n  ReadonlyDict,\n} from '../../../base/collections/dict.ts';\nimport {\n  MutationPack,\n  mutationPackIsEmpty,\n  mutationPackGetFirst,\n  mutationPackAppend,\n  mutationPackDeleteFirst,\n  mutationPackClone,\n  Mutation,\n  mutationPackIter,\n} from './mutations.ts';\nimport { IVertex } from './types.ts';\nimport {\n  Comparable,\n  CoreObject,\n  CoreValue,\n  CoreValueCloneOpts,\n  coreValueCompare,\n} from '../../../base/core-types/index.ts';\nimport { extractRefs as extractRefsFromRT } from '../../richtext/composer.ts';\nimport { RichText, isRichText } from '../../richtext/tree.ts';\nimport { isGenerator } from '../../../base/comparisons.ts';\nimport { assert, notImplemented } from '../../../base/error.ts';\nimport { DataType, SchemeNamespace } from '../../base/scheme-types.ts';\nimport { triggerChildren, triggerCompose } from './propagation-triggers.ts';\nimport { ValueType } from '../../base/types/index.ts';\n\n/**\n * A marker for VertexManager indicating a specific field contains no refs by\n * definition. This enables some optimizations in the maintenance of the graph.\n */\nexport const kNoRefsValue = {};\n\n/**\n * A field trigger is a generic hook for inserting custom behavior on specific\n * field changes.\n */\nexport type FieldChangeTrigger<T extends Vertex> = (\n  src: T,\n  mutation: Mutation\n) => void;\n\nexport type MutableFieldTriggers<T extends Vertex> = {\n  [key in keyof T]?: FieldChangeTrigger<T>;\n};\n\n/**\n * A mapping between field name and a single trigger.\n */\nexport type FieldTriggers<T extends Vertex, DT extends Vertex = T> = {\n  readonly [key in keyof T]?: FieldChangeTrigger<DT>;\n};\n\ntype VertCls<V extends Vertex = Vertex> = {\n  new (\n    mgr: VertexManager<V>,\n    record: Record,\n    prevVertex: Vertex | undefined,\n    config: VertexConfig\n  ): V;\n};\n\nexport interface VertexConfig {\n  isLocal?: boolean;\n}\n\nexport type VertexId<T extends Vertex = Vertex> = T | string | VertexManager<T>;\n\nexport function KeyFromVertexId<T extends Vertex>(id: VertexId<T>): string {\n  return typeof id === 'string' ? id : id.key;\n}\n\n/**\n * WARNING: All mutable properties must be of type `CoreValue`. If you\n * use a custom class than implement the `Comparable` interface on it. If you\n * need a different, unsupported, primitive then please extend `CoreValue`\n * to support it.\n */\nexport class Vertex implements IVertex, Comparable {\n  private static readonly _fieldTriggersByClass = new Map<\n    VertCls,\n    FieldTriggers<Vertex>\n  >();\n\n  private static _didFinalizeFieldTriggers = false;\n\n  private _cachedDepth: number;\n\n  private readonly _manager: VertexManager<this>;\n  private readonly _record: Record;\n  private _isLocal: boolean;\n  public isDemoData: boolean;\n\n  static registerFieldTriggers(\n    cls: VertCls,\n    triggers: FieldTriggers<any>\n  ): void {\n    assert(!this._didFinalizeFieldTriggers);\n    this._fieldTriggersByClass.set(cls, triggers);\n  }\n\n  /**\n   * Given a subclass of Vertex, this method returns an array of super classes\n   * excluding Vertex. This method is a utility for constructing a full map of\n   * field triggers per class (that respects triggers installed by super\n   * classes).\n   *\n   * @param src The class to look up.\n   * @returns An array of classes in the form of [src, ...] where Vertex is\n   *          excluded from the result.\n   */\n  private static _getVertexClasses(src: VertCls): VertCls[] {\n    const result: VertCls[] = [Vertex];\n    while (src !== Vertex) {\n      result.push(src);\n      src = Object.getPrototypeOf(src);\n    }\n    return result;\n  }\n\n  /**\n   * Given a class and triggers per class, this method composes a triggers map\n   * that takes into account triggers installed by super classes.\n   *\n   * @param rawTriggers\n   * @param src\n   * @returns\n   */\n  private static _finalizeFieldTriggersForClass(\n    rawTriggers: Map<VertCls, FieldTriggers<Vertex>>,\n    src: VertCls\n  ): FieldTriggers<any> {\n    const classHierarchy = this._getVertexClasses(src);\n    const result: MutableFieldTriggers<any> = {};\n    // The class hierarchy is ordered from subclass to superclass. We scan it\n    // from super to sub, and compose triggers as we go.\n    for (let i = classHierarchy.length - 1; i >= 0; --i) {\n      const triggers = rawTriggers.get(classHierarchy[i]);\n      // Skip classes that have no triggers installed for them\n      if (triggers === undefined) {\n        continue;\n      }\n      for (const [fieldName, func] of Object.entries(triggers)) {\n        // If a trigger was already installed installed by a superclass, we\n        // run it before running the subclass's trigger\n        // deno-lint-ignore no-prototype-builtins\n        if (result.hasOwnProperty(fieldName)) {\n          result[fieldName] = triggerCompose(result[fieldName]!, func);\n        } else {\n          result[fieldName] = func;\n        }\n      }\n    }\n    return result;\n  }\n\n  private static _finalizeFieldTriggersIfNeeded(): void {\n    if (this._didFinalizeFieldTriggers) {\n      return;\n    }\n    const rawTriggers = this._fieldTriggersByClass;\n    const finalizedTriggers = new Map<VertCls, FieldTriggers<Vertex>>();\n\n    for (const cls of rawTriggers.keys()) {\n      finalizedTriggers.set(\n        cls,\n        this._finalizeFieldTriggersForClass(rawTriggers, cls)\n      );\n    }\n\n    // Overwrite raw triggers with our composite triggers\n    for (const [cls, triggers] of finalizedTriggers) {\n      rawTriggers.set(cls, triggers);\n    }\n    this._didFinalizeFieldTriggers = true;\n  }\n\n  constructor(\n    mgr: VertexManager,\n    record: Record,\n    prevVertex: Vertex | undefined,\n    config: VertexConfig | undefined\n  ) {\n    this._manager = mgr as VertexManager<this>;\n    this._record = record;\n    this._cachedDepth = -1;\n    this._isLocal =\n      prevVertex !== undefined ? prevVertex._isLocal : config?.isLocal === true;\n    this.isDemoData = prevVertex !== undefined ? prevVertex.isDemoData : false;\n  }\n\n  get manager(): VertexManager<this> {\n    return this._manager;\n  }\n\n  get record() {\n    return this._record;\n  }\n\n  get key(): string {\n    return this._manager.key;\n  }\n\n  get isNull() {\n    return this.record.isNull;\n  }\n\n  // Static value. Does not change during the lifetime of a vertex.\n  get isRoot() {\n    return this.manager.isRoot;\n  }\n\n  get hasPendingChanges() {\n    return this.manager.hasPendingChanges;\n  }\n\n  get namespace(): string {\n    return this._record.scheme.namespace;\n  }\n\n  get graph(): GraphManager {\n    return this._manager.graph;\n  }\n\n  get outRefs(): Set<string> {\n    return this._record.refs;\n  }\n\n  get isDeleted(): number {\n    return 0;\n  }\n\n  set isDeleted(_val: number) {\n    notImplemented();\n  }\n\n  get lastModified(): Date | undefined {\n    return undefined;\n  }\n\n  set lastModified(v: Date | undefined) {\n    notImplemented();\n  }\n\n  get depth(): number {\n    if (this._cachedDepth < 0) {\n      const parent = this.parent;\n      this._cachedDepth = parent === undefined ? 0 : parent.depth + 1;\n    }\n    return this._cachedDepth;\n  }\n\n  get isLocal(): boolean {\n    return this._isLocal || this.parent?.isLocal === true;\n  }\n\n  set isLocal(flag: boolean) {\n    this._isLocal = flag;\n  }\n  parentDidMutate(\n    local: boolean,\n    oldValue: Vertex | undefined,\n    neighbor: Vertex\n  ): MutationPack {\n    this._cachedDepth = -1;\n    return ['depth', local, oldValue === undefined ? 0 : oldValue.depth + 1];\n  }\n\n  get parent(): Vertex | undefined {\n    return undefined;\n  }\n\n  *getChildren<T extends Vertex>(ns?: SchemeNamespace): Generator<T> {\n    for (const [vert] of this.inEdges('parent')) {\n      if (ns === undefined || vert.manager.scheme.namespace === ns) {\n        yield vert as T;\n      }\n    }\n  }\n\n  diffKeys(other: Vertex, local: boolean): string[] {\n    return this._record.diffKeys(other.record, local);\n  }\n\n  cloneData(onlyFields?: string[]): DataType {\n    return this._record.cloneData(onlyFields);\n  }\n\n  isEqual(v: IVertex | undefined): boolean {\n    if (v === undefined) {\n      return false;\n    }\n    return this.key === v.key;\n  }\n\n  isRecordEqual(v: Vertex, local?: boolean): boolean {\n    return this._record.isEqual(v.record, local);\n  }\n\n  compare(other: IVertex): number {\n    return coreValueCompare(this.key, other.key);\n  }\n\n  *inEdges(fieldName?: string): Generator<[vertex: Vertex, fieldName: string]> {\n    const graph = this.graph;\n    for (const edge of graph.adjacencyList.inEdges(this.key, fieldName)) {\n      yield [graph.getVertex(edge.vertex), edge.fieldName];\n    }\n  }\n\n  *outEdges(\n    fieldName?: string\n  ): Generator<[vertex: Vertex, fieldName: string]> {\n    const graph = this.graph;\n    for (const edge of graph.adjacencyList.outEdges(this.key, fieldName)) {\n      yield [graph.getVertex(edge.vertex), edge.fieldName];\n    }\n  }\n\n  /******************************************************************\n   ******************* Methods for VertexManager *******************\n   ******************************************************************/\n\n  // WARNING: Never change a vertex manager's scheme inside this callback.\n  didMutate(pack: MutationPack): MutationPack {\n    const result = this._dispatchMutationCallback(pack);\n    this._runFieldTriggers(pack);\n    return result;\n  }\n\n  private _dispatchMutationCallback(pack: MutationPack): MutationPack {\n    let result: MutationPack;\n    let remainingMutations = mutationPackClone(pack);\n\n    while (!mutationPackIsEmpty(remainingMutations)) {\n      const [fieldName, local, oldValue] =\n        mutationPackGetFirst(remainingMutations)!;\n      const handlerName = getDidMutateMethodName(fieldName);\n      if (typeof (this as any)[handlerName] === 'function') {\n        result = mutationPackAppend(\n          result,\n          (this as any)[handlerName](local, oldValue)\n        );\n      }\n      remainingMutations = mutationPackDeleteFirst(remainingMutations);\n    }\n    return result;\n  }\n\n  private _runFieldTriggers(pack: MutationPack): void {\n    Vertex._finalizeFieldTriggersIfNeeded();\n    const triggers = Vertex._fieldTriggersByClass.get(\n      this.constructor as VertCls\n    );\n    if (triggers === undefined) {\n      return;\n    }\n    for (const mutation of mutationPackIter(pack)) {\n      const callback = triggers[mutation[0] as keyof Vertex];\n      if (typeof callback === 'function') {\n        callback(this, mutation);\n      }\n    }\n  }\n\n  clone(opts?: CoreValueCloneOpts): IVertex {\n    return this;\n  }\n\n  getLocalFields() {\n    const fields: string[] = [];\n\n    let proto = Object.getPrototypeOf(this);\n    while (proto.__proto__.constructor !== Object) {\n      const descriptors = Object.getOwnPropertyDescriptors(proto);\n      for (const key in descriptors) {\n        const desc = descriptors[key];\n        if (desc.get && desc.set && !this._record.scheme.hasField(key)) {\n          fields.push(key);\n        }\n      }\n      proto = Object.getPrototypeOf(proto);\n    }\n\n    for (const key in this) {\n      if (this.hasOwnProperty(key)) {\n        if (!key.startsWith('_') && !this._record.scheme.hasField(key)) {\n          fields.push(key);\n        }\n      }\n    }\n\n    return fields;\n  }\n\n  onUserUpdatedField(mut: MutationPack): MutationPack {\n    return mut;\n  }\n\n  /******************************************************************\n   ********************* Methods for Subclasses *********************\n   ******************************************************************/\n\n  /**\n   * Called by this vertex's manager to ge the current value of a field for\n   * the purpose of ref calculation. This hook allows subclasses to include\n   * computed fields in ref calculations, as well as provide an alternative raw\n   * value to avoid unneeded computations.\n   *\n   * Example use cases:\n   * - `Note` uses this hook to avoid slow composition on the `body` field.\n   * - `BaseVertex` uses this hook to include the computed `parent` field in\n   *   ref computations.\n   *\n   * @param fieldName The field's name.\n   * @returns The field's current value.\n   */\n  valueForRefCalc(fieldName: keyof this): any {\n    const scheme = this.manager.scheme;\n    if (scheme.hasField(fieldName as string)) {\n      if (scheme.getFieldType(fieldName as string) === ValueType.RICHTEXT_V3) {\n        return this.record.get(fieldName as string);\n      }\n      return this[fieldName as keyof this];\n    }\n    return kNoRefsValue;\n  }\n\n  /**\n   * An override point for subclasses to customize mutation behaviors.\n   * Subclasses should return a (constant) map from field name to trigger\n   * functions.\n   * @returns A set of triggers for this instance\n   */\n  protected getFieldTriggers(): FieldTriggers<any> {\n    return {};\n  }\n\n  protected volatileDataFields(): string[] {\n    return [];\n  }\n\n  parentIsLocalChanged(\n    local: boolean,\n    oldValue: boolean,\n    parent: Vertex\n  ): MutationPack {\n    if (!this._isLocal) {\n      return ['isLocal', local, oldValue];\n    }\n  }\n\n  protected vertSetForField<T extends Vertex>(fieldName: string): Set<T> {\n    const keys = this.record.get<Set<string>>(fieldName);\n    if (!keys?.size) {\n      return new Set();\n    }\n\n    const graph = this.graph;\n    const result = new Set<T>();\n    for (const k of keys) {\n      const vert = graph.getVertex<T>(k);\n      if (vert && !vert.isDeleted) {\n        result.add(vert);\n      }\n    }\n    return result;\n  }\n}\n\nconst kFieldTriggersBase: FieldTriggers<Vertex> = {\n  isLocal: triggerChildren<Vertex>('parentIsLocalChanged'),\n};\n\nVertex.registerFieldTriggers(Vertex, kFieldTriggersBase);\n\nconst gCachedDidMutateNames = new Map<string, string>();\n\nfunction getDidMutateMethodName(fieldName: string): string {\n  let result = gCachedDidMutateNames.get(fieldName);\n  if (result === undefined) {\n    result = fieldName + 'DidMutate';\n    gCachedDidMutateNames.set(fieldName, result);\n  }\n  return result;\n}\n\nexport function keyDictToVertDict<K extends Vertex, V extends Vertex>(\n  graph: GraphManager,\n  keyDict: ReadonlyDict<string, string>\n): Dictionary<K, V> {\n  const result = new Map<K, V>();\n  for (const [k, v] of keyDict) {\n    result.set(graph.getVertex(k), graph.getVertex(v));\n  }\n  return result;\n}\n\nexport function vertDictToKeyDict(\n  vertDict: ReadonlyDict<Vertex, Vertex>\n): Dictionary<string, string> {\n  const result = new Map<string, string>();\n  for (const [k, v] of vertDict) {\n    result.set(k.key, v.key);\n  }\n  return result;\n}\n\n/**\n * Given a value, this function extracts any references from it. Currently it\n * handles Vertex instances, containers of Vertices as well as references\n * inside RichText. Other values are treated as have no refs in them.\n *\n * @param value The value to extract refs from.\n * @param local Whether to include or ignore local refs (in rich text).\n * @returns A set of string keys referencing other vertices.\n */\nexport function extractFieldRefs(\n  value:\n    | Vertex\n    | Iterable<Vertex>\n    | Dictionary<Vertex, Vertex>\n    | Set<Vertex>\n    | RichText\n    | CoreValue,\n  local: boolean\n): Set<string> {\n  const result = new Set<string>();\n  if (value === undefined) {\n    return result;\n  }\n  if (value instanceof Vertex) {\n    result.add(value.key);\n    return result;\n  }\n  if (isDictionary(value)) {\n    for (const [k, v] of value) {\n      if (k instanceof Vertex && v instanceof Vertex) {\n        result.add(k.key);\n        result.add(v.key);\n      }\n    }\n    return result;\n  }\n  if (isRichText(value as CoreValue)) {\n    return extractRefsFromRT((value as RichText).root, local, result);\n  }\n  assert(!isGenerator(value)); // Sanity check\n  if ((value as any)[Symbol.iterator] !== undefined) {\n    for (const vert of value as Iterable<Vertex>) {\n      if (vert instanceof Vertex) {\n        result.add(vert.key);\n      }\n    }\n    return result;\n  }\n  return result;\n}\n", "import { assert } from './error.ts';\n\nexport function splice(\n  str: string,\n  start: number,\n  delCount: number,\n  newSubStr: string\n): string {\n  return (\n    str.slice(0, start) + newSubStr + str.slice(start + Math.abs(delCount))\n  );\n}\n\nexport function commonPrefixLen(str1: string, str2: string): number {\n  const len = Math.min(str1.length, str2.length);\n  let end = 0;\n  for (; end < len; ++end) {\n    if (str1[end] !== str2[end]) {\n      break;\n    }\n  }\n  return end;\n}\n\nexport function commonSuffixLen(str1: string, str2: string): number {\n  let idx1 = str1.length - 1;\n  let idx2 = str2.length - 1;\n  let count = 0;\n  while (idx1 >= 0 && idx2 >= 0) {\n    if (str1[idx1] !== str2[idx2]) {\n      break;\n    }\n    ++count;\n    --idx1;\n    --idx2;\n  }\n  return count;\n}\n\n/**\n * Given an expected text and a user input, this functions calculates a boost\n * value between [0, 2.0] based on character similarity.\n */\nfunction letterBoost(expected: string, input: string): number {\n  const origChars = new Set(expected);\n  let correctCount = 0;\n  let wrongCount = 0;\n  for (const c of input) {\n    if (origChars.has(c)) {\n      ++correctCount;\n    } else {\n      ++wrongCount;\n    }\n  }\n  return 1.0 + (correctCount - wrongCount) / origChars.size;\n}\n\n/**\n * Given a string and an index, this function returns the char code at the\n * given index, plus one index before/after it in the case of a unicode\n * surrogate pairs.\n *\n * Shamelessly taken from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/charCodeAt\n *\n * @param str The string to extract from.\n * @param idx The index of the requested code.\n * @returns A fixed char code.\n */\nexport function fixedCharCodeAt(str: string, idx: number): number {\n  if (idx < 0 || idx >= str.length) {\n    return 0;\n  }\n  const code = str.charCodeAt(idx);\n  // High surrogate (could change last hex to 0xDB7F to treat high private\n  // surrogates as single characters)\n  if (0xd800 <= code && code <= 0xdbff) {\n    const hi = code;\n    const low = str.charCodeAt(idx + 1);\n    assert(\n      !isNaN(low),\n      'High surrogate not followed by low surrogate in fixedCharCodeAt()'\n    );\n    return (hi - 0xd800) * 0x400 + (low - 0xdc00) + 0x10000;\n  }\n  if (0xdc00 <= code && code <= 0xdfff) {\n    // Low surrogate\n    // We return false to allow loops to skip this iteration since should have\n    // already handled high surrogate above in the previous iteration\n    const hi = str.charCodeAt(idx - 1);\n    const low = code;\n    return (hi - 0xd800) * 0x400 + (low - 0xdc00) + 0x10000;\n  }\n  return code;\n}\n\n/**\n * Given a string, this function returns a new string, that's lexicographically\n * greater by 1. That means, it'll compare greater than the given string, and\n * no other string can be inserted between the input and the result.\n *\n * @param str The input string.\n * @returns A string that compares greater by 1.\n */\nexport function increment(str: string): string {\n  const code = fixedCharCodeAt(str, str.length - 1);\n  // 0x10FFFF is the highest code point encodable to UTF-16. If the last char\n  // is lesser than it, we can simply increment it\n  if (code < 0x10ffff) {\n    return str.substring(0, str.length - 1) + String.fromCodePoint(code + 1);\n  }\n  // Can't increment last character, so must add a character\n  return str + String.fromCharCode(1);\n}\n\n/**\n * Given a string, this function returns a new string, that's lexicographically\n * lesser by 1. That means, it'll compare less than the given string, and\n * no other string can be inserted between the input and the result.\n *\n * @param str The input string.\n * @returns A string that compares smaller by 1.\n */\nexport function decrement(str: string): string {\n  const code = fixedCharCodeAt(str, str.length - 1);\n  // If our last character is already the lowest value, we must shorten the\n  // string.\n  if (code < 1) {\n    return str.length > 1 ? str.substring(0, str.length - 1) : '';\n  }\n  // Decrement the last character if we can\n  return str + String.fromCharCode(code - 1);\n}\n\nexport function appendPathComponent(path: string, ...comps: string[]): string {\n  for (const c of comps) {\n    if (path.endsWith('/') || c.startsWith('/')) {\n      path += c;\n    } else {\n      path = `${path}/${c}`;\n    }\n  }\n  return path;\n}\n\nconst ltrChars =\n  'A-Za-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02B8\\u0300-\\u0590\\u0800-\\u1FFF' +\n  '\\u2C00-\\uFB1C\\uFDFE-\\uFE6F\\uFEFD-\\uFFFF';\nconst rtlChars = '\\u0591-\\u07FF\\uFB1D-\\uFDFD\\uFE70-\\uFEFC';\nconst dirRegex = new RegExp('^[^' + ltrChars + ']*[' + rtlChars + ']');\n\nexport function isRTL(s: string): boolean {\n  return dirRegex.test(s);\n}\n", "/**\n * Order (Sort) stamps are our solution to efficiently ordering semi-related\n * items in a collaborative environment. Typically there are two ways to\n * implement ordered lists over a backing database:\n *\n * 1. Store the entire list as a single row. Each write overwrites the entire\n *    list, thus ensuring correct order of list items when multiple writers\n *    exist.\n *\n * 2. Store each list item as its own row, with an integer order column\n *    representing the index of this item in the list. Writers need to update\n *    all following indexes to account for insertions and deletions, resulting\n *    in O(N) update costs.\n *\n * Aside from performance issues, both of these approaches are fundamentally\n * incompatible with the way Ovvio works. In Ovvio, the user may look at a\n * filtered list (sub-list) containing only a sub set of the items. Then,\n * reorder them, and return back to the full, original, list. Handling the order\n * of filter'ed out items is really hard to get right.\n *\n * Instead, we take a different approach borrowing ideas from CRDTs\n * (Conflict-Free Replicated Datastructures). Our algorithm first models our\n * list as individual items with their positions as a field, similar to the\n * second approach above. However, instead of integer positions, we're using\n * arbitrary numbers (real, not integers).\n *\n * List Insertion at index I:\n * 1. Look at the item above and below I (I-1 and I+1).\n *\n * 2. Compute their average position (position, not index), then shift the\n *    result randomly to one side without crossing the neighboring values (to\n *    avoid conflicts in concurrent inserts).\n *\n * 3. Set the result as the position of the new item.\n *\n * 4. Ensure all readers sort their visible items to account for the new\n *    insertion.\n *\n * Example:\n * List = [(\"A\", 0), (\"B\", 1)]\n * Insert(\"C\", 1) => [(\"A\", 0), (\"C\", 0.5 + RND1), (\"B\", 1)]\n *\n * This approach has several key advantages:\n * - Writes are O(1) and touch only the modified items in the list.\n *\n * - Multiple writers may change the list concurrently without conflicting with\n *   each other. Simply apply a Last-Write Wins policy at the item level.\n *\n * - Relative item order is properly preserved even when viewing and editing\n *   a subset of the original list. For example, if we filter out \"C\" from the\n *   example above, then execute\n *\n *   Insert(\"D\", 1) => [(\"A\", 0), (\"D\", 0.5 + RND2), (\"B\", 1)]\n *\n *   Finally look at the unfiltered result:\n *   [(\"A\", 0), (\"C\", 0.5 + RND1), (\"D\", 0.5 + RND2) (\"B\", 1)]\n *\n *   NOTE: The order between \"C\" and \"D\" is indeterminate.\n *\n * While this works, it has major one flaw that makes it impractical in the real\n * world. Numbers in most environments have limited precision (64 bits usually),\n * thus limiting the number of divisions we can do before we converge to zero.\n *\n * To void this issue without requiring big number support, we use strings\n * instead of values, and assume lexicographical order between them. This file\n * implements a bunch of utility functions that implement the above logic using\n * strings.\n *\n * For easier compatibility with the outside world, we also support conversion\n * of arbitrary numbers to strings using the Efficient Lexicographic Encoding\n * of Numbers algorithm (ELEN) by Peter Seymour). Using this technique we\n * naturally create lists that are initially ordered, but can be modified to\n * whatever order the user wants.\n */\nimport * as ELEN from 'https://esm.sh/elen@1.0.10';\nimport { commonPrefixLen } from '../../base/string.ts';\nimport { assert } from '../../base/error.ts';\nimport { randomInt } from '../../base/math.ts';\nimport { serializeDate } from '../../base/date.ts';\nimport { uniqueId } from '../../base/common.ts';\n\nconst CHAR_CODE_MIN = 1; // Skip the null character to avoid possible problems\n// Note: Theoretically we can use the entire UTF-16 character space, however\n// some parts of our pipeline can't handle higher value characters properly\n// so we're sticking to single byte characters\n\nconst CHAR_CODE_MAX = 254; // Exclusive. Reserves char 254 for right edge\n\n// Increase this value if there are many concurrent writers\nconst RANDOM_SUFFIX_LEN = 16;\n\nconst MIN_REF_DATE = new Date(1420074000000); // 1/1/2015 @ 01:00:00 GMT\n\n/**\n * Returns an order stamp representing now, which is the greatest possible\n * value based on the current time.\n *\n * The result should be used to insert at the edge of the list.\n */\nexport function present(): string {\n  return fromTimestamp(new Date(), uniqueId());\n}\n\n/**\n * Returns a fixed order stamp in the past which can be used to insert at the\n * opposite edge from now().\n */\nexport function past(): string {\n  return fromTimestamp(MIN_REF_DATE, uniqueId());\n}\n\n/**\n * Generates an initial order stamp based on a timestamp and a unique id.\n * You should pass the key of the item (record) you're dealing with rather than\n * generate a unique id on every call.\n */\nexport function fromTimestamp(timestamp: Date, key?: string) {\n  return ELEN.encode(serializeDate(timestamp)) + key || '';\n}\n\n/**\n * Given two order stamps, this function generates and returns a value between\n * them. To generate values at the edge of the list (top/bottom), pass the\n * values of present() or past() as needed.\n *\n * Note: You can pass the values in any order you like.\n */\nexport function between(prev: string, next: string): string {\n  // Sanity check. If prev and next are equal, there's no way to generate a\n  // value between them.\n  assert(prev !== next);\n\n  // Make sure values are in the correct order\n  if (prev > next) {\n    const tmp = next;\n    next = prev;\n    prev = tmp;\n  }\n\n  // prev has length <= next, and shares a common prefix with next\n  const prefixLen = commonPrefixLen(prev, next);\n  let result = prev.substring(0, prefixLen);\n\n  // First char after shared prefix is guaranteed to be smaller in prev than\n  // in next. Note that it may not actually exist (if prev is shorter than next)\n  const minChar =\n    prefixLen < prev.length ? prev.charCodeAt(prefixLen) : CHAR_CODE_MIN;\n  const maxChar = prefixLen > 0 ? next.charCodeAt(prefixLen) : CHAR_CODE_MAX;\n  // Append a random char between prev[prefixLen] and next[prefixLen]. This\n  // will place our result before next but also before prev.\n  result += String.fromCharCode(randomInt(minChar, maxChar));\n\n  // Search prev from prefixLen+1 to its end\n  for (let i = prefixLen + 1; i < prev.length; ++i) {\n    const charCode = prev.charCodeAt(i);\n    // If we found a char less than MAX, generate a char greater than that\n    // which will place our result *after* next.\n    if (charCode < CHAR_CODE_MAX) {\n      result += String.fromCharCode(randomInt(charCode + 1, CHAR_CODE_MAX));\n      break;\n    } else {\n      // If we found the MAX char, copy it and try again on the following char.\n      result += String.fromCharCode(charCode);\n    }\n  }\n\n  // At this point we can guarantee that:\n  //\n  // - Our result comes before next\n  //\n  // - If prev was long enough and not filled with MAX chars, then our result\n  //   also comes after prev\n  //\n  // In any case, we append a random sequence for two reasons:\n  //\n  // 1. Guarantee that `result` comes after `prev` (`result.length` >\n  //    `prev.length`).\n  //\n  // 2. Guarantee that no two caller pick the same value even if they try to\n  //    generate a stamp between the same values. This creates a (random) total\n  //    order on the results of all parties with a very high probabili2ty.\n  for (let j = 0; j < RANDOM_SUFFIX_LEN; ++j) {\n    result += String.fromCharCode(randomInt(CHAR_CODE_MIN, CHAR_CODE_MAX));\n  }\n  return result;\n}\n\nexport function fromIndex(idx: number): string {\n  return ELEN.encode(idx);\n}\n", "import * as SetUtils from '../../../../base/set.ts';\nimport { Vertex } from '../vertex.ts';\nimport { BaseVertex } from './base.ts';\nimport { User } from './user.ts';\nimport { Query } from '../query.ts';\nimport { Note } from './note.ts';\n\nexport class Workspace extends BaseVertex {\n  get parent(): Vertex | undefined {\n    const rootKey = this.manager.graph.rootKey;\n    for (const u of this.users) {\n      if (u.key === rootKey) {\n        return u;\n      }\n    }\n    return undefined;\n  }\n\n  get name(): string {\n    return this.record.get('name', '');\n  }\n\n  set name(name: string) {\n    this.record.set('name', name);\n  }\n\n  get users(): Set<User> {\n    return this.vertSetForField('users');\n  }\n\n  set users(users: Set<User>) {\n    this.record.set(\n      'users',\n      SetUtils.map(users, (u: User) => u.key)\n    );\n  }\n\n  clearUsers(): void {\n    this.record.set('users', new Set());\n  }\n\n  get icon(): string | undefined {\n    return this.record.get<string>('icon');\n  }\n\n  set icon(icon: string | undefined) {\n    if (icon !== undefined) {\n      this.record.set('icon', icon);\n    } else {\n      this.record.delete('icon');\n    }\n  }\n\n  get exportImage(): string | undefined {\n    return this.record.get<string>('exportImage');\n  }\n\n  set exportImage(img: string | undefined) {\n    this.record.set('exportImage', img);\n  }\n\n  get footerHtml(): string | undefined {\n    return this.record.get<string>('footerHtml');\n  }\n\n  set footerHtml(html: string | undefined) {\n    this.record.set('footerHtml', html);\n  }\n\n  get notesQuery(): Query<Vertex, Note> {\n    return this.graph.sharedQueriesManager.getVertexQuery(\n      this.key,\n      'notesQuery',\n      this.graph.sharedQueriesManager.notDeleted,\n      (vert) => vert instanceof Note && vert.workspace === this\n    );\n  }\n\n  get pinnedNotesQuery(): Query<Note> {\n    return this.graph.sharedQueriesManager.getVertexQuery(\n      this.key,\n      'pinnedNotesQuery',\n      this.notesQuery,\n      (note) => note.isPinned\n    );\n  }\n}\n", "import { assert } from '../../../../base/error.ts';\nimport { FieldTriggers, Vertex, VertexConfig } from '../vertex.ts';\nimport * as OrderStamp from '../../../base/orderstamp.ts';\nimport {\n  MutationPack,\n  mutationPackAppend,\n  mutationPackIter,\n} from '../mutations.ts';\nimport { Workspace } from './workspace.ts';\nimport { triggerChildren } from '../propagation-triggers.ts';\nimport { VertexManager } from '../vertex-manager.ts';\nimport { Record } from '../../../base/record.ts';\nimport { IVertex } from '../types.ts';\nimport { coreValueCompare } from '../../../../base/core-types/comparable.ts';\n\nexport class BaseVertex extends Vertex {\n  constructor(\n    mgr: VertexManager,\n    record: Record,\n    prevVertex: Vertex | undefined,\n    config: VertexConfig | undefined\n  ) {\n    super(mgr, record, prevVertex, config);\n    if (prevVertex && prevVertex instanceof Workspace) {\n      this.selected = prevVertex.selected;\n    }\n  }\n\n  // ============================= //\n  // =========== Dates =========== //\n  // ============================= //\n\n  get creationDate(): Date {\n    return this.record.get('creationDate') as Date;\n  }\n\n  // set creationDate(d: Date) {\n  //   this.record.set('creationDate', d);\n  // }\n\n  get lastModified(): Date {\n    const d = this.record.get<Date>('lastModified');\n    assert(d instanceof Date);\n    return d;\n  }\n\n  // set lastModified(d: Date) {\n  //   this.record.set('lastModified', d);\n  // }\n\n  // ============================= //\n  // ======== Other Basics ======= //\n  // ============================= //\n\n  private calcIsDeleted(parentDeleted: number | undefined): number {\n    if (parentDeleted) {\n      return parentDeleted;\n    }\n    const v = this.record.get<number>('isDeleted');\n    assert(typeof v === 'number');\n    return v;\n  }\n\n  get isDeleted(): number {\n    return this.calcIsDeleted(this.parent?.isDeleted);\n  }\n\n  set isDeleted(v: number) {\n    this.record.set('isDeleted', v);\n  }\n\n  get sortStamp(): string {\n    return this.record.get(\n      'sortStamp',\n      OrderStamp.fromTimestamp(this.creationDate, this.key)\n    );\n  }\n\n  set sortStamp(v: string) {\n    this.record.set('sortStamp', v);\n  }\n\n  clearSortStamp() {\n    this.record.delete('sortStamp');\n  }\n\n  selected = false;\n\n  clearSelected() {\n    this.selected = false;\n  }\n\n  // Override by subclasses\n  get parent(): Vertex | undefined {\n    return undefined;\n  }\n\n  // isDeleted is affected by parent changes\n  parentDidMutate(\n    local: boolean,\n    oldValue: Vertex | undefined,\n    parent: Vertex\n  ): MutationPack {\n    const prevIsDeleted = this.calcIsDeleted(oldValue?.isDeleted);\n    if (prevIsDeleted !== this.isDeleted) {\n      return ['isDeleted', local, prevIsDeleted];\n    }\n  }\n\n  // If our parent's isDeleted has changed, our isDeleted may need to be updated\n  parentIsDeletedChanged(\n    local: boolean,\n    oldValue: number,\n    parent: Vertex\n  ): MutationPack {\n    // Our parent's isDeleted affects us only when we're not explicitly deleted\n    if (!this.record.get('isDeleted')) {\n      return ['isDeleted', local, this.calcIsDeleted(oldValue)];\n    }\n  }\n\n  onUserUpdatedField(mut: MutationPack): MutationPack {\n    let result = mut;\n    for (const [field] of mutationPackIter(mut)) {\n      if (this.record.scheme.hasField(field)) {\n        const prevLastMod = this.lastModified;\n        this.record.set('lastModified', new Date());\n\n        result = mutationPackAppend(mut, ['lastModified', true, prevLastMod]);\n        break;\n      }\n    }\n    return result;\n  }\n\n  valueForRefCalc(fieldName: keyof this): any {\n    if (fieldName === 'parent') {\n      return this.parent;\n    }\n    return super.valueForRefCalc(fieldName);\n  }\n\n  compare(other: IVertex): number {\n    if (other instanceof BaseVertex) {\n      // Default order is descending which places newer items first. This\n      // enables us to show intermediate results of queries and still make\n      // sense\n      return coreValueCompare(other.sortStamp, this.sortStamp);\n    }\n    return super.compare(other);\n  }\n}\n\nexport class ContentVertex extends BaseVertex {\n  get parent(): Vertex | undefined {\n    return this.workspace;\n  }\n\n  get createdBy(): Vertex | undefined {\n    const key = this.record.get<string>('createdBy');\n    return key ? this.graph.getVertex(key) : undefined;\n  }\n\n  set createdBy(v: Vertex | undefined) {\n    if (v) {\n      assert(v.graph === this.graph);\n      this.record.set('createdBy', v.key);\n    } else {\n      this.record.delete('createdBy');\n    }\n  }\n\n  get workspace(): Workspace {\n    const key = this.record.get<string>('workspace');\n    assert(typeof key === 'string');\n    return this.graph.getVertex<Workspace>(key);\n  }\n\n  get workspaceKey(): string {\n    return this.record.get('workspace') as string;\n  }\n\n  set workspace(ws: Workspace) {\n    assert(ws.graph === this.graph);\n    this.record.set('workspace', ws.key);\n  }\n\n  workspaceDidMutate(\n    local: boolean,\n    oldValue: Workspace | undefined\n  ): MutationPack {\n    if (this.parent?.isEqual(this.workspace)) {\n      return ['parent', local, oldValue];\n    }\n  }\n\n  parentWorkspaceDidMutate(): void {\n    this.workspace = (this.parent as ContentVertex).workspace;\n  }\n}\n\nconst kFieldTriggersBase: FieldTriggers<BaseVertex> = {\n  isDeleted: triggerChildren('parentIsDeletedChanged'),\n};\n\nVertex.registerFieldTriggers(BaseVertex, kFieldTriggersBase);\n\nconst kFieldTriggersContent: FieldTriggers<ContentVertex> = {\n  workspace: triggerChildren('parentWorkspaceDidMutate'),\n};\n\nVertex.registerFieldTriggers(ContentVertex, kFieldTriggersContent);\n", "import { Dictionary } from '../../base/collections/dict.ts';\nimport { HashMap } from '../../base/collections/hash-map.ts';\nimport {\n  Clonable,\n  Equatable,\n  CoreValue,\n  coreValueEquals,\n} from '../../base/core-types/index.ts';\nimport { encodableValueHash } from '../../base/core-types/encoding/index.ts';\nimport { dfs, ElementNode, kCoreValueTreeNodeOpts } from './tree.ts';\n\nexport type NodeKey = { id: string };\n\n// ID => { id: <ID> } mapping\nconst gAllocatedKeys: Dictionary<string, NodeKey> = new Map();\n\nexport class TreeKeys implements Clonable, Equatable<TreeKeys> {\n  private readonly _root: ElementNode;\n  private readonly _keys: Dictionary<CoreValue, NodeKey>;\n  private readonly _counts: Dictionary<CoreValue, number>;\n\n  constructor(root: ElementNode) {\n    this._root = root;\n    this._keys = new Map();\n    this._counts = new HashMap<CoreValue, number>(\n      (v) => encodableValueHash(v, kCoreValueTreeNodeOpts),\n      (v1, v2) => coreValueEquals(v1, v2, kCoreValueTreeNodeOpts)\n    );\n    for (const [node] of dfs(root)) {\n      this.keyFor(node);\n    }\n  }\n\n  keyFor(node: CoreValue): NodeKey {\n    const keys = this._keys;\n    let nodeKey = keys.get(node);\n    if (nodeKey === undefined) {\n      const counts = this._counts;\n      const idx: number = counts.get(node) || 0;\n      const hash = encodableValueHash(node, kCoreValueTreeNodeOpts);\n      const id = hash + '/' + idx;\n      nodeKey = gAllocatedKeys.get(id);\n      if (nodeKey === undefined) {\n        nodeKey = { id };\n        gAllocatedKeys.set(id, nodeKey);\n      }\n      keys.set(node, nodeKey);\n      counts.set(node, idx + 1);\n    }\n    return nodeKey;\n  }\n\n  clone(): TreeKeys {\n    return new TreeKeys(this._root);\n  }\n\n  isEqual(other: TreeKeys): boolean {\n    const thisCounts = this._counts;\n    const otherCounts = other._counts;\n    for (const [key, value] of thisCounts) {\n      if (otherCounts.get(key) !== value) {\n        return false;\n      }\n    }\n    for (const key of otherCounts.keys()) {\n      if (!thisCounts.has(key)) {\n        return false;\n      }\n    }\n    return true;\n  }\n}\n", "import { CoreObject } from '../../base/core-types/index.ts';\nimport {\n  RichText,\n  Pointer,\n  ElementNode,\n  TextNode,\n  isPointer,\n  dfs,\n  TreeNode,\n  isTextNode,\n  PointerDirection,\n  Point,\n  PointerType,\n} from './tree.ts';\nimport { assert, notReached } from '../../base/error.ts';\nimport { TreeKeys } from './tree-keys.ts';\nimport { PointerValue, projectPointers } from './flat-rep.ts';\nimport { Dictionary } from '../../base/collections/dict.ts';\n\nexport interface Range extends CoreObject {\n  anchor: Point;\n  focus: Point;\n  isLocal?: boolean;\n  expiration?: Date;\n}\n\nexport interface DocumentRanges extends CoreObject {\n  [key: string]: Range;\n}\n\nexport interface UnkeyedDocument extends CoreObject {\n  root: ElementNode;\n  ranges?: DocumentRanges;\n}\n\nexport interface Document extends UnkeyedDocument {\n  nodeKeys: TreeKeys;\n}\n\nexport function docFromRT(rt: RichText | UnkeyedDocument): Document {\n  const result: Document = {\n    root: rt.root,\n    nodeKeys: new TreeKeys(rt.root),\n  };\n\n  // if (rt.ranges !== undefined) {\n  //   result.ranges = rt.ranges as DocumentRanges;\n  // }\n\n  if (rt.pointers !== undefined) {\n    result.ranges = composeRanges(rt);\n  }\n\n  return result;\n}\n\nexport function docToRT(doc: RichText | UnkeyedDocument): RichText {\n  const result: RichText = {\n    root: doc.root,\n  };\n  // if (doc.pointers !== undefined) {\n  //   result.pointers = doc.pointers as Set<Pointer>;\n  // }\n  if (doc.ranges !== undefined) {\n    const pointers = decomposeRanges(doc);\n    if (pointers.size > 0) {\n      result.pointers = pointers;\n    }\n  }\n  return result;\n}\n\nexport function isDocument(doc: UnkeyedDocument): doc is Document {\n  return doc.nodeKeys instanceof TreeKeys;\n}\n\nexport function unkeyedDocToDoc(doc: UnkeyedDocument): Document {\n  if (isDocument(doc)) {\n    return doc;\n  }\n  return {\n    ...doc,\n    nodeKeys: new TreeKeys(doc.root),\n  };\n}\n\nfunction findLastTextNode(rt: RichText): TextNode {\n  let textNode: TextNode | undefined;\n  for (const [node] of dfs(rt.root)) {\n    if (isTextNode(node)) {\n      textNode = node;\n    }\n  }\n  if (textNode === undefined) {\n    notReached('No text nodes found in tree');\n  }\n  return textNode;\n}\n\nfunction findFirstTextNode(rt: RichText): TextNode {\n  for (const [node] of dfs(rt.root)) {\n    if (isTextNode(node)) {\n      return node;\n    }\n  }\n  notReached('No text nodes found in tree');\n}\n\nexport function composeRanges(rt: RichText): DocumentRanges {\n  const result: DocumentRanges = {};\n  if (rt.pointers === undefined) {\n    return result;\n  }\n  let lastTextNode: TextNode | undefined;\n  let firstTextNode: TextNode | undefined;\n  for (const ptr of rt.pointers) {\n    if (isPointer(ptr)) {\n      // Skip expired pointers\n      // if (ptr.expiration && ptr.expiration.getTime() < now) {\n      //   continue;\n      // }\n      let range = result[ptr.key];\n      if (range === undefined) {\n        if (ptr.type === 'anchor') {\n          if (ptr.dir === PointerDirection.Forward) {\n            if (lastTextNode === undefined) {\n              lastTextNode = findLastTextNode(rt);\n            }\n            range = {\n              anchor: {\n                node: ptr.node,\n                offset: ptr.offset,\n              },\n              focus: {\n                node: lastTextNode,\n                offset: lastTextNode.text.length,\n              },\n            };\n          } else if (ptr.dir === PointerDirection.Backward) {\n            if (firstTextNode === undefined) {\n              firstTextNode = findFirstTextNode(rt);\n            }\n            range = {\n              anchor: {\n                node: ptr.node,\n                offset: ptr.offset,\n              },\n              focus: {\n                node: firstTextNode,\n                offset: 0,\n              },\n            };\n          }\n        } else {\n          assert(ptr.type === 'focus');\n          if (ptr.dir === PointerDirection.Backward) {\n            if (lastTextNode === undefined) {\n              lastTextNode = findLastTextNode(rt);\n            }\n            range = {\n              anchor: {\n                node: lastTextNode,\n                offset: lastTextNode.text.length,\n              },\n              focus: {\n                node: ptr.node,\n                offset: ptr.offset,\n              },\n            };\n          } else if (ptr.dir === PointerDirection.Forward) {\n            if (firstTextNode === undefined) {\n              firstTextNode = findFirstTextNode(rt);\n            }\n            range = {\n              anchor: {\n                node: firstTextNode,\n                offset: 0,\n              },\n              focus: {\n                node: ptr.node,\n                offset: ptr.offset,\n              },\n            };\n          }\n        }\n        if (range === undefined) {\n          assert(ptr.dir === PointerDirection.None);\n          range = {\n            anchor: {\n              node: ptr.node,\n              offset: ptr.offset,\n            },\n            focus: {\n              node: ptr.node,\n              offset: ptr.offset,\n            },\n          };\n        }\n        // Update in resulting map\n        result[ptr.key] = range;\n      } else {\n        // Update an existing range entry\n        // TODO(ofri): Only allow expansion of the range\n        range[ptr.type] = {\n          node: ptr.node,\n          offset: ptr.offset,\n        };\n      }\n\n      // Bump expiration up if needed\n      if (\n        ptr.expiration &&\n        (range.expiration === undefined ||\n          range.expiration.getTime() < ptr.expiration.getTime())\n      ) {\n        range.expiration = ptr.expiration;\n      }\n      // Copy local flag\n      if (ptr.isLocal) {\n        range.isLocal = true;\n      }\n    }\n  }\n  return result;\n}\n\nfunction nodesByFlatIndexes(rt: RichText): Dictionary<TreeNode, number> {\n  const result = new Map<TreeNode, number>();\n  let idx = 0;\n  for (const [node] of dfs(rt.root)) {\n    result.set(node, idx);\n    if (isTextNode(node)) {\n      idx += node.text.length;\n    }\n    idx += 1;\n  }\n  return result;\n}\n\nexport function decomposeRanges(doc: UnkeyedDocument): Set<Pointer> {\n  if (doc.ranges === undefined) {\n    return new Set();\n  }\n  const result = new Set<Pointer>();\n  // const now = Date.now();\n  const nodesToIndexes = nodesByFlatIndexes({ root: doc.root });\n  for (const [key, range] of Object.entries(doc.ranges)) {\n    // if (range.expiration !== undefined && range.expiration.getTime() < now) {\n    //   continue;\n    // }\n    const anchorOffset = nodesToIndexes.get(range.anchor.node)!;\n    const focusOffset = nodesToIndexes.get(range.focus.node)!;\n    const dir =\n      anchorOffset < focusOffset\n        ? PointerDirection.Forward\n        : anchorOffset > focusOffset\n        ? PointerDirection.Backward\n        : PointerDirection.None;\n    result.add(buildRangePointer(key, range, 'anchor', dir));\n    result.add(buildRangePointer(key, range, 'focus', dir));\n  }\n  return result;\n}\n\nfunction buildRangePointer(\n  key: string,\n  range: Range,\n  type: PointerType,\n  dir: PointerDirection\n): Pointer {\n  const result: Pointer = {\n    key,\n    type,\n    dir,\n    node: range[type].node,\n    offset: range[type].offset,\n  };\n  if (range.expiration !== undefined) {\n    result.expiration = range.expiration;\n  }\n  if (range.isLocal) {\n    result.isLocal = true;\n  }\n  return result;\n}\n\nexport interface RangeFilter {\n  (key: string): boolean;\n}\n\n/**\n * Given two documents, this function projects pointers from the source to\n * destination doc, adjusting for any edits that happened between the two docs.\n *\n * Use this function before updating a note's body to project ranges other than\n * the ones you've changed.\n *\n * @param src Source document\n * @param dst Destination document. This function updates the destination in\n *            place.\n * @returns The updated destination document.\n */\nexport function projectRanges(\n  src: UnkeyedDocument,\n  dst: UnkeyedDocument,\n  filter: (ptr: PointerValue) => boolean\n): Document {\n  if (src.ranges === undefined) {\n    return unkeyedDocToDoc(dst);\n  }\n  return unkeyedDocToDoc(\n    docFromRT(projectPointers(docToRT(src), docToRT(dst), filter))\n  );\n}\n\n// interface ProjectionContext {\n//   diff: Diff[];\n//   offsetsMap1: OrderedMap<TreeNode, number>;\n//   offsetsMap2: OrderedMap<TreeNode, number>;\n// }\n\n// /**\n//  * Converts a pointer from source to destination documents based on a given\n//  * projection context.\n//  *\n//  * @param ctx The projection context\n//  * @param ptr The pointer to project.\n//  * @returns A projected pointer\n//  */\n// function projectPoint(ctx: ProjectionContext, ptr: Point): Point {\n//   // Convert the relative pointer to an absolute index\n//   let targetOffset = pointToAbsOffset(ctx.offsetsMap1, ptr);\n//   // Project the index based on the previously computed diff(src -> dst)\n//   targetOffset = kDMP.diff_xIndex(ctx.diff, targetOffset);\n//   // Convert back to offset relative to dst doc\n//   const result = pointFromAbsOffset(ctx.offsetsMap2, targetOffset);\n//   if (ptr.isLocal) {\n//     result.isLocal = true;\n//   }\n//   return result;\n// }\n", "import { dfs, ElementNode, isTextNode } from './tree.ts';\n\nexport function treeToMarkdown(root: ElementNode | undefined): string {\n  if (!root) {\n    return '';\n  }\n  let result = '';\n  let prevDepth = 1;\n  for (const [node, depth] of dfs(root)) {\n    if (depth !== prevDepth) {\n      result += '\\n';\n      prevDepth = depth;\n    }\n    switch (node.tagName) {\n      case 'h1':\n        result += '# ';\n        break;\n\n      case 'h2':\n        result += '## ';\n        break;\n\n      case 'li':\n        result += '* ';\n        break;\n\n      case 'ref':\n        result += '- ';\n        break;\n\n      default:\n        break;\n    }\n    if (isTextNode(node)) {\n      result += node.text;\n    }\n  }\n  return result;\n}\n", "import { User } from './user.ts';\nimport { ContentVertex } from './base.ts';\nimport {\n  AttachmentData,\n  NoteStatus,\n  NS_NOTES,\n  SchemeNamespace,\n  TagValue,\n} from '../../../base/scheme-types.ts';\nimport { initRichText, RichText } from '../../../richtext/tree.ts';\nimport {\n  composeRichText,\n  decomposeRichText,\n  extractRefs,\n  RefPlaceholder,\n} from '../../../richtext/composer.ts';\nimport {\n  FieldTriggers,\n  keyDictToVertDict,\n  vertDictToKeyDict,\n  Vertex,\n  VertexConfig,\n} from '../vertex.ts';\nimport { Dictionary } from '../../../../base/collections/dict.ts';\nimport { Tag } from './tag.ts';\nimport { MutationPack, mutationPackAppend } from '../mutations.ts';\nimport {\n  docFromRT,\n  docToRT,\n  Document,\n  projectRanges,\n  UnkeyedDocument,\n} from '../../../richtext/doc-state.ts';\nimport { coreObjectClone } from '../../../../base/core-types/clone.ts';\nimport {\n  flattenRichText,\n  projectPointers,\n  reconstructRichText,\n  stripFormattingFilter,\n} from '../../../richtext/flat-rep.ts';\nimport { treeToMarkdown } from '../../../richtext/markdown.ts';\nimport { triggerParent, triggerChildren } from '../propagation-triggers.ts';\nimport { coreValueEquals } from '../../../../base/core-types/index.ts';\nimport { VertexManager } from '../vertex-manager.ts';\nimport { Record } from '../../../base/record.ts';\nimport { notReached, assert } from '../../../../base/error.ts';\nimport * as SetUtils from '../../../../base/set.ts';\nimport { mapIterable } from '../../../../base/common.ts';\n\nexport enum NoteType {\n  Task = 'task',\n  Note = 'note',\n}\n\nexport class Note extends ContentVertex {\n  private _cachedBody?: Document;\n  private _cachedBodyPreview?: string;\n  private _cachedTitle?: Document;\n  private _cachedTitleRT?: RichText;\n  private _cachedChildCards?: Note[];\n\n  constructor(\n    mgr: VertexManager,\n    record: Record,\n    prevVertex: Vertex | undefined,\n    config: VertexConfig | undefined\n  ) {\n    super(mgr, record, prevVertex, config);\n    if (\n      prevVertex instanceof Note &&\n      coreValueEquals(this.body, prevVertex.body)\n    ) {\n      this._cachedBodyPreview = prevVertex._cachedBodyPreview;\n    }\n  }\n\n  get parent(): Vertex | undefined {\n    return this.parentNote || super.parent;\n  }\n\n  parentNoteDidMutate(\n    local: boolean,\n    oldValue: Note | undefined\n  ): MutationPack {\n    return [\n      ['parent', local, oldValue],\n      ['parentType', local, oldValue?.type],\n    ];\n  }\n\n  get assignees(): Set<User> {\n    return this.vertSetForField('assignees');\n  }\n\n  set assignees(users: Set<User>) {\n    this.record.set(\n      'assignees',\n      SetUtils.map(users, (u) => u.key)\n    );\n  }\n\n  clearAssignees(): void {\n    this.record.set('assignees', new Set());\n  }\n\n  get attachments(): Set<AttachmentData> {\n    const attachments = this.record.get('attachments') as Set<AttachmentData>;\n    if (attachments === undefined || attachments.size === 0) {\n      return new Set<AttachmentData>();\n    }\n\n    const copy = SetUtils.map(attachments, (v) => coreObjectClone(v));\n    return copy;\n  }\n\n  set attachments(set: Set<AttachmentData>) {\n    const copy = SetUtils.map(set, (v) => coreObjectClone(v));\n    this.record.set('attachments', copy);\n  }\n\n  clearAttachments(): void {\n    this.record.set('attachments', new Set());\n  }\n\n  get body(): Document {\n    if (this._cachedBody === undefined) {\n      const graph = this.graph;\n      this._cachedBody = docFromRT(\n        composeRichText(\n          (key) => {\n            const note = graph.getVertex<Note>(key);\n            if (note.isNull) {\n              return RefPlaceholder.Loading;\n            }\n            if (note.isDeleted) {\n              return RefPlaceholder.Deleted;\n            }\n            return note.record.get('title') as RichText;\n          },\n          this.record.get('body') || initRichText(),\n          true\n        )\n      );\n    }\n    return this._cachedBody;\n  }\n\n  set body(rt: UnkeyedDocument) {\n    // Take a snapshot of the out refs before changing the value\n    const oldRefs = this.getBodyRefs();\n    rt = projectRanges(this.body, rt, (ptr) =>\n      this.graph.ptrFilterFunc(ptr.key)\n    );\n    this._cachedBody = undefined;\n    const graph = this.graph;\n    //  Update our body while applying edits to inner tasks' titles\n    const updatedBody = decomposeRichText(\n      (key, rt) => {\n        let childV: Note;\n        if (!oldRefs.has(key)) {\n          if (graph.hasVertex(key)) {\n            //This was a deleted task.\n            childV = graph.getVertex<Note>(key);\n            childV.isDeleted = 0;\n          } else {\n            //New Task\n            childV = graph.createVertex(\n              NS_NOTES,\n              {\n                creationDate: new Date(),\n                parentNote: this.key,\n                type: NoteType.Task,\n                createdBy: this.createdBy?.key,\n                workspace: this.workspace.key,\n              },\n              key\n            );\n          }\n        } else {\n          //Existing task\n          childV = graph.getVertex<Note>(key);\n        }\n        childV.titleRT = rt;\n      },\n      docToRT(rt),\n      true\n    );\n    this.record.set('body', updatedBody);\n    this._cachedBody = undefined;\n    // Get out refs after the update\n    const newRefs = this.getBodyRefs();\n    // Compare them with old refs to find deleted tasks\n    const deletedKeys = SetUtils.subtract(oldRefs, newRefs);\n    // Mark deleted tasks as such\n    for (const key of deletedKeys) {\n      graph.getVertex<Note>(key).isDeleted = 1;\n    }\n  }\n\n  clearBody(): void {\n    this.body = docFromRT(initRichText());\n  }\n\n  getBodyRefs(): Set<string> {\n    const bodyRT = this.record.get<RichText>('body');\n    if (bodyRT === undefined) {\n      return new Set();\n    }\n    return extractRefs(bodyRT.root, true);\n  }\n\n  getRawBody(): RichText | undefined {\n    return this.record.get<RichText>('body');\n  }\n\n  get bodyPreview(): string {\n    if (this._cachedBodyPreview === undefined) {\n      this._cachedBodyPreview = stripWhitelines(treeToMarkdown(this.body.root));\n    }\n    return this._cachedBodyPreview;\n  }\n\n  bodyDidMutate(local: boolean, oldValue: Document): MutationPack {\n    this._cachedBodyPreview = undefined;\n    this._cachedBody = undefined;\n    return [\n      'bodyPreview',\n      local,\n      stripWhitelines(treeToMarkdown(oldValue?.root)),\n    ];\n  }\n\n  private _invalidateBodyOnChildChange(\n    local: boolean,\n    childKey: string\n  ): MutationPack {\n    // The UI will typically first create the child task, then insert the ref\n    // to the parent note's body. If we emit a mutation before the body actually\n    // has the ref in it, bad things will happen.\n    if (this.getBodyRefs().has(childKey)) {\n      const oldValue = this._cachedBody;\n      this._cachedBody = undefined;\n      return ['body', local, oldValue];\n    }\n  }\n\n  get childCards(): Note[] {\n    if (this._cachedChildCards === undefined) {\n      const childCards: Note[] = [];\n      for (const child of this.getChildren<Note>(SchemeNamespace.NOTES)) {\n        if (!child.isDeleted) {\n          childCards.push(child);\n        }\n      }\n      this._cachedChildCards = childCards;\n    }\n    return this._cachedChildCards;\n  }\n\n  private _invalidateChildCards(local: boolean): MutationPack {\n    const res: MutationPack = ['childCards', local, this._cachedChildCards];\n    this._cachedChildCards = undefined;\n    return res;\n  }\n\n  childParentNoteDidMutate(\n    local: boolean,\n    oldValue: Note | undefined,\n    child: Note\n  ): MutationPack {\n    return this._invalidateChildCards(local);\n  }\n\n  // Invalidate our composite body if the title of an inner task are changes\n  childTitleDidMutate(\n    local: boolean,\n    oldValue: RichText,\n    child: Note\n  ): MutationPack {\n    return this._invalidateBodyOnChildChange(local, child.key);\n  }\n\n  // Invalidate our composite body if the title of an inner task are changes\n  childIsLoadingDidMutate(\n    local: boolean,\n    oldValue: RichText,\n    child: Note\n  ): MutationPack {\n    return this._invalidateBodyOnChildChange(local, child.key);\n  }\n\n  get dueDate(): Date | undefined {\n    return this.record.get<Date>('dueDate');\n  }\n\n  set dueDate(d: Date | undefined) {\n    if (d === undefined) {\n      this.record.delete('dueDate');\n    } else {\n      this.record.set('dueDate', d);\n    }\n  }\n\n  get title(): Document {\n    if (typeof this._cachedTitle === 'undefined') {\n      this._cachedTitle = docFromRT(this.titleRT);\n    }\n    return this._cachedTitle;\n  }\n\n  set title(rt: UnkeyedDocument) {\n    this.titleRT = docToRT(rt);\n  }\n\n  clearTitle(): void {\n    this.titleRT = initRichText();\n  }\n\n  private get titleRT(): RichText {\n    if (!this._cachedTitleRT) {\n      this._cachedTitleRT = reconstructRichText(\n        stripFormattingFilter(\n          flattenRichText(\n            this.record.get('title') || initRichText(),\n            true,\n            false\n          )\n        )\n      );\n    }\n    return this._cachedTitleRT!;\n  }\n\n  private set titleRT(rt: RichText) {\n    if (rt === undefined) {\n      rt = initRichText();\n    }\n    rt = projectPointers(\n      this.titleRT,\n      rt,\n      (ptr) => this.graph.ptrFilterFunc(ptr.key),\n      true,\n      true\n    );\n    rt = reconstructRichText(\n      stripFormattingFilter(flattenRichText(rt, true, false))\n    );\n    this._cachedTitle = undefined;\n    this._cachedTitleRT = undefined;\n    this.record.set('title', rt);\n  }\n\n  titleRTDidMutate(local: boolean, oldValue: RichText): MutationPack {\n    this._cachedTitle = undefined;\n    this._cachedTitleRT = undefined;\n    return ['title', local, docFromRT(oldValue)];\n  }\n\n  get parentNote(): Note | undefined {\n    const parentKey = this.record.get<string>('parentNote');\n    return parentKey !== undefined\n      ? this.graph.getVertex<Note>(parentKey)\n      : undefined;\n  }\n\n  set parentNote(parent: Note | undefined) {\n    this.record.set('parentNote', parent?.key);\n  }\n\n  get status(): NoteStatus {\n    return this.record.get('status', 'ToDo');\n  }\n\n  set status(status: NoteStatus) {\n    this.record.set('status', status);\n  }\n\n  clearStatus(): void {\n    this.record.delete('status');\n  }\n\n  get tags(): Dictionary<Tag, Tag> {\n    const map = this.record.get<Map<string, string>>('tags', new Map());\n    return keyDictToVertDict(this.graph, map);\n  }\n\n  set tags(map: Dictionary<Tag, Tag>) {\n    this.record.set('tags', vertDictToKeyDict(map));\n  }\n\n  clearTags(): void {\n    this.tags = new Map();\n  }\n\n  get type(): NoteType {\n    return this.record.get('type') as NoteType;\n  }\n\n  set type(type: NoteType) {\n    this.record.set('type', type);\n  }\n\n  get parentType(): NoteType | undefined {\n    return this.parentNote?.type;\n  }\n\n  parentNoteTypeDidMutate(\n    local: boolean,\n    oldValue: NoteType | undefined\n  ): MutationPack {\n    return ['parentType', local, oldValue];\n  }\n\n  get isPinned(): boolean {\n    return this.record.get<Set<string>>('pinnedBy').has(this.graph.rootKey);\n  }\n\n  set isPinned(val: boolean) {\n    const current = SetUtils.map(this.pinnedBy, (x) => x);\n    if (val) {\n      current.add(this.graph.rootKey);\n    } else if (current.has(this.graph.rootKey)) {\n      current.delete(this.graph.rootKey);\n    }\n\n    this.pinnedBy = current;\n  }\n\n  get pinnedBy(): Set<string> {\n    return this.record.get('pinnedBy');\n  }\n\n  set pinnedBy(pins: Set<string>) {\n    this.record.set('pinnedBy', pins);\n  }\n\n  pinnedByDidMutate(local: boolean, oldValue: Set<string>): MutationPack {\n    return ['isPinned', local, oldValue?.has(this.graph.rootKey)];\n  }\n\n  childNoteIsDeletedDidMutate(\n    local: boolean,\n    oldValue: number,\n    child: Note\n  ): MutationPack {\n    return mutationPackAppend(\n      // TODO: Actually go and remove the RefMarkers from the rich text\n      this._invalidateBodyOnChildChange(local, child.key),\n      this._invalidateChildCards(local)\n    );\n  }\n\n  rewritePinsToRootUser(): void {\n    const pinnedBy = this.pinnedBy;\n    if (pinnedBy && pinnedBy.has('/')) {\n      const updatedPins = new Set(pinnedBy);\n      updatedPins.delete('/');\n      updatedPins.add(this.graph.rootKey);\n      this.pinnedBy = updatedPins;\n    }\n  }\n}\n\nconst kStripWhitelinesReges = /[\\r\\n]\\s*/g;\nfunction stripWhitelines(str: string): string {\n  return str.replace(kStripWhitelinesReges, ' ');\n}\n\nexport const kFieldTriggersNote: FieldTriggers<Note> = {\n  title: triggerParent('childTitleDidMutate', SchemeNamespace.NOTES),\n  // Note: Any trigger installed by a superclass gets automatically triggered\n  // before these triggers\n  // isLoading: triggerParent('childIsLoadingDidMutate', SchemeNamespace.NOTES),\n  isDeleted: triggerParent(\n    'childNoteIsDeletedDidMutate',\n    SchemeNamespace.NOTES\n  ),\n  parentNote: triggerParent('childParentNoteDidMutate', SchemeNamespace.NOTES),\n  type: triggerChildren('parentNoteTypeDidMutate', SchemeNamespace.NOTES),\n};\n\nVertex.registerFieldTriggers(Note, kFieldTriggersNote);\n", "import { BaseVertex } from './base.ts';\nimport { FieldTriggers, Vertex } from '../vertex.ts';\nimport { coreValueCompare } from '../../../../base/core-types/comparable.ts';\nimport { Query } from '../query.ts';\nimport { MutationPack } from '../mutations.ts';\nimport { triggerChildren } from '../propagation-triggers.ts';\n\nexport class Tag extends BaseVertex {\n  get name(): string {\n    return this.record.get('name', '');\n  }\n\n  set name(n: string) {\n    this.record.set('name', n);\n  }\n\n  get fullName(): string {\n    return this.fullNameForParent(this.parentTag);\n  }\n\n  get parentTag(): Tag | undefined {\n    const key = this.record.get<string>('parentTag');\n    return key ? this.graph.getVertex<Tag>(key) : undefined;\n  }\n\n  set parentTag(tag: Tag | undefined) {\n    if (tag) {\n      this.record.set('parentTag', tag.key);\n    } else {\n      this.record.delete('parentTag');\n    }\n  }\n\n  private fullNameForParent(parentTag: Tag | undefined): string {\n    return parentTag ? `${parentTag.name}/${this.name}` : this.name;\n  }\n\n  parentTagDidMutate(local: boolean, oldValue: Tag | undefined): MutationPack {\n    return [\n      ['parent', local, oldValue],\n      ['fullName', local, this.fullNameForParent(oldValue)],\n    ];\n  }\n\n  parentNameDidMutate(local: boolean, oldValue: string): MutationPack {\n    return ['fullName', local, `${oldValue}/${this.name}`];\n  }\n\n  get parent(): Vertex | undefined {\n    return this.parentTag;\n  }\n\n  get childTagsQuery(): Query<Tag, Tag> {\n    const queryManager = this.graph.sharedQueriesManager;\n    return queryManager.getVertexQuery(\n      this.key,\n      'childTagsQuery',\n      queryManager.tags,\n      (tag) => tag.parent?.key === this.key,\n      (t1, t2) => coreValueCompare(t1.sortStamp, t2.sortStamp)\n    );\n  }\n}\n\nconst kFieldTriggersTag: FieldTriggers<Tag> = {\n  name: triggerChildren('parentNameDidMutate'),\n};\n\nVertex.registerFieldTriggers(Tag, kFieldTriggersTag);\n", "import { assert } from '../../../../base/error.ts';\nimport { BaseVertex } from './base.ts';\nimport { UserSettings } from './user-settings.ts';\nimport { NS_USER_SETTINGS } from '../../../base/scheme-types.ts';\nimport { coreValueCompare } from '../../../../base/core-types/comparable.ts';\n\nexport class User extends BaseVertex {\n  get avatarUrl(): string | undefined {\n    return this.record.get<string>('avatarUrl');\n  }\n\n  set avatarUrl(url: string | undefined) {\n    if (url !== undefined) {\n      this.record.set('avatarUrl', url);\n    } else {\n      this.record.delete('avatarUrl');\n    }\n  }\n\n  get email(): string {\n    const email = this.record.get<string>('email');\n    assert(typeof email === 'string' && email.length > 0);\n    return email;\n  }\n\n  set email(email: string) {\n    assert(typeof email === 'string' && email.length > 0);\n    this.record.set('email', email);\n  }\n\n  get name(): string {\n    return this.record.get('name', this.email);\n  }\n\n  set name(n: string) {\n    this.record.set('name', n);\n  }\n\n  clearName(): void {\n    this.record.delete('name');\n  }\n\n  get settings(): UserSettings {\n    return this.graph.createVertex(\n      NS_USER_SETTINGS,\n      {},\n      this.key + '_settings',\n      false\n    );\n  }\n\n  compare(other: User): number {\n    const rootKey = this.graph.rootKey;\n    if (this.key === rootKey) {\n      return -1;\n    }\n    if (other.key === rootKey) {\n      return 1;\n    }\n    return coreValueCompare(this.name, other.name) || super.compare(other);\n  }\n}\n", "import * as SetUtils from '../../../../base/set.ts';\nimport { OnboardingStep } from '../../../base/scheme-versions.ts';\nimport { Vertex } from '../vertex.ts';\nimport { Workspace } from './workspace.ts';\n\nexport class UserSettings extends Vertex {\n  get passwordHash(): string | undefined {\n    return this.record.get<string>('passwordHash');\n  }\n\n  set passwordHash(p: string | undefined) {\n    if (p) {\n      this.record.set('passwordHash', p);\n    } else {\n      this.record.delete('passwordHash');\n    }\n  }\n\n  clearPasswordHash(): void {\n    this.record.delete('passwordHash');\n  }\n\n  get lastLoggedIn(): Date | undefined {\n    return this.record.get<Date>('lastLoggedIn');\n  }\n\n  set lastLoggedIn(d: Date | undefined) {\n    if (d !== undefined) {\n      this.record.set('lastLoggedIn', d);\n    } else {\n      this.record.delete('lastLoggedIn');\n    }\n  }\n\n  get seenTutorials(): Set<string> {\n    const seenTutorials = this.record.get('seenTutorials') as Set<string>;\n    if (seenTutorials === undefined || seenTutorials.size === 0) {\n      return new Set<string>();\n    }\n\n    const copy = SetUtils.map(seenTutorials, (v) => v);\n    return copy;\n  }\n\n  set seenTutorials(set: Set<string>) {\n    const copy = SetUtils.map(set, (v) => v);\n    this.record.set('seenTutorials', copy);\n  }\n\n  clearSeenTutorials(): void {\n    this.record.set('seenTutorials', new Set());\n  }\n\n  get workspaceColors(): Map<string, number> {\n    const workspaceColors = this.record.get('workspaceColors') as Map<\n      string,\n      number\n    >;\n    if (!workspaceColors) {\n      return new Map<string, number>();\n    }\n\n    const copy = new Map(workspaceColors.entries());\n    return copy;\n  }\n\n  set workspaceColors(map: Map<string, number>) {\n    const copy = new Map(map.entries());\n    this.record.set('workspaceColors', copy);\n  }\n\n  get hiddenWorkspaces(): Set<string> {\n    return this.record.get('hiddenWorkspaces');\n  }\n\n  set hiddenWorkspaces(set: Set<string>) {\n    this.record.set('hiddenWorkspaces', new Set(set));\n  }\n\n  get pinnedWorkspaces(): Set<string> {\n    return this.record.get('pinnedWorkspaces');\n  }\n\n  set pinnedWorkspaces(set: Set<string>) {\n    this.record.set('pinnedWorkspaces', new Set(set));\n  }\n\n  get onboardingStep(): OnboardingStep {\n    return this.record.get('onboardingStep', OnboardingStep.Start);\n  }\n\n  set onboardingStep(step: OnboardingStep) {\n    this.record.set('onboardingStep', step);\n  }\n}\n", "import { Record } from '../../../base/record.ts';\nimport { SchemeNamespace } from '../../../base/scheme-types.ts';\nimport { Vertex, VertexConfig } from '../vertex.ts';\nimport { VertexManager } from '../vertex-manager.ts';\nimport { Note } from './note.ts';\nimport { Tag } from './tag.ts';\nimport { User } from './user.ts';\nimport { Workspace } from './workspace.ts';\nimport { UserSettings } from './user-settings.ts';\n\nexport default function vertexBuilder(\n  manager: VertexManager,\n  record: Record,\n  prevVertex: Vertex | undefined,\n  config: VertexConfig | undefined\n): Vertex {\n  switch (record.scheme.namespace) {\n    case SchemeNamespace.WORKSPACE:\n      return new Workspace(manager, record, prevVertex, config);\n\n    case SchemeNamespace.USERS:\n      return new User(manager, record, prevVertex, config);\n\n    case SchemeNamespace.TAGS:\n      return new Tag(manager, record, prevVertex, config);\n\n    case SchemeNamespace.NOTES:\n      return new Note(manager, record, prevVertex, config);\n\n    case SchemeNamespace.USER_SETTINGS:\n      return new UserSettings(manager, record, prevVertex, config);\n\n    default:\n      return new Vertex(manager, record, prevVertex, config);\n  }\n}\n", "export const MAX_TS = 9007199254740991;\n/**\n * This file is home to time related utils. Delays, retry logic, timing\n * functions, etc. all belong in here.\n */\n\n/**\n * Executes a given function after the specified delay, similar to\n * setTimeout().\n *\n * @param delayMs The time to wait in milliseconds.\n * @param func The function to execute after the delay.\n *\n * @returns A promise holding the function's result.\n */\nexport function delay<T>(delayMs: number, func: () => T): Promise<T> {\n  if (delayMs <= 0) {\n    let reject: (err: any) => void, resolve: (v: T) => void;\n    const promise = new Promise<T>((res, rej) => {\n      reject = rej;\n      resolve = res;\n    });\n    queueMicrotask(() => {\n      try {\n        resolve(func());\n      } catch (e) {\n        reject(e);\n      }\n    });\n    return promise;\n  }\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      try {\n        resolve(func());\n      } catch (e) {\n        reject(e);\n      }\n    }, delayMs);\n  });\n}\n\nexport class RetryBaseErr extends Error {\n  constructor(readonly origError: any) {\n    super(origError instanceof Error ? origError.message : 'Unknown Error');\n  }\n}\n\nexport class TryAgain extends RetryBaseErr {}\n\nexport class NoRetry extends RetryBaseErr {}\n\n/**\n * Retry a given function and return its results.\n *\n * @param func The function to retry.\n * @param timeoutMs The timeout duration in milliseconds after which to give up.\n * @param maxDelayMs Maximum delay in milliseconds between retries.\n * @param timingFunc A timing function that spreads the retry attempts within\n *                   the given timeout duration.\n *\n * @returns The result of `func`.\n */\nexport async function retry<T>(\n  func: () => T | Promise<T>,\n  timeoutMs: number,\n  maxDelayMs = 20,\n  timingFunc: (factor: number) => number = easeInQuad\n): Promise<T> {\n  const startTime = Date.now();\n  let factor = 0;\n  let err: any = null;\n  do {\n    try {\n      return err === null || err instanceof TryAgain\n        ? await func()\n        : await delay(maxDelayMs * timingFunc(factor), func);\n    } catch (e) {\n      if (e instanceof NoRetry) {\n        throw e.origError;\n      }\n      err = e;\n    }\n    factor = (Date.now() - startTime) / timeoutMs;\n  } while (factor <= 1 || err instanceof TryAgain);\n\n  // If we got this far then we timed out on an error. Bubble it up.\n  throw err instanceof RetryBaseErr ? err.origError : err;\n}\n\nexport function clip(value: number, min: number = 0, max: number = 1): number {\n  return Math.max(min, Math.min(max, value));\n}\n\nexport function linear(factor: number): number {\n  return clip(factor);\n}\n\nexport function easeInQuad(factor: number): number {\n  return Math.pow(clip(factor), 2);\n}\n\nexport function easeInOutSine(factor: number): number {\n  return -(Math.cos(Math.PI * clip(factor)) - 1) / 2;\n}\n\nexport function secondsToMS(sec: number) {\n  return sec * 1000;\n}\n\nexport function minutesToMS(min: number) {\n  return min * 60 * 1000;\n}\n\nexport function hoursToMS(hours: number) {\n  return hours * 60 * 60 * 1000;\n}\n\nexport function daysToMS(days: number) {\n  return days * 24 * 60 * 60 * 1000;\n}\n\nexport function toReverseTimestamp(d: number | Date): number {\n  if (d instanceof Date) {\n    d = d.getTime();\n  }\n  return MAX_TS - d;\n}\n\nexport function fromReverseTimestamp(ts: number): Date {\n  const d = new Date();\n  d.setTime(MAX_TS - ts);\n  return d;\n}\n", "/**\n * Performs a binary search over a sorted array.\n * @param arr The array to search.\n * @param value The value to search.\n * @param comparator function receiving two arguments and\n *                   returning a number. It must return zero if the two\n *                   values are equal, a positive value if the first\n *                   argument is greater than the second, and a negative\n *                   value otherwise. The first argument is the searched\n *                   value while the second argument is the value form\n *                   the array.\n *\n * @returns The index closest to the searched value. You should\n *                   test whether the value at the value at the returned index\n *                   is equal to the searched value. If not, the value doesn't\n *                   exist in the array.\n */\nexport function bsearch<T>(\n  arr: T[],\n  value: T,\n  comparator: (x: T, y: T) => number = (x, y) => (x > y ? 1 : x < y ? -1 : 0)\n): number {\n  if (!arr || arr.length <= 0) {\n    return 0;\n  }\n\n  let start = 0;\n  let end = arr.length - 1;\n  while (start < end) {\n    const mid = ((start + end) / 2) | 0;\n    const r = comparator(value, arr[mid]);\n    if (r === 0) {\n      return mid;\n    }\n    if (r < 0) {\n      end = mid - 1;\n    } else {\n      start = mid + 1;\n    }\n  }\n  // Fixup the result so it's always \"before\" the target index enabling\n  // standard array ops on the unmodified result.\n  return comparator(value, arr[start]) > 0 ? start + 1 : start;\n}\n\nexport function bsearch_idx(\n  length: number,\n  comparator: (idx: number) => number = idx => {\n    throw new Error('Bad comparator');\n  }\n): number {\n  if (!length) {\n    return -1;\n  }\n\n  let start = 0;\n  let end = length - 1;\n  while (start < end) {\n    const mid = ((start + end) / 2) | 0;\n    const r = comparator(mid);\n    if (!r) {\n      return mid;\n    }\n    if (r < 0) {\n      end = mid - 1;\n    } else {\n      start = mid + 1;\n    }\n  }\n  return start;\n}\n", "import { bsearch } from '../algorithms.ts';\n\nfunction defaultComparator<T>(a: T, b: T): number {\n  return (a as any) - (b as any);\n}\n\nfunction defaultEQ<T>(a: T, b: T): boolean {\n  return a === b;\n}\n\nexport class SortedQueue<T> {\n  readonly _arr: T[]; // TODO: Use a binary tree\n  readonly _comparator: (x: T, y: T) => number;\n  readonly _eq: (a: T, y: T) => boolean;\n\n  constructor(\n    comparator?: (x: T, y: T) => number,\n    eq?: (a: T, y: T) => boolean\n  ) {\n    this._arr = [];\n    this._comparator = comparator || defaultComparator;\n    this._eq = eq || defaultEQ;\n  }\n\n  get size(): number {\n    return this._arr.length;\n  }\n\n  get peek(): T | undefined {\n    return this._arr[this._arr.length - 1];\n  }\n\n  push(v: T): void {\n    const arr = this._arr;\n    const idx = bsearch(arr, v, this._comparator);\n    if (idx >= arr.length || !this._eq(arr[idx], v)) {\n      this._arr.splice(idx, 0, v);\n    }\n  }\n\n  pop(): T | undefined {\n    return this._arr.pop();\n  }\n\n  delete(v: T): boolean {\n    const arr = this._arr;\n    const idx = bsearch(arr, v, this._comparator);\n    if (idx < arr.length && this._eq(arr[idx], v)) {\n      arr.splice(idx, 1);\n      return true;\n    }\n    return false;\n  }\n\n  has(v: T): boolean {\n    const arr = this._arr;\n    const idx = bsearch(arr, v, this._comparator);\n    return idx < arr.length && this._eq(arr[idx], v);\n  }\n}\n", "/**\n * Here you'll find a convenience implementation of Non-Preemptive Multitasking\n * https://en.wikipedia.org/wiki/Cooperative_multitasking aka Coroutines.\n *\n * At the heart of a coroutine sits a Generator, which is the native mechanism\n * for voluntarily jumping between execution contexts. A generator is then\n * wrapped by a Coroutine instance which manages its thread-like state of\n * executing. It also exposes itself as a Promise which further simplifies\n * real world interactions.\n *\n * Finally the CoroutineScheduler manages a pool of concurrently running\n * coroutines. Every event loop cycle the scheduler executes some coroutines\n * while watching the clock. After kSchedulerCycleTimeMs it'll stop execution\n * and return control to the browser's event loop. This has the apparent effect\n * of threads running concurrently to the main UI thread in a true shared memory\n * model.\n */\n\nimport { NextEventLoopCycleTimer, Timer } from './timer.ts';\n\n// Hopefully the UI is running at 60 fps\nconst kSingleFrameMs = 1000 / 60;\n// 1/3 of a frame every event loop cycle\nconst kSchedulerCycleTimeMs = kSingleFrameMs / 3;\n\n/**\n * Coroutines wrapped as promises support cancellation out of the box\n */\nexport interface CancellablePromise<T> extends Promise<T> {\n  /**\n   * Registers a cancellation request with the running coroutine.\n   */\n  cancel(): void;\n\n  cancelImmediately(): void;\n}\n\nlet gActiveCoroutine: Coroutine | undefined;\n\nexport class Coroutine<T = unknown> {\n  readonly name: string | undefined;\n  private readonly _generator: Generator<T, T>;\n  private _doneHandler: (v: T | undefined) => void;\n  private _timeSpentMs: number;\n  private _completed: boolean;\n  private _cancelled = false;\n  private _value: T | undefined;\n\n  /**\n   * Pack a generator as a Coroutine instance. This method is designed be used\n   * from within a scheduler, and not as a general use.\n   *\n   * @param id   The id of this routine, as assigned by the scheduler.\n   *\n   * @param g    The underlying generator.\n   *             Values yielded or returned are ignored.\n   *\n   * @param name An optional name for identifying this coroutine in logs.\n   *\n   * @returns A new Coroutine instance and an accompanying promise that wraps\n   *          it.\n   */\n  static pack<T = unknown>(\n    id: number,\n    g: Generator<T, T>,\n    name?: string\n  ): [Coroutine<T>, CancellablePromise<T>] {\n    let resolve: (v: T | undefined) => void;\n    const promise = new Promise<T>((res) => {\n      resolve = res as (v: T | undefined) => void;\n    });\n    const coroutine = new Coroutine<T>(id, g, resolve!, name);\n    (promise as CancellablePromise<T>).cancel = () => coroutine.cancel();\n    (promise as CancellablePromise<T>).cancelImmediately = () =>\n      coroutine.cancelImmediately();\n    return [coroutine, promise as CancellablePromise<T>];\n  }\n\n  /**\n   * Returns the currently executing Coroutine.\n   *\n   * @returns The current coroutine or undefined if called outside a coroutine.\n   */\n  static current<X>(): Coroutine<X> | undefined {\n    return gActiveCoroutine as Coroutine<X>;\n  }\n\n  /**\n   * Initializes a new Coroutine.\n   *\n   * @param id          The id of this routine, as assigned by the scheduler.\n   *\n   * @param generator   The underlying generator.\n   *                    Values yielded or returned are ignored.\n   *\n   * @param doneHandler An optional handler that'll be called once this\n   *                    coroutine transitions to a done status. This handler is\n   *                    called at most once.\n   *\n   * @param name        An optional name for identifying this coroutine in logs.\n   */\n  constructor(\n    readonly id: number,\n    generator: Generator<T, T>,\n    doneHandler: (v: T | undefined) => void,\n    name?: string\n  ) {\n    this._generator = generator;\n    this._doneHandler = doneHandler;\n    this._timeSpentMs = 0;\n    this._completed = false;\n    this.name = name;\n  }\n\n  /**\n   * Returns whether this routine has completed its execution and returned\n   * control to its caller. A completed coroutine will never be executed again\n   * as the underlying generator had been exhausted.\n   */\n  get completed(): boolean {\n    return this._completed;\n  }\n\n  /**\n   * Returns true after a call to cancel() had been made. It's up to the\n   * executing code to periodically check this flag and exit early if possible.\n   * This is done to provide the running code a chance to run any needed\n   * cleanups before cancelling.\n   */\n  get cancelled(): boolean {\n    return !this._cancelled;\n  }\n\n  /**\n   * Returns whether this routine should run in a future iteration of a\n   * scheduler. Code inside the a running coroutine may use this flag to guard\n   * against all kinds of edge cases like this:\n   * `\n   * if (Coroutine.current()?.shouldRun !== true) {\n   *    // run any cleanups here\n   *    return;\n   * }\n   * `\n   */\n  get shouldRun(): boolean {\n    return !this.completed && !this.cancelled;\n  }\n\n  /**\n   * Returns the last yielded value from the underlying generator, or its return\n   * value on completion.\n   */\n  get value(): T | undefined {\n    return this._value;\n  }\n\n  /**\n   * Registers a cancellation request with the running code, which may respect\n   * it or not. This is the preferred method for cancelling coroutines, since\n   * it gives the executing code a chance to run cleanups before exiting.\n   */\n  cancel(): void {\n    this._cancelled = true;\n  }\n\n  /**\n   * Cancels this coroutine immediately, causing it to never execute again.\n   * If called from within the running coroutine, this method makes the next\n   * `yield` act the same as `return`.\n   *\n   * @warning This method doesn't give the running code chance to do any\n   *          cleanups and thus must be used with care. Prefer to use `cancel()`\n   *          when possible.\n   */\n  cancelImmediately(): void {\n    if (this._completed) {\n      return;\n    }\n    this._completed = true;\n    this._cancelled = true;\n    this._doneHandler(this.value);\n  }\n\n  /**\n   * Although this method is public, it shouldn't be called directly unless\n   * you're building an alternative scheduler.\n   *\n   * Each call to this method runs the underlying generator until its next call\n   * to `yield` or `return`.\n   */\n  run(): void {\n    if (this._completed) {\n      return;\n    }\n    gActiveCoroutine = this as Coroutine<unknown>;\n    const res = this._generator.next();\n    gActiveCoroutine = undefined;\n    this._value = res.value;\n    if (res.done === true) {\n      this._completed = true;\n      this._doneHandler(this.value);\n    }\n  }\n\n  /**\n   * Compare two coroutines to determine their execution order. Used by\n   * schedulers to order running coroutines.\n   *\n   * @param other The Coroutine to compare to.\n   *\n   * @returns A positive number if `other` needs to be executed before `this`,\n   *          a negative number if `this` needs to be executed before `other`,\n   *          zero if the execution order is undetermined.\n   */\n  compare(other: Coroutine): number {\n    if (other === this) {\n      return 0;\n    }\n    // First, prioritize by time spent running. We prioritize routines that\n    // spent less time running, to avoid starvation of short lived routines.\n    //\n    // NOTE: Due to security concerns, our actual measuring accuracy is actually\n    // limited to about 1-2ms, thus this is more of a rough estimation than\n    // an accurate running time.\n    const dt = Math.round(other._timeSpentMs - this._timeSpentMs);\n    if (dt !== 0) {\n      return dt;\n    }\n    // If running times are the same, place newer routines (larger ids) before\n    // older ones (smaller ids), again to avoid starvation.\n    return other.id - this.id;\n  }\n\n  /**\n   * Used by a scheduler to increase the running time of this routine.\n   *\n   * @param dt Number of milliseconds of execution to add.\n   */\n  appendExecutionTime(dt: number): void {\n    this._timeSpentMs += dt;\n  }\n}\n\nfunction compareCoroutines(c1: Coroutine, c2: Coroutine): number {\n  return c1.compare(c2);\n}\n\n/**\n * Schedulers support a few priority values that better allow them to prioritize\n * coroutines.\n */\nexport enum SchedulerPriority {\n  /**\n   * Default priority. Use for Coroutines that directly tie to user\n   * interactions. Whenever a `Normal` Coroutine is scheduled, it temporarily\n   * pauses all `Background` Coroutines.\n   *\n   */\n  Normal = 0,\n  /**\n   * Reduced priority for tasks that don't need to be urgently finished and\n   * take longer to complete. Background coroutines are executed only after all\n   * `Normal` priority coroutines finished executing.\n   */\n  Background,\n  _Count,\n}\n\n/**\n * An abstract definition of a Coroutine scheduler.\n */\nexport interface Scheduler {\n  schedule<T>(\n    g: Generator<T, T>,\n    priority?: SchedulerPriority,\n    name?: string\n  ): CancellablePromise<T>;\n}\n\n/**\n * A basic scheduler. It executes Coroutines concurrently, by their time spent\n * and age, and ticks in every event loop cycle.\n *\n * NOTE: You may have as many scheduler instances as you'd like, but you'll\n * have to tune their cycle times so they don't slow down the UI and cause\n * dropped frames. The current implementation is tuned for a single, shared,\n * scheduler.\n */\nexport class CoroutineScheduler implements Scheduler {\n  private readonly _timer: Timer;\n  private readonly _cycleTimeMs: number;\n  private _scheduledCoroutines: Coroutine<unknown>[][]; // priority -> Coroutine[]\n  private _coroutineId: number;\n\n  /**\n   * @returns The default, shared, scheduler instance.\n   */\n  static sharedScheduler(): CoroutineScheduler {\n    return kSharedScheduler;\n  }\n\n  /**\n   * Initializes a new scheduler.\n   *\n   * @param cycleTimeMs A time limit, in milliseconds, for a single execution\n   *                    cycle after which the scheduler will return control\n   *                    to the browser's event loop. You only need to change\n   *                    this value if you have more than one scheduler.\n   */\n  constructor(cycleTimeMs = kSchedulerCycleTimeMs) {\n    this._cycleTimeMs = cycleTimeMs;\n    this._scheduledCoroutines = [];\n    for (let priority = 0; priority < SchedulerPriority._Count; ++priority) {\n      this._scheduledCoroutines.push([]);\n    }\n    this._timer = new NextEventLoopCycleTimer(() => this.tick());\n    this._coroutineId = 0;\n  }\n\n  /**\n   * Execute coroutines in a loop until the time limit reaches or no coroutines\n   * are left in the queue.\n   *\n   * @param queue The queue of pending coroutines.\n   *\n   * @param timeLimitMs A soft time limit for execution.\n   *\n   * NOTE: Browsers limit our time measuring accuracy for security reasons.\n   *       This combined with the cooperative nature of our coroutines makes\n   *       the time limit a very soft one. Choosing the value too high will\n   *       cause UI lag, while choosing too low causes unneeded overhead and\n   *       slower completion of the queue (from a wall clock perspective).\n   */\n  private _executeFromQueue(queue: Coroutine[], timeLimitMs: number): void {\n    const startTime = getRelativeTimestamp();\n    const executedCoroutines = new Set<Coroutine>();\n    // Sort our queue to reflect the correct execution order.\n    queue.sort(compareCoroutines);\n    // Run for as long as we have work to do and time to do it\n    while (\n      queue.length > 0 &&\n      getRelativeTimestamp() - startTime < timeLimitMs\n    ) {\n      const c = queue.shift()!;\n      c.run();\n      executedCoroutines.add(c);\n      if (!c.completed) {\n        queue.push(c);\n      }\n    }\n    // Since we have very poor time measuring accuracy, we instead estimate\n    // an average execution time for all Coroutines that did something in this\n    // cycle. While not the most accurate, it's good enough to provide a\n    // relatively fair execution plan.\n    const avgRunningTime =\n      (getRelativeTimestamp() - startTime) / executedCoroutines.size;\n    for (const c of executedCoroutines) {\n      c.appendExecutionTime(avgRunningTime);\n    }\n  }\n\n  /**\n   * Do a single \"tick\" in this event loop cycle. This executed any schedules\n   * routines.\n   *\n   * @returns true if executed something, false if no Coroutines are scheduled.\n   */\n  private tick(): boolean {\n    const normalStartTime = getRelativeTimestamp();\n    const normalQueue = this._scheduledCoroutines[SchedulerPriority.Normal];\n    const backgroundQueue =\n      this._scheduledCoroutines[SchedulerPriority.Background];\n    this._executeFromQueue(normalQueue, this._cycleTimeMs);\n    const backgroundRunTime =\n      this._cycleTimeMs - (getRelativeTimestamp() - normalStartTime);\n    if (backgroundRunTime > 0) {\n      this._executeFromQueue(backgroundQueue, backgroundRunTime);\n    }\n    return normalQueue.length > 0 || backgroundQueue.length > 0;\n  }\n\n  /**\n   * Schedules a generator as a coroutine, and returns a promise for its\n   * execution.\n   *\n   * @param g The generator to wrap as Coroutine.\n   *\n   * @param priority The desired execution priority.\n   *\n   * @param name An optional name used for debugging and logging.\n   *\n   * @returns A cancellable promise for the coroutine.\n   */\n  schedule<T = unknown>(\n    g: Generator<T, T>,\n    priority: SchedulerPriority = SchedulerPriority.Normal,\n    name?: string\n  ): CancellablePromise<T> {\n    const [coroutine, promise] = Coroutine.pack<T>(\n      ++this._coroutineId,\n      g,\n      name\n    );\n    const queue = this._scheduledCoroutines[priority];\n    queue.push(coroutine as Coroutine<unknown>);\n    this._timer.schedule();\n    return promise;\n  }\n\n  /**\n   * Maps the given iterator to an array using the mapper function.\n   * The resulting coroutine may be cancelled safely at any time, and its result\n   * will contain a partial array up to the cancellation point.\n   *\n   * @param iter The iterable to map.\n   * @param mapper The mapping function.\n   * @param priority The priority for the newly created coroutine.\n   * @param name An optional name for the newly created coroutine.\n   *\n   * @returns A cancelable promise for the newly scheduled coroutine.\n   */\n  map<T, O = T>(\n    iter: Iterable<T>,\n    mapper: (v: T) => O,\n    priority = SchedulerPriority.Normal,\n    name?: string\n  ): CancellablePromise<O[]> {\n    return this.schedule(mapGenerator(iter, mapper), priority, name);\n  }\n}\n\nconst kSharedScheduler = new CoroutineScheduler();\n\nfunction* mapGenerator<T, O = T>(\n  iter: Iterable<T>,\n  mapper: (v: T) => O\n): Generator<O[], O[]> {\n  const result: O[] = [];\n  for (const v of iter) {\n    result.push(mapper(v));\n    yield result;\n  }\n  return result;\n}\n\n/**\n * While CoroutineScheduler executes coroutines concurrently, sometimes you need\n * serial execution of a specific list of coroutines. CoroutineQueue enables\n * just that - a serial execution queue of coroutines.\n *\n * Coroutines scheduled with a CoroutineQueue are executed one at a time, in\n * the order in which they were scheduled. A new coroutine will start execution\n * only after the previously scheduled coroutine had completed execution.\n *\n * This class relies on an underlying scheduler for the actual execution. The\n * queue appears as a single, potentially long running, coroutine for the\n * underlying scheduler and thus uses a single, fixed, priority for the queue.\n */\nexport class CoroutineQueue implements Scheduler {\n  readonly scheduler: Scheduler;\n  readonly priority: SchedulerPriority;\n  private readonly _queue: Coroutine[];\n  private _id: number;\n\n  /**\n   * Initialize a new serial execution queue.\n   *\n   * @param scheduler The scheduler in which this entire queue will be\n   *                  scheduled. If not provided, the shared CoroutineScheduler\n   *                  instance will be used.\n   *\n   * @param priority  The execution priority for this entire queue.\n   */\n  constructor(\n    scheduler?: Scheduler,\n    priority: SchedulerPriority = SchedulerPriority.Normal\n  ) {\n    this.scheduler = scheduler || CoroutineScheduler.sharedScheduler();\n    this.priority = priority;\n    this._queue = [];\n    this._id = 0;\n  }\n\n  /**\n   * Returns the number of coroutines currently scheduled in this queue.\n   */\n  get size(): number {\n    return this._queue.length;\n  }\n\n  /**\n   * Schedules (appends) a new coroutine to this queue.\n   *\n   * @param g The generator to wrap as Coroutine.\n   *\n   * @param _priority Ignored. The scheduled coroutine uses the queue's priority\n   *                  regardless of the provided value.\n   *\n   * @param name An optional name used for debugging and logging.\n   *\n   * @returns A cancellable promise for the coroutine.\n   */\n  schedule<T = unknown>(\n    g: Generator<T, T>,\n    _priority?: SchedulerPriority,\n    name?: string\n  ): CancellablePromise<T> {\n    const [coroutine, promise] = Coroutine.pack<T>(++this._id, g, name);\n    this._queue.push(coroutine as Coroutine<unknown>);\n    if (this._queue.length === 1) {\n      this.scheduler.schedule(this._workCoroutine(), this.priority);\n    }\n    return promise;\n  }\n\n  private *_workCoroutine(): Generator<void> {\n    for (\n      let coroutine = this._queue.pop();\n      coroutine !== undefined;\n      coroutine = this._queue.pop()\n    ) {\n      while (!coroutine.completed) {\n        coroutine.run();\n        yield;\n      }\n    }\n  }\n}\n\nconst kTimestampReadingThrottle = 150;\nlet gTimestampCounter = 0;\nlet gPrevTimestamp = 0;\n\n/**\n * It turns out that we're calling performance.now() a lot, which makes the\n * cost of the call relatively high compared to the time spent doing actual\n * work. To avoid this, we sample the clock once every K calls, and return the\n * cached value otherwise.\n *\n * @returns A monotonically increasing value, in milliseconds, of execution\n *          time. The time origin is left as an implementation detail and\n *          shouldn't be counted on.\n */\nfunction getRelativeTimestamp(): number {\n  if (gTimestampCounter === 0) {\n    gPrevTimestamp = Math.max(performance.now(), gPrevTimestamp);\n  }\n  gTimestampCounter = (gTimestampCounter + 1) % kTimestampReadingThrottle;\n  return gPrevTimestamp;\n}\n", "import { assert } from './error.ts';\nimport { easeInOutSine } from './time.ts';\nimport { SortedQueue } from './collections/queue.ts';\nimport { Scheduler, SchedulerPriority } from './coroutine.ts';\n\nconst MAX_TIMER_PROCESSING_MS = 30;\n\nconst gScheduledTimers = new SortedQueue<BaseTimer>(\n  (t1: BaseTimer, t2: BaseTimer) => t1.compare(t2)\n);\nlet gTimerTicker: number | undefined;\nlet gTimerId = 0;\n\nfunction startTimerTickerIfNeeded(): void {\n  if (!gTimerTicker && gScheduledTimers.size > 0) {\n    gTimerTicker = setInterval(() => {\n      const startTime = performance.now();\n\n      for (\n        let now = performance.now();\n        now - startTime <= MAX_TIMER_PROCESSING_MS;\n        now = performance.now()\n      ) {\n        if (\n          gScheduledTimers.size > 0 &&\n          gScheduledTimers.peek!.nextFireTimestamp <= now\n        ) {\n          const timer = gScheduledTimers.pop();\n          assert(timer !== undefined);\n          assert(!gScheduledTimers.has(timer!));\n          timer!.fire();\n        } else {\n          break;\n        }\n      }\n    }, 20);\n  }\n}\n\nfunction stopTimerTickerIfNeeded() {\n  if (gTimerTicker && gScheduledTimers.size <= 0) {\n    clearInterval(gTimerTicker);\n    gTimerTicker = undefined;\n  }\n}\n\nexport interface TimerCallback {\n  (timer: Timer): boolean | undefined | void | Promise<void | undefined>;\n}\n\nexport interface Timer {\n  schedule(): Timer;\n  unschedule(): Timer;\n}\n\n/**\n * An application level timer that internally uses a single setTimeout.\n * This enables holding thousands of active timers without overloading the\n * browser's event loop.\n */\nexport abstract class BaseTimer implements Timer {\n  readonly label: string | undefined;\n  private readonly _callback: TimerCallback;\n  private readonly _id: number;\n  private _nextFireTimestamp: number;\n  private _isScheduled: boolean;\n\n  constructor(callback: TimerCallback, label?: string | undefined) {\n    this.label = label;\n    this._callback = callback;\n    this._nextFireTimestamp = 0;\n    this._id = gTimerId++;\n    this._isScheduled = false;\n  }\n\n  get nextFireTimestamp(): number {\n    return this._nextFireTimestamp;\n  }\n\n  get isScheduled(): boolean {\n    return this._isScheduled;\n  }\n\n  protected abstract calcNextFireDate(): number;\n\n  compare(other: BaseTimer): number {\n    if (other === this) {\n      return 0;\n    }\n    const dt = other._nextFireTimestamp - this._nextFireTimestamp;\n    return dt === 0 ? this._id - other._id : dt;\n  }\n\n  schedule(): Timer {\n    if (gScheduledTimers.has(this)) {\n      assert(this._isScheduled);\n      return this;\n    }\n    this._nextFireTimestamp = this.calcNextFireDate();\n    gScheduledTimers.push(this);\n    assert(!this._isScheduled);\n    this._isScheduled = true;\n    startTimerTickerIfNeeded();\n    return this;\n  }\n\n  unschedule(): Timer {\n    if (gScheduledTimers.delete(this)) {\n      this._isScheduled = false;\n    }\n    stopTimerTickerIfNeeded();\n    return this;\n  }\n\n  fire(): void {\n    assert(this._isScheduled);\n    this._isScheduled = false;\n    if (this.run()) {\n      this.schedule();\n    } else {\n      stopTimerTickerIfNeeded();\n    }\n  }\n\n  protected run(): boolean {\n    return this._callback(this) === true;\n  }\n}\n\n/**\n * A simple fixed timer. It'll fire either once or repeatedly until explicitly\n * unscheduled.\n */\nexport class SimpleTimer extends BaseTimer {\n  private readonly _intervalMs: number;\n  private readonly _repeat: boolean;\n\n  static once(\n    delayMs: number,\n    callback: TimerCallback,\n    name?: string\n  ): SimpleTimer {\n    return new SimpleTimer(\n      delayMs,\n      false,\n      callback,\n      name\n    ).schedule() as SimpleTimer;\n  }\n\n  constructor(\n    intervalMs: number,\n    repeat: boolean,\n    callback: TimerCallback,\n    name?: string\n  ) {\n    super(callback, name);\n    this._intervalMs = intervalMs;\n    this._repeat = repeat;\n  }\n\n  get intervalMs(): number {\n    return this._intervalMs;\n  }\n\n  protected calcNextFireDate(): number {\n    return performance.now() + this._intervalMs;\n  }\n\n  protected run(): boolean {\n    const result = super.run();\n    return this._repeat || result;\n  }\n}\n\n/**\n * Base timer for timers that dynamically change their fire interval between\n * a specified range.\n */\nexport abstract class BaseDynamicTimer extends BaseTimer {\n  private readonly _durationMs: number;\n  private readonly _minFreqMs: number;\n  private readonly _maxFreqMs: number;\n  private _repeat: boolean;\n  private _lastResetTime: number;\n  private _lastFireTime: number;\n\n  constructor(\n    minFreqMs: number,\n    maxFreqMs: number,\n    durationMs: number,\n    callback: TimerCallback,\n    repeat = false,\n    name?: string\n  ) {\n    super(callback, name);\n    this._lastResetTime = performance.now();\n    this._durationMs = durationMs;\n    this._lastFireTime = 0;\n    this._minFreqMs = minFreqMs;\n    this._maxFreqMs = maxFreqMs;\n    this._repeat = repeat;\n  }\n\n  abstract timingFunc(f: number): number;\n\n  get minFreqMs(): number {\n    return this._minFreqMs;\n  }\n\n  get maxFreqMs(): number {\n    return this._maxFreqMs;\n  }\n\n  get lastTriggerTime(): number {\n    return this._lastFireTime;\n  }\n\n  get durationMs(): number {\n    return this._durationMs;\n  }\n\n  get lastResetTime(): number {\n    return this._lastResetTime;\n  }\n\n  get repeat(): boolean {\n    return this._repeat;\n  }\n\n  set repeat(flag: boolean) {\n    this._repeat = flag;\n  }\n\n  reset(): void {\n    this._lastResetTime = performance.now();\n  }\n\n  schedule(): BaseDynamicTimer {\n    return super.schedule() as BaseDynamicTimer;\n  }\n\n  unschedule(): BaseDynamicTimer {\n    return super.unschedule() as BaseDynamicTimer;\n  }\n\n  protected run(): boolean {\n    const { durationMs, lastResetTime } = this;\n    const now = performance.now();\n    if (!this.repeat && now - lastResetTime > durationMs) {\n      return false;\n    }\n    this._lastFireTime = now;\n    return super.run() || this.repeat;\n  }\n\n  protected calcNextFireDate(): number {\n    const now = performance.now();\n    const { minFreqMs, maxFreqMs, durationMs } = this;\n    const f = Math.min(1, (now - this.lastResetTime) / durationMs);\n    // Sleep duration between syncs moves gradually from MIN to MAX\n    const freqDiff = maxFreqMs - minFreqMs;\n    const sleepDur = minFreqMs + this.timingFunc(f) * freqDiff;\n    return now + sleepDur;\n  }\n}\n\n/**\n * A dynamic timer that uses a sine function to adjust its fire interval.\n */\nexport class EaseInOutSineTimer extends BaseDynamicTimer {\n  timingFunc(f: number): number {\n    return easeInOutSine(f);\n  }\n}\n\n/**\n * A timer like implementation of a micro task. This timer fires at the end of\n * the current event loop. The exact fire timing between two micro task timers\n * is undefined.\n */\nexport class MicroTaskTimer implements Timer {\n  private readonly _callback: TimerCallback;\n  private _hasScheduledMicrotask: boolean;\n  private _scheduled: boolean;\n\n  constructor(callback: TimerCallback) {\n    this._callback = callback;\n    this._hasScheduledMicrotask = false;\n    this._scheduled = false;\n  }\n\n  schedule(): Timer {\n    if (this._scheduled) {\n      return this;\n    }\n    this._scheduled = true;\n    // The caller is allowed to do crazy calls like\n    //     schedule();\n    //     unschedule();\n    //     schedule();\n    // Instead of blindly queueing a microtask, we keep track of whether we\n    // have a queued task or not and enqueue it only when needed.\n    if (!this._hasScheduledMicrotask) {\n      queueMicrotask(() => {\n        this._hasScheduledMicrotask = false;\n        // Trigger our callback only if we're still scheduled by the time this\n        // microtask executes.\n        if (this._scheduled) {\n          this._scheduled = false;\n          if (this._callback(this) === true) {\n            this.schedule();\n          }\n        }\n      });\n      this._hasScheduledMicrotask = true;\n    }\n    return this;\n  }\n\n  unschedule(): Timer {\n    // At the time of this writing there's no API for cancelling a queued\n    // microtask. To simulate it, we simply flip off our scheduled flag. When\n    // the microtask it'll simply be a NOP.\n    this._scheduled = false;\n    return this;\n  }\n}\n\nlet gScheduledNextEventLoopCycleTimers: NextEventLoopCycleTimer[] = [];\nlet gScheduledTimeoutHandler: number | undefined;\n\nfunction processPendingNextEventLoopTimers(): void {\n  const scheduledTimers = gScheduledNextEventLoopCycleTimers;\n  gScheduledNextEventLoopCycleTimers = [];\n  gScheduledTimeoutHandler = undefined;\n  for (const timer of scheduledTimers) {\n    timer._fire();\n  }\n}\n\n/**\n * A timer like implementation of a micro task. This timer fires at the end of\n * the current event loop. The exact fire timing between two micro task timers\n * is fuzzy.\n *\n * Prefer to use a CoroutineTimer timer instead of this class as it allows the\n * scheduler to better balance the app's work.\n */\nexport class NextEventLoopCycleTimer implements Timer {\n  private readonly _callback: TimerCallback;\n\n  constructor(callback: TimerCallback) {\n    this._callback = callback;\n  }\n\n  schedule(): Timer {\n    if (gScheduledNextEventLoopCycleTimers.indexOf(this) < 0) {\n      gScheduledNextEventLoopCycleTimers.push(this);\n      if (gScheduledTimeoutHandler === undefined) {\n        gScheduledTimeoutHandler = setTimeout(\n          processPendingNextEventLoopTimers\n        );\n      }\n    }\n    return this;\n  }\n\n  unschedule(): Timer {\n    const idx = gScheduledNextEventLoopCycleTimers.indexOf(this);\n    if (idx >= 0) {\n      gScheduledNextEventLoopCycleTimers.splice(idx, 1);\n      if (\n        gScheduledNextEventLoopCycleTimers.length === 0 &&\n        gScheduledTimeoutHandler !== undefined\n      ) {\n        clearTimeout(gScheduledTimeoutHandler);\n        gScheduledTimeoutHandler = undefined;\n      }\n    }\n    return this;\n  }\n\n  _fire(): void {\n    if (this._callback(this) === true) {\n      this.schedule();\n    }\n  }\n}\n\n/**\n * An coroutine based implementation of a NextEventLoopCycleTimer. This timer\n * is managed by a CoroutineScheduler, increasing processing responsiveness.\n *\n * Prefer to use this timer over NextEventLoopCycleTimer whenever possible.\n */\nexport class CoroutineTimer implements Timer {\n  private readonly _callback: TimerCallback;\n  private _scheduled: boolean;\n\n  constructor(\n    readonly scheduler: Scheduler,\n    callback: TimerCallback,\n    readonly priority: SchedulerPriority = SchedulerPriority.Normal,\n    readonly name?: string\n  ) {\n    this._callback = callback;\n    this._scheduled = false;\n  }\n\n  schedule(): Timer {\n    if (!this._scheduled) {\n      this._scheduled = true;\n      this.scheduler.schedule(this._run(), this.priority, this.name);\n    }\n    return this;\n  }\n\n  unschedule(): Timer {\n    this._scheduled = false;\n    return this;\n  }\n\n  private *_run(): Generator<void> {\n    const callback = this._callback;\n    while (true) {\n      if (!this._scheduled || callback(this) !== true) {\n        this._scheduled = false;\n        return;\n      }\n      yield;\n    }\n  }\n}\n", "import EventEmitter from 'https://esm.sh/eventemitter3@4.0.7';\nimport { Record } from '../../base/record.ts';\nimport { Scheme } from '../../base/scheme.ts';\nimport { GraphManager } from './graph-manager.ts';\nimport {\n  MutationPack,\n  mutationPackIter,\n  mutationPackAppend,\n  mutationPackIsEmpty,\n  mutationPackOptimize,\n} from './mutations.ts';\nimport { RichText } from '../../richtext/tree.ts';\nimport {\n  Comparable,\n  CoreObject,\n  CoreValue,\n  coreValueCompare,\n  coreValueEquals,\n  coreValueClone,\n  Equatable,\n} from '../../../base/core-types/index.ts';\nimport vertexBuilder from './vertices/vertex-builder.ts';\nimport { SimpleTimer } from '../../../base/timer.ts';\nimport { VertexSnapshot } from './types.ts';\nimport { PointerValue, projectPointers } from '../../richtext/flat-rep.ts';\nimport { ValueType } from '../../base/types/index.ts';\nimport { assert } from '../../../base/error.ts';\nimport {\n  extractFieldRefs,\n  kNoRefsValue,\n  Vertex,\n  VertexConfig,\n} from './vertex.ts';\nimport * as SetUtils from '../../../base/set.ts';\nimport { kRecordIdField } from '../../base/scheme-types.ts';\nimport { MemRepoStorage, Repository } from '../../../repo/repo.ts';\nimport { Dictionary, isDictionary } from '../../../base/collections/dict.ts';\nimport { targetRange } from 'https://esm.sh/v99/slate-react@0.87.1/dist/utils/diff-text.d.ts';\n\nexport const K_VERT_DEPTH = 'depth';\n\nexport type Edge = [key: string, fieldName: string];\n\nexport interface RefsChange {\n  added: Edge[];\n  removed: Edge[];\n}\n\n/**\n * Fired after a vertex has changed any of its values.\n *\n * @param changes (MutationPack): The list of mutations that'd been applied.\n */\nexport const EVENT_DID_CHANGE = 'did-change';\n\n/**\n * Fired after a vertex receives a critical error, like bad request error response\n */\nexport const EVENT_CRITICAL_ERROR = 'critical-error';\n\nexport interface VertexBuilder {\n  (\n    manager: VertexManager,\n    record: Record,\n    prevVertex: Vertex | undefined,\n    config: VertexConfig | undefined\n  ): Vertex;\n}\n\ninterface DynamicFieldsSnapshot {\n  readonly hasPendingChanges: boolean;\n  readonly isLocal: boolean;\n}\n\nlet gVertexBuilder: VertexBuilder = vertexBuilder;\n\nexport class VertexManager<V extends Vertex = Vertex>\n  extends EventEmitter\n  implements Comparable<VertexManager>, Equatable<VertexManager>\n{\n  private readonly _graph: GraphManager;\n  private readonly _key: string;\n  private readonly _vertexConfig: VertexConfig;\n  private readonly _commitDelayTimer: SimpleTimer;\n  private _record: Record;\n  private _vertex!: Vertex;\n  private _revocableProxy?: { proxy: Vertex; revoke: () => void };\n\n  static setVertexBuilder(f: VertexBuilder): void {\n    gVertexBuilder = f;\n  }\n\n  constructor(\n    graph: GraphManager,\n    key: string,\n    initialState?: Record,\n    local?: boolean\n  ) {\n    super();\n    this._graph = graph;\n    this._key = key;\n    this._vertexConfig = {\n      isLocal: local === true,\n    };\n    this._commitDelayTimer = new SimpleTimer(300, false, () => this.commit());\n    const repo = this.repository;\n    this._record = initialState || repo.valueForKey(this.key, graph.session);\n    this.rebuildVertex();\n    this.reportInitialFields(true);\n  }\n\n  /********************************/\n  /********** Public API **********/\n  /********************************/\n\n  /**\n   * Returns the Client of the RecordState.\n   */\n  get graph(): GraphManager {\n    return this._graph;\n  }\n\n  /**\n   * Returns the key this RecordState manages.\n   */\n  get key(): string {\n    return this._key;\n  }\n\n  get record(): Record {\n    return this._record;\n  }\n\n  get repositoryId(): string {\n    const id = this.record.repositoryId;\n    const res = id === kRecordIdField ? this.key : id;\n    assert(\n      undefined !== res,\n      `Failed inferring repository id for ${this._key}`\n    );\n    return res!;\n  }\n\n  get repository(): Repository<MemRepoStorage> {\n    return this.graph.repository(this.repositoryId);\n  }\n\n  /**\n   * Returns whether this record state has local edits that have yet been saved\n   * on the server.\n   */\n  get hasPendingChanges(): boolean {\n    return (\n      !this.isLocal &&\n      this.record.isEqual(\n        this.repository.valueForKey(this.key, this.graph.session)\n      )\n    );\n  }\n\n  get isRoot(): boolean {\n    return this.graph.rootKey === this.key;\n  }\n\n  get isLocal(): boolean {\n    return this.getVertex().isLocal;\n  }\n\n  get namespace(): string {\n    return this.record.scheme.namespace;\n  }\n\n  get scheme(): Scheme {\n    return this.record.scheme;\n  }\n\n  set scheme(scheme: Scheme) {\n    const record = this.record;\n    if (scheme.isEqual(record.scheme)) {\n      return;\n    }\n    record.upgradeScheme(scheme);\n    this.rebuildVertex();\n  }\n\n  get displayName(): string {\n    return (this.namespace ? this.namespace + '/' : '') + this.key;\n  }\n\n  get isDeleted(): boolean {\n    return (\n      this.scheme.hasField('isDeleted') &&\n      this.record.get('isDeleted', 0) !== 0 &&\n      this.getVertexProxy().isDeleted !== 0\n    );\n  }\n\n  get vertex(): V {\n    return this.getVertexProxy();\n  }\n\n  getVertexProxy<T extends Vertex = V>(): T {\n    if (this._vertex === undefined) {\n      this.rebuildVertex();\n    }\n    return this._revocableProxy!.proxy as T;\n  }\n\n  private getVertex(): V {\n    if (this._vertex === undefined) {\n      this.rebuildVertex();\n    }\n    return this._vertex as V;\n  }\n\n  *inEdges(fieldName?: string): Generator<[VertexManager, string]> {\n    const graph = this.graph;\n    for (const edge of graph.adjacencyList.inEdges(this.key, fieldName)) {\n      yield [graph.getVertexManager(edge.vertex), edge.fieldName];\n    }\n  }\n\n  *outEdges(fieldName?: string): Generator<[VertexManager, string]> {\n    const graph = this.graph;\n    for (const edge of graph.adjacencyList.outEdges(this.key, fieldName)) {\n      yield [graph.getVertexManager(edge.vertex), edge.fieldName];\n    }\n  }\n\n  /**\n   * This method commits any pending local edits, and merges any pending remote\n   * edits. NOP if nothing needs to be done.\n   */\n  commit(): void {\n    if (this.isLocal) {\n      return;\n    }\n    const graph = this.graph;\n    const repo = this.repository;\n    const prevRecord = this.record;\n    if (repo.setValueForKey(this.key, graph.session, this.record)) {\n      const newRecord = repo.valueForKey(this.key, graph.session);\n      const vert = this.getVertexProxy();\n      let pack: MutationPack;\n      for (const fieldName of Object.keys(prevRecord.diff(newRecord, true))) {\n        pack = mutationPackAppend(pack, [\n          fieldName,\n          (vert as any)[fieldName],\n          false,\n        ]);\n      }\n      const dynamicFields = this.captureDynamicFields();\n      this._record = newRecord;\n      this.rebuildVertex();\n      if (!mutationPackIsEmpty(pack)) {\n        this.vertexDidMutate(pack, dynamicFields);\n      }\n    }\n  }\n\n  scheduleCommitIfNeeded(): void {\n    this._commitDelayTimer.schedule();\n  }\n\n  private rebuildVertex(): void {\n    this._vertex = gVertexBuilder(\n      this,\n      this.record,\n      this._vertex,\n      this._vertexConfig\n    );\n    this.rebuildVertexProxy();\n  }\n\n  private rebuildVertexProxy<T extends Vertex>(): T {\n    const handler: ProxyHandler<T> = {\n      deleteProperty: (target: T, prop: string): boolean => {\n        if (prop.startsWith('_')) {\n          delete target[prop as keyof T];\n          return true;\n        }\n        const dynamicFields = this.captureDynamicFields();\n\n        const oldValue = target[prop as keyof T] as unknown as CoreValue;\n        let success: boolean;\n        const deleteMethodName = getDeleteMethodName(prop);\n        // deno-lint-ignore no-explicit-any\n        if (typeof (target as any)[deleteMethodName] === 'function') {\n          // deno-lint-ignore no-explicit-any\n          success = (target as any)[deleteMethodName]() !== false;\n        } else if (this.scheme.hasField(prop)) {\n          assert(\n            this.scheme.isRequiredField(prop) === false,\n            `Attempting to delete required field '${prop} of '${this.namespace}'`\n          );\n          success = target.record.delete(prop);\n        } else {\n          success = delete target[prop as keyof T];\n        }\n        if (success) {\n          const mut = target.onUserUpdatedField([prop, true, oldValue]);\n          this.vertexDidMutate(mut, dynamicFields);\n          // Trigger sync on persistent prop updates\n          if (this.scheme.hasField(prop)) {\n            this.scheduleCommitIfNeeded();\n          }\n        }\n        return success;\n      },\n\n      set: (target: T, prop: string, value: any): boolean => {\n        if (prop.startsWith('_')) {\n          target[prop as keyof T] = value;\n          return true;\n        }\n        const oldValue = target[prop as keyof T] as unknown as CoreValue;\n        if (coreValueEquals(oldValue, value)) {\n          return true;\n        }\n\n        const dynamicFields = this.captureDynamicFields();\n\n        target[prop as keyof T] = value;\n\n        const mut = target.onUserUpdatedField([prop, true, oldValue]);\n        this.vertexDidMutate(mut, dynamicFields);\n        // Trigger sync on persistent prop updates\n        // if (this.scheme.hasField(prop)) {\n        //   this.scheduleSync();\n        // }\n        return true;\n      },\n\n      // deno-lint-ignore no-explicit-any\n      get: (target: T, prop: string | symbol): any => {\n        const value = target[prop as keyof T];\n        // Enable direct mutations of Set and Dictionary instances which saves\n        // tons of boilerplate on the client's side.\n        // TODO: Cache proxies if needed\n        if (value instanceof Set) {\n          const setProxy = new SetProxy(value, (oldValue) => {\n            target[prop as keyof T] = setProxy._target as T[keyof T];\n            this.vertexDidMutate([prop as string, true, oldValue]);\n          });\n          return setProxy;\n        } else if (isDictionary(value)) {\n          const dictProxy = new DictionaryProxy(value, (oldValue) => {\n            target[prop as keyof T] = dictProxy._target as T[keyof T];\n            this.vertexDidMutate([prop as string, true, oldValue as CoreValue]);\n          });\n          return dictProxy;\n        }\n        return value;\n      },\n    };\n\n    if (this._revocableProxy !== undefined) {\n      this._revocableProxy.revoke();\n    }\n    this._revocableProxy = Proxy.revocable(this._vertex as T, handler);\n    return this._revocableProxy.proxy as T;\n  }\n\n  /**\n   * Called whenever our vertex has been mutated for whatever reason. This\n   * method is the entry point which propagates mutations information.\n   *\n   * @param mutations The changes that have been applied to the vertex.\n   * @param dynamicFields If available, a snapshot of the dynamic fields before\n   *                      the mutations where applied.\n   */\n  vertexDidMutate(\n    mutations: MutationPack,\n    dynamicFields?: DynamicFieldsSnapshot\n  ): void {\n    mutations = mutationPackOptimize(mutations);\n    const vertex = this.getVertex();\n    const addedEdges: Edge[] = [];\n    const removedEdges: Edge[] = [];\n    // Update our graph on ref changes\n    for (const [prop, local, oldValue] of mutationPackIter(mutations)) {\n      const newValue = vertex.valueForRefCalc(prop as keyof Vertex);\n      if (newValue === kNoRefsValue) {\n        continue;\n      }\n      const newRefs = extractFieldRefs(newValue, true);\n      const oldRefs = extractFieldRefs(oldValue as any, true);\n      if (oldRefs.size > 0 || newRefs.size > 0) {\n        const graph = this.graph;\n        const adjList = graph.adjacencyList;\n        const addedRefs = SetUtils.subtract(newRefs, oldRefs);\n        const removedRefs = SetUtils.subtract(oldRefs, newRefs);\n        const srcKey = this.key;\n        for (const dstKey of addedRefs) {\n          adjList.addEdge(srcKey, dstKey, prop);\n          addedEdges.push([dstKey, prop]);\n        }\n        for (const dstKey of removedRefs) {\n          adjList.deleteEdge(srcKey, dstKey, prop);\n          removedEdges.push([dstKey, prop]);\n        }\n      }\n    }\n    // Dynamic fields support\n    if (dynamicFields) {\n      mutations = this.mutationsForDynamicFields(mutations, dynamicFields);\n    }\n    if (mutationPackIsEmpty(mutations)) {\n      return;\n    }\n    const refsChange: RefsChange = {\n      added: addedEdges,\n      removed: removedEdges,\n    };\n    // Broadcast the mutations of our vertex\n    this.emit(EVENT_DID_CHANGE, mutations, refsChange);\n    // Let our vertex a chance to apply side effects\n    const sideEffects = vertex.didMutate(mutations);\n    if (!mutationPackIsEmpty(sideEffects)) {\n      this.vertexDidMutate(sideEffects);\n    }\n    if (this.hasPendingChanges) {\n      this.scheduleCommitIfNeeded();\n    }\n  }\n\n  private captureDynamicFields(): DynamicFieldsSnapshot {\n    return {\n      hasPendingChanges: this.hasPendingChanges,\n      isLocal: this.isLocal,\n    };\n  }\n\n  private mutationsForDynamicFields(\n    outMutations: MutationPack,\n    snapshot: DynamicFieldsSnapshot\n  ): MutationPack {\n    if (snapshot.hasPendingChanges !== this.hasPendingChanges) {\n      outMutations = mutationPackAppend(outMutations, [\n        'hasPendingChanges',\n        true,\n        snapshot.hasPendingChanges,\n      ]);\n    }\n    if (snapshot.isLocal !== this.isLocal) {\n      outMutations = mutationPackAppend(outMutations, [\n        'isLocal',\n        true,\n        snapshot.isLocal,\n      ]);\n    }\n    return outMutations;\n  }\n\n  /*****************************************************\n   ************* Methods for Graph Manager *************\n   *****************************************************/\n\n  getCurrentStateMutations(local: boolean): MutationPack {\n    let pack: MutationPack;\n    for (const fieldName of this.record.keys) {\n      pack = mutationPackAppend(pack, [fieldName, local, undefined]);\n    }\n\n    pack = mutationPackAppend(pack, ['isLoading', true, undefined]);\n    pack = mutationPackAppend(pack, ['hasPendingChanges', true, undefined]);\n    pack = mutationPackAppend(pack, ['errorCode', true, undefined]);\n    pack = mutationPackAppend(pack, ['isLocal', true, this.isLocal]);\n    return pack;\n  }\n\n  /**\n   * Called after locally creating a vertex to report the initial values through\n   * the mutations API.\n   */\n  private reportInitialFields(local: boolean): void {\n    this.vertexDidMutate(this.getCurrentStateMutations(local));\n  }\n\n  updateBySnapshot(snapshot: VertexSnapshot) {\n    let pack: MutationPack;\n    const vertex = this.getVertex();\n    let changed = false;\n\n    const dynamicFields = this.captureDynamicFields();\n\n    for (const fieldName in snapshot.data) {\n      const oldValue = vertex[fieldName as keyof Vertex] as CoreValue;\n      const oldRecValue = vertex.record.get<RichText>(fieldName);\n      let newRecValue = snapshot.data[fieldName] as RichText | undefined;\n\n      if (!coreValueEquals(oldRecValue, newRecValue)) {\n        if (\n          oldRecValue &&\n          newRecValue &&\n          vertex.record.scheme.getFieldType(fieldName) === ValueType.RICHTEXT_V3\n        ) {\n          newRecValue = projectPointers(oldRecValue, newRecValue, (ptr) =>\n            this.graph.ptrFilterFunc(ptr.key)\n          );\n        }\n        vertex.record.set(fieldName, newRecValue);\n        pack = mutationPackAppend(pack, [fieldName, true, oldValue]);\n        changed = true;\n      }\n    }\n\n    for (const fieldName in snapshot.local) {\n      const oldValue = vertex[fieldName as keyof Vertex] as CoreValue;\n\n      if (!coreValueEquals(oldValue, snapshot.local[fieldName])) {\n        //@ts-ignore // shut the f*** up\n        vertex[fieldName] = snapshot[fieldName];\n        pack = mutationPackAppend(pack, [fieldName, true, oldValue]);\n        changed = true;\n      }\n    }\n\n    if (changed) {\n      this.rebuildVertex();\n      this.vertexDidMutate(pack, dynamicFields);\n    }\n  }\n\n  getSnapshot(onlyFields?: string[]): VertexSnapshot {\n    const vertex = this.getVertex();\n    const data = vertex.cloneData(onlyFields);\n\n    const local: CoreObject = {};\n\n    for (const key of vertex.getLocalFields()) {\n      if (onlyFields && !onlyFields.includes(key)) continue;\n      local[key] = coreValueClone(\n        vertex[key as keyof Vertex] as unknown as CoreValue\n      );\n    }\n\n    return {\n      data,\n      local,\n    };\n  }\n\n  // private fixDuplicateTitleBug(): void {\n  //   if (this.namespace === NS_NOTES) {\n  //     const title = this.record.get('title');\n  //     if (title !== undefined) {\n  //       this.record.set('title', fixDuplicateTitleBug(title));\n  //     }\n  //   }\n  // }\n\n  isEqual(other: VertexManager): boolean {\n    return this._key === other.key;\n  }\n\n  compare(other: VertexManager): number {\n    return this.vertex.compare(other.vertex);\n  }\n}\n\nfunction getDeleteMethodName(prop: string): string {\n  return 'clear' + prop[0].toUpperCase() + prop.substring(1);\n}\n\nfunction projectRichTextPointers(\n  srcRec: Record,\n  dstRec: Record,\n  filter: (ptr: PointerValue) => boolean\n): void {\n  const srcScheme = srcRec.scheme;\n  for (const [fieldName, type] of Object.entries(dstRec.scheme.getFields())) {\n    if (\n      type === ValueType.RICHTEXT_V3 &&\n      srcScheme.hasField(fieldName) &&\n      srcScheme.getFieldType(fieldName) === ValueType.RICHTEXT_V3\n    ) {\n      const srcRt: RichText | undefined = srcRec.get<RichText>(fieldName);\n      const dstRt: RichText | undefined = dstRec.get<RichText>(fieldName);\n      if (srcRt !== undefined && dstRt !== undefined) {\n        dstRec.set(fieldName, projectPointers(srcRt, dstRt, filter, false));\n      }\n    }\n  }\n}\n\ntype DidMutateCallback<T> = (oldValue: T) => void;\n\nclass SetProxy<T> {\n  _target: Set<T>;\n  private readonly _didMutateCallback: DidMutateCallback<Set<T>>;\n\n  constructor(target: Set<T>, didMutateCallback: DidMutateCallback<Set<T>>) {\n    this._target = target;\n    this._didMutateCallback = didMutateCallback;\n  }\n\n  get size() {\n    return this._target.size;\n  }\n\n  [Symbol.iterator]() {\n    return this._target[Symbol.iterator];\n  }\n\n  add(v: T): Set<T> {\n    if (!this._target.has(v)) {\n      const oldValue = new Set(this._target);\n      this._target.add(v);\n      this._didMutateCallback(oldValue);\n    }\n    return this as unknown as Set<T>;\n  }\n\n  clear(): void {\n    if (this._target.size > 0) {\n      const oldValue = this._target;\n      this._target = new Set();\n      this._didMutateCallback(oldValue);\n    }\n  }\n\n  delete(v: T): boolean {\n    if (this._target.has(v)) {\n      const oldValue = new Set(this._target);\n      this._target.delete(v);\n      this._didMutateCallback(oldValue);\n      return true;\n    }\n    return false;\n  }\n\n  entries() {\n    return this._target.entries();\n  }\n\n  forEach() {\n    return this._target.forEach.apply(this._target, arguments as any);\n  }\n\n  has(v: T) {\n    return this._target.has(v);\n  }\n\n  keys() {\n    return this._target.keys();\n  }\n\n  values() {\n    return this._target.values();\n  }\n}\n\nclass DictionaryProxy<K, V> {\n  readonly _target: Dictionary<K, V>;\n  private readonly _didMutateCallback: DidMutateCallback<Dictionary<K, V>>;\n\n  constructor(\n    target: Dictionary<K, V>,\n    callback: DidMutateCallback<Dictionary<K, V>>\n  ) {\n    this._target = target;\n    this._didMutateCallback = callback;\n  }\n\n  get size() {\n    return this._target.size;\n  }\n\n  get(key: K) {\n    return this._target.get(key);\n  }\n\n  has(key: K) {\n    return this._target.has(key);\n  }\n\n  entries() {\n    return this._target.entries();\n  }\n\n  keys() {\n    return this._target.keys();\n  }\n\n  values() {\n    return this._target.values();\n  }\n\n  set(key: K, value: V): void {\n    const target = this._target;\n    if (!coreValueEquals(target.get(key) as CoreValue, value as CoreValue)) {\n      const oldValue = new Map(target);\n      target.set(key, value);\n      this._didMutateCallback(oldValue);\n    }\n  }\n\n  delete(key: K): boolean {\n    if (this._target.has(key)) {\n      const oldValue = new Map(this._target);\n      this._target.delete(key);\n      this._didMutateCallback(oldValue);\n      return true;\n    }\n    return false;\n  }\n\n  clear(): void {\n    if (this._target.size > 0) {\n      const oldValue = new Map(this._target);\n      this._target.clear();\n      this._didMutateCallback(oldValue);\n    }\n  }\n}\n", "import EventEmitter from 'https://esm.sh/eventemitter3@4.0.7';\n\nexport const EVENT_LOADING_FINISHED = 'LOADING_FINISHED';\nexport const EVENT_VERTEX_CHANGED = 'VERTEX_CHANGED';\nexport const EVENT_VERTEX_DELETED = 'VERTEX_DELETED';\nexport const EVENT_VERTEX_SOURCE_CLOSED = 'VERTEX_SOURCE_CLOSED';\n\nexport abstract class VertexSource extends EventEmitter {\n  abstract readonly isLoading: boolean;\n  abstract keys(): Iterable<string>;\n\n  abstract hasVertex(key: string): boolean;\n\n  abstract close(): void;\n}\n", "import { coreValueCompare } from '../../../base/core-types/comparable.ts';\nimport { GraphManager } from './graph-manager.ts';\nimport {\n  EVENT_LOADING_FINISHED,\n  EVENT_VERTEX_CHANGED,\n  EVENT_VERTEX_DELETED,\n  EVENT_VERTEX_SOURCE_CLOSED,\n  VertexSource,\n} from './vertex-source.ts';\nimport { Vertex } from './vertex.ts';\nimport { VertexManager } from './vertex-manager.ts';\nimport { assert, notReached } from '../../../base/error.ts';\nimport { mapIterable, unionIter } from '../../../base/common.ts';\nimport { SimpleTimer, Timer } from '../../../base/timer.ts';\nimport {\n  CancellablePromise,\n  Coroutine,\n  CoroutineQueue,\n  CoroutineScheduler,\n  SchedulerPriority,\n} from '../../../base/coroutine.ts';\nimport { GlobalLogger } from '../../../logging/log.ts';\nimport { MutationPack } from './mutations.ts';\nimport { Dictionary } from '../../../base/collections/dict.ts';\n\nexport type Predicate<IT extends Vertex = Vertex, OT extends IT = IT> =\n  | ((vertex: IT) => boolean)\n  | ((vertex: IT) => vertex is OT);\n\nexport interface SortDescriptor<T extends Vertex = Vertex> {\n  (v1: T, v2: T): number;\n}\n\n// TODO: Change this to a readonly array (requires updates in a few places)\nexport type QueryResults<T extends Vertex = Vertex> =\n  readonly VertexManager<T>[];\n\nexport const EVENT_QUERY_RESULTS_CHANGED = 'QueryResultsChanged';\n\n// const kQueryQueue = new CoroutineQueue(CoroutineScheduler.sharedScheduler());\nlet gQueryId = 0;\n\nexport type GroupId = string | undefined;\n\n/**\n * A function responsible for mapping a query result (vertex) to one or more\n * groups.\n */\n\nexport type GroupByFuncResultPrimitive = GroupId | Vertex | VertexManager;\n\n/**\n * The result of a groupBy function is one or more groups the result is in.\n */\nexport type GroupByFuncResult =\n  | GroupByFuncResultPrimitive\n  | GroupByFuncResultPrimitive[]\n  | Iterable<GroupByFuncResultPrimitive>;\n\nexport type GroupByFunction<T extends Vertex = Vertex> = (\n  v: T\n) => GroupByFuncResult;\n\nexport interface QueryOptions<OT extends Vertex> {\n  name?: string;\n  deps?: Query[];\n  groupBy?: GroupByFunction<OT>;\n  sortBy?: SortDescriptor<OT>;\n}\n\nexport type SourceType<IT extends Vertex> =\n  // deno-lint-ignore no-explicit-any\n  | Query<any, IT>\n  // deno-lint-ignore no-explicit-any\n  | UnionQuery<any, IT>\n  | GraphManager;\nexport type SourceProducer<IT extends Vertex> = () => SourceType<IT>;\n\n/**\n * Queries are implemented as linear search over an abstract list of vertices\n * called a source. Queries implemented as Coroutines to allow both multiplexing\n * their execution and to pause the search when it's taking too much time.\n *\n * Queries themselves act as sources for other queries, enabling efficient\n * chaining. Thus, we're treating queries both as end queries from the UI, and\n * as intermediate \"indexes\" that are opened once the app boots, and are kept\n * open during the entire execution.\n *\n * Whenever a vertex changes, all root queries get notified. If the vertex falls\n * in the result set of a query, it'll pass the update down to all chained\n * queries. If not, the rest of the chian won't be notified. This allows us to\n * control the way updates propagate throughout the app.\n *\n * Queries may have other queries as dependencies. Whenever a dependency's\n * result set changes, the query will re-scan its source (refreshing it if\n * needed), and update the results accordingly.\n *\n * A query exposes its results in several ways:\n * - A `results` property containing sorted vertex managers.\n * - A `groups` property dictionary mapping group ids to sorted vertex managers.\n * - A `count` property containing the total result size.\n *\n * Notes:\n * ------\n * - At the time of this writing, there's no performance difference between the\n *   different result types.\n *\n * - If no `groupBy` is provided, all results are placed under the `undefined`\n *   group id.\n *\n * - If no sort descriptor is provided, results will be sorted by calling\n *   Vertex.compare() (through coreValueCompare()) on the results.\n */\nexport class Query<\n  IT extends Vertex = Vertex,\n  OT extends IT = IT\n> extends VertexSource {\n  logger = GlobalLogger;\n  private readonly _id: number;\n  private readonly _vertexChangedListener: (\n    key: string,\n    pack: MutationPack\n  ) => void;\n  private readonly _vertexDeletedListener: (\n    key: string,\n    pack: MutationPack\n  ) => void;\n  private readonly _closeListener: () => void;\n  private readonly _resultKeys: Set<string>;\n  private readonly _groupedResultKeys?: Map<GroupId, Set<string>>;\n  private readonly _clientsNotifyTimer: Timer;\n  private readonly _name?: string;\n  private readonly _deps?: Query[];\n  private readonly _depsListener?: () => void;\n  private readonly _sourceProducer?: SourceProducer<IT>;\n  private readonly _sortDescriptor?: SortDescriptor<OT>;\n  private readonly _groupByFunc?: GroupByFunction<OT>;\n  private _source: SourceType<IT>;\n  private _isOpen: boolean;\n  private _isLoading: boolean;\n  private _locked: boolean;\n  private _cachedSortedResults: QueryResults<OT> | undefined;\n  private _cachedSortedGroups: Map<GroupId, QueryResults<OT>> | undefined;\n  private _scanSourcePromise: CancellablePromise<void> | undefined;\n  private _scanResultsPromise: CancellablePromise<void> | undefined;\n\n  /**\n   * A single use async query for the times you only need a one-off and don't\n   * care for listening to result updates.\n   *\n   * @param source The source to query.\n   * @param predicate A predicate defining what goes into the results.\n   * @param sortDescriptor An optional sort descriptor.\n   * @param name An optional query name for debugging and profiling purposes.\n   *\n   * @returns An array of VertexManager instances.\n   */\n  static async<IT extends Vertex = Vertex, OT extends IT = IT>(\n    // deno-lint-ignore no-explicit-any\n    source: Query<any, IT> | UnionQuery<any, IT> | GraphManager,\n    predicate: Predicate<IT, OT>,\n    sortDescriptor?: SortDescriptor<OT>,\n    name?: string\n  ): Promise<QueryResults<OT>> {\n    let resolve: (\n      value: QueryResults<OT> | PromiseLike<QueryResults<OT>>\n    ) => void;\n    const promise = new Promise<QueryResults<OT>>((res) => (resolve = res));\n    const query = new this(source, predicate, sortDescriptor, name);\n    query.on(EVENT_QUERY_RESULTS_CHANGED, () => {\n      if (!query.isLoading) {\n        const results = query.results;\n        query.close();\n        resolve(results);\n      }\n    });\n    return promise;\n  }\n\n  /**\n   * A blocking query for the times you must absolutely get a response right\n   * now.\n   *\n   * @param source The source to query.\n   * @param predicate A predicate defining what goes into the results.\n   * @param sortDescriptor An optional sort descriptor.\n   *\n   * @returns An array of VertexManager instances.\n   */\n  static blocking<IT extends Vertex = Vertex, OT extends IT = IT>(\n    // deno-lint-ignore no-explicit-any\n    source: Query<any, IT> | UnionQuery<any, IT> | GraphManager,\n    predicate: Predicate<IT, OT>,\n    sortDescriptor?: SortDescriptor<OT>\n  ): QueryResults<OT> {\n    const result: VertexManager<OT>[] = [];\n    const graph = source instanceof GraphManager ? source : source.graph;\n    for (const key of source.keys()) {\n      const vert = graph.getVertex<IT>(key);\n      if (predicate(vert)) {\n        result.push(vert.manager as VertexManager<OT>);\n      }\n    }\n    if (sortDescriptor !== undefined) {\n      result.sort((mgr1, mgr2) =>\n        sortDescriptor(mgr1.getVertexProxy(), mgr2.getVertexProxy())\n      );\n    }\n    return result;\n  }\n\n  /**\n   * A blocking query for the times you must absolutely get a response right\n   * now. This is similar to the `blocking()` call except it only counts the\n   * results rather then actually returning them.\n   *\n   * @param source The source to query.\n   * @param predicate A predicate defining what goes into the results.\n   * @param limit An optional max limit for the resulting count.\n   *\n   * @returns The number of results found.\n   */\n  static blockingCount<IT extends Vertex = Vertex>(\n    // deno-lint-ignore no-explicit-any\n    source: Query<any, IT> | UnionQuery<any, IT> | GraphManager,\n    predicate: Predicate<IT>,\n    limit?: number\n  ): number {\n    let result = 0;\n    const graph = source instanceof GraphManager ? source : source.graph;\n    for (const key of source.keys()) {\n      if (predicate(graph.getVertex<IT>(key))) {\n        ++result;\n        if (limit !== undefined && result >= limit) {\n          break;\n        }\n      }\n    }\n    return result;\n  }\n\n  constructor(\n    sourceOrProducer: SourceType<IT> | SourceProducer<IT>,\n    readonly predicate: Predicate<IT, OT>,\n    sortDescriptorOrOpts?: SortDescriptor<OT> | QueryOptions<OT>,\n    nameOrOpts?: string | QueryOptions<OT>\n  ) {\n    super();\n    this._id = ++gQueryId;\n    this._vertexChangedListener = (key) => this.vertexChanged(key);\n    this._vertexDeletedListener = (key) => this.vertexDeleted(key);\n    this._closeListener = () => {\n      this.unlock();\n      this.close();\n    };\n    this._resultKeys = new Set();\n    this._clientsNotifyTimer = new SimpleTimer(50, false, () =>\n      this._notifyQueryChanged()\n    );\n    this._isOpen = true;\n    this._isLoading = true;\n    this._locked = false;\n\n    let opts: QueryOptions<OT> | undefined;\n    if (typeof sortDescriptorOrOpts === 'function') {\n      this._sortDescriptor = sortDescriptorOrOpts;\n    } else if (typeof sortDescriptorOrOpts !== 'undefined') {\n      opts = sortDescriptorOrOpts;\n    }\n    if (typeof nameOrOpts === 'string') {\n      this._name = nameOrOpts;\n    } else if (typeof nameOrOpts !== 'undefined') {\n      opts = nameOrOpts;\n    }\n    if (opts) {\n      if (opts.name) {\n        this._name = opts.name;\n      }\n      if (opts.deps) {\n        this._deps = opts.deps;\n        if (this._deps) {\n          this._depsListener = () => this.onDependencyChanged();\n          for (const d of this._deps) {\n            d.on(EVENT_QUERY_RESULTS_CHANGED, this._depsListener);\n            d.once(EVENT_VERTEX_SOURCE_CLOSED, this._closeListener);\n          }\n        }\n      }\n      if (opts.groupBy) {\n        this._groupByFunc = opts.groupBy;\n        this._groupedResultKeys = new Map();\n      }\n    }\n\n    if (typeof sourceOrProducer === 'function') {\n      this._sourceProducer = sourceOrProducer;\n      this._source = this._sourceProducer();\n    } else {\n      this._source = sourceOrProducer;\n    }\n    this.attachToSource();\n  }\n\n  get source(): SourceType<IT> {\n    return this._source;\n  }\n\n  get name(): string | undefined {\n    return this._name;\n  }\n\n  get isOpen(): boolean {\n    return this._isOpen;\n  }\n\n  get isLoading(): boolean {\n    return this._isLoading;\n  }\n\n  get graph(): GraphManager {\n    const src = this.source;\n    if (src instanceof GraphManager) {\n      return src;\n    }\n    return src.graph;\n  }\n\n  get sortDescriptor(): SortDescriptor<OT> | undefined {\n    return this._sortDescriptor;\n  }\n\n  get results(): QueryResults<OT> {\n    this._buildResultsIfNeeded();\n    return this._cachedSortedResults!;\n  }\n\n  get groups(): Dictionary<GroupId, QueryResults<OT>> {\n    this._buildResultsIfNeeded();\n    return this._cachedSortedGroups!;\n  }\n\n  get count(): number {\n    return this._resultKeys.size;\n  }\n\n  get scheduler(): CoroutineScheduler {\n    // At the time of this writing, we're still testing different execution\n    // strategies. Currently executing all queries concurrently results in a\n    // more responsive UI with less re-rendering than executing queries\n    // serially. That being said, when there are a high number of query\n    // cancellations, serial execution will result in a smoother user\n    // experience. This was the case in one of the first iterations on the new\n    // filters bar on April, 2022.\n    //\n    // Using kQueryQueue as the scheduler will enforce a serial execution.\n    return CoroutineScheduler.sharedScheduler(); // kQueryQueue;\n  }\n\n  onResultsChanged(handler: () => void): () => void {\n    this.on(EVENT_QUERY_RESULTS_CHANGED, handler);\n    return () => {\n      this.off(EVENT_QUERY_RESULTS_CHANGED, handler);\n    };\n  }\n\n  hasVertex(key: string | Vertex | VertexManager): boolean {\n    if (typeof key !== 'string') {\n      key = key.key;\n    }\n    return this._resultKeys.has(key);\n  }\n\n  keys(): Iterable<string> {\n    return this._resultKeys.values();\n  }\n\n  groupCount(): number {\n    return this._groupedResultKeys?.size || 0;\n  }\n\n  group(name: GroupId): QueryResults<OT> {\n    this._buildResultsIfNeeded();\n    return this._cachedSortedGroups?.get(name) || [];\n  }\n\n  forEach(f: (vert: OT) => void): void {\n    const graph = this.graph;\n    for (const key of this._resultKeys) {\n      f(graph.getVertex<OT>(key));\n    }\n  }\n\n  map<T>(f: (vert: OT) => T): T[] {\n    const graph = this.graph;\n    const result: T[] = [];\n    for (const key of this._resultKeys) {\n      result.push(f(graph.getVertex<OT>(key)));\n    }\n    return result;\n  }\n\n  private detachFromSource(): void {\n    this.source.off(EVENT_VERTEX_CHANGED, this._vertexChangedListener);\n    this.source.off(EVENT_VERTEX_DELETED, this._vertexDeletedListener);\n    this.source.off(EVENT_VERTEX_SOURCE_CLOSED, this._closeListener);\n  }\n\n  private attachToSource(): void {\n    const source = this._source;\n    if (source instanceof Query || source instanceof UnionQuery) {\n      assert(source.isOpen);\n      source.once(EVENT_VERTEX_SOURCE_CLOSED, this._closeListener);\n    }\n\n    if (source.isLoading) {\n      source.once(EVENT_LOADING_FINISHED, () =>\n        this.attachToSourceAfterLoading()\n      );\n    } else {\n      this.attachToSourceAfterLoading();\n    }\n  }\n\n  close(): void {\n    // TODO\n    if (this._isOpen) {\n      assert(!this._locked);\n      this.detachFromSource();\n      if (this._depsListener && this._deps) {\n        for (const d of this._deps) {\n          d.off(EVENT_QUERY_RESULTS_CHANGED, this._depsListener);\n          d.off(EVENT_VERTEX_SOURCE_CLOSED, this._closeListener);\n        }\n      }\n      this._isOpen = false;\n      this.emit(EVENT_VERTEX_SOURCE_CLOSED);\n    }\n  }\n\n  lock(): Query<IT, OT> {\n    this._locked = true;\n    return this;\n  }\n\n  unlock(): Query<IT, OT> {\n    this._locked = false;\n    return this;\n  }\n\n  get isLocked(): boolean {\n    return this._locked;\n  }\n\n  /*****************************************/\n  /******** Private API Starts Here ********/\n  /*****************************************/\n\n  private existingGroupIdsForKey(key: string): GroupId[] {\n    const groupedResultKeys = this._groupedResultKeys;\n    if (!groupedResultKeys) {\n      return [undefined];\n    }\n    const result = [];\n    for (const [groupId, keySet] of groupedResultKeys) {\n      if (keySet.has(key)) {\n        result.push(groupId);\n      }\n    }\n    return result;\n  }\n\n  private vertexChanged(key: string, pack: MutationPack): void {\n    const wasInSourceKeys = this.hasVertex(key);\n    const prevGroupIds = this.existingGroupIdsForKey(key);\n    const vertex = this.graph.getVertex<OT>(key);\n    const newGroupIds = this.groupIdsForVertex(key);\n    for (const groupId of prevGroupIds) {\n      const prevSet = this._groupedResultKeys!.get(groupId);\n      if (!prevSet) {\n        continue;\n      }\n      if (prevSet?.size === 1) {\n        assert(prevSet.has(key));\n        this._groupedResultKeys!.delete(groupId);\n      } else {\n        prevSet?.delete(key);\n      }\n    }\n    if (this.predicate(vertex)) {\n      this._resultKeys.add(key);\n      for (const groupId of newGroupIds) {\n        let set = this._groupedResultKeys!.get(groupId);\n        if (!set) {\n          set = new Set();\n          this._groupedResultKeys!.set(groupId, set);\n        }\n        set.add(key);\n      }\n      // TODO: Wrap in a micro task timer to avoid timing issues around\n      // corountine cancellation. This is currently not an issue since we're\n      // using cancelImmediately() rather than cancel().\n      this.emit(EVENT_VERTEX_CHANGED, key, pack);\n    } else if (wasInSourceKeys) {\n      this._resultKeys.delete(key);\n      // TODO: Wrap in a micro task timer to avoid timing issues around\n      // corountine cancellation. This is currently not an issue since we're\n      // using cancelImmediately() rather than cancel().\n      this.emit(EVENT_VERTEX_DELETED, key, pack);\n    }\n    if (!this.isLoading && wasInSourceKeys !== this.hasVertex(key)) {\n      this._clientsNotifyTimer.schedule();\n    }\n  }\n\n  private vertexDeleted(key: string, pack: MutationPack): void {\n    if (this.hasVertex(key)) {\n      this._resultKeys.delete(key);\n      this.emit(EVENT_VERTEX_DELETED, key, pack);\n      this._clientsNotifyTimer.schedule();\n    }\n  }\n\n  protected *loadKeysFromSource(): Generator<void> {\n    const startTime = performance.now();\n    if (!this.isOpen || Coroutine.current()?.shouldRun !== true) {\n      this.logger.log({\n        severity: 'INFO',\n        name: 'QueryCancelled',\n        value: performance.now() - startTime,\n        unit: 'Milliseconds',\n        queryName: this.debugName,\n      });\n      return;\n    }\n    for (const key of this.source.keys()) {\n      if (!this.isOpen) {\n        this.logger.log({\n          severity: 'INFO',\n          name: 'QueryCancelled',\n          value: performance.now() - startTime,\n          unit: 'Milliseconds',\n          queryName: this.debugName,\n        });\n        return;\n      }\n      this.vertexChanged(key);\n      yield;\n    }\n    this._buildResultsIfNeeded();\n    const runningTime = performance.now() - startTime;\n    this.logger.log({\n      severity: 'INFO',\n      name: 'QueryCompleted',\n      value: runningTime,\n      unit: 'Milliseconds',\n      queryName: this.debugName,\n      itemCount: this.count,\n    });\n    // When any of our dependencies change, we're forced to do a full scan all\n    // over again. In this case, however, we don't emit the loading event.\n    if (this._isLoading) {\n      this._isLoading = false;\n      this.emit(EVENT_LOADING_FINISHED);\n      this._clientsNotifyTimer.schedule();\n    }\n  }\n\n  private compareManagers(a: VertexManager<OT>, b: VertexManager<OT>): number {\n    const sortDesc = this.sortDescriptor;\n    const v1 = a.getVertexProxy();\n    const v2 = b.getVertexProxy();\n    const ret = sortDesc ? sortDesc(v1, v2) : 0;\n    return ret === 0 ? coreValueCompare(v1, v2) : ret;\n  }\n\n  private _buildResultsIfNeeded(): void {\n    if (this._cachedSortedResults === undefined) {\n      const results: VertexManager<OT>[] = [];\n      const graph = this.graph;\n      for (const key of this.keys()) {\n        results.push(graph.getVertexManager(key));\n      }\n      const sortDesc = (a: VertexManager<OT>, b: VertexManager<OT>) =>\n        this.compareManagers(a, b);\n      results.sort(sortDesc);\n      this._cachedSortedResults = results;\n      this._cachedSortedGroups = undefined;\n      if (this._groupedResultKeys) {\n        const sortedGroups = new Map<GroupId, QueryResults<OT>>();\n        for (const [groupKey, keys] of this._groupedResultKeys) {\n          const arr = Array.from(\n            mapIterable(keys, (k) => graph.getVertexManager<OT>(k))\n          );\n          arr.sort(sortDesc);\n          sortedGroups.set(groupKey, arr);\n        }\n        this._cachedSortedGroups = sortedGroups;\n      } else {\n        this._cachedSortedGroups = new Map([\n          [undefined, this._cachedSortedResults],\n        ]);\n      }\n    }\n  }\n\n  private get debugName(): string {\n    let res = String(this._id);\n    if (this.name !== undefined) {\n      res += '/' + this.name;\n    }\n    return res;\n  }\n\n  private attachToSourceAfterLoading(): void {\n    const source = this.source;\n    assert(!source.isLoading);\n    source.on(EVENT_VERTEX_CHANGED, this._vertexChangedListener);\n    source.on(EVENT_VERTEX_DELETED, this._vertexDeletedListener);\n    this.scheduleSourceScan();\n  }\n\n  private scheduleSourceScan(): void {\n    if (this._scanSourcePromise) {\n      this._scanSourcePromise.cancelImmediately();\n    }\n    const promise = this.scheduler.schedule(\n      this.loadKeysFromSource(),\n      SchedulerPriority.Normal,\n      `Query.SourceScan/${this.name}`\n    );\n    promise.finally(() => {\n      if (this._scanSourcePromise === promise) {\n        this._scanSourcePromise = undefined;\n      }\n    });\n    this._scanSourcePromise = promise;\n  }\n\n  _notifyQueryChanged(): void {\n    if (!this.isOpen || this.isLoading) {\n      return;\n    }\n    this._cachedSortedResults = undefined;\n    this._cachedSortedGroups = undefined;\n    this.emit(EVENT_QUERY_RESULTS_CHANGED);\n    this.logger.log({\n      severity: 'INFO',\n      name: 'QueryFired',\n      queryName: this.name,\n      value: 1,\n      unit: 'Count',\n    });\n  }\n\n  private onDependencyChanged(): void {\n    // Cancel any previous re-scan\n    if (this._scanResultsPromise) {\n      this._scanResultsPromise.cancelImmediately();\n    }\n    if (this._sourceProducer) {\n      // Refresh our source if needed\n      if (this._scanSourcePromise) {\n        this._scanSourcePromise.cancelImmediately();\n      }\n      this.detachFromSource();\n      this._source = this._sourceProducer();\n      this.attachToSource();\n    } else {\n      // No source refresh needed, but we still need to re-scan it all over\n      // again as dependencies may affect our predicate\n      this.scheduleSourceScan();\n    }\n    // Also re-scan all existing results and see if they still match. While\n    // this is slower than throwing everything away and starting over, this\n    // enables the UI to see incremental updates which increases responsiveness\n    const promise = this.scheduler.schedule(\n      this.scanCurrentResults(),\n      SchedulerPriority.Normal,\n      `Query.ResultsScan/${this.name}`\n    );\n    promise.finally(() => {\n      if (this._scanResultsPromise === promise) {\n        this._scanResultsPromise = undefined;\n      }\n    });\n    this._scanResultsPromise = promise;\n  }\n\n  private *scanCurrentResults(): Generator<void> {\n    for (const k of this._resultKeys) {\n      this.vertexChanged(k);\n      yield;\n    }\n  }\n\n  private groupIdsForVertex(v: string | OT | VertexManager<OT>): GroupId[] {\n    const groupByFunc = this._groupByFunc;\n    if (!groupByFunc) {\n      return [undefined];\n    }\n    if (typeof v === 'string') {\n      v = this.graph.getVertex<OT>(v);\n    } else if (v instanceof VertexManager<OT>) {\n      v = v.getVertexProxy() as OT;\n    }\n    let res:\n      | GroupByFuncResultPrimitive\n      | GroupByFuncResultPrimitive[]\n      | Iterable<GroupByFuncResultPrimitive> = groupByFunc(v);\n    if (typeof res === 'string' || typeof res === 'undefined') {\n      res = [res];\n    } else if (!(res instanceof Array)) {\n      res = Array.from(res as Iterable<GroupByFuncResultPrimitive>);\n    }\n    const resArr = (res as GroupByFuncResultPrimitive[]).map(\n      groupByFunctionResultToGroupId\n    );\n    if (!resArr.length) {\n      resArr.push(undefined);\n    }\n    return resArr;\n  }\n}\n\nfunction groupByFunctionResultToGroupId(\n  res: GroupByFuncResultPrimitive\n): GroupId {\n  if (res instanceof Vertex || res instanceof VertexManager) {\n    return res.key;\n  }\n  return res;\n}\n\nexport class UnionQuery<\n  IT extends Vertex = Vertex,\n  OT extends IT = IT\n> extends VertexSource {\n  private readonly _changeListeners: Map<Query<IT, OT>, (key: string) => void>;\n  private readonly _closeListener: () => void;\n  private _isLoading: boolean;\n  private _isOpen: boolean;\n\n  constructor(\n    readonly sources: Iterable<Query<IT, OT>>,\n    readonly name?: string\n  ) {\n    super();\n    this._changeListeners = new Map();\n    this._closeListener = () => this.close();\n    let loadingCount = 0;\n    for (const src of sources) {\n      if (src.isLoading) {\n        ++loadingCount;\n        // eslint-disable-next-line no-loop-func\n        src.once(EVENT_LOADING_FINISHED, () => {\n          if (!this.isOpen) {\n            return;\n          }\n          assert(!src.isLoading);\n          src.on(EVENT_VERTEX_CHANGED, this.changeListenerForQuery(src));\n          src.on(EVENT_VERTEX_DELETED, this.changeListenerForQuery(src));\n          src.once(EVENT_VERTEX_SOURCE_CLOSED, this._closeListener);\n          assert(loadingCount > 0);\n          if (--loadingCount === 0) {\n            this._isLoading = false;\n            this.emit(EVENT_LOADING_FINISHED);\n          }\n        });\n      } else {\n        src.on(EVENT_VERTEX_CHANGED, this.changeListenerForQuery(src));\n        src.on(EVENT_VERTEX_DELETED, this.changeListenerForQuery(src));\n        src.once(EVENT_VERTEX_SOURCE_CLOSED, this._closeListener);\n      }\n    }\n    this._isLoading = loadingCount > 0;\n    this._isOpen = true;\n  }\n\n  // eslint-disable-next-line getter-return\n  // deno-lint-ignore getter-return\n  get graph(): GraphManager {\n    for (const q of this.queries()) {\n      return q.graph;\n    }\n    notReached('UnionQuery has no underlying queries');\n  }\n\n  get isLoading(): boolean {\n    return this._isLoading;\n  }\n\n  get isOpen(): boolean {\n    return this._isOpen;\n  }\n\n  queries(): Iterable<Query<IT, OT>> {\n    return this._changeListeners.keys();\n  }\n\n  *keys(): Generator<string> {\n    const processedKeys = new Set<string>();\n    for (const key of unionIter(\n      ...Array.from(this.queries()).map((q) => q.keys())\n    )) {\n      if (!processedKeys.has(key)) {\n        processedKeys.add(key);\n        yield key;\n      }\n    }\n  }\n\n  hasVertex(key: string): boolean {\n    for (const q of this.queries()) {\n      if (q.hasVertex(key)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  close() {\n    if (this._isOpen) {\n      this._isOpen = false;\n      for (const q of this.queries()) {\n        q.off(EVENT_VERTEX_CHANGED, this.changeListenerForQuery(q));\n        q.off(EVENT_VERTEX_DELETED, this.changeListenerForQuery(q));\n        q.off(EVENT_VERTEX_SOURCE_CLOSED, this._closeListener);\n      }\n      this.emit(EVENT_VERTEX_SOURCE_CLOSED);\n    }\n  }\n\n  private changeListenerForQuery(src: Query<IT, OT>): (key: string) => void {\n    let result = this._changeListeners.get(src);\n    if (result === undefined) {\n      result = (key) => {\n        this.emit(\n          this.hasVertex(key) ? EVENT_VERTEX_CHANGED : EVENT_VERTEX_DELETED,\n          key\n        );\n      };\n      this._changeListeners.set(src, result);\n    }\n    return result;\n  }\n}\n", "import { CoreObject } from '../../../base/core-types/base.ts';\nimport { coreValueCompare } from '../../../base/core-types/comparable.ts';\nimport { notReached } from '../../../base/error.ts';\nimport {\n  NS_NOTES,\n  NS_TAGS,\n  NS_USERS,\n  NS_WORKSPACE,\n} from '../../base/scheme-types.ts';\nimport { GraphManager } from './graph-manager.ts';\nimport { Predicate, Query, SortDescriptor, UnionQuery } from './query.ts';\nimport { EVENT_VERTEX_SOURCE_CLOSED } from './vertex-source.ts';\nimport { Vertex } from './vertex.ts';\nimport { Tag, User, Workspace } from './vertices/index.ts';\n\nexport type SharedQueryName =\n  | 'notDeleted'\n  | 'noNotes'\n  | 'workspaces'\n  | 'tags'\n  | 'users'\n  | 'selectedWorkspaces'\n  | 'selectedTags'\n  | 'selectedUsers'\n  | 'parentTags'\n  | 'childTags'\n  | 'hasPendingChanges';\n\nexport type SharedQueryType<N extends SharedQueryName> = N extends 'notDeleted'\n  ? Query<Vertex>\n  : N extends 'noNotes'\n  ? Query<Vertex>\n  : N extends 'workspaces'\n  ? Query<Vertex, Workspace>\n  : N extends 'tags'\n  ? Query<Vertex, Tag>\n  : N extends 'users'\n  ? Query<Vertex, User>\n  : N extends 'selectedWorkspaces'\n  ? Query<Workspace>\n  : N extends 'selectedTags'\n  ? Query<Tag>\n  : N extends 'selectedUsers'\n  ? Query<User>\n  : N extends 'parentTags'\n  ? Query<Tag>\n  : N extends 'childTags'\n  ? Query<Tag>\n  : Query;\n\nexport type GlobalSharedQueriesManager = {\n  [name in SharedQueryName]: SharedQueryType<name>;\n};\n\nexport class SharedQueriesManager implements GlobalSharedQueriesManager {\n  private _vertexQueries: Map<string, Map<string, Query>>;\n\n  readonly notDeleted: Query<Vertex>;\n  readonly noNotes: Query<Vertex>;\n  readonly workspaces: Query<Vertex, Workspace>;\n  readonly tags: Query<Vertex, Tag>;\n  readonly users: Query<Vertex, User>;\n  readonly selectedWorkspaces: Query<Workspace, Workspace>;\n  readonly selectedTags: Query<Tag, Tag>;\n  readonly selectedUsers: Query<User, User>;\n  readonly parentTags: Query<Tag, Tag>;\n  readonly childTags: Query<Tag, Tag>;\n  readonly hasPendingChanges: Query;\n\n  constructor(graph: GraphManager) {\n    this._vertexQueries = new Map();\n    this.notDeleted = new Query(\n      graph,\n      (vert) => vert.isDeleted === 0,\n      coreValueCompare,\n      'SharedNotDeleted'\n    ).lock();\n    this.noNotes = new Query(\n      this.notDeleted,\n      (vert) => vert.namespace !== NS_NOTES,\n      coreValueCompare,\n      'SharedNoNotes'\n    ).lock();\n    this.workspaces = new Query<Vertex, Workspace>(\n      this.noNotes,\n      (vert) => vert.namespace === NS_WORKSPACE,\n      coreValueCompare,\n      'SharedWorkspaces'\n    ).lock();\n    this.tags = new Query<Vertex, Tag>(\n      this.noNotes,\n      (vert) => vert.namespace === NS_TAGS,\n      coreValueCompare,\n      'SharedTags'\n    ).lock();\n    this.users = new Query<Vertex, User>(\n      this.noNotes,\n      (vert) => vert.namespace === NS_USERS,\n      coreValueCompare,\n      'SharedUsers'\n    ).lock();\n    this.selectedWorkspaces = new Query(\n      this.workspaces,\n      (vert) => vert.selected,\n      coreValueCompare,\n      'SharedSelectedWorkspaces'\n    ).lock();\n    this.selectedTags = new Query(\n      this.tags,\n      (vert) => vert.selected,\n      coreValueCompare,\n      'SharedSelectedTags'\n    ).lock();\n    this.selectedUsers = new Query(\n      this.users,\n      (vert) => vert.selected,\n      coreValueCompare,\n      'SharedSelectedUsers'\n    ).lock();\n    this.parentTags = new Query(\n      this.tags,\n      (tag) => !tag.parentTag,\n      coreValueCompare,\n      'SharedParentTags'\n    ).lock();\n    this.childTags = new Query(\n      this.tags,\n      (tag) => typeof tag.parentTag !== 'undefined',\n      coreValueCompare,\n      'SharedParentTags'\n    ).lock();\n    this.hasPendingChanges = new Query(graph, (v) => v.hasPendingChanges);\n  }\n\n  getVertexQuery<IT extends Vertex = Vertex, OT extends IT = IT>(\n    key: string,\n    name: string,\n    source: Query<any, IT> | UnionQuery<any, IT> | GraphManager,\n    predicate: Predicate<IT, OT>,\n    sortDesc?: SortDescriptor<OT>\n  ): Query<IT, OT> {\n    let queries = this._vertexQueries.get(key);\n    if (!queries) {\n      queries = new Map();\n      this._vertexQueries.set(key, queries);\n    }\n    let result = queries.get(name);\n    if (!result) {\n      result = new Query<IT, OT>(\n        source,\n        predicate,\n        sortDesc,\n        name\n      ).lock() as unknown as Query<Vertex, Vertex>;\n      queries.set(name, result);\n      result.once(EVENT_VERTEX_SOURCE_CLOSED, () =>\n        notReached('Named queries should not be closed')\n      );\n    }\n    return result as unknown as Query<IT, OT>;\n  }\n}\n", "import { assert } from '../../../base/error.ts';\nimport { unionIter } from '../../../base/set.ts';\nimport { Dictionary } from '../../../base/collections/dict.ts';\nimport { HashSet } from '../../../base/collections/hash-map.ts';\n\nexport interface Edge {\n  vertex: string;\n  fieldName: string;\n}\n\nfunction hashEdge(edge: Edge): string {\n  return edge.vertex + '/' + edge.fieldName;\n}\n\nfunction eqEdges(e1: Edge, e2: Edge): boolean {\n  return e1.vertex === e2.vertex && e1.fieldName === e2.fieldName;\n}\n\nexport interface AdjacencyList {\n  addEdge(src: string, dst: string, fieldName: string): boolean;\n  deleteEdge(src: string, dst: string, fieldName: string): boolean;\n  inEdges(vertKey: string, fieldName?: string): Generator<Edge>;\n  outEdges(vertKey: string, fieldName?: string): Generator<Edge>;\n  uniqueEdges(vertKey: string, fieldName?: string): Generator<string>;\n  hasVertex(key: string): boolean;\n  hasEdge(src: string, dst: string, fieldName?: string): boolean;\n}\n\nexport class SimpleAdjacencyList implements AdjacencyList {\n  private _inEdges: Dictionary<string, HashSet<Edge>>;\n  private _outEdges: Dictionary<string, HashSet<Edge>>;\n\n  constructor() {\n    this._inEdges = new Map();\n    this._outEdges = new Map();\n  }\n\n  get isEmpty(): boolean {\n    return this._inEdges.size === 0 && this._outEdges.size === 0;\n  }\n\n  addEdge(src: string, dst: string, fieldName: string): boolean {\n    let outSet = this._outEdges.get(src);\n    if (outSet === undefined) {\n      outSet = new HashSet(hashEdge, eqEdges);\n      this._outEdges.set(src, outSet);\n    }\n    const success = outSet.add({\n      vertex: dst,\n      fieldName,\n    });\n    let inSet = this._inEdges.get(dst);\n    if (inSet === undefined) {\n      inSet = new HashSet(hashEdge, eqEdges);\n      this._inEdges.set(dst, inSet);\n    }\n    // Sanity check. Both sides must be in sync\n    assert(\n      success ===\n        inSet.add({\n          vertex: src,\n          fieldName,\n        }),\n      `addEdge failed. src: ${src}, dest: ${dst}, fieldName: ${fieldName}`\n    );\n    return success;\n  }\n\n  deleteEdge(src: string, dst: string, fieldName: string): boolean {\n    const outSet = this._outEdges.get(src);\n    const inSet = this._inEdges.get(dst);\n    const success = Boolean(outSet?.delete({ vertex: dst, fieldName }));\n    // Sanity check. Both sides must be in sync\n    assert(\n      success ===\n        Boolean(\n          inSet?.delete({\n            vertex: src,\n            fieldName,\n          })\n        ),\n      `deleteEdge failed. src: ${src}, dest: ${dst}, fieldName: ${fieldName}`\n    );\n    return success;\n  }\n\n  inEdges(vertKey: string, fieldName?: string): Generator<Edge> {\n    return filterEdges(vertKey, fieldName, this._inEdges);\n  }\n\n  outEdges(vertKey: string, fieldName?: string): Generator<Edge> {\n    return filterEdges(vertKey, fieldName, this._outEdges);\n  }\n\n  *uniqueEdges(vertKey: string, fieldName?: string): Generator<string> {\n    const seenKeys = new Set<string>();\n    for (const { vertex: key } of this.outEdges(vertKey, fieldName)) {\n      seenKeys.add(key);\n      yield key;\n    }\n    for (const { vertex: key } of this.inEdges(vertKey, fieldName)) {\n      if (seenKeys.has(key)) {\n        continue;\n      }\n      seenKeys.add(key);\n      yield key;\n    }\n  }\n\n  *uniqueVertexKeys(): Generator<string> {\n    for (const key of unionIter(this._inEdges.keys(), this._outEdges.keys())) {\n      // If this generator is broken to chunks by a background coroutine, we may\n      // return old results here\n      if (this.hasVertex(key)) {\n        yield key;\n      }\n    }\n  }\n\n  hasVertex(key: string): boolean {\n    return this._inEdges.has(key) || this._outEdges.has(key);\n  }\n\n  hasEdge(src: string, dst: string, fieldName?: string): boolean {\n    if (fieldName) {\n      return this._outEdges.get(src)?.has({ vertex: dst, fieldName }) === true;\n    }\n    for (const edge of this.outEdges(src)) {\n      if (edge.vertex === dst) {\n        return true;\n      }\n    }\n    return false;\n  }\n}\n\n// export interface LayerFilter {\n//   (src: string, dst: string, fieldName: string): boolean;\n// }\n\n// export interface LayerDef {\n//   name: string;\n//   filter: LayerFilter;\n// }\n\n// export class LayeredAdjacencyList implements AdjacencyList {\n//   private readonly _filters: Dictionary<string, LayerFilter>;\n//   private readonly _layers: Dictionary<string, SimpleAdjacencyList>;\n\n//   constructor(layerDefs: Iterable<LayerDef>) {\n//     this._filters = new Map();\n//     this._layers = new Map();\n//     for (const def of layerDefs) {\n//       const name = def.name;\n//       assert(name.length > 0, 'Empty string is reserved for root layer');\n//       this._filters.set(name, def.filter);\n//       this._layers.set(name, new SimpleAdjacencyList());\n//     }\n//     this._layers.set('', new SimpleAdjacencyList());\n//   }\n\n//   get isEmpty(): boolean {\n//     return this.layer().isEmpty;\n//   }\n\n//   layer(name?: string): SimpleAdjacencyList {\n//     if (!name) {\n//       name = '';\n//     }\n//     const res = this._layers.get(name);\n//     assert(res !== undefined, `Unknown layer name \"${name}\"`);\n//     return res!;\n//   }\n\n//   addEdge(src: string, dst: string, fieldName: string): boolean {\n//     if (!this.layer().addEdge(src, dst, fieldName)) {\n//       return false;\n//     }\n//     for (const [name, filter] of this._filters) {\n//       if (filter(src, dst, fieldName)) {\n//         assert(this.layer(name).addEdge(src, dst, fieldName)); // Sanity check\n//       }\n//     }\n//     return true;\n//   }\n\n//   deleteEdge(src: string, dst: string, fieldName: string): boolean {\n//     // if (!this.layer().deleteEdge(src, dst, fieldName)) {\n//     //   return false;\n//     // }\n//     let success = false;\n//     for (const [name, filter] of this._filters) {\n//       // if (filter(src, dst, fieldName)) {\n//       if (this.layer(name).deleteEdge(src, dst, fieldName)) {\n//         success = true;\n//       }\n//       // }\n//     }\n//     return success;\n//   }\n\n//   inEdges(vertKey: string, fieldName?: string): Generator<Edge> {\n//     return this.layer().inEdges(vertKey, fieldName);\n//   }\n\n//   outEdges(vertKey: string, fieldName?: string): Generator<Edge> {\n//     return this.layer().outEdges(vertKey, fieldName);\n//   }\n\n//   uniqueEdges(vertKey: string, fieldName?: string): Generator<string> {\n//     return this.layer().uniqueEdges(vertKey, fieldName);\n//   }\n\n//   hasVertex(key: string): boolean {\n//     return this.layer().hasVertex(key);\n//   }\n\n//   hasEdge(src: string, dst: string, fieldName?: string): boolean {\n//     return this.layer().hasEdge(src, dst, fieldName);\n//   }\n// }\n\nfunction* filterEdges(\n  vertKey: string,\n  fieldName: string | undefined,\n  dict: Dictionary<string, HashSet<Edge>>\n): Generator<Edge> {\n  const edges = dict.get(vertKey);\n  if (edges === undefined) {\n    return;\n  }\n  for (const edge of edges) {\n    if (fieldName === undefined || edge.fieldName === fieldName) {\n      yield edge;\n    }\n  }\n}\n", "import { JSONValue } from '../../base/interfaces.ts';\nimport { log } from '../../logging/log.ts';\n\ninterface SerializedError {\n  msg: string;\n  code: Code;\n  info?: JSONValue;\n}\n\nexport enum Code {\n  BadRequest = 400,\n  AccessDenied = 403,\n  NotFound = 404,\n  Timeout = 408,\n  Conflict = 409, // Not used\n  InternalServerError = 500,\n  ServiceUnavailable = 503,\n}\n\nexport enum ErrorType {\n  General,\n  Transient,\n  NoAccess,\n}\n\nexport interface IServerError {\n  readonly code: Code;\n  readonly type: ErrorType;\n  readonly message: string;\n}\n\nexport class ServerError extends Error implements IServerError {\n  readonly code: Code;\n  readonly info: JSONValue;\n  private _type?: ErrorType;\n  internalInfo?: JSONValue;\n\n  constructor(\n    msg: string | Code,\n    info?: any,\n    code?: Code,\n    internalInfo?: JSONValue\n  ) {\n    if (typeof msg !== 'string') {\n      code = msg;\n      msg = messageForCode(code);\n    }\n    super(msg);\n    this.code = code || Code.InternalServerError;\n    this.info = info;\n    this.internalInfo = internalInfo;\n  }\n\n  toJS() {\n    return toJS(this);\n  }\n\n  get type() {\n    if (this._type === undefined) {\n      this._type = typeFromCode(this.code);\n    }\n    return this._type;\n  }\n\n  static fromJS(obj: SerializedError) {\n    return fromJS(obj);\n  }\n}\n\nexport function typeFromCode(code: number): ErrorType {\n  switch (code) {\n    case Code.AccessDenied:\n    case Code.NotFound:\n      return ErrorType.NoAccess;\n\n    case Code.Conflict:\n    case Code.Timeout:\n    case Code.ServiceUnavailable:\n    case Code.InternalServerError:\n      return ErrorType.Transient;\n\n    default:\n      return ErrorType.General;\n  }\n}\n\nexport function fromCode(code: Code) {\n  return new ServerError(code);\n}\n\nexport function messageForCode(code: Code): string {\n  // Take the name of the enum and insert spaces before caps\n  return Code[code].replace(/([A-Z])/g, ' $1').trim();\n}\n\nexport function notFound(message?: string): ServerError {\n  return new ServerError(message || Code.NotFound, undefined, Code.NotFound);\n}\n\nexport function badRequest(\n  message?: string,\n  internalInfo?: JSONValue\n): ServerError {\n  return new ServerError(\n    message || Code.BadRequest,\n    undefined,\n    Code.BadRequest,\n    internalInfo\n  );\n}\n\nexport function timeout(): ServerError {\n  return new ServerError(Code.Timeout);\n}\n\nexport function accessDenied(): ServerError {\n  return new ServerError(Code.AccessDenied);\n}\n\nexport function conflict(message?: string): ServerError {\n  return new ServerError(message || Code.Conflict, undefined, Code.Conflict);\n}\n\nexport function txnConflict(txnKey: string, dataRowKey: string) {\n  return new ServerError(Code.Conflict, {\n    txnKey,\n    dataRowKey,\n  });\n}\n\nexport function serviceUnavailable(): ServerError {\n  return new ServerError(Code.ServiceUnavailable);\n}\n\nexport function incompatibleCFDSVersion(\n  serverVersion: string,\n  clientVersion: string\n): ServerError {\n  return new ServerError(Code.BadRequest, {\n    sv: serverVersion,\n    cv: clientVersion,\n  });\n}\n\nexport function unknownCommand(cmd: string, code: Code): ServerError {\n  return new ServerError(\n    code,\n    {\n      cmd: cmd,\n    },\n    undefined\n  );\n}\n\nexport function toJS(error: Error): SerializedError {\n  const result: SerializedError = {\n    msg: error.message,\n    code: error instanceof ServerError ? error.code : Code.InternalServerError,\n  };\n  if (!(error instanceof ServerError)) {\n    log({\n      severity: 'ERROR',\n      error: 'UncaughtServerError',\n      message: error.message,\n      trace: error.stack,\n    });\n  } else if (error.info) {\n    result.info = error.info;\n  }\n  return result;\n}\n\nexport function fromJS(obj: SerializedError): ServerError {\n  return new ServerError(obj.msg, obj.info, obj.code);\n}\n", "import {\n  DataChanges,\n  DecodedDataChange,\n  decodedDataChanges,\n} from './object.ts';\nimport { Scheme } from './scheme.ts';\nimport { JSONValue, ReadonlyJSONObject } from '../../base/interfaces.ts';\nimport {\n  JSONDecoder,\n  JSONEncoder,\n} from '../../base/core-types/encoding/json.ts';\nimport {\n  ConstructorDecoderConfig,\n  Decoder,\n  isDecoderConfig,\n} from '../../base/core-types/encoding/index.ts';\nimport { Encodable, Encoder, Equatable } from '../../base/core-types/index.ts';\n\n/**\n * A single set of changes that should be applied to a specific record.\n * Two checksums are supplied alongside the changes - source and destination.\n * The source checksum is of the document from which the diff was originally\n * computed. The destination checksum is of the document after the changes have\n * been applied.\n *\n * An optional scheme object is included which, if present, represents a\n * request to update the record's scheme.\n */\nexport interface EditConfig {\n  changes: DataChanges;\n  srcChecksum: string;\n  dstChecksum: string;\n  scheme?: Scheme;\n}\n\nexport interface EncodedEdit {\n  c: DecodedDataChange;\n  sc: string;\n  dc: string;\n  s?: ReadonlyJSONObject;\n}\n\nexport class Edit implements Encodable, Equatable {\n  readonly changes: DataChanges;\n  readonly srcChecksum: string;\n  readonly dstChecksum: string;\n  readonly scheme?: Scheme;\n\n  constructor(config: EditConfig | ConstructorDecoderConfig<EncodedEdit>) {\n    if (isDecoderConfig(config)) {\n      const decoder = config.decoder;\n\n      this.changes = decodedDataChanges(decoder.get<DecodedDataChange>('c')!);\n      this.srcChecksum = decoder.get<string>('sc')!;\n      this.dstChecksum = decoder.get<string>('dc')!;\n      this.scheme = decoder.has('s')\n        ? new Scheme({ decoder: decoder.get<Decoder>('s')! })\n        : undefined;\n    } else {\n      this.changes = config.changes;\n      this.srcChecksum = config.srcChecksum;\n      this.dstChecksum = config.dstChecksum;\n      this.scheme = config.scheme;\n    }\n  }\n\n  get affectedKeys() {\n    return Object.keys(this.changes);\n  }\n\n  toJS(): JSONValue {\n    const encoder = new JSONEncoder();\n    this.serialize(encoder);\n    return encoder.getOutput();\n  }\n\n  serialize(encoder: Encoder): void {\n    encoder.set('sc', this.srcChecksum);\n    encoder.set('dc', this.dstChecksum);\n    encoder.set('c', this.changes);\n    encoder.set('s', this.scheme);\n  }\n\n  isEqual(other: Edit): boolean {\n    return (\n      this.srcChecksum === other.srcChecksum &&\n      this.dstChecksum === other.dstChecksum\n    );\n  }\n\n  static fromJS(obj: ReadonlyJSONObject): Edit {\n    const decoder = new JSONDecoder(obj);\n    return new this({ decoder });\n  }\n\n  static editsContainField(edits: Iterable<Edit>, fieldName: string): boolean {\n    for (const e of edits) {\n      if (e.changes.hasOwnProperty(fieldName)) {\n        return true;\n      }\n    }\n    return false;\n  }\n}\n", "export function versionNumberGetMajor(ver: VersionNumber): number {\n  return Math.floor(ver / 10000);\n}\n\nexport function versionNumberGetMinor(ver: VersionNumber): number {\n  return Math.floor((ver % 10000) / 100);\n}\n\nexport function versionNumberGetPatch(ver: VersionNumber): number {\n  return ver % 100;\n}\n\nexport function versionNumberCreate(\n  major: number,\n  minor: number,\n  patch: number\n): number {\n  return major * 10000 + minor * 100 + patch;\n}\n\nexport function versionNumberToString(ver: VersionNumber): string {\n  return [\n    versionNumberGetMajor(ver),\n    versionNumberGetMinor(ver),\n    versionNumberGetPatch(ver),\n  ].join('.');\n}\n\nexport function versionNumberFromString(str: string): VersionNumber {\n  const comps = str.split('.');\n  return versionNumberCreate(\n    parseInt(comps[0]) || 0,\n    parseInt(comps[1]) || 0,\n    parseInt(comps[2]) || 0\n  );\n}\n\nexport enum VersionNumber {\n  Unknown = 0,\n  V3_0_0 = versionNumberCreate(3, 0, 0),\n  Current = V3_0_0,\n}\n", "import {\n  Encodable,\n  Encoder,\n  Equatable,\n  ReadonlyCoreObject,\n} from '../base/core-types/base.ts';\nimport { Record } from '../cfds/base/record.ts';\nimport { Edit } from '../cfds/base/edit.ts';\nimport {\n  ConstructorDecoderConfig,\n  Decodable,\n  Decoder,\n} from '../base/core-types/encoding/types.ts';\nimport { isDecoderConfig } from '../base/core-types/encoding/utils.ts';\nimport { uniqueId } from '../base/common.ts';\nimport { coreValueEquals } from '../base/core-types/equals.ts';\nimport { assert } from '../base/error.ts';\nimport { VersionNumber } from '../defs.ts';\n\nexport type CommitResolver = (commitId: string) => Commit;\n\nexport interface RecordContents extends ReadonlyCoreObject {\n  readonly record: Record;\n}\n\nexport interface DeltaContents extends ReadonlyCoreObject {\n  readonly base: string;\n  readonly edit: Edit;\n}\n\nexport type CommitContents = RecordContents | DeltaContents;\n\nexport interface CommitConfig {\n  id?: string;\n  session: string;\n  key?: string | null;\n  contents: Record | CommitContents;\n  parents?: string | Iterable<string>;\n  timestamp?: Date;\n  buildVersion?: VersionNumber;\n}\n\nexport class Commit implements Encodable, Decodable, Equatable {\n  private _buildVersion: VersionNumber = VersionNumber.Current;\n  private _id!: string;\n  private _session!: string;\n  private _key: string | undefined;\n  private _parents: string[] | undefined;\n  private _timestamp!: Date;\n  private _contents!: CommitContents;\n\n  constructor(config: CommitConfig | ConstructorDecoderConfig) {\n    if (isDecoderConfig(config)) {\n      this.deserialize(config.decoder);\n    } else {\n      let { parents, contents } = config;\n      if (typeof parents === 'string') {\n        parents = [parents];\n      } else if (!parents) {\n        parents = [];\n      } else {\n        parents = Array.from(parents);\n      }\n      if (contents instanceof Record) {\n        contents = {\n          record: contents,\n        };\n      }\n\n      this._id = config.id || uniqueId();\n      this._session = config.session;\n      this._key = config.key || undefined;\n      this._parents = parents as string[];\n      this._timestamp = config.timestamp || new Date();\n      this._contents = contents;\n      this._buildVersion = config.buildVersion || VersionNumber.Current;\n    }\n  }\n\n  get id(): string {\n    return this._id;\n  }\n\n  get key(): string | null {\n    return this._key || null;\n  }\n\n  get session(): string {\n    return this._session;\n  }\n\n  get parents(): string[] {\n    return this._parents || [];\n  }\n\n  get timestamp(): Date {\n    return this._timestamp;\n  }\n\n  get contents(): CommitContents {\n    return this._contents;\n  }\n\n  get contentsChecksum(): string {\n    const contents = this.contents;\n    return commitContentsIsRecord(contents)\n      ? contents.record.checksum\n      : contents.edit.dstChecksum;\n  }\n\n  get buildVersion(): VersionNumber {\n    return this._buildVersion;\n  }\n\n  serialize(encoder: Encoder): void {\n    encoder.set('ver', this.buildVersion);\n    encoder.set('id', this.id);\n    if (this.key) {\n      encoder.set('k', this.key);\n    }\n    encoder.set('s', this.session);\n    encoder.set('ts', this.timestamp);\n    const parents = this.parents;\n    if (parents.length > 0) {\n      encoder.set('p', parents);\n    }\n    const contentsEncoder = encoder.newEncoder();\n    commitContentsSerialize(this.contents, contentsEncoder);\n    encoder.set('c', contentsEncoder.getOutput());\n  }\n\n  deserialize(decoder: Decoder): void {\n    this._buildVersion = decoder.get<number>('ver')!;\n    this._id = decoder.get<string>('id', uniqueId())!;\n    this._key = decoder.get<string | null>('k', null)!;\n    this._session = decoder.get<string>('s', 'unknown-' + uniqueId())!;\n    this._timestamp = decoder.get<Date>('ts', new Date())!;\n    this._parents = decoder.get<string[]>('p');\n    this._contents = commitContentsDeserialize(decoder.getDecoder('c'));\n  }\n\n  isEqual(other: Commit): boolean {\n    if (this.id !== other.id) {\n      return false;\n    }\n    assert(compareCommitsByValue(this, other));\n    return true;\n  }\n}\n\nexport function commitContentsIsDelta(c: CommitContents): c is DeltaContents {\n  return typeof c.base === 'string';\n}\n\nexport function commitContentsIsRecord(c: CommitContents): c is RecordContents {\n  return c.record instanceof Record;\n}\n\nexport function commitContentsSerialize(\n  c: CommitContents,\n  encoder: Encoder\n): void {\n  if (commitContentsIsRecord(c)) {\n    encoder.set('r', c.record);\n  } else {\n    encoder.set('b', c.base);\n    encoder.set('e', c.edit.toJS());\n  }\n}\n\nexport function commitContentsDeserialize(decoder: Decoder): CommitContents {\n  if (decoder.has('r')) {\n    return {\n      record: new Record({ decoder: decoder.getDecoder('r') }),\n    };\n  } else {\n    return {\n      base: decoder.get<string>('b')!,\n      edit: new Edit({ decoder: decoder.getDecoder('e') }),\n    };\n  }\n}\n\nfunction compareCommitsByValue(c1: Commit, c2: Commit): boolean {\n  return (\n    c1.id === c2.id &&\n    c1.buildVersion === c2.buildVersion &&\n    c1.key === c2.key &&\n    c1.session === c2.session &&\n    coreValueEquals(c1.timestamp, c2.timestamp) &&\n    coreValueEquals(c1.parents, c2.parents) &&\n    coreValueEquals(c1.contents, c2.contents)\n  );\n}\n", "import { Dictionary } from './dict.ts';\nimport { assert } from '../error.ts';\n\nexport class MutationError extends Error {\n  constructor() {\n    super('OrderedMap mutated during iteration');\n  }\n}\n\nclass OrderedMapState<K, V> {\n  public _map: Dictionary<K, Link<K, V>>;\n  public _head: Link<K, V>;\n  public _tail: Link<K, V>;\n  public _mutationsCount: number;\n\n  constructor(dictInst?: Dictionary) {\n    this._map = dictInst || new Map();\n    this._head = new Link();\n    this._tail = new Link();\n    this._head.next = this._tail;\n    this._tail.prev = this._head;\n    this._mutationsCount = 0;\n  }\n}\n\n/**\n * A hash table glued with a doubly linked list. Used to build caches, etc.\n * See storage.js for usage. Unless otherwise noted, all ops are O(1).\n */\nexport class OrderedMap<K = any, V = any> implements Dictionary<K, V> {\n  private _state: OrderedMapState<K, V>;\n\n  constructor(dictInst?: Dictionary) {\n    if (dictInst !== undefined) {\n      dictInst.clear();\n    }\n    this._state = new OrderedMapState(dictInst);\n  }\n\n  get size(): number {\n    return this._state._map.size;\n  }\n\n  get startKey(): K | undefined {\n    return this._state._head.next?.key;\n  }\n\n  get endKey(): K | undefined {\n    return this._state._tail.prev?.key;\n  }\n\n  /**\n   * Add a key with no value (undefined value), if the key doesn't already\n   * exist. If it does exist, this method does nothing. New keys are added\n   * at the end.\n   */\n  add(key: K): void {\n    this._addImpl(key);\n  }\n\n  /**\n   * Set the value for a given key, adding it if needed.\n   * New keys are added at the end.\n   */\n  set(key: K, value: V): void {\n    this._addImpl(key).value = value;\n  }\n\n  _addImpl(key: K): Link<K, V> {\n    let link = this._state._map.get(key);\n    if (link !== undefined) {\n      return link;\n    }\n    link = new Link();\n    link.key = key;\n    this._state._tail.insertBefore(link);\n    this._state._map.set(key, link);\n    ++this._state._mutationsCount;\n    assert(this._state._head.length === this._state._map.size + 2);\n    return link;\n  }\n\n  /**\n   * Move a key to the end of the list. Does nothing if the key doesn't exist.\n   */\n  moveToEnd(key: K): void {\n    const link = this._state._map.get(key);\n    if (!link) {\n      return;\n    }\n    this._state._tail.insertBefore(link);\n    ++this._state._mutationsCount;\n    assert(this._state._head.length === this._state._map.size + 2);\n  }\n\n  /**\n   * Move a key to the start of the list. Does nothing if the key doesn't exist.\n   */\n  moveToStart(key: K): void {\n    const link = this._state._map.get(key);\n    if (!link) {\n      return;\n    }\n    this._state._head.insertAfter(link);\n    ++this._state._mutationsCount;\n    assert(this._state._head.length === this._state._map.size + 2);\n  }\n\n  next(key: K): K | undefined {\n    const link = this._state._map.get(key);\n    if (link === undefined) {\n      return undefined;\n    }\n    if (link.next !== this._state._tail) {\n      return link.next!.key;\n    }\n    return undefined;\n  }\n\n  prev(key: K): K | undefined {\n    const link = this._state._map.get(key);\n    if (link === undefined) {\n      return undefined;\n    }\n    if (link.prev !== this._state._head) {\n      return link.prev!.key;\n    }\n    return undefined;\n  }\n\n  /**\n   * Returns whether the given key exists in the collection. Note that a key\n   * may exist with an undefined value. Use this method rather than get() to\n   * distinguish the two cases.\n   */\n  has(key: K): boolean {\n    return this._state._map.has(key);\n  }\n\n  /**\n   * Removes the given key and its associated value from the collection.\n   * Does nothing if the key doesn't exist.\n   */\n  delete(key: K): boolean {\n    const link = this._state._map.get(key);\n    if (!link) {\n      return false;\n    }\n    link.detach();\n    this._state._map.delete(key);\n    ++this._state._mutationsCount;\n    assert(this._state._head.length === this._state._map.size + 2);\n    return true;\n  }\n\n  /**\n   * Returns the value for the given key or undefined if the key doesn't exist.\n   */\n  get(key: K): V | undefined {\n    const link = this._state._map.get(key);\n    return link?.value;\n  }\n\n  clear(): void {\n    this._state._map.clear();\n    this._state._head.next = this._state._tail;\n    this._state._tail.prev = this._state._head;\n  }\n\n  /**\n   * Returns an iterator over the keys in the collection. Keys are returned\n   * by their internal order.\n   * Any attempt to mutate the collection during iteration will cause the\n   * iterator to throw a MutationError.\n   */\n  keysIter(): Iterable<K> {\n    return this.keys();\n  }\n\n  keys(): Iterable<K> {\n    return new OrderedMapIter<K, V>(this._state, true, false) as Iterable<K>;\n  }\n\n  values(): Iterable<V> {\n    return new OrderedMapIter<K, V>(this._state, false, true) as Iterable<V>;\n  }\n\n  /**\n   * Returns an iterator over the keys and values in the collection.\n   * Entries are returned by their internal order.\n   * Any attempt to mutate the collection during iteration will cause the\n   * iterator to throw a MutationError.\n   */\n  entries(): Iterable<[K, V]> {\n    return new OrderedMapIter(this._state, true, true) as Iterable<[K, V]>;\n  }\n\n  [Symbol.iterator](): Iterator<[K, V]> {\n    return new OrderedMapIter(this._state, true, true) as Iterator<[K, V]>;\n  }\n}\n\n/**\n * A crude doubly linked list. Enjoy.\n */\nclass Link<K, V> {\n  public next: Link<K, V> | undefined;\n  public prev: Link<K, V> | undefined;\n  public key: K | undefined;\n  public value: V | undefined;\n\n  detach() {\n    this._validateLinks();\n    if (this.next) {\n      this.next.prev = this.prev;\n    }\n    if (this.prev) {\n      this.prev.next = this.next;\n    }\n    this.next = undefined;\n    this.prev = undefined;\n  }\n\n  _validateLinks() {\n    if (this.next) {\n      assert(this.next.prev === this);\n    }\n    if (this.prev) {\n      assert(this.prev.next === this);\n    }\n  }\n\n  insertAfter(next: Link<K, V>): void {\n    assert(next !== this);\n    next.detach();\n    next.prev = this;\n    next.next = this.next;\n    if (this.next !== undefined) {\n      this.next.prev = next;\n    }\n    this.next = next;\n    this._validateLinks();\n    next._validateLinks();\n    next.prev._validateLinks();\n  }\n\n  insertBefore(prev: Link<K, V>): void {\n    assert(prev !== this);\n    prev.detach();\n    prev.next = this;\n    prev.prev = this.prev;\n    if (this.prev !== undefined) {\n      this.prev.next = prev;\n    }\n    this.prev = prev;\n    this._validateLinks();\n    prev._validateLinks();\n    prev.next._validateLinks();\n  }\n\n  get length() {\n    let count = 1;\n    for (let node: Link<K, V> = this; node.next; node = node.next) {\n      ++count;\n    }\n    return count;\n  }\n}\n\nclass OrderedMapIter<K, V> {\n  private readonly _state: OrderedMapState<K, V>;\n  private readonly _mutationsCount: number;\n  private readonly _includeKeys: boolean;\n  private readonly _includeValues: boolean;\n  private _nextLink: Link<K, V>;\n\n  constructor(\n    state: OrderedMapState<K, V>,\n    includeKeys: boolean,\n    includeValues: boolean\n  ) {\n    this._state = state;\n    this._mutationsCount = state._mutationsCount;\n    this._nextLink = state._head;\n    this._includeKeys = includeKeys;\n    this._includeValues = includeValues;\n  }\n\n  next(): {\n    done: boolean;\n    value?: K | V | [K | undefined, V | undefined] | undefined;\n  } {\n    if (this._state._mutationsCount !== this._mutationsCount) {\n      throw new MutationError();\n    }\n    const probablyLink = this._nextLink.next;\n    assert(probablyLink !== undefined);\n    const link = probablyLink!;\n    this._nextLink = link;\n    if (link === this._state._tail) {\n      return { done: true };\n    }\n    let v: K | V | [K | undefined, V | undefined] | undefined;\n    const linkValue = this._state._map.get(link.key!)?.value;\n    if (this._includeKeys) {\n      v = this._includeValues ? [link.key!, linkValue] : link.key!;\n    } else {\n      v = linkValue;\n    }\n    return {\n      done: false,\n      value: v,\n    };\n  }\n\n  [Symbol.iterator]() {\n    return this;\n  }\n}\n", "import { Dictionary } from './dict.ts';\nimport { OrderedMap } from './orderedmap.ts';\n\nexport type EvictionHandler<K, V> = (key: K, value: V) => void;\n\nexport class LRUCache<K, V> implements Dictionary<K, V> {\n  private readonly _map: OrderedMap<K, V>;\n  private readonly _evictionHandler?: EvictionHandler<K, V>;\n  private _limit: number;\n\n  constructor(limit?: number, evictionHandler?: EvictionHandler<K, V>) {\n    this._map = new OrderedMap();\n    this._evictionHandler = evictionHandler;\n    this._limit = Math.max(0, limit || 0);\n  }\n\n  get size(): number {\n    return this._map.size;\n  }\n\n  get limit(): number {\n    return this._limit;\n  }\n\n  set limit(limit: number) {\n    this._limit = Math.max(0, limit);\n    this.evictValuesIfNeeded();\n  }\n\n  get(key: K): V | undefined {\n    this._map.moveToEnd(key);\n    return this._map.get(key);\n  }\n\n  has(key: K): boolean {\n    this._map.moveToEnd(key);\n    return this._map.has(key);\n  }\n\n  entries(): Iterable<[K, V]> {\n    return this._map.entries();\n  }\n\n  keys(): Iterable<K> {\n    return this._map.keys();\n  }\n\n  values(): Iterable<V> {\n    return this._map.values();\n  }\n\n  [Symbol.iterator](): Iterator<[K, V]> {\n    return this._map[Symbol.iterator]();\n  }\n\n  set(key: K, value: V): void {\n    const map = this._map;\n    const valueExists = map.has(key);\n    map.set(key, value);\n    if (valueExists) {\n      map.moveToEnd(key);\n    } else {\n      this.evictValuesIfNeeded();\n    }\n  }\n\n  delete(key: K): boolean {\n    return this._map.delete(key);\n  }\n\n  clear(): void {\n    this._map.clear();\n  }\n\n  private evictValuesIfNeeded(): void {\n    const map = this._map;\n    const limit = this._limit;\n    const evictionHandler = this._evictionHandler;\n    while (limit > 0 && map.size > limit) {\n      const key = map.startKey!;\n      if (evictionHandler) {\n        evictionHandler(key, map.get(key)!);\n      }\n      map.delete(map.startKey!);\n    }\n  }\n}\n", "import EventEmitter from 'https://esm.sh/eventemitter3@4.0.7';\nimport { coreValueCompare, coreValueEquals } from '../base/core-types/index.ts';\nimport * as SetUtils from '../base/set.ts';\nimport { Dictionary } from '../base/collections/dict.ts';\nimport { Code, ServerError, serviceUnavailable } from '../cfds/base/errors.ts';\nimport { Commit, commitContentsIsRecord, DeltaContents } from './commit.ts';\nimport { concatChanges, DataChanges } from '../cfds/base/object.ts';\nimport { Record } from '../cfds/base/record.ts';\nimport { assert, notReached } from '../base/error.ts';\nimport { JSONCyclicalEncoder } from '../base/core-types/encoding/json.ts';\nimport { Edit } from '../cfds/base/edit.ts';\nimport { log } from '../logging/log.ts';\nimport { kRecordIdField } from '../cfds/base/scheme-types.ts';\nimport { LRUCache } from '../base/collections/lru-cache.ts';\n\nexport const EVENT_NEW_COMMIT = 'NewCommit';\n\nexport interface RepoStorage<T extends RepoStorage<T>> {\n  numberOfCommits(): number;\n  getCommit(id: string): Commit | undefined;\n  allCommits(): Iterable<Commit>;\n  commitsForKey(key: string | null): Iterable<Commit>;\n  allKeys(): Iterable<string>;\n  persistCommits(c: Iterable<Commit>, repo: Repository<T>): Iterable<Commit>;\n  close(): void;\n}\n\nexport class Repository<ST extends RepoStorage<ST>> extends EventEmitter {\n  readonly storage: ST;\n\n  constructor(storage: ST) {\n    super();\n    this.storage = storage;\n  }\n\n  get numberOfCommits(): number {\n    return this.storage.numberOfCommits();\n  }\n\n  getCommit(id: string): Commit {\n    const c = this.storage.getCommit(id);\n    if (!c) {\n      throw serviceUnavailable();\n    }\n    return c;\n  }\n\n  commits(): Iterable<Commit> {\n    return this.storage.allCommits();\n  }\n\n  commitsForKey(key: string | null): Iterable<Commit> {\n    return this.storage.commitsForKey(key);\n  }\n\n  leavesForKey(key: string | null, pendingCommit?: Commit): Commit[] {\n    const childrenPerCommit = new Map<string, Set<Commit>>();\n    for (const c of this.commitsForKey(key)) {\n      this._setChildrenPerCommit(c, childrenPerCommit);\n    }\n    if (pendingCommit) {\n      assert(pendingCommit.key === key); // Sanity check\n      this._setChildrenPerCommit(pendingCommit, childrenPerCommit);\n    }\n    const result: Commit[] = [];\n    for (const c of this.commitsForKey(key)) {\n      if (!childrenPerCommit.has(c.id)) {\n        result.push(c);\n      }\n    }\n    return result;\n  }\n\n  private _setChildrenPerCommit(\n    c: Commit,\n    childrenPerCommit: Map<string, Set<Commit>>\n  ): void {\n    for (const p of c.parents) {\n      let children = childrenPerCommit.get(p);\n      if (!children) {\n        children = new Set();\n        childrenPerCommit.set(p, children);\n      }\n      children.add(c);\n    }\n  }\n\n  keys(): Iterable<string> {\n    return this.storage.allKeys();\n  }\n\n  /**\n   * Given an iterable of commits, this method returns their Lowest Common\n   * Ancestor or undefined if no such ancestor exists (meaning the commits\n   * belong to disconnected histories).\n   *\n   * @param commits An iterable of commits.\n   * @returns The LCA commit or undefined if no common ancestor exists.\n   * @throws ServiceUnavailable if the commit graph is incomplete.\n   */\n  findMergeBase(commits: Iterable<Commit>): Commit | undefined {\n    let result: Commit | undefined;\n    for (const c of commits) {\n      if (!result) {\n        result = c;\n        continue;\n      }\n      result = this._findMergeBase(result, c);\n      if (!result) {\n        break;\n      }\n    }\n    return result;\n  }\n\n  /**\n   * Given two commits, this method finds the base from which to perform a 3 way\n   * merge for c1 and c2. The algorithm is based on a simple Lowest Common\n   * Ancestor between the two, but rather than pick the actual LCA from the\n   * graph, we choose the first time ancestors agree on a common value.\n   *\n   * @param c1 First commit.\n   * @param c2 Second commit.\n   * @param c1Ancestors Internal c1 path for recursion.\n   * @param c2Ancestors Internal c2 path for recursion.\n   *\n   * @returns The base for a 3-way merge between c1 and c2, or undefined if no\n   *          such base can be found.\n   *\n   * @throws ServiceUnavailable if the commit graph is incomplete and cannot be\n   *         traversed.\n   */\n  private _findMergeBase(\n    c1: Commit,\n    c2: Commit,\n    c1Ancestors?: Set<string>,\n    c2Ancestors?: Set<string>\n  ): Commit | undefined {\n    if (!c1.parents.length || !c2.parents.length || c1.key !== c2.key) {\n      return undefined;\n    }\n    if (c1.contentsChecksum === c2.contentsChecksum) {\n      return c1;\n    }\n    if (!c1Ancestors) {\n      c1Ancestors = new Set();\n    }\n    if (!c2Ancestors) {\n      c2Ancestors = new Set();\n    }\n    for (const parentId of c1.parents) {\n      const parent = this.getCommit(parentId);\n      const checksum = parent.contentsChecksum;\n      if (c2Ancestors.has(checksum)) {\n        return parent;\n      }\n      c1Ancestors.add(checksum);\n    }\n    for (const parentId of c2.parents) {\n      const parent = this.getCommit(parentId);\n      const checksum = parent.contentsChecksum;\n      if (c1Ancestors.has(checksum)) {\n        return parent;\n      }\n      c2Ancestors.add(checksum);\n    }\n    for (const p of c1.parents) {\n      const r = this._findMergeBase(\n        this.getCommit(p),\n        c2,\n        c1Ancestors,\n        c2Ancestors\n      );\n      if (r) {\n        return r;\n      }\n    }\n    for (const p of c2.parents) {\n      const r = this._findMergeBase(\n        c1,\n        this.getCommit(p),\n        c1Ancestors,\n        c2Ancestors\n      );\n      if (r) {\n        return r;\n      }\n    }\n    return undefined;\n  }\n\n  recordForCommit(c: Commit | string): Record {\n    if (typeof c === 'string') {\n      c = this.getCommit(c);\n    }\n    if (c.contents.record) {\n      return c.contents.record as Record;\n    }\n    if (c.contents.base) {\n      const contents: DeltaContents = c.contents as DeltaContents;\n      const result = this.recordForCommit(contents.base).clone();\n      assert(result.checksum === contents.edit.srcChecksum);\n      result.patch(contents.edit.changes);\n      assert(result.checksum === contents.edit.dstChecksum);\n      return result;\n    }\n    notReached();\n  }\n\n  headForKey(\n    key: string | null,\n    session: string,\n    pendingCommit?: Commit\n  ): Commit | undefined {\n    assert(!pendingCommit || pendingCommit.key === key);\n    const leaves = this.leavesForKey(key, pendingCommit);\n    if (leaves.length < 1) {\n      // No commit history found. Return the null record as a starting point\n      return undefined;\n    }\n    // Filter out any commits with equal records\n    const commitsToMerge = commitsWithUniqueRecords(leaves);\n    // If our leaves converged on a single value, we can simply return it\n    if (commitsToMerge.length === 1) {\n      return commitsToMerge[0];\n    }\n    // At this point our leaves have more than one value. Try to merge them all\n    // to a single value. Currently we're simply doing a crude N-way merge and\n    // rely on our patch to come up with a nice result. A better way may be to\n    // do a recursive 3-way merge like git does.\n    try {\n      // Find the base for our N-way merge\n      const lca = this.findMergeBase(commitsToMerge);\n      // If no LCA is found then we're dealing with concurrent writers who all\n      // created of the same key unaware of each other.\n      // Use the null record as a base in this case.\n      const base = lca ? this.recordForCommit(lca) : Record.nullRecord();\n      // TODO: Scheme upgrade\n      // TODO: Commit version upgrade\n      // Compute a compound diff from our base to all unique records\n      let changes: DataChanges = {};\n      for (const c of commitsToMerge) {\n        changes = concatChanges(\n          changes,\n          base.diff(this.recordForCommit(c), c.session === session)\n        );\n      }\n      const mergeRecord = base.clone();\n      mergeRecord.patch(changes);\n      const mergeCommit = new Commit({\n        session,\n        key,\n        contents: mergeRecord,\n        parents: leaves.map((c) => c.id),\n      });\n      this.persistCommits([mergeCommit]);\n      return mergeCommit;\n    } catch (e) {\n      // We're dealing with partial history, so need to come up with some value\n      // that makes sense\n      if (e instanceof ServerError && e.code === Code.ServiceUnavailable) {\n        // Since we're dealing with a partial graph, some of our leaves may not\n        // actually be leaves. For example, let's consider c4 -> c3 -> c2 -> c1.\n        // If we somehow temporarily lost c2 and c4, we would consider both c3\n        // and c1 as leaves. Therefore, we first sort all our leaves from\n        // newest to oldest.\n        leaves.sort(compareCommitsDesc);\n        // Preserve local consistency for the caller and return whichever value\n        // it wrote last.\n        for (const c of leaves) {\n          if (c.session === session) {\n            return c;\n          }\n        }\n        // No session was provided. Return the last globally written value.\n        return leaves[0];\n      }\n      // Unknown error. Rethrow.\n      throw e;\n    }\n  }\n\n  valueForKey(\n    key: string | null,\n    session: string,\n    pendingCommit?: Commit\n  ): Record {\n    const head = this.headForKey(key, session, pendingCommit);\n    return head ? this.recordForCommit(head) : Record.nullRecord();\n  }\n\n  setValueForKey(key: string | null, session: string, value: Record): boolean {\n    const head = this.headForKey(key, session);\n    if (head && this.recordForCommit(head).isEqual(value)) {\n      return false;\n    }\n    if (!head && value.isNull) {\n      return false;\n    }\n    const lastRecordCommit = this.lastRecordCommitForKey(key);\n    const fullCommit = new Commit({\n      session,\n      key,\n      contents: value,\n      parents: head?.id,\n    });\n    let deltaCommit: Commit | undefined;\n    if (lastRecordCommit) {\n      const baseRecord = this.recordForCommit(lastRecordCommit);\n      const edit = new Edit({\n        changes: baseRecord.diff(value, false),\n        srcChecksum: baseRecord.checksum,\n        dstChecksum: value.checksum,\n      });\n      const commitEncoder = new JSONCyclicalEncoder();\n      commitEncoder.set('c', [fullCommit]);\n      const deltaLength = JSON.stringify(edit.toJS()).length;\n      const fullLength = JSON.stringify(commitEncoder.getOutput()).length;\n      // Only if our delta format is small enough relative to the full format,\n      // then it's worth switching to it\n      if (deltaLength <= fullLength * 0.85) {\n        deltaCommit = new Commit({\n          id: fullCommit.id,\n          session,\n          key,\n          contents: { base: lastRecordCommit.id, edit },\n          parents: fullCommit.parents,\n        });\n        log({\n          severity: 'INFO',\n          name: 'DeltaFormatSavings',\n          value: Math.round((100 * (fullLength - deltaLength)) / fullLength),\n          unit: 'Percent',\n        });\n      }\n    }\n    this.persistCommits([deltaCommit || fullCommit]);\n    return true;\n  }\n\n  private lastRecordCommitForKey(key: string | null): Commit | undefined {\n    let result: Commit | undefined;\n    for (const c of this.commitsForKey(key)) {\n      if (!commitContentsIsRecord(c.contents)) {\n        continue;\n      }\n      if (!result || c.timestamp.getTime() > result.timestamp.getTime()) {\n        result = c;\n      }\n    }\n    return result;\n  }\n\n  hasKey(key: string | null): boolean {\n    return this.headForKey(key, '') !== undefined;\n  }\n\n  persistCommits(commits: Iterable<Commit>): Commit[] {\n    const result = Array.from(this.storage.persistCommits(commits, this));\n    for (const c of result) {\n      this.emit(EVENT_NEW_COMMIT, c);\n    }\n    return result;\n  }\n\n  repositoryIdForCommit(c: Commit | string): string {\n    const record = this.recordForCommit(c);\n    const repoFieldName = record.scheme.repositoryFieldName;\n    if (repoFieldName === kRecordIdField) {\n      const commit = typeof c === 'string' ? this.getCommit(c) : c;\n      assert(commit !== undefined && commit.key !== undefined);\n      return commit.key!;\n    }\n    const result = record.get<string>(repoFieldName);\n    assert(result?.length > 0);\n    return result;\n  }\n}\n\nfunction commitsWithUniqueRecords(commits: Iterable<Commit>): Commit[] {\n  const hashes = new Set<string>();\n  const result: Commit[] = [];\n  for (const c of commits) {\n    const h = commitContentsIsRecord(c.contents)\n      ? c.contents.record.checksum\n      : c.contents.edit.dstChecksum;\n    if (!hashes.has(h)) {\n      result.push(c);\n      hashes.add(h);\n    }\n  }\n  return result;\n}\n\nfunction compareCommitsDesc(c1: Commit, c2: Commit): number {\n  // Use the commit id as a consistent tie breaker when timestamps are equal\n  if (coreValueEquals(c1.timestamp, c2.timestamp)) {\n    return coreValueCompare(c1.id, c2.id);\n  }\n  // Reverse order so we get descending timestamps\n  return coreValueCompare(c2.timestamp, c1.timestamp);\n}\n\nexport class MemRepoStorage implements RepoStorage<MemRepoStorage> {\n  // Key -> Commit Id -> Commit\n  private readonly _commitsByRecordKey: Dictionary<string | null, Set<string>>;\n  private readonly _commitsById: LRUCache<string, Commit>;\n\n  constructor(commits?: Iterable<Commit>, maxCommits = 0) {\n    this._commitsByRecordKey = new Map();\n    this._commitsById = new LRUCache(maxCommits, (_id, commit) => {\n      this._commitsByRecordKey.get(commit.key)?.delete(commit.id);\n    });\n    if (commits) {\n      for (const c of commits) {\n        let keyMap = this._commitsByRecordKey.get(c.key);\n        if (!keyMap) {\n          keyMap = new Set();\n          this._commitsByRecordKey.set(c.key, keyMap);\n        }\n        keyMap.add(c.id);\n        this._commitsById.set(c.id, c);\n      }\n    }\n  }\n\n  get maxCommits(): number {\n    return this._commitsById.limit;\n  }\n\n  set maxCommits(limit: number) {\n    this._commitsById.limit = limit;\n  }\n\n  numberOfCommits(): number {\n    return this._commitsById.size;\n  }\n\n  getCommit(id: string): Commit | undefined {\n    return this._commitsById.get(id);\n  }\n\n  allCommits(): Iterable<Commit> {\n    return this._commitsById.values();\n  }\n\n  commitsForKey(key: string): Iterable<Commit> {\n    const keyMap = this._commitsByRecordKey.get(key);\n    if (!keyMap) {\n      return [];\n    }\n    return SetUtils.mapToArray(keyMap, (id) => this.getCommit(id));\n  }\n\n  *allKeys(): Generator<string> {\n    for (const k of this._commitsByRecordKey.keys()) {\n      if (typeof k === 'string') {\n        yield k;\n      }\n    }\n  }\n\n  *persistCommits(commits: Iterable<Commit>): Generator<Commit> {\n    for (const c of commits) {\n      const localCommit = this._commitsById.get(c.id);\n      if (localCommit !== undefined) {\n        // Sanity check: Both copies of the same commit must be equal.\n        // TODO: Rather than crash, assume the other side may be malicious\n        assert(coreValueEquals(c, localCommit));\n        continue;\n      }\n      this._commitsById.set(c.id, c);\n      let set = this._commitsByRecordKey.get(c.key);\n      if (!set) {\n        set = new Set();\n        this._commitsByRecordKey.set(c.key, set);\n      }\n      set.add(c.id);\n      yield c;\n    }\n  }\n\n  close(): void {}\n}\n", "import {\n  openDB,\n  deleteDB,\n  DBSchema,\n  IDBPDatabase,\n} from 'https://esm.sh/idb@7.1.1';\nimport {\n  JSONCyclicalDecoder,\n  JSONCyclicalEncoder,\n} from '../base/core-types/encoding/json.ts';\nimport { serializeDate } from '../base/date.ts';\nimport { ReadonlyJSONObject } from '../base/interfaces.ts';\nimport { log } from '../logging/log.ts';\nimport { Commit } from './commit.ts';\nimport * as StringUtils from '../base/string.ts';\nimport { assert } from '../base/error.ts';\n\nconst K_DB_VERSION = 1;\n\ninterface RepoBackupSchema extends DBSchema {\n  commits: {\n    key: string;\n    value: {\n      json: ReadonlyJSONObject;\n      ts: number;\n    };\n  };\n}\n\nexport class IDBRepositoryBackup {\n  private _dbPromise: Promise<IDBPDatabase<RepoBackupSchema>> | undefined;\n  constructor(readonly dbName: string) {\n    this.getDB(); // Start open of our DB as soon as possible\n  }\n\n  private getDB(): Promise<IDBPDatabase<RepoBackupSchema>> {\n    if (this._dbPromise === undefined) {\n      this._dbPromise = openDB<RepoBackupSchema>(this.dbName, K_DB_VERSION, {\n        upgrade(db) {\n          db.createObjectStore('commits');\n        },\n      });\n    }\n    return this._dbPromise;\n  }\n\n  async close(): Promise<boolean> {\n    if (undefined === this._dbPromise) {\n      return false;\n    }\n    const db = await this._dbPromise;\n    db.close();\n    this._dbPromise = undefined;\n    return true;\n  }\n\n  async delete(): Promise<void> {\n    await this.close();\n    await deleteDB(this.dbName);\n  }\n\n  async persistCommits(\n    repoId: string,\n    commits: Iterable<Commit>\n  ): Promise<void> {\n    const db = await this.getDB();\n    const txn = db.transaction('commits', 'readwrite', {\n      durability: 'relaxed',\n    });\n    const store = txn.objectStore('commits');\n    const promises: Promise<void>[] = [];\n    for (const c of commits) {\n      promises.push(\n        (async () => {\n          try {\n            await store.put(\n              {\n                json: JSONCyclicalEncoder.serialize(c),\n                ts: serializeDate(c.timestamp),\n              },\n              `${repoId}/${c.id}`\n            );\n          } catch (e) {\n            log({\n              severity: 'ERROR',\n              error: 'BackupWriteFailed',\n              message: e.message,\n              trace: e.stack,\n              repo: repoId,\n              commit: c.id,\n            });\n            throw e;\n          }\n        })()\n      );\n    }\n    for (const p of promises) {\n      await p;\n    }\n    await txn.done;\n  }\n\n  async loadCommits(repoId?: string): Promise<{ [repoId: string]: Commit[] }> {\n    const db = await this.getDB();\n    const txn = db.transaction('commits', 'readonly');\n    const result: { [repoId: string]: Commit[] } = {};\n    let cursor;\n    if (repoId) {\n      const prefix = repoId + '/';\n      cursor = await txn.store.openCursor(\n        IDBKeyRange.bound(prefix, StringUtils.increment(prefix), false, true)\n      );\n    } else {\n      cursor = await txn.store.openCursor();\n    }\n    while (cursor) {\n      const repoId = repoIdFromKey(cursor.key);\n      let arr = result[repoId];\n      if (!arr) {\n        arr = [];\n        result[repoId] = arr;\n      }\n      arr.push(\n        new Commit({\n          decoder: new JSONCyclicalDecoder(cursor.value.json),\n        })\n      );\n      await cursor.continue();\n    }\n    return result;\n  }\n}\n\nfunction repoIdFromKey(key: string): string {\n  const sepIdx = key.indexOf('/');\n  assert(sepIdx > 0);\n  return key.substring(0, sepIdx);\n}\n", "import {\n  encode as b64Encode,\n  decode as b64Decode,\n} from 'https://deno.land/std@0.159.0/encoding/base64.ts';\nimport { assert } from './error.ts';\nimport { MurmurHash3 } from './hash.ts';\nimport { CoreValue, Encodable, Encoder } from './core-types/base.ts';\nimport {\n  ConstructorDecoderConfig,\n  Decodable,\n  DecodedValue,\n  Decoder,\n  isDecoderConfig,\n} from './core-types/encoding/index.ts';\nimport { ReadonlyJSONObject } from './interfaces.ts';\n\n/**\n * A buffer that provides access to single bits by index.\n * Designed as storage for BloomFilter.\n */\nclass BitField {\n  buffer: Uint8Array;\n\n  constructor(size: number) {\n    const byteLength = Math.ceil(size / 8);\n    this.buffer = new Uint8Array(byteLength);\n  }\n\n  get bitSize() {\n    return this.byteSize * 8;\n  }\n\n  get byteSize() {\n    return this.buffer.byteLength;\n  }\n\n  get(idx: number): boolean {\n    const byteOffset = idx >> 3; // floor(idx / 8)\n    const bitMask = 1 << idx % 8;\n    return (this.buffer[byteOffset] & bitMask) !== 0;\n  }\n\n  set(idx: number, value: boolean): void {\n    const byteOffset = idx >> 3; // floor(idx / 8)\n    const bitMask = 1 << idx % 8;\n    const buf = this.buffer;\n    if (value) {\n      buf[byteOffset] = buf[byteOffset] | bitMask;\n    } else {\n      buf[byteOffset] = buf[byteOffset] & ~bitMask;\n    }\n  }\n\n  clear(): void {\n    this.buffer.fill(0);\n  }\n}\n\nexport interface BloomFilterOptions {\n  // Expected number of items\n  size: number;\n  // 0-1, false-positive rate (e.g. 0.01 = 1%, meaning 1 of every 100 true\n  // membership test will actually be false).\n  fpr?: number;\n  // Number of total bits in filter. Leave undefined for optimal value\n  m?: number;\n  // Number of hash functions. Leave undefined for optimal value\n  k?: number;\n  // If k is left undefined, you may provide a max number of hashes\n  maxHashes?: number;\n}\n\nexport interface EncodedBloomFilter extends ReadonlyJSONObject {\n  d: string; // BitField instance encoded as Base64\n  s: number[]; // An array of hash seeds\n}\n\n/**\n * A simple Bloom Filter implementation using MurmurHash3.\n */\nexport class BloomFilter implements Encodable, Decodable {\n  private _filter: BitField;\n  private _hashes: MurmurHash3[];\n\n  constructor(\n    options: BloomFilterOptions | ConstructorDecoderConfig<EncodedBloomFilter>\n  ) {\n    if (isDecoderConfig(options)) {\n      this._filter = new BitField(1);\n      this._hashes = [];\n      this.deserialize(options.decoder);\n    } else {\n      const { size, fpr, maxHashes } = options;\n      let { m, k } = options;\n      if (m === undefined) {\n        assert(fpr !== undefined);\n        m = Math.ceil(\n          (size * Math.log(fpr!)) / Math.log(1 / Math.pow(2, Math.log(2)))\n        );\n      }\n      if (k === undefined) {\n        k = (m / size) * Math.log(2);\n      }\n\n      if (maxHashes !== undefined) {\n        k = Math.max(k, maxHashes);\n      }\n\n      this._filter = new BitField(m);\n      this._hashes = [];\n      for (let i = 0; i < k; ++i) {\n        this._hashes.push(new MurmurHash3());\n      }\n    }\n  }\n\n  /**\n   * Returns the number of bytes the filter occupies.\n   */\n  get byteSize() {\n    return this._filter.byteSize;\n  }\n\n  fillRate(): number {\n    const filter = this._filter;\n    let count = 0;\n    for (let i = 0; i < filter.bitSize; ++i) {\n      if (filter.get(i)) {\n        ++count;\n      }\n    }\n    return count / filter.bitSize;\n  }\n\n  /**\n   * Adds a value to the filter\n   */\n  add(value: string): void {\n    const buf = this._filter;\n    const size = buf.bitSize;\n    for (const h of this._hashes) {\n      h.hash(value);\n      const v = h.result();\n      buf.set(v % size, true);\n      h.reset();\n    }\n  }\n\n  /**\n   * Returns whether the key exists or not in the filter.\n   */\n  has(value: string): boolean {\n    const buf = this._filter;\n    const size = buf.bitSize;\n    for (const h of this._hashes) {\n      h.hash(value);\n      const v = h.result();\n      h.reset();\n      if (!buf.get(v % size)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  clear(): BloomFilter {\n    this._filter.clear();\n    for (const hash of this._hashes) {\n      hash.resetSeed();\n    }\n    return this;\n  }\n\n  serialize(\n    encoder: Encoder<string, CoreValue, unknown, unknown>,\n    _options?: unknown\n  ): void {\n    encoder.set('d', b64Encode(this._filter.buffer));\n    encoder.set(\n      's',\n      this._hashes.map((h) => h.seed)\n    );\n  }\n\n  deserialize(\n    decoder: Decoder<string, DecodedValue>,\n    _options?: unknown\n  ): void {\n    this._filter.buffer = b64Decode(decoder.get('d')!);\n    this._hashes = decoder\n      .get<number[]>('s')!\n      .map((seed) => new MurmurHash3(seed));\n  }\n}\n", "import { BloomFilter } from '../base/bloom.ts';\nimport { uniqueId } from '../base/common.ts';\nimport { CoreValue, Encodable, Encoder } from '../base/core-types/base.ts';\nimport {\n  JSONCyclicalDecoder,\n  JSONCyclicalEncoder,\n} from '../base/core-types/encoding/json.ts';\nimport {\n  ConstructorDecoderConfig,\n  Decodable,\n  DecodedValue,\n  Decoder,\n  ReadonlyDecodedArray,\n} from '../base/core-types/encoding/types.ts';\nimport { isDecoderConfig } from '../base/core-types/encoding/utils.ts';\nimport { ReadonlyJSONObject } from '../base/interfaces.ts';\nimport { VersionNumber } from '../defs.ts';\nimport { NormalizedLogEntry } from '../logging/entry.ts';\nimport { Commit } from '../repo/commit.ts';\n\nexport const K_DEFAULT_TTL_MS = 30 * 24 * 60 * 60 * 1000;\n\n/**\n * We currently run two distinct types of sync loops: one for collaborative data\n * containing Commit instances, and another for append only log entries.\n * Sync messages support both types of values.\n */\nexport type SyncValueType = Commit | NormalizedLogEntry;\n\n/**\n * An initial configuration needed to instantiate a new SyncMessage instance.\n */\nexport interface SyncMessageConfig<T extends SyncValueType> {\n  /**\n   * A bloom filter holding a record of all value IDs this peer has persisted.\n   */\n  filter: BloomFilter;\n  /**\n   * The number of entries the peer which constructed this message, had at the\n   * time of construction.\n   */\n  size: number;\n  /**\n   * An array of values that the other side is suspected to be missing.\n   */\n  values?: T[];\n  /**\n   * A list of identifiers for which the sender was denied access.\n   */\n  accessDenied?: Iterable<string>;\n  /**\n   * The protocol used by the sender. If not provided, will use whatever the\n   * current build is.\n   */\n  buildVersion?: VersionNumber;\n}\n\nexport enum SyncValueFlag {\n  Object = 0,\n  Commit = 1,\n}\n\n/**\n * The Ovvio sync protocol is stateless, peer-to-peer (fully symmetric),\n * lockless, and works on any collection of append-only unordered items.\n *\n * NOTE: In a future version we may remove the append-only restriction but for\n *       now it's not useful for our specific use case.\n *\n * The protocol works as follows:\n * 1. Peer A scans its local collection in a single pass.\n *    For every encountered entry, it records the entry's unique ID in a bloom\n *    filter. Once completed, A sends the resulting filter to peer B.\n *\n * 2. Peer B receives A's filter. It then does a similar local scan of its local\n *    collection, recording IDs in a new bloom filter exactly like step 1.\n *    For every encountered ID, B also checks if it exists in the filter just\n *    received from A. B notes any entries A does not have (no false negatives\n *    in bloom filters), and sends them to A alongside its locally computed\n *    filter.\n *\n * 3. The cycle repeats indefinitely. As long as both peers continue to\n *    randomly choose their the bloom filter's hash functions, eventually both\n *    collections will end up in sync.\n *\n * To control the work the protocol does, we take into account a few different\n * parameters:\n *\n * - The size difference between the collection of two peers (how much entries\n *   do we need to push). Typically we'll be handling one of two extremes:\n *   either the entire collection needs to be copied (server crash, user log\n *   in, etc), or just a few specific entries (realtime collaboration).\n *\n * - The desired duration it'll take for both parties to reach consistency\n *   (equal collections). This varies widely if we're a client-to-server\n *   connection or server-to-server connection.\n *\n * - The frequency in which we run the sync loop. This is dynamic in two\n *   dimensions: First is a variable desired frequency. The desired frequency\n *   changes as a function of activity. Second is the actual time it took to\n *   send the message. We measure the cycle time and take it into account in\n *   the next cycle.\n *\n * The result of all of these inputs ends as the desired accuracy for the bloom\n * filter that a peer constructs in each cycle. The more entries we need to move\n * faster, we need a higher accuracy filter. On the other hand, less entries\n * spread over more time allow us to aggressively reduce the filter's accuracy\n * and our resource consumption (network and disk).\n *\n * Finally, the protocol is aware that entries have a timestamp to them. Thus,\n * both peers may agree on a specific time frame to sync. At the time of this\n * writing the implementation allows for a TTL specification thus keeping the\n * sync size in check. In the future we may also customize the \"now\" date,\n * effectively providing a rolling time frame sync window.\n */\nexport class SyncMessage<T extends SyncValueType>\n  implements Encodable, Decodable\n{\n  private _buildVersion!: VersionNumber;\n  private _filter!: BloomFilter;\n  private _size!: number;\n  private _values!: T[];\n  private _accessDenied?: string[];\n\n  constructor(config: ConstructorDecoderConfig | SyncMessageConfig<T>) {\n    if (isDecoderConfig(config)) {\n      this.deserialize(config.decoder);\n    } else {\n      this._filter = config.filter;\n      this._size = config.size;\n      this._values = config.values || [];\n      if (config.accessDenied) {\n        this._accessDenied = Array.from(config.accessDenied);\n      }\n      this._buildVersion = config.buildVersion || VersionNumber.Current;\n    }\n  }\n\n  get buildVersion(): number {\n    return this._buildVersion;\n  }\n\n  get filter(): BloomFilter {\n    return this._filter;\n  }\n\n  get size(): number {\n    return this._size;\n  }\n\n  get values(): T[] {\n    return this._values;\n  }\n\n  protected set values(v: T[]) {\n    this._values = v;\n  }\n\n  get accessDenied(): string[] {\n    return this._accessDenied || [];\n  }\n\n  get valueFlag(): SyncValueFlag {\n    const values = this.values;\n    if (values.length > 0 && values[0] instanceof Commit) {\n      return SyncValueFlag.Commit;\n    }\n    return SyncValueFlag.Object;\n  }\n\n  serialize(\n    encoder: Encoder<string, CoreValue, CoreValue, unknown>,\n    _options?: unknown\n  ): void {\n    encoder.set('ver', this.buildVersion);\n    encoder.set('f', this.filter);\n    encoder.set('s', this.size);\n    switch (this.valueFlag) {\n      case SyncValueFlag.Commit:\n        encoder.set(\n          'c',\n          (this.values as Commit[]).map((c) => JSONCyclicalEncoder.serialize(c))\n        );\n        break;\n\n      case SyncValueFlag.Object:\n        encoder.set('v', this.values);\n        break;\n    }\n    if (this.accessDenied) {\n      encoder.set('ad', this.accessDenied);\n    }\n  }\n\n  deserialize(\n    decoder: Decoder<string, DecodedValue>,\n    _options?: unknown\n  ): void {\n    this._buildVersion = decoder.get<VersionNumber>('ver')!;\n    this._filter.deserialize(decoder.getDecoder('f'));\n    this._size = decoder.get<number>('s')!;\n    this._accessDenied = decoder.get('ad', []);\n    if (decoder.has('c')) {\n      this._values = decoder\n        .get<ReadonlyDecodedArray>('c', [])!\n        .map((obj: DecodedValue) => {\n          const decoder = new JSONCyclicalDecoder(obj as ReadonlyJSONObject);\n          return new Commit({ decoder });\n        }) as T[];\n    } else {\n      this._values = decoder.get('v')! as T[];\n    }\n  }\n\n  static build<T extends SyncValueType>(\n    peerFilter: BloomFilter | undefined,\n    values: Iterable<[id: string, value: T]>,\n    localSize: number,\n    peerSize: number,\n    expectedSyncCycles: number,\n    includeMissing = true\n  ): SyncMessage<T> {\n    const numberOfEntries = Math.max(1, localSize, peerSize);\n    // The expected number of sync cycles is log base (1/fpr) over number of\n    // entries. Thus we can work out the False-Positive-Rate based on the\n    // desired sync cycles:\n    //\n    // Log[fpr](numberOfEntries) = expectedSyncCycles      =>\n    // fpr = expectedSyncCycles'th root of numberOfEntries =>\n    // fpr = numberOfEntries ^ (1 / expectedSyncCycles)\n    //\n    // Finally, a bloom filter with FPR greater than 0.5 isn't very useful\n    // (more than 50% false positives), so we cap the computed value at 0.5.\n    const fpr = Math.min(\n      0.5,\n      Math.pow(numberOfEntries, 1 / expectedSyncCycles)\n    );\n    const localFilter = new BloomFilter({\n      size: numberOfEntries,\n      fpr,\n    });\n    const missingPeerValues: T[] = [];\n    if (peerFilter && includeMissing) {\n      for (const [id, v] of values) {\n        localFilter.add(id);\n        if (!peerFilter.has(id)) {\n          missingPeerValues.push(v);\n        }\n      }\n    }\n    return new this({\n      filter: localFilter,\n      size: localSize,\n      values: missingPeerValues,\n    });\n  }\n}\n\nexport function generateSessionId(userId: string): string {\n  return `${userId}/${uniqueId()}`;\n}\n", "import EventEmitter from 'https://esm.sh/eventemitter3@4.0.7';\nimport { EaseInOutSineTimer } from '../base/timer.ts';\nimport { BloomFilter } from '../base/bloom.ts';\nimport { SyncMessage, SyncValueType } from './message.ts';\nimport { retry } from '../base/time.ts';\nimport { log } from '../logging/log.ts';\nimport {\n  JSONCyclicalDecoder,\n  JSONCyclicalEncoder,\n} from '../base/core-types/encoding/json.ts';\nimport { MovingAverage } from '../base/math.ts';\nimport { VersionNumber } from '../defs.ts';\n\nexport interface SyncConfig {\n  minSyncFreqMs: number;\n  maxSyncFreqMs: number;\n  syncDurationMs: number;\n}\n\nexport const kSyncConfigClient: SyncConfig = {\n  minSyncFreqMs: 300,\n  maxSyncFreqMs: 3000,\n  syncDurationMs: 2000,\n};\n\nexport const kSyncConfigServer: SyncConfig = {\n  minSyncFreqMs: 100,\n  maxSyncFreqMs: 60000,\n  syncDurationMs: 300,\n};\n\nexport function syncConfigGetCycles(\n  config: SyncConfig,\n  actualSyncFreqMs = 0\n): number {\n  return Math.floor(\n    config.syncDurationMs / Math.max(actualSyncFreqMs, config.minSyncFreqMs)\n  );\n}\n\nexport const EVENT_ONLINE_STATUS_CHANGED = 'online_changed';\nexport const EVENT_PROTOCOL_VERSION_CHANGED = 'protocol_version_changed';\n\nexport interface BaseClientStorage {\n  close(): void;\n}\n\n/**\n * A base class for sync channel clients. This class takes care of everything\n * but interacting with the values themselves. It takes care of adaptive timing,\n * network errors, and other book keeping.\n *\n * Storage and encoding of values are left for concrete subclasses.\n */\nexport abstract class BaseClient<\n  ValueType extends SyncValueType\n> extends EventEmitter {\n  private readonly _timer: EaseInOutSineTimer;\n  private readonly _serverUrl: string;\n  private readonly _syncConfig: SyncConfig;\n  private readonly _syncFreqAvg: MovingAverage;\n  private _previousServerFilter: BloomFilter | undefined;\n  private _previousServerSize: number;\n  private _connectionOnline = false;\n  private _serverVersionNumber: VersionNumber = VersionNumber.Unknown;\n  private _ready: boolean;\n  private _scheduled: boolean;\n  private _closed = false;\n\n  constructor(serverUrl: string, syncConfig: SyncConfig) {\n    super();\n    this._serverUrl = serverUrl;\n    this._syncConfig = syncConfig;\n    this._timer = new EaseInOutSineTimer(\n      syncConfig.minSyncFreqMs,\n      syncConfig.maxSyncFreqMs,\n      syncConfig.maxSyncFreqMs * 3,\n      async () => {\n        try {\n          await this.sendSyncMessage();\n        } catch (e) {\n          log({\n            severity: 'INFO',\n            error: 'UnknownSyncError',\n            message: e.message,\n            trace: e.stack,\n          });\n        }\n      },\n      true,\n      'Sync timer'\n    );\n    this._syncFreqAvg = new MovingAverage(\n      syncConfigGetCycles(this.syncConfig) * 2\n    );\n    this._previousServerSize = 0;\n    this._ready = false;\n    this._scheduled = false;\n  }\n\n  get serverUrl(): string {\n    return this.serverUrl;\n  }\n\n  get isOnline(): boolean {\n    return this._connectionOnline;\n  }\n\n  get previousServerFilter(): BloomFilter | undefined {\n    return this._previousServerFilter;\n  }\n\n  get previousServerSize(): number {\n    return this._previousServerSize;\n  }\n\n  get syncConfig(): SyncConfig {\n    return this._syncConfig;\n  }\n\n  get syncCycles(): number {\n    return syncConfigGetCycles(this.syncConfig, this._syncFreqAvg.currentValue);\n  }\n\n  get serverVersion(): VersionNumber {\n    return this._serverVersionNumber;\n  }\n\n  private set serverVersion(v: VersionNumber) {\n    if (this._serverVersionNumber !== v) {\n      this._serverVersionNumber = v;\n      this.emit(EVENT_PROTOCOL_VERSION_CHANGED);\n    }\n  }\n\n  get ready(): boolean {\n    return this._ready && !this.closed;\n  }\n\n  protected set ready(f: boolean) {\n    if (f !== this._ready) {\n      this._ready = f;\n      if (this._scheduled) {\n        if (f) {\n          this._timer.schedule();\n        } else {\n          this.stopSyncing();\n        }\n      }\n    }\n  }\n\n  get closed(): boolean {\n    return this._closed;\n  }\n\n  protected abstract buildSyncMessage(): SyncMessage<ValueType>;\n  protected abstract persistPeerValues(values: ValueType[]): Promise<number>;\n  abstract localIds(): Iterable<string>;\n\n  private _setIsOnline(value: boolean): void {\n    if (value !== this._connectionOnline) {\n      this._connectionOnline = value;\n      this.emit(EVENT_ONLINE_STATUS_CHANGED);\n    }\n  }\n\n  startSyncing(): typeof this {\n    if (!this._scheduled) {\n      this._scheduled = true;\n      if (this.ready) {\n        this._timer.schedule();\n      }\n    }\n    return this;\n  }\n\n  stopSyncing(): typeof this {\n    this._timer.unschedule();\n    this._timer.reset();\n    this._scheduled = false;\n    return this;\n  }\n\n  private async sendSyncMessage(): Promise<void> {\n    if (this.closed) {\n      return;\n    }\n    const syncConfig = this._syncConfig;\n    const reqMsg = this.buildSyncMessage();\n    const msg = JSONCyclicalEncoder.serialize(reqMsg);\n    let respText: string | undefined;\n    try {\n      const start = performance.now();\n      respText = await retry(async () => {\n        const resp = await fetch(this._serverUrl, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify(msg),\n        });\n        return await resp.text();\n      }, syncConfig.minSyncFreqMs);\n\n      if (this.closed) {\n        return;\n      }\n\n      const syncDurationMs = performance.now() - start;\n      this._syncFreqAvg.addValue(syncDurationMs);\n      log({\n        severity: 'INFO',\n        name: 'PeerResponseTime',\n        value: syncDurationMs,\n        unit: 'Milliseconds',\n        url: this._serverUrl,\n      });\n    } catch (e) {\n      log({\n        severity: 'INFO',\n        error: 'FetchError',\n        message: e.message,\n        trace: e.stack,\n        url: this._serverUrl,\n      });\n    }\n\n    if (!respText) {\n      this._setIsOnline(false);\n      return;\n    }\n    let syncResp: typeof reqMsg;\n    try {\n      const json = JSON.parse(respText);\n      syncResp = new SyncMessage({ decoder: new JSONCyclicalDecoder(json) });\n    } catch (e) {\n      log({\n        severity: 'INFO',\n        error: 'SerializeError',\n        value: respText,\n        message: e.message,\n        trace: e.stack,\n      });\n      this._setIsOnline(false);\n      return;\n    }\n\n    this._previousServerFilter = syncResp.filter;\n    this._previousServerSize = syncResp.size;\n    let persistedCount = 0;\n    if (\n      // We only write to newer versions and ignore new values\n      syncResp.buildVersion <= VersionNumber.Current &&\n      syncResp.values.length\n    ) {\n      const start = performance.now();\n      // persistedCount = repo.persistCommits(syncResp.commits).length;\n      persistedCount = await this.persistPeerValues(syncResp.values);\n      log({\n        severity: 'INFO',\n        name: 'CommitsPersistTime',\n        value: performance.now() - start,\n        unit: 'Milliseconds',\n      });\n      log({\n        severity: 'INFO',\n        name: 'CommitsPersistCount',\n        value: persistedCount,\n        unit: 'Count',\n      });\n    }\n    if (this.closed) {\n      return;\n    }\n    if (persistedCount > 0 || this.needsReplication()) {\n      this.touch();\n    }\n    this._setIsOnline(true);\n  }\n\n  /**\n   * Returns a promise that completes when both peers have reached consensus.\n   * This method is probabilistic and fakes the appearance of a steady state\n   * between this client and the server. It's intended to be used in back-office\n   * and diagnostics tools, and not in app-to-server or server-to-server\n   * communication (which rely on indefinite polling loop).\n   */\n  async sync(): Promise<void> {\n    const syncConfig = this._syncConfig;\n    const cycleCount = syncConfigGetCycles(syncConfig) + 1;\n    // We need to do a minimum number of successful sync cycles in order to make\n    // sure everything is sync'ed. Also need to make sure we don't have any\n    // local commits that our peer doesn't have (local changes or peer recovery)\n    let i = 0;\n    do {\n      await this.sendSyncMessage();\n      ++i;\n    } while (!this.closed && (i < cycleCount || this.needsReplication()));\n  }\n\n  needsReplication(): boolean {\n    const serverFilter = this._previousServerFilter;\n    if (!serverFilter) {\n      return true;\n    }\n    for (const id of this.localIds()) {\n      if (!serverFilter.has(id)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  touch(): void {\n    // this._timer.unschedule();\n    // this.sendSyncMessage();\n    this._timer.reset();\n    this._timer.schedule();\n  }\n\n  close() {\n    this.stopSyncing();\n    this._closed = true;\n    this._setIsOnline(false);\n  }\n}\n", "import { Repository, RepoStorage } from '../repo/repo.ts';\nimport { SyncMessage } from './message.ts';\nimport { BaseClient, SyncConfig } from './base-client.ts';\nimport { Commit } from '../repo/commit.ts';\nimport { mapIterable } from '../base/common.ts';\n\nexport class RepoClient<T extends RepoStorage<T>> extends BaseClient<Commit> {\n  private readonly _repo: Repository<T>;\n\n  constructor(repo: Repository<T>, serverUrl: string, syncConfig: SyncConfig) {\n    super(serverUrl, syncConfig);\n    this._repo = repo;\n    this.ready = true;\n  }\n\n  get repo(): Repository<T> {\n    return this._repo;\n  }\n\n  protected buildSyncMessage(): SyncMessage<Commit> {\n    const repo = this.repo;\n    return SyncMessage.build(\n      this.previousServerFilter,\n      mapIterable(repo.commits(), (c) => [c.id, c]),\n      repo.numberOfCommits,\n      this.previousServerSize,\n      this.syncCycles\n    );\n  }\n\n  *localIds(): Generator<string> {\n    for (const c of this.repo.commits()) {\n      yield c.id;\n    }\n  }\n\n  protected persistPeerValues(values: Commit[]): Promise<number> {\n    return Promise.resolve(this.repo.persistCommits(values).length);\n  }\n}\n", "import BulkSearch from 'https://esm.sh/bulksearch@0.1.3';\nimport {\n  CoroutineScheduler,\n  SchedulerPriority,\n} from '../../../base/coroutine.ts';\nimport { MutationPack, mutationPackIter } from './mutations.ts';\nimport { Predicate } from './query.ts';\nimport { VertexManager } from './vertex-manager.ts';\nimport { Note } from './vertices/note.ts';\nimport { treeToPlaintext } from '../../richtext/tree.ts';\nimport { GraphManager } from './graph-manager.ts';\nimport { EVENT_VERTEX_CHANGED } from './vertex-source.ts';\nimport { log } from '../../../logging/log.ts';\n\nexport class NoteSearchEngine {\n  private readonly _graph: GraphManager;\n  private readonly _bulkSearchHandle: any;\n  private readonly _graphListener: (key: string, pack: MutationPack) => void;\n  private _loading: boolean;\n\n  constructor(graph: GraphManager) {\n    this._graph = graph;\n    this._bulkSearchHandle = new BulkSearch({\n      type: 'string',\n      encode: 'extra',\n      boolean: 'or',\n      size: 2500,\n      multi: true,\n      strict: true,\n      ordered: false,\n      paging: false,\n      async: false,\n      cache: true,\n      // filter: 'custom',\n      // stemmer: 'custom',\n    });\n\n    this._graphListener = (key: string, pack: MutationPack) => {\n      this._vertexDidChange(key, pack);\n    };\n    this._loading = true;\n\n    graph.on(EVENT_VERTEX_CHANGED, this._graphListener);\n  }\n\n  close(): void {\n    this._graph.off(EVENT_VERTEX_CHANGED, this._graphListener);\n  }\n\n  get loading(): boolean {\n    return this._loading;\n  }\n\n  search(text: string, filter?: Predicate<Note>): VertexManager<Note>[] {\n    const graph = this._graph;\n    const result: VertexManager<Note>[] = [];\n    for (const key of this._bulkSearchHandle.search(text)) {\n      const vert = graph.getVertex<Note>(key);\n      if (filter === undefined || filter(vert)) {\n        result.push(vert.manager as VertexManager<Note>);\n      }\n    }\n    return result;\n  }\n\n  private _vertexDidChange(key: string, pack: MutationPack): void {\n    const vert = this._graph.getVertex<Note>(key);\n    if (!(vert instanceof Note)) {\n      return;\n    }\n\n    // First, make sure that this update affects us\n    let skipChange = true;\n    for (const [field] of mutationPackIter(pack)) {\n      if (field === 'isDeleted' || field === 'body' || field === 'title') {\n        skipChange = false;\n        break;\n      }\n    }\n    if (skipChange) {\n      return;\n    }\n\n    this._bulkSearchHandle.add(vert.key, extractTextFromNote(vert));\n  }\n\n  async loadAllNotes(): Promise<void> {\n    const start = performance.now();\n    await CoroutineScheduler.sharedScheduler().map(\n      this._graph.vertexManagers(),\n      (mgr) => {\n        if (!mgr.isDeleted) {\n          this._vertexDidChange(mgr.key, mgr.getCurrentStateMutations(true));\n        }\n      },\n      SchedulerPriority.Background\n    );\n    this._loading = false;\n    log({\n      severity: 'INFO',\n      name: 'FullTextIndexingTime',\n      value: performance.now() - start,\n      unit: 'Milliseconds',\n      itemCount: this._bulkSearchHandle.info().length,\n    });\n    // this._bulkSearchHandle.optimize();\n  }\n}\n\nfunction extractTextFromNote(note: Note): string {\n  if (note.isDeleted) {\n    return '';\n  }\n  let result = treeToPlaintext(note.title.root);\n  if (result.length > 0) {\n    result += '\\n\\n';\n  }\n  result += treeToPlaintext(note.body.root);\n  return result.trim();\n}\n\nconst customLang = {\n  filter: [\n    '\u05D0\u05EA',\n    '\u05DC\u05D0',\n    '\u05E9\u05DC',\n    '\u05D0\u05E0\u05D9',\n    '\u05E2\u05DC',\n    '\u05D6\u05D4',\n    '\u05E2\u05DD',\n    '\u05DB\u05DC',\n    '\u05D4\u05D5\u05D0',\n    '\u05D0\u05DD',\n    '\u05D0\u05D5',\n    '\u05D2\u05DD',\n    '\u05D9\u05D5\u05EA\u05E8',\n    '\u05D9\u05E9',\n    '\u05DC\u05D9',\n    '\u05DE\u05D4',\n    '\u05D0\u05D1\u05DC',\n    '\u05E4\u05D5\u05E8\u05D5\u05DD',\n    '\u05D0\u05D6',\n    '\u05D8\u05D5\u05D1',\n    '\u05E8\u05E7',\n    '\u05DB\u05D9',\n    '\u05E9\u05DC\u05D9',\n    '\u05D4\u05D9\u05D4',\n    '\u05D1\u05E4\u05D5\u05E8\u05D5\u05DD',\n    '\u05D0\u05D9\u05DF',\n    '\u05E2\u05D5\u05D3',\n    '\u05D4\u05D9\u05D0',\n    '\u05D0\u05D7\u05D3',\n    '\u05D1',\n    '\u05DC',\n    '\u05E2\u05D3',\n    '\u05DC\u05DA',\n    '\u05DB\u05DE\u05D5',\n    '\u05DC\u05D4\u05D9\u05D5\u05EA',\n    '\u05D0\u05EA\u05D4',\n    '\u05DB\u05DE\u05D4',\n    '\u05D0\u05E0\u05D7\u05E0\u05D5',\n    '\u05D4\u05DD',\n    '\u05DB\u05D1\u05E8',\n    '\u05D0\u05E0\u05E9\u05D9\u05DD',\n    '\u05D0\u05E4\u05E9\u05E8',\n    '\u05EA\u05D5\u05D3\u05D4',\n    '\u05E9\u05DC\u05D0',\n    '\u05D0\u05D5\u05EA\u05D5',\n    '\u05D4',\n    '\u05DE\u05D0\u05D5\u05D3',\n    '\u05D4\u05E8\u05D1\u05D4',\n    '\u05D5\u05DC\u05D0',\n    '\u05DE\u05DE\u05E9',\n    '\u05DC\u05D5',\n    '\u05D0',\n    '\u05DE\u05D9',\n    '\u05D7\u05D9\u05D9\u05DD',\n    '\u05D1\u05D9\u05EA',\n    '\u05E9\u05D0\u05E0\u05D9',\n    '\u05D9\u05DB\u05D5\u05DC',\n    '\u05E9\u05D4\u05D5\u05D0',\n    '\u05DB\u05DA',\n    '\u05D4\u05D6\u05D4',\n    '\u05D0\u05D9\u05DA',\n    '\u05D4\u05D9\u05D5\u05DD',\n    '\u05E7\u05E6\u05EA',\n    '\u05E2\u05DB\u05E9\u05D9\u05D5',\n    '\u05E9\u05DD',\n    '\u05D1\u05DB\u05DC',\n    '\u05D9\u05D4\u05D9\u05D4',\n    '\u05EA\u05DE\u05D9\u05D3',\n    '\u05D9',\n    '\u05E9\u05DC\u05DA',\n    '\u05D4\u05DB\u05D9',\n    '\u05E9',\n    '\u05D1\u05D5',\n    '\u05DC\u05E2\u05E9\u05D5\u05EA',\n    '\u05E6\u05E8\u05D9\u05DA',\n    '\u05DB\u05DF',\n    '\u05E4\u05E2\u05DD',\n    '\u05DC\u05DB\u05DD',\n    '\u05D5\u05D0\u05E0\u05D9',\n    '\u05DE\u05E9\u05D4\u05D5',\n    '\u05D0\u05DC',\n    '\u05E9\u05DC\u05D5',\n    '\u05E9\u05D9\u05E9',\n    '\u05D5',\n    '\u05D5\u05D2\u05DD',\n    '\u05D0\u05EA\u05DB\u05DD',\n    '\u05D0\u05D7\u05E8\u05D9',\n    '\u05D1\u05E0\u05D5\u05E9\u05D0',\n    '\u05DB\u05D3\u05D9',\n    '\u05E4\u05E9\u05D5\u05D8',\n    '\u05DC\u05E4\u05E0\u05D9',\n    '\u05E9\u05D6\u05D4',\n    '\u05D0\u05D5\u05EA\u05D9',\n    '\u05D0\u05E0\u05D5',\n    '\u05DC\u05DE\u05D4',\n    '\u05D3\u05D1\u05E8',\n    '\u05DB',\n    '\u05DB\u05D0\u05DF',\n    '\u05D0\u05D5\u05DC\u05D9',\n    '\u05D8\u05D5\u05D1\u05D9\u05DD',\n    '\u05E8\u05D5\u05E6\u05D4',\n    '\u05E9\u05E0\u05D4',\n    '\u05D1\u05E2\u05DC\u05D9',\n    '\u05D4\u05D7\u05D9\u05D9\u05DD',\n    '\u05DC\u05DE\u05E2\u05DF',\n    '\u05D0\u05EA\u05DD',\n    '\u05DE',\n    '\u05D1\u05D9\u05DF',\n    '\u05D9\u05D5\u05DD',\n    '\u05D6\u05D0\u05EA',\n    '\u05D0\u05D9\u05D6\u05D4',\n    '\u05D1\u05D9\u05D5\u05EA\u05E8',\n    '\u05DC\u05D4',\n    '\u05D0\u05D7\u05EA',\n    '\u05D4\u05DB\u05DC',\n    '\u05D4\u05E4\u05D5\u05E8\u05D5\u05DE\u05D9\u05DD',\n    '\u05DC\u05DB\u05DC',\n    '\u05D0\u05DC\u05D0',\n    '\u05E4\u05D4',\n    '\u05D9\u05D5\u05D3\u05E2',\n    '\u05E9\u05DC\u05D5\u05DD',\n    '\u05D3\u05E7\u05D5\u05EA',\n    '\u05DC\u05E0\u05D5',\n    '\u05D4\u05E9\u05E0\u05D4',\n    '\u05D3\u05E8\u05DA',\n    '\u05D0\u05D3\u05DD',\n    '\u05E0\u05E8\u05D0\u05D4',\n    '\u05D6\u05D5',\n    '\u05D4\u05D9\u05D7\u05D9\u05D3\u05D4',\n    '\u05E8\u05D5\u05E6\u05D9\u05DD',\n    '\u05D1\u05DB\u05DC\u05DC',\n    '\u05D8\u05D5\u05D1\u05D4',\n    '\u05E9\u05DC\u05E0\u05D5',\n    '\u05D4\u05D0\u05DD',\n    '\u05D4\u05D9\u05D9\u05EA\u05D9',\n    '\u05D4\u05DC\u05D1',\n    '\u05D4\u05D9\u05D5',\n    '\u05D7',\n    '\u05E9\u05D3\u05E8\u05D5\u05EA',\n    '\u05D1\u05DC\u05D9',\n    '\u05DC\u05D4\u05DD',\n    '\u05E9\u05D0\u05EA\u05D4',\n    '\u05D0\u05D5\u05EA\u05D4',\n    '\u05DE\u05E7\u05D5\u05DD',\n    '\u05D5\u05D0\u05EA\u05DD',\n    '\u05D7\u05DC\u05E7',\n    '\u05D1\u05DF',\n    '\u05D1\u05D5\u05D0\u05D5',\n    '\u05D0\u05D7\u05E8',\n    '\u05D4\u05D0\u05D7\u05EA',\n    '\u05D0\u05D5\u05EA\u05DA',\n    '\u05DB\u05DE\u05D5\u05D1\u05DF',\n    '\u05D1\u05D2\u05DC\u05DC',\n    '\u05D1\u05D0\u05DE\u05EA',\n    '\u05DE\u05D9\u05E9\u05D4\u05D5',\n    '\u05D9\u05DC\u05D3\u05D9\u05DD',\n    '\u05D0\u05D5\u05EA\u05DD',\n    '\u05D4\u05E4\u05D5\u05E8\u05D5\u05DD',\n    '\u05D8\u05D9\u05E4\u05D5\u05D7',\n    '\u05D5\u05D6\u05D4',\n    '\u05E8',\n    '\u05E9\u05D4\u05DD',\n    '\u05D0\u05DA',\n    '\u05DE\u05D6\u05DE\u05D9\u05DF',\n    '\u05D9\u05E9\u05E8\u05D0\u05DC',\n    '\u05DB\u05D5\u05E1',\n    '\u05D6\u05DE\u05DF',\n    '\u05D5\u05E2\u05D5\u05D3',\n    '\u05D4\u05D9\u05DC\u05D3\u05D9\u05DD',\n    '\u05E2\u05D3\u05D9\u05D9\u05DF',\n    '\u05DB\u05D6\u05D4',\n    '\u05E2\u05D5\u05E9\u05D4',\n    '\u05E9\u05D5\u05DD',\n    '\u05DC\u05E7\u05D7\u05EA',\n    '\u05D4\u05E2\u05D5\u05DC\u05DD',\n    '\u05EA\u05E4\u05D5\u05D6',\n    '\u05DC\u05E8\u05D0\u05D5\u05EA',\n    '\u05DC\u05E4\u05D5\u05E8\u05D5\u05DD',\n    '\u05D5\u05DB\u05DC',\n    '\u05DC\u05E7\u05D1\u05DC',\n    '\u05E0\u05DB\u05D5\u05DF',\n    '\u05D9\u05D5\u05E6\u05D0',\n    '\u05DC\u05E2\u05D5\u05DC\u05DD',\n    '\u05D2\u05D3\u05D5\u05DC',\n    '\u05D0\u05E4\u05D9\u05DC\u05D5',\n    '\u05E0\u05D9\u05EA\u05DF',\n    '\u05E9\u05E0\u05D9',\n    '\u05D0\u05D5\u05DB\u05DC',\n    '\u05E7\u05E9\u05D4',\n    '\u05DE\u05E9\u05D7\u05E7',\n    '\u05D1\u05D9\u05D5\u05DD',\n    '\u05DB\u05DB\u05D4',\n    '\u05D0\u05DE\u05D0',\n    '\u05D1\u05EA',\n    '\u05D4\u05E9\u05D1\u05D5\u05E2',\n    '\u05E0\u05D5\u05E1\u05E4\u05D9\u05DD',\n    '\u05DC\u05D2\u05D1\u05D9',\n    '\u05D1\u05D1\u05D9\u05EA',\n    '\u05D0\u05D7\u05E8\u05EA',\n    '\u05DC\u05E4\u05D9\t\u05DC\u05DC\u05D0',\n    '\u05E9\u05E0\u05D9\u05DD',\n    '\u05D4\u05D6\u05DE\u05DF',\n    '\u05E9\u05DE\u05DF',\n    '\u05DE\u05E2\u05D8',\n    '\u05DC\u05E4\u05D7\u05D5\u05EA',\n    '\u05D0\u05E3',\n    '\u05E9\u05D5\u05D1',\n    '\u05E9\u05DC\u05D4\u05DD',\n    '\u05D1\u05DE\u05E7\u05D5\u05DD',\n    '\u05DB\u05D5\u05DC\u05DD',\n    '\u05E0\u05D5\u05E2\u05D9\u05EA',\n    '\u05D4\u05D1\u05D0',\n    '\u05DE\u05E2\u05DC',\n    '\u05DC\u05D1',\n    '\u05D4\u05DE\u05D5\u05DF',\n    '\u05DC\u05D3\u05D1\u05E8',\n    '\u05E2',\n    '\u05D0\u05D5\u05D4\u05D1',\n    '\u05DE\u05D5\u05E1\u05D9\u05E4\u05D9\u05DD',\n    '\u05D7\u05E6\u05D9',\n    '\u05D1\u05E2\u05D9\u05E7\u05E8',\n    '\u05DB\u05E4\u05D5\u05EA',\n    '\u05DC\u05E4\u05E2\u05DE\u05D9\u05DD',\n    '\u05E9\u05D4\u05D9\u05D0',\n    '\u05D4\u05E0\u05D4\u05DC\u05EA',\n    '\u05D5\u05E2\u05DC',\n    '\u05E7',\n    '\u05D0\u05D5\u05D4\u05D1\u05D9\u05DD',\n    '\u05EA',\n    '\u05D9\u05D5\u05D3\u05E2\u05EA',\n    '\u05D3',\n    '\u05D2\u05E8\u05D5\u05E2',\n    '\u05E9\u05D0\u05E0\u05D7\u05E0\u05D5',\n    '\u05DE\u05D9\u05DD',\n    '\u05DC\u05D9\u05DC\u05D3\u05D9\u05DD',\n    '\u05D1\u05D0\u05E8\u05E5',\n    '\u05DE\u05D5\u05D3\u05D9\u05E2',\n    '\u05D0\u05E9\u05DE\u05D7',\n    '\u05E9\u05DC\u05DB\u05DD',\n    '\u05E4\u05D7\u05D5\u05EA',\n    '\u05DC\u05DB\u05D5\u05DC\u05DD',\n    '\u05D3\u05D9',\n    '\u05D0\u05D4\u05D1\u05D4',\n    '\u05D9\u05DB\u05D5\u05DC\u05D4',\n    '\u05D3\u05D1\u05E8\u05D9\u05DD',\n    '\u05D4\u05E7\u05D4\u05D9\u05DC\u05D4',\n    '\u05DC\u05E2\u05D6\u05D5\u05E8',\n    '\u05E4\u05E8\u05D8\u05D9\u05DD',\n    '\u05D1\u05D3\u05D9\u05D5\u05E7',\n    '\u05DE\u05DC\u05D7',\n    '\u05E7\u05DC',\n    '\u05D4\u05E8\u05D0\u05E9\u05D9',\n    '\u05E9\u05DC\u05D4',\n    '\u05DC\u05D4\u05D5\u05E1\u05D9\u05E3',\n    '\u05D4\u05E9\u05E0\u05D9',\n    '\u05DC\u05D3\u05E2\u05EA\u05D9',\n    '\u05D1\u05E8',\n    '\u05DC\u05DE\u05E8\u05D5\u05EA',\n    '\u05E9\u05D2\u05DD',\n    '\u05DE\u05D5\u05D6\u05DE\u05E0\u05D9\u05DD',\n    '\u05DC\u05D0\u05D7\u05E8',\n    '\u05D1\u05DE\u05D4',\n    '\u05D7\u05D5\u05E9\u05D1',\n    '\u05DE\u05D0\u05D3',\n    '\u05D9\u05E4\u05D4',\n    '\u05DC\u05D4\u05D2\u05E9\u05D9\u05DD',\n    '\u05E7\u05D8\u05DF',\n    '\u05DE\u05D7\u05E4\u05E9\u05D9\u05DD',\n    '\u05E9\u05DE\u05D7',\n    '\u05DE\u05D3\u05D1\u05E8\u05D9\u05DD',\n    '\u05D5\u05D0\u05DD',\n    '\u05D1\u05DE\u05D9\u05D5\u05D7\u05D3',\n    '\u05E2\u05D1\u05D5\u05D3\u05D4',\n    '\u05DE\u05D3\u05D9',\n    '\u05D5\u05D0\u05D6',\n    '\u05D7\u05E9\u05D5\u05D1',\n    '\u05E9\u05D0\u05DD',\n    '\u05D0\u05D5\u05D4\u05D1\u05EA',\n    '\u05E4\u05E2\u05DE\u05D9\u05DD',\n    '\u05DE\u05E0\u05D4\u05DC\u05EA',\n    '\u05D0\u05D5\u05DE\u05E8',\n    '\u05DE\u05D5\u05DC',\n    '\u05E7\u05E9\u05E8',\n    '\u05DE\u05E0\u05D4\u05DC',\n    '\u05E9\u05D9\u05D4\u05D9\u05D4',\n    '\u05E9\u05D0\u05D9\u05DF',\n    '\u05E9\u05D0\u05E0\u05D5',\n    '\u05D4\u05D0\u05D4\u05D1\u05D4',\n    '\u05E1',\n    '\u05D4\u05E6\u05D8\u05E8\u05E4\u05D5',\n    '\u05DB\u05E4\u05D9\u05EA',\n    '\u05D1\u05E9\u05D1\u05D9\u05DC',\n    '\u05D4\u05D7\u05D2\u05D9\u05DD',\n    '\u05D0\u05D5\u05E4\u05DF',\n    '\u05DC\u05EA\u05EA',\n    '\u05DB\u05E3',\n    '\u05D1\u05EA\u05D5\u05DA',\n    '\u05E1\u05D5\u05DB\u05E8',\n    '\u05D2\u05D9\u05DC',\n    '\u05D1\u05D4\u05E6\u05DC\u05D7\u05D4',\n    '\u05D5\u05D4\u05D5\u05D0',\n    '\u05DE\u05E7\u05D5\u05D5\u05D4',\n    '\u05E1\u05EA\u05DD',\n    '\u05D5\u05D9\u05E9',\n    '\u05E0\u05D2\u05D3',\n    '\u05DB\u05DE\u05E2\u05D8',\n    '\u05E9\u05D0\u05EA',\n    '\u05E2\u05D5\u05DC\u05D4',\n    '\u05D0\u05D9',\n    '\u05DE\u05E1\u05E4\u05E8',\n    '\u05E8\u05D0\u05E9\u05D5\u05DF',\n    '\u05DC\u05D3\u05E8\u05DA',\n    '\u05E0\u05D4\u05D9\u05D4',\n    '\u05DC\u05E2\u05E6\u05D1',\n    '\u05E2\u05D5\u05E9\u05D9\u05DD',\n    '\u05D5\u05DC\u05E0\u05D4\u05DC',\n    '\u05D4\u05D9\u05EA\u05D4',\n    '\u05E2\u05DC\u05D9\u05D5',\n    '\u05DE\u05D6\u05D4',\n    '\u05D4\u05D9\u05D9\u05EA\u05D4',\n    '\u05D1\u05D0',\n    '\u05D1\u05E4\u05E8\u05E1',\n    '\u05D7\u05DC\u05D5\u05EA',\n    '\u05E8\u05D0\u05E9',\n    '\u05DE\u05D6\u05DE\u05D9\u05E0\u05D9\u05DD',\n    '\u05D8\u05D9\u05E4\u05D9\u05DD',\n    '\u05DE\u05DB\u05D1\u05D9',\n    '\u05E8\u05D1\u05D4',\n    '\u05D4\u05D5\u05E8\u05D9\u05DD',\n    '\u2021',\n    '\u05DE\u05E7\u05E8\u05D4',\n    '\u05E7\u05E8\u05DF',\n    '\u05D4\u05DE\u05D5\u05E6\u05DC\u05D7',\n    '\u05DC\u05D4\u05D2\u05D9\u05E2',\n    '\u05D2\u05D3\u05D5\u05DC\u05D4',\n    '\u05DB\u05E0\u05E8\u05D0\u05D4',\n    '\u05D4\u05D7\u05DE\u05E9\u05D9\u05E8',\n    '\u05D4\u05E8\u05D0\u05E9\u05D5\u05DF',\n    '\u05E4\u05DC\u05E4\u05DC',\n    '\u05D4\u05DE\u05E9\u05D7\u05E7',\n    '\u05D5\u05DB\u05D0\u05DF',\n    '\u05DC\u05D3\u05E2\u05EA',\n    '\u05D5\u05D0\u05EA',\n    '\u05D2\u05E8\u05D5\u05E2\u05D9\u05DD',\n    '\u05E1\u05E4\u05E8',\n    '\u05D0\u05D2\u05D1',\n    '\u05D0\u05D7\u05E8\u05D9\u05DD',\n    '\u05DC\u05D4\u05D2\u05D9\u05D3',\n    '\u05D1\u05EA\u05E4\u05D5\u05D6',\n    '\u05D5\u05D4\u05E2\u05D5\u05DC\u05DD',\n    '\u05D0\u05D5\u05E4\u05E0\u05D4',\n    '\u05D3\u05D5\u05D5\u05E7\u05D0',\n    '\u05DE\u05E1\u05E4\u05D9\u05E7',\n    '\u05E9\u05E2\u05D5\u05EA',\n    '\u05EA\u05DE\u05D5\u05E0\u05D5\u05EA',\n    '\u05DB\u05E9\u05D0\u05E0\u05D7\u05E0\u05D5',\n    '\u05E9\u05D5\u05E7\u05D5\u05DC\u05D3',\n    '\u05D5\u05DC\u05DB\u05DF',\n    '\u05D2',\n    '\u05DC\u05E7\u05E8\u05D5\u05D0',\n    '\u05DC\u05E0\u05D9\u05D4\u05D5\u05DC',\n    '\u05E9\u05D1\u05D5\u05E2',\n    '\u05D5\u05D9\u05D5\u05E4\u05D9',\n    '\u05D7\u05DC\u05D5\u05DD',\n    '\u05D1\u05D4',\n    '\u05E9\u05D4\u05D9\u05D4',\n    '\u05E9\u05D0\u05DC\u05D4',\n    '\u05DE\u05E7\u05D5\u05DE\u05D4',\n    '\u05D4\u05D6\u05D5',\n    '\u05D1\u05E4\u05D5\u05E8\u05D5\u05DE\u05D9\u05DD',\n    '\u05D4\u05D7\u05D3\u05E9',\n    '\u05DE\u05EA\u05D0\u05DE\u05E6\u05D9\u05DD',\n    '\u05E9\u05D7\u05E7\u05DF',\n    '\u05E9\u05DE\u05D6\u05D9\u05E0\u05D9\u05DD',\n    '\u05E0\u05E9\u05DE\u05EA',\n    '\u05D1\u05E2\u05E8\u05DA',\n    '\u05DE\u05DB\u05DC',\n    '\u05D5\u05DE\u05D4',\n    '\u05E8\u05D2\u05DC',\n    '\u05DB\u05E1\u05E3',\n    '\u05E8\u05D5\u05D0\u05D4',\n    '\u05E7\u05D8\u05E0\u05D4',\n    '\u05D1\u05E6\u05DC',\n    '\u05D1\u05E2\u05D5\u05DC\u05DD',\n    '\u05D0\u05D9\u05E0\u05D8\u05E8\u05E0\u05D8',\n    '\u05D7\u05D5\u05E5',\n    '\u05D1\u05E8\u05D5\u05E8',\n    '\u05D4\u05D5\u05DC\u05DA',\n    '\u05D7\u05D5\u05E9\u05D1\u05EA',\n    '\u05DC\u05D6\u05D4',\n    '\u05DB\u05DC\u05D5\u05DD',\n    '\u05D4\u05DF',\n    '\u05DB\u05D0\u05DC\u05D4',\n    '\u05D1\u05D8\u05D5\u05D7',\n    '\u05D4\u05D3\u05D1\u05E8',\n    '\u05EA\u05D4\u05D9\u05D4',\n    '\u05DE\u05D2\u05D9\u05E2',\n    '\u05E1\u05D5\u05E3\t\u05D4\u05D0\u05DE\u05EA',\n    '\u05DE\u05DE\u05E0\u05D5',\n    '\u05DE\u05D9\u05DB\u05DC',\n    '\u05D4\u05D7\u05D3\u05E9\u05D4',\n    '\u05DC\u05EA\u05E8\u05D5\u05DD',\n    '\u05D4\u05D0\u05E0\u05E9\u05D9\u05DD',\n    '\u05D5\u05E2\u05D3',\n    '\u05D1\u05D3\u05E8\u05DA',\n    '\u05D0\u05E6\u05DC\u05D9',\n    '\u05D4\u05D4\u05D5\u05E8\u05D9\u05DD',\n    '\u05D1\u05E0\u05D9',\n    '\u05DE\u05EA\u05D5\u05DA',\n    '\u05DB\u05D0\u05E9\u05E8',\n    '\u05DC\u05D1\u05D3',\n    '\u05E8\u05D0\u05D9\u05EA\u05D9',\n    '\u05DE\u05E6\u05D1',\n    '\u05DE\u05DC\u05D0',\n    '\u05DC\u05D1\u05D7\u05D5\u05E8',\n    '\u05E0\u05E9\u05DE\u05D7',\n    '\u05D4\u05D7\u05D2',\n    '\u05E8\u05E2',\n    '\u05E2\u05D5\u05E3',\n    '\u05DE\u05DF',\n    '\u05DC\u05D4\u05D1\u05D9\u05D0',\n    '\u05DE\u05E6\u05D0\u05EA\u05D9',\n    '\u05DB\u05EA\u05D5\u05D1\u05D5\u05EA',\n    '\u05DE\u05E2\u05E0\u05D9\u05D9\u05DF',\n    '\u05E6\u05E8\u05D9\u05DB\u05D4',\n    '\u05DC\u05D4\u05DB\u05E0\u05E1',\n    '\u05DC\u05D7\u05DC\u05D5\u05D8\u05D9\u05DF',\n    '\u05E9\u05E2\u05D4',\n    '\u05DE\u05EA\u05DB\u05D5\u05DF',\n    '\u05E7\u05D5\u05D3\u05DD',\n    '\u05EA\u05E9\u05D5\u05D1\u05D5\u05EA',\n    '\u05DE\u05D3\u05D5\u05D1\u05E8',\n    '\u05E0\u05D9\u05D4\u05D5\u05DC',\n    '\u05DE\u05D6\u05DC',\n    '\u05DB\u05D3\u05D0\u05D9',\n    '\u05D9\u05D4\u05D9\u05D5',\n    '\u05D4\u05D4\u05D5\u05D3\u05E2\u05D5\u05EA',\n    '\u05D1\u05D5\u05E7\u05E8',\n    '\u05E0\u05D9\u05DC\u05D5\u05D5\u05EA',\n    '\u05D0\u05D9\u05E4\u05D4',\n    '\u05D1\u05E2\u05D9\u05D4',\n    '\u05E7\u05DE\u05D7',\n    '\u05DC\u05DC\u05DB\u05EA',\n    '\u05E4\u05D5\u05E8\u05D5\u05DE\u05D9\u05DD',\n    '\u05D0\u05DE\u05E8',\n    '\u05E0\u05D5\u05E9\u05D0',\n    '\u05D4\u05D4\u05DB\u05E0\u05D4',\n    '\u05D1\u05D1\u05E7\u05E9\u05D4',\n    '\u05E9\u05DB\u05DC',\n    '\u05D4\u05D6\u05D0\u05EA',\n    '\u05DC\u05DE\u05E9\u05D7\u05E7',\n    '\u05E4\u05E0\u05D9\u05E0\u05D4',\n    '\u05EA\u05D7\u05E8\u05D5\u05EA',\n    '\u05D7\u05D1\u05E8',\n    '\u05DC\u05E7\u05E0\u05D5\u05EA',\n    '\u05DE\u05D4\u05DD',\n    '\u05E8\u05D2\u05E2',\n    '\u05D2\u05E8\u05DD',\n    '\u05D0\u05DC\u05D5',\n    '\u05E2\u05E6\u05DE\u05D5',\n    '\u05DE\u05E8\u05D0\u05E9',\n    '\u05D4\u05DB\u05DC\u05D1',\n    '\u05DB\u05D5\u05DC\u05E0\u05D5',\n    '\u05E2\u05D3\u05D9\u05E3',\n    '\u05D0\u05D9\u05EA\u05D5',\n    '\u05DC\u05DE\u05E9\u05DC',\n    '\u05DC\u05D1\u05E9\u05DC',\n    '\u05DC\u05DE\u05D9',\n    '\u05E8\u05E2\u05D9\u05D5\u05E0\u05D5\u05EA',\n    '\u05D4\u05D1\u05DC\u05D5\u05D2',\n    '\u05E8\u05D5\u05D1',\n    '\u05D0\u05D1\u05D9\u05D1',\n    '\u05DB\u05E8\u05D2\u05E2',\n    '\u05D1\u05E1\u05D5\u05E3',\n    '\u05D0\u05DC\u05D4',\n    '\u05DC\u05D7\u05D2',\n    '\u05E2\u05E8\u05D5\u05E5',\n    '\u05E9\u05D5\u05D5\u05D4',\n    '\u05D1\u05D0\u05D5\u05E4\u05DF',\n    '\u05DE\u05D0\u05DE\u05D9\u05DF',\n    '\u05DC\u05D1\u05DF',\n    '\u05D1\u05D6\u05D4',\n    '\u05D4\u05DB\u05D1\u05D5\u05D3',\n    '\u05DC\u05E8\u05D0\u05E9',\n    '\u05DD',\n    '\u05D9\u05DE\u05D9',\n    '\u05E9\u05D7\u05D5\u05E8',\n    '\u05D1\u05E6\u05D5\u05E8\u05D4',\n    '\u05D1\u05E2\u05DE\u05D5\u05D3',\n    '\u05D5\u05E2\u05DD',\n    '\u05D5\u05D7\u05E6\u05D9',\n    '\u05D4\u05D0\u05DC\u05D4',\n    '\u05EA\u05DE\u05D5\u05E0\u05D4',\n    '\u05D1\u05E9\u05DC\u05D1',\n    '\u05DE\u05E9\u05D7\u05E7\u05D9\u05DD',\n    '\u05E0\u05D5',\n    'a',\n    'about',\n    'above',\n    'after',\n    'again',\n    'against',\n    'all',\n    'also',\n    'am',\n    'an',\n    'and',\n    'any',\n    'are',\n    \"aren't\",\n    'as',\n    'at',\n    //\"back\",\n    'be',\n    'because',\n    'been',\n    'before',\n    'being',\n    'below',\n    //\"between\",\n    'both',\n    'but',\n    'by',\n    'can',\n    'cannot',\n    \"can't\",\n    'come',\n    'could',\n    \"couldn't\",\n    //\"day\",\n    'did',\n    \"didn't\",\n    'do',\n    'does',\n    \"doesn't\",\n    'doing',\n    'dont',\n    'down',\n    'during',\n    'each',\n    'even',\n    'few',\n    'first',\n    'for',\n    'from',\n    'further',\n    'get',\n    //\"give\",\n    'go',\n    //\"good\",\n    'had',\n    \"hadn't\",\n    'has',\n    \"hasn't\",\n    'have',\n    \"haven't\",\n    'having',\n    'he',\n    'hed',\n    //\"hell\",\n    'her',\n    'here',\n    \"here's\",\n    'hers',\n    'herself',\n    'hes',\n    'him',\n    'himself',\n    'his',\n    'how',\n    \"how's\",\n    'i',\n    'id',\n    'if',\n    'ill',\n    'im',\n    'in',\n    'into',\n    'is',\n    \"isn't\",\n    'it',\n    \"it's\",\n    'itself',\n    \"i've\",\n    'just',\n    'know',\n    \"let's\",\n    'like',\n    //\"look\",\n    'make',\n    'me',\n    'more',\n    'most',\n    \"mustn't\",\n    'my',\n    'myself',\n    'no',\n    'nor',\n    'not',\n    'now',\n    'of',\n    'off',\n    'on',\n    'once',\n    //\"one\",\n    'only',\n    'or',\n    'other',\n    'ought',\n    'our',\n    \"our's\",\n    'ourselves',\n    'out',\n    'over',\n    'own',\n    //\"people\",\n    'same',\n    'say',\n    'see',\n    \"shan't\",\n    'she',\n    \"she'd\",\n    'shell',\n    'shes',\n    'should',\n    \"shouldn't\",\n    'so',\n    'some',\n    'such',\n    //\"take\",\n    'than',\n    'that',\n    \"that's\",\n    'the',\n    'their',\n    'theirs',\n    'them',\n    'themselves',\n    'then',\n    'there',\n    \"there's\",\n    'these',\n    'they',\n    \"they'd\",\n    \"they'll\",\n    \"they're\",\n    \"they've\",\n    //\"think\",\n    'this',\n    'those',\n    'through',\n    'time',\n    'to',\n    'too',\n    //\"two\",\n    //\"under\",\n    'until',\n    'up',\n    'us',\n    //\"use\",\n    'very',\n    'want',\n    'was',\n    \"wasn't\",\n    'way',\n    'we',\n    'wed',\n    'well',\n    'were',\n    \"weren't\",\n    \"we've\",\n    'what',\n    \"what's\",\n    'when',\n    \"when's\",\n    'where',\n    \"where's\",\n    'which',\n    'while',\n    'who',\n    'whom',\n    \"who's\",\n    'why',\n    \"why's\",\n    'will',\n    'with',\n    \"won't\",\n    //\"work\",\n    'would',\n    \"wouldn't\",\n    //\"year\",\n    'you',\n    \"you'd\",\n    \"you'll\",\n    'your',\n    \"you're\",\n    \"your's\",\n    'yourself',\n    'yourselves',\n    \"you've\",\n  ],\n  stemmer: {\n    ational: 'ate',\n    iveness: 'ive',\n    fulness: 'ful',\n    ousness: 'ous',\n    ization: 'ize',\n    tional: 'tion',\n    biliti: 'ble',\n    icate: 'ic',\n    ative: '',\n    alize: 'al',\n    iciti: 'ic',\n    entli: 'ent',\n    ousli: 'ous',\n    alism: 'al',\n    ation: 'ate',\n    aliti: 'al',\n    iviti: 'ive',\n    ement: '',\n    enci: 'ence',\n    anci: 'ance',\n    izer: 'ize',\n    alli: 'al',\n    ator: 'ate',\n    logi: 'log',\n    ical: 'ic',\n    ance: '',\n    ence: '',\n    ness: '',\n    able: '',\n    ible: '',\n    ment: '',\n    eli: 'e',\n    bli: 'ble',\n    ful: '',\n    ant: '',\n    ent: '',\n    ism: '',\n    ate: '',\n    iti: '',\n    ous: '',\n    ive: '',\n    ize: '',\n    al: '',\n    ou: '',\n    er: '',\n    ic: '',\n  },\n};\n\nBulkSearch.registerLanguage('custom', customLang);\n\nfunction regex(str: string) {\n  return new RegExp(str, 'g');\n}\n\nconst regex_whitespace = regex('\\\\s\\\\s+'),\n  regex_split = regex('[-/]'),\n  regex_a = regex('[\u00E0\u00E1\u00E2\u00E3\u00E4\u00E5]'),\n  regex_e = regex('[\u00E8\u00E9\u00EA\u00EB]'),\n  regex_i = regex('[\u00EC\u00ED\u00EE\u00EF]'),\n  regex_o = regex('[\u00F2\u00F3\u00F4\u00F5\u00F6\u0151]'),\n  regex_u = regex('[\u00F9\u00FA\u00FB\u00FC\u0171]'),\n  regex_y = regex('[\u00FD\u0177\u00FF]'),\n  regex_n = regex('\u00F1'),\n  regex_c = regex('\u00E7'),\n  regex_s = regex('\u00DF'),\n  regex_and = regex(' & ');\n\n/** @const {Array} */\nconst regex_pairs = [\n  regex_a,\n  'a',\n  regex_e,\n  'e',\n  regex_i,\n  'i',\n  regex_o,\n  'o',\n  regex_u,\n  'u',\n  regex_y,\n  'y',\n  regex_n,\n  'n',\n  regex_c,\n  'c',\n  regex_s,\n  's',\n  regex_and,\n  ' and ',\n  regex_split,\n  ' ',\n  regex_whitespace,\n  ' ',\n];\n\nfunction replace(\n  str: string,\n  regex: typeof regex_pairs | RegExp,\n  replacement?: string\n) {\n  if (typeof replacement === 'undefined') {\n    regex = regex as typeof regex_pairs;\n    for (let i = 0; i < regex.length; i += 2) {\n      str = str.replace(regex[i], regex[i + 1] as string);\n    }\n\n    return str;\n  } else {\n    return str.replace(regex as RegExp, replacement);\n  }\n}\n\nBulkSearch.registerEncoder('simple', function (str: string) {\n  str = replace(str.toLowerCase(), regex_pairs);\n\n  return str !== ' ' ? str : '';\n});\n", "import { Record } from '../../base/record.ts';\nimport { SchemeManager } from '../../base/scheme.ts';\nimport { assert } from '../../../base/error.ts';\nimport { uniqueId } from '../../../base/common.ts';\nimport { Dictionary } from '../../../base/collections/dict.ts';\nimport { CoreObject } from '../../../base/core-types/index.ts';\nimport { UndoManager } from '../undo/manager.ts';\nimport { MutationPack, mutationPackAppend } from './mutations.ts';\nimport { KeyFromVertexId, Vertex, VertexId } from './vertex.ts';\nimport {\n  EVENT_CRITICAL_ERROR,\n  EVENT_DID_CHANGE,\n  RefsChange,\n  VertexManager,\n} from './vertex-manager.ts';\nimport { DataType, NS_NOTES } from '../../base/scheme-types.ts';\nimport { MicroTaskTimer } from '../../../base/timer.ts';\nimport { JSONObject, ReadonlyJSONObject } from '../../../base/interfaces.ts';\nimport { unionIter } from '../../../base/set.ts';\nimport { SharedQueriesManager } from './shared-queries.ts';\nimport {\n  EVENT_VERTEX_CHANGED,\n  EVENT_VERTEX_SOURCE_CLOSED,\n  VertexSource,\n} from './vertex-source.ts';\nimport { AdjacencyList, SimpleAdjacencyList } from './adj-list.ts';\nimport {\n  EVENT_NEW_COMMIT,\n  MemRepoStorage,\n  Repository,\n} from '../../../repo/repo.ts';\nimport { Commit } from '../../../repo/commit.ts';\nimport { IDBRepositoryBackup } from '../../../repo/idbbackup.ts';\nimport { RepoClient } from '../../../net/repo-client.ts';\nimport { kSyncConfigClient } from '../../../net/base-client.ts';\nimport { appendPathComponent } from '../../../base/string.ts';\nimport { NoteSearchEngine } from './note-search.ts';\n\n// We consider only commits from the last 30 days to be \"hot\", and load them\n// automatically\nconst K_HOT_COMMITS_WINDOW_MS = 30 * 24 * 60 * 60 * 1000;\n\nexport interface PointerFilterFunc {\n  (key: string): boolean;\n}\n\n/**\n * @deprecated\n */\nexport const EVENT_VERTEX_DID_CHANGE = 'vert-did-change';\n\nexport class GraphManager extends VertexSource {\n  readonly sharedQueriesManager: SharedQueriesManager;\n  private readonly _rootKey: string;\n  private readonly _adjList: AdjacencyList;\n  private readonly _vertManagers: Dictionary<string, VertexManager>;\n  private readonly _pendingMutations: Dictionary<string, MutationPack>;\n  private readonly _undoManager: UndoManager;\n  private readonly _ptrFilterFunc: PointerFilterFunc;\n  private readonly _processPendingMutationsTimer: MicroTaskTimer;\n  private readonly _session: string;\n  private readonly _repoById: Dictionary<string, Repository<MemRepoStorage>>;\n  private readonly _backup: IDBRepositoryBackup;\n  private readonly _repoClients: Dictionary<string, RepoClient<MemRepoStorage>>;\n  private readonly _baseServerUrl: string | undefined;\n  private readonly _notesSearch: NoteSearchEngine;\n  private _loadContentsPromise: Promise<void> | undefined;\n\n  constructor(\n    rootKey: string,\n    ptrFilterFunc: PointerFilterFunc,\n    baseServerUrl?: string\n  ) {\n    super();\n    this._repoById = new Map();\n    this._rootKey = rootKey;\n    this._adjList = new SimpleAdjacencyList();\n    this._vertManagers = new Map();\n    this._pendingMutations = new Map();\n    this._session = rootKey + '/' + uniqueId();\n    this._ptrFilterFunc = ptrFilterFunc;\n    this._processPendingMutationsTimer = new MicroTaskTimer(() =>\n      this._processPendingMutations()\n    );\n    this._undoManager = new UndoManager(this);\n\n    this._createVertIfNeeded(this._rootKey);\n    this.sharedQueriesManager = new SharedQueriesManager(this);\n    this._repoById = new Map();\n    this._backup = new IDBRepositoryBackup(rootKey);\n    this._repoClients = new Map();\n    this._baseServerUrl = baseServerUrl;\n    this._notesSearch = new NoteSearchEngine(this);\n\n    // Automatically init the directory as everything depends on its presence.\n    this.repository('/sys/dir');\n  }\n\n  close(): void {\n    this.emit(EVENT_VERTEX_SOURCE_CLOSED);\n    this._processPendingMutationsTimer.unschedule();\n    this._notesSearch.close();\n    this._backup.close();\n  }\n\n  get adjacencyList(): AdjacencyList {\n    return this._adjList;\n  }\n\n  get undoManager() {\n    return this._undoManager;\n  }\n\n  get rootKey(): string {\n    return this._rootKey;\n  }\n\n  get ptrFilterFunc(): PointerFilterFunc {\n    return this._ptrFilterFunc;\n  }\n\n  get isLoading(): boolean {\n    return false;\n  }\n\n  get session(): string {\n    return this._session;\n  }\n\n  get noteSearchEngine(): NoteSearchEngine {\n    return this._notesSearch;\n  }\n\n  loadLocalContents(): Promise<void> {\n    if (!this._loadContentsPromise) {\n      this._loadContentsPromise = (async () => {\n        for (const [repoId, commits] of Object.entries(\n          await this._backup.loadCommits()\n        )) {\n          this.repository(repoId).persistCommits(commits);\n        }\n      })();\n    }\n    return this._loadContentsPromise;\n  }\n\n  repository(id: string): Repository<MemRepoStorage> {\n    let repo = this._repoById.get(id);\n    if (!repo) {\n      repo = new Repository(new MemRepoStorage());\n      repo.on(EVENT_NEW_COMMIT, (c: Commit) => {\n        if (!c.key) {\n          return;\n        }\n        const record = repo!.recordForCommit(c);\n        const ns = record.scheme.namespace;\n        if (\n          ns === NS_NOTES &&\n          c.timestamp.getTime() < Date.now() - K_HOT_COMMITS_WINDOW_MS\n        ) {\n          return;\n        }\n        // The following line does two major things:\n        //\n        // 1. It creates the vertex manager if it doesn't already exist.\n        //    Since this event gets triggered when loading from cache, this\n        //    implicitly boots our graph.\n        //\n        // 2. A commit will be performed if we need to merge some newly\n        //    discovered commits.\n        this.getVertexManager(c.key).scheduleCommitIfNeeded();\n\n        // Any kind of activity needs to reset the sync timer. This causes\n        // the initial sync to run at full speed, which is a desired side\n        // effect.\n        this._repoClients.get(id)?.touch();\n      });\n      this._repoById.set(id, repo);\n\n      if (this._baseServerUrl) {\n        const client = new RepoClient(\n          repo,\n          // serveAddr/repoId/sync\n          appendPathComponent(this._baseServerUrl, id, 'sync'),\n          kSyncConfigClient\n        );\n        this._repoClients.set(id, client);\n        client.startSyncing();\n      }\n    }\n    return repo;\n  }\n\n  keys(): Iterable<string> {\n    return this._vertManagers.keys();\n  }\n\n  vertexManagers(): Iterable<VertexManager> {\n    return this._vertManagers.values();\n  }\n\n  hasVertex(key: string): boolean {\n    if (this._vertManagers.has(key)) {\n      return true;\n    }\n    // We may have not loaded this vertex yet, but do have it in one of our\n    // underlying repositories. This still qualifies as a hit.\n    for (const repo of this._repoById.values()) {\n      if (repo.hasKey(key)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  getRootVertex<T extends Vertex>(): T {\n    return this.getVertex<T>(this.rootKey);\n  }\n\n  getRootVertexManager<T extends Vertex>(): VertexManager<T> {\n    return this.getVertexManager<T>(this.rootKey);\n  }\n\n  getVertex<T extends Vertex>(key: string): T;\n  getVertex<T extends Vertex>(key: VertexId<T>): T;\n  getVertex<T extends Vertex>(key: VertexId<T>): T {\n    return this.getVertexManager<T>(KeyFromVertexId(key)).getVertexProxy();\n  }\n\n  createVertex<T extends Vertex>(\n    namespace: string,\n    initialData: CoreObject,\n    key?: string,\n    local = false\n  ): T {\n    return this._createVertIfNeeded<T>(\n      key || uniqueId(),\n      namespace,\n      initialData,\n      local\n    ).getVertexProxy();\n  }\n\n  getVertexManager<V extends Vertex = Vertex>(\n    key: string,\n    discoveredBy?: string\n  ): VertexManager<V>;\n\n  getVertexManager<V extends Vertex = Vertex>(\n    key: VertexId<V>,\n    discoveredBy?: string\n  ): VertexManager<V>;\n\n  getVertexManager<V extends Vertex = Vertex>(\n    key: VertexId<V>,\n    discoveredBy?: string\n  ): VertexManager<V> {\n    return this._createVertIfNeeded<V>(\n      KeyFromVertexId(key),\n      discoveredBy || this.rootKey\n    );\n  }\n\n  private _createVertIfNeeded<V extends Vertex = Vertex>(\n    key: string,\n    ns?: string,\n    initialData?: CoreObject,\n    local = false\n  ): VertexManager<V> {\n    let mgr = this._vertManagers.get(key);\n    if (mgr === undefined) {\n      const scheme =\n        ns !== undefined ? SchemeManager.instance.getScheme(ns) : undefined;\n      const record =\n        scheme !== undefined\n          ? new Record({\n              scheme: scheme,\n              data: initialData! as DataType,\n            })\n          : undefined;\n      mgr = new VertexManager(this, key, record, local);\n      this._vertManagers.set(key, mgr);\n      mgr.on(EVENT_DID_CHANGE, (pack: MutationPack, refsChange: RefsChange) =>\n        this._vertexDidChange(key, pack, refsChange)\n      );\n      mgr.on(EVENT_CRITICAL_ERROR, () => this.emit(EVENT_CRITICAL_ERROR));\n      this._setupVertexManager(mgr);\n    }\n    return mgr as VertexManager<V>;\n  }\n\n  private _setupVertexManager(mgr: VertexManager): void {\n    const key = mgr.key;\n    mgr.on(EVENT_DID_CHANGE, (pack: MutationPack, refsChange: RefsChange) =>\n      this._vertexDidChange(key, pack, refsChange)\n    );\n    mgr.on(EVENT_CRITICAL_ERROR, () => this.emit(EVENT_CRITICAL_ERROR));\n  }\n\n  private _vertexDidChange(\n    key: string,\n    pack: MutationPack,\n    refsChange: RefsChange\n  ): void {\n    const pendingMutations = this._pendingMutations;\n    pack = mutationPackAppend(pendingMutations.get(key), pack);\n    pendingMutations.set(key, pack);\n    this._processPendingMutationsTimer.schedule();\n    this.emit(EVENT_VERTEX_DID_CHANGE, key, pack, refsChange);\n    // this.emit(EVENT_VERTEX_CHANGED, key, pack, refsChange);\n  }\n\n  private _processPendingMutations(): void {\n    if (this._pendingMutations.size > 0) {\n      const mutations: [VertexManager, MutationPack][] = new Array(\n        this._pendingMutations.size\n      );\n      let i = 0;\n      for (const [key, mut] of this._pendingMutations) {\n        mutations[i++] = [this.getVertexManager(key), mut];\n      }\n      const pendingMutations = Array.from(this._pendingMutations.entries());\n      this._pendingMutations.clear();\n\n      //Send mutations to index/query/undo ...\n      this._undoManager.update(mutations);\n\n      for (const [key, pack] of pendingMutations) {\n        this.emit(EVENT_VERTEX_CHANGED, key, pack);\n      }\n    }\n  }\n\n  /**\n   * Given a source vertex in the graph, this method performs a BFS run starting\n   * at the source, and exports all encountered vertices.\n   *\n   * @param     srcKey The key of the source vertex.\n   *\n   * @param   distance The maximum distance from the source to search. You must\n   *                   ensure a deep enough sub-graph is exported or the\n   *                   imported sub-graph will not be usable. This value will\n   *                   differ based on the provided source and the desired\n   *                   effect during import.\n   *\n   * @param  excludeNs An optional list of scheme namespaces to skip. Vertices\n   *                   matching this list will not be exported regardless of\n   *                   their distance from the source.\n   *\n   * @param editRecord An optional callback where you can apply any cleanups\n   *                   to individual records just before they're being encoded.\n   *\n   * @returns A JSON encoded sub-graph.\n   */\n  exportSubGraph(\n    srcKey: string,\n    distance: number,\n    excludeNs: string[] = [],\n    editRecord: (r: Record) => void = () => {},\n    skipMissingRefs = true\n  ): ReadonlyJSONObject {\n    const rootKey = this.rootKey;\n    const result: JSONObject = {};\n    // In a BFS run, unvisited vertices have depths that never decrease, and\n    // increase by at most 1. While there are more memory efficient\n    // representations, this one is good enough while being quite readable.\n    const keysQueue: [string, number][] = [[srcKey, 0]];\n    const excludedNsSet = new Set(excludeNs);\n    const deletedKeys = new Set<string>();\n    const rewriteKeys = new Map<string, string>();\n    // Rewrite all refs to our root key so they're absolute\n    rewriteKeys.set(rootKey, '/');\n\n    while (keysQueue.length > 0) {\n      const [key, depth] = keysQueue.shift()!;\n      const vert = this.getVertex(key);\n      // We can stop early if existed the defined perimeter\n      if (depth > distance) {\n        break;\n      }\n      // Never export the root key. Instead, we treat all refs to the root\n      // like pointers to '/'.\n      if (key === rootKey) {\n        continue;\n      }\n      // Skip excluded namespaces\n      if (excludedNsSet.has(vert.namespace)) {\n        deletedKeys.add(key);\n        continue;\n      }\n      // Skip already visited vertices\n      if (typeof result[key] !== 'undefined') {\n        continue;\n      }\n\n      // Delete any missing refs if needed\n      if (skipMissingRefs) {\n        for (const k of vert.outRefs) {\n          if (!this.hasVertex(k)) {\n            deletedKeys.add(k);\n          }\n        }\n      }\n\n      const record = vert.record.clone();\n      record.rewriteRefs(rewriteKeys, deletedKeys);\n      editRecord(record);\n      result[key] = record.toJS(false);\n      if (depth < distance) {\n        const mgr = this.getVertexManager(key);\n        // NOTE: We traverse the computed, in-memory, graph rather than the\n        // persistent sub-graph from the underlying records. At the time of this\n        // writing (April, 2022) this better captures the app's intention.\n        for (const [edgeMgr] of unionIter(mgr.outEdges(), mgr.inEdges())) {\n          keysQueue.push([edgeMgr.key, depth + 1]);\n        }\n      }\n    }\n    return result;\n  }\n\n  /**\n   * Given an encoded graph, this method imports it as a local sub graph.\n   * This method will create new keys for the imported vertices for a few\n   * reasons:\n   *\n   * - To avoid conflicts with the original, persistent, vertices (to which the\n   *   user most likely has no access to).\n   *\n   * - To allow the same sub-graph to be imported more than once without\n   *   overwriting itself.\n   *\n   * @param encodedGraph An encoded JSON sub-graph.\n   * @returns The created vertex managers.\n   */\n  importSubGraph(\n    encodedGraph: ReadonlyJSONObject,\n    local: boolean\n  ): VertexManager[] {\n    const vertManagers = this._vertManagers;\n    const decodedGraph = this.decodeGraph(encodedGraph);\n    const createdManagers: VertexManager[] = [];\n    // First, instantiate all VertexManagers without really connecting the graph\n    // they form. This allows us to later build a complete graph rather than\n    // dealing with the complex logic of incrementally building the graph.\n    for (const [key, record] of decodedGraph) {\n      // Sanity checks\n      assert(key !== this.rootKey && !vertManagers.has(key));\n      const mgr = new VertexManager(this, key, record, local);\n      vertManagers.set(key, mgr);\n      createdManagers.push(mgr);\n    }\n    // Actually connect our graph. This triggers the initial values mutation\n    // which causes the vertices to actually appear in query results.\n    for (const mgr of createdManagers) {\n      this._setupVertexManager(mgr);\n    }\n    return createdManagers;\n  }\n\n  private decodeGraph(encodedGraph: ReadonlyJSONObject): Map<string, Record> {\n    const result = new Map<string, Record>();\n    const keysMapping = new Map<string, string>();\n    for (const [origKey, encodedRecord] of Object.entries(encodedGraph)) {\n      const newKey = uniqueId();\n      const record = Record.fromJS(encodedRecord as ReadonlyJSONObject);\n      result.set(newKey, record);\n      keysMapping.set(origKey, newKey);\n    }\n    // Rewrite references to the root with our current root key\n    keysMapping.set('/', this.rootKey);\n    for (const record of result.values()) {\n      record.rewriteRefs(keysMapping);\n    }\n    return result;\n  }\n}\n", "import { Dictionary } from '../base/collections/dict.ts';\nimport { NormalizedLogEntry } from '../logging/entry.ts';\nimport { LogStream } from '../logging/stream.ts';\nimport { BaseClient, BaseClientStorage, SyncConfig } from './base-client.ts';\nimport { SyncMessage } from './message.ts';\n\nexport interface LogClientStorage extends BaseClientStorage {\n  persistEntries(entries: NormalizedLogEntry[]): Promise<void | number>;\n  entries(): AsyncIterable<NormalizedLogEntry>;\n}\n\nexport class LogClient\n  extends BaseClient<NormalizedLogEntry>\n  implements LogStream\n{\n  readonly storage: LogClientStorage;\n  readonly entries: Dictionary<string, NormalizedLogEntry>;\n\n  constructor(\n    storage: LogClientStorage,\n    serverUrl: string,\n    syncConfig: SyncConfig\n  ) {\n    super(serverUrl, syncConfig);\n    this.storage = storage;\n    this.entries = new Map();\n    this.loadAllEntries().then(() => {\n      this.ready = true;\n    });\n  }\n\n  protected buildSyncMessage(): SyncMessage<NormalizedLogEntry> {\n    return SyncMessage.build(\n      this.previousServerFilter,\n      this.entries.entries(),\n      this.entries.size,\n      this.previousServerSize,\n      this.syncCycles\n    );\n  }\n\n  protected async persistPeerValues(\n    values: NormalizedLogEntry[]\n  ): Promise<number> {\n    const entries = this.entries;\n    let persistedCount = 0;\n    for (const e of values) {\n      if (!entries.has(e.logId)) {\n        ++persistedCount;\n      }\n      entries.set(e.logId, e);\n    }\n    const writeCount = await this.storage.persistEntries(values);\n    return typeof writeCount === 'number' ? writeCount : persistedCount;\n  }\n\n  private async loadAllEntries(): Promise<void> {\n    const entries = this.entries;\n    for await (const e of this.storage.entries()) {\n      entries.set(e.logId, e);\n    }\n  }\n\n  localIds(): Iterable<string> {\n    return this.entries.keys();\n  }\n\n  appendEntry(e: NormalizedLogEntry): void {\n    // TODO: Special handling for metrics\n    this.storage.persistEntries([e]);\n    this.entries.set(e.logId, e);\n  }\n}\n", "import React, {\n  useContext,\n  useEffect,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport {\n  openDB,\n  deleteDB,\n  DBSchema,\n  IDBPDatabase,\n} from 'https://esm.sh/idb@7.1.1/with-async-ittr';\nimport {\n  GlobalLogger,\n  log,\n  Logger,\n  newLogger,\n  resetGlobalLoggerStreams,\n  setGlobalLoggerStreams,\n} from '../../../../../logging/log.ts';\nimport { LogClient, LogClientStorage } from '../../../../../net/log-client.ts';\nimport { SessionInfo } from '../../../app/login/index.tsx';\nimport { NormalizedLogEntry } from '../../../../../logging/entry.ts';\nimport { kSyncConfigClient } from '../../../../../net/base-client.ts';\nimport { ConsoleLogStream } from '../../../../../logging/stream.ts';\n\ninterface LoggerContext {\n  logger: Logger;\n}\n\nconst loggerContext = React.createContext<LoggerContext>({\n  logger: GlobalLogger,\n});\n\ninterface LoggerProviderProps {\n  sessionInfo?: SessionInfo;\n  children: React.ReactNode;\n}\nexport function LoggerProvider({ sessionInfo, children }: LoggerProviderProps) {\n  const [ctx, setCtx] = useState<LoggerContext>({ logger: GlobalLogger });\n  useEffect(() => {\n    if (!sessionInfo) {\n      setCtx({ logger: GlobalLogger });\n      return;\n    }\n\n    const storage = new LogClientIDBStorage(sessionInfo.userId);\n    const client = new LogClient(\n      storage,\n      'http://localhost',\n      kSyncConfigClient\n    );\n    // Rather than using a different logger, we change the GlobalLogger's\n    // streams to match the current user. This diverts logs from the entire\n    // client stack rather than just UI stuff rendered with react.\n    const streams = [client, new ConsoleLogStream('DEBUG')];\n    setGlobalLoggerStreams(streams);\n    // const clientLogger = newLogger([client, new ConsoleLogStream('DEBUG')]);\n    // setCtx({ logger: clientLogger });\n    const unloadHandler = () => {\n      resetGlobalLoggerStreams();\n      client.close();\n      storage.close();\n    };\n\n    addEventListener('unload', unloadHandler);\n    return () => {\n      removeEventListener('unload', unloadHandler);\n      // Log this session's end\n      GlobalLogger.log({\n        severity: 'INFO',\n        event: 'SessionEnd',\n      });\n      // Reset our global logger to default mode\n      resetGlobalLoggerStreams();\n      client.sync().finally(() => {\n        client.close();\n        storage.close();\n      });\n    };\n  }, [sessionInfo]);\n  return (\n    <loggerContext.Provider value={ctx}>{children}</loggerContext.Provider>\n  );\n}\n\nexport function useLogger(): Logger {\n  return useContext(loggerContext).logger;\n}\n\nconst K_DB_VERSION = 1;\n\ninterface LogStorageSchema extends DBSchema {\n  logEntries: {\n    key: string;\n    value: NormalizedLogEntry;\n  };\n}\n\nclass LogClientIDBStorage implements LogClientStorage {\n  private _dbPromise: Promise<IDBPDatabase<LogStorageSchema>> | undefined;\n  constructor(readonly dbName: string) {\n    this.getDB(); // Start open of our DB as soon as possible\n  }\n\n  private getDB(): Promise<IDBPDatabase<LogStorageSchema>> {\n    if (this._dbPromise === undefined) {\n      this._dbPromise = openDB<LogStorageSchema>(this.dbName, K_DB_VERSION, {\n        upgrade(db) {\n          db.createObjectStore('logEntries', { keyPath: 'logId' });\n        },\n      });\n    }\n    return this._dbPromise;\n  }\n\n  async close(): Promise<boolean> {\n    if (undefined === this._dbPromise) {\n      return false;\n    }\n    const db = await this._dbPromise;\n    db.close();\n    this._dbPromise = undefined;\n    return true;\n  }\n\n  async delete(): Promise<void> {\n    await this.close();\n    await deleteDB(this.dbName);\n  }\n\n  async persistEntries(entries: NormalizedLogEntry[]): Promise<void> {\n    const db = await this.getDB();\n    const txn = db.transaction('logEntries', 'readwrite', {\n      durability: 'relaxed',\n    });\n    const store = txn.objectStore('logEntries');\n    const promises: Promise<void>[] = [];\n    for (const e of entries) {\n      promises.push(\n        (async () => {\n          try {\n            await store.put(e, e.logId);\n          } catch (e) {\n            log({\n              severity: 'ERROR',\n              error: 'LoggerWriteFailed',\n              message: e.message,\n              trace: e.stack,\n              repo: this.dbName,\n              commit: e.logId,\n            });\n            throw e;\n          }\n        })()\n      );\n    }\n    for (const p of promises) {\n      await p;\n    }\n    await txn.done;\n  }\n\n  async *entries(): AsyncGenerator<NormalizedLogEntry> {\n    const db = await this.getDB();\n    const txn = db.transaction('logEntries', 'readonly', {\n      durability: 'relaxed',\n    });\n    for await (const e of txn.store) {\n      yield e.value;\n    }\n  }\n}\n", "import { useEffect, useState, useMemo } from 'https://esm.sh/react@18.2.0';\nimport { useGraphManager } from './graph.tsx';\nimport {\n  VertexManager,\n  EVENT_DID_CHANGE,\n} from '../../../../../cfds/client/graph/vertex-manager.ts';\nimport {\n  MutationPack,\n  mutationPackIter,\n} from '../../../../../cfds/client/graph/mutations.ts';\nimport { Vertex, VertexId } from '../../../../../cfds/client/graph/vertex.ts';\nimport { User } from '../../../../../cfds/client/graph/vertices/user.ts';\nimport { mapIterable } from '../../../../../base/common.ts';\n\ninterface OnChangeOpts {\n  errorCallback?: () => void;\n}\n\ntype VertexListenerCallback = () => void;\n\nfunction isRevokedProxy(vertex: Vertex) {\n  try {\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    const _ = vertex.key;\n    return false;\n  } catch (err) {\n    if (err instanceof TypeError) {\n      return true;\n    }\n    throw err;\n  }\n}\n\nconst EMPTY_OPTS: OnChangeOpts = {};\n\nfunction register(\n  manager: VertexManager | undefined | null,\n  onChange: VertexListenerCallback,\n  keys?: string[],\n  opts: OnChangeOpts = EMPTY_OPTS\n): void | (() => void | undefined) {\n  if (manager === undefined || manager === null) {\n    return;\n  }\n\n  //const manager = vertex.manager;\n  let vertex = manager.getVertexProxy();\n\n  /***\n   * mgr.on(EVENT_DID_CHANGE, (pack: MutationPack) =>\n   */\n  const callback = (pack: MutationPack) => {\n    let didChange = false;\n\n    if (isRevokedProxy(vertex)) {\n      vertex = manager.getVertexProxy();\n      didChange = true;\n    }\n\n    for (const [field] of mutationPackIter(pack)) {\n      if (field === 'error' && opts.errorCallback) {\n        opts.errorCallback();\n      }\n      if (!keys || !keys.length || keys.includes(field)) {\n        didChange = true;\n        break;\n      }\n    }\n\n    if (didChange) {\n      onChange();\n    }\n  };\n\n  manager.on(EVENT_DID_CHANGE, callback);\n  return () => {\n    manager.removeListener(EVENT_DID_CHANGE, callback);\n  };\n}\n\nexport function useVertexByKey<V extends Vertex>(key: string): V | undefined {\n  const graph = useGraphManager();\n\n  const vertexMng = useMemo<VertexManager<V> | undefined>(\n    () =>\n      (graph && graph.hasVertex(key) && graph.getVertexManager<V>(key)) ||\n      undefined,\n    [graph, key]\n  );\n\n  return useVertex(vertexMng);\n}\n\nexport function useVertexManager<V extends Vertex>(\n  id: VertexId<V> | undefined | null\n): VertexManager<V> | undefined | null;\n\nexport function useVertexManager<V extends Vertex>(\n  id: VertexId<V> | undefined\n): VertexManager<V> | undefined;\n\nexport function useVertexManager<V extends Vertex>(\n  id: VertexId<V> | null\n): VertexManager<V> | null;\n\nexport function useVertexManager<V extends Vertex>(\n  id: VertexId<V>\n): VertexManager<V>;\n\nexport function useVertexManager<V extends Vertex>(\n  id: VertexId<V> | undefined | null\n): VertexManager<V> | undefined | null {\n  const graph = useGraphManager();\n  if (typeof id === 'undefined' || id === null) {\n    return id;\n  }\n  const key = id instanceof VertexManager || id instanceof Vertex ? id.key : id;\n  return graph.getVertexManager<V>(key);\n}\n\nexport function useVerticesManagers<V extends Vertex>(\n  iter: Iterable<VertexId<V> | undefined | null>\n): (VertexManager<V> | undefined | null)[];\n\nexport function useVerticesManagers<V extends Vertex>(\n  iter: Iterable<VertexId<V> | undefined>\n): (VertexManager<V> | undefined)[];\n\nexport function useVerticesManagers<V extends Vertex>(\n  iter: Iterable<VertexId<V> | null>\n): (VertexManager<V> | null)[];\n\nexport function useVerticesManagers<V extends Vertex>(\n  iter: Iterable<VertexId<V>>\n): VertexManager<V>[];\n\nexport function useVerticesManagers<V extends Vertex>(\n  iter: Iterable<VertexId<V> | undefined | null>\n): (VertexManager<V> | undefined | null)[] {\n  const graph = useGraphManager();\n  if (typeof iter === 'undefined' || iter === null) {\n    return iter;\n  }\n  return Array.from(\n    mapIterable(iter, (id) => {\n      const key =\n        id instanceof VertexManager || id instanceof Vertex ? id.key : id;\n      return typeof key === 'string' ? graph.getVertexManager<V>(key) : key;\n    })\n  );\n}\n\nexport function usePartialVertex<V extends Vertex, K extends keyof V>(\n  vertexMng: VertexId<V>,\n  keys: K[],\n  opts?: OnChangeOpts\n): Pick<V, K> & V;\n\nexport function usePartialVertex<V extends Vertex, K extends keyof V>(\n  vertexMng: undefined | VertexId<V>,\n  keys: K[],\n  opts?: OnChangeOpts\n): undefined | (Pick<V, K> & V);\n\nexport function usePartialVertex<V extends Vertex, K extends keyof V>(\n  vertId: VertexId<V> | undefined,\n  keys: K[],\n  opts: OnChangeOpts = EMPTY_OPTS\n): (Pick<V, K> & V) | undefined {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const [_, setReload] = useState(0);\n\n  if (!vertId) {\n    return undefined;\n  }\n  const vertexMng = useVertexManager(vertId);\n\n  const keysStr = keys.join('-');\n  useEffect(() => {\n    return register(\n      vertexMng,\n      () => setReload((x) => x + 1),\n      keys as string[],\n      opts\n    );\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [vertexMng, opts, keysStr]);\n\n  return vertexMng\n    ? (vertexMng.getVertexProxy() as unknown as Pick<V, K> & V)\n    : ({} as unknown as Pick<V, K> & V);\n}\n\nexport function useVertex<V extends Vertex>(\n  vertexMng: VertexId<V>,\n  opts?: OnChangeOpts\n): V;\n\nexport function useVertex<V extends Vertex>(\n  vertexMng: VertexId<V> | undefined,\n  opts?: OnChangeOpts\n): V | undefined;\n\nexport function useVertex<V extends Vertex>(\n  vertexId: VertexId<V> | undefined,\n  opts: OnChangeOpts = EMPTY_OPTS\n): V | undefined {\n  const vertexMng = useVertexManager(vertexId);\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const [_, setReload] = useState(0);\n  useEffect(() => {\n    return register(vertexMng, () => setReload((x) => x + 1), [], opts);\n  }, [vertexMng, opts]);\n\n  return vertexMng?.getVertexProxy();\n}\n\nfunction filterFunc(\n  fn: void | (() => void | undefined)\n): fn is () => void | undefined {\n  return !!fn;\n}\n\nexport function useVertices<V extends Vertex>(\n  vertexManagers: Iterable<VertexId<V> | undefined | null>,\n  opts: OnChangeOpts = EMPTY_OPTS\n): V[] {\n  return usePartialVertices(vertexManagers, [], opts) as V[];\n  // // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  // const [_, setReload] = useState(0);\n  // useEffect(() => {\n  //   if (!vertexManagers.length) {\n  //     return;\n  //   }\n  //   const unSubs = vertexManagers\n  //     .map(m => {\n  //       return register(m, () => setReload(x => x + 1), [], opts);\n  //     })\n  //     .filter(filterFunc);\n  //   return () => unSubs.forEach(fn => fn());\n  // }, [vertexManagers, opts]);\n\n  // return vertexManagers.map(m => m.getVertexProxy());\n}\n\nexport function usePartialVertices<\n  V extends Vertex,\n  K extends keyof V = keyof V\n>(\n  vertexIds: Iterable<VertexId<V>>,\n  keys: K[],\n  opts?: OnChangeOpts\n): (Pick<V, K> & Vertex)[];\n\nexport function usePartialVertices<\n  V extends Vertex,\n  K extends keyof V = keyof V\n>(\n  vertexIds: Iterable<VertexId<V> | undefined | null>,\n  keys: K[],\n  opts?: OnChangeOpts\n): ((Pick<V, K> & Vertex) | undefined | null)[];\n\nexport function usePartialVertices<\n  V extends Vertex,\n  K extends keyof V = keyof V\n>(\n  vertexIds: Iterable<VertexId<V> | undefined>,\n  keys: K[],\n  opts?: OnChangeOpts\n): ((Pick<V, K> & Vertex) | undefined)[];\n\nexport function usePartialVertices<\n  V extends Vertex,\n  K extends keyof V = keyof V\n>(\n  vertexIds: Iterable<VertexId<V> | null>,\n  keys: K[],\n  opts?: OnChangeOpts\n): ((Pick<V, K> & Vertex) | null)[];\n\nexport function usePartialVertices<\n  V extends Vertex,\n  K extends keyof V = keyof V\n>(\n  vertexIds: Iterable<VertexId<V> | undefined | null>,\n  keys: K[],\n  opts: OnChangeOpts = EMPTY_OPTS\n): ((Pick<V, K> & Vertex) | undefined | null)[] {\n  const vertexManagers = useVerticesManagers(vertexIds);\n  const [reload, setReload] = useState(0);\n  const keysStr = keys.join('-');\n  useEffect(() => {\n    if (!vertexManagers.length) {\n      return;\n    }\n    const unSubs = vertexManagers\n      .map((m) => {\n        return register(\n          m,\n          () => setReload((x) => x + 1),\n          keys as string[],\n          opts\n        );\n      })\n      .filter(filterFunc);\n    return () => unSubs.forEach((fn) => fn());\n  }, [vertexManagers, opts, keysStr]);\n  const result = useMemo(\n    () =>\n      vertexManagers.map((x) => (x instanceof VertexManager ? x.vertex : x)),\n    [vertexManagers, reload]\n  );\n\n  return result;\n}\n\nexport function useCurrentUser() {\n  const graph = useGraphManager();\n  return useVertexByKey<User>(graph.rootKey)!;\n}\n", "import { styleguide } from '../styleguide.ts';\nimport { cn, makeStyles } from '../css-objects/index.ts';\nimport { MediaQueries } from '../responsive.ts';\nimport { layout } from '../layout.ts';\n\nconst useStyles = makeStyles(\n  (theme) => ({\n    logoRoot: {\n      alignItems: 'center',\n      basedOn: [layout.row],\n    },\n    logo: {\n      height: styleguide.gridbase * 4,\n      [MediaQueries.TabletAndMobile]: {\n        height: styleguide.gridbase * 2.5,\n      },\n      overflowY: 'hidden',\n    },\n    icon: {},\n    ovvioText: {\n      transform: 'translate(-26px, 0)',\n      opacity: 1,\n      ...styleguide.transition.standard,\n      transitionProperty: 'transform, opacity',\n    },\n    textHidden: {\n      opacity: 0,\n      transform: 'translate(-14px, 100%)',\n    },\n  }),\n  'logo_d20958'\n);\nexport function Logo({\n  className,\n  showText = true,\n}: {\n  className?: string;\n  showText?: boolean;\n}) {\n  const styles = useStyles();\n  return (\n    <div className={cn(className, styles.logoRoot)}>\n      <LogoIcon />\n      <LogoText className={cn(!showText && styles.textHidden)} />\n    </div>\n  );\n}\n\nexport function LogoIcon({ className }: { className?: string }) {\n  const styles = useStyles();\n  return (\n    <svg\n      role=\"img\"\n      className={cn(styles.logo, className)}\n      width=\"26\"\n      height=\"28\"\n      viewBox=\"0 0 26 28\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <title>Ovvio Icon</title>\n      <g className={cn(styles.icon)}>\n        <path\n          d=\"M14.297 6.97553C17.1308 7.01353 19.8112 7.48984 22.3349 8.40444L25.6283 1.74024C25.9096 1.16933 26.0215 0.574959 25.9967 0C23.8925 0.540996 21.877 1.36583 19.9503 2.47855C17.8037 3.71985 15.9257 5.22477 14.297 6.97553Z\"\n          fill=\"#67B4F0\"\n        />\n        <path\n          d=\"M8.69006 14.5074C8.91702 14.6392 9.13199 14.7832 9.35256 14.9231C9.82087 13.6793 10.3963 12.4704 11.0803 11.3003C12.0066 9.71447 13.0846 8.27909 14.2962 6.97553C14.1723 6.97391 14.0492 6.97068 13.9254 6.97068H13.7248C9.3158 6.97068 5.24089 8.05267 1.50082 10.215C0.985364 10.5134 0.486688 10.8296 0 11.1579L0.186204 11.5356C3.21582 11.9787 6.05124 12.9677 8.69006 14.5074Z\"\n          fill=\"#67B4F0\"\n        />\n        <path\n          d=\"M11.0812 11.2994C10.3979 12.4696 9.8217 13.6785 9.35339 14.9223C11.9962 16.5744 14.2283 18.6413 16.0496 21.1231L22.3333 8.40444C19.8096 7.48984 17.1292 7.01353 14.2954 6.97553C13.0855 8.27828 12.0074 9.71366 11.0812 11.2994Z\"\n          fill=\"#2B81DF\"\n        />\n        <path\n          d=\"M9.35337 14.9223C9.132 14.784 8.91783 14.64 8.69087 14.5066C6.05204 12.9661 3.21503 11.9779 0.187012 11.5348L7.35627 26.0446C7.54168 26.4198 7.78062 26.7352 8.04994 27.0021C7.9013 25.8821 7.82298 24.7386 7.82298 23.5677C7.82538 20.5109 8.33444 17.6297 9.35337 14.9223Z\"\n          fill=\"#2B81DF\"\n        />\n        <path\n          d=\"M9.35338 14.9223C8.33445 17.6305 7.82458 20.5109 7.82458 23.5685C7.82458 24.7386 7.9013 25.8829 8.05155 27.0029C9.66025 28.5968 12.5141 28.2814 13.6185 26.0454L16.0511 21.1239C14.2282 18.6405 11.9962 16.5744 9.35338 14.9223Z\"\n          fill=\"#105CD1\"\n        />\n      </g>\n    </svg>\n  );\n}\n\nexport function LogoText({ className }: { className?: string }) {\n  const styles = useStyles();\n  return (\n    <svg\n      role=\"img\"\n      className={cn(styles.logo, className)}\n      width=\"120\"\n      height=\"28\"\n      viewBox=\"0 0 120 28\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <title>Ovvio Logo</title>\n      <g className={cn(styles.ovvioText)}>\n        <path\n          fillRule=\"evenodd\"\n          clipRule=\"evenodd\"\n          d=\"M38.2802 28C43.5175 28 47.5596 24.1234 47.5596 18.6958C47.5596 13.2681 43.5175 9.42605 38.2802 9.42605C33.0773 9.42605 29 13.2681 29 18.6958C29 24.1234 33.0781 28 38.2802 28ZM38.2802 14.3607C40.3188 14.3607 42.2168 15.7355 42.2168 18.6958C42.2168 21.6561 40.3188 23.0661 38.2802 23.0661C36.2767 23.0661 34.3436 21.6208 34.3436 18.6958C34.3436 15.7355 36.2767 14.3607 38.2802 14.3607Z\"\n          fill=\"#262626\"\n        />\n        <path\n          d=\"M79.1872 27.4717V27.4717C77.5835 27.4717 76.1381 26.5002 75.5289 25.0124L69.365 9.95511H75.1643L79.2064 20.8457L82.9327 9.95511H88.557L82.8824 24.9162C82.2995 26.4545 80.8285 27.4717 79.1872 27.4717Z\"\n          fill=\"#262626\"\n        />\n        <path\n          d=\"M58.2245 27.4717V27.4717C56.6207 27.4717 55.1753 26.5002 54.5661 25.0124L48.4022 9.95511H54.2015L58.2436 20.8457L61.97 9.95511H67.5942L61.9196 24.9162C61.3368 26.4545 59.8666 27.4717 58.2245 27.4717Z\"\n          fill=\"#262626\"\n        />\n        <path\n          d=\"M92.2081 27.4717V9.95511H97.551V27.4717H92.2081Z\"\n          fill=\"#262626\"\n        />\n        <path\n          fillRule=\"evenodd\"\n          clipRule=\"evenodd\"\n          d=\"M110.721 28C115.958 28 120 24.1234 120 18.6958C120 13.2681 115.958 9.42605 110.721 9.42605C105.518 9.42605 101.44 13.2681 101.44 18.6958C101.44 24.1234 105.519 28 110.721 28ZM110.721 14.3607C112.759 14.3607 114.657 15.7355 114.657 18.6958C114.657 21.6561 112.759 23.0661 110.721 23.0661C108.717 23.0661 106.784 21.6208 106.784 18.6958C106.784 15.7355 108.717 14.3607 110.721 14.3607Z\"\n          fill=\"#262626\"\n        />\n        <ellipse\n          cx=\"94.88\"\n          cy=\"3.37395\"\n          rx=\"3.36495\"\n          ry=\"3.37395\"\n          fill=\"#262626\"\n        />\n      </g>\n    </svg>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { styleguide } from '../../../styles/styleguide.ts';\nimport { LogoIcon } from '../../../styles/components/logo.tsx';\nimport {\n  cn,\n  keyframes,\n  makeStyles,\n} from '../../../styles/css-objects/index.ts';\n\nconst breath = keyframes({\n  from: {\n    transform: 'scale(1.5)',\n    opacity: 0.8,\n  },\n  to: {\n    transform: 'scale(1.8)',\n    opacity: 1,\n  },\n});\n\nconst useStyles = makeStyles((theme, resolveClass) => ({\n  logo: {\n    position: 'absolute',\n    top: '50%',\n    left: '50%',\n    transform: 'translate(-50%, -50%)',\n\n    ...styleguide.transition.standard,\n    transitionDuration: '1000ms',\n    transitionProperty: 'all',\n  },\n  animated: {\n    animation: `1s ${breath} infinite both`,\n    animationDirection: 'alternate',\n  },\n}));\n\nexport default function LoadingView() {\n  const styles = useStyles();\n  return (\n    <div className={cn(styles.logo)}>\n      <div className={cn(styles.animated)}>\n        <LogoIcon />\n      </div>\n    </div>\n  );\n}\n", "import React, { ReactElement, useContext } from 'https://esm.sh/react@18.2.0';\n\nconst context = React.createContext(1);\n\ninterface LayerProps {\n  priority?: number;\n  children: ({ zIndex: number }) => ReactElement;\n}\n\nexport default function Layer({ children, priority = 0 }: LayerProps) {\n  const zIndex = useContext(context) + priority;\n  const newZIndex = zIndex * 10;\n  return (\n    <context.Provider value={newZIndex}>\n      {children({ zIndex: zIndex })}\n    </context.Provider>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { makeStyles, cn } from '../css-objects/index.ts';\n\nexport const useStyles = makeStyles(\n  (theme) => ({\n    h1: {\n      margin: 0,\n      padding: 0,\n      fontSize: 40,\n      fontWeight: '600',\n      fontStyle: 'normal',\n      fontStretch: 'normal',\n      lineHeight: 'normal',\n      letterSpacing: 'normal',\n      color: theme.background.text,\n    },\n    h2: {\n      margin: 0,\n      padding: 0,\n      fontSize: 30,\n      fontWeight: 'bold',\n      fontStyle: 'normal',\n      fontStretch: 'normal',\n      lineHeight: 'normal',\n      letterSpacing: 'normal',\n      color: theme.background.text,\n    },\n    h3: {\n      margin: 0,\n      padding: 0,\n      fontSize: 20,\n      fontWeight: 'bold',\n      fontStyle: 'normal',\n      fontStretch: 'normal',\n      lineHeight: 'normal',\n      letterSpacing: 'normal',\n      color: theme.background.text,\n    },\n    h4: {\n      margin: 0,\n      padding: 0,\n      fontSize: 16,\n      fontWeight: 'bold',\n      fontStyle: 'normal',\n      fontStretch: 'normal',\n      lineHeight: 'normal',\n      letterSpacing: 'normal',\n      color: theme.background.text,\n    },\n    text: {\n      fontSize: 14,\n    },\n    bold: {\n      fontSize: 16,\n      lineHeight: 1.5,\n    },\n  }),\n  'texts_8b5438'\n);\n\ninterface TextProps {\n  className?: string;\n}\ntype H1Props = React.ComponentPropsWithoutRef<'h1'>;\nconst H1 = React.forwardRef<HTMLHeadingElement, TextProps & H1Props>(\n  ({ className, children, ...rest }, ref) => {\n    const styles = useStyles();\n    return (\n      <h1 ref={ref} className={cn(className, styles.h1)} {...rest}>\n        {children}\n      </h1>\n    );\n  }\n);\ntype H2Props = React.ComponentPropsWithoutRef<'h2'>;\nconst H2 = React.forwardRef<HTMLHeadingElement, TextProps & H2Props>(\n  ({ className, children, ...rest }, ref) => {\n    const styles = useStyles();\n    return (\n      <h2 className={cn(className, styles.h2)} {...rest} ref={ref}>\n        {children}\n      </h2>\n    );\n  }\n);\ntype H3Props = React.ComponentPropsWithoutRef<'h3'>;\nconst H3 = React.forwardRef<HTMLHeadingElement, TextProps & H3Props>(\n  ({ className, children, ...rest }, ref) => {\n    const styles = useStyles();\n    return (\n      <h3 className={cn(className, styles.h3)} {...rest} ref={ref}>\n        {children}\n      </h3>\n    );\n  }\n);\ntype H4Props = React.ComponentPropsWithoutRef<'h4'>;\nexport const H4 = React.forwardRef<HTMLHeadingElement, TextProps & H4Props>(\n  ({ className, children, ...rest }, ref) => {\n    const styles = useStyles();\n    return (\n      <h4 className={cn(className, styles.h4)} {...rest} ref={ref}>\n        {children}\n      </h4>\n    );\n  }\n);\ntype SpanProps = React.ComponentPropsWithoutRef<'span'>;\nconst Text = React.forwardRef<HTMLSpanElement, TextProps & SpanProps>(\n  ({ className, ...rest }, ref) => {\n    const styles = useStyles();\n    return <span className={cn(className, styles.text)} {...rest} ref={ref} />;\n  }\n);\n\nconst Bold = React.forwardRef<HTMLSpanElement, TextProps & SpanProps>(\n  ({ className, children, ...rest }, ref) => {\n    const styles = useStyles();\n    return (\n      <span className={cn(className, styles.bold)} {...rest} ref={ref}>\n        {children}\n      </span>\n    );\n  }\n);\n\nexport { H1, H2, H3, Text, Bold };\n", "import {\n  DependencyList,\n  useCallback,\n  useEffect,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport {\n  NS_NOTES,\n  NS_TAGS,\n  NS_WORKSPACE,\n} from '../../../../../cfds/base/scheme-types.ts';\nimport { GraphManager } from '../../../../../cfds/client/graph/graph-manager.ts';\nimport {\n  EVENT_QUERY_RESULTS_CHANGED,\n  Predicate,\n  Query,\n  SortDescriptor,\n  UnionQuery,\n} from '../../../../../cfds/client/graph/query.ts';\nimport { Vertex } from '../../../../../cfds/client/graph/vertex.ts';\nimport { VertexManager } from '../../../../../cfds/client/graph/vertex-manager.ts';\nimport {\n  Note,\n  Tag,\n  Workspace,\n} from '../../../../../cfds/client/graph/vertices/index.ts';\nimport { useGraphManager } from './graph.tsx';\nimport { useLogger } from './logger.tsx';\nimport {\n  SharedQueryName,\n  SharedQueryType,\n} from '../../../../../cfds/client/graph/shared-queries.ts';\nimport { assert } from '../../../../../base/error.ts';\n\nexport interface IAsyncQuery {\n  called: boolean;\n}\n\nexport type BaseResult<T> = {\n  result: T;\n};\n\nexport interface QueryOptions<\n  IT extends Vertex = Vertex,\n  OT extends IT = IT,\n  RT = OT[]\n> {\n  sort?: SortDescriptor<OT>;\n  listenOn?: (keyof IT)[];\n  name?: string;\n  mapResult?: (results: readonly VertexManager<OT>[]) => RT;\n  source?: Query<Vertex, IT> | UnionQuery<Vertex, IT> | GraphManager;\n}\n\nexport function isWorkspace(v: Vertex): v is Workspace {\n  return v.namespace === NS_WORKSPACE;\n}\n\nexport function isNote(v: Vertex): v is Note {\n  return v.namespace === NS_NOTES;\n}\n\nexport function isTag(v: Vertex): v is Tag {\n  return v.namespace === NS_TAGS;\n}\n\nexport interface UseQueryResult<\n  IT extends Vertex = Vertex,\n  OT extends IT = IT,\n  RT = VertexManager<OT>[]\n> {\n  loading: boolean;\n  results: RT;\n  query: Query<IT, OT>;\n}\n\nexport function useQuery<\n  IT extends Vertex = Vertex,\n  OT extends IT = IT,\n  RT = VertexManager<OT>[]\n>(\n  predicate: Predicate<IT, OT>,\n  deps: DependencyList,\n  opts?: QueryOptions<IT, OT, RT>\n): UseQueryResult<IT, OT, RT> {\n  const { sort, listenOn, mapResult } = opts || {};\n  const graph = useGraphManager();\n  const logger = useLogger();\n  const [result, setResult] = useState<null | UseQueryResult<IT, OT, RT>>(null);\n\n  const listenOnDep = listenOn && JSON.stringify(listenOn);\n\n  const filter = useCallback(\n    (v: IT) => {\n      return !v.isDeleted && predicate(v);\n    },\n    deps // eslint-disable-line\n  );\n\n  useEffect(() => {\n    const query = new Query<IT, OT>(\n      opts?.source || graph,\n      filter,\n      sort,\n      opts?.name\n    );\n\n    query.on(\n      EVENT_QUERY_RESULTS_CHANGED,\n      () => {\n        logger.log({\n          severity: 'INFO',\n          name: 'QueryFired',\n          queryName: opts?.name || 'Unknown',\n          value: 1,\n          unit: 'Count',\n        });\n        const results = mapResult\n          ? mapResult(query.results)\n          : (query.results as RT);\n        setResult({\n          loading: query.isLoading,\n          results: results,\n          query,\n        });\n      },\n      true\n    );\n\n    return () => {\n      query.close();\n    };\n  }, [graph, filter, sort, listenOnDep]); // eslint-disable-line\n\n  return result!;\n}\n\nexport function useQuery2<T>(query: T, closeOnCleanup = true): T {\n  const [counter, setCounter] = useState(0);\n  assert(query instanceof Query);\n  useEffect(() => {\n    const startTime = Date.now();\n    const cleanup = query.onResultsChanged(() => {\n      // Wait a bit while queries are loading before showing intermediate\n      // results. This prevents redundant UI refreshes and keeps everything\n      // smooth.\n      if (!query.isLoading || Date.now() - startTime > 500) {\n        setCounter(counter + 1);\n      }\n    });\n    return () => {\n      cleanup();\n      if (closeOnCleanup && !query.isLocked) {\n        query.close();\n      }\n    };\n  }, [query]);\n  return query;\n}\n\nexport function useExistingQuery<\n  IT extends Vertex = Vertex,\n  OT extends IT = IT,\n  RT = VertexManager<OT>[]\n>(\n  query: Query<IT, OT>,\n  opts?: QueryOptions<IT, OT, RT>\n): UseQueryResult<IT, OT, RT> {\n  const logger = useLogger();\n  const [result, setResult] = useState<null | UseQueryResult<IT, OT, RT>>(null);\n  const mapResult = opts?.mapResult;\n\n  useEffect(() => {\n    const listener = () => {\n      logger.log({\n        severity: 'INFO',\n        name: 'QueryFired',\n        value: 1,\n        unit: 'Count',\n        queryName: opts?.name || query.name || 'Unknown',\n      });\n      const results = mapResult\n        ? mapResult(query.results)\n        : (query.results as RT);\n      setResult({\n        loading: query.isLoading,\n        results,\n        query,\n      });\n    };\n    query.on(EVENT_QUERY_RESULTS_CHANGED, listener);\n\n    if (!query.isLoading) {\n      const results = mapResult\n        ? mapResult(query.results)\n        : (query.results as RT);\n      setResult({\n        loading: query.isLoading,\n        results,\n        query,\n      });\n    }\n\n    return () => {\n      query.removeListener(EVENT_QUERY_RESULTS_CHANGED, listener);\n    };\n  }, [query]);\n\n  return result!;\n}\n\nexport function useSharedQuery<T extends SharedQueryName>(\n  name: T\n): SharedQueryType<T> {\n  const graph = useGraphManager();\n  const q = graph.sharedQueriesManager[name];\n  return useQuery2<SharedQueryType<T>>(q as SharedQueryType<T>);\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { styleguide } from '../../../../../../../styles/index.ts';\nimport { Text } from '../../../../../../../styles/components/texts.tsx';\nimport {\n  cn,\n  makeStyles,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { useSharedQuery } from '../../../../../core/cfds/react/query.ts';\n\nconst useStyles = makeStyles((theme) => ({\n  indicator: {\n    color: theme.background.placeholderText,\n    whiteSpace: 'nowrap',\n    marginLeft: styleguide.gridbase * 3,\n    marginRight: styleguide.gridbase * 3,\n  },\n}));\n\nexport default function ChangesIndicator() {\n  const styles = useStyles();\n  const hasPendingChangesQuery = useSharedQuery('hasPendingChanges');\n  const hasPendingChanges = hasPendingChangesQuery.count > 0;\n\n  return (\n    <div className={cn(styles.indicator)}>\n      <Text>{hasPendingChanges ? 'Syncing...' : 'Updated Just Now'}</Text>\n    </div>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { makeStyles, cn } from '../../css-objects/index.ts';\n\nimport { styleguide } from '../../styleguide.ts';\nimport { layout } from '../../layout.ts';\n\nconst useStyles = makeStyles(\n  {\n    icon: {\n      basedOn: [layout.column, layout.centerCenter],\n      pointerEvents: 'none',\n    },\n    small: {\n      width: styleguide.gridbase * 2,\n      height: styleguide.gridbase * 2,\n    },\n    big: {\n      width: styleguide.gridbase * 3,\n      height: styleguide.gridbase * 3,\n    },\n    bigger: {\n      width: styleguide.gridbase * 4,\n      height: styleguide.gridbase * 4,\n    },\n  },\n  'IconBase_f63d61'\n);\n\ninterface IconBaseProps {\n  children: any;\n  size: 'small' | 'big';\n  className?: string;\n  style?: any;\n}\n\nconst IconBase = React.forwardRef<HTMLDivElement, IconBaseProps>(function (\n  { children, size, className = '', style = {} }: IconBaseProps,\n  ref\n) {\n  const styles = useStyles();\n  return (\n    <div\n      className={cn(className, styles.icon, styles[size] || styles.small)}\n      style={style}\n      ref={ref}\n    >\n      {children}\n    </div>\n  );\n});\nexport interface IconProps {\n  fill?: string;\n  className?: string;\n}\nexport default IconBase;\n", "import React from 'https://esm.sh/react@18.2.0';\nimport IconBase from './IconBase.tsx';\n\ninterface IconAddProps {\n  fill?: string;\n  size?: number;\n  className?: string;\n}\nconst IconAdd = ({ fill = '#FFF', size = 17, className }: IconAddProps) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={size}\n      height={size}\n      viewBox=\"0 0 17 17\"\n    >\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path d=\"M-4-4h24v24H-4z\" />\n        <path\n          fill={fill}\n          d=\"M7.25 7.25V0h2.417v7.25h7.25v2.417h-7.25v7.25H7.25v-7.25H0V7.25h7.25z\"\n        />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconAdd;\n", "import React from 'https://esm.sh/react@18.2.0';\nimport IconBase from './IconBase.tsx';\n\ninterface IconCreateNewProps {\n  fill?: string;\n  opacity?: number;\n  className?: string;\n}\n\nexport default React.forwardRef<HTMLDivElement, IconCreateNewProps & any>(\n  function IconCreateNew(\n    { fill = '#11082B', opacity = 0.6, className = '' },\n    ref\n  ) {\n    return (\n      <IconBase size=\"big\" className={className} ref={ref}>\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n          width=\"18\"\n          height=\"18\"\n          viewBox=\"0 0 18 18\"\n        >\n          <defs>\n            <path\n              id=\"create-new\"\n              d=\"M18.462 3A2.544 2.544 0 0 1 21 5.538v12.924A2.544 2.544 0 0 1 18.462 21H5.538A2.538 2.538 0 0 1 3 18.462V5.538C3 4.138 4.134 3 5.538 3h12.924zm-.098 1.5H5.636c-.629 0-1.136.51-1.136 1.136v12.728c0 .627.507 1.136 1.136 1.136h12.728c.623 0 1.136-.513 1.136-1.136V5.636c0-.623-.513-1.136-1.136-1.136zM17 13h-4v4h-2v-4H7v-2h4V7h2v4h4v2z\"\n            />\n          </defs>\n          <use\n            fill={fill}\n            fillOpacity={opacity}\n            fillRule=\"nonzero\"\n            transform=\"translate(-3 -3)\"\n            xlinkHref=\"#create-new\"\n          />\n        </svg>\n      </IconBase>\n    );\n  }\n);\n", "import { useTheme } from '../../theme.tsx';\nimport IconBase, { IconProps } from './IconBase.tsx';\n\nfunction IconFilter({ fill, className }: IconProps) {\n  const theme = useTheme();\n  const fillColor = fill || theme.background.text;\n  return (\n    <IconBase size=\"small\" className={className}>\n      <svg\n        width=\"16\"\n        height=\"16\"\n        viewBox=\"0 0 16 16\"\n        fill=\"none\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <path\n          d=\"M2.79775 15.6405C2.70296 15.6386 2.61259 15.6001 2.54555 15.5331C2.47852 15.4661 2.44004 15.3757 2.4382 15.2809V0.719103C2.4382 0.623744 2.47608 0.532285 2.54351 0.464857C2.61094 0.397428 2.70239 0.359552 2.79775 0.359552C2.89311 0.359552 2.98458 0.397428 3.052 0.464857C3.11943 0.532285 3.1573 0.623744 3.1573 0.719103V15.2809C3.1573 15.3763 3.11943 15.4677 3.052 15.5351C2.98458 15.6026 2.89311 15.6405 2.79775 15.6405Z\"\n          fill={fillColor}\n        />\n        <path\n          d=\"M2.79775 16C2.60703 16 2.42413 15.9242 2.28928 15.7894C2.15442 15.6545 2.07865 15.4716 2.07865 15.2809V0.719102C2.07865 0.528385 2.15442 0.345478 2.28928 0.21062C2.42413 0.0757626 2.60703 9.53674e-07 2.79775 9.53674e-07C2.98846 9.53674e-07 3.17138 0.0757626 3.30624 0.21062C3.4411 0.345478 3.51685 0.528385 3.51685 0.719102V15.2809C3.51685 15.4716 3.4411 15.6545 3.30624 15.7894C3.17138 15.9242 2.98846 16 2.79775 16Z\"\n          fill={fillColor}\n        />\n        <path\n          d=\"M8.21978 15.6405C8.12442 15.6405 8.03297 15.6026 7.96554 15.5351C7.89811 15.4677 7.86022 15.3763 7.86022 15.2809V0.719103C7.86022 0.623744 7.89811 0.532285 7.96554 0.464857C8.03297 0.397428 8.12442 0.359552 8.21978 0.359552C8.31513 0.359552 8.40658 0.397428 8.47401 0.464857C8.54144 0.532285 8.57933 0.623744 8.57933 0.719103V15.2809C8.57748 15.3757 8.539 15.4661 8.47197 15.5331C8.40494 15.6001 8.31456 15.6386 8.21978 15.6405V15.6405Z\"\n          fill={fillColor}\n        />\n        <path\n          d=\"M8.21978 16C8.02906 16 7.84616 15.9242 7.7113 15.7894C7.57645 15.6545 7.50067 15.4716 7.50067 15.2809V0.719102C7.50067 0.528385 7.57645 0.345478 7.7113 0.21062C7.84616 0.0757626 8.02906 9.53674e-07 8.21978 9.53674e-07C8.41049 9.53674e-07 8.59339 0.0757626 8.72825 0.21062C8.8631 0.345478 8.93888 0.528385 8.93888 0.719102V15.2809C8.93888 15.4716 8.8631 15.6545 8.72825 15.7894C8.59339 15.9242 8.41049 16 8.21978 16Z\"\n          fill={fillColor}\n        />\n        <path\n          d=\"M13.6346 15.6405C13.5398 15.6386 13.4494 15.6001 13.3824 15.5331C13.3154 15.4661 13.2769 15.3757 13.2751 15.2809V0.719103C13.2751 0.623744 13.3129 0.532285 13.3804 0.464857C13.4478 0.397428 13.5392 0.359552 13.6346 0.359552C13.73 0.359552 13.8214 0.397428 13.8888 0.464857C13.9563 0.532285 13.9942 0.623744 13.9942 0.719103V15.2809C13.9942 15.3763 13.9563 15.4677 13.8888 15.5351C13.8214 15.6026 13.73 15.6405 13.6346 15.6405Z\"\n          fill={fillColor}\n        />\n        <path\n          d=\"M13.6346 16C13.4439 16 13.261 15.9242 13.1261 15.7894C12.9913 15.6545 12.9155 15.4716 12.9155 15.2809V0.719102C12.9155 0.528385 12.9913 0.345478 13.1261 0.21062C13.261 0.0757626 13.4439 9.53674e-07 13.6346 9.53674e-07C13.8253 9.53674e-07 14.0082 0.0757626 14.1431 0.21062C14.278 0.345478 14.3537 0.528385 14.3537 0.719102V15.2809C14.3537 15.4716 14.278 15.6545 14.1431 15.7894C14.0082 15.9242 13.8253 16 13.6346 16Z\"\n          fill={fillColor}\n        />\n        <path\n          d=\"M2.79775 14.0225C3.79062 14.0225 4.59551 13.2176 4.59551 12.2247C4.59551 11.2318 3.79062 10.427 2.79775 10.427C1.80488 10.427 1 11.2318 1 12.2247C1 13.2176 1.80488 14.0225 2.79775 14.0225Z\"\n          fill={fillColor}\n        />\n        <path\n          d=\"M8.21258 6.46472C9.20546 6.46472 10.0103 5.65984 10.0103 4.66697C10.0103 3.67409 9.20546 2.86921 8.21258 2.86921C7.21971 2.86921 6.41483 3.67409 6.41483 4.66697C6.41483 5.65984 7.21971 6.46472 8.21258 6.46472Z\"\n          fill={fillColor}\n        />\n        <path\n          d=\"M13.6346 10.8944C14.6275 10.8944 15.4324 10.0895 15.4324 9.09663C15.4324 8.10376 14.6275 7.29888 13.6346 7.29888C12.6417 7.29888 11.8369 8.10376 11.8369 9.09663C11.8369 10.0895 12.6417 10.8944 13.6346 10.8944Z\"\n          fill={fillColor}\n        />\n      </svg>\n    </IconBase>\n  );\n}\n\nexport default IconFilter;\n", "import React from 'https://esm.sh/react@18.2.0';\nimport IconBase, { IconProps } from './IconBase.tsx';\nimport { makeStyles, cn } from '../../css-objects/index.ts';\n\nimport { styleguide } from '../../styleguide.ts';\nimport { useTheme } from '../../theme.tsx';\n\nconst useMenuStyles = makeStyles(\n  {\n    path: {\n      ...styleguide.transition.standard,\n      transitionProperty: 'd',\n    },\n  },\n  'IconMenu_e6eeaa'\n);\n\nexport interface IconMenuProps extends IconProps {\n  isExpanded?: boolean;\n}\n\nexport const IconMenu = ({\n  fill,\n  className,\n  isExpanded = false,\n}: IconMenuProps) => {\n  const styles = useMenuStyles();\n  const theme = useTheme();\n  if (!fill) {\n    fill = theme.background.text;\n  }\n  const pathCommands = isExpanded\n    ? [\n        'M 4.8,6.649',\n        'H 18,4.8',\n        'z',\n        'M 0,12',\n        'h 18',\n        'H 0',\n        'z',\n        'M 0 1',\n        'h 18',\n        'H 0',\n        'z',\n      ]\n    : [\n        'M 0,6.649',\n        'H 13.2,4.8',\n        'z',\n        'M 0,12',\n        'h 18',\n        'H 0',\n        'z',\n        'M 0 1',\n        'h 18',\n        'H 0',\n        'z',\n      ];\n  return (\n    <IconBase size=\"big\" className={className}>\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"18\"\n        height=\"13\"\n        viewBox=\"0 0 18 13\"\n      >\n        <path\n          className={cn(styles.path)}\n          fill=\"none\"\n          fillRule=\"evenodd\"\n          stroke={fill}\n          strokeWidth=\"2\"\n          d={pathCommands.join(' ')}\n        />\n      </svg>\n    </IconBase>\n  );\n};\n\nexport default IconMenu;\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { useTheme } from '../../theme.tsx';\nimport IconBase from './IconBase.tsx';\n\ninterface IconProps {\n  fill?: string;\n  className?: string;\n}\nfunction IconNotifications({ fill, className }: IconProps) {\n  const theme = useTheme();\n\n  return (\n    <IconBase size=\"small\" className={className}>\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"12\"\n        height=\"12\"\n        viewBox=\"0 0 12 12\"\n      >\n        <path\n          fill={fill || theme.background.text}\n          fillRule=\"evenodd\"\n          d=\"M11.647 8.03h-.396a.702.702 0 0 1-.681-.521 10.777 10.777 0 0 1-.335-2.7c0-1.628-.586-3.523-3.136-3.99A.357.357 0 0 1 6.8.473v-.12A.353.353 0 0 0 6.448 0h-.706a.353.353 0 0 0-.353.353v.121a.35.35 0 0 1-.293.342C2.53 1.278 1.94 3.177 1.94 4.81c0 1.131-.171 2.063-.337 2.7a.702.702 0 0 1-.681.52h-.57A.353.353 0 0 0 0 8.382v.706c0 .195.158.353.353.353H3.08c.167 0 .314.117.344.282C3.663 11.019 4.727 12 6 12c1.273 0 2.337-.98 2.575-2.277a.348.348 0 0 1 .344-.282h2.728A.353.353 0 0 0 12 9.088v-.706a.353.353 0 0 0-.353-.353zM3.353 4.808c0-1.804.824-2.617 2.735-2.685 1.912.068 2.736.88 2.736 2.685 0 1.125.148 2.074.315 2.786a.352.352 0 0 1-.343.434H3.38a.352.352 0 0 1-.343-.434c.166-.712.315-1.661.315-2.786zM6 10.589c-.591 0-1.083-.496-1.19-1.148h2.38c-.107.652-.599 1.147-1.19 1.147z\"\n        />\n      </svg>\n    </IconBase>\n  );\n}\n\nexport default IconNotifications;\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { useTheme } from '../../theme.tsx';\nimport IconBase, { IconProps } from './IconBase.tsx';\n\nfunction IconSearch({ fill, className }: IconProps) {\n  const theme = useTheme();\n  return (\n    <IconBase size=\"small\" className={className}>\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n        width=\"13\"\n        height=\"13\"\n        viewBox=\"0 0 13 13\"\n      >\n        <defs>\n          <path\n            id=\"tfXusaWMJq0N0hr3UpoO\"\n            d=\"M9.96 10.764c-1.885 1.72-4.756 1.645-6.554-.228-1.875-1.953-1.875-5.119 0-7.072a4.665 4.665 0 0 1 6.788 0c1.642 1.71 1.846 4.352.611 6.294l3.688 3.842-.905.942-3.628-3.778zM9.29 9.593c1.375-1.432 1.375-3.754 0-5.186a3.421 3.421 0 0 0-4.978 0c-1.375 1.432-1.375 3.754 0 5.186a3.421 3.421 0 0 0 4.978 0z\"\n          />\n        </defs>\n        <use\n          fill={fill || theme.background.text}\n          fillRule=\"nonzero\"\n          transform=\"translate(-2 -2)\"\n          xlinkHref=\"#tfXusaWMJq0N0hr3UpoO\"\n        />\n      </svg>\n    </IconBase>\n  );\n}\n\nexport default IconSearch;\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { useTheme } from '../../theme.tsx';\nimport IconBase, { IconProps } from './IconBase.tsx';\n\nfunction IconSettings({ fill, className }: IconProps) {\n  const theme = useTheme();\n  return (\n    <IconBase size=\"small\" className={className}>\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"13\"\n        height=\"13\"\n        viewBox=\"0 0 13 13\"\n      >\n        <path\n          fill={fill || theme.background.text}\n          fillRule=\"nonzero\"\n          d=\"M9.215 9.05a1.81 1.81 0 0 0-1.744 1.317H0v.987h7.47a1.81 1.81 0 0 0 3.49 0H13v-.987h-2.04a1.81 1.81 0 0 0-1.745-1.316zm0 2.634a.823.823 0 1 1 0-1.646.823.823 0 0 1 0 1.646zM9.215 0a1.81 1.81 0 0 1 1.744 1.316H13v.988h-2.04a1.81 1.81 0 0 1-3.49 0H0v-.988h7.47A1.81 1.81 0 0 1 9.216 0zm0 2.633a.823.823 0 1 0 0-1.646.823.823 0 0 0 0 1.646zm-5.43 1.892a1.81 1.81 0 0 1 1.744 1.317H13v.987H5.53a1.81 1.81 0 0 1-3.49 0H0v-.987h2.04a1.81 1.81 0 0 1 1.745-1.317zm0 2.633a.823.823 0 1 0 0-1.645.823.823 0 0 0 0 1.645z\"\n        />\n      </svg>\n    </IconBase>\n  );\n}\nexport default IconSettings;\n", "import IconBase from './IconBase.tsx';\n\nconst IconTag = ({ fill = '#9CB2CD' }) => (\n  <IconBase size=\"big\">\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path fill=\"transparent\" d=\"M0 0h24v24H0z\" />\n        <path\n          fill={fill}\n          d=\"M16.789 10.899l-.699 3.283h2.793v1.683h-3.132L14.874 20h-1.716l.878-4.135H9.827L8.95 20H7.234l.878-4.135H5v-1.683h3.45L9.15 10.9H6.137V9.196h3.371L10.386 5H12.1l-.878 4.196h4.21L16.31 5h1.715l-.877 4.196H20v1.703h-3.211zm-1.716 0h-4.209l-.698 3.283h4.209l.698-3.283z\"\n        />\n      </g>\n    </svg>\n  </IconBase>\n);\n\nexport default IconTag;\n", "import IconBase, { IconProps } from './IconBase.tsx';\n\nconst IconAlignCenter = ({ fill = '#CAC9D2', className }: IconProps) => (\n  <IconBase size=\"small\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"8\"\n      height=\"8\"\n      viewBox=\"0 0 8 8\"\n    >\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path d=\"M-4-4h16v16H-4z\" />\n        <path\n          fill={fill}\n          d=\"M0 7.111V8h8v-.889H0zm0-1.778v.89h8v-.89H0zm0-1.777v.888h8v-.888H0zm0-1.778h8v.889H0v-.89zM0 0h8v.889H0V0z\"\n        />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconAlignCenter;\n", "import React from 'https://esm.sh/react@18.2.0';\nimport IconBase, { IconProps } from './IconBase.tsx';\n\nconst IconAlignLeft = ({ fill = '#CAC9D2', className }: IconProps) => (\n  <IconBase size=\"small\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 8 8\"\n    >\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path d=\"M-4-4h16v16H-4z\" />\n        <path\n          fill={fill}\n          d=\"M0 6.4v.8h5.6v-.8H0zm0-1.6v.8h8v-.8H0zm0-1.6V4h7.2v-.8H0zm0-1.6h8v.8H0v-.8zM0 0h4.8v.8H0V0z\"\n        />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconAlignLeft;\n", "import IconBase, { IconProps } from './IconBase.tsx';\n\nconst IconAlignRight = ({ fill = '#CAC9D2', className }: IconProps) => (\n  <IconBase size=\"small\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"8\"\n      height=\"8\"\n      viewBox=\"0 0 8 8\"\n    >\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path d=\"M12-4H-4v16h16z\" />\n        <path\n          fill={fill}\n          d=\"M8 7.111H2.4V8H8v-.889zm0-1.778H0v.89h8v-.89zm0-1.777H.8v.888H8v-.888zm0-1.778H0v.889h8v-.89zM8 0H3.2v.889H8V0z\"\n        />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconAlignRight;\n", "import IconBase, { IconProps } from './IconBase.tsx';\n\nconst IconBold = ({ fill = '#FFF', className = '' }: IconProps) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path fill=\"transparent\" d=\"M0 0h24v24H0z\" />\n        <path\n          fill={fill}\n          d=\"M8 17V7h3.604c.55 0 1.059.038 1.527.115.469.077.878.212 1.229.406.35.195.625.45.824.767.2.317.299.716.299 1.197a2.558 2.558 0 0 1-.372 1.304 2.405 2.405 0 0 1-.428.52 1.57 1.57 0 0 1-.574.338v.062c.27.06.517.156.744.283.226.128.425.29.598.483.172.195.307.422.404.683.097.26.145.56.145.897 0 .511-.105.951-.315 1.32-.21.367-.501.672-.873.912s-.805.419-1.3.537a6.92 6.92 0 0 1-1.6.176H8zm2.376-5.997h1.115c.582 0 1.005-.107 1.269-.322.264-.215.396-.501.396-.859 0-.388-.135-.665-.404-.828-.27-.164-.685-.246-1.245-.246h-1.131v2.255zm0 4.249h1.341c1.304 0 1.956-.45 1.956-1.35 0-.44-.162-.754-.485-.943-.323-.19-.814-.284-1.47-.284h-1.342v2.577z\"\n        />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconBold;\n", "import IconBase, { IconProps } from './IconBase.tsx';\n\nconst IconBulletList = ({ fill = '#FFF', className }: IconProps) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path fill=\"transparent\" d=\"M0 0h24v24H0z\" />\n        <path\n          fill={fill}\n          d=\"M8.4 15.889H18V17H8.4v-1.111zm0-2.222H18v1.11H8.4v-1.11zm0-2.223H18v1.112H8.4v-1.112zm0-2.222H18v1.111H8.4v-1.11zM8.4 7H18v1.111H8.4V7zM6 15.889h1.2V17H6v-1.111zm0-2.222h1.2v1.11H6v-1.11zm0-2.223h1.2v1.112H6v-1.112zm0-2.222h1.2v1.111H6v-1.11zM6 7h1.2v1.111H6V7z\"\n        />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconBulletList;\n", "import IconBase from './IconBase.tsx';\n\nconst IconItalic = ({ fill = '#FFF', className = '' }) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path fill=\"transparent\" d=\"M0 0h24v24H0z\" />\n        <path fill={fill} d=\"M9 17l3.358-10H14l-3.358 10z\" />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconItalic;\n", "import React from 'https://esm.sh/react@18.2.0';\nimport IconBase from './IconBase.tsx';\n\ninterface IconLinkProps {\n  fill?: string;\n  className?: string;\n  width?: string;\n  height?: string;\n}\nconst IconLink = ({\n  fill = '#CAC9D2',\n  className,\n  width = '11',\n  height = '6',\n}: IconLinkProps) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width={width}\n      height={height}\n      viewBox=\"0 0 11 6\"\n    >\n      <g fill=\"none\" fillRule=\"nonzero\">\n        <path d=\"M14-5H-2v16h16z\" />\n        <path\n          fill={fill}\n          d=\"M5 4.286h1.714a.428.428 0 1 0 0-.857H5a1.287 1.287 0 0 1-1.286-1.286c0-.709.577-1.286 1.286-1.286h3.857c.709 0 1.286.577 1.286 1.286 0 .408-.199.797-.533 1.04a.43.43 0 0 0 .505.693A2.15 2.15 0 0 0 11 2.143 2.145 2.145 0 0 0 8.857 0H5a2.145 2.145 0 0 0-2.143 2.143c0 1.181.961 2.143 2.143 2.143zM2.857 6h3.857a2.145 2.145 0 0 0 2.143-2.143 2.145 2.145 0 0 0-2.143-2.143H5a.428.428 0 1 0 0 .857h1.714c.71 0 1.286.577 1.286 1.286 0 .709-.577 1.286-1.286 1.286H2.857a1.287 1.287 0 0 1-1.286-1.286c0-.408.2-.797.533-1.04a.429.429 0 0 0-.504-.693 2.15 2.15 0 0 0-.886 1.733C.714 5.04 1.676 6 2.857 6z\"\n        />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconLink;\n", "import IconBase from './IconBase.tsx';\n\nconst IconNumberList = ({ fill = '#FFF', className = '' }) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path fill=\"transparent\" d=\"M0 0h24v24H0z\" />\n        <path\n          fill={fill}\n          d=\"M8.544 15.713h9.6v1.017h-9.6v-1.017zm0-2.034h9.6v1.017h-9.6V13.68zm0-2.034h9.6v1.017h-9.6v-1.017zm0-2.033h9.6v1.016h-9.6V9.612zm0-2.034h9.6v1.017h-9.6V7.578zm-3.37 1.601v-.408h.5v-1.26h-.431V7.2c.125-.023.232-.05.319-.082s.171-.071.253-.117h.392v1.771h.431v.408H5.174zm-.12 3.89v-.288c.148-.13.282-.252.404-.366.122-.113.228-.22.316-.319.088-.1.157-.192.206-.278a.493.493 0 0 0 .075-.245c0-.108-.03-.19-.087-.246a.33.33 0 0 0-.24-.084.388.388 0 0 0-.224.067 1.22 1.22 0 0 0-.185.156l-.29-.27c.114-.115.23-.202.348-.26a.95.95 0 0 1 .424-.087c.113 0 .217.016.31.05.093.032.173.08.24.14.068.06.12.133.157.218a.717.717 0 0 1-.008.565c-.04.094-.096.19-.165.284-.068.095-.147.19-.235.285-.088.095-.18.188-.274.28a5.2 5.2 0 0 1 .194-.019c.071-.006.135-.008.19-.008h.464v.425h-1.62zM5.801 17c-.189 0-.348-.028-.478-.084A.91.91 0 0 1 5 16.69l.246-.32c.07.065.147.118.23.159a.61.61 0 0 0 .274.062.487.487 0 0 0 .272-.067.215.215 0 0 0 .101-.19.305.305 0 0 0-.027-.131.223.223 0 0 0-.096-.098.61.61 0 0 0-.188-.062 1.735 1.735 0 0 0-.308-.022v-.357c.104 0 .19-.007.259-.02a.502.502 0 0 0 .167-.06.24.24 0 0 0 .09-.093.256.256 0 0 0 .027-.119.223.223 0 0 0-.072-.177c-.048-.042-.119-.063-.21-.063a.478.478 0 0 0-.223.051 1.205 1.205 0 0 0-.209.141l-.268-.309c.107-.087.218-.155.335-.204a.997.997 0 0 1 .39-.074c.118 0 .227.013.324.04a.73.73 0 0 1 .25.116.536.536 0 0 1 .22.441.435.435 0 0 1-.1.29.718.718 0 0 1-.284.194v.014a.71.71 0 0 1 .327.187.473.473 0 0 1 .13.345c0 .1-.024.19-.07.27a.62.62 0 0 1-.185.199.882.882 0 0 1-.271.123A1.237 1.237 0 0 1 5.8 17z\"\n        />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconNumberList;\n", "import React from 'https://esm.sh/react@18.2.0';\nimport IconBase from './IconBase.tsx';\n\nconst IconStrikethrough = ({ fill = '#FFF', className = '' }) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path fill=\"transparent\" d=\"M0 0h24v24H0z\" />\n        <path\n          fill={fill}\n          d=\"M12.092 13.034H8v-.67h2.552l-.19-.084a4.535 4.535 0 0 1-.697-.368 3.057 3.057 0 0 1-.624-.531 2.46 2.46 0 0 1-.447-.723 2.48 2.48 0 0 1-.169-.944c0-.384.081-.74.242-1.07a2.71 2.71 0 0 1 .668-.862 3.08 3.08 0 0 1 1.019-.576A3.929 3.929 0 0 1 11.652 7c.557 0 1.095.11 1.613.332.519.221.963.519 1.335.892l-.865 1.092a4.27 4.27 0 0 0-.968-.605 2.72 2.72 0 0 0-1.115-.221c-.46 0-.826.1-1.1.302a.978.978 0 0 0-.41.833c0 .187.04.347.124.48.083.132.196.25.337.354.142.103.306.196.492.28.185.084.376.165.572.243l1.305.546c.284.118.543.256.777.413.187.125.354.266.5.422H16v.67h-1.306a2.748 2.748 0 0 1 .214 1.105c0 .394-.078.763-.235 1.107a2.655 2.655 0 0 1-.682.907c-.298.26-.66.467-1.085.62a4.265 4.265 0 0 1-1.445.228 4.897 4.897 0 0 1-1.87-.369A4.877 4.877 0 0 1 8 15.584l.997-1.165c.343.324.734.587 1.174.789.44.202.88.302 1.32.302.547 0 .963-.113 1.246-.339.284-.226.426-.526.426-.9 0-.196-.037-.363-.11-.501a1.134 1.134 0 0 0-.308-.361 2.65 2.65 0 0 0-.47-.288c-.059-.03-.12-.058-.183-.087z\"\n        />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconStrikethrough;\n", "import IconBase from './IconBase.tsx';\n\nconst IconTask = ({ fill = '#CFCED5', className = '' }) => {\n  return (\n    <IconBase size=\"big\" className={className}>\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"24\"\n        height=\"24\"\n        viewBox=\"0 0 24 24\"\n      >\n        <g fill=\"none\" fillRule=\"evenodd\">\n          <path fill=\"transparent\" d=\"M0 0h24v24H0z\" />\n          <path\n            fill={fill}\n            d=\"M6 6h12v12H6V6zm10.883 1.153h-9.73v9.73h9.73v-9.73zm-6.162 6.054L15.8 8.09v2.739l-5.08 5.08a162.95 162.95 0 0 1-2.523-2.486v-2.702l2.523 2.486z\"\n          />\n        </g>\n      </svg>\n    </IconBase>\n  );\n};\nexport default IconTask;\n", "import IconBase from './IconBase.tsx';\n\nconst IconUnderline = ({ fill = '#FFF', className = '' }) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path fill=\"transparent\" d=\"M0 0h24v24H0z\" />\n        <path\n          fill={fill}\n          d=\"M11.828 16.452c-1.242 0-2.19-.356-2.845-1.067C8.328 14.673 8 13.539 8 11.982V7h2.17v5.196c0 .91.142 1.547.426 1.907.284.361.694.541 1.232.541s.953-.18 1.247-.54c.293-.361.44-.997.44-1.908V7h2.082v4.982c0 1.557-.32 2.69-.96 3.403-.64.711-1.577 1.067-2.809 1.067zm-3.828.9h8V18H8v-.647z\"\n        />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconUnderline;\n", "import IconBase, { IconProps } from './IconBase.tsx';\n\nconst IconDropDown = ({ fill = '#CAC9D2', className }: IconProps) => (\n  <IconBase size=\"small\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"6\"\n      height=\"4\"\n      viewBox=\"0 0 6 4\"\n    >\n      <g fill=\"none\" fillRule=\"nonzero\">\n        <path d=\"M-5-6h16v16H-5z\" />\n        <path fill={fill} d=\"M3 3.5L6 .666 5.295 0 3 2.163.705 0 0 .666z\" />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconDropDown;\n", "import IconBase, { IconProps } from './IconBase.tsx';\n\nexport const IconGoogle = ({ className }: IconProps) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      viewBox=\"0 0 46 46\"\n      version=\"1.1\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n    >\n      <defs>\n        <rect id=\"path-2\" x=\"0\" y=\"0\" width=\"40\" height=\"40\" rx=\"2\" />\n      </defs>\n      <g\n        id=\"Google-Button\"\n        stroke=\"none\"\n        strokeWidth=\"1\"\n        fill=\"none\"\n        fillRule=\"evenodd\"\n      >\n        <g id=\"9-PATCH\" transform=\"translate(-608.000000, -160.000000)\" />\n        <g\n          id=\"btn_google_light_normal\"\n          transform=\"translate(-1.000000, -1.000000)\"\n        >\n          <g\n            id=\"button\"\n            transform=\"translate(4.000000, 4.000000)\"\n            filter=\"url(#filter-1)\"\n          >\n            <g id=\"button-bg\">\n              <use fill=\"#FFFFFF\" fillRule=\"evenodd\" xlinkHref=\"#path-2\" />\n              <use fill=\"none\" xlinkHref=\"#path-2\" />\n              <use fill=\"none\" xlinkHref=\"#path-2\" />\n              <use fill=\"none\" xlinkHref=\"#path-2\" />\n            </g>\n          </g>\n          <g id=\"logo_googleg_48dp\" transform=\"translate(15.000000, 15.000000)\">\n            <path\n              d=\"M17.64,9.20454545 C17.64,8.56636364 17.5827273,7.95272727 17.4763636,7.36363636 L9,7.36363636 L9,10.845 L13.8436364,10.845 C13.635,11.97 13.0009091,12.9231818 12.0477273,13.5613636 L12.0477273,15.8195455 L14.9563636,15.8195455 C16.6581818,14.2527273 17.64,11.9454545 17.64,9.20454545 L17.64,9.20454545 Z\"\n              id=\"Shape\"\n              fill=\"#4285F4\"\n            />\n            <path\n              d=\"M9,18 C11.43,18 13.4672727,17.1940909 14.9563636,15.8195455 L12.0477273,13.5613636 C11.2418182,14.1013636 10.2109091,14.4204545 9,14.4204545 C6.65590909,14.4204545 4.67181818,12.8372727 3.96409091,10.71 L0.957272727,10.71 L0.957272727,13.0418182 C2.43818182,15.9831818 5.48181818,18 9,18 L9,18 Z\"\n              id=\"Shape\"\n              fill=\"#34A853\"\n            />\n            <path\n              d=\"M3.96409091,10.71 C3.78409091,10.17 3.68181818,9.59318182 3.68181818,9 C3.68181818,8.40681818 3.78409091,7.83 3.96409091,7.29 L3.96409091,4.95818182 L0.957272727,4.95818182 C0.347727273,6.17318182 0,7.54772727 0,9 C0,10.4522727 0.347727273,11.8268182 0.957272727,13.0418182 L3.96409091,10.71 L3.96409091,10.71 Z\"\n              id=\"Shape\"\n              fill=\"#FBBC05\"\n            />\n            <path\n              d=\"M9,3.57954545 C10.3213636,3.57954545 11.5077273,4.03363636 12.4404545,4.92545455 L15.0218182,2.34409091 C13.4631818,0.891818182 11.4259091,0 9,0 C5.48181818,0 2.43818182,2.01681818 0.957272727,4.95818182 L3.96409091,7.29 C4.67181818,5.16272727 6.65590909,3.57954545 9,3.57954545 L9,3.57954545 Z\"\n              id=\"Shape\"\n              fill=\"#EA4335\"\n            />\n            <path d=\"M0,0 L18,0 L18,18 L0,18 L0,0 Z\" id=\"Shape\" />\n          </g>\n          <g id=\"handles_square\" />\n        </g>\n      </g>\n    </svg>\n  </IconBase>\n);\n\nexport default IconGoogle;\n", "import IconBase from './IconBase.tsx';\n\nconst IconNote = ({ fill = '#CAC9D2', className = '' }) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <defs>\n        <path\n          id=\"N2VtB40Gt1V1kVaKakJ9\"\n          d=\"M14.625 0A3.375 3.375 0 0 1 18 3.375v8.068a2.25 2.25 0 0 1-.659 1.591l-4.307 4.307a2.25 2.25 0 0 1-1.591.659H3.375A3.375 3.375 0 0 1 0 14.625V3.375A3.375 3.375 0 0 1 3.375 0h11.25zm-2.25 16.409l4.034-4.034H13.5c-.621 0-1.124.504-1.125 1.125v2.909zM16 11V4a2.002 2.002 0 0 0-2-2H4a2.002 2.002 0 0 0-2 2v10a2.002 2.002 0 0 0 2 2h7v-3a2 2 0 0 1 2-2h3zm-2.625-4c.345 0 .625.224.625.5s-.28.5-.625.5h-8.75C4.28 8 4 7.776 4 7.5s.28-.5.625-.5h8.75zm0-3c.345 0 .625.224.625.5s-.28.5-.625.5h-8.75C4.28 5 4 4.776 4 4.5s.28-.5.625-.5h8.75z\"\n        />\n      </defs>\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path fill=\"transparent\" d=\"M0 0h24v24H0z\" />\n        <g transform=\"translate(3 3)\">\n          <mask id=\"2dLDbWdUYgX1cqm5VXkb\" fill={fill}>\n            <use xlinkHref=\"#N2VtB40Gt1V1kVaKakJ9\" />\n          </mask>\n          <use\n            fill={fill}\n            fillRule=\"nonzero\"\n            xlinkHref=\"#N2VtB40Gt1V1kVaKakJ9\"\n          />\n          <path\n            fill={fill}\n            d=\"M-3-3h24v24H-3z\"\n            mask=\"url(#2dLDbWdUYgX1cqm5VXkb)\"\n          />\n        </g>\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconNote;\n", "import IconBase, { IconProps } from './IconBase.tsx';\n\nconst IconDropDownArrow = ({ fill = '#11082B', className = '' }: IconProps) => (\n  <IconBase size=\"small\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path fill=\"transparent\" d=\"M0 0h24v24H0z\" />\n        <path\n          fill={fill}\n          d=\"M12 16l-6-5.668L7.41 9 12 13.327 16.59 9 18 10.332z\"\n        />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconDropDownArrow;\n", "import React from 'https://esm.sh/react@18.2.0';\nimport IconBase from './IconBase.tsx';\n\nconst IconTasksTick = ({ fill = '#FFF', className = '' }) => (\n  <IconBase size=\"small\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <defs>\n        <path\n          id=\"CmD7fCLyboAxfO0lGjMH\"\n          d=\"M5 11L0 6l1.41-1.41L5 8.17 12.59.58 14 2z\"\n        />\n      </defs>\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path fill=\"transparent\" d=\"M0 0h24v24H0z\" />\n        <g transform=\"translate(5 6)\">\n          <mask id=\"mdKKrzUnlCliP8Ta5DAN\" fill={fill}>\n            <use xlinkHref=\"#CmD7fCLyboAxfO0lGjMH\" />\n          </mask>\n          <path\n            fill={fill}\n            d=\"M-3-4h20v20H-3z\"\n            mask=\"url(#mdKKrzUnlCliP8Ta5DAN)\"\n          />\n        </g>\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconTasksTick;\n", "import React from 'https://esm.sh/react@18.2.0';\nimport IconBase from './IconBase.tsx';\n\nexport interface IconOverflowProps {\n  fill?: string;\n  className?: string;\n}\nconst IconOverflow = ({ fill = '#C7C7C7', className }: IconOverflowProps) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path fill=\"transparent\" d=\"M0 0h24v24H0z\" />\n        <path\n          fill={fill}\n          d=\"M14 18.222c0 .982-.895 1.778-2 1.778s-2-.796-2-1.778.895-1.778 2-1.778 2 .796 2 1.778zM14 12c0 .982-.895 1.778-2 1.778s-2-.796-2-1.778.895-1.778 2-1.778 2 .796 2 1.778zm0-6.222c0 .982-.895 1.778-2 1.778s-2-.796-2-1.778S10.895 4 12 4s2 .796 2 1.778z\"\n        />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconOverflow;\n", "import React from 'https://esm.sh/react@18.2.0';\nimport IconBase from './IconBase.tsx';\n\ninterface IconCloseProps {\n  fill?: string;\n  className?: string;\n  size?: 'small' | 'big';\n}\nconst IconClose = ({\n  fill = '#D7E3F1',\n  className,\n  size = 'big',\n}: IconCloseProps) => (\n  <IconBase size={size} className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path fill=\"transparent\" d=\"M0 0h24v24H0z\" />\n        <path\n          fill={fill}\n          d=\"M12 10.769l4.514-4.514a.87.87 0 1 1 1.23 1.231L13.232 12l4.514 4.514a.87.87 0 0 1-1.231 1.231L12 13.231l-4.514 4.514a.87.87 0 0 1-1.23-1.231L10.768 12 6.255 7.486a.87.87 0 1 1 1.231-1.23L12 10.768z\"\n        />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconClose;\n", "import IconBase, { IconProps } from './IconBase.tsx';\n\nconst IconDelete = ({ fill = '#9CB2CD', className }: IconProps) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <path\n        fill={fill}\n        fillRule=\"evenodd\"\n        d=\"M18.667 5.533h-3.4C14.967 4.077 13.6 3 12 3c-1.6 0-2.967 1.077-3.267 2.533h-3.4C4.6 5.533 4 6.103 4 6.8v1.9c0 .697.6 1.267 1.333 1.267v9.5C5.333 20.86 6.533 22 8 22h8c1.467 0 2.667-1.14 2.667-2.533v-9.5C19.4 9.967 20 9.397 20 8.7V6.8c0-.697-.6-1.267-1.333-1.267zM12 4.267c.867 0 1.6.538 1.867 1.266h-3.734c.267-.728 1-1.266 1.867-1.266zm5.333 15.2c0 .696-.6 1.266-1.333 1.266H8c-.733 0-1.333-.57-1.333-1.266v-9.5h10.666v9.5zM18 8.7H5.333V6.8h13.334v1.9H18zm-8.667 9.817c-.366 0-.666-.285-.666-.634v-5.066c0-.349.3-.634.666-.634.367 0 .667.285.667.634v5.066c0 .349-.3.634-.667.634zm5.334 0c-.367 0-.667-.285-.667-.634v-5.066c0-.349.3-.634.667-.634.366 0 .666.285.666.634v5.066c0 .349-.3.634-.666.634z\"\n      />\n    </svg>\n  </IconBase>\n);\nexport default IconDelete;\n", "import IconBase, { IconProps } from './IconBase.tsx';\n\nconst IconEdit = ({ fill = '#9CB2CD', className }: IconProps) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <path\n        fill={fill}\n        fillRule=\"evenodd\"\n        d=\"M18.453 19.272h-.019v-7.663l1.724-1.748v9.66c0 .826-.663 1.479-1.478 1.479H5.478A1.473 1.473 0 0 1 4 19.521V6.654c0-.807.663-1.479 1.478-1.479h9.395l-1.724 1.748H5.724v12.349h12.729zm-7.032-8.1l5.8-5.88 2.518 2.552-5.8 5.88-2.518-2.553zm-1.625 1.647l.625-.634 2.52 2.535-.625.634a.538.538 0 0 1-.265.153l-2.274.557c-.397.077-.738-.269-.644-.653l.512-2.324a.621.621 0 0 1 .151-.268zm12.048-7.874a.55.55 0 0 1 0 .768l-1.118 1.133-2.52-2.554 1.118-1.134a.532.532 0 0 1 .758 0l1.762 1.787z\"\n      />\n    </svg>\n  </IconBase>\n);\nexport default IconEdit;\n", "import IconBase from './IconBase.tsx';\n\nconst IconViewNote = ({ fill = '#9CB2CD', className = '' }) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <defs>\n        <path\n          id=\"CbvZO8nhAkJkVgXgaqQa\"\n          d=\"M17.625 3A3.375 3.375 0 0 1 21 6.375v8.068a2.25 2.25 0 0 1-.659 1.591l-4.307 4.307a2.25 2.25 0 0 1-1.591.659H6.375A3.375 3.375 0 0 1 3 17.625V6.375A3.375 3.375 0 0 1 6.375 3h11.25zm-2.25 16.409l4.034-4.034H16.5c-.621 0-1.124.504-1.125 1.125v2.909zM19 14V7a2.002 2.002 0 0 0-2-2H7a2.002 2.002 0 0 0-2 2v10a2.002 2.002 0 0 0 2 2h7v-3a2 2 0 0 1 2-2h3zM7 7h7v7H7V7zm6.06.955H8v5.102h5.06V7.955zM9.91 11.04l2.339-2.29v1.226L9.911 12.25c-.415-.387-.746-.71-1.161-1.113v-1.21l1.161 1.113z\"\n        />\n      </defs>\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path fill=\"transparent\" d=\"M0 0h24v24H0z\" />\n        <use fill={fill} xlinkHref=\"#CbvZO8nhAkJkVgXgaqQa\" />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconViewNote;\n", "import IconBase from './IconBase.tsx';\n\nconst IconKeyboard = ({\n  fill = '#9CB2CD',\n  className = '',\n  pathClassName = '',\n}) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"32\"\n      height=\"32\"\n      viewBox=\"0 0 24 24\"\n    >\n      <path\n        className={pathClassName}\n        fill={fill}\n        fillRule=\"evenodd\"\n        d=\"M15.614 10.586v-.96c0-.17.133-.307.297-.307h.93c.163 0 .296.137.296.306v.961a.302.302 0 0 1-.297.306h-.929a.302.302 0 0 1-.297-.306zm1.292 1.576v.96c0 .17.133.307.297.307h.938a.302.302 0 0 0 .297-.306v-.961a.302.302 0 0 0-.297-.306h-.938a.302.302 0 0 0-.297.306zm-2.586 0v.96c0 .17.133.307.297.307h.932a.302.302 0 0 0 .297-.306v-.961a.302.302 0 0 0-.297-.306h-.932a.302.302 0 0 0-.297.306zm4.174-1.27h.932a.302.302 0 0 0 .297-.306v-.96a.302.302 0 0 0-.297-.307h-.932a.302.302 0 0 0-.297.306v.961c0 .17.133.306.297.306zm-.056 3.485h-.918a.302.302 0 0 0-.297.306v.958c0 .169.133.306.297.306h.918a.302.302 0 0 0 .296-.306v-.958a.302.302 0 0 0-.297-.306zm-5.113-3.485h.933a.302.302 0 0 0 .296-.306v-.96a.302.302 0 0 0-.296-.307h-.933a.302.302 0 0 0-.297.306v.961c0 .17.133.306.297.306zm2.672 3.485H9.038a.302.302 0 0 0-.296.306v.958c0 .169.132.306.296.306H16a.302.302 0 0 0 .297-.306v-.958a.302.302 0 0 0-.297-.306h-.003zm-8.52 0h-.915a.302.302 0 0 0-.296.306v.958c0 .169.133.306.296.306h.93a.302.302 0 0 0 .297-.306v-.958a.31.31 0 0 0-.092-.22.292.292 0 0 0-.217-.086h-.003zm-.915-2.215v.96c0 .17.133.307.297.307h.933a.302.302 0 0 0 .296-.306v-.961a.302.302 0 0 0-.296-.306h-.933a.302.302 0 0 0-.296.306zm-.994-1.27H6.5a.302.302 0 0 0 .297-.306v-.96a.302.302 0 0 0-.297-.307h-.926a.302.302 0 0 0-.297.306v.961c0 .17.133.306.297.306h-.006zm6.163 1.27v.96c0 .17.133.307.297.307h.932a.302.302 0 0 0 .297-.306v-.961a.302.302 0 0 0-.297-.306h-.926a.302.302 0 0 0-.297.306h-.006zM22 7.612v9.776a.603.603 0 0 1-.594.612H3.594A.603.603 0 0 1 3 17.388V7.612C3 7.274 3.266 7 3.594 7h17.812c.328 0 .594.274.594.612zm-1.188.612H4.188v8.552h16.625V8.224zM8.16 10.892h.929a.302.302 0 0 0 .297-.306v-.96a.302.302 0 0 0-.297-.307h-.93a.302.302 0 0 0-.296.306v.961c0 .17.133.306.297.306zm2.582 0h.933a.302.302 0 0 0 .297-.306v-.96a.302.302 0 0 0-.297-.307h-.933a.302.302 0 0 0-.296.306v.961c0 .17.133.306.296.306zm-1.588 1.27v.96c0 .17.133.307.297.307h.932a.302.302 0 0 0 .297-.306v-.961a.302.302 0 0 0-.297-.306h-.932a.302.302 0 0 0-.297.306z\"\n      />\n    </svg>\n  </IconBase>\n);\nexport default IconKeyboard;\n", "import React from 'https://esm.sh/react@18.2.0';\nimport IconBase from './IconBase.tsx';\n\ninterface IconBackProps {\n  fill?: string;\n  className?: string;\n}\nconst IconBack = ({ fill = '#D7E3F1', className }: IconBackProps) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path fill=\"transparent\" d=\"M0 0h24v24H0z\" />\n        <path\n          fill={fill}\n          d=\"M9 12l4.858-5L15 8.175 11.291 12 15 15.825 13.858 17z\"\n        />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconBack;\n", "import React from 'https://esm.sh/react@18.2.0';\nimport IconBase from './IconBase.tsx';\n\ninterface IconContactUsProps {\n  fill?: string;\n  className?: string;\n}\nconst IconContactUs = ({ fill = '#9CB2CD', className }: IconContactUsProps) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path fill=\"transparent\" d=\"M0 0h24v24H0z\" />\n        <path\n          fill={fill}\n          d=\"M18 7a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h11zm-7.147 4.859L7.611 16H17.5l-3.195-3.993-1.57 1.419-1.882-1.567zM7 8.65v6.508l3.084-3.939L7 8.65zm11 .023l-2.951 2.663L18 15.024V8.673zM17.252 8H7.781l4.927 4.102L17.252 8z\"\n        />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconContactUs;\n", "import IconBase, { IconProps } from './IconBase.tsx';\n\nconst IconCalendar = ({ fill = '#9CB2CD', className = '' }: IconProps) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <path\n        fill={fill}\n        fillRule=\"evenodd\"\n        d=\"M5 8.209v9.938C5 19.167 5.854 20 6.902 20h10.196C18.146 20 19 19.167 19 18.147V8.209c0-1.008-.827-1.824-1.854-1.847v1.82c0 .856-.712 1.55-1.59 1.55-.878 0-1.59-.694-1.59-1.55V6.36h-3.929v1.824c0 .855-.712 1.549-1.59 1.549-.878 0-1.59-.694-1.59-1.55V6.366C5.828 6.385 5 7.201 5 8.21zm12.729 4.057v5.88a.62.62 0 0 1-.63.612H6.901a.623.623 0 0 1-.63-.611v-5.881h11.457zM8.447 4c.353 0 .638.278.638.621V8.18a.629.629 0 0 1-.638.621.629.629 0 0 1-.637-.62V4.62c0-.343.285-.621.637-.621zm7.106 0c.352 0 .637.278.637.621V8.18a.629.629 0 0 1-.637.621.629.629 0 0 1-.638-.62V4.62c0-.343.285-.621.638-.621z\"\n      />\n    </svg>\n  </IconBase>\n);\nexport default IconCalendar;\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { brandLightTheme } from '../../theme.tsx';\nimport IconBase from './IconBase.tsx';\n\nconst IconSorting = ({\n  fill,\n  className,\n}: {\n  fill?: string;\n  className?: string;\n}) => {\n  fill = fill || brandLightTheme.colors.text;\n  return (\n    <IconBase size=\"small\" className={className}>\n      <svg\n        width=\"16\"\n        height=\"16\"\n        viewBox=\"0 0 16 16\"\n        fill=\"none\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n      >\n        <path\n          d=\"M3.32402 15.8304C3.17545 15.8308 3.03268 15.7727 2.92656 15.6688L0.333076 13.0887C0.280528 13.0367 0.238796 12.9748 0.210326 12.9066C0.181856 12.8384 0.167216 12.7652 0.167216 12.6913C0.167216 12.6174 0.181856 12.5442 0.210326 12.476C0.238796 12.4077 0.280528 12.3458 0.333076 12.2938C0.385646 12.2411 0.448102 12.1992 0.516883 12.1707C0.585663 12.1421 0.659416 12.1274 0.73389 12.1274C0.808364 12.1274 0.882096 12.1421 0.950877 12.1707C1.01966 12.1992 1.08213 12.2411 1.1347 12.2938L3.32402 14.4832L5.52006 12.2938C5.62636 12.1875 5.77054 12.1278 5.92087 12.1278C6.0712 12.1278 6.21538 12.1875 6.32168 12.2938C6.42799 12.4001 6.48771 12.5443 6.48771 12.6946C6.48771 12.845 6.42799 12.9892 6.32168 13.0955L3.72818 15.689C3.6196 15.7933 3.47464 15.8513 3.32402 15.8506V15.8304Z\"\n          fill={fill}\n        />\n        <path\n          d=\"M3.32402 15.9988C3.13062 15.9989 2.94469 15.9241 2.80531 15.79L0.211806 13.1965C0.0760352 13.058 0 12.8718 0 12.6778C0 12.4839 0.0760352 12.2976 0.211806 12.1591C0.279436 12.0903 0.36021 12.0358 0.44931 11.9987C0.538409 11.9617 0.634033 11.9429 0.730519 11.9436C0.82706 11.9426 0.9228 11.9611 1.01195 11.9982C1.10111 12.0352 1.18182 12.09 1.24921 12.1591L3.32402 14.2272L5.39881 12.1591C5.46651 12.0903 5.54726 12.0356 5.63631 11.9983C5.72536 11.961 5.82094 11.9417 5.9175 11.9417C6.01406 11.9417 6.10965 11.961 6.19871 11.9983C6.28776 12.0356 6.3685 12.0903 6.43621 12.1591C6.5736 12.2968 6.65077 12.4833 6.65077 12.6778C6.65077 12.8723 6.5736 13.0589 6.43621 13.1965L3.88313 15.7833C3.81058 15.8568 3.7232 15.9141 3.62679 15.9513C3.53039 15.9885 3.42718 16.0047 3.32402 15.9988V15.9988ZM0.730519 12.2804C0.679163 12.28 0.628257 12.29 0.580817 12.3096C0.533377 12.3293 0.490364 12.3583 0.454326 12.3949C0.41685 12.4319 0.387081 12.4759 0.36677 12.5245C0.34646 12.5731 0.336016 12.6252 0.336016 12.6778C0.336016 12.7305 0.34646 12.7826 0.36677 12.8311C0.387081 12.8797 0.41685 12.9238 0.454326 12.9607L3.04783 15.5475C3.12306 15.6195 3.2232 15.6598 3.32737 15.6598C3.43154 15.6598 3.5317 15.6195 3.60693 15.5475L6.20043 12.9607C6.27449 12.8852 6.31597 12.7836 6.31597 12.6778C6.31597 12.572 6.27449 12.4704 6.20043 12.3949C6.12488 12.3208 6.02329 12.2794 5.9175 12.2794C5.8117 12.2794 5.71014 12.3208 5.63458 12.3949L3.32402 14.7055L1.01343 12.4151C0.977867 12.3746 0.934448 12.3418 0.885812 12.3187C0.837175 12.2955 0.784347 12.2825 0.730519 12.2804V12.2804Z\"\n          fill={fill}\n        />\n        <path\n          d=\"M3.32402 15.4128C3.23469 15.4128 3.149 15.3773 3.08584 15.3141C3.02267 15.251 2.9872 15.1653 2.9872 15.076V0.673635C2.98893 0.584846 3.02495 0.500171 3.08775 0.437376C3.15054 0.37458 3.23523 0.338542 3.32402 0.336818C3.41335 0.336818 3.49901 0.372298 3.56218 0.435464C3.62535 0.49863 3.66084 0.584306 3.66084 0.673635V15.1096C3.66084 15.199 3.62535 15.2846 3.56218 15.3478C3.49901 15.411 3.41335 15.4465 3.32402 15.4465V15.4128Z\"\n          fill={fill}\n        />\n        <path\n          d=\"M3.32402 15.7833C3.14536 15.7833 2.97401 15.7123 2.84768 15.586C2.72134 15.4596 2.65038 15.2883 2.65038 15.1096V0.673635C2.65038 0.494976 2.72134 0.323634 2.84768 0.197303C2.97401 0.0709716 3.14536 0 3.32402 0C3.50268 0 3.67401 0.0709716 3.80034 0.197303C3.92667 0.323634 3.99765 0.494976 3.99765 0.673635V15.1096C3.99765 15.2883 3.92667 15.4596 3.80034 15.586C3.67401 15.7123 3.50268 15.7833 3.32402 15.7833Z\"\n          fill={fill}\n        />\n        <path\n          d=\"M15.1665 1.01045H8.09335C8.00402 1.01045 7.91835 0.974962 7.85519 0.911797C7.79202 0.848631 7.75653 0.762965 7.75653 0.673635C7.75653 0.584306 7.79202 0.49863 7.85519 0.435464C7.91835 0.372298 8.00402 0.336818 8.09335 0.336818H15.1665C15.2558 0.336818 15.3415 0.372298 15.4047 0.435464C15.4678 0.49863 15.5033 0.584306 15.5033 0.673635C15.5033 0.762965 15.4678 0.848631 15.4047 0.911797C15.3415 0.974962 15.2558 1.01045 15.1665 1.01045Z\"\n          fill={fill}\n        />\n        <path\n          d=\"M15.1665 1.34727H8.09335C7.91469 1.34727 7.74336 1.27629 7.61703 1.14996C7.49069 1.02363 7.41971 0.852295 7.41971 0.673635C7.41971 0.494976 7.49069 0.323634 7.61703 0.197303C7.74336 0.0709716 7.91469 0 8.09335 0H15.1665C15.3452 0 15.5165 0.0709716 15.6428 0.197303C15.7692 0.323634 15.8402 0.494976 15.8402 0.673635C15.8402 0.852295 15.7692 1.02363 15.6428 1.14996C15.5165 1.27629 15.3452 1.34727 15.1665 1.34727Z\"\n          fill={fill}\n        />\n        <path\n          d=\"M13.2197 5.89431H8.02598C7.94817 5.87867 7.87817 5.83657 7.82789 5.77517C7.7776 5.71377 7.75014 5.63686 7.75014 5.55749C7.75014 5.47813 7.7776 5.40121 7.82789 5.33981C7.87817 5.27841 7.94817 5.23631 8.02598 5.22067H13.2197C13.2929 5.24158 13.3573 5.28577 13.4031 5.34654C13.449 5.40731 13.4738 5.48137 13.4738 5.55749C13.4738 5.63362 13.449 5.70766 13.4031 5.76843C13.3573 5.82921 13.2929 5.8734 13.2197 5.89431V5.89431Z\"\n          fill={fill}\n        />\n        <path\n          d=\"M13.2197 6.23113H8.02598C7.84732 6.23113 7.67599 6.16014 7.54966 6.03381C7.42333 5.90748 7.35234 5.73615 7.35234 5.55749C7.35234 5.37883 7.42333 5.20749 7.54966 5.08116C7.67599 4.95483 7.84732 4.88386 8.02598 4.88386H13.2197C13.3984 4.88386 13.5697 4.95483 13.696 5.08116C13.8224 5.20749 13.8933 5.37883 13.8933 5.55749C13.8933 5.73615 13.8224 5.90748 13.696 6.03381C13.5697 6.16014 13.3984 6.23113 13.2197 6.23113Z\"\n          fill={fill}\n        />\n        <path\n          d=\"M11.8724 10.7782H8.02598C7.94611 10.768 7.87333 10.7272 7.82304 10.6643C7.77274 10.6015 7.74889 10.5215 7.75653 10.4413C7.74889 10.3612 7.77274 10.2812 7.82304 10.2184C7.87333 10.1555 7.94611 10.1147 8.02598 10.1045H11.8724C11.9518 10.1146 12.024 10.1557 12.0732 10.2188C12.1224 10.2819 12.1447 10.3619 12.1352 10.4413C12.1429 10.5205 12.12 10.5996 12.0711 10.6623C12.0222 10.7249 11.9511 10.7664 11.8724 10.7782Z\"\n          fill={fill}\n        />\n        <path\n          d=\"M11.8724 11.115H8.02598C7.84732 11.115 7.67599 11.044 7.54966 10.9177C7.42333 10.7913 7.35234 10.62 7.35234 10.4413C7.35234 10.2627 7.42333 10.0913 7.54966 9.96502C7.67599 9.83868 7.84732 9.76771 8.02598 9.76771H11.8724C12.0511 9.76771 12.2224 9.83868 12.3488 9.96502C12.4751 10.0913 12.5461 10.2627 12.5461 10.4413C12.5461 10.62 12.4751 10.7913 12.3488 10.9177C12.2224 11.044 12.0511 11.115 11.8724 11.115Z\"\n          fill={fill}\n        />\n        <path\n          d=\"M9.85153 15.6553H8.02598C7.94611 15.6451 7.87333 15.6043 7.82304 15.5415C7.77274 15.4786 7.74889 15.3986 7.75653 15.3185C7.74889 15.2383 7.77274 15.1583 7.82304 15.0955C7.87333 15.0326 7.94611 14.9918 8.02598 14.9816H9.85153C9.93017 14.9934 10.0013 15.0349 10.0502 15.0975C10.0991 15.1602 10.122 15.2393 10.1143 15.3185C10.1238 15.3979 10.1015 15.4779 10.0523 15.541C10.0031 15.6041 9.93091 15.6452 9.85153 15.6553V15.6553Z\"\n          fill={fill}\n        />\n        <path\n          d=\"M9.85153 15.9921H8.02598C7.84732 15.9921 7.67599 15.9211 7.54966 15.7948C7.42333 15.6685 7.35234 15.4971 7.35234 15.3185C7.35234 15.1398 7.42333 14.9685 7.54966 14.8421C7.67599 14.7158 7.84732 14.6448 8.02598 14.6448H9.85153C10.0302 14.6448 10.2015 14.7158 10.3279 14.8421C10.4542 14.9685 10.5252 15.1398 10.5252 15.3185C10.5252 15.4971 10.4542 15.6685 10.3279 15.7948C10.2015 15.9211 10.0302 15.9921 9.85153 15.9921Z\"\n          fill={fill}\n        />\n      </svg>\n    </IconBase>\n  );\n};\nexport default IconSorting;\n", "import IconBase from './IconBase.tsx';\n\nconst IconImage = ({ fill = '#9CB2CD', className }) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <defs>\n        <path\n          id=\"CYSJlDlJRPCX6cHjMw9V\"\n          d=\"M18.462 3A2.544 2.544 0 0 1 21 5.538v12.924A2.544 2.544 0 0 1 18.462 21H5.538A2.538 2.538 0 0 1 3 18.462V5.538C3 4.138 4.134 3 5.538 3h12.924zm-.098 1.5H5.636c-.629 0-1.136.51-1.136 1.136v10.181l4.009-4.62 5.391 5.625.466-.61 2.757-3.584 2.377 3.186V5.636c0-.623-.513-1.136-1.136-1.136zm-4.864 2a2 2 0 1 1 0 4 2 2 0 0 1 0-4zm0 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2z\"\n        />\n      </defs>\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path fill=\"transparent\" d=\"M0 0h24v24H0z\" />\n        <use fill={fill} xlinkHref=\"#CYSJlDlJRPCX6cHjMw9V\" />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconImage;\n", "import IconBase, { IconProps } from './IconBase.tsx';\n\nconst IconAssignee = ({ fill = '#9CB2CD', className }: IconProps) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path fill=\"transparent\" d=\"M0 0h24v24H0z\" />\n        <path\n          fill={fill}\n          d=\"M11.742 21a10.9 10.9 0 0 0 2.254-.236c.746-.157 1.34-.364 1.779-.621l-.411-1.483a8.216 8.216 0 0 1-1.698.476c-.656.12-1.283.179-1.881.179-2.271 0-3.976-.622-5.115-1.864-1.139-1.242-1.65-3-1.536-5.273.08-1.496.433-2.823 1.06-3.982.627-1.16 1.485-2.053 2.574-2.682 1.088-.63 2.328-.944 3.72-.944 2.227 0 3.909.602 5.044 1.806 1.136 1.203 1.642 2.926 1.52 5.167-.044 1.117-.289 2.02-.736 2.71s-1.002 1.036-1.665 1.036c-.433 0-.748-.135-.946-.405-.199-.27-.262-.658-.19-1.165l.552-5.567-.681-.414c-.728-.423-1.608-.635-2.639-.635a4.38 4.38 0 0 0-2.336.664c-.72.443-1.317 1.077-1.79 1.902-.471.825-.772 1.768-.902 2.827-.144 1.297.072 2.34.649 3.13.576.79 1.391 1.185 2.444 1.185 1.16 0 2.101-.45 2.822-1.349.23.443.571.784 1.022 1.021.45.238.986.356 1.606.356 1.405 0 2.525-.483 3.357-1.449.833-.966 1.289-2.271 1.368-3.915.08-1.701-.205-3.194-.854-4.478-.649-1.284-1.626-2.271-2.93-2.962C15.897 3.345 14.34 3 12.53 3c-1.78 0-3.38.384-4.796 1.15a8.53 8.53 0 0 0-3.357 3.26c-.822 1.407-1.276 2.996-1.363 4.768-.086 1.85.2 3.44.86 4.772.66 1.333 1.66 2.34 3 3.024C8.216 20.658 9.838 21 11.742 21zm-.12-6.353c-.531 0-.915-.222-1.153-.666-.237-.445-.318-1.095-.24-1.951.132-1.22.42-2.147.863-2.782.444-.636 1.067-.954 1.87-.954.286 0 .566.042.838.127l-.44 4.601c-.202.526-.457.928-.765 1.207-.307.279-.632.418-.974.418z\"\n        />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconAssignee;\n", "import IconBase, { IconProps } from './IconBase.tsx';\n\nconst IconDueDate = ({ fill = '#9CB2CD', className }: IconProps) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path fill=\"transparent\" d=\"M0 0h24v24H0z\" />\n        <g fill={fill}>\n          <path d=\"M12 4.612c2.16 0 4.23.863 5.758 2.4a8.22 8.22 0 0 1 2.385 5.794C20.143 17.33 16.497 21 12 21c-4.497 0-8.143-3.669-8.143-8.194 0-4.526 3.646-8.194 8.143-8.194zm0 1.527a6.667 6.667 0 1 0 0 13.334 6.667 6.667 0 0 0 0-13.334zM2.972 6.25l3.719-3.743 1.066 1.072L4.04 7.323zM16.243 3.58l1.066-1.073 3.72 3.743-1.067 1.073z\" />\n          <path d=\"M12.377 9.24h-1.206v4.036l3.655 2.534.681-1.001-3.13-2.17z\" />\n        </g>\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconDueDate;\n", "import React from 'https://esm.sh/react@18.2.0';\nimport IconBase from './IconBase.tsx';\n\ninterface IconAttachmentProps {\n  fill?: string;\n  className?: string;\n  size?: 'big' | 'small';\n}\nconst IconAttachment = ({\n  fill = '#9CB2CD',\n  className,\n  size = 'big',\n}: IconAttachmentProps) => (\n  <IconBase size={size} className={className}>\n    <svg\n      width=\"18\"\n      height=\"18\"\n      viewBox=\"0 0 18 18\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M12 4.125V12.75C12 14.4075 10.6575 15.75 9 15.75C7.3425 15.75 6 14.4075 6 12.75L6 3.375C6 2.34 6.84 1.5 7.875 1.5C8.91 1.5 9.75 2.34 9.75 3.375V11.25C9.75 11.6625 9.4125 12 9 12C8.5875 12 8.25 11.6625 8.25 11.25V4.125H7.125L7.125 11.25C7.125 12.285 7.965 13.125 9 13.125C10.035 13.125 10.875 12.285 10.875 11.25V3.375C10.875 1.7175 9.5325 0.375 7.875 0.375C6.2175 0.375 4.875 1.7175 4.875 3.375L4.875 12.75C4.875 15.03 6.72 16.875 9 16.875C11.28 16.875 13.125 15.03 13.125 12.75V4.125H12Z\"\n        fill={fill}\n      />\n    </svg>\n  </IconBase>\n);\nexport default IconAttachment;\n", "import IconBase, { IconProps } from './IconBase.tsx';\n\nconst IconCamera = ({ fill = '#FFF', className = '' }: IconProps) => (\n  <IconBase size=\"small\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 16 16\"\n    >\n      <path\n        fill=\"#9CB2CD\"\n        fillRule=\"evenodd\"\n        d=\"M10.376 2.667c.144 0 .276.081.34.21l.658 1.313h1.67c.629 0 1.142.512 1.142 1.141l.004 6.86c0 .63-.513 1.142-1.143 1.142H3.143c-.63 0-1.143-.512-1.143-1.142V5.335c0-.629.512-1.141 1.141-1.142l1.667-.003.656-1.313c.064-.129.196-.21.34-.21zm-.235.761h-4.1l-.657 1.313c-.064.129-.196.21-.34.21l-1.902.003c-.21 0-.38.171-.38.381v6.856c0 .21.17.38.38.38h9.905c.21 0 .382-.17.382-.38V5.331c0-.21-.176-.38-.386-.38h-1.905c-.144 0-.276-.082-.34-.21l-.657-1.314zM8.095 5.333c1.68 0 3.048 1.367 3.048 3.048 0 1.68-1.367 3.048-3.048 3.048-1.68 0-3.047-1.368-3.047-3.048s1.367-3.048 3.047-3.048zm0 .762c-1.26 0-2.285 1.026-2.285 2.286s1.025 2.286 2.285 2.286c1.26 0 2.286-1.026 2.286-2.286S9.356 6.095 8.095 6.095z\"\n      />\n    </svg>\n  </IconBase>\n);\nexport default IconCamera;\n", "import IconBase, { IconProps } from './IconBase.tsx';\n\nconst IconExportMail = ({ fill = '#9CB2CD', className }: IconProps) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <path fill=\"transparent\" d=\"M0 0h24v24H0z\" />\n        <path\n          fill={fill}\n          d=\"M18 7a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h11zm-7.147 4.859L7.611 16H17.5l-3.195-3.993-1.57 1.419-1.882-1.567zM7 8.65v6.508l3.084-3.939L7 8.65zm11 .023l-2.951 2.663L18 15.024V8.673zM17.252 8H7.781l4.927 4.102L17.252 8z\"\n        />\n      </g>\n    </svg>\n  </IconBase>\n);\nexport default IconExportMail;\n", "import IconBase, { IconProps } from './IconBase.tsx';\n\nconst IconExportPdf = ({ fill = '#9CB2CD', className = '' }: IconProps) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <path\n        fill={fill}\n        fillRule=\"evenodd\"\n        d=\"M17.872 9.864l1-1.87c0-.098-.04-.197-.108-.267l-4.45-4.614C14.256 3.039 14.14 3 14.05 3H5.54c-.206 0-.372.17-.372.38v6.484H4v7.555h1.168v3.2c0 .21.166.381.371.381h7.965v-.761H5.911v-2.82h12.217v2.82h-4.624V21H18.5c.205 0 .372-.17.372-.38v-3.2H20V9.863h-2.128zm-3.45-5.557l3.188 3.307h-3.189V4.307zM9.67 13.764c-.258.249-.64.36-1.085.36-.1 0-.189-.005-.258-.015v1.223H7.58v-3.373c.233-.041.56-.071 1.02-.071.466 0 .798.09 1.021.274.213.172.357.456.357.79 0 .336-.11.62-.307.812zm3.434 1.162c-.352.299-.887.441-1.541.441-.392 0-.669-.025-.857-.05v-3.358c.277-.046.639-.071 1.02-.071.635 0 1.046.116 1.368.365.347.264.565.684.565 1.288 0 .654-.233 1.106-.555 1.385zm3.34-2.38H15.16v.782h1.199v.629h-1.2v1.375h-.757v-3.42h2.04v.635zm-4.638-.065c.649 0 1.055.375 1.05 1.086 0 .816-.446 1.202-1.13 1.197-.094 0-.198 0-.262-.016v-2.237c.064-.015.173-.03.342-.03zm-3.167-.01c.377 0 .59.188.59.502 0 .35-.248.558-.65.558-.108 0-.188-.005-.252-.02V12.5c.055-.015.159-.03.312-.03zm5.04-8.71v4.233c0 .21.166.38.37.38h4.08v1.49H5.91V3.761h7.767z\"\n      />\n    </svg>\n  </IconBase>\n);\nexport default IconExportPdf;\n", "import IconBase, { IconProps } from './IconBase.tsx';\n\nconst IconDuplicate = ({ fill = '#9CB2CD', className }: IconProps) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n    >\n      <path\n        fill={fill}\n        fillRule=\"evenodd\"\n        d=\"M16.063 7.116c.442 0 .821.379.821.82V21.18c0 .463-.379.821-.82.821H2.82C2.358 22 2 21.621 2 21.179V7.937c0-.463.379-.821.821-.821zm-.82 1.642h-11.6v11.6h11.6v-11.6zm-5.054 2.253c.19 0 .358.168.358.357v2.085h2.085c.19 0 .357.168.357.358v1.494c0 .19-.168.358-.357.358h-2.085v2.084c0 .19-.168.358-.358.358H8.695c-.19 0-.358-.168-.358-.358v-2.084H6.253c-.21 0-.358-.147-.358-.358v-1.494c0-.19.168-.358.358-.358h2.084v-2.085c0-.19.168-.357.358-.357zM21.18 13.2c.463 0 .821.358.821.821v2.042c0 .463-.379.821-.821.821h-2.042c-.463 0-.821-.379-.821-.82 0-.464.379-.822.82-.822h1.222v-1.22c0-.464.379-.822.82-.822zm0-5.726c.463 0 .821.379.821.82v2.295c0 .464-.379.822-.821.822-.463 0-.821-.38-.821-.822V8.295c0-.463.379-.821.82-.821zM9.979 2c.463 0 .821.358.821.821 0 .463-.379.821-.821.821H8.758v1.221c0 .463-.38.821-.821.821-.442 0-.821-.358-.821-.82V2.82c0-.463.379-.821.82-.821zm11.2 0c.463 0 .821.358.821.821v2.042c0 .463-.379.821-.821.821-.463 0-.821-.379-.821-.82V3.641h-1.221c-.463 0-.821-.358-.821-.82 0-.464.379-.822.82-.822zm-5.474 0c.463 0 .821.358.821.821 0 .463-.379.821-.82.821H13.41c-.443 0-.822-.358-.822-.82 0-.464.38-.822.822-.822z\"\n      />\n    </svg>\n  </IconBase>\n);\nexport default IconDuplicate;\n", "import React from 'https://esm.sh/react@18.2.0';\nimport IconBase from './IconBase.tsx';\n\ninterface IconExpanderProps {\n  fill?: string;\n  className?: string;\n}\nconst IconExpander = ({ fill = '#121212', className }: IconExpanderProps) => (\n  <IconBase size=\"big\" className={className}>\n    <svg\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M16.59 8.59L12 13.17L7.41 8.59L6 10L12 16L18 10L16.59 8.59Z\"\n        fill={fill}\n        fillOpacity=\"0.6\"\n      />\n    </svg>\n  </IconBase>\n);\nexport default IconExpander;\n", "import IconAdd from './IconAdd.tsx';\nimport IconCreateNew from './IconCreateNew.tsx';\nimport IconFilter from './IconFilter.tsx';\nimport IconMenu from './IconMenu.tsx';\nimport IconNotifications from './IconNotifications.tsx';\nimport IconSearch from './IconSearch.tsx';\nimport IconSettings from './IconSettings.tsx';\nimport IconTag from './IconTag.tsx';\nimport IconAlignCenter from './IconAlignCenter.tsx';\nimport IconAlignLeft from './IconAlignLeft.tsx';\nimport IconAlignRight from './IconAlignRight.tsx';\nimport IconBold from './IconBold.tsx';\nimport IconBulletList from './IconBulletList.tsx';\nimport IconItalic from './IconItalic.tsx';\nimport IconLink from './IconLink.tsx';\nimport IconNumberList from './IconNumberList.tsx';\nimport IconStrikethrough from './IconStrikethrough.tsx';\nimport IconTask from './IconTask.tsx';\nimport IconUnderline from './IconUnderline.tsx';\nimport IconDropDown from './IconDropDown.tsx';\nimport IconGoogle from './IconGoogle.tsx';\nimport IconNote from './IconNote.tsx';\nimport IconDropDownArrow from './IconDropDownArrow.tsx';\nimport IconTasksTick from './IconTasksTick.tsx';\nimport IconOverflow from './IconOverflow.tsx';\nimport IconClose from './IconClose.tsx';\nimport IconDelete from './IconDelete.tsx';\nimport IconEdit from './IconEdit.tsx';\nimport IconViewNote from './IconViewNote.tsx';\nimport IconKeyboard from './IconKeyboard.tsx';\nimport IconBack from './IconBack.tsx';\nimport IconContactUs from './IconContactUs.tsx';\nimport IconCalendar from './IconCalendar.tsx';\nimport IconSorting from './IconSorting.tsx';\nimport IconImage from './IconImage.tsx';\nimport IconAssignee from './IconAssignee.tsx';\nimport IconDueDate from './IconDueDate.tsx';\nimport IconAttachment from './IconAttachment.tsx';\nimport IconCamera from './IconCamera.tsx';\nimport IconExportMail from './IconExportMail.tsx';\nimport IconExportPdf from './IconExportPdf.tsx';\nimport IconDuplicate from './IconDuplicate.tsx';\nimport IconExpander from './IconExpander.tsx';\n\nexport {\n  IconAdd,\n  IconDropDownArrow,\n  IconCreateNew,\n  IconFilter,\n  IconMenu,\n  IconNotifications,\n  IconSearch,\n  IconSettings,\n  IconTag,\n  IconAlignCenter,\n  IconAlignLeft,\n  IconAlignRight,\n  IconBold,\n  IconBulletList,\n  IconItalic,\n  IconLink,\n  IconNumberList,\n  IconStrikethrough,\n  IconTask,\n  IconUnderline,\n  IconDropDown,\n  IconGoogle,\n  IconNote,\n  IconTasksTick,\n  IconOverflow,\n  IconClose,\n  IconDelete,\n  IconEdit,\n  IconViewNote,\n  IconKeyboard,\n  IconBack,\n  IconContactUs,\n  IconCalendar,\n  IconSorting,\n  IconImage,\n  IconDueDate,\n  IconAssignee,\n  IconAttachment,\n  IconCamera,\n  IconExportMail,\n  IconExportPdf,\n  IconDuplicate,\n  IconExpander,\n};\n", "import React, {\n  useContext,\n  useEffect,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport { isServerSide } from '../ssr.ts';\n\nexport const scrollingContext = React.createContext<HTMLElement>(\n  isServerSide ? null : document.body\n);\n\nexport function useScrollingRerendering() {\n  const parent = useContext(scrollingContext);\n  const el = parent;\n  const [offset, setOffset] = useState(() =>\n    el ? { x: el.scrollLeft, y: el.scrollTop } : { x: 0, y: 0 }\n  );\n  useEffect(() => {\n    if (el) {\n      const handler = () => {\n        setOffset(el ? { x: el.scrollLeft, y: el.scrollTop } : { x: 0, y: 0 });\n      };\n      el.addEventListener('scroll', handler);\n      return () => {\n        el.removeEventListener('scroll', handler);\n      };\n    }\n  }, [el]);\n\n  return offset;\n}\n\nexport function useScrollParent() {\n  return useContext(scrollingContext);\n}\n\ninterface ScrollerProps<T extends HTMLElement> {\n  children: (ref: (el: T) => void) => JSX.Element;\n}\n\nexport function Scroller<T extends HTMLElement = HTMLDivElement>({\n  children,\n}: ScrollerProps<T>) {\n  const [el, setEl] = useState<T>();\n\n  return (\n    <scrollingContext.Provider value={el}>\n      {children(setEl)}\n    </scrollingContext.Provider>\n  );\n}\n", "import React, {\n  useState,\n  useEffect,\n  useRef,\n  useLayoutEffect,\n} from 'https://esm.sh/react@18.2.0';\nimport ReactDOM from 'https://esm.sh/react-dom@18.2.0';\nimport PropTypes from 'https://esm.sh/prop-types@15.8.1';\nimport { styleguide } from '../styleguide.ts';\nimport { useTransitionedOpen, TRANSITION_STATES } from './transition.tsx';\nimport { makeStyles, cn, keyframes } from '../css-objects/index.ts';\nimport { useScrollingRerendering } from '../utils/scrolling/index.tsx';\nimport Layer from './layer.tsx';\nimport { createUniversalPortal } from '../utils/ssr.ts';\n\nconst popIn = keyframes(\n  {\n    from: {\n      opacity: 0,\n      transform: `translateY(${styleguide.gridbase * 1.5}px)`,\n    },\n    to: {\n      opacity: 1,\n      transform: 'translateY(0)',\n    },\n  },\n  'popper_a30987'\n);\n\nexport const zIndex = 100;\n\nconst useStyles = makeStyles(\n  (theme) => ({\n    popper: {\n      position: 'absolute',\n      zIndex: zIndex,\n    },\n    animator: {\n      ...styleguide.transition.standard,\n      transitionDuration: `${styleguide.transition.duration.short}ms`,\n      transitionProperty: 'all',\n    },\n    exiting: {\n      opacity: 0,\n      transform: `translateY(${styleguide.gridbase * 1.5}px)`,\n    },\n    removed: {},\n    entering: {\n      animation: `${popIn} ${styleguide.transition.duration.short}ms ${styleguide.transition.timing.standard} both`,\n    },\n    // visible: {\n    //   opacity: 1,\n    //   transform: 'translateY(0px)',\n    // },\n  }),\n  'popper_1a09eb'\n);\n\nexport interface PopperViewProps\n  extends Omit<PopperElementProps, 'visibility'> {\n  open: boolean;\n  animationDuration?: number;\n}\n\nexport const Popper: React.FC<PopperViewProps> = ({\n  open,\n  animationDuration = styleguide.transition.duration.short,\n  className = '',\n  anchor,\n  ...rest\n}) => {\n  const [visibility] = useTransitionedOpen(open && !!anchor, animationDuration);\n\n  if (!anchor || visibility === TRANSITION_STATES.REMOVED) {\n    return null;\n  }\n  return createUniversalPortal(\n    <PopperElement\n      className={cn(className)}\n      anchor={anchor}\n      visibility={visibility}\n      {...rest}\n    />\n  );\n};\n\nfunction isOverflowing(\n  style: Record<string, any>,\n  popper: HTMLElement | undefined\n): PopperPosition[] {\n  if (!popper) {\n    return [];\n  }\n\n  const boundingRect = popper.getBoundingClientRect();\n  const { x = 0, y = 0 } = style.transform || {};\n  let offsetX =\n    typeof style.left === 'number'\n      ? style.left + boundingRect.width * x\n      : window.innerWidth -\n        style.right -\n        (boundingRect.width + boundingRect.width * x);\n\n  let offsetY =\n    typeof style.top === 'number'\n      ? style.top + boundingRect.height * y\n      : window.innerHeight -\n        style.bottom -\n        (boundingRect.height + boundingRect.height * y);\n\n  const points = [\n    {\n      x: offsetX,\n      y: offsetY,\n    },\n    {\n      x: offsetX + boundingRect.width,\n      y: offsetY,\n    },\n    {\n      x: offsetX,\n      y: offsetY + boundingRect.height,\n    },\n    {\n      x: offsetX + boundingRect.width,\n      y: offsetY + boundingRect.height,\n    },\n  ];\n\n  const overflow = new Set<PopperPosition>();\n\n  for (let point of points) {\n    if (point.x < 0) {\n      overflow.add('left');\n    }\n    if (point.x > window.innerWidth) {\n      overflow.add('right');\n    }\n    if (point.y < 0) {\n      overflow.add('top');\n    }\n    if (point.y > window.innerHeight) {\n      overflow.add('bottom');\n    }\n  }\n\n  return Array.from(overflow);\n}\n\ntype Points = {\n  top: number;\n  left: number;\n  right: number;\n  bottom: number;\n};\n\ntype CalcFunction = (\n  anchor: HTMLElement,\n  rect: DOMRect,\n  points: Points\n) => Record<string, any>;\ntype GetPositionFn = (anchor: HTMLElement) => Record<string, any>;\n\nfunction calcFn(fn: CalcFunction): GetPositionFn {\n  return (anchor: HTMLElement) => {\n    const el = anchor;\n    const rect = el.getBoundingClientRect();\n    const points = {\n      top: rect.top,\n      left: rect.left,\n      right: window.innerWidth - (rect.left + rect.width),\n      bottom: window.innerHeight - (rect.top + rect.height),\n    };\n    return fn(el, rect, points);\n  };\n}\ntype PositionCalculator = {\n  [position in PopperPosition]: {\n    [align in PopperAlign]: {\n      [direction in PopperDirection]: GetPositionFn;\n    };\n  };\n};\nconst positionCalculator: PositionCalculator = {\n  top: {\n    start: {\n      in: calcFn((el, rect, points) => {\n        return {\n          transformOrigin: 'top left',\n          top: points.top,\n          left: points.left,\n        };\n      }),\n      out: calcFn((el, rect) => {\n        return {\n          transformOrigin: 'bottom left',\n          bottom: window.innerHeight - rect.top,\n          left: rect.left,\n        };\n      }),\n    },\n    center: {\n      in: calcFn((el, rect) => {\n        return {\n          transformOrigin: 'top center',\n          top: rect.top,\n          left: rect.left,\n          transform: { x: -0.25 },\n        };\n      }),\n      out: calcFn((el, rect) => {\n        return {\n          transformOrigin: 'bottom center',\n          bottom: window.innerHeight - rect.top,\n          left: rect.left + rect.width / 2,\n          transform: { x: -0.5 },\n        };\n      }),\n    },\n    end: {\n      in: calcFn((el, rect) => {\n        return {\n          transformOrigin: 'top right',\n          top: rect.top,\n          right: window.innerWidth - (rect.left + rect.width),\n        };\n      }),\n      out: calcFn((el, rect) => {\n        return {\n          transformOrigin: 'bottom right',\n          bottom: window.innerHeight - rect.top,\n          right: window.innerWidth - (rect.left + rect.width),\n        };\n      }),\n    },\n  },\n  left: {\n    start: {\n      in: (...args) => {\n        return positionCalculator.top.start.in(...args);\n      },\n      out: calcFn((el, rect) => {\n        return {\n          transformOrigin: 'top right',\n          top: rect.top,\n          right: window.innerWidth - rect.left,\n        };\n      }),\n    },\n    center: {\n      in: calcFn((el, rect) => {\n        return {\n          transformOrigin: 'left center',\n          top: rect.top + rect.height / 2,\n          left: rect.left,\n          transform: { y: -0.5 },\n        };\n      }),\n      out: calcFn((el, rect) => {\n        return {\n          transformOrigin: 'right center',\n          top: rect.top + rect.height / 2,\n          right: window.innerWidth - rect.left,\n          transform: { y: -0.5 },\n        };\n      }),\n    },\n    end: {\n      in: calcFn((el, rect) => {\n        return {\n          transformOrigin: 'bottom left',\n          bottom: window.innerHeight - (rect.top + rect.height),\n          left: rect.left,\n        };\n      }),\n      out: calcFn((el, rect) => {\n        return {\n          transformOrigin: 'right top',\n          bottom: window.innerHeight - (rect.top + rect.height),\n          right: window.innerWidth - rect.left,\n        };\n      }),\n    },\n  },\n  right: {\n    start: {\n      in: (...args) => {\n        return positionCalculator.top.end.in(...args);\n      },\n      out: calcFn((el, rect) => {\n        return {\n          transformOrigin: 'left top',\n          top: rect.top,\n          left: rect.left + rect.width,\n        };\n      }),\n    },\n    center: {\n      in: calcFn((el, rect, points) => {\n        return {\n          transformOrigin: 'left top',\n          right: points.right,\n          top: rect.top + rect.height / 2,\n          transform: { y: -0.5 },\n        };\n      }),\n      out: calcFn((el, rect, points) => {\n        return {\n          transformOrigin: 'left top',\n          left: rect.left + rect.width,\n          top: rect.top + rect.height / 2,\n          transform: { y: -0.5 },\n        };\n      }),\n    },\n    end: {\n      in: calcFn((el, rect, points) => {\n        return {\n          transformOrigin: 'left top',\n          right: points.right,\n          bottom: points.bottom,\n        };\n      }),\n      out: calcFn((el, rect, points) => {\n        return {\n          transformOrigin: 'left top',\n          left: rect.left + rect.width,\n          bottom: points.bottom,\n        };\n      }),\n    },\n  },\n  bottom: {\n    start: {\n      in: calcFn((el, rect, points) => {\n        return {\n          transformOrigin: 'left top',\n          left: points.left,\n          bottom: points.bottom,\n        };\n      }),\n      out: calcFn((el, rect, points) => {\n        return {\n          transformOrigin: 'left top',\n          left: points.left,\n          top: points.top + rect.height,\n        };\n      }),\n    },\n    center: {\n      in: calcFn((el, rect, points) => {\n        return {\n          transformOrigin: 'left top',\n          left: points.left,\n          bottom: points.bottom,\n          transform: { x: -0.25 },\n        };\n      }),\n      out: calcFn((el, rect, points) => {\n        return {\n          transformOrigin: 'left top',\n          left: rect.left + rect.width / 2,\n          transform: { x: -0.5 },\n          top: points.top + rect.height,\n        };\n      }),\n    },\n    end: {\n      in: calcFn((el, rect, points) => {\n        return {\n          transformOrigin: 'left top',\n          right: points.right,\n          bottom: points.bottom,\n        };\n      }),\n      out: calcFn((el, rect, points) => {\n        return {\n          transformOrigin: 'left top',\n          right: points.right,\n          top: points.top + rect.height,\n        };\n      }),\n    },\n  },\n};\n\nPopper.propTypes = {\n  position: PropTypes.oneOf<PopperPosition>(['top', 'left', 'right', 'bottom'])\n    .isRequired,\n  align: PropTypes.oneOf(['start', 'center', 'end']),\n  direction: PropTypes.oneOf(['in', 'out']),\n  anchor: PropTypes.any,\n};\n\nexport type PopperPosition = 'top' | 'left' | 'right' | 'bottom';\nexport type PopperAlign = 'start' | 'center' | 'end';\nexport type PopperDirection = 'in' | 'out';\n\ninterface PopperElementProps extends React.HTMLAttributes<HTMLDivElement> {\n  anchor: HTMLElement;\n  position: PopperPosition;\n  align?: PopperAlign;\n  direction?: PopperDirection;\n  visibility: TRANSITION_STATES;\n  className?: string;\n}\nconst PopperElement: React.FC<PopperElementProps> = ({\n  anchor,\n  className,\n  position,\n  align = 'center',\n  children,\n  direction = 'out',\n  visibility,\n  ...rest\n}) => {\n  const styles = useStyles();\n  const [recalc, setRecalc] = useState(0);\n  const el = useRef<HTMLDivElement>();\n  const [style, setStyle] = useState({});\n  const offset = useScrollingRerendering();\n\n  useLayoutEffect(() => {\n    let p = position;\n    let a = align;\n    let newStyle = positionCalculator[p][a][direction](anchor);\n\n    const overflow = isOverflowing(newStyle, el.current);\n    if (overflow.length) {\n      if (p === 'right') {\n        if (overflow.includes('left') || overflow.includes('right')) {\n          p = 'left';\n        }\n        if (overflow.includes('bottom')) {\n          a = 'end';\n        } else if (overflow.includes('top')) {\n          a = 'start';\n        }\n      } else if (p === 'left') {\n        if (overflow.includes('left') || overflow.includes('right')) {\n          p = 'right';\n        }\n        if (overflow.includes('bottom')) {\n          a = 'end';\n        } else if (overflow.includes('top')) {\n          a = 'start';\n        }\n      } else if (p === 'top') {\n        if (overflow.includes('top') || overflow.includes('bottom')) {\n          p = 'bottom';\n        }\n        if (overflow.includes('right')) {\n          a = 'end';\n        } else if (overflow.includes('left')) {\n          a = 'start';\n        }\n      } else if (p === 'bottom') {\n        if (overflow.includes('top') || overflow.includes('bottom')) {\n          p = 'top';\n        }\n        if (overflow.includes('right')) {\n          a = 'end';\n        } else if (overflow.includes('left')) {\n          a = 'start';\n        }\n      }\n\n      newStyle = positionCalculator[p][a][direction](anchor);\n    }\n\n    for (let [key, val] of Object.entries(newStyle)) {\n      if (typeof val === 'number') {\n        newStyle[key] = val + 'px';\n      }\n    }\n\n    if (newStyle.transform) {\n      const { x = 0, y = 0 } = newStyle.transform;\n\n      newStyle.transform = `translate(${x * 100}%, ${y * 100}%)`;\n    }\n\n    setStyle(newStyle);\n  }, [align, position, direction, anchor, recalc, offset]);\n\n  useEffect(() => {\n    const handler = () => {\n      setRecalc((x) => x + 1);\n    };\n\n    window.addEventListener('resize', handler);\n    window.addEventListener('scroll', handler);\n    return () => {\n      window.removeEventListener('resize', handler);\n      window.removeEventListener('scroll', handler);\n    };\n  }, []);\n  return (\n    <Layer>\n      {({ zIndex }) => (\n        <div\n          className={cn(className, styles.popper)}\n          style={{ ...style, zIndex }}\n          {...rest}\n        >\n          <div\n            className={cn(styles.animator, styles[visibility.toLowerCase()])}\n            ref={el}\n          >\n            {children}\n          </div>\n        </div>\n      )}\n    </Layer>\n  );\n};\n\nexport default Popper;\n", "import React, {\n  useState,\n  useRef,\n  useLayoutEffect,\n  useMemo,\n  useCallback,\n  useContext,\n  MouseEvent,\n} from 'https://esm.sh/react@18.2.0';\nimport ReactDOM from 'https://esm.sh/react-dom@18.2.0';\nimport { makeStyles, cn } from '../css-objects/index.ts';\n\nimport { styleguide } from '../styleguide.ts';\nimport { layout } from '../layout.ts';\nimport { Button } from './buttons.tsx';\nimport Popper from './popper.tsx';\nimport { Text } from './typography.tsx';\nimport { Tooltip } from './tooltip/index.tsx';\nimport Layer from './layer.tsx';\nimport { IconExpander } from './icons/index.ts';\n\n// const zoom = keyframes({\n//   from: {\n//     transform: 'scaleY(0)',\n//     opacity: 0,\n//   },\n//   to: {\n//     transform: 'scaleY(1)',\n//     opacity: 1,\n//   },\n// });\n\nconst useStyles = makeStyles((theme) => ({\n  item: {\n    height: styleguide.gridbase * 6,\n    flexShrink: 0,\n    boxSizing: 'border-box',\n    minWidth: styleguide.gridbase * 20,\n    padding: styleguide.gridbase,\n    color: theme.background.text,\n    backgroundColor: 'transparent',\n    transition: 'background-color 0.15s linear',\n    cursor: 'pointer',\n    ':hover': {\n      backgroundColor: theme.background[100],\n    },\n    alignItems: 'center',\n    basedOn: [layout.row],\n  },\n  actionIcon: {\n    marginRight: styleguide.gridbase,\n  },\n  actionText: {\n    flexGrow: 1,\n  },\n  menuButton: {\n    userSelect: 'none',\n  },\n  dropDown: {\n    alignItems: 'stretch',\n    padding: [styleguide.gridbase, 0],\n    backgroundColor: theme.background[0],\n    boxShadow: theme.shadows.z2,\n    basedOn: [layout.column],\n    transformOrigin: 'top',\n    whitespace: 'nowrap',\n    // animation: `${zoom} ${\n    //   styleguide.transition.duration.short\n    // }ms ${styleguide.transition.timing.standard} backwards`,\n  },\n  iconMenu: {\n    ...layout.row.rules,\n    boxSizing: 'border-box',\n    padding: [styleguide.gridbase * 2, styleguide.gridbase * 1.5],\n    alignItems: 'center',\n  },\n  iconItem: {\n    padding: 0,\n    height: styleguide.gridbase * 3,\n    width: styleguide.gridbase * 3,\n    minWidth: styleguide.gridbase * 3,\n    margin: [0, styleguide.gridbase * 0.5],\n    basedOn: [layout.row, layout.centerCenter],\n  },\n  backdrop: {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    right: 0,\n    bottom: 0,\n    display: 'none',\n    userSelect: 'none',\n    '&backdropVisible': {\n      display: 'block',\n    },\n  },\n  tooltip: {\n    marginBottom: styleguide.gridbase * 3,\n  },\n  backdropVisible: {},\n  secondaryIcon: {\n    transform: 'rotate(270deg)',\n    transformOrigin: 'center center',\n  },\n}));\n\nconst MenuContext = React.createContext({\n  close() {},\n  hasParent: false,\n});\n\ntype DivProps = React.ComponentPropsWithoutRef<'div'>;\n\nexport interface SecondaryMenuItemProps extends React.PropsWithChildren {\n  text: string;\n  className?: string;\n}\n\nexport const SecondaryMenuItem: React.FC<SecondaryMenuItemProps> = ({\n  children,\n  text,\n  className,\n}) => {\n  const styles = useStyles();\n  const renderButton = useCallback(() => {\n    return (\n      <div className={cn(className, styles.item)}>\n        <Text>{text}</Text>\n        <div className={cn(layout.flexSpacer)} />\n        <IconExpander className={cn(styles.secondaryIcon)} />\n      </div>\n    );\n  }, [text, className, styles]);\n\n  return (\n    <Menu\n      renderButton={renderButton}\n      position=\"right\"\n      direction=\"out\"\n      align=\"start\"\n    >\n      {children}\n    </Menu>\n  );\n};\n\ninterface MenuItemProps {\n  onClick?: () => any;\n  className?: string;\n  children?: React.ReactNode;\n  selected?: boolean;\n}\n\nexport function useMenuClose() {\n  const ctx = useContext(MenuContext);\n  return ctx.close;\n}\n\nexport const MenuItem = React.forwardRef<\n  HTMLDivElement,\n  DivProps & MenuItemProps\n>(function MenuItem(\n  { selected, children, className, onClick = () => true, ...props },\n  ref\n) {\n  const styles = useStyles();\n  const ctx = useContext(MenuContext);\n\n  const invoke = (e: MouseEvent) => {\n    e.stopPropagation();\n    Promise.resolve(onClick()).then((r) => {\n      if (typeof r === 'undefined' || r) {\n        ctx.close();\n      }\n    });\n  };\n  return (\n    <div\n      className={cn(className, styles.item)}\n      {...props}\n      onClick={invoke}\n      ref={ref}\n    >\n      {children}\n    </div>\n  );\n});\n\nexport const MenuItemStyle = useStyles.item;\ninterface MenuActionProps {\n  IconComponent: any;\n  text: string;\n  iconWidth?: string;\n  iconHeight?: string;\n}\n\nexport const MenuAction = React.forwardRef<\n  HTMLDivElement,\n  MenuActionProps & DivProps & MenuItemProps\n>(function MenuAction(\n  { IconComponent, text, iconWidth, iconHeight, ...props },\n  ref\n) {\n  const styles = useStyles();\n  return (\n    <MenuItem {...props} ref={ref}>\n      <IconComponent\n        className={cn(styles.actionIcon)}\n        width={iconWidth}\n        height={iconHeight}\n      />\n      <Text className={cn(styles.actionText)}>{text}</Text>\n    </MenuItem>\n  );\n});\n\ninterface BackdropProps {\n  className?: string;\n  visible: boolean;\n  children: React.ReactNode;\n}\n\nexport const Backdrop = React.forwardRef<\n  HTMLDivElement,\n  BackdropProps & DivProps\n>(({ visible, children, className, ...rest }, ref) => {\n  const styles = useStyles();\n  return ReactDOM.createPortal(\n    <Layer>\n      {({ zIndex }) => (\n        <div\n          ref={ref}\n          className={cn(\n            className,\n            styles.backdrop,\n            visible && styles.backdropVisible\n          )}\n          style={{ zIndex }}\n          {...rest}\n        >\n          {children}\n        </div>\n      )}\n    </Layer>,\n    document.getElementById('root')!\n  );\n});\n\nexport type MenuRenderButton = (props: {\n  close: (e: React.MouseEvent) => void;\n  isOpen: boolean;\n}) => React.ReactNode;\n\ninterface MenuProps {\n  children: React.ReactNode;\n  renderButton: MenuRenderButton;\n  popupClassName?: string;\n  backdropClassName?: string;\n  className?: string;\n  align?: 'start' | 'center' | 'end';\n  position?: 'top' | 'bottom' | 'left' | 'right';\n  direction?: 'in' | 'out';\n  onClick?: () => void;\n  sizeByButton?: boolean;\n  style?: {};\n}\n\nexport function IconMenu({ popupClassName, ...props }: MenuProps) {\n  const styles = useStyles();\n  return (\n    <Menu {...props} popupClassName={cn(styles.iconMenu, popupClassName)} />\n  );\n}\n\n// export interface IconMenuItemProps {\n//   IconComponent: React.ComponentType;\n// }\n\n// export function IconMenuItem({\n//   IconComponent,\n//   className,\n//   tooltip,\n//   fill,\n//   ...props\n// }: IconMenuItemProps) {\n//   const styles = useStyles();\n//   return (\n//     <Tooltip className={cn(styles.tooltip)} text={tooltip} position=\"top\">\n//       <MenuItem {...props} className={cn(styles.iconItem, className)}>\n//         <IconComponent fill={fill} />\n//       </MenuItem>\n//     </Tooltip>\n//   );\n// }\n\nfunction isElement(x: HTMLElement | null | undefined): x is HTMLElement {\n  return !!x;\n}\n\nexport default function Menu({\n  children,\n  renderButton,\n  popupClassName,\n  backdropClassName,\n  className,\n  align = 'center',\n  position = 'top',\n  direction = 'in',\n  onClick = () => {},\n  sizeByButton = false,\n  style = {},\n}: MenuProps) {\n  const styles = useStyles();\n  const [open, setOpen] = useState(false);\n  const anchor = useRef(null);\n  const backdrop = useRef(null);\n  const [minWidthStyle, setMinWidthStyle] = useState({});\n  const menuCtx = useContext(MenuContext);\n\n  const close = useCallback(\n    (e?: MouseEvent) => {\n      setOpen(false);\n      if (e) {\n        e.preventDefault();\n        e.stopPropagation();\n      }\n      menuCtx.close();\n    },\n    [menuCtx]\n  );\n\n  const newContext = useMemo(\n    () => ({\n      close() {\n        close();\n      },\n      hasParent: true,\n    }),\n    [close]\n  );\n\n  const openMenu = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    e.preventDefault();\n    setOpen((x) => !x);\n    onClick();\n  };\n  useLayoutEffect(() => {\n    if (isElement(anchor.current) && sizeByButton) {\n      const width = (anchor.current as any).getBoundingClientRect().width;\n      setMinWidthStyle({ width: `${width}px` });\n    } else {\n      setMinWidthStyle({});\n    }\n  }, [children, sizeByButton]);\n\n  const content = (\n    <Popper\n      className={undefined}\n      anchor={anchor.current!}\n      open={open}\n      position={position}\n      align={align}\n      direction={direction}\n    >\n      <div\n        className={cn(styles.dropDown, popupClassName)}\n        style={minWidthStyle}\n      >\n        {children}\n      </div>\n    </Popper>\n  );\n  return (\n    <Button\n      className={cn(styles.menuButton, className)}\n      ref={anchor}\n      onClick={openMenu}\n      contentEditable={false}\n      style={style}\n    >\n      {renderButton({ close, isOpen: open })}\n      {open && (\n        <MenuContext.Provider value={newContext}>\n          {menuCtx.hasParent ? (\n            content\n          ) : (\n            <Backdrop\n              visible={open}\n              ref={backdrop}\n              className={cn(backdropClassName)}\n              onClick={close}\n            >\n              {content}\n            </Backdrop>\n          )}\n        </MenuContext.Provider>\n      )}\n    </Button>\n  );\n}\n", "export function isWindowsOS() {\n  return window.navigator.userAgent.toLowerCase().includes('windows');\n}\n\nexport function isMacOS() {\n  return window.navigator.userAgent.toLowerCase().includes('mac');\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { useLocation, useNavigate } from 'https://esm.sh/react-router@6.7.0';\nimport { layout, styleguide } from '../../../../../../styles/index.ts';\nimport { Button } from '../../../../../../styles/components/buttons.tsx';\nimport { IconOverflow } from '../../../../../../styles/components/icons/index.ts';\nimport Menu, {\n  MenuItem,\n  MenuItemStyle,\n} from '../../../../../../styles/components/menu.tsx';\nimport { useTypographyStyles } from '../../../../../../styles/components/typography.tsx';\nimport { cn, makeStyles } from '../../../../../../styles/css-objects/index.ts';\nimport { useSharedQuery } from '../../../../core/cfds/react/query.ts';\nimport { usePartialVertices } from '../../../../core/cfds/react/vertex.ts';\nimport { isWindowsOS } from '../../../../utils.ts';\nimport { useLogger } from '../../../../core/cfds/react/logger.tsx';\n\nconst useStyles = makeStyles((theme) => ({\n  headerRoot: {\n    basedOn: [layout.column],\n  },\n  headerContent: {\n    height: styleguide.gridbase * 9,\n    alignItems: 'center',\n    basedOn: [layout.row],\n  },\n  headerText: {\n    marginLeft: styleguide.gridbase * 2.5,\n    fontSize: 18,\n    lineHeight: `${styleguide.gridbase * 3}px`,\n    letterSpacing: '1px',\n    basedOn: [useTypographyStyles.bold],\n  },\n  menu: {\n    maxHeight: MenuItemStyle.rules.height * 8,\n    overflowY: 'auto',\n  },\n}));\n\nconst isWindows = isWindowsOS();\nconst OPEN_APP_ENABLED = false; //isWindows && !isElectron();\n\nexport interface ToolbarMenuProps {\n  className?: string;\n}\n\nexport function ToolbarMenu({ className }: ToolbarMenuProps) {\n  const styles = useStyles();\n  const logger = useLogger();\n\n  return (\n    <Menu\n      onClick={() => {\n        logger.log({\n          severity: 'INFO',\n          event: 'Click',\n          source: 'toolbar:menu',\n        });\n      }}\n      className={className}\n      popupClassName={cn(styles.menu)}\n      renderButton={() => <IconOverflow />}\n    >\n      <MenuItem onClick={() => {}}>Sign out of Ovvio</MenuItem>\n      {/* {OPEN_APP_ENABLED && (\n        <MenuItem onClick={downloadApp}>Download Desktop App</MenuItem>\n      )}\n      {OPEN_APP_ENABLED && (\n        <MenuItem onClick={signInToApp}>Sign in to Desktop App</MenuItem>\n      )} */}\n    </Menu>\n  );\n}\n\nexport interface OvvioHeaderProps {\n  className?: any;\n}\n\nexport default function OvvioHeader({ className }: OvvioHeaderProps) {\n  const styles = useStyles();\n  const logger = useLogger();\n  const location = useLocation();\n  const navigate = useNavigate();\n  const selectedWorkspacesQuery = useSharedQuery('selectedWorkspaces');\n  const workspacesQuery = useSharedQuery('workspaces');\n  const partialSelectedWorkspaces = usePartialVertices(\n    selectedWorkspacesQuery.results,\n    ['name']\n  );\n\n  const title = (function () {\n    switch (selectedWorkspacesQuery.count) {\n      case workspacesQuery.count: {\n        return 'All Workspaces';\n      }\n      case 0: {\n        return '';\n      }\n      case 1: {\n        return partialSelectedWorkspaces[0].name;\n      }\n      default: {\n        return 'Multiple Workspaces';\n      }\n    }\n  })();\n\n  const ovvioHeaderClicked = () => {\n    //Route back to / if not there already\n    logger.log({\n      severity: 'INFO',\n      event: 'Click',\n      source: 'toolbar:header',\n    });\n    if (location.pathname !== '/') {\n      navigate('/');\n    }\n  };\n\n  return (\n    <div className={cn(styles.headerRoot, className)}>\n      <div className={cn(styles.headerContent)}>\n        <Button className={cn(styles.headerText)} onClick={ovvioHeaderClicked}>\n          {title}\n        </Button>\n      </div>\n    </div>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport ReactDOM from 'https://esm.sh/react-dom@18.2.0';\nimport { layout, styleguide } from '../../../../../../styles/index.ts';\nimport Layer from '../../../../../../styles/components/layer.tsx';\nimport { cn, makeStyles } from '../../../../../../styles/css-objects/index.ts';\nimport { MediaQueries } from '../../../../../../styles/responsive.ts';\nimport { isServerSide } from '../../../../../../styles/utils/ssr.ts';\nimport ChangesIndicator from './changes-indicator/index.tsx';\nimport { ToolbarMenu } from './header.tsx';\n\nexport const TOOLBAR_HEIGHT = styleguide.gridbase * 9;\n\nconst useStyles = makeStyles((theme) => ({\n  toolbar: {\n    height: TOOLBAR_HEIGHT,\n    backgroundColor: theme.background[0],\n    position: 'relative',\n    alignItems: 'center',\n    justifyContent: 'flex-end',\n    padding: [0, styleguide.gridbase * 2],\n    paddingLeft: 0,\n    flexShrink: 0,\n    borderBottom: `1px solid #d7e3f1`,\n    boxShadow: theme.shadows.z1,\n    basedOn: [layout.row],\n  },\n  logo: {\n    width: styleguide.gridbase * 32,\n    flexShrink: 0,\n  },\n  searchContainer: {\n    [MediaQueries.Computer]: {\n      width: styleguide.gridbase * 38,\n    },\n    [MediaQueries.TabletAndMobile]: {\n      flex: '1 1 auto',\n    },\n  },\n  item: {\n    marginRight: styleguide.gridbase * 2,\n    ':last-child': {\n      marginRight: 0,\n    },\n  },\n  externalContainer: {\n    alignItems: 'center',\n    basedOn: [layout.row],\n  },\n  shareBtn: {\n    margin: [0, styleguide.gridbase],\n  },\n  iconBtn: {\n    marginRight: styleguide.gridbase,\n  },\n  menu: {\n    marginRight: styleguide.gridbase,\n  },\n}));\n\ninterface ToolbarProps {\n  children?: any;\n}\n\nconst TOOLBAR_RIGHT_ID = 'toolbar_00827f';\nconst TOOLBAR_LEFT_ID = 'toolbar_fe702c';\nconst TOOLBAR_CENTER_ID = 'toolbar_a86e6b';\n\nexport default function Toolbar({ children }: ToolbarProps) {\n  const styles = useStyles();\n  return (\n    <Layer>\n      {({ zIndex }) => (\n        <div className={cn(styles.toolbar)} style={{ zIndex }}>\n          <div\n            className={cn(styles.externalContainer)}\n            id={TOOLBAR_LEFT_ID}\n          ></div>\n          <div\n            className={cn(styles.searchContainer, styles.externalContainer)}\n            id={TOOLBAR_CENTER_ID}\n          />\n          {children}\n          <div className={cn(layout.flexSpacer)} />\n          <ChangesIndicator />\n          <div\n            className={cn(styles.externalContainer)}\n            id={TOOLBAR_RIGHT_ID}\n          ></div>\n          <ToolbarMenu className={cn(styles.menu)} />\n        </div>\n      )}\n    </Layer>\n  );\n}\n\nexport interface FixedToolbarItemProps extends React.PropsWithChildren {\n  className?: string;\n}\n\nexport const ToolbarRightItem: React.FC<FixedToolbarItemProps> = ({\n  children,\n  className,\n}) => {\n  return (\n    <ExternalToolbarItem\n      children={children}\n      className={className}\n      side=\"right\"\n    />\n  );\n};\n\nexport const ToolbarLeftItem: React.FC<FixedToolbarItemProps> = ({\n  children,\n  className,\n}) => {\n  return (\n    <ExternalToolbarItem\n      children={children}\n      className={className}\n      side=\"left\"\n    />\n  );\n};\n\nexport const ToolbarCenterItem: React.FC<FixedToolbarItemProps> = ({\n  children,\n  className,\n}) => {\n  return (\n    <ExternalToolbarItem\n      children={children}\n      className={className}\n      side=\"center\"\n    />\n  );\n};\n\ntype Side = 'left' | 'right' | 'center';\nconst SIDE_TO_ID: Record<Side, string> = {\n  left: TOOLBAR_LEFT_ID,\n  right: TOOLBAR_RIGHT_ID,\n  center: TOOLBAR_CENTER_ID,\n};\n\ninterface ExternalToolbarItem extends React.PropsWithChildren {\n  className?: string;\n  side: Side;\n}\n\nconst ExternalToolbarItem: React.FC<ExternalToolbarItem> = ({\n  children,\n  side,\n  className,\n}) => {\n  const styles = useStyles();\n  if (isServerSide) {\n    return null;\n  }\n  const id = SIDE_TO_ID[side];\n  const el = document.getElementById(id);\n  if (!el) {\n    return null;\n  }\n  return ReactDOM.createPortal(\n    <div className={cn(className, styles.item)}>{children}</div>,\n    el\n  );\n};\n\nexport const ToolbarItem = ({ children }: React.PropsWithChildren) => {\n  const styles = useStyles();\n  return <div className={cn(styles.item)}>{children}</div>;\n};\n\nexport { useStyles };\n", "export enum IconSize {\n  XSmall = 4,\n  Small = 16,\n  Medium = 24,\n}\n\nexport enum IconColor {\n  Primary = 'primary',\n  Secondary = 'secondary',\n  Mono = 'mono',\n}\n\nexport interface IconProps {\n  size?: IconSize;\n  className?: string;\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { brandLightTheme as theme } from '../../theme.tsx';\nimport { IconSize, IconProps, IconColor } from './types.ts';\n\nexport interface IconCheckProps extends IconProps {\n  color?: IconColor.Primary | IconColor.Mono;\n}\n\nconst COLOR_MAP = {\n  [IconColor.Primary]: {\n    var1: theme.primary.p9,\n    var2: theme.primary.p10,\n  },\n  [IconColor.Mono]: {\n    var1: theme.mono.m5,\n    var2: theme.mono.m4,\n  },\n};\n\nexport function IconCheck({\n  size = IconSize.Small,\n  className,\n  color = IconColor.Mono,\n}: IconCheckProps) {\n  const colorMap = COLOR_MAP[color];\n  return (\n    <svg\n      className={className}\n      width={size}\n      height={size}\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        opacity=\"0.6\"\n        d=\"M6.3335 11.3333L11.6668 4\"\n        stroke={colorMap.var1}\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M4 8L6.33333 11.3333\"\n        stroke={colorMap.var2}\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n    </svg>\n  );\n}\n", "import { layout } from '../../layout.ts';\nimport React, { MouseEventHandler, useRef } from 'https://esm.sh/react@18.2.0';\nimport { cn, makeStyles } from '../../css-objects/index.ts';\nimport { styleguide } from '../../styleguide.ts';\nimport { brandLightTheme as theme } from '../../theme.tsx';\nimport { IconCheck } from '../new-icons/icon-check.tsx';\nconst BORDER_WIDTH = 2;\nconst useStyles = makeStyles(\n  () => ({\n    container: {\n      position: 'relative',\n      display: 'inline-block',\n      width: styleguide.gridbase * 2,\n      height: styleguide.gridbase * 2,\n      border: `${BORDER_WIDTH}px solid ${theme.mono.m4}`,\n      borderRadius: 2,\n      backgroundColor: 'transparent',\n      boxSizing: 'border-box',\n      cursor: 'pointer',\n      flexShrink: 0,\n    },\n\n    input: {\n      appearance: 'none',\n      display: 'block',\n      opacity: 0,\n    },\n    checkmark: {\n      position: 'absolute',\n      overflow: 'hidden',\n      top: -BORDER_WIDTH,\n      left: -BORDER_WIDTH,\n      bottom: -BORDER_WIDTH,\n      width: 0,\n      ...styleguide.transition.short,\n      transitionProperty: 'width',\n      basedOn: [layout.column, layout.centerCenter],\n    },\n    iconCheck: {\n      position: 'absolute',\n      top: 0,\n      left: 0,\n      bottom: 0,\n    },\n    checked: {\n      checkmark: {\n        width: '100%',\n      },\n      // borderColor: theme.colors.primaryButton,\n    },\n  }),\n  'CheckBox_f22211'\n);\n\ntype CheckboxInputProps = React.ComponentPropsWithoutRef<'input'>;\n\nfunction Checkmark({ isChecked }: { isChecked: boolean }) {\n  const styles = useStyles();\n\n  return (\n    <div className={cn(styles.checkmark)}>\n      <IconCheck className={cn(styles.iconCheck)} />\n    </div>\n  );\n}\n\nexport interface CheckBoxProps extends CheckboxInputProps {\n  checked: boolean;\n  className?: string;\n  color?: string;\n}\n\nexport function CheckBox({\n  checked,\n  onChange,\n  name,\n  disabled = false,\n  className = '',\n  ...rest\n}: CheckBoxProps) {\n  const styles = useStyles();\n  const ref = useRef<HTMLInputElement>();\n  const onClick: MouseEventHandler<HTMLLabelElement> = (e) => {\n    e.stopPropagation();\n    e.preventDefault();\n    if (disabled) {\n      return;\n    }\n    ref.current?.click();\n  };\n  const labelProps: Record<string, any> = {};\n  if (typeof rest.contentEditable !== 'undefined') {\n    labelProps.contentEditable = rest.contentEditable;\n  }\n\n  return (\n    <label\n      className={cn(className, styles.container, checked && styles.checked)}\n      onClick={onClick}\n      {...labelProps}\n    >\n      <Checkmark isChecked={checked} />\n      <input\n        className={cn(styles.input)}\n        type=\"checkbox\"\n        name={name}\n        checked={checked}\n        onChange={onChange}\n        disabled={disabled}\n        {...rest}\n        ref={ref}\n        onClick={(e) => e.stopPropagation()}\n      />\n    </label>\n  );\n}\n\nexport default CheckBox;\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { FontFamily } from '../typography.tsx';\nimport { makeStyles, cn } from '../../css-objects/index.ts';\nimport { styleguide } from '../../styleguide.ts';\nimport { brandLightTheme as theme } from '../../theme.tsx';\n\nconst useStyles = makeStyles(\n  () => ({\n    textField: {\n      height: styleguide.gridbase * 5,\n      boxSizing: 'border-box',\n      borderRadius: 4,\n      fontSize: 14,\n      lineHeight: 16,\n      border: ` solid 1px rgba(156, 178, 205, 0.6)`,\n      outline: 'none',\n      fontFamily: FontFamily,\n      padding: [styleguide.gridbase, styleguide.gridbase * 2],\n      backgroundColor: theme.colors.background,\n      color: theme.colors.text,\n      '::placeholder': {\n        color: theme.colors.placeholderText,\n        opacity: 1,\n      },\n    },\n  }),\n  'TextField_9e7133'\n);\n\nexport { useStyles as useTextfieldStyles };\n\nexport default React.forwardRef(function TextField(\n  props: React.HTMLProps<HTMLInputElement>,\n  ref: any\n) {\n  const styles = useStyles();\n  const { className, ...rest } = props;\n  return (\n    <input ref={ref} className={cn(styles.textField, className)} {...rest} />\n  );\n});\n", "export function formatDateSince(date: Date) {\n  let ms: number =\n    'toMillis' in date ? (date as any).toMillis() : date.getTime();\n\n  let diff = Date.now() - ms;\n  ms = diff % 1000;\n  diff = (diff - ms) / 1000;\n  const seconds = diff % 60;\n  diff = (diff - seconds) / 60;\n  const minutes = diff % 60;\n  diff = (diff - minutes) / 60;\n  const hours = diff % 24;\n  const days = (diff - hours) / 24;\n\n  if (days) {\n    if (days === 1) {\n      return 'Yesterday';\n    }\n    return `${days} Days ago`;\n  }\n  if (hours) {\n    return `${hours} Hours ago`;\n  }\n  if (minutes) {\n    return `${minutes} Minutes ago`;\n  }\n\n  return `${seconds} Seconds ago`;\n}\n\nconst MONTHS = [\n  'January',\n  'February',\n  'March',\n  'April',\n  'May',\n  'June',\n  'July',\n  'August',\n  'September',\n  'October',\n  'November',\n  'December',\n];\n\nconst DAYS = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n\nexport function getLocaleMonths() {\n  return MONTHS;\n}\n\nexport function getLocaleWeekDays() {\n  return DAYS;\n}\n\nexport function getMonthName(index: number) {\n  return MONTHS[index];\n}\n\nexport function getShortMonthName(index: number) {\n  return getMonthName(index).substring(0, 3);\n}\n\nexport function getWeekDay(index: number) {\n  return DAYS[index];\n}\n\nexport function formatTimeDiff(date: Date) {\n  const now = new Date();\n  const year = date.getFullYear();\n  const month = date.getMonth();\n  const day = date.getDate();\n  if (year === now.getFullYear()) {\n    if (month === now.getMonth()) {\n      const daysDiff = now.getDate() - day;\n      if (daysDiff === 0) {\n        return 'Today';\n      }\n      if (daysDiff === 1) {\n        return 'Yesterday';\n      }\n    }\n  }\n\n  return date.toLocaleDateString(undefined, {\n    dateStyle: 'medium',\n  });\n}\n", "import React, { useState, useRef } from 'https://esm.sh/react@18.2.0';\nimport { makeStyles, cn } from '../../css-objects/index.ts';\nimport { styleguide } from '../../styleguide.ts';\nimport { layout } from '../../layout.ts';\nimport { Button } from '../buttons.tsx';\nimport { H3 } from '../texts.tsx';\nimport { getMonthName, getLocaleWeekDays } from '../../utils/dateutils.ts';\n\nconst useStyles = makeStyles(\n  (theme) => ({\n    root: {\n      alignItems: 'stretch',\n      basedOn: [layout.column],\n    },\n    arrowButton: {\n      width: styleguide.gridbase * 4.5,\n      height: styleguide.gridbase * 4.5,\n      borderRadius: styleguide.gridbase * 1.5,\n      border: `1px solid ${theme.background[500]}`,\n    },\n    week: {\n      justifyContent: 'space-between',\n      basedOn: [layout.row],\n    },\n    selected: {},\n    dayTile: {\n      display: 'inline-block',\n      width: styleguide.gridbase * 5,\n      height: styleguide.gridbase * 5,\n      borderRadius: styleguide.gridbase * 2.5,\n      backgroundColor: theme.background[0],\n      transition: `background-color linear ${styleguide.transition.duration.short}ms`,\n      color: '#9cb2cd',\n      ':hover': {\n        backgroundColor: 'rgba(249, 101, 0, 0.15)',\n      },\n      '&selected': {\n        color: 'white',\n        backgroundColor: theme.primary[500],\n      },\n    },\n    month: {\n      marginBottom: styleguide.gridbase * 2,\n      basedOn: [layout.row],\n    },\n    monthText: {\n      textAlign: 'center',\n      basedOn: [layout.flexSpacer],\n    },\n    dayHeader: {\n      display: 'inline-block',\n      color: '#9cb2cd',\n      height: styleguide.gridbase * 3,\n      width: styleguide.gridbase * 5,\n    },\n    otherMonth: {\n      color: '#d8e3f1',\n    },\n  }),\n  'date-picker_089a9b'\n);\n\nfunction getDaysInMonth(year, month) {\n  return new Date(year, month + 1, 0).getDate();\n}\n\nfunction isDateEqual(a, b) {\n  if (!a || !b) {\n    return false;\n  }\n\n  return (\n    a.getFullYear() === b.getFullYear() &&\n    a.getMonth() === b.getMonth() &&\n    a.getDate() === b.getDate()\n  );\n}\n\nfunction MonthView({ month, year, selectedDate, onChange }) {\n  const styles = useStyles();\n  const daysCount = getDaysInMonth(year, month);\n\n  const days = new Array(daysCount);\n  for (let i = 0; i < daysCount; i++) {\n    days[i] = new Date(year, month, i + 1);\n  }\n  const fd = days[0];\n\n  for (let i = 1; fd.getDay() - i >= 0; i++) {\n    days.unshift(new Date(year, month, fd.getDate() - i));\n  }\n\n  const ld = days[days.length - 1];\n  for (let i = ld.getDay() + 1; i < 7; i++) {\n    days.push(new Date(year, month, ld.getDate() + i));\n  }\n  const weeks = [];\n  while (days.length) {\n    weeks.push(days.splice(0, 7));\n  }\n\n  return (\n    <div>\n      <div className={cn(styles.week)}>\n        {getLocaleWeekDays().map((d) => (\n          <span key={d} className={cn(styles.dayHeader)}>\n            {d}\n          </span>\n        ))}\n      </div>\n      {weeks.map((days, i) => (\n        <div key={`${year}|${month}|${i}`} className={cn(styles.week)}>\n          {days.map((d) => (\n            <Button\n              key={d.toDateString()}\n              className={cn(\n                styles.dayTile,\n                d.getMonth() !== month && styles.otherMonth,\n                isDateEqual(d, selectedDate) && styles.selected\n              )}\n              onClick={() => onChange(d)}\n            >\n              {d.getDate()}\n            </Button>\n          ))}\n        </div>\n      ))}\n    </div>\n  );\n}\n\ninterface DatePickerProps {\n  value?: Date;\n  onChange: (date: Date) => void;\n  className?: string;\n}\nexport default function DatePicker({\n  value,\n  onChange,\n  className,\n}: DatePickerProps) {\n  const styles = useStyles();\n  const startDate = useRef(value || new Date());\n  const [month, setMonth] = useState(() => startDate.current.getMonth());\n  const [year, setYear] = useState(() => startDate.current.getFullYear());\n\n  const back = () => {\n    if (month === 0) {\n      setMonth(11);\n      setYear((x) => x - 1);\n    } else {\n      setMonth((x) => x - 1);\n    }\n  };\n\n  const next = () => {\n    if (month === 11) {\n      setMonth(0);\n      setYear((x) => x + 1);\n    } else {\n      setMonth((x) => x + 1);\n    }\n  };\n  return (\n    <div className={cn(styles.root, className)}>\n      <div className={cn(styles.month)}>\n        <Button className={cn(styles.arrowButton)} onClick={back}>\n          {'<'}\n        </Button>\n        <H3 className={cn(styles.monthText)}>\n          {getMonthName(month)} {year}\n        </H3>\n        <Button className={cn(styles.arrowButton)} onClick={next}>\n          {'>'}\n        </Button>\n      </div>\n      <MonthView\n        month={month}\n        year={year}\n        selectedDate={value}\n        onChange={onChange}\n      />\n    </div>\n  );\n}\n", "export enum CHECKBOX_STATES {\n  NONE = 'NONE',\n  SOME = 'SOME',\n  ALL = 'ALL',\n}\n", "import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';\nimport { styleguide } from '../../../styleguide.ts';\nimport { makeStyles, cn } from '../../../css-objects/index.ts';\nimport { CHECKBOX_STATES } from './states.tsx';\n\nconst useStyles = makeStyles(\n  (theme) => ({\n    checkbox: {\n      width: styleguide.gridbase * 1.5,\n      height: styleguide.gridbase * 0.75,\n      borderWidth: 2,\n      borderBottomStyle: 'solid',\n      borderLeftStyle: 'solid',\n      boxSizing: 'border-box',\n      ...styleguide.transition.standard,\n      transitionProperty: 'height, transform',\n      transformOrigin: '35% 50%',\n      transform: 'rotate(-45deg)',\n    },\n    partial: {\n      height: styleguide.gridbase * 0.25,\n      transform: 'rotate(0deg)',\n    },\n  }),\n  'checkbox-icon_22259d'\n);\n\ninterface CheckboxIconProps {\n  fill: string;\n  selectionState: CHECKBOX_STATES;\n  className?: string;\n  style?: any;\n}\n\nexport default function CheckboxIcon({\n  fill,\n  selectionState,\n  className,\n  style = {},\n}: CheckboxIconProps) {\n  const styles = useStyles();\n  const [state, setState] = useState(selectionState);\n  useEffect(() => {\n    if (selectionState === CHECKBOX_STATES.NONE) {\n      return;\n    }\n    setState(selectionState);\n  }, [selectionState]);\n  const styleObj = {\n    ...style,\n    borderColor: fill,\n  };\n  return (\n    <div\n      style={styleObj}\n      className={cn(\n        className,\n        styles.checkbox,\n        state === CHECKBOX_STATES.SOME && styles.partial\n      )}\n    />\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { makeStyles, cn } from '../../../css-objects/index.ts';\nimport { styleguide } from '../../../styleguide.ts';\nimport { layout } from '../../../layout.ts';\nimport Layer from '../../layer.tsx';\nimport { CHECKBOX_STATES } from './states.tsx';\nimport CheckboxIcon from './checkbox-icon.tsx';\n\nexport { CHECKBOX_STATES };\n\nconst useStyles = makeStyles(\n  (theme) => ({\n    container: {\n      position: 'relative',\n      display: 'inline-block',\n      width: styleguide.gridbase * 3,\n      height: styleguide.gridbase * 3,\n      padding: 3,\n      backgroundColor: 'transparent',\n      boxSizing: 'border-box',\n      cursor: 'pointer',\n      basedOn: [layout.column, layout.centerCenter],\n    },\n    borderContainer: {\n      width: styleguide.gridbase * 2.25,\n      height: styleguide.gridbase * 2.25,\n      borderWidth: 2,\n      borderStyle: 'solid',\n      borderRadius: 3,\n      boxSizing: 'border-box',\n      position: 'relative',\n      overflow: 'hidden',\n      basedOn: [layout.column, layout.centerCenter],\n    },\n    background: {\n      position: 'absolute',\n      top: '50%',\n      left: '50%',\n      height: '150%',\n      width: '150%',\n      borderRadius: '50%',\n      transform: 'translate(-50%, -50%) scale(0)',\n      ...styleguide.transition.standard,\n      transitionProperty: 'transform',\n    },\n    toggled: {\n      transform: 'translate(-50%, -50%) scale(1)',\n    },\n    input: {\n      appearance: 'none',\n      display: 'block',\n      opacity: 0,\n    },\n  }),\n  'partial-checkbox_dbb76a'\n);\n\ninterface CheckboxProps {\n  state: CHECKBOX_STATES;\n  onChange: (state: CHECKBOX_STATES) => void;\n  className: string;\n  name?: string;\n  disabled?: boolean;\n  color?: string;\n  symbolColor?: string;\n}\n\nfunction PartialCheckBox({\n  state,\n  onChange,\n  name,\n  disabled,\n  className,\n  color = '#D7E3F1',\n  symbolColor = 'white',\n  ...rest\n}: CheckboxProps) {\n  const styles = useStyles();\n  const ref: any = React.createRef();\n  const onClick = (e) => {\n    e.stopPropagation();\n    e.preventDefault();\n    if (disabled) {\n      return;\n    }\n    ref.current && ref.current.click();\n    return true;\n  };\n\n  const onCheckboxChanged = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    switch (state) {\n      case CHECKBOX_STATES.ALL: {\n        onChange(CHECKBOX_STATES.NONE);\n        break;\n      }\n      case CHECKBOX_STATES.NONE:\n      case CHECKBOX_STATES.SOME:\n      default: {\n        onChange(CHECKBOX_STATES.ALL);\n        break;\n      }\n    }\n  };\n\n  return (\n    <label\n      className={cn(className, styles.container)}\n      onClick={onClick}\n      {...rest}\n    >\n      <div\n        className={cn(styles.borderContainer)}\n        style={{\n          borderColor: color,\n        }}\n      >\n        <div\n          style={{\n            backgroundColor: color,\n          }}\n          className={cn(\n            styles.background,\n            state !== CHECKBOX_STATES.NONE && styles.toggled\n          )}\n        />\n        <Layer>\n          {({ zIndex }) => (\n            <CheckboxIcon\n              style={{ zIndex }}\n              fill={symbolColor}\n              selectionState={state}\n            />\n          )}\n        </Layer>\n      </div>\n      <input\n        className={cn(styles.input)}\n        type=\"checkbox\"\n        name={name}\n        checked={state === CHECKBOX_STATES.ALL}\n        onChange={onCheckboxChanged}\n        disabled={disabled}\n        {...rest}\n        ref={ref}\n        onClick={(e) => e.stopPropagation()}\n      />\n    </label>\n  );\n}\n\nexport default PartialCheckBox;\n", "import CheckBox from './CheckBox.tsx';\nimport TextField from './TextField.tsx';\nimport DatePicker from './date-picker.tsx';\nimport PartialCheckBox from './partial-checkbox/index.tsx';\nexport { CheckBox, TextField, DatePicker, PartialCheckBox };\n", "export default function Illustration({ className }: {className?: string}) {\n\treturn (\n\t\t<svg\n\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\twidth=\"573\"\n\t\t\theight=\"289\"\n\t\t\tviewBox=\"0 0 573 289\"\n\t\t\tclassName={className}>\n\t\t\t<g fill=\"none\" fillRule=\"evenodd\">\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#F8F7FF\"\n\t\t\t\t\td=\"M7.87 288.99s-4.079-29.24 27.595-61.51c31.673-32.271 80.19-6.06 71.073-42.034-9.118-35.973-57.204-70.264-42.52-97.58 17.613-32.752 61.668-21.69 80-1.203 84.942 94.984 41.703 4.762 101.45-30.106 39.112-22.844 73.281-5.915 103.323 43.14 33.065 54.008 62.579 21.93 65.89-3.848 7.343-56.894 78.224-35.3 62.147 18.516-4.319 14.476-47.366 68.869-4.799 90.751 79.855 41.071 77.94 83.874 77.94 83.874H7.87z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#F8F7FF\"\n\t\t\t\t\td=\"M318.461 15.053c4.271-7.262 30.186-20.247 42.327-12.84 16.893 10.291 20.924 44.293 6.095 55.306-9.214 6.83-60.563-21.738-48.422-42.466z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M298.833 99.937c-1.68-1.876-3.359-3.655-3.695-6.589-.816-7.214 2.352-7.887 1.248-15.1-1.104-7.215-6.43-6.301-7.582-13.515a8.843 8.843 0 0 1-.048-2.5c.431-1.01.815-2.069 1.103-3.175l.144-.577c.432-1.924.528-3.944.288-6.012-1.2-10.292-10.462-17.65-20.683-16.447-10.27 1.202-17.613 10.484-16.413 20.728.24 2.068.816 3.991 1.632 5.77.096.193.144.337.24.53.527 1.01 1.103 1.972 1.775 2.837.24.722.432 1.54.48 2.453.528 7.262-4.847 7.599-4.319 14.86.528 7.263 3.791 7.167 4.607 14.429.336 2.933-.864 5.097-2.112 7.262-1.2 2.212-2.399 4.424-2.063 7.55 1.008 8.945 9.118 15.39 18.044 14.332l16.7-1.924c8.927-1.01 15.357-9.138 14.302-18.083-.288-3.078-1.968-5.001-3.648-6.829z\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"262.841\"\n\t\t\t\t\tcy=\"117.925\"\n\t\t\t\t\tfill=\"#FFD4CC\"\n\t\t\t\t\trx=\"11.182\"\n\t\t\t\t\try=\"11.206\"\n\t\t\t\t\ttransform=\"rotate(-5.443 262.841 117.925)\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"219.559\"\n\t\t\t\t\tcy=\"56.562\"\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\trx=\"2.4\"\n\t\t\t\t\try=\"2.404\"\n\t\t\t\t\ttransform=\"rotate(-22.68 219.56 56.562)\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M254.443 81.373c-.432 3.415 2.015 6.54 5.423 6.974 3.407.432 6.526-2.02 6.958-5.435.432-3.414-2.015-6.54-5.423-6.973-3.407-.433-6.526 2.02-6.958 5.434zM223.921 52.085c.144-.337.192-.722.24-1.107.096-1.875-1.344-3.414-3.215-3.51-1.872-.097-3.408 1.346-3.504 3.222l-.287 5.771 4.607 1.01 2.16-5.386z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFD4CC\"\n\t\t\t\t\td=\"M232.8 81.95c-2.304 1.01-3.36 3.655-2.352 5.964 1.008 2.308 3.647 3.366 5.95 2.356 2.304-1.01 3.36-3.655 2.352-5.963-1.008-2.309-3.647-3.367-5.95-2.357z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFD4CC\"\n\t\t\t\t\td=\"M259.29 75.939l-25.675 5.723 1.392 8.945 26.202-2.308z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M238.462 83.778l-16.844-28.423-4.272 2.164 13.102 30.395z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFD4CC\"\n\t\t\t\t\td=\"M254.395 81.662l-2.64 34.915 22.172 2.741 13.629-35.348c.912-2.356-.624-4.905-3.12-5.194l-23.035-2.837a6.258 6.258 0 0 0-7.006 5.723z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFD4CC\"\n\t\t\t\t\td=\"M268.216 88.924l-9.31 9.33a6.296 6.296 0 0 1-6.959 1.298c-3.167-1.443-4.559-5.098-3.12-8.272.337-.721.769-1.346 1.297-1.827l9.31-9.378 8.782 8.849z\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"260.66\"\n\t\t\t\t\tcy=\"82.034\"\n\t\t\t\t\tfill=\"#FFD4CC\"\n\t\t\t\t\trx=\"6.246\"\n\t\t\t\t\try=\"6.244\"\n\t\t\t\t\ttransform=\"rotate(-50.095 260.66 82.034)\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#A796F2\"\n\t\t\t\t\td=\"M251.707 117.924h22.316l1.2.913c4.03 3.175 6.43 8.032 6.43 13.13v16.448h-32.825v-18.228a27.4 27.4 0 0 1 2.88-12.263z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFD4CC\"\n\t\t\t\t\td=\"M288.468 88.731c-2.064 2.742-6 3.319-8.735 1.25-2.735-2.067-3.31-6.01-1.247-8.752 2.063-2.741 5.998-3.319 8.734-1.25a6.28 6.28 0 0 1 1.248 8.752zM223.873 59.202l-4.75 2.405 11.325 26.307 8.014-4.136z\"\n\t\t\t\t/>\n\t\t\t\t<g fill=\"#FF95A9\">\n\t\t\t\t\t<path d=\"M266.78 63.09l10.345 2.113-2.599 12.77-10.344-2.114z\" />\n\t\t\t\t\t<path d=\"M274.503 77.959c-.576 2.885-3.36 4.713-6.24 4.136-2.879-.578-4.702-3.367-4.126-6.253.576-2.885 3.359-4.713 6.238-4.136 2.88.626 4.751 3.415 4.128 6.253z\" />\n\t\t\t\t</g>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M278.198 62.328l-2.352-.48.96-4.714 2.352.481c1.295.289 2.16 1.54 1.871 2.838a2.435 2.435 0 0 1-2.831 1.875z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M262.841 44.919l17.66 3.607-4.655 22.844-10.99-2.26c-4.415-.914-7.102-5.339-5.95-9.667l3.935-14.524z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M278.678 57.52l.48.095 2.783-13.61-14.013-2.838c-3.695-.769-7.295 1.636-8.062 5.339l-.048.288.48.097a18.733 18.733 0 0 1 10.317 6.011 15.347 15.347 0 0 0 8.063 4.617z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M261.21 87.144l1.343-11.061 16.796 2.068z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#DDD6FF\"\n\t\t\t\t\td=\"M169.453 155.292h147.425V288.99H169.453z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#C4B8FF\"\n\t\t\t\t\td=\"M169.453 144.519h147.425v10.725H169.453z\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"175.835\"\n\t\t\t\t\tcy=\"149.905\"\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\trx=\"1.968\"\n\t\t\t\t\try=\"1.972\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\td=\"M184.09 149.905a1.948 1.948 0 0 1-1.968 1.972 1.948 1.948 0 0 1-1.968-1.972c0-1.106.864-1.971 1.968-1.971s1.967.913 1.967 1.971z\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"188.457\"\n\t\t\t\t\tcy=\"149.905\"\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\trx=\"1.968\"\n\t\t\t\t\try=\"1.972\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\td=\"M203.525 178.569h162.446V288.99H203.525z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#C4B8FF\"\n\t\t\t\t\td=\"M189.608 288.99l13.15-114.51.767-6.684V288.99z\"\n\t\t\t\t/>\n\t\t\t\t<g\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\ttransform=\"translate(433.83 84.643)\">\n\t\t\t\t\t<ellipse\n\t\t\t\t\t\tcx=\"5.551\"\n\t\t\t\t\t\tcy=\"5.813\"\n\t\t\t\t\t\trx=\"3.845\"\n\t\t\t\t\t\try=\"3.842\"\n\t\t\t\t\t\ttransform=\"rotate(-54.886 5.551 5.813)\"\n\t\t\t\t\t/>\n\t\t\t\t\t<path d=\"M4.415 9.619a2.873 2.873 0 0 0-3.935.961 2.887 2.887 0 0 0 .96 3.944 2.873 2.873 0 0 0 3.935-.962 2.887 2.887 0 0 0-.96-3.943z\" />\n\t\t\t\t\t<path d=\"M1.872 4.857L.144 11.35l5.23 2.212L8.83 7.791z\" />\n\t\t\t\t</g>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"427.116\"\n\t\t\t\t\tcy=\"133.535\"\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\trx=\"6.531\"\n\t\t\t\t\try=\"6.536\"\n\t\t\t\t\ttransform=\"rotate(-35.845 427.116 133.535)\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\td=\"M395.341 138.46l31.434 1.586 1.92-12.888-30.522-7.647z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\td=\"M434.021 95.705l5.567 1.49-5.999 37.369-12.621-3.319 11.421-30.971.96-2.694z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\td=\"M434.021 95.705l5.567 1.49-.864 5.387-6.335-2.308.96-2.694z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M434.021 95.705l5.567 1.49-.384 2.502-5.855-2.165z\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"395.863\"\n\t\t\t\t\tcy=\"128.817\"\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\trx=\"9.607\"\n\t\t\t\t\try=\"9.61\"\n\t\t\t\t\ttransform=\"rotate(-42.074 395.863 128.817)\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"367.255\"\n\t\t\t\t\tcy=\"131.143\"\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\trx=\"9.598\"\n\t\t\t\t\try=\"9.618\"\n\t\t\t\t\ttransform=\"rotate(-2.882 367.255 131.143)\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\td=\"M407.915 177.944l14.06 38.282-10.221 4.328-15.885-37.513z\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"380.909\"\n\t\t\t\t\tcy=\"183.902\"\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\trx=\"6.527\"\n\t\t\t\t\try=\"6.589\"\n\t\t\t\t\ttransform=\"rotate(-5.918 380.91 183.902)\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\td=\"M407.915 177.944c1.391 3.318-.144 7.214-3.456 8.608-3.311 1.395-7.198-.144-8.59-3.462-1.392-3.319.144-7.214 3.455-8.61 3.312-1.442 7.199.097 8.59 3.464z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\td=\"M402.204 125.234l5.423 47.66-34.553 5.675-10.03-46.939c-.816-3.751 1.68-7.454 5.47-8.08l25.915-4.232c3.792-.625 7.343 2.068 7.775 5.916z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\td=\"M407.627 172.894l.72 6.54.047.337c.384 3.463-2.015 6.637-5.47 7.214l-20.972 3.415c-3.455.577-6.719-1.684-7.486-5.098l-.048-.337-1.392-6.444 34.6-5.627z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\td=\"M387.375 182.85l6.574 40.253-10.941 1.78-8.542-39.918zM403.835 283.988c.096 2.26-1.631 4.136-3.839 4.233a4.034 4.034 0 0 1-4.223-3.848c-.096-2.26 1.632-4.136 3.84-4.232 2.255-.144 4.126 1.587 4.222 3.847zM393.278 274.899a4.089 4.089 0 0 1-5.375 1.972 4.105 4.105 0 0 1-1.968-5.387 4.089 4.089 0 0 1 5.375-1.972 4.105 4.105 0 0 1 1.968 5.387z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\td=\"M376.29 122.3l14.108 32.8 2.064-25.201-1.632-9.955z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\td=\"M390.83 119.944l1.632 9.955-.864 10.532-1.2 14.669-5.855-13.515-8.254-19.285z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\td=\"M421.928 220.746a5.557 5.557 0 0 1-7.39 2.693c-2.784-1.298-3.984-4.616-2.688-7.406a5.557 5.557 0 0 1 7.39-2.693c2.784 1.298 3.983 4.617 2.688 7.406zM393.95 223.103a5.585 5.585 0 0 1-4.56 6.396 5.576 5.576 0 0 1-6.382-4.569 5.585 5.585 0 0 1 4.559-6.396c3.023-.529 5.903 1.539 6.382 4.569z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\td=\"M395.821 284.854l-12.813-59.972 10.941-1.78 9.886 60.405z\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"390.368\"\n\t\t\t\t\tcy=\"175.744\"\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\trx=\"17.521\"\n\t\t\t\t\try=\"17.551\"\n\t\t\t\t\ttransform=\"rotate(-18.922 390.368 175.744)\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M391.598 140.431l-1.2 14.669-5.855-13.515.144-18.323.96-.144zM407.963 288.99h-12.19v-4.81h8.11l4.655 2.55c.384.192.624.625.624 1.058a1.22 1.22 0 0 1-1.2 1.202z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M374.177 109.467l11.84-1.942 2.1 12.863-11.84 1.941z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M391.31 96.282l-1.68.433-2.831-11.446 1.68-.433c3.167-.77 6.334 1.154 7.15 4.328.768 3.126-1.152 6.348-4.319 7.118zM380.032 110.566l-4.223 1.058a4.368 4.368 0 0 1-5.279-3.175l-1.151-4.665 8.446-2.116 2.207 8.898z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M390.062 96.282l-4.607 1.154-3.647-14.764 4.127-1.01c2.784-.674 5.663 1.01 6.335 3.847l1.248 5.05c.623 2.5-.912 5.098-3.456 5.723z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M392.318 112.104l-15.021 3.752-4.175-16.977c-1.296-5.146 1.871-10.388 7.006-11.639 4.991-1.25 10.03 1.684 11.518 6.59l3.84 12.792a4.415 4.415 0 0 1-3.168 5.482z\"\n\t\t\t\t/>\n\t\t\t\t<path d=\"M393.997 101.716l-2.399-7.983 2.4 7.983z\" />\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M374.226 86.952l1.247-.337 3.936 15.967-9.742 2.405-1.872-7.503c-1.104-4.617 1.728-9.378 6.43-10.532z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M374.754 105.468l2.543-.626-.624-2.548c-.336-1.395-1.776-2.26-3.167-1.924-1.392.336-2.256 1.78-1.92 3.174.336 1.443 1.776 2.26 3.168 1.924z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M392.318 90.896l-9.646 2.404c-3.935.962-7.918-1.443-8.878-5.386-.48-1.876.672-3.751 2.543-4.232 1.872-.481 3.743.673 4.223 2.549.048.192.24.336.432.288l9.646-2.405 1.68 6.782z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M387.903 88.347l-4.8 1.202c-1.87.48-3.742-.673-4.222-2.549-.48-1.876.672-3.751 2.543-4.232l4.8-1.202c1.87-.481 3.742.673 4.222 2.548.48 1.876-.672 3.8-2.543 4.233zM396.493 109.988c.576 1.924-.576 3.944-2.496 4.425l-6.718 1.683c-3.743.914-7.535-1.346-8.446-5.098l-1.968-7.935 2.544-.625c.383 1.539 1.967 2.5 3.503 2.116l11.133-2.741 2.448 8.175z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\td=\"M393.278 104.362c.384 1.394-.48 2.837-1.92 3.222-1.392.384-2.831-.481-3.215-1.924l5.135-1.298z\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"342.033\"\n\t\t\t\t\tcy=\"161.263\"\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\trx=\"6.532\"\n\t\t\t\t\try=\"6.536\"\n\t\t\t\t\ttransform=\"rotate(-35.837 342.033 161.263)\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\td=\"M374.082 137.882l-27.403 27.99-9.982-8.416 22.748-31.886z\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"381.524\"\n\t\t\t\t\tcy=\"167.302\"\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\trx=\"3.84\"\n\t\t\t\t\try=\"3.847\"\n\t\t\t\t\ttransform=\"rotate(-16.141 381.524 167.302)\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M377.729 166.305c.768-1.395.24-3.174-1.152-3.943-1.392-.77-3.167-.24-3.935 1.154-.768 1.394-.24 3.174 1.152 3.943 1.391.77 3.167.24 3.935-1.154z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M382.384 163.564l-6.575-1.443-2.015 5.338 5.902 3.27z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\td=\"M374.034 161.688l-.672 6.108h-31.338l1.44-12.937 27.738 6.204z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\td=\"M374.034 161.688l-.672 6.108h-2.928l.768-6.733z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M375.81 162.121l-.625 5.675h-1.823l.672-6.108z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#A796F2\"\n\t\t\t\t\td=\"M203.525 167.796h162.446v10.725H203.525z\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"209.908\"\n\t\t\t\t\tcy=\"173.182\"\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\trx=\"1.968\"\n\t\t\t\t\try=\"1.972\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"216.243\"\n\t\t\t\t\tcy=\"173.182\"\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\trx=\"1.968\"\n\t\t\t\t\try=\"1.972\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"222.529\"\n\t\t\t\t\tcy=\"173.182\"\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\trx=\"1.968\"\n\t\t\t\t\try=\"1.972\"\n\t\t\t\t/>\n\t\t\t\t<g fill=\"#DDD6FF\">\n\t\t\t\t\t<path d=\"M222.721 189.197h1v89.116h-1zM247.34 189.197h1v89.116h-1zM271.96 189.197h1v89.116h-1zM296.578 189.197h1v89.116h-1zM321.196 189.197h1v89.116h-1zM345.863 189.197h1v89.116h-1z\" />\n\t\t\t\t\t<path d=\"M215.81 196.267h137.876v1H215.81zM215.81 220.939h137.876v1H215.81zM215.81 245.61h137.876v1H215.81zM215.81 270.33h137.876v1H215.81z\" />\n\t\t\t\t</g>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#C4B8FF\"\n\t\t\t\t\td=\"M223.873 271.484l-1.344-1.394 24.62-24.624 25.29-25.393 24.619 24.672 48.614-48.67 1.343 1.346-49.957 50.065-24.62-24.672-23.946 23.999z\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"223.201\"\n\t\t\t\t\tcy=\"270.811\"\n\t\t\t\t\tfill=\"#FF809F\"\n\t\t\t\t\trx=\"3.359\"\n\t\t\t\t\try=\"3.367\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"247.82\"\n\t\t\t\t\tcy=\"246.139\"\n\t\t\t\t\tfill=\"#FF809F\"\n\t\t\t\t\trx=\"3.359\"\n\t\t\t\t\try=\"3.367\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"272.439\"\n\t\t\t\t\tcy=\"221.42\"\n\t\t\t\t\tfill=\"#FF809F\"\n\t\t\t\t\trx=\"3.359\"\n\t\t\t\t\try=\"3.367\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"297.058\"\n\t\t\t\t\tcy=\"246.139\"\n\t\t\t\t\tfill=\"#FF809F\"\n\t\t\t\t\trx=\"3.359\"\n\t\t\t\t\try=\"3.367\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"321.725\"\n\t\t\t\t\tcy=\"221.42\"\n\t\t\t\t\tfill=\"#FF809F\"\n\t\t\t\t\trx=\"3.359\"\n\t\t\t\t\try=\"3.367\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"346.343\"\n\t\t\t\t\tcy=\"196.748\"\n\t\t\t\t\tfill=\"#FF809F\"\n\t\t\t\t\trx=\"3.359\"\n\t\t\t\t\try=\"3.367\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M296.386 145.096c.864-1.01.816-2.5-.192-3.414-1.008-.866-2.496-.818-3.407.192-.864 1.01-.816 2.5.192 3.415 1.007.913 2.543.817 3.407-.193z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M300.849 143.557c.336.144.672.337.912.577 1.392 1.25 1.487 3.367.288 4.762-1.248 1.394-3.36 1.49-4.751.288l-4.32-3.847 2.544-3.992 5.327 2.212z\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"288.491\"\n\t\t\t\t\tcy=\"110.923\"\n\t\t\t\t\tfill=\"#FFD4CC\"\n\t\t\t\t\trx=\"4.518\"\n\t\t\t\t\try=\"4.514\"\n\t\t\t\t\ttransform=\"rotate(-59.584 288.491 110.923)\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFD4CC\"\n\t\t\t\t\td=\"M289.667 84.163l3.264 26.21-8.878 1.683-6.623-25.537z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M292.93 110.373l4.176 32.8-4.703.913-8.35-32.03z\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"283.457\"\n\t\t\t\t\tcy=\"84.939\"\n\t\t\t\t\tfill=\"#FFD4CC\"\n\t\t\t\t\trx=\"6.25\"\n\t\t\t\t\try=\"6.241\"\n\t\t\t\t\ttransform=\"rotate(-64.355 283.457 84.94)\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFD4CC\"\n\t\t\t\t\td=\"M296.53 138.748l-5.279 1.01-7.198-27.702 8.878-1.683z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\td=\"M267.448 61.847a2.57 2.57 0 0 1-3.12 2.02 2.575 2.575 0 0 1-2.015-3.126l5.135 1.106z\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"54.329\"\n\t\t\t\t\tcy=\"284.883\"\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\trx=\"4.031\"\n\t\t\t\t\try=\"4.039\"\n\t\t\t\t\ttransform=\"rotate(-13.286 54.33 284.883)\"\n\t\t\t\t/>\n\t\t\t\t<g\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\ttransform=\"translate(88.781 187.562)\">\n\t\t\t\t\t<path d=\"M2.256.625A3.81 3.81 0 0 0 .48 5.771a3.794 3.794 0 0 0 5.135 1.78A3.81 3.81 0 0 0 7.39 2.405C6.48.529 4.175-.29 2.256.625z\" />\n\t\t\t\t\t<ellipse\n\t\t\t\t\t\tcx=\"5.952\"\n\t\t\t\t\t\tcy=\"10.58\"\n\t\t\t\t\t\trx=\"2.88\"\n\t\t\t\t\t\try=\"2.885\"\n\t\t\t\t\t\ttransform=\"rotate(-23.509 5.952 10.58)\"\n\t\t\t\t\t/>\n\t\t\t\t\t<path d=\"M7.726 3.51l1.056 6.638L3.36 11.83.48 5.77z\" />\n\t\t\t\t</g>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"114.416\"\n\t\t\t\t\tcy=\"230.696\"\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\trx=\"6.539\"\n\t\t\t\t\try=\"6.528\"\n\t\t\t\t\ttransform=\"rotate(-70.646 114.416 230.696)\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\td=\"M145.506 238.685l-31.386-1.443-.672-13.033 31.098-4.665z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\td=\"M97.036 196.411l-4.895 2.982 16.364 34.146 11.134-6.781-19.724-26.451-1.68-2.309z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\td=\"M97.036 196.411l-4.895 2.982 2.4 4.954 5.374-4.04-1.68-2.309z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M97.036 196.411l-4.895 2.982 1.103 2.308 4.991-3.703z\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"145.989\"\n\t\t\t\t\tcy=\"229.05\"\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\trx=\"9.608\"\n\t\t\t\t\try=\"9.61\"\n\t\t\t\t\ttransform=\"rotate(-42.398 145.989 229.05)\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"215.667\"\n\t\t\t\t\tcy=\"286.104\"\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\trx=\"2.879\"\n\t\t\t\t\try=\"2.886\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"225.025\"\n\t\t\t\t\tcy=\"287.066\"\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\trx=\"1.92\"\n\t\t\t\t\try=\"1.924\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"171.643\"\n\t\t\t\t\tcy=\"232.866\"\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\trx=\"9.605\"\n\t\t\t\t\try=\"9.611\"\n\t\t\t\t\ttransform=\"rotate(-36.571 171.643 232.866)\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\td=\"M139.555 225.556l-6.239 63.434h26.203c4.559 0 8.542-3.222 9.406-7.743l9.886-49.872c.767-3.751-1.824-7.407-5.615-7.984l-25.963-3.847c-3.791-.577-7.294 2.164-7.678 6.012z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\td=\"M165.421 222.237l-13.58 33.04-2.496-25.2 1.487-10.004z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\td=\"M150.832 220.073l-1.487 10.003 1.056 10.485 1.44 14.716 5.614-13.658 7.966-19.382z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M150.4 240.56l1.44 14.717 5.615-13.658-.432-18.324-.96-.144zM163.118 211.176l4.367.144c2.4.337 4.607-1.298 4.943-3.703l.72-4.713-8.638-1.299-1.392 9.57z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M165.489 222.23l-11.868-1.762 2.23-15.08 11.868 1.762z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M153.088 214.687l13.197 1.971 4.223-28.711-19.388-2.886-3.311 22.508a6.315 6.315 0 0 0 5.279 7.118z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M166.909 185.735l-1.296-.193-2.543 17.218 9.934 1.49 1.248-8.56c.72-4.81-2.592-9.282-7.343-9.955z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M158.079 189.63l4.75.722c1.92.288 3.792-.914 4.128-2.838.336-1.924-1.008-3.751-2.927-4.04l-4.751-.721c-1.92-.289-3.792.914-4.127 2.837-.336 1.876 1.007 3.752 2.927 4.04z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M159.567 189.823l4.75.72c1.92.29 3.792-.913 4.128-2.837.336-1.923-1.008-3.75-2.928-4.04l-4.75-.72c-1.92-.29-3.792.913-4.128 2.837-.336 1.923 1.008 3.751 2.928 4.04z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M152.752 188.813l4.751.721c1.92.289 3.791-.914 4.127-2.837.336-1.924-1.008-3.752-2.927-4.04l-4.751-.722c-1.92-.288-3.791.914-4.127 2.838-.384 1.924.96 3.751 2.927 4.04zM164.126 204.587c.72.096 1.391-.385 1.487-1.106l.048-.337-2.591-.384-.048.336c-.096.722.384 1.347 1.104 1.491z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M149.249 193.718l5.615.818c2.255.336 4.51-1.106 4.895-3.367.383-2.308-1.2-4.472-3.456-4.81l-5.615-.817c-2.255-.336-4.51 1.106-4.895 3.367-.431 2.26 1.152 4.472 3.456 4.81z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M151.6 194.055l4.751.721c1.92.289 3.791-.914 4.127-2.837.336-1.924-1.007-3.752-2.927-4.04l-4.751-.722c-1.92-.288-3.791.914-4.127 2.838-.336 1.924 1.008 3.751 2.927 4.04zM147.473 192.131l2.592.385-1.44 9.763c-1.44-.193-2.4-1.54-2.208-2.982l1.056-7.166z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M164.504 195.961l-11.726-1.741.978-6.613 11.725 1.742z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M168.013 205.164l-2.592-.385.384-2.597c.192-1.442 1.536-2.404 2.976-2.212 1.44.193 2.4 1.54 2.207 2.982-.24 1.443-1.583 2.405-2.975 2.212z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\td=\"M156.111 207.665a2.58 2.58 0 0 1-2.975 2.212 2.584 2.584 0 0 1-2.208-2.981l5.183.769z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M218.066 284.47l-4.415 3.654-2.591-2.549 4.607-4.616z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\td=\"M215.667 280.959l-4.607 4.616-2.208-2.164v-.048l4.607-4.617.432-.433z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\td=\"M213.891 278.313l-.432.433-4.607 4.617v.048l-9.358-9.33-2.207-2.164-32.394-32.222 14.733-12.216 26.107 38.715 1.68 2.549z\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"141.57\"\n\t\t\t\t\tcy=\"282.401\"\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\trx=\"6.527\"\n\t\t\t\t\try=\"6.541\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"103.898\"\n\t\t\t\t\tcy=\"242.34\"\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\trx=\"5.567\"\n\t\t\t\t\try=\"5.579\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"76.219\"\n\t\t\t\t\tcy=\"284.163\"\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\trx=\"4.031\"\n\t\t\t\t\try=\"4.039\"\n\t\t\t\t\ttransform=\"rotate(-13.286 76.219 284.163)\"\n\t\t\t\t/>\n\t\t\t\t<ellipse\n\t\t\t\t\tcx=\"141.57\"\n\t\t\t\t\tcy=\"282.401\"\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\trx=\"6.527\"\n\t\t\t\t\try=\"6.541\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\td=\"M146.225 277.833l-38.344-39.389-8.062 7.6 36.856 40.782z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\td=\"M99.195 239.406l-26.442 42.61 6.766 4.521 28.938-40.975z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M68.098 288.99h12.19v-4.81h-8.111l-4.655 2.55c-.384.192-.624.625-.624 1.058-.048.673.528 1.202 1.2 1.202z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\td=\"M141.186 275.86l-87.101 5.002.24 8.128h87.245z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#A796F2\"\n\t\t\t\t\td=\"M206.117 116.625l1.631-7.07a4.454 4.454 0 0 1 3.36-3.366c3.263-.77 6.143 2.164 5.423 5.435a4.454 4.454 0 0 1-3.36 3.366l-7.054 1.635zM196.71 119.944l-1.247-5.387a3.436 3.436 0 0 0-2.543-2.549c-2.448-.577-4.703 1.635-4.128 4.136a3.436 3.436 0 0 0 2.544 2.55l5.375 1.25zM202.038 110.71l3.79-6.108c.913-1.443.913-3.27 0-4.761-1.727-2.838-5.854-2.838-7.582 0-.911 1.443-.911 3.27 0 4.761l3.792 6.108z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M202.518 131.726h-.96v-11.205l9.646-9.715.72.673-9.406 9.426z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M202.518 136.295h-.96v-10.82l-8.638-8.657.671-.674 8.927 8.946z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M201.558 104.218h1v27.076h-1z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF809F\"\n\t\t\t\t\td=\"M204.677 144.52h-5.327c-4.079 0-7.39-3.32-7.39-7.407v-8.609h20.108v8.609a7.371 7.371 0 0 1-7.39 7.406z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\td=\"M191.96 131.775h20.108v1H191.96z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#C4B8FF\"\n\t\t\t\t\td=\"M365.491 224.305h1v64.685h-1zM365.491 215.167h1v5.386h-1zM365.491 167.796h1v36.07h-1z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\td=\"M351.718 178.088h5.087v1h-5.087zM203.525 178.088h139.411v1H203.525zM256.602 154.811h60.275v1h-60.275zM243.981 154.811h8.974v1h-8.974zM169.453 154.811h44.823v1h-44.823zM236.446 154.811h2.16v1h-2.16z\"\n\t\t\t\t/>\n\t\t\t\t<path fill=\"#C4B8FF\" d=\"M0 288.99h572.904v1H0z\" />\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M390.878 280.959l-3.071 5.915a4.1 4.1 0 0 1-5.423 1.827c-1.488-.72-2.4-2.212-2.4-3.75 0-.578.144-1.203.384-1.732l2.736-5.916 7.774 3.656z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#7760DB\"\n\t\t\t\t\td=\"M421.88 220.746l-26.539 51.556-4.463 8.657-7.678-3.607 4.223-9.138 24.427-52.18z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FF95A9\"\n\t\t\t\t\td=\"M215.667 288.99h9.358l.384-3.8-9.166-1.923z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\td=\"M488.73 217.476l-39.496 43.813 39.496-43.813zM493.913 211.705l-2.304 2.597 2.304-2.597z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#C4B8FF\"\n\t\t\t\t\td=\"M491.23 213.98l2.318-2.568.712.645-2.318 2.568z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFD4CC\"\n\t\t\t\t\td=\"M251.755 87.048l3.983-3.992-3.983 3.992z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\td=\"M251.436 86.718l3.97-3.98.678.68-3.97 3.98z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFD4CC\"\n\t\t\t\t\td=\"M256.938 100.13c-.768.336-1.631.48-2.495.48-.96 0-1.872-.192-2.784-.577-2.687-1.202-4.223-4.04-3.935-6.829l9.214 6.925z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#FFF\"\n\t\t\t\t\td=\"M254.49 101.091a7.19 7.19 0 0 1-2.975-.625 7.289 7.289 0 0 1-4.223-7.31l.96.096a6.243 6.243 0 0 0 3.647 6.348c1.536.722 3.312.722 4.847.097l.336.913c-.816.289-1.68.481-2.591.481z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#40327A\"\n\t\t\t\t\td=\"M388.157 265.556l13.007-27.778.868.409-13.006 27.777zM384.227 273.915l1.549-3.31.869.41-1.55 3.308zM402.892 200.798l.884-.376 7.549 17.792-.884.377zM399.819 193.599l.883-.376 1.99 4.691-.883.376zM351.347 157.13l.21-.938 5.947 1.335-.21.938zM358.651 158.802l.21-.938 15.266 3.425-.21.939zM405.504 139.453l.05-.96 15.432.79-.05.961zM49.526 276.774v12.216h4.799v-8.128l-2.544-4.665c-.192-.384-.624-.625-1.056-.625-.671 0-1.2.53-1.2 1.202zM181.758 257.146l.676-.683 14.487 14.387-.676.684zM198.056 273.34l.675-.682 10.431 10.359-.675.683zM122.237 238.073l.044-.96 16.06.73-.043.962zM130.55 276.03l5.219-.354.064.96-5.218.353zM105.853 277.72l19.583-1.325.065.96-19.583 1.325zM82.091 278.787l5.99-.345.054.96-5.989.345zM89.96 278.345l2.3-.133.055.96-2.3.133z\"\n\t\t\t\t/>\n\t\t\t\t<path\n\t\t\t\t\tfill=\"#C4B8FF\"\n\t\t\t\t\tfillRule=\"nonzero\"\n\t\t\t\t\td=\"M234.095 25.297h-.96c0-4.52-3.647-8.176-8.158-8.176v-.962c4.51 0 8.158-3.655 8.158-8.176h.96c0 4.521 3.647 8.176 8.158 8.176v.962c-4.51 0-8.158 3.655-8.158 8.176zm-6.19-8.657a9.139 9.139 0 0 1 5.71 5.723 9.139 9.139 0 0 1 5.71-5.723 9.139 9.139 0 0 1-5.71-5.723c-.912 2.693-3.071 4.81-5.71 5.723z\"\n\t\t\t\t/>\n\t\t\t</g>\n\t\t</svg>\n\t);\n}\n", "import React, { useContext } from 'https://esm.sh/react@18.2.0';\n\ntype LanguageStrings<T> = {\n  [K in keyof T]: T[K];\n};\n\nexport type SupportedLanguage = 'en';\n\ntype Localizations<T> = {\n  [K in SupportedLanguage]: LanguageStrings<T>;\n};\n\ntype UseStrings<T> = () => LanguageStrings<T>;\n\nconst ctx = React.createContext<SupportedLanguage>('en');\n\nexport function format(str: string, dict: Record<string, any>): string {\n  return Object.entries(dict).reduce((current, [key, value]) => {\n    const varName = `{${key}}`;\n    const formattedValue = value;\n    let index = current.indexOf(varName);\n    while (index !== -1) {\n      current = `${current.substring(\n        0,\n        index\n      )}${formattedValue}${current.substring(index + varName.length)}`;\n      index = current.indexOf(varName);\n    }\n    return current;\n  }, str);\n}\n\nexport function useCurrentLanguage(): SupportedLanguage {\n  return useContext(ctx);\n}\n\nexport function createUseStrings<T>(strings: Localizations<T>): UseStrings<T> {\n  return function useStrings() {\n    const lang = useCurrentLanguage();\n    return strings[lang] || strings.en;\n  };\n}\n\nexport const LocalizationProvider: React.FC<{\n  lang: SupportedLanguage;\n  children: React.ReactNode;\n}> = ({ lang, children }) => {\n  return <ctx.Provider value={lang}>{children}</ctx.Provider>;\n};\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { VertexManager } from '../../../../cfds/client/graph/vertex-manager.ts';\nimport {\n  User,\n  Workspace,\n} from '../../../../cfds/client/graph/vertices/index.ts';\nimport { layout, styleguide } from '../../../../styles/index.ts';\nimport { cn, makeStyles } from '../../../../styles/css-objects/index.ts';\nimport { brandLightTheme } from '../../../../styles/theme.tsx';\nimport {\n  useGraphManager,\n  usePartialUserSettings,\n  useRootUser,\n  useUserSettings,\n} from '../../core/cfds/react/graph.tsx';\nimport { usePartialVertex, useVertex } from '../../core/cfds/react/vertex.ts';\nimport { UserSettings } from '../../../../cfds/client/graph/vertices/user-settings.ts';\nimport { useSharedQuery } from '../../core/cfds/react/query.ts';\nimport {\n  KeyFromVertexId,\n  VertexId,\n} from '../../../../cfds/client/graph/vertex.ts';\nimport { assert } from 'https://deno.land/std@0.160.0/_util/assert.ts';\nimport { randomInt } from '../../../../logging/stream.ts';\n\nconst useStyles = makeStyles((theme) => ({\n  ws: {\n    overflow: 'hidden',\n    flexShrink: 0,\n    boxSizing: 'content-box',\n    backgroundColor: '#9cb2cd',\n    color: theme.background[0],\n    fontFamily: 'Roboto',\n    fontWeight: '900',\n    borderRadius: '50%',\n    textDecoration: 'none',\n    border: `1px solid ${theme.background[0]}`,\n    cursor: 'pointer',\n    textTransform: 'uppercase',\n    pointerEvents: 'none',\n    basedOn: [layout.column, layout.centerCenter],\n  },\n  wsIcon: {\n    width: '100%',\n    height: '100%',\n  },\n}));\ninterface WorkspaceIconProps {\n  className?: string;\n  workspaceManager: VertexManager<Workspace>;\n  size?: number;\n}\n\nexport type WorkspaceColor = {\n  background: string;\n  inactive: string;\n  active: string;\n};\n\nconst COLOR_MAP: WorkspaceColor[] = [\n  {\n    background: brandLightTheme.mono.m1,\n    inactive: brandLightTheme.mono.m3,\n    active: brandLightTheme.mono.m5,\n  },\n  {\n    background: brandLightTheme.supporting.G1,\n    inactive: brandLightTheme.supporting.G2,\n    active: brandLightTheme.supporting.G4,\n  },\n  {\n    background: brandLightTheme.supporting.T1,\n    inactive: brandLightTheme.supporting.T2,\n    active: brandLightTheme.supporting.T4,\n  },\n  {\n    background: brandLightTheme.primary.p3,\n    inactive: brandLightTheme.primary.p4,\n    active: brandLightTheme.primary.p9,\n  },\n  {\n    background: brandLightTheme.supporting.V1,\n    inactive: brandLightTheme.supporting.V2,\n    active: brandLightTheme.supporting.V4,\n  },\n  {\n    background: brandLightTheme.supporting.L1,\n    inactive: brandLightTheme.supporting.L2,\n    active: brandLightTheme.supporting.L4,\n  },\n  {\n    background: brandLightTheme.supporting.B1,\n    inactive: brandLightTheme.supporting.B2,\n    active: brandLightTheme.supporting.B4,\n  },\n  {\n    background: brandLightTheme.supporting.O1,\n    inactive: brandLightTheme.supporting.O2,\n    active: brandLightTheme.supporting.O4,\n  },\n  {\n    background: brandLightTheme.supporting.C1,\n    inactive: brandLightTheme.supporting.C2,\n    active: brandLightTheme.supporting.C4,\n  },\n  {\n    background: brandLightTheme.secondary.s3,\n    inactive: brandLightTheme.secondary.s4,\n    active: brandLightTheme.secondary.s7,\n  },\n  {\n    background: brandLightTheme.supporting.R1,\n    inactive: brandLightTheme.supporting.R2,\n    active: brandLightTheme.supporting.R4,\n  },\n];\n\nexport function useWorkspaceColor(\n  workspaceId: VertexId<Workspace>\n): WorkspaceColor {\n  const graph = useGraphManager();\n  const workspaceKey = KeyFromVertexId(workspaceId);\n  const colorMap = usePartialUserSettings(['workspaceColors']).workspaceColors;\n  const workspacesQuery = useSharedQuery('workspaces');\n\n  // Return the saved color only if it's valid within the current theme\n  const existingColor = colorMap.get(workspaceKey);\n  if (existingColor && existingColor >= 0 && existingColor < COLOR_MAP.length) {\n    return COLOR_MAP[existingColor];\n  }\n  // Prevent color tagging for demo workspaces\n  for (const key of workspacesQuery.keys()) {\n    if (!graph.getVertex<Workspace>(key).isDemoData) {\n      colorMap.delete(key);\n    }\n  }\n\n  // Find the least used color and use that for our workspace\n  const colorCounts: number[] = [];\n  for (let i = 0; i < COLOR_MAP.length; ++i) {\n    colorCounts.push(0);\n  }\n  for (const color of colorMap.values()) {\n    if (color >= 0 && color < COLOR_MAP.length) {\n      ++colorCounts[color];\n    }\n  }\n  const nextColor = colorCounts.indexOf(Math.min(...colorCounts));\n  assert(nextColor >= 0 && nextColor < COLOR_MAP.length);\n  colorMap.set(workspaceKey, nextColor);\n  return COLOR_MAP[nextColor];\n}\n\nexport default function WorkspaceIcon({\n  className,\n  workspaceManager,\n  size = styleguide.gridbase * 4,\n}: WorkspaceIconProps) {\n  const styles = useStyles();\n  const ws = usePartialVertex(workspaceManager, ['name', 'icon']);\n  const icon = ws.icon;\n\n  const color = useWorkspaceColor(workspaceManager);\n  return (\n    <div\n      className={cn(styles.ws, className)}\n      style={{\n        width: size,\n        height: size,\n        lineHeight: size + 'px',\n        fontSize: size * 0.625 + 'px',\n        backgroundColor: icon ? '#4f8df9' : color.active,\n      }}\n    >\n      {icon ? (\n        <img src={icon} className={cn(styles.wsIcon)} alt={ws.name} />\n      ) : (\n        (ws.name || '')[0]\n      )}\n    </div>\n  );\n}\n", "import React, { useContext, useMemo } from 'https://esm.sh/react@18.2.0';\nimport Menu, { MenuItem } from '../menu.tsx';\n\ninterface DropDownItemProps {\n  selected?: boolean;\n  children?: React.ReactNode;\n  value: any;\n  className?: string;\n  onChange?: (value: any) => void;\n}\n\nconst DropDownContext = React.createContext({\n  onChange(value: any) {},\n  currentValue: null as any,\n});\n\nexport function DropDownItem({\n  children,\n  value,\n  className,\n  ...props\n}: DropDownItemProps) {\n  const { onChange } = useContext(DropDownContext);\n\n  return (\n    <MenuItem className={className} onClick={() => onChange(value)} {...props}>\n      {children}\n    </MenuItem>\n  );\n}\n\ninterface DropDownProps {\n  value: any;\n  onChange: (value: any) => void;\n  children: any;\n  renderSelected: any;\n  onOpen?: () => void;\n  className?: any;\n  align?: 'start' | 'center' | 'end';\n  position?: 'top' | 'bottom' | 'left' | 'right';\n  direction?: 'in' | 'out';\n  popupClassName?: any;\n  sizeByButton?: boolean;\n}\n\nconst noop = () => {};\n\nexport default function DropDown({\n  value,\n  onChange,\n  children,\n  renderSelected,\n  onOpen = noop,\n  ...props\n}: DropDownProps) {\n  const ctx = useMemo(\n    () => ({\n      onChange,\n      currentValue: value,\n    }),\n    [value, onChange]\n  );\n\n  return (\n    <DropDownContext.Provider value={ctx}>\n      <Menu onClick={onOpen} renderButton={renderSelected} {...props}>\n        {children}\n      </Menu>\n    </DropDownContext.Provider>\n  );\n}\n", "{\n  \"en\": {\n    \"tutorialWelcomeTitle\": \"Welcome to Ovvio\",\n    \"tutorialWelcomeText\": \"Workspaces are an important part of Ovvio, they represent a shared space for you and your team to collaborate in\",\n    \"tutorialNameWorkspaceTitle\": \"Name your workspace\",\n    \"tutorialNameWorkspaceText\": \"Give your workspace a name, this can be a project, a team name or whatever you feel like!\",\n    \"tutorialCreateWorkspaceTitle\": \"Create your workspace\",\n    \"tutorialCreateWorkspaceText\": \"Click on the create button to create your workspace and get to work!\",\n    \"fromNew\": \"Create fresh\",\n    \"duplicate\": \"Duplicate & Create\",\n    \"chooseDuplicateFrom\": \"Choose a workspace to duplicate\",\n    \"chooseWorkspace\": \"Choose Workspace\"\n  }\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { VertexManager } from '../../../../cfds/client/graph/vertex-manager.ts';\nimport { Workspace } from '../../../../cfds/client/graph/vertices/workspace.ts';\nimport { usePartialVertex } from '../../core/cfds/react/vertex.ts';\nimport { createUseStrings } from '../../core/localization/index.tsx';\nimport WorkspaceIcon from '../../shared/workspace-icon/index.tsx';\n\nimport { layout, styleguide } from '../../../../styles/index.ts';\nimport { IconDropDownArrow } from '../../../../styles/components/icons/index.ts';\nimport DropDown, {\n  DropDownItem,\n} from '../../../../styles/components/inputs/drop-down.tsx';\nimport { Text } from '../../../../styles/components/texts.tsx';\nimport { makeStyles, cn } from '../../../../styles/css-objects/index.ts';\nimport localization from './new-workspace.strings.json' assert { type: 'json' };\nimport { useSharedQuery } from '../../core/cfds/react/query.ts';\n\nconst useStyles = makeStyles((theme) => ({\n  workspaces: {\n    minWidth: styleguide.gridbase * 24,\n    border: `1px solid ${theme.background.placeholderText}`,\n    borderRadius: 3,\n  },\n  workspacesList: {\n    maxHeight: styleguide.gridbase * 30,\n    overflowY: 'auto',\n  },\n  iconClosed: {\n    transform: 'rotate(180deg)',\n  },\n  listItem: {\n    borderBottom: `1px solid ${theme.background[300]}`,\n    ':first-child': {\n      borderTop: `1px solid ${theme.background[300]}`,\n    },\n  },\n  workspaceItem: {\n    alignItems: 'center',\n    basedOn: [layout.row],\n  },\n  workspaceIcon: {\n    marginRight: styleguide.gridbase * 0.5,\n  },\n  selectedWorkspace: {\n    height: styleguide.gridbase * 4,\n    padding: styleguide.gridbase * 0.5,\n    width: '100%',\n    basedOn: [layout.row, layout.centerCenter],\n  },\n}));\n\nconst useStrings = createUseStrings(localization);\n\nexport function WorkspaceItem({\n  workspace,\n  className,\n}: {\n  workspace: VertexManager<Workspace>;\n  className?: string;\n}) {\n  const styles = useStyles();\n  const { name } = usePartialVertex(workspace, ['name']);\n\n  return (\n    <div className={cn(styles.workspaceItem, className)}>\n      <WorkspaceIcon\n        workspaceManager={workspace}\n        className={cn(styles.workspaceIcon)}\n        size={styleguide.gridbase * 3}\n      />\n      <Text>{name}</Text>\n    </div>\n  );\n}\n\ninterface WorkspacesDropdownProps {\n  allWorkspaces: readonly VertexManager<Workspace>[];\n  setWorkspace: (ws: VertexManager<Workspace> | undefined) => void;\n  workspace: VertexManager<Workspace> | undefined;\n  className?: string;\n  placeholder?: string;\n}\n\nexport function WorkspacesDropdown({\n  allWorkspaces,\n  setWorkspace,\n  workspace,\n  className,\n  placeholder,\n}: WorkspacesDropdownProps) {\n  const styles = useStyles();\n  const { chooseWorkspace } = useStrings();\n  const noSelection = placeholder || chooseWorkspace;\n  const renderSelected = ({ isOpen }: { isOpen: boolean }) => {\n    if (!workspace) {\n      return (\n        <div className={cn(styles.selectedWorkspace)}>\n          <div className={cn(styles.workspaceItem, layout.flexSpacer)}>\n            <Text>{noSelection}</Text>\n          </div>\n          <IconDropDownArrow className={cn(!isOpen && styles.iconClosed)} />\n        </div>\n      );\n    }\n    return (\n      <div className={cn(styles.selectedWorkspace)}>\n        <WorkspaceItem\n          workspace={workspace!}\n          className={cn(layout.flexSpacer)}\n        />\n        <IconDropDownArrow className={cn(!isOpen && styles.iconClosed)} />\n      </div>\n    );\n  };\n  return (\n    <DropDown\n      value={workspace}\n      className={cn(styles.workspaces, className)}\n      popupClassName={cn(styles.workspacesList)}\n      position=\"top\"\n      align=\"end\"\n      direction=\"in\"\n      sizeByButton={true}\n      onChange={(ws: VertexManager<Workspace>) => setWorkspace(ws)}\n      renderSelected={renderSelected}\n    >\n      {allWorkspaces.map((ws) => (\n        <DropDownItem key={ws.key} value={ws} className={cn(styles.listItem)}>\n          <WorkspaceItem workspace={ws} />\n        </DropDownItem>\n      ))}\n    </DropDown>\n  );\n}\n", "import React, { useEffect, useState } from 'https://esm.sh/react@18.2.0';\nimport { VertexManager } from '../../../../cfds/client/graph/vertex-manager.ts';\nimport { Workspace } from '../../../../cfds/client/graph/vertices/workspace.ts';\nimport { layout, styleguide } from '../../../../styles/index.ts';\nimport { useTypographyStyles } from '../../../../styles/components/typography.tsx';\nimport { cn, makeStyles } from '../../../../styles/css-objects/index.ts';\nimport { brandLightTheme as theme } from '../../../../styles/theme.tsx';\nimport { createUseStrings } from '../../core/localization/index.tsx';\nimport { WorkspacesDropdown } from './workspaces-dropdown.tsx';\nimport localization from './new-workspace.strings.json' assert { type: 'json' };\n\nconst useStyles = makeStyles(\n  () => ({\n    root: {\n      alignItems: 'stretch',\n      basedOn: [layout.column],\n    },\n    toggle: {\n      position: 'relative',\n      cursor: 'pointer',\n      height: styleguide.gridbase * 5,\n      backgroundColor: theme.colors.secondaryButton,\n      borderRadius: styleguide.gridbase * 2.5,\n      basedOn: [layout.row],\n    },\n    option: {\n      position: 'relative',\n      zIndex: 2,\n      flexGrow: 1,\n      flexShrink: 0,\n      flexBasis: '50%',\n      color: theme.secondary.s6,\n      basedOn: [layout.column, layout.centerCenter, useTypographyStyles.text],\n    },\n    selected: {\n      color: theme.colors.primaryButton,\n    },\n    indicator: {\n      backgroundColor: theme.colors.background,\n      position: 'absolute',\n      top: 0,\n      left: 0,\n      height: '100%',\n      width: '50%',\n      transform: 'translateX(0)',\n      borderRadius: styleguide.gridbase * 2.5,\n      ...styleguide.transition.standard,\n      transitionProperty: 'transform',\n      boxShadow: theme.shadows.z1,\n    },\n    indicatorSelected: {\n      transform: 'translateX(100%)',\n    },\n    selector: {\n      marginTop: styleguide.gridbase * 3,\n    },\n  }),\n  'duplicate-workspace_5420c8'\n);\n\nconst useStrings = createUseStrings(localization);\n\nfunction DuplicateToggle({\n  shouldDuplicate,\n  setShouldDuplicate,\n}: {\n  shouldDuplicate: boolean;\n  setShouldDuplicate: React.Dispatch<React.SetStateAction<boolean>>;\n}) {\n  const styles = useStyles();\n  const strings = useStrings();\n\n  const onClick = () => setShouldDuplicate((x) => !x);\n\n  return (\n    <div className={cn(styles.toggle)} onClick={onClick}>\n      <div\n        className={cn(\n          styles.indicator,\n          shouldDuplicate && styles.indicatorSelected\n        )}\n      />\n      <div className={cn(styles.option, !shouldDuplicate && styles.selected)}>\n        {strings.fromNew}\n      </div>\n      <div className={cn(styles.option, shouldDuplicate && styles.selected)}>\n        {strings.duplicate}\n      </div>\n    </div>\n  );\n}\n\nexport interface DuplicateWorkspaceViewProps {\n  allWorkspaces: readonly VertexManager<Workspace>[];\n  setWorkspace: (ws: VertexManager<Workspace> | undefined) => void;\n  workspace: VertexManager<Workspace> | undefined;\n  className?: string;\n}\n\nexport function DuplicateWorkspaceView({\n  allWorkspaces,\n  setWorkspace,\n  workspace,\n  className,\n}: DuplicateWorkspaceViewProps) {\n  const styles = useStyles();\n  const strings = useStrings();\n\n  const [shouldDuplicate, setShouldDuplicate] = useState(!!workspace);\n  useEffect(() => {\n    if (!shouldDuplicate) {\n      setWorkspace(undefined);\n    }\n  }, [shouldDuplicate, setWorkspace]);\n  return (\n    <div className={cn(styles.root, className)}>\n      <DuplicateToggle\n        shouldDuplicate={shouldDuplicate}\n        setShouldDuplicate={setShouldDuplicate}\n      />\n      {shouldDuplicate && (\n        <WorkspacesDropdown\n          className={cn(styles.selector)}\n          allWorkspaces={allWorkspaces}\n          workspace={workspace}\n          setWorkspace={setWorkspace}\n          placeholder={strings.chooseDuplicateFrom}\n        />\n      )}\n    </div>\n  );\n}\n", "import React, {\n  useEffect,\n  useRef,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport { NS_USERS, NS_WORKSPACE } from '../../../../cfds/base/scheme-types.ts';\nimport { Record } from '../../../../cfds/base/record.ts';\nimport { GraphManager } from '../../../../cfds/client/graph/graph-manager.ts';\nimport { VertexManager } from '../../../../cfds/client/graph/vertex-manager.ts';\nimport { Workspace } from '../../../../cfds/client/graph/vertices/index.ts';\nimport { styleguide } from '../../../../styles/styleguide.ts';\nimport { RaisedButton } from '../../../../styles/components/buttons.tsx';\nimport { TextField } from '../../../../styles/components/inputs/index.ts';\nimport { H2, Text } from '../../../../styles/components/texts.tsx';\nimport { cn, makeStyles } from '../../../../styles/css-objects/index.ts';\nimport { useGraphManager } from '../../core/cfds/react/graph.tsx';\nimport { useSharedQuery } from '../../core/cfds/react/query.ts';\nimport CreateIllustration from './create-workspace-illustration.tsx';\nimport { DuplicateWorkspaceView } from './duplicate-workspace.tsx';\nimport { UISource } from '../../../../logging/client-events.ts';\nimport { useLogger } from '../../core/cfds/react/logger.tsx';\nimport { uniqueId } from '../../../../base/common.ts';\n\nconst useStyles = makeStyles((theme) => ({\n  input: {\n    marginTop: styleguide.gridbase * 3,\n    width: '100%',\n    maxWidth: styleguide.gridbase * 40,\n  },\n  illustration: {\n    marginTop: styleguide.gridbase * 7,\n  },\n  error: {\n    marginTop: styleguide.gridbase,\n    color: 'red',\n  },\n}));\n\ntype CreateWorkspaceOptions = {\n  copyFrom?: VertexManager<Workspace>;\n};\n\nfunction duplicateWorkspace(\n  name: string,\n  graph: GraphManager,\n  src: VertexManager<Workspace>\n): VertexManager<Workspace> {\n  const subGraph = graph.exportSubGraph(src.key, 1, [NS_USERS], (r: Record) => {\n    if (r.scheme.namespace === NS_WORKSPACE) {\n      r.set('name', name);\n    }\n    if (r.scheme.hasField('createdBy')) {\n      r.set('createdBy', graph.rootKey);\n    }\n  });\n\n  const data = graph.importSubGraph(subGraph, false);\n  return data[0] as VertexManager<Workspace>;\n}\n\nfunction createNewWorkspace(\n  name: string,\n  graphManager: GraphManager,\n  opts: CreateWorkspaceOptions = {}\n): VertexManager<Workspace> {\n  const { copyFrom } = opts;\n  if (copyFrom) {\n    return duplicateWorkspace(name, graphManager, copyFrom);\n  }\n  return graphManager.createVertex<Workspace>(NS_WORKSPACE, {\n    name,\n    users: new Set([graphManager.rootKey]),\n  }).manager;\n}\n\nexport interface WorkspaceFormProps {\n  source?: UISource;\n  onWorkspaceCreated: (createResult: VertexManager<Workspace>) => void;\n}\n\nexport function WorkspaceForm({\n  source,\n  onWorkspaceCreated,\n}: WorkspaceFormProps) {\n  const styles = useStyles();\n  const [name, setName] = useState('');\n  const logger = useLogger();\n  const graph = useGraphManager();\n  const nameRef = useRef();\n  const createRef = useRef(null);\n  const workspacesQuery = useSharedQuery('workspaces');\n  const [duplicateWs, setDuplicateWs] = useState<VertexManager<Workspace>>();\n  const [flowId] = useState(uniqueId());\n\n  useEffect(() => {\n    logger.log({\n      severity: 'INFO',\n      event: 'Start',\n      flow: 'create',\n      type: 'workspace',\n      source,\n      id: flowId,\n    });\n  }, [logger, flowId]);\n\n  const createWorkspace = () => {\n    const wsResult = createNewWorkspace(name, graph, {\n      copyFrom: duplicateWs,\n    });\n    logger.log({\n      severity: 'INFO',\n      event: 'End',\n      flow: 'create',\n      type: 'workspace',\n      source,\n      id: flowId,\n    });\n    onWorkspaceCreated(wsResult);\n  };\n  return (\n    <React.Fragment>\n      <H2>Create a new workspace</H2>\n      <React.Fragment>\n        <p>\n          <Text>\n            Organize your units, departments and projects with Workspaces. Write\n            meeting minutes or notes, and assign tasks to a specific group of\n            people.\n          </Text>\n        </p>\n        {workspacesQuery.count > 0 && (\n          <DuplicateWorkspaceView\n            className={cn(styles.input)}\n            allWorkspaces={workspacesQuery.results}\n            setWorkspace={setDuplicateWs}\n            workspace={duplicateWs}\n          />\n        )}\n        <TextField\n          placeholder=\"Name your workspace\"\n          value={name}\n          onChange={(e: any) => setName(e.currentTarget.value)}\n          className={cn(styles.input)}\n          ref={nameRef}\n        />\n        <RaisedButton\n          disabled={name.trim().length === 0}\n          className={cn(styles.input)}\n          onClick={createWorkspace}\n          ref={createRef}\n        >\n          <span>Create new workspace</span>\n        </RaisedButton>\n      </React.Fragment>\n      <CreateIllustration className={cn(styles.illustration)} />\n    </React.Fragment>\n  );\n}\n", "import React, { useMemo, useState } from 'https://esm.sh/react@18.2.0';\nimport { useNavigate } from 'https://esm.sh/react-router@6.7.0';\nimport { makeStyles, cn } from '../../../../styles/css-objects/index.ts';\nimport { layout, styleguide } from '../../../../styles/index.ts';\nimport Toolbar from '../workspace-content/workspace-view/toolbar/index.tsx';\nimport { VertexManager } from '../../../../cfds/client/graph/vertex-manager.ts';\nimport { Workspace } from '../../../../cfds/client/graph/vertices/workspace.ts';\nimport { WorkspaceForm } from './workspace-form.tsx';\nimport { useCallback } from 'https://esm.sh/v96/@types/react@18.0.21/index.d.ts';\nimport { UISource } from '../../../../logging/client-events.ts';\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    alignItems: 'stretch',\n    flexShrink: 1,\n    basedOn: [layout.column, layout.flex],\n  },\n  content: {\n    backgroundColor: theme.background[100],\n    alignItems: 'center',\n    basedOn: [layout.column, layout.flex],\n  },\n  card: {\n    marginTop: styleguide.gridbase * 3,\n    alignItems: 'center',\n    textAlign: 'center',\n    backgroundColor: theme.background[0],\n    padding: styleguide.gridbase * 4,\n    paddingBottom: 0,\n    width: '100%',\n    maxWidth: styleguide.gridbase * 90,\n    boxSizing: 'border-box',\n    boxShadow: theme.shadows.z2,\n    basedOn: [layout.column],\n  },\n  input: {\n    marginTop: styleguide.gridbase * 3,\n    width: '100%',\n    maxWidth: styleguide.gridbase * 40,\n  },\n  illustration: {\n    marginTop: styleguide.gridbase * 7,\n  },\n  error: {\n    marginTop: styleguide.gridbase,\n    color: 'red',\n  },\n}));\n\ninterface CreateWorkspaceViewProps {\n  source: UISource;\n  onWorkspaceCreated?: (wsKey: string) => void;\n}\nexport const CreateWorkspaceView = ({\n  source,\n  onWorkspaceCreated,\n}: CreateWorkspaceViewProps) => {\n  const styles = useStyles();\n  const [ws, setWs] = useState<VertexManager<Workspace>>();\n  const navigate = useNavigate();\n\n  const onCreated = useCallback(\n    (result: VertexManager<Workspace>) => {\n      setWs(result);\n      if (onWorkspaceCreated) {\n        onWorkspaceCreated(result.key);\n      }\n    },\n    [setWs]\n  );\n\n  const closeView = useCallback(() => {\n    navigate('/login');\n  }, [navigate]);\n\n  return (\n    <div className={cn(styles.root)}>\n      <Toolbar />\n      <div className={cn(styles.content)}>\n        <div className={cn(styles.card)}>\n          {/* {ws ? (\n            <InviteForm showOnboard={true} close={closeView} source={source} />\n          ) : ( */}\n          <WorkspaceForm source={source} onWorkspaceCreated={onCreated} />\n          {/* )} */}\n        </div>\n      </div>\n    </div>\n  );\n};\n", "import React, {\n  useEffect,\n  useRef,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport ReactDOM from 'https://esm.sh/react-dom@18.2.0';\nimport { makeStyles, cn, keyframes } from '../../css-objects/index.ts';\nimport { H2 } from '../texts.tsx';\nimport { styleguide } from '../../styleguide.ts';\nimport { layout } from '../../layout.ts';\nimport { IconClose } from '../icons/index.ts';\nimport { Button, IconButton } from '../buttons.tsx';\nimport Layer from '../layer.tsx';\nimport {\n  MouseEvent,\n  MouseEventHandler,\n} from 'https://esm.sh/v96/@types/react@18.0.21/index.d.ts';\n\nconst show = keyframes(\n  {\n    from: {\n      opacity: 0,\n      transform: 'translateY(-50%)',\n    },\n    to: {\n      opacity: 1,\n      transform: 'translateY(0)',\n    },\n  },\n  'index_90a70e'\n);\n\nconst hideAnim = keyframes(\n  {\n    from: {\n      opacity: 1,\n      transform: 'translateY(0)',\n    },\n    to: {\n      opacity: 0,\n      transform: 'translateY(-50%)',\n    },\n  },\n  'dialog_a096ea'\n);\n\nconst backdropShow = keyframes(\n  {\n    from: {\n      opacity: 0,\n    },\n    to: {\n      opacity: 1,\n    },\n  },\n  'dialog_dca075'\n);\n\nconst backdropHide = keyframes(\n  {\n    from: {\n      opacity: 1,\n    },\n    to: {\n      opacity: 0,\n    },\n  },\n  'dialog_0aa5dd'\n);\n\nconst useStyles = makeStyles(\n  (theme) => ({\n    backdrop: {\n      backgroundColor: 'rgba(8, 25, 43, 0.2)',\n      position: 'absolute',\n      top: 0,\n      left: 0,\n      right: 0,\n      bottom: 0,\n      basedOn: [layout.column, layout.centerCenter],\n      animation: `${backdropShow} 0.15s linear backwards`,\n    },\n    backdropHide: {\n      animation: `${backdropHide} 0.15s linear both`,\n    },\n    dialog: {\n      backgroundColor: theme.background[0],\n      position: 'relative',\n      borderRadius: 4,\n      boxSizing: 'border-box',\n      width: `calc(100vw - ${styleguide.gridbase * 2}px)`,\n      maxWidth: styleguide.gridbase * 70,\n      padding: styleguide.gridbase * 4,\n      animation: `${show} 0.15s ${styleguide.transition.timing.standard}`,\n      boxShadow: theme.shadows.z2,\n    },\n    closeBtn: {\n      position: 'absolute',\n      top: styleguide.gridbase * 1.5,\n      right: styleguide.gridbase * 1.5,\n      width: styleguide.gridbase * 3,\n      height: styleguide.gridbase * 3,\n    },\n    hide: {\n      animation: `${hideAnim} 0.15s ${styleguide.transition.timing.standard} both`,\n    },\n    content: {\n      width: '100%',\n    },\n    actions: {\n      marginTop: styleguide.gridbase * 2,\n      alignItems: 'center',\n      justifyContent: 'flex-end',\n      basedOn: [layout.row],\n      '& > button': {\n        marginLeft: styleguide.gridbase * 2,\n      },\n    },\n    header: {\n      textAlign: 'center',\n    },\n    button: {\n      padding: [0, styleguide.gridbase * 4],\n      height: styleguide.gridbase * 5,\n      fontSize: styleguide.gridbase * 2,\n      fontWeight: 600,\n      borderRadius: styleguide.gridbase * 2.5,\n      backgroundColor: theme.primary[500],\n      color: theme.background[0],\n      transition: `background-color linear ${styleguide.transition.duration.short}ms`,\n      ':disabled': {\n        backgroundColor: '#d7e3f1',\n      },\n    },\n  }),\n  'dialog_90852c'\n);\n\ninterface DialogButtonProps {\n  className?: string;\n  children: any;\n  disabled: boolean;\n}\nexport function DialogButton({ className, ...props }: DialogButtonProps) {\n  const styles = useStyles();\n  return <Button className={cn(styles.button, className)} {...props} />;\n}\n\nexport function DialogHeader({ children }) {\n  const styles = useStyles();\n  return <H2 className={cn(styles.header)}>{children}</H2>;\n}\n\nexport interface DialogProps {\n  open: boolean;\n  children: any;\n  onClickOutside?: any;\n  className?: string;\n  onClose?: (e: any) => void;\n  onOpen?: () => void;\n  renderIndicator?: () => any;\n}\nexport function Dialog({\n  open,\n  children,\n  onClickOutside,\n  className,\n  onClose,\n  onOpen,\n  renderIndicator = () => null,\n}: DialogProps) {\n  const styles = useStyles();\n  // const domState = useScopedObservable(DomState);\n  const timeout = useRef<number>();\n  const [visible, setVisible] = useState(open);\n  const [css, setCss] = useState<string | null>(null);\n  const onOpenRef = useRef(onOpen);\n  useEffect(() => {\n    onOpenRef.current = onOpen;\n  }, [onOpen]);\n  // useEffect(() => {\n  //   if (open) {\n  //     domState.dialogCount++;\n  //     return () => {\n  //       domState.dialogCount--;\n  //     };\n  //   }\n  // }, [open, domState]);\n  const mounted = useRef(true);\n  useEffect(() => {\n    mounted.current = true;\n    return () => {\n      mounted.current = false;\n    };\n  }, []);\n\n  useEffect(() => {\n    if (timeout.current) {\n      clearTimeout(timeout.current);\n      timeout.current = undefined;\n    }\n    if (!open) {\n      timeout.current = window.setTimeout(() => {\n        if (!mounted.current) {\n          return;\n        }\n        setVisible(false);\n      }, 200);\n      setCss(styles.hide);\n    } else {\n      setCss('');\n      setVisible(true);\n      onOpenRef.current?.();\n    }\n  }, [open, styles]);\n\n  if (!visible) {\n    return null;\n  }\n\n  const root = document.getElementById('root')!;\n  const ignoreClick = (e: MouseEvent) => {\n    e.stopPropagation();\n    e.preventDefault();\n  };\n  const backgroundClick = (e: MouseEvent) => {\n    ignoreClick(e);\n    onClickOutside && onClickOutside();\n  };\n  return ReactDOM.createPortal(\n    <Layer priority={3}>\n      {({ zIndex }) => (\n        <div\n          className={cn(styles.backdrop, css && styles.backdropHide)}\n          style={{ zIndex }}\n          onClick={backgroundClick}\n        >\n          <div\n            className={cn(styles.dialog, css, className)}\n            onClick={ignoreClick}\n          >\n            {onClose && (\n              <IconButton className={cn(styles.closeBtn)} onClick={onClose}>\n                <IconClose />\n              </IconButton>\n            )}\n            {children}\n          </div>\n          {renderIndicator()}\n        </div>\n      )}\n    </Layer>,\n    root\n  );\n}\n\nexport interface DialogContentProps {\n  children: any;\n  className?: string;\n}\nexport const DialogContent = ({ children, className }: DialogContentProps) => {\n  const styles = useStyles();\n  return <div className={cn(styles.content, className)}>{children}</div>;\n};\n\nexport interface DialogActionsProps {\n  children: any;\n  className?: string;\n}\nexport const DialogActions = ({ children, className }: DialogActionsProps) => {\n  const styles = useStyles();\n  return <div className={cn(styles.actions, className)}>{children}</div>;\n};\n\nexport default Dialog;\n", "import React, {\n  useReducer,\n  useMemo,\n  useContext,\n  useCallback,\n} from 'https://esm.sh/react@18.2.0';\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n} from '../../../../../styles/components/dialog/index.tsx';\nimport { makeStyles, cn } from '../../../../../styles/css-objects/index.ts';\nimport { DatePicker } from '../../../../../styles/components/inputs/index.ts';\nimport { styleguide } from '../../../../../styles/styleguide.ts';\nimport { Note } from '../../../../../cfds/client/graph/vertices/note.ts';\nimport { VertexManager } from '../../../../../cfds/client/graph/vertex-manager.ts';\nimport { useLogger } from '../../../core/cfds/react/logger.tsx';\nimport { assert } from '../../../../../base/error.ts';\n\nconst useStyles = makeStyles((theme) => ({\n  datePicker: {\n    margin: 'auto',\n    marginTop: styleguide.gridbase * 3,\n    maxWidth: styleguide.gridbase * 47,\n    width: '100%',\n  },\n}));\n\ninterface DueDate {\n  edit: (card: Note) => void;\n}\n\nconst dueDateContext = React.createContext<DueDate | undefined>(undefined);\n\nexport function useDueDate(): DueDate {\n  const dd = useContext(dueDateContext);\n  assert(dd !== undefined);\n  return dd;\n}\n\nfunction dueDateReducer(\n  state: DueDataState,\n  action: DueDataAction\n): DueDataState {\n  switch (action.type) {\n    case 'close': {\n      return {\n        open: false,\n      };\n    }\n    case 'edit': {\n      return {\n        card: action.card,\n        open: true,\n      };\n    }\n    default:\n      throw new Error(`Unknown action type ${action.type}`);\n  }\n}\n\ninterface DueDataAction {\n  type: string;\n  card?: Note;\n}\n\ninterface DueDataState {\n  card?: Note;\n  open: boolean;\n}\n\nexport default function DueDateEditor({ children }: React.PropsWithChildren) {\n  const styles = useStyles();\n  const logger = useLogger();\n  const [state, dispatch] = useReducer(dueDateReducer, {\n    open: false,\n  });\n\n  const value = useMemo<DueDate>(\n    () => ({\n      edit: (card) => {\n        dispatch({ type: 'edit', card });\n      },\n    }),\n    []\n  );\n  const onDateSelected = useCallback(\n    (card: Note, date: Date) => {\n      const manager = card.manager as VertexManager<Note>;\n      const proxy = manager.getVertexProxy();\n      proxy.dueDate = date;\n\n      logger.log({\n        severity: 'INFO',\n        event: 'MetadataChanged',\n        type: 'due',\n        vertex: card.key,\n      });\n\n      dispatch({ type: 'close' });\n    },\n    [logger, dispatch]\n  );\n\n  const onClose = useCallback(\n    (card: Note) => {\n      logger.log({\n        severity: 'INFO',\n        event: 'Cancel',\n        flow: 'datePicker',\n        vertex: card.key,\n      });\n      dispatch({ type: 'close' });\n    },\n    [logger, dispatch]\n  );\n\n  return (\n    <dueDateContext.Provider value={value}>\n      {children}\n      <Dialog\n        open={state.open}\n        onClickOutside={() => onClose(state.card!)}\n        onClose={() => onClose(state.card!)}\n      >\n        {state.card && (\n          <DialogContent>\n            <DialogHeader>Calendar</DialogHeader>\n            <DatePicker\n              className={cn(styles.datePicker)}\n              value={state.card.dueDate}\n              onChange={(date) => {\n                onDateSelected(state.card!, date);\n              }}\n            />\n          </DialogContent>\n        )}\n      </Dialog>\n    </dueDateContext.Provider>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { useLocation, useNavigate } from 'https://esm.sh/react-router@6.7.0';\nimport { makeStyles, cn } from '../../../../styles/css-objects/index.ts';\nimport { styleguide, layout } from '../../../../styles/index.ts';\nimport { Button } from '../../../../styles/components/buttons.tsx';\nimport { Text } from '../../../../styles/components/texts.tsx';\nimport { IconBack } from '../../../../styles/components/icons/index.ts';\nimport Layer from '../../../../styles/components/layer.tsx';\nimport { MediaQueries } from '../../../../styles/responsive.ts';\nimport { useLogger } from '../../core/cfds/react/logger.tsx';\n\nconst useStyles = makeStyles((theme) => ({\n  button: {\n    position: 'absolute',\n    top: styleguide.gridbase * 3,\n    left: styleguide.gridbase * 3,\n    [MediaQueries.Tablet]: {\n      top: styleguide.gridbase * 2,\n      left: styleguide.gridbase * 2,\n    },\n    [MediaQueries.Mobile]: {\n      top: styleguide.gridbase,\n      left: styleguide.gridbase,\n    },\n    height: styleguide.gridbase * 5,\n    padding: styleguide.gridbase,\n    boxSizing: 'border-box',\n    minWidth: styleguide.gridbase * 12,\n    backgroundColor: theme.background[0],\n    borderRadius: 3,\n    boxShadow: '0 3px 5px 0 rgba(42, 62, 82, 0.12)',\n  },\n  text: {\n    height: `${styleguide.gridbase * 3}px`,\n    lineHeight: `${styleguide.gridbase * 3}px`,\n    textAlign: 'left',\n    basedOn: [layout.flex],\n  },\n}));\n\nexport default function FloatingBackButton() {\n  const styles = useStyles();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const logger = useLogger();\n\n  const onClick = () => {\n    navigate('/');\n    logger.log({\n      severity: 'INFO',\n      event: 'Click',\n      source: 'button:back',\n      routeInfo: location.pathname + location.search + location.hash,\n    });\n  };\n\n  if (!history.length) {\n    return null;\n  }\n\n  const text = 'Back';\n\n  return (\n    <Layer>\n      {(style) => (\n        <Button className={cn(styles.button)} onClick={onClick} style={style}>\n          <IconBack />\n          <Text className={cn(styles.text)}>{text}</Text>\n        </Button>\n      )}\n    </Layer>\n  );\n}\n", "import React, {\n  useContext,\n  useEffect,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\n\nexport const scrollingContext = React.createContext<HTMLElement | undefined>(\n  document.body\n);\n\nexport function useScrollingRerendering() {\n  const parent = useContext(scrollingContext);\n  const el = parent;\n  const [offset, setOffset] = useState(() =>\n    el ? { x: el.scrollLeft, y: el.scrollTop } : { x: 0, y: 0 }\n  );\n  useEffect(() => {\n    if (el) {\n      const handler = () => {\n        setOffset(el ? { x: el.scrollLeft, y: el.scrollTop } : { x: 0, y: 0 });\n      };\n      el.addEventListener('scroll', handler);\n      return () => {\n        el.removeEventListener('scroll', handler);\n      };\n    }\n  }, [el]);\n\n  return offset;\n}\n\nexport function useScrollParent() {\n  return useContext(scrollingContext);\n}\n\ninterface ScrollerProps<T extends HTMLElement> {\n  children: (ref: (el: T) => void) => JSX.Element;\n}\n\nexport function Scroller<T extends HTMLElement = HTMLDivElement>({\n  children,\n}: ScrollerProps<T>) {\n  const [el, setEl] = useState<T>();\n\n  return (\n    <scrollingContext.Provider value={el}>\n      {children(setEl)}\n    </scrollingContext.Provider>\n  );\n}\n", "import { KeyboardEvent } from 'https://esm.sh/react@18.2.0';\nimport { JSONObject } from '../../../../../base/interfaces.ts';\nimport { isMacOS } from '../../../utils.ts';\n\nexport enum Platform {\n  Mac,\n  Windows,\n}\n\nexport const CURRENT_PLATFORM = isMacOS() ? Platform.Mac : Platform.Windows;\n\nexport enum MetaKeys {\n  Alt = 'alt',\n  Ctrl = 'ctrl',\n  Shift = 'shift',\n  Meta = 'meta',\n}\n\nconst META_KEY_MAP: Record<MetaKeys, keyof KeyboardEvent> = {\n  [MetaKeys.Alt]: 'altKey',\n  [MetaKeys.Ctrl]: 'ctrlKey',\n  [MetaKeys.Shift]: 'shiftKey',\n  [MetaKeys.Meta]: 'metaKey',\n};\n\nexport interface Hotkey {\n  metaKeys: MetaKeys[];\n  key: string;\n}\n\nexport interface Shortcut {\n  default: Hotkey;\n  [Platform.Mac]?: Hotkey;\n  [Platform.Windows]?: Hotkey;\n}\n\nexport function getPlatformHotkey(shortcut: Shortcut): Hotkey {\n  const hotkey = shortcut[CURRENT_PLATFORM] || shortcut.default;\n  if (CURRENT_PLATFORM !== Platform.Mac) {\n    return {\n      ...hotkey,\n      metaKeys: hotkey.metaKeys.map((x) =>\n        x === MetaKeys.Meta ? MetaKeys.Ctrl : x\n      ),\n    };\n  }\n  return hotkey;\n}\n\nconst codeA = 'a'.charCodeAt(0);\nconst codeZ = 'z'.charCodeAt(0);\n\nconst KEY_MAP: JSONObject = {};\nfor (let key = codeA; key <= codeZ; key++) {\n  const char = String.fromCharCode(key);\n  KEY_MAP[char] = `Key${char.toUpperCase()}`;\n}\n\nexport function isKeyPressed(event: KeyboardEvent, key: string): boolean {\n  const keyCode = KEY_MAP[key];\n  const keyCodePressed = keyCode && event.nativeEvent.code === keyCode;\n  return keyCodePressed || event.key === key;\n}\n\nexport function isHotkeyActive(event: KeyboardEvent, hotkey: Hotkey): boolean {\n  return (\n    isKeyPressed(event, hotkey.key) &&\n    hotkey.metaKeys.every((k) => event[META_KEY_MAP[k]])\n  );\n}\n\nexport function makeHandler(\n  shortcut: Shortcut,\n  handler: (event: KeyboardEvent) => void\n) {\n  const hotkey = getPlatformHotkey(shortcut);\n\n  return (e: KeyboardEvent) => {\n    if (!isHotkeyActive(e, hotkey)) {\n      return;\n    }\n    handler(e);\n  };\n}\n", "import React, {\n  JSXElementConstructor,\n  KeyboardEventHandler,\n  MouseEvent,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useRef,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport { Node, Transforms } from 'https://esm.sh/slate@0.87.0';\nimport {\n  RenderElementProps,\n  useSelected,\n  useSlateStatic,\n} from 'https://esm.sh/slate-react@0.87.1';\nimport { Scroller, useScrollParent } from '../../react-utils/scrolling.tsx';\nimport { layout, styleguide } from '../../../../../styles/index.ts';\n\nimport PopperView from '../../../../../styles/components/popper.tsx';\nimport { makeStyles, cn } from '../../../../../styles/css-objects/index.ts';\nimport { CfdsEditor } from '../cfds/with-cfds.tsx';\nimport { isKeyPressed } from '../utils/hotkeys.ts';\nimport { MentionElement } from '../../../../../cfds/richtext/model.ts';\n\nconst useStyles = makeStyles((theme) => ({\n  scroller: {\n    maxHeight: styleguide.gridbase * 40,\n    overflowY: 'auto',\n  },\n  suggestionItem: {\n    // height: styleguide.gridbase * 7,\n    minWidth: styleguide.gridbase * 25,\n    padding: styleguide.gridbase * 2,\n    boxSizing: 'border-box',\n    fontSize: 14,\n    alignItems: 'center',\n    backgroundColor: theme.background[0],\n    transform: `backgroundColor linear ${styleguide.transition.duration.short}ms`,\n    ':hover': {\n      backgroundColor: '#f7f9ff',\n    },\n    userSelect: 'none',\n    basedOn: [layout.row],\n  },\n  suggestionIcon: {\n    marginRight: styleguide.gridbase,\n    basedOn: [layout.column, layout.centerCenter],\n  },\n  selected: {\n    backgroundColor: theme.background[500],\n  },\n  anchor: {\n    display: 'inline-block',\n  },\n  popperShadow: {\n    boxShadow: theme.shadows.z2,\n  },\n}));\n\nexport interface RenderMentionPopupProps<T> {\n  filter: string;\n  closeMention: () => void;\n  SuggestionComponent: JSXElementConstructor<SuggestionComponentProps<T>>;\n}\n\nexport interface MentionElementNodeProps<T> extends RenderElementProps {\n  element: MentionElement;\n  trigger: string;\n  registerKeyDown: (fn: KeyboardEventHandler) => () => void;\n  MentionComponent: React.JSXElementConstructor<RenderMentionPopupProps<T>>;\n}\n\nexport interface SuggestionComponentProps<T> {\n  items: T[];\n  keyForItem: (item: T) => string;\n  onItemSelected: (item: T) => void;\n  ItemSuggestionComponent: JSXElementConstructor<{\n    item: T;\n    isSelected: boolean;\n    onItemSelected: (item: T) => void;\n  }>;\n}\n\nexport interface MentionSuggestionsProps<T> {\n  filter: string;\n  selectedIndex: number;\n  setLength: (length: number) => void;\n  setSelectedItem: (item: T) => void;\n}\n\ninterface SuggestionItemProps<T> {\n  isSelected: boolean;\n  children?: React.ReactNode;\n  item: T;\n  onItemSelected: (item: T) => void;\n}\n\nexport const SuggestionItemIcon: React.FC<React.PropsWithChildren> = ({\n  children,\n}) => {\n  const styles = useStyles();\n  return <div className={cn(styles.suggestionIcon)}>{children}</div>;\n};\n\nexport function SuggestionItem<T>({\n  isSelected,\n  children,\n  onItemSelected,\n  item,\n}: SuggestionItemProps<T>) {\n  const styles = useStyles();\n  const ref = useRef();\n  const scrollParent = useScrollParent();\n  useLayoutEffect(() => {\n    if (isSelected && ref.current && scrollParent) {\n      // TODO: scroll if necessary\n    }\n  }, [scrollParent, isSelected]);\n  const onClick = (e: MouseEvent) => {\n    e.stopPropagation();\n    e.preventDefault();\n    onItemSelected(item);\n  };\n  return (\n    <div\n      className={cn(styles.suggestionItem, isSelected && styles.selected)}\n      onClick={onClick}\n    >\n      {children}\n    </div>\n  );\n}\n\ninterface InnerSuggestionComponentProps<T> extends SuggestionComponentProps<T> {\n  registerKeyDown: (fn: KeyboardEventHandler) => () => void;\n}\n\nfunction InnerSuggestionComponent<T>({\n  ItemSuggestionComponent,\n  items,\n  keyForItem,\n  registerKeyDown,\n  onItemSelected,\n}: InnerSuggestionComponentProps<T>) {\n  const [selectedIndex, setSelectedIndex] = useState(0);\n  const length = items.length;\n  const selectedItem = useRef(items[selectedIndex]);\n  useEffect(() => {\n    selectedItem.current = items[selectedIndex];\n  }, [items, selectedIndex]);\n  useEffect(() => {\n    return registerKeyDown((e) => {\n      switch (e.key) {\n        case 'ArrowUp':\n        case 'Up': {\n          setSelectedIndex((x) => (x - 1) % length);\n          e.preventDefault();\n          break;\n        }\n        case 'ArrowDown':\n        case 'Down': {\n          setSelectedIndex((x) => (x + 1) % length);\n          e.preventDefault();\n          break;\n        }\n        case 'Enter':\n        case 'ArrowRight':\n        case 'Right': {\n          e.preventDefault();\n          onItemSelected(selectedItem.current);\n          break;\n        }\n        default: {\n          return;\n        }\n      }\n    });\n  }, [registerKeyDown, length, onItemSelected]);\n\n  useEffect(() => setSelectedIndex(0), [length]);\n\n  return (\n    <React.Fragment>\n      {items.map((item, index) => (\n        <ItemSuggestionComponent\n          key={keyForItem(item)}\n          item={item}\n          isSelected={index === selectedIndex}\n          onItemSelected={() => onItemSelected(item)}\n        />\n      ))}\n    </React.Fragment>\n  );\n}\n\nexport function MentionElementNode<T>({\n  attributes,\n  trigger,\n  element,\n  children,\n  registerKeyDown,\n  MentionComponent,\n}: MentionElementNodeProps<T>) {\n  const styles = useStyles();\n  const anchor = useRef(null);\n  const editor = useSlateStatic();\n  const selected = useSelected();\n  const [open, setOpen] = useState(false);\n  const content = Node.string(element).trim();\n  const filter = content.startsWith(trigger)\n    ? content.substr(trigger.length).trim()\n    : content;\n  const contentRef = useRef(content);\n\n  useLayoutEffect(() => {\n    setOpen(selected && !!anchor.current);\n  }, [selected]);\n\n  const closeMention = useCallback(() => {\n    const path = CfdsEditor.findPath(editor, element);\n    // Workaround: Apparently under some weird conditions this function gets\n    // called more than once, which causes the second execution to clear the\n    // editor's contents.\n    if (path === undefined || path.length === 0) {\n      return;\n    }\n    Transforms.removeNodes(editor, { at: path });\n    editor.activeMention = '';\n    editor.discardMention = () => {};\n  }, [editor, element]);\n  const closeMentionRef = useRef(closeMention);\n\n  useEffect(() => {\n    contentRef.current = content;\n    closeMentionRef.current = closeMention;\n  }, [content, closeMention]);\n\n  useEffect(() => {\n    return registerKeyDown((e) => {\n      if (isKeyPressed(e, 'Backspace') && contentRef.current === trigger) {\n        e.preventDefault();\n        closeMentionRef.current();\n      }\n    });\n  }, [registerKeyDown, trigger]);\n\n  const SuggestionComponent = useCallback(\n    (props: SuggestionComponentProps<T>) => {\n      return (\n        <InnerSuggestionComponent\n          {...props}\n          registerKeyDown={registerKeyDown}\n        />\n      );\n    },\n    [registerKeyDown]\n  );\n\n  return (\n    <div {...attributes} className={cn(styles.anchor)}>\n      <span ref={anchor}>\n        {children}\n        <PopperView\n          anchor={anchor.current!}\n          position=\"bottom\"\n          align=\"start\"\n          contentEditable={false}\n          open={open}\n          className={cn(styles.popperShadow)}\n        >\n          <Scroller>\n            {(ref) => (\n              <div ref={ref} className={cn(styles.scroller)}>\n                <MentionComponent\n                  filter={filter}\n                  SuggestionComponent={SuggestionComponent}\n                  closeMention={closeMention}\n                />\n              </div>\n            )}\n          </Scroller>\n        </PopperView>\n      </span>\n    </div>\n  );\n}\n", "import {\n  Editor,\n  Element,\n  Node,\n  NodeEntry,\n  NodeMatch,\n  Text,\n  Location,\n  Path,\n  BaseRange,\n  Transforms,\n  Descendant,\n} from 'https://esm.sh/slate@0.87.0';\nimport { notReached } from '../../../../../base/error.ts';\n\ntype ElementMatch<T extends Element> =\n  | ((node: Element, path: Path) => node is T)\n  | ((node: Element, path: Path) => boolean);\n\nexport enum NodeToggleStatus {\n  Off,\n  Partial,\n  On,\n}\ntype SetNodesOptions = Parameters<typeof Transforms.setNodes>[2];\n\nexport const ElementUtils = {\n  getSingleElement<T extends Element>(\n    editor: Editor,\n    match: NodeMatch<T> = Element.isElement\n  ) {\n    const nodes = Array.from(\n      Editor.nodes(editor, {\n        match,\n        mode: 'highest',\n      })\n    );\n\n    if (nodes.length === 1) {\n      return nodes[0];\n    }\n    return null;\n  },\n  isSingleElement<T extends Element>(\n    editor: Editor,\n    match: ElementMatch<T> = () => true\n  ) {\n    return !!ElementUtils.getSingleElement(\n      editor,\n      (n, p) => Element.isElement(n) && match(n, p)\n    );\n  },\n  isEmpty(node: Node): boolean {\n    return !Node.string(node);\n  },\n  getClosestElement(editor: Editor, at: Location) {\n    return ElementUtils.getClosestNode(editor, at, Element.isElement);\n  },\n  getClosestNode<T extends Node>(\n    editor: Editor,\n    at: Location,\n    match: (node: Node) => node is T\n  ): NodeEntry<T> {\n    let [node, path] = Editor.node(editor, at);\n    while (path.length) {\n      if (match(node)) {\n        return [node, path];\n      }\n      [node, path] = Editor.node(editor, Path.parent(path));\n    }\n    notReached();\n  },\n  isEmptyElement(value: any): boolean {\n    if (!Element.isElement(value)) {\n      return false;\n    }\n\n    if (value.children.length === 0) {\n      // Shouldn't happen but whatever\n      return true;\n    }\n    if (value.children.length > 1) {\n      return false;\n    }\n    const onlyChild = value.children[0];\n    return Text.isText(onlyChild) && !onlyChild.text;\n  },\n  findNode<T extends Node>(\n    root: Node,\n    match: NodeMatch<T>\n  ): NodeEntry<T> | [null, null] {\n    for (const [node, path] of Node.elements(root)) {\n      if (match(node, path)) {\n        return [node, path];\n      }\n    }\n    return [null, null];\n  },\n  getNodeToggleStatus(\n    editor: Editor,\n    at: BaseRange,\n    condition: (node: Node) => boolean\n  ): NodeToggleStatus {\n    let fragment: Descendant[];\n    try {\n      fragment = Editor.fragment(editor, at);\n    } catch {\n      return NodeToggleStatus.Off;\n    }\n\n    let all = true;\n    let some = false;\n\n    for (const node of fragment) {\n      const conditionVal = condition(node);\n      all = all && conditionVal;\n      some = some || conditionVal;\n    }\n    if (all) {\n      return NodeToggleStatus.On;\n    }\n    if (some) {\n      return NodeToggleStatus.Partial;\n    }\n    return NodeToggleStatus.Off;\n  },\n  toggleNode(\n    editor: Editor,\n    at: BaseRange,\n    setNodeAs: Partial<Node>,\n    condition: (node: Node) => boolean,\n    setNodesOptions?: Omit<SetNodesOptions, 'at'>\n  ) {\n    const nodeStatus = ElementUtils.getNodeToggleStatus(editor, at, condition);\n    if (nodeStatus === NodeToggleStatus.On) {\n      Transforms.setNodes(\n        editor,\n        { tagName: 'p' },\n        {\n          ...setNodesOptions,\n          at,\n        }\n      );\n    } else {\n      Transforms.setNodes(editor, setNodeAs, {\n        ...setNodesOptions,\n        at,\n      });\n    }\n  },\n};\n", "import {\n  BaseRange,\n  Editor,\n  Element,\n  Node,\n  NodeEntry,\n  Path,\n  Point,\n  Range,\n} from 'https://esm.sh/slate@0.87.0';\nimport { ReactEditor } from 'https://esm.sh/slate-react@0.87.1';\nimport { CfdsEditor } from '../cfds/with-cfds.tsx';\nimport { ElementUtils } from './element-utils.ts';\nimport { TreeNode } from '../../../../../cfds/richtext/tree.ts';\n\nexport const SelectionUtils = {\n  extractSingleElement(\n    editor: Editor,\n    at?: BaseRange | null\n  ): NodeEntry<Element> | [null, null] {\n    at = at || editor.selection;\n    if (!at) {\n      return [null, null];\n    }\n    const [a, b] = Range.edges(at);\n    const [[nodeA, pathA], [, pathB]] = [\n      ElementUtils.getClosestElement(editor, a.path),\n      ElementUtils.getClosestElement(editor, b.path),\n    ];\n    if (!Path.equals(pathA, pathB)) {\n      return [null, null];\n    }\n    return [nodeA, pathA];\n  },\n  getEditorEnd(editor: Editor): Point {\n    let node: Node = editor;\n    const path: Path = [];\n    while (node.children) {\n      const index: number = (node.children as []).length - 1;\n      path.push(index);\n      node = (node.children as TreeNode[])[index] as Node;\n    }\n    const offset = Node.string(node).length;\n\n    const point = { path, offset };\n    return point;\n  },\n  focusAtEnd(editor: Editor): void {\n    const end = SelectionUtils.getEditorEnd(editor);\n    ReactEditor.deselect(editor);\n    ReactEditor.blur(editor);\n    const sel = {\n      focus: end,\n      anchor: end,\n    };\n    ReactEditor.focus(editor);\n    CfdsEditor.setExternalSelection(editor, sel);\n    editor.onChange();\n  },\n};\n", "import { commonPrefixLen, commonSuffixLen } from '../../base/string.ts';\nimport { kDMP } from '../base/defs.ts';\n\n/**\n * Given an expected text and a user input, this functions calculates a boost\n * value between [0, 2.0] based on character similarity.\n */\nfunction letterBoost(expected: string, input: string): number {\n  const origChars = new Set(expected);\n  let correctCount = 0;\n  let wrongCount = 0;\n  for (const c of input) {\n    if (origChars.has(c)) {\n      ++correctCount;\n    } else {\n      ++wrongCount;\n    }\n  }\n  return 1.0 + (correctCount - wrongCount) / origChars.size;\n}\n\nexport function wordDist(\n  expected: string,\n  input: string,\n  clamp = false\n): number {\n  // Ignore case for all comparisons\n  expected = expected.toLowerCase();\n  input = input.toLowerCase();\n\n  // Calculate distance based on levenshtein distance\n  const diff = kDMP.diff_main(input, expected, false);\n  const levenshteinDist = kDMP.diff_levenshtein(diff);\n  // Boost by character similarity\n  const weightedLevenDist =\n    Math.max(0, 1.0 - levenshteinDist / expected.length) *\n    letterBoost(expected, input);\n\n  // Also explicitly check for prefix/suffix match\n  const preDist = Math.min(\n    1,\n    // Boost by 10x prefix match so exact prefix always wins\n    (3 * commonPrefixLen(expected, input)) / expected.length\n  );\n  const sufDist = commonSuffixLen(expected, input) / expected.length;\n\n  let dist = Math.max(weightedLevenDist, preDist, sufDist);\n  if (clamp) {\n    dist = Math.min(1.0, Math.max(0.0, dist));\n  }\n  return dist;\n}\n\nfunction splitWords(str: string) {\n  return str.split(/\\s+/u);\n}\n\nfunction phraseDist(expected: string, input: string): number {\n  const expectedWords = splitWords(expected);\n  const inputWords = splitWords(input);\n  let matchCount = 0;\n  let matchSum = 0;\n  for (const iw of inputWords) {\n    for (const ew of expectedWords) {\n      const dist = wordDist(ew, iw);\n      matchSum += dist;\n      ++matchCount;\n    }\n  }\n  return matchCount === 0 ? 0 : matchSum / matchCount;\n}\n\ntype SuggestionEntry<T> = [dist: number, value: T];\n\nexport function suggestResults(\n  userInput: string,\n  values: readonly string[]\n): string[];\n\nexport function suggestResults<T>(\n  userInput: string,\n  values: readonly T[],\n  getValue: (v: T) => string\n): T[];\n\nexport function suggestResults<T>(\n  userInput: string,\n  values: readonly T[],\n  getValue: (v: T) => string = (v) => v as unknown as string\n): T[] {\n  if (userInput.length <= 0) {\n    return Array.from(values);\n  }\n  // const matchThreshold = 0.3;\n  const entries: SuggestionEntry<T>[] = [];\n  for (const v of values) {\n    const dist = phraseDist(getValue(v), userInput);\n    if (/*dist > 0 ||*/ userInput.length === 0) {\n      entries.push([dist, v]);\n    }\n  }\n  return entries.sort((e1, e2) => e2[0] - e1[0]).map((e) => e[1]);\n}\n\n// console.log(\n//   suggestResults('o', [\n//     'Status/In Progress',\n//     'Status/Done',\n//     'Status/To Do',\n//     'Type/Task',\n//     'Type/Note',\n//   ])\n// );\n", "import React, { KeyboardEventHandler } from 'https://esm.sh/react@18.2.0';\nimport {\n  BaseEditor,\n  Editor,\n  Element,\n  Transforms,\n} from 'https://esm.sh/slate@0.87.0';\n\nimport { FormattedText, OvvioEditor } from '../types.ts';\nimport { Plugin } from '../plugins/index.ts';\nimport {\n  MentionElementNode,\n  RenderMentionPopupProps,\n} from './mention-node.tsx';\nimport { ElementNode, TreeNode } from '../../../../../cfds/richtext/tree.ts';\nimport { uniqueId } from '../../../../../base/common.ts';\nimport { isKeyPressed } from '../utils/hotkeys.ts';\nimport { SelectionUtils } from '../utils/selection-utils.ts';\nimport { ElementUtils } from '../utils/element-utils.ts';\nimport { suggestResults } from '../../../../../cfds/client/suggestions.ts';\nimport { MentionElement } from '../../../../../cfds/richtext/model.ts';\n//import { wordDist } from '@ovvio/cfds/lib/primitives-old/plaintext';\n\n// export interface MentionElement extends ElementNode {\n//   tagName: 'mention';\n//   pluginId: string;\n//   children: FormattedText[];\n//   isLocal: true;\n// }\n\nexport interface MentionEditor extends BaseEditor {\n  activeMention?: string;\n  discardMention: () => void;\n}\n\nexport function isMention(node: TreeNode): node is MentionElement {\n  return Element.isElement(node) && node.tagName === 'mention';\n}\n\nexport function filterSortMentions<T>(\n  items: readonly T[],\n  query: string,\n  getSortValue: (item: T) => string\n) {\n  return suggestResults(query, items, getSortValue);\n  // return items\n  //   .map(x => ({\n  //     item: x,\n  //     dist: wordDist(getSortValue(x).toLowerCase(), query.toLowerCase()),\n  //   }))\n  //   .filter(x => !query || x.dist > 0.3)\n  //   .sort((a, b) => b.dist - a.dist)\n  //   .slice(0, 5)\n  //   .map(x => x.item);\n}\n\nexport function withMentions<T extends Editor>(editor: T): MentionEditor & T {\n  const { isInline, apply } = editor;\n\n  editor.isInline = (element) =>\n    isMention(element as TreeNode) || isInline(element);\n  const mentionEditor = editor as unknown as MentionEditor & T;\n\n  mentionEditor.apply = (operation) => {\n    apply(operation);\n    if (operation.type === 'set_selection' && mentionEditor.activeMention) {\n      const [node] = editor.selection\n        ? SelectionUtils.extractSingleElement(\n            mentionEditor,\n            mentionEditor.selection\n          )\n        : [null];\n      if (!node || !isMention(node)) {\n        mentionEditor.discardMention();\n      }\n    }\n  };\n\n  mentionEditor.activeMention = '';\n  mentionEditor.discardMention = () => {};\n\n  return mentionEditor as MentionEditor & T;\n}\n\nexport interface MentionOptions<T> {\n  trigger: string;\n  editor: Editor;\n  canOpen: () => boolean;\n  MentionComponent: React.JSXElementConstructor<RenderMentionPopupProps<T>>;\n}\n\nexport function createMentionsPlugin<T>({\n  trigger,\n  editor,\n  canOpen,\n  MentionComponent,\n}: MentionOptions<T>): Partial<Plugin> {\n  const pluginId = uniqueId();\n  const handlers: KeyboardEventHandler[] = [];\n  const registerKeyDown = (fn: KeyboardEventHandler) => {\n    handlers.push(fn);\n    return () => handlers.splice(handlers.indexOf(fn), 1);\n  };\n\n  return {\n    onKeyDown(e) {\n      if (editor.activeMention === pluginId) {\n        handlers.forEach((fn) => fn(e));\n      }\n      if (!editor.activeMention && isKeyPressed(e, trigger) && canOpen()) {\n        e.preventDefault();\n        const path = [...editor.selection!.focus.path];\n        const index = path.pop();\n        Editor.insertNode(editor, {\n          tagName: 'mention',\n          pluginId,\n          isLocal: true,\n          children: [{ text: `${trigger} ` }],\n        });\n        const point = {\n          path: [...path, index! + 1, 0],\n          offset: trigger.length,\n        };\n        Transforms.setSelection(editor, {\n          focus: point,\n          anchor: point,\n        });\n        editor.activeMention = pluginId;\n        editor.discardMention = () => {\n          const [mention, path] = ElementUtils.findNode(\n            editor,\n            (node: TreeNode | OvvioEditor) => {\n              if (isMention(node as TreeNode)) {\n                return (node as MentionElement).pluginId === pluginId;\n              }\n              return false;\n            }\n          );\n          if (!mention) {\n            console.warn('Discard mention called but no mention found');\n          } else {\n            Transforms.unwrapNodes(editor, { at: path });\n          }\n          editor.activeMention = '';\n          editor.discardMention = () => {};\n        };\n      }\n    },\n    renderElement(props) {\n      if (!isMention(props.element) || props.element.pluginId !== pluginId) {\n        return;\n      }\n\n      return (\n        <MentionElementNode\n          MentionComponent={MentionComponent}\n          registerKeyDown={registerKeyDown}\n          {...props}\n          element={props.element}\n          trigger={trigger}\n        />\n      );\n    },\n  };\n}\n", "import React, { useCallback, useMemo } from 'https://esm.sh/react@18.2.0';\nimport { VertexManager } from '../../../../../cfds/client/graph/vertex-manager.ts';\nimport {\n  Note,\n  Tag,\n  Workspace,\n} from '../../../../../cfds/client/graph/vertices/index.ts';\nimport { styleguide } from '../../../../../styles/index.ts';\nimport { cn, makeStyles } from '../../../../../styles/css-objects/index.ts';\nimport {\n  isTag,\n  useQuery,\n  useQuery2,\n  useSharedQuery,\n} from '../../cfds/react/query.ts';\nimport { usePartialVertex } from '../../cfds/react/vertex.ts';\nimport {\n  createMentionsPlugin,\n  filterSortMentions,\n  MentionOptions,\n} from './index.tsx';\nimport { useCurrentCard } from '../elements/card.element/index.tsx';\nimport { Plugin } from '../plugins/index.ts';\nimport {\n  RenderMentionPopupProps,\n  SuggestionItem,\n  SuggestionItemIcon,\n} from './mention-node.tsx';\nimport { Query } from '../../../../../cfds/client/graph/query.ts';\nimport {\n  useGraphManager,\n  useSharedQueriesManager,\n} from '../../cfds/react/graph.tsx';\n\nconst useStyles = makeStyles((theme) => ({\n  tagIndicator: {\n    width: styleguide.gridbase,\n    height: styleguide.gridbase,\n    borderRadius: '50%',\n    marginRight: styleguide.gridbase,\n  },\n}));\n\n// function CreateNewItem(props: {\n//   isSelected: boolean;\n//   onItemSelected: () => void;\n// }) {\n//   return (\n//     <SuggestionItem {...props}>\n//       <SuggestionItemIcon>\n//         <IconCreateNew />\n//       </SuggestionItemIcon>\n//       <Text>Create New</Text>\n//     </SuggestionItem>\n//   );\n// }\n\nfunction TagSuggestion({\n  item,\n  ...rest\n}: {\n  item: VertexManager<Tag>;\n  isSelected: boolean;\n  onItemSelected: (item: VertexManager<Tag>) => void;\n}) {\n  const styles = useStyles();\n  const { name } = usePartialVertex(item, ['name']);\n  return (\n    <SuggestionItem item={item} {...rest}>\n      <SuggestionItemIcon>\n        <div className={cn(styles.tagIndicator)} />\n      </SuggestionItemIcon>\n      {name}\n    </SuggestionItem>\n  );\n}\n\nfunction TagItemComponent({\n  item,\n  ...rest\n}: {\n  item: VertexManager<Tag>;\n  isSelected: boolean;\n  onItemSelected: (item: VertexManager<Tag>) => void;\n}) {\n  // if (item === CREATE_NEW_TAG) {\n  //   return <CreateNewItem {...rest} />;\n  // }\n\n  return <TagSuggestion item={item} {...rest} />;\n}\n\nfunction TagsSuggestionComponent({\n  filter,\n  SuggestionComponent,\n  closeMention,\n}: RenderMentionPopupProps<VertexManager<Tag>>) {\n  const card = useCurrentCard()!;\n  const partial = usePartialVertex(card, ['tags']);\n  const sharedQueries = useSharedQueriesManager();\n  const childTagsQuery = useQuery2(\n    new Query(sharedQueries.childTags, (tag) => {\n      const cardTagChild = partial.tags.get(tag.parentTag!);\n      return !cardTagChild || tag !== cardTagChild;\n    })\n  );\n\n  const filteredTags = filterSortMentions(\n    childTagsQuery.results,\n    filter,\n    (t) => t.getVertexProxy().name\n  );\n\n  const onItemSelected = (mgr: VertexManager<Tag>) => {\n    closeMention();\n    const { tags } = partial;\n    const tag = mgr.getVertexProxy();\n    tags.set(tag.parentTag!, tag);\n    partial.tags = tags;\n  };\n\n  return (\n    <SuggestionComponent\n      items={filteredTags}\n      keyForItem={(mgr: VertexManager<Tag>) => mgr.key}\n      onItemSelected={onItemSelected}\n      ItemSuggestionComponent={TagItemComponent}\n    />\n  );\n}\n\ninterface TagsPluginOptions\n  extends Pick<MentionOptions<Tag>, 'canOpen' | 'editor'> {}\n\nexport function createTagsPlugin(options: TagsPluginOptions): Partial<Plugin> {\n  return createMentionsPlugin<VertexManager<Tag>>({\n    ...options,\n    trigger: '#',\n    MentionComponent: TagsSuggestionComponent,\n  });\n}\n", "import { KeyboardEventHandler } from 'https://esm.sh/react@18.2.0';\nimport { NodeEntry, Range } from 'https://esm.sh/slate@0.87.0';\nimport {\n  RenderElementProps,\n  RenderLeafProps,\n} from 'https://esm.sh/slate-react@0.87.1';\nimport { coreValueEquals } from '../../../../../base/core-types/equals.ts';\n\ntype PropType<T, K extends keyof T> = T[K];\n\nfunction createTypeguard<T extends Partial<Plugin>>(\n  key: keyof T\n): (handler: Partial<Plugin> | undefined) => handler is T {\n  return ((handler: Partial<Plugin> | undefined) =>\n    handler && key in handler) as unknown as (\n    handler: Partial<Plugin> | undefined\n  ) => handler is T;\n}\n\nfunction slateAttributesEquals(\n  prev: PropType<RenderElementProps, 'attributes'>,\n  next: PropType<RenderElementProps, 'attributes'>\n): boolean {\n  return (\n    prev['data-slate-node'] === next['data-slate-node'] &&\n    prev['data-slate-inline'] === next['data-slate-inline'] &&\n    prev['data-slate-void'] === next['data-slate-void'] &&\n    prev['dir'] === next['dir'] &&\n    prev['ref'] === next['ref']\n  );\n}\n\nexport function areElementPropsEqual(\n  prevProps: RenderElementProps,\n  nextProps: RenderElementProps\n) {\n  return (\n    coreValueEquals(prevProps.element, nextProps.element) &&\n    slateAttributesEquals(prevProps.attributes, nextProps.attributes)\n  );\n}\n\nexport interface KeyDownHandler {\n  onKeyDown: KeyboardEventHandler;\n}\n\nconst isKeyDownHandler = createTypeguard<KeyDownHandler>('onKeyDown');\n\nexport interface RenderElementHandler {\n  renderElement: (props: RenderElementProps) => JSX.Element | null | undefined;\n}\n\nconst isRenderElementHandler =\n  createTypeguard<RenderElementHandler>('renderElement');\n\nexport interface RenderLeafHandler {\n  renderLeaf: (props: RenderLeafProps) => JSX.Element | null;\n}\n\nconst isRenderLeafHandler = createTypeguard<RenderLeafHandler>('renderLeaf');\n\nexport interface DecorateHandler {\n  decorate: (entry: NodeEntry) => Range[];\n}\nconst isDecorateHandler = createTypeguard<DecorateHandler>('decorate');\n\nexport type Plugin = KeyDownHandler &\n  RenderElementHandler &\n  RenderLeafHandler &\n  DecorateHandler;\n\nexport type PluginStack = KeyDownHandler & {\n  renderElement: (props: RenderElementProps) => JSX.Element;\n  renderLeaf: (props: RenderLeafProps) => JSX.Element;\n};\n\nexport function mergePlugins(plugins: (Partial<Plugin> | undefined)[]): Plugin {\n  const keyboardHandlers = plugins.filter(isKeyDownHandler);\n  const renderers = plugins.filter(isRenderElementHandler);\n  const leafRenderers = plugins.filter(isRenderLeafHandler);\n  const decorators = plugins.filter(isDecorateHandler);\n\n  return {\n    onKeyDown(event) {\n      for (const handler of keyboardHandlers) {\n        handler.onKeyDown(event);\n        if (event.defaultPrevented) {\n          return;\n        }\n      }\n    },\n    renderElement(props) {\n      for (const renderer of renderers) {\n        const el = renderer.renderElement(props);\n        if (el) {\n          return el;\n        }\n      }\n    },\n    renderLeaf(props) {\n      for (const renderer of leafRenderers) {\n        const el = renderer.renderLeaf(props);\n        if (el) {\n          return el;\n        }\n      }\n      return null;\n    },\n    decorate(entry) {\n      return decorators.reduce((ranges, decorator) => {\n        return ranges.concat(decorator.decorate(entry));\n      }, [] as Range[]);\n    },\n  };\n}\n\nexport function createPluginStack(\n  plugins: (Partial<Plugin> | undefined)[]\n): PluginStack {\n  const merged = mergePlugins(plugins);\n  const { renderElement, renderLeaf } = merged;\n  return {\n    ...merged,\n    renderElement(props) {\n      const el = renderElement(props);\n      if (!el) {\n        throw new Error('No default renderer defined');\n      }\n      return el;\n    },\n    renderLeaf(props) {\n      const el = renderLeaf(props);\n      if (!el) {\n        throw new Error('No default leaf renderer defined');\n      }\n      return el;\n    },\n  };\n}\n", "import {\n  Editor,\n  Range,\n  Node as SlateNode,\n  NodeEntry,\n  Transforms,\n  Node,\n} from 'https://esm.sh/slate@0.87.0';\nimport { KeyDownHandler } from '../plugins/index.ts';\nimport { ElementUtils } from './element-utils.ts';\nimport { getPlatformHotkey, isHotkeyActive, Shortcut } from './hotkeys.ts';\n\nexport interface AutoReplaceOptions {\n  trigger: Shortcut;\n  prefix: string;\n  editor: Editor;\n  onTriggered: (nodeEntry: NodeEntry) => void;\n  canTrigger?: (nodeEntry: NodeEntry) => boolean;\n}\n\nexport function createAutoReplaceHandler({\n  trigger,\n  prefix,\n  editor,\n  onTriggered,\n  canTrigger = () => true,\n}: AutoReplaceOptions): KeyDownHandler {\n  const hotkey = getPlatformHotkey(trigger);\n\n  return {\n    onKeyDown(event) {\n      if (\n        !isHotkeyActive(event, hotkey) ||\n        !editor.selection ||\n        !Range.isCollapsed(editor.selection)\n      ) {\n        return;\n      }\n      const parent = ElementUtils.getClosestElement(editor, editor.selection);\n      if (!parent) {\n        return;\n      }\n      const [node, path] = parent;\n\n      const text = SlateNode.string(node);\n\n      if (text.startsWith(prefix) && canTrigger([node, path])) {\n        event.preventDefault();\n        const [[, textPath]] = Array.from(SlateNode.texts(node));\n        const fullPath = [...path, ...textPath];\n        Transforms.delete(editor, {\n          at: {\n            anchor: { path: fullPath, offset: 0 },\n            focus: { path: fullPath, offset: prefix.length },\n          },\n        });\n        const alteredNode = Node.get(editor, path);\n        onTriggered([alteredNode, path]);\n      }\n    },\n  };\n}\n", "import { murmurhash2_32_gc } from '../base/hash.ts';\n\nconst COLORS_WORKSPACES = [\n  '#fe4a62',\n  '#dd2e9a',\n  '#1995d1',\n  '#00c7d6',\n  '#da9f43',\n];\nconst COLORS_USERS = ['#1995d1', '#00c7d6', '#da9f43', '#dd2e9a', '#fe4a62'];\nconst MURMUR_SEED_USER = 7998030375102784;\nconst MURMUR_SEED_WORKSPACE = 5941403181730068;\n\nfunction getColorForString(\n  str: string,\n  seed: number,\n  colors: string[]\n): string {\n  const index = murmurhash2_32_gc(str, seed) % colors.length;\n  return colors[index];\n}\n\nexport function getColorForUserId(uid: string): string {\n  return getColorForString(uid, MURMUR_SEED_USER, COLORS_USERS);\n}\n\nexport function getColorForWorkspaceId(uid: string): string {\n  return getColorForString(uid, MURMUR_SEED_WORKSPACE, COLORS_WORKSPACES);\n}\n", "import {\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\n\nexport function useAnimateWidth<T extends HTMLElement = HTMLElement>(\n  ref: React.RefObject<T>,\n  animateProp: any\n): Partial<{ width: number }> {\n  const size = useAnimateSize(ref.current, animateProp, 'width');\n  return useMemo(() => {\n    if (size === null) {\n      return {};\n    }\n    return { width: size };\n  }, [size]);\n}\n\nexport function useAnimateHeight<T extends HTMLElement = HTMLElement>(\n  ref: React.MutableRefObject<T | undefined | null>,\n  animateProp: any\n): Partial<{ height: number }> {\n  const size = useAnimateSize(ref.current || null, animateProp, 'height');\n  return useMemo(() => {\n    if (size === null) {\n      return {};\n    }\n    return { height: size };\n  }, [size]);\n}\n\nexport function useAnimateSize<T extends HTMLElement>(\n  el: T | null,\n  animateProp: any,\n  animateSizeKey: 'height' | 'width'\n): number | null {\n  const lastValue = useRef(animateProp);\n\n  const [size, setSize] = useState<number | null>(null);\n\n  // useEffect(() => {\n  //   setSize(null);\n  //   if (el) {\n  //     const handler = (e: TransitionEvent) => {\n  //       if (e.propertyName === animateSizeKey) {\n  //         setSize(null);\n  //       }\n  //     };\n  //     el.addEventListener('transitionend', handler);\n  //     return () => {\n  //       el.removeEventListener('transitionend', handler);\n  //     };\n  //   }\n  // }, [el]);\n\n  useEffect(() => {\n    if (!el || animateProp === lastValue.current) {\n      return;\n    }\n\n    lastValue.current = animateProp;\n    const rect = el.getBoundingClientRect();\n    const currSize = rect[animateSizeKey];\n    setSize(null);\n    let abort = false;\n\n    window.requestAnimationFrame(() => {\n      if (abort) {\n        return;\n      }\n      const desiredSize = el.getBoundingClientRect()[animateSizeKey];\n      setSize(currSize);\n\n      window.requestAnimationFrame(() => {\n        if (abort) {\n          return;\n        }\n        setSize(desiredSize);\n      });\n    });\n\n    return () => {\n      abort = true;\n    };\n  }, [el, animateProp, animateSizeKey]);\n\n  return size;\n}\n", "import React, {\n  MouseEvent,\n  useCallback,\n  useRef,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport { makeStyles, cn } from '../../css-objects/index.ts';\nimport { styleguide } from '../../styleguide.ts';\nimport { layout } from '../../layout.ts';\nimport Popper, { PopperAlign, PopperPosition } from '../popper.tsx';\n\nconst useStyles = makeStyles(\n  (theme) => ({\n    container: {\n      position: 'relative',\n    },\n    tooltip: {\n      fontSize: 10,\n      color: theme.background[0],\n      position: 'relative',\n      zIndex: 100,\n      lineHeight: 1.6,\n      padding: [0, styleguide.gridbase],\n      whiteSpace: 'nowrap',\n      backgroundColor: theme.background[700],\n      margin: styleguide.gridbase,\n      borderRadius: 3,\n      height: styleguide.gridbase * 3,\n      boxSizing: 'border-box',\n      basedOn: [layout.column, layout.centerCenter],\n    },\n    open: {},\n  }),\n  'tooltip_d751da'\n);\n\nexport interface TooltipProps {\n  text: string;\n  children: React.ReactElement;\n  locked?: boolean;\n  className?: string;\n  position?: PopperPosition;\n  align?: PopperAlign;\n  disabled?: boolean;\n}\n\nexport const Tooltip = ({\n  text,\n  children,\n  locked,\n  className,\n  position = 'top',\n  align = 'center',\n  disabled = false,\n}: TooltipProps) => {\n  const styles = useStyles();\n  const buttonRef = useRef();\n  const [isOpen, setIsOpen] = useState(!!locked);\n  const button: React.ReactElement = React.Children.only(children);\n  const childProps = {\n    ref: buttonRef,\n    ...button.props,\n  };\n\n  const { onMouseOver, onMouseLeave } = childProps;\n\n  const onTooltipMouseOver = useCallback(\n    (e: MouseEvent) => {\n      setIsOpen(!disabled && (locked || true));\n      if (onMouseOver) {\n        onMouseOver(e);\n      }\n    },\n    [locked, onMouseOver, disabled]\n  );\n\n  const onTooltipMouseLeave = useCallback(\n    (e: MouseEvent) => {\n      setIsOpen(!disabled && (locked || false));\n      if (onMouseLeave) {\n        onMouseLeave(e);\n      }\n    },\n    [locked, onMouseLeave, disabled]\n  );\n  childProps.onMouseOver = onTooltipMouseOver;\n  childProps.onMouseLeave = onTooltipMouseLeave;\n\n  const cloned = React.cloneElement(button, childProps);\n  return (\n    <React.Fragment>\n      {cloned}\n      <Popper\n        open={isOpen && !!text}\n        anchor={buttonRef.current!}\n        position={position}\n        align={align}\n      >\n        <div className={cn(styles.tooltip, className)}>{text}</div>\n      </Popper>\n    </React.Fragment>\n  );\n};\n\nexport default Tooltip;\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { VertexManager } from '../../../../cfds/client/graph/vertex-manager.ts';\nimport { User } from '../../../../cfds/client/graph/vertices/user.ts';\nimport { layout, styleguide } from '../../../../styles/index.ts';\nimport Tooltip from '../../../../styles/components/tooltip/index.tsx';\nimport { useTypographyStyles } from '../../../../styles/components/typography.tsx';\nimport { cn, makeStyles } from '../../../../styles/css-objects/index.ts';\nimport { brandLightTheme as theme } from '../../../../styles/theme.tsx';\nimport { usePartialVertex } from '../../core/cfds/react/vertex.ts';\nconst useStyles = makeStyles(() => ({\n  container: {\n    overflow: 'hidden',\n    borderRadius: styleguide.gridbase * 2,\n    minWidth: styleguide.gridbase * 4,\n    height: styleguide.gridbase * 4,\n    boxSizing: 'border-box',\n    basedOn: [layout.column, layout.centerCenter],\n  },\n  noAvatar: {\n    border: '1px solid',\n    borderColor: theme.mono.m2,\n    backgroundColor: theme.colors.background,\n  },\n  small: {\n    boxSizing: 'border-box',\n    padding: [0, 2],\n    borderRadius: styleguide.gridbase,\n    minWidth: styleguide.gridbase * 2,\n    height: styleguide.gridbase * 2,\n  },\n  withImage: {\n    '&small': {\n      padding: 0,\n      width: styleguide.gridbase * 2,\n    },\n    '&big': {\n      width: styleguide.gridbase * 4,\n    },\n  },\n  userInitials: {\n    textTransform: 'uppercase',\n    basedOn: [useTypographyStyles.textSmall],\n  },\n  big: {\n    userInitials: {\n      fontSize: 15,\n    },\n  },\n}));\n\ninterface AvatarProps {\n  user: VertexManager<User>;\n  size?: 'small' | 'big';\n  className?: string;\n  style?: {};\n}\n\nfunction getInitials(name: string): string {\n  return name\n    .split(' ')\n    .map((x) => x[0])\n    .filter((x) => x)\n    .join('');\n}\n\nfunction AvatarView({\n  user,\n  size = 'small',\n  className,\n  style = {},\n}: AvatarProps) {\n  const styles = useStyles();\n  const { name, avatarUrl } = usePartialVertex(user, ['name', 'avatarUrl']);\n\n  return (\n    <Tooltip text={name}>\n      <div\n        className={cn(\n          className,\n          styles.container,\n          styles[size],\n          avatarUrl ? styles.withImage : styles.noAvatar\n        )}\n        style={{\n          ...style,\n        }}\n      >\n        {avatarUrl ? (\n          <img width=\"100%\" height=\"100%\" src={avatarUrl} alt={name} />\n        ) : (\n          <span className={cn(styles.userInitials)}>{getInitials(name)}</span>\n        )}\n      </div>\n    </Tooltip>\n  );\n}\n\nexport default AvatarView;\n", "import React, {\n  useEffect,\n  useRef,\n  useState,\n  useLayoutEffect,\n} from 'https://esm.sh/react@18.2.0';\nimport {\n  NavigateFunction,\n  useNavigate,\n} from 'https://esm.sh/react-router-dom@6.7.0';\nimport { notImplemented } from '../../../../base/error.ts';\nimport { Note } from '../../../../cfds/client/graph/vertices/note.ts';\nimport { VertexManager } from '../../../../cfds/client/graph/vertex-manager.ts';\n\nexport type RoutableDocument = Note;\n\nfunction resolveUrl(\n  doc: RoutableDocument | VertexManager<RoutableDocument>\n): string {\n  const vertex = doc instanceof VertexManager ? doc.getVertexProxy() : doc;\n  if (vertex instanceof Note) {\n    return `/${vertex.workspaceKey}/notes/${vertex.key}`;\n  }\n  return notImplemented();\n}\n\nfunction createDocumentRouter(navigate: NavigateFunction) {\n  return {\n    goTo(doc: RoutableDocument | VertexManager<RoutableDocument>): void {\n      const link = resolveUrl(doc);\n      navigate(link);\n    },\n    urlFor(doc: RoutableDocument | VertexManager<RoutableDocument>): string {\n      return resolveUrl(doc);\n    },\n  };\n}\n\nexport function useDocumentRouter() {\n  const navigate = useNavigate();\n  return createDocumentRouter(navigate);\n}\n\nexport function useWindowSize() {\n  const [size, setSize] = useState({\n    width: window.innerWidth,\n    height: window.innerHeight,\n  });\n\n  useEffect(() => {\n    const handler = () => {\n      setSize({\n        width: window.innerWidth,\n        height: window.innerHeight,\n      });\n    };\n\n    addEventListener('resize', handler);\n    return () => {\n      removeEventListener('resize', handler);\n    };\n  }, []);\n\n  return size;\n}\n\nexport function useElementSize(element: HTMLElement) {\n  const [size, setSize] = useState(() => {\n    const boundingBox = element && element.getBoundingClientRect();\n    return {\n      width: boundingBox ? boundingBox.width : 0,\n      height: boundingBox ? boundingBox.height : 0,\n    };\n  });\n\n  useLayoutEffect(() => {\n    const handler = () => {\n      const boundingBox = element && element.getBoundingClientRect();\n\n      setSize({\n        width: boundingBox ? boundingBox.width : 0,\n        height: boundingBox ? boundingBox.height : 0,\n      });\n    };\n\n    addEventListener('resize', handler);\n    handler();\n    return () => {\n      removeEventListener('resize', handler);\n    };\n  }, [element]);\n\n  return size;\n}\n\nexport function useRenderLogging() {\n  const stack = new Error().stack;\n  const componentName = stack?.split('\\n')[2].trim().split(' ')[1];\n\n  useEffect(() => {\n    if (componentName) {\n      console.log(`${componentName} - Rendered`);\n    }\n  });\n}\n\n// export function useTraceUpdate(props: any) {\n//   const prevProps = useRef(props);\n//   const stack = new Error().stack;\n\n//   const componentName = stack?.split('\\n')[2].trim().split(' ')[1];\n//   useEffect(() => {\n//     const changedProps = Object.entries(props).reduce((ps, [k, v]) => {\n//       if (prevProps.current[k] !== v) {\n//         ps[k] = [prevProps.current[k], v];\n//       }\n//       return ps;\n//     }, {});\n//     if (Object.keys(changedProps).length > 0) {\n//       console.log(`${componentName} changed props: `, changedProps);\n//     }\n//     prevProps.current = props;\n//   });\n// }\n\n// export function useReffedContext(context) {\n//   const val = useContext(context);\n//   const ref = useRef(val);\n//   useEffect(() => {\n//     ref.current = val;\n//   }, [val]);\n//   return ref;\n// }\n\nexport function useReffedValue<T>(val: T): React.MutableRefObject<T> {\n  const ref = useRef(val);\n  useEffect(() => {\n    ref.current = val;\n  }, [val]);\n  return ref;\n}\n\nexport function useMountedIndicator() {\n  const isMountedRef = useRef(true);\n  useEffect(() => {\n    isMountedRef.current = true;\n    return () => {\n      isMountedRef.current = false;\n    };\n  }, []);\n\n  return isMountedRef;\n}\n\nexport function useFocusOnMount<T extends HTMLElement>(\n  ref: React.RefObject<T>\n) {\n  useLayoutEffect(() => {\n    if (ref.current) {\n      ref.current.focus();\n    }\n  }, [ref]);\n}\n", "import React, {\n  useState,\n  useRef,\n  useLayoutEffect,\n} from 'https://esm.sh/react@18.2.0';\nimport { makeStyles, cn } from '../../../../styles/css-objects/index.ts';\nimport { styleguide, layout } from '../../../../styles/index.ts';\nimport { TextField } from '../../../../styles/components/inputs/index.ts';\nimport { useMenuClose } from '../../../../styles/components/menu.tsx';\nimport { useFocusOnMount } from '../../core/react-utils/index.ts';\nimport {\n  Scroller,\n  useScrollParent,\n} from '../../core/react-utils/scrolling.tsx';\n\nconst useStyles = makeStyles((theme) => ({\n  popup: {\n    backgroundColor: theme.background[0],\n    width: styleguide.gridbase * 32,\n    marginBottom: styleguide.gridbase * 2,\n  },\n  popupContent: {\n    backgroundColor: theme.background[0],\n    width: '100%',\n    boxSizing: 'border-box',\n    basedOn: [layout.column],\n  },\n  list: {\n    width: '100%',\n    maxHeight: styleguide.gridbase * 6 * 5,\n    overflowY: 'auto',\n    basedOn: [layout.column],\n  },\n  input: {\n    border: 'none',\n    width: '100%',\n    borderBottom: '1px solid rgba(156, 178, 205, 0.6)',\n    borderRadius: 0,\n  },\n  mention: {\n    flexShrink: 0,\n    width: '100%',\n    height: styleguide.gridbase * 6,\n    padding: [0, styleguide.gridbase],\n    boxSizing: 'border-box',\n    backgroundColor: theme.background[0],\n    alignItems: 'center',\n    cursor: 'pointer',\n    basedOn: [layout.row],\n  },\n  selected: {\n    backgroundColor: '#f0f3fa',\n  },\n}));\n\nexport interface MentionItemProps extends React.PropsWithChildren {\n  isSelected?: boolean;\n  onClick?: React.MouseEventHandler;\n}\n\nexport function MentionItem({\n  isSelected = false,\n  children,\n  onClick,\n}: MentionItemProps) {\n  const styles = useStyles();\n  const ref = useRef<HTMLDivElement>(null);\n  const scrollParent = useScrollParent();\n  useLayoutEffect(() => {\n    if (isSelected && scrollParent /*&& scrollParent.current*/) {\n      const parent = scrollParent; //.current;\n      const el = ref.current;\n      const scrollOffset = el!.offsetTop - parent.offsetTop;\n      const height = el!.clientHeight;\n      if (scrollOffset < parent.scrollTop) {\n        el!.scrollIntoView();\n      } else if (\n        scrollOffset + height >\n        parent.scrollTop + parent.clientHeight\n      ) {\n        parent.scrollTop = scrollOffset + height - parent.clientHeight;\n      }\n      // const needsScroll =\n      //   ((scrollOffset + height) > (parent.scrollTop + parent.clientHeight)) ||\n      //   scrollOffset < parent.scrollTop;\n\n      // if (needsScroll) {\n      //   parent.scrollTop = scrollOffset;\n      // }\n    }\n  }, [scrollParent, isSelected]);\n  return (\n    <div\n      onClick={onClick}\n      className={cn(styles.mention, isSelected && styles.selected)}\n      ref={ref}\n    >\n      {children}\n    </div>\n  );\n}\n\nexport interface MentionPopupRenderItemOpts {\n  isSelected: boolean;\n  onClick: () => void;\n}\n\nexport type MentionPopupRenderItem<T> = (\n  item: T,\n  opts: MentionPopupRenderItemOpts\n) => React.ReactNode;\n\nexport interface MentionPopupProps<T> {\n  trigger: string;\n  onSelected: (item: T, filter: string) => void;\n  getItems: (filter: string) => T[];\n  renderItem: MentionPopupRenderItem<T>;\n}\n\nexport function MentionPopup<T>({\n  trigger,\n  onSelected,\n  getItems,\n  renderItem,\n}: MentionPopupProps<T>) {\n  const close = useMenuClose();\n  const styles = useStyles();\n  const ref = useRef(null);\n  useFocusOnMount(ref);\n  const [filter, setFilter] = useState(trigger);\n  const onChange = ({ target }: React.FormEvent<HTMLInputElement>) => {\n    let { value } = target as HTMLInputElement;\n\n    if (!value.startsWith(trigger)) {\n      value = `${trigger}${value}`;\n    }\n    setFilter(value);\n  };\n\n  const [selectedIndex, setSelectedIndex] = useState(0);\n  const select = (item: T) => {\n    onSelected(item, filter);\n    close();\n  };\n  const items = getItems(filter.substring(trigger.length));\n  const onKeyDown = (e: React.KeyboardEvent) => {\n    switch (e.key) {\n      case 'ArrowUp':\n        e.preventDefault();\n        e.stopPropagation();\n        setSelectedIndex((x) => (x - 1 < 0 ? items.length - 1 : x - 1));\n        break;\n      case 'ArrowDown':\n        e.preventDefault();\n        e.stopPropagation();\n        setSelectedIndex((x) => (x + 1) % items.length);\n        break;\n      case 'Backspace':\n        if (!filter) {\n          e.preventDefault();\n          e.stopPropagation();\n          close();\n        }\n        break;\n      case 'Escape':\n        e.preventDefault();\n        e.stopPropagation();\n        close();\n        break;\n      case 'Enter':\n        e.preventDefault();\n        e.stopPropagation();\n        select(items[selectedIndex]);\n        break;\n      default:\n        return;\n    }\n  };\n  return (\n    <div className={cn(styles.popupContent)}>\n      <TextField\n        className={cn(styles.input)}\n        type=\"text\"\n        value={filter}\n        onChange={onChange}\n        onKeyDown={onKeyDown}\n        ref={ref}\n      />\n      <Scroller>\n        {(ref) => (\n          <div className={cn(styles.list)} ref={ref}>\n            {items.map((item, i) =>\n              renderItem(item, {\n                isSelected: i === selectedIndex,\n                onClick: () => select(item),\n              })\n            )}\n          </div>\n        )}\n      </Scroller>\n    </div>\n  );\n}\n", "import { Note, User } from '../../../../cfds/client/graph/vertices/index.ts';\nimport { UISource } from '../../../../logging/client-events.ts';\nimport { Logger } from '../../../../logging/log.ts';\n\nexport function assignNote(\n  logger: Logger,\n  source: UISource,\n  card: Note,\n  user: User,\n  insteadOf?: User\n) {\n  const assignees = card.assignees;\n  assignees.add(user);\n  if (insteadOf && insteadOf !== user) {\n    assignees.delete(insteadOf);\n  }\n  logger.log({\n    severity: 'INFO',\n    event: 'MetadataChanged',\n    vertex: card.key,\n    uiSource: source,\n    metadataType: 'assignee',\n    removed: insteadOf?.key,\n    added: user.key,\n  });\n  // card.assignees = assignees;\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { wordDist } from '../../../../cfds/client/suggestions.ts';\nimport { styleguide } from '../../../../styles/styleguide.ts';\nimport Menu, { MenuRenderButton } from '../../../../styles/components/menu.tsx';\nimport { makeStyles, cn } from '../../../../styles/css-objects/index.ts';\nimport { MentionPopup, MentionPopupRenderItemOpts } from '../card/mention.tsx';\nimport { CoreObject } from '../../../../base/core-types/base.ts';\n\nconst useStyles = makeStyles((theme) => ({\n  popup: {\n    backgroundColor: theme.background[0],\n    width: styleguide.gridbase * 32,\n    marginBottom: styleguide.gridbase * 2,\n  },\n}));\nexport enum SORT_VALUES {\n  TOP = 'TOP',\n  BOTTOM = 'BOTTOM',\n}\nfunction calculateDist(sortValue: string | SORT_VALUES, filter: string) {\n  switch (sortValue) {\n    case SORT_VALUES.TOP: {\n      return 100;\n    }\n    case SORT_VALUES.BOTTOM: {\n      return 0;\n    }\n    default: {\n      return wordDist(sortValue.toLowerCase(), filter.toLowerCase());\n    }\n  }\n}\n\ninterface RenderItemFunctionProps<T> {\n  item: T;\n  key?: string;\n}\n\ntype RenderItemFunction<\n  T,\n  PT extends RenderItemFunctionProps<T> = RenderItemFunctionProps<T>\n> = (props: PT) => React.ReactNode;\n\ninterface SelectionPopupProps<T> {\n  onSelected: (item: T) => void;\n  trigger?: string;\n  getItems: (filter: string) => SelectionItem<T>[];\n  renderItem: RenderItemFunction<T>;\n}\n\ninterface SelectionPopupItemInternal<T> {\n  value: T;\n  key: string;\n  dist: number;\n  isFixed: boolean;\n}\nfunction SelectionPopup<T>({\n  onSelected,\n  trigger,\n  getItems,\n  renderItem,\n}: SelectionPopupProps<T>) {\n  const getItemsImpl = (filter: string) =>\n    getItems(filter)\n      .map(\n        (item) =>\n          ({\n            value: item.value,\n            key:\n              (item.value as any).key ||\n              (item.value as any).id ||\n              item.sortValue,\n            dist: calculateDist(item.sortValue, filter),\n            isFixed:\n              item.sortValue === SORT_VALUES.BOTTOM ||\n              item.sortValue === SORT_VALUES.TOP,\n          } as SelectionPopupItemInternal<T>)\n      )\n      .filter((x) => !filter || x.dist > filter.length * 0.1 || x.isFixed)\n      .sort((a, b) => b.dist - a.dist);\n\n  const onSelectedImpl = (item: SelectionPopupItemInternal<T>) => {\n    const { value } = item;\n\n    onSelected(value);\n  };\n  const renderItemImpl = (\n    item: SelectionPopupItemInternal<T>,\n    opts: MentionPopupRenderItemOpts\n  ) => renderItem({ ...opts, item: item.value, key: item.key });\n\n  return (\n    <MentionPopup\n      getItems={getItemsImpl}\n      trigger={trigger || ''}\n      onSelected={onSelectedImpl}\n      renderItem={renderItemImpl}\n    />\n  );\n}\n\nexport interface SelectionItem<T> {\n  value: T;\n  sortValue: string | SORT_VALUES;\n  key?: string;\n}\n\ninterface SelectionButtonProps<T> {\n  className?: string;\n  children: MenuRenderButton;\n  onSelected: (item: T) => void;\n  trigger?: string;\n  getItems: (filter: string) => SelectionItem<T>[];\n  renderItem: RenderItemFunction<T>;\n  style?: {};\n}\nexport default function SelectionButton<T>({\n  className,\n  children,\n  onSelected,\n  renderItem,\n  getItems,\n  trigger = '',\n  style = {},\n}: SelectionButtonProps<T>) {\n  const styles = useStyles();\n  return (\n    <Menu\n      renderButton={children}\n      position=\"top\"\n      align=\"center\"\n      direction=\"in\"\n      className={className}\n      style={style}\n      popupClassName={cn(styles.popup)}\n    >\n      <SelectionPopup\n        onSelected={onSelected}\n        trigger={trigger}\n        renderItem={renderItem}\n        getItems={getItems}\n      />\n    </Menu>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { IconProps, IconSize } from './types.ts';\n\nexport function IconPlus({ className, size = IconSize.Small }: IconProps) {\n  return (\n    <svg\n      className={className}\n      width={size}\n      height={size}\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M0 8C0 3.58172 3.58172 0 8 0V0C12.4183 0 16 3.58172 16 8V8C16 12.4183 12.4183 16 8 16V16C3.58172 16 0 12.4183 0 8V8Z\"\n        fill=\"#E5E5E5\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M8 10L8 6\"\n        stroke=\"#3F3F3F\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M6 8L10 8\"\n        stroke=\"#262626\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n    </svg>\n  );\n}\n", "import React, {\n  useCallback,\n  useMemo,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport { makeStyles, cn } from '../../../../styles/css-objects/index.ts';\nimport { styleguide, layout } from '../../../../styles/index.ts';\nimport Avatar from '../avatar/index.tsx';\nimport { useTheme } from '../../../../styles/theme.tsx';\nimport { MentionItem } from './mention.tsx';\nimport { assignNote } from '../utils/assignees.ts';\nimport {\n  Note,\n  User,\n  Workspace,\n} from '../../../../cfds/client/graph/vertices/index.ts';\nimport SelectionButton, { SORT_VALUES } from '../selection-button/index.tsx';\nimport { IconClose } from '../../../../styles/components/icons/index.ts';\nimport { usePartialVertex } from '../../core/cfds/react/vertex.ts';\nimport { VertexManager } from '../../../../cfds/client/graph/vertex-manager.ts';\nimport { IconPlus } from '../../../../styles/components/new-icons/icon-plus.tsx';\nimport { brandLightTheme as theme } from '../../../../styles/theme.tsx';\nimport { UISource } from '../../../../logging/client-events.ts';\nimport { useLogger } from '../../core/cfds/react/logger.tsx';\n\nconst useStyles = makeStyles(() => ({\n  list: {\n    basedOn: [layout.row],\n    height: styleguide.gridbase * 3,\n    alignItems: 'center',\n  },\n  standard: {\n    flexDirection: 'row-reverse',\n    assignee: {\n      marginLeft: styleguide.gridbase * 0.5,\n    },\n  },\n  reverse: {\n    flexDirection: 'row',\n    assignee: {\n      marginRight: styleguide.gridbase * 0.5,\n    },\n  },\n  selectionButton: {\n    ...styleguide.transition.short,\n    transitionProperty: 'transform',\n  },\n  assignee: {},\n  regular: {\n    //marginTop: styleguide.gridbase * 2,\n    //marginBottom: styleguide.gridbase,\n    addButton: {\n      width: styleguide.gridbase * 3,\n      height: styleguide.gridbase * 3,\n    },\n  },\n  small: {\n    addButton: {\n      width: styleguide.gridbase * 2.5,\n      height: styleguide.gridbase * 2.5,\n    },\n  },\n  addButton: {\n    backgroundColor: theme.mono.m2,\n    flexShrink: 0,\n    borderRadius: '50%',\n    border: ``,\n  },\n  popup: {\n    backgroundColor: theme.colors.background,\n    width: styleguide.gridbase * 32,\n    marginBottom: styleguide.gridbase * 2,\n  },\n  popupContent: {\n    backgroundColor: theme.colors.background,\n    width: '100%',\n    boxSizing: 'border-box',\n    basedOn: [layout.column],\n  },\n  input: {\n    border: 'none',\n    width: '100%',\n    borderBottom: '1px solid rgba(156, 178, 205, 0.6)',\n    borderRadius: 0,\n  },\n  userName: {\n    flexGrow: 1,\n    whiteSpace: 'nowrap',\n    marginLeft: styleguide.gridbase,\n    color: theme.colors.text,\n  },\n  inviteIcon: {\n    marginRight: styleguide.gridbase * 2,\n  },\n  addIcon: {\n    opacity: 1,\n  },\n  hide: {\n    opacity: 0,\n  },\n}));\n\nfunction AddAssigneeIcon({\n  className = '',\n  fill = '#D7E3F1',\n  stroke = '#C5D4E6',\n}) {\n  const styles = useStyles();\n  const theme = useTheme();\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      xmlnsXlink=\"http://www.w3.org/1999/xlink\"\n      width=\"32\"\n      height=\"32\"\n      viewBox=\"0 0 32 32\"\n      className={cn(styles.addIcon, className)}\n    >\n      <defs>\n        <circle id=\"cY734WTs886Gxkc8xMVJ\" cx=\"16\" cy=\"16\" r=\"16\" />\n        <mask\n          id=\"dAQteIXSYDMRZpa0FZiB\"\n          width=\"32\"\n          height=\"32\"\n          x=\"0\"\n          y=\"0\"\n          fill=\"#fff\"\n          maskContentUnits=\"userSpaceOnUse\"\n          maskUnits=\"objectBoundingBox\"\n        >\n          <use xlinkHref=\"#cY734WTs886Gxkc8xMVJ\" />\n        </mask>\n      </defs>\n      <g fill=\"none\" fillRule=\"evenodd\">\n        <use\n          fill={theme.background[0]}\n          stroke=\"#C5D4E6\"\n          strokeDasharray=\"2 2\"\n          strokeWidth=\"4\"\n          mask=\"url(#dAQteIXSYDMRZpa0FZiB)\"\n          xlinkHref=\"#cY734WTs886Gxkc8xMVJ\"\n        />\n        <path\n          fill=\"#D7E3F1\"\n          d=\"M22.016 16.683L16.683 16.683 16.683 22.016 14.933 22.016 14.933 16.683 9.6 16.683 9.6 14.933 14.933 14.933 14.933 9.6 16.683 9.6 16.683 14.933 22.016 14.933z\"\n        />\n      </g>\n    </svg>\n  );\n}\n\nconst REMOVE_ASSIGNEE = 'REMOVE_ASSIGNEE';\nconst INVITE_USER = 'INVITE_USER';\ntype ACTION_ITEM = typeof REMOVE_ASSIGNEE | typeof INVITE_USER;\n\nconst RenderedItem = ({\n  item,\n  ...props\n}: {\n  item: VertexManager<User> | ACTION_ITEM;\n}) => {\n  const styles = useStyles();\n  if (item === REMOVE_ASSIGNEE) {\n    return (\n      <MentionItem {...props} key={REMOVE_ASSIGNEE}>\n        <IconClose />\n        <span className={cn(styles.userName)}>Remove Assignee</span>\n      </MentionItem>\n    );\n  }\n  if (item === INVITE_USER) {\n    return (\n      <MentionItem {...props} key={INVITE_USER}>\n        <AddAssigneeIcon className={cn(styles.inviteIcon)} />\n        <span>Invite to workspace</span>\n      </MentionItem>\n    );\n  }\n\n  return (\n    <MentionItem {...props} key={item.key}>\n      <Avatar user={item} size=\"big\" />\n      <UserSpan userManager={item} />\n    </MentionItem>\n  );\n};\n\nconst renderItem = ({\n  item,\n  ...props\n}: {\n  item: VertexManager<User> | ACTION_ITEM;\n}) => {\n  return <RenderedItem item={item} {...props} />;\n};\n\nfunction UserSpan({ userManager }: { userManager: VertexManager<User> }) {\n  const styles = useStyles();\n  const user = usePartialVertex(userManager, ['name']);\n  return <span className={cn(styles.userName)}>{user.name}</span>;\n}\n\nexport type RenderAssignee = (props: {\n  isOpen: boolean;\n  user: VertexManager<User>;\n  size: 'big' | 'small';\n}) => JSX.Element;\n\ninterface AssigneeProps {\n  user: VertexManager<User>;\n  cardManager: VertexManager<Note>;\n  users: VertexManager<User>[];\n  assignees: VertexManager<User>[];\n  className?: string;\n  source: UISource;\n  renderSelected?: RenderAssignee;\n  onInviteUserSelected: () => void;\n  size?: 'big' | 'small';\n  style?: {};\n}\n\nfunction DefaultAvatar({\n  user,\n  size,\n}: {\n  isOpen: boolean;\n  user: VertexManager<User>;\n  size: 'big' | 'small';\n}) {\n  const styles = useStyles();\n  return <Avatar user={user} size={size} className={cn(styles.assignee)} />;\n}\nconst DEFAULT_RENDER: RenderAssignee = ({ isOpen, user, size }) => {\n  return <DefaultAvatar user={user} isOpen={isOpen} size={size} />;\n};\n\nexport function Assignee({\n  user,\n  cardManager,\n  users,\n  source,\n  assignees,\n  className,\n  renderSelected = DEFAULT_RENDER,\n  onInviteUserSelected,\n  size = 'big',\n  style = {},\n}: AssigneeProps) {\n  const styles = useStyles();\n  const logger = useLogger();\n  const getItems = useCallback(() => {\n    return users\n      .filter(\n        (u) =>\n          u.key !== user.key &&\n          assignees.find((a) => a.key === u.key) === undefined\n      )\n      .map(\n        (u) =>\n          ({\n            value: u,\n            sortValue: u.getVertexProxy().name,\n          } as { value: VertexManager<User> | ACTION_ITEM; sortValue: string })\n      )\n      .concat([\n        {\n          value: REMOVE_ASSIGNEE,\n          sortValue: SORT_VALUES.TOP,\n        },\n        {\n          value: INVITE_USER,\n          sortValue: SORT_VALUES.BOTTOM,\n        },\n      ]);\n  }, [users, assignees, user]);\n\n  const onSelected = (value: VertexManager<User> | ACTION_ITEM) => {\n    if (value === INVITE_USER) {\n      onInviteUserSelected();\n      return;\n    }\n\n    const card = cardManager.getVertexProxy();\n    const current = user.getVertexProxy();\n\n    if (value === REMOVE_ASSIGNEE) {\n      card.assignees.delete(current);\n      logger.log({\n        severity: 'INFO',\n        event: 'MetadataChanged',\n        uiSource: source,\n        user: current.key,\n        vertex: card.key,\n        metadataType: 'assignee',\n      });\n      return;\n    }\n\n    if (value.key === user.key) {\n      //Same user selected\n      return;\n    }\n\n    assignNote(logger, source, card, value.getVertexProxy(), current);\n  };\n  return (\n    <SelectionButton\n      getItems={getItems}\n      className={cn(styles.selectionButton, className)}\n      renderItem={renderItem}\n      onSelected={onSelected}\n      style={style}\n    >\n      {({ isOpen }: { isOpen: boolean }) =>\n        renderSelected({ isOpen, user, size })\n      }\n    </SelectionButton>\n  );\n}\n\ninterface AssignButtonProps {\n  cardManager: VertexManager<Note>;\n  users: VertexManager<User>[];\n  assignees: VertexManager<User>[];\n  className?: string;\n  source: UISource;\n  onInviteUserSelected: () => void;\n  style?: {};\n}\nexport function AssignButton({\n  cardManager,\n  className,\n  users,\n  assignees,\n  source,\n  onInviteUserSelected,\n  style = {},\n}: AssignButtonProps) {\n  const styles = useStyles();\n  const logger = useLogger();\n\n  const getItems = useCallback(() => {\n    return users\n      .filter((u) => assignees.find((a) => a.key === u.key) === undefined)\n      .map(\n        (u) =>\n          ({\n            value: u,\n            sortValue: u.getVertexProxy().name,\n          } as { value: VertexManager<User> | ACTION_ITEM; sortValue: string })\n      )\n      .concat([\n        {\n          value: INVITE_USER,\n          sortValue: SORT_VALUES.BOTTOM,\n        },\n      ]);\n  }, [users, assignees]);\n\n  const onSelected = (selected: VertexManager<User> | ACTION_ITEM) => {\n    if (selected === REMOVE_ASSIGNEE) {\n      return;\n    }\n\n    if (selected === INVITE_USER) {\n      onInviteUserSelected();\n      return;\n    }\n    const card = cardManager.getVertexProxy();\n    const user = selected.getVertexProxy();\n\n    assignNote(logger, source, card, user);\n  };\n  return (\n    <SelectionButton\n      getItems={getItems}\n      renderItem={renderItem}\n      onSelected={onSelected}\n      className={cn(styles.selectionButton, styles.addButton, className)}\n      style={style}\n    >\n      {() => <IconPlus />}\n    </SelectionButton>\n  );\n}\n\ninterface AssigneesProps {\n  cardManager: VertexManager<Note>;\n  className?: string;\n  assignClassName?: string;\n  cardType: 'small' | 'regular';\n  reverse?: boolean;\n  source: UISource;\n  renderAssignee?: RenderAssignee;\n  isExpanded?: boolean;\n}\n\nfunction calcStyle(isExpanded: boolean, reverse: boolean, index: number) {\n  return isExpanded\n    ? { transform: 'translateX(0)' }\n    : {\n        transform: `translateX(${\n          styleguide.gridbase * 1.25 * index * (reverse ? -1 : 1)\n        }px)`,\n      };\n}\n\nexport default function AssigneesView({\n  cardManager,\n  className,\n  assignClassName,\n  cardType,\n  reverse = false,\n  source,\n  renderAssignee,\n  isExpanded = true,\n}: AssigneesProps) {\n  const styles = useStyles();\n  const logger = useLogger();\n  const [isInviteOpen, setIsInviteOpen] = useState(false);\n\n  const partialCard = usePartialVertex(cardManager, ['workspace', 'assignees']);\n\n  const workspaceManager = partialCard.workspace\n    .manager as VertexManager<Workspace>;\n  const workspaces = useMemo(() => [workspaceManager], [workspaceManager]);\n  const users = Array.from(cardManager.getVertexProxy().workspace.users).map(\n    (u) => u.manager as VertexManager<User>\n  );\n  const assignees = Array.from(partialCard.assignees).map(\n    (u) => u.manager as VertexManager<User>\n  );\n  // .map(x => users.vertexManagers.find(u => u.key === x.key))\n  // .filter(x => x && !x.getVertexProxy().isDeleted);\n\n  const onInviteUserSelected = () => {\n    setIsInviteOpen(true);\n  };\n\n  const onUsersInvited = (users: VertexManager<User>[]) => {\n    for (const user of users) {\n      assignNote(\n        logger,\n        source,\n        cardManager.getVertexProxy(),\n        user.getVertexProxy()\n      );\n    }\n  };\n  // const size = cardType === 'regular' ? 'big' : 'small';\n  const size = 'small';\n  const assignStyle = calcStyle(isExpanded, reverse, assignees.length);\n  return (\n    <div\n      className={cn(\n        styles.list,\n        className,\n        styles[cardType],\n        reverse ? styles.reverse : styles.standard\n      )}\n    >\n      {assignees.map((user, index) => {\n        const style = calcStyle(isExpanded, reverse, index);\n        return (\n          <Assignee\n            source={source}\n            key={user.key}\n            cardManager={cardManager}\n            users={users}\n            assignees={assignees}\n            user={user}\n            onInviteUserSelected={onInviteUserSelected}\n            size={size}\n            style={style}\n            renderSelected={renderAssignee}\n          />\n        );\n      })}\n      <AssignButton\n        source={source}\n        cardManager={cardManager}\n        users={users}\n        assignees={assignees}\n        className={cn(\n          styles.addButton,\n          !isExpanded && styles.hide,\n          assignClassName\n        )}\n        onInviteUserSelected={onInviteUserSelected}\n        style={assignStyle}\n      />\n    </div>\n  );\n}\n", "import { useState } from 'https://esm.sh/react@18.2.0';\n\nconst PLACEHOLDERS = [\n  'Buy beer for the office \uD83C\uDF7A @Someone #party',\n  'Order lunch before rush hour @Someone #food #high-priority',\n  'Get a coffee, you need it! @Someone #important',\n  'Get doughnuts for the team @Someone',\n  'Find the secret nap room @Someone',\n  'Cover your co-workers desk with sticky notes @Someone #teamwork',\n];\n\nexport function getRandomCardPlaceholder() {\n  const rand = Math.round(Math.random() * (PLACEHOLDERS.length - 1));\n\n  return PLACEHOLDERS[rand];\n}\n\nexport function useCardPlaceholderText(): string {\n  const [placeholder] = useState(getRandomCardPlaceholder);\n\n  return placeholder;\n}\n", "import React, {\n  useCallback,\n  useContext,\n  useMemo,\n  useRef,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport { useAnimateWidth } from '../../core/react-utils/animate.ts';\nimport { styleguide } from '../../../../styles/styleguide.ts';\nimport {\n  makeStyles,\n  cn,\n  keyframes,\n} from '../../../../styles/css-objects/index.ts';\n\nconst showAnim = keyframes({\n  '0%': {\n    opacity: 0,\n  },\n  '99%': {\n    opacity: 0,\n  },\n  '100%': {\n    opacity: 1,\n  },\n});\n\nexport enum PillStyle {\n  Full = 'full',\n  Border = 'border',\n  None = 'none',\n}\n\nconst useStyles = makeStyles((theme) => ({\n  pill: {\n    direction: 'ltr',\n    height: styleguide.gridbase * 3,\n    minWidth: styleguide.gridbase * 6,\n    padding: [0, styleguide.gridbase],\n    flexShrink: 0,\n    fontSize: 12,\n    borderRadius: styleguide.gridbase * 2.5,\n    ...styleguide.transition.short,\n    transitionProperty: 'all',\n    whiteSpace: 'nowrap',\n    boxSizing: 'border-box',\n    display: 'flex',\n    alignItems: 'center',\n    flexDirection: 'row',\n    userSelect: 'none',\n  },\n  [PillStyle.Full]: {\n    backgroundColor: 'var(--pill-color)',\n    color: theme.background.text,\n  },\n  [PillStyle.Border]: {\n    border: '1px solid var(--pill-color)',\n    color: 'var(--pill-color)',\n  },\n  [PillStyle.None]: {\n    color: 'var(--pill-color)',\n    border: '1px solid transparent',\n    pillContent: {\n      margin: 0,\n    },\n  },\n  pillContent: {\n    marginLeft: styleguide.gridbase * 0.75,\n    marginRight: styleguide.gridbase / 2,\n    animation: `${showAnim} ${styleguide.transition.duration.short}ms linear backwards`,\n    userSelect: 'none',\n  },\n  pillAction: {\n    position: 'relative',\n    top: 1,\n    animation: `${showAnim} ${styleguide.transition.duration.short}ms backwards linear`,\n    cursor: 'pointer',\n    display: 'none',\n  },\n  visible: {\n    display: 'flex',\n  },\n}));\n\nconst PillContext = React.createContext(false);\n\nexport interface PillActionProps extends React.PropsWithChildren {\n  className?: string;\n}\n\nexport const PillAction: React.FC<PillActionProps> = ({\n  children,\n  className,\n}) => {\n  const styles = useStyles();\n  const visible = useContext(PillContext);\n\n  return (\n    <div\n      className={cn(styles.pillAction, className, visible && styles.visible)}\n    >\n      {children}\n    </div>\n  );\n};\n\nexport interface PillContentProps extends React.PropsWithChildren {\n  className?: string;\n}\n\nexport const PillContent: React.FC<PillContentProps> = ({\n  children,\n  className,\n}) => {\n  const styles = useStyles();\n  return <div className={cn(styles.pillContent, className)}>{children}</div>;\n};\n\nexport interface PillProps extends React.PropsWithChildren {\n  className?: string;\n  extended?: boolean;\n  color?: string;\n  pillStyle?: PillStyle;\n}\n\nexport const Pill: React.FC<PillProps> = ({\n  children,\n  className,\n  extended,\n  color,\n  pillStyle = PillStyle.Full,\n}) => {\n  const styles = useStyles();\n  const [isHover, setIsHover] = useState(false);\n  const ref = useRef(null);\n  const showAction = typeof extended === 'undefined' ? isHover : extended;\n  const { width } = useAnimateWidth(ref, showAction);\n  const style = useMemo(\n    () => ({\n      width,\n      '--pill-color': color,\n    }),\n    [width, color]\n  );\n\n  const onMouseEnter = useCallback(() => {\n    setIsHover(true);\n  }, []);\n\n  const onMouseLeave = useCallback(() => {\n    setIsHover(false);\n  }, []);\n\n  return (\n    <PillContext.Provider value={showAction}>\n      <div\n        ref={ref}\n        className={cn(styles.pill, className, styles[pillStyle])}\n        style={style}\n        onMouseEnter={onMouseEnter}\n        onMouseLeave={onMouseLeave}\n      >\n        {children}\n      </div>\n    </PillContext.Provider>\n  );\n};\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { VertexManager } from '../../../../cfds/client/graph/vertex-manager.ts';\nimport { Note, Tag } from '../../../../cfds/client/graph/vertices/index.ts';\nimport { suggestResults } from '../../../../cfds/client/suggestions.ts';\nimport { layout, styleguide } from '../../../../styles/index.ts';\nimport { IconCreateNew } from '../../../../styles/components/icons/index.ts';\nimport Menu from '../../../../styles/components/menu.tsx';\nimport { IconPlus } from '../../../../styles/components/new-icons/icon-plus.tsx';\nimport { IconSize } from '../../../../styles/components/new-icons/types.ts';\nimport { cn, makeStyles } from '../../../../styles/css-objects/index.ts';\nimport { useTheme } from '../../../../styles/theme.tsx';\nimport { useSharedQuery } from '../../core/cfds/react/query.ts';\nimport {\n  MentionItem,\n  MentionPopup,\n  MentionPopupRenderItem,\n} from '../../shared/card/mention.tsx';\nimport { VertexId } from '../../../../cfds/client/graph/vertex.ts';\nimport { useGraphManager } from '../../core/cfds/react/graph.tsx';\nimport { usePartialVertex } from '../../core/cfds/react/vertex.ts';\nimport { unionIter } from '../../../../base/common.ts';\n\nconst useStyles = makeStyles((theme) => ({\n  list: {\n    basedOn: [layout.row],\n    height: styleguide.gridbase * 3,\n    alignItems: 'center',\n  },\n  standard: {\n    flexDirection: 'row-reverse',\n    assignee: {\n      marginLeft: styleguide.gridbase,\n    },\n  },\n  reverse: {\n    flexDirection: 'row',\n    assignee: {\n      marginRight: styleguide.gridbase,\n    },\n  },\n  assignee: {},\n  regular: {\n    marginTop: styleguide.gridbase * 2,\n    marginBottom: styleguide.gridbase,\n    addButton: {\n      width: styleguide.gridbase * 3,\n      height: styleguide.gridbase * 3,\n    },\n  },\n  small: {\n    marginTop: styleguide.gridbase * 3,\n    addButton: {\n      width: styleguide.gridbase * 2.5,\n      height: styleguide.gridbase * 2.5,\n    },\n  },\n  addButton: {\n    borderRadius: '50%',\n    border: ``,\n  },\n  popup: {\n    backgroundColor: theme.background[0],\n    width: styleguide.gridbase * 32,\n    marginBottom: styleguide.gridbase * 2,\n  },\n  popupContent: {\n    backgroundColor: theme.background[0],\n    width: '100%',\n    boxSizing: 'border-box',\n    basedOn: [layout.column],\n  },\n  input: {\n    border: 'none',\n    width: '100%',\n    borderBottom: '1px solid rgba(156, 178, 205, 0.6)',\n    borderRadius: 0,\n  },\n  circleContainer: {\n    height: styleguide.gridbase * 4,\n    width: styleguide.gridbase * 4,\n    basedOn: [layout.column, layout.centerCenter],\n  },\n  circle: {\n    height: styleguide.gridbase,\n    width: styleguide.gridbase,\n    borderRadius: '50%',\n  },\n  tagName: {\n    flexGrow: 1,\n    whiteSpace: 'nowrap',\n    marginLeft: styleguide.gridbase,\n    color: theme.background.text,\n  },\n  tagColor: {\n    height: styleguide.gridbase * 3,\n    width: styleguide.gridbase * 3,\n    circle: {\n      height: styleguide.gridbase,\n      width: styleguide.gridbase,\n      borderRadius: '50%',\n    },\n    basedOn: [layout.column, layout.centerCenter],\n  },\n}));\n\nconst TAG_NOT_FOUND = 'tag-not-found';\n\ninterface AssignActionPopupProps {\n  close?: any;\n  noteId: VertexId<Note>;\n  onTagged: (tagItem: Tag) => void;\n}\nfunction AddTagActionPopup({\n  close,\n  onTagged,\n  noteId,\n}: AssignActionPopupProps) {\n  const styles = useStyles();\n  const theme = useTheme();\n  const graph = useGraphManager();\n  const partialNote = usePartialVertex(noteId, ['tags']);\n  const existingTags = new Set(\n    unionIter(partialNote.tags.keys(), partialNote.tags.values())\n  );\n\n  // const createTagRef = useRef<CreateTagContext>(createTag);\n  // useEffect(() => {\n  //   createTagRef.current = createTag;\n  // }, [createTag]);\n  const childTagsQuery = useSharedQuery('childTags');\n\n  // const { results: childTags } = useQuery<Tag>(\n  //   (x) => isTag(x) && !!x.name && !!x.parentTag && !!x.parentTag.name,\n  //   [workspaceManager?.key],\n  //   {\n  //     name: 'AssignActionPopup',\n  //     source: workspaceManager.graph.sharedQueriesManager.tagsQuery,\n  //   }\n  // );\n\n  const getItems = (filter: string) => {\n    if (!childTagsQuery.count) {\n      return [];\n    }\n    // const candidates: {\n    //   tag: Tag;\n    //   key: string;\n    //   title: string;\n    // }[] = [];\n\n    // childTags\n    //   .map((x) => x.getVertexProxy())\n    //   .forEach((child) => {\n    //     if (cardTagsMng.has(child.parentTag?.manager as VertexManager<Tag>)) {\n    //       return;\n    //     }\n    //     candidates.push({\n    //       tag: child,\n    //       key: child.key,\n    //       title: child.fullName,\n    //     });\n    //   });\n\n    const filteredRes: (VertexManager<Tag> | string)[] = suggestResults(\n      filter,\n      childTagsQuery.results,\n      (tag) => tag.getVertexProxy().fullName\n    );\n\n    // const filteredRes = res\n    //   .filter(t => !filter || t.dist > filter.length * 0.1)\n    //   .sort((a, b) => {\n    //     if (!filter || filter.trim() === '') {\n    //       return sortTags(a.tag, b.tag);\n    //     }\n\n    //     return b.dist - a.dist;\n    //   });\n\n    if (filteredRes.length === 0) {\n      filteredRes.push(TAG_NOT_FOUND);\n    }\n\n    return filteredRes;\n  };\n  const onSelected = (item: VertexManager<Tag> | string, filter: string) => {\n    if (item === TAG_NOT_FOUND) {\n      if (filter) {\n        if (filter.startsWith('#')) {\n          filter = filter.slice(1);\n        }\n      }\n\n      // createTagRef.current.requestCreateTag({\n      //   workspaceManager,\n      //   initialName: filter,\n      //   logSource: 'card-header',\n      //   onTagCreated: (tag) => {\n      //     onTagged(tag);\n      //   },\n      // });\n    } else {\n      onTagged((item as VertexManager<Tag>).getVertexProxy());\n    }\n  };\n  const renderItem: MentionPopupRenderItem<VertexManager<Tag> | string> = (\n    item,\n    props\n  ) => {\n    if (item === TAG_NOT_FOUND) {\n      return (\n        <MentionItem {...props} key={item}>\n          <span className={cn(styles.tagColor)}>\n            <IconCreateNew fill={theme.primary[500]} />\n          </span>\n          <span className={cn(styles.tagName)}>Create tag</span>\n        </MentionItem>\n      );\n    }\n\n    return (\n      <MentionItem {...props} key={(item as VertexManager).key}>\n        <div className={cn(styles.circleContainer)}>\n          <div\n            className={cn(styles.circle)}\n            // style={{\n            //   backgroundColor: item.color,\n            // }}\n          />\n        </div>\n        <span className={cn(styles.tagName)}>\n          {(item as VertexManager<Tag>).getVertexProxy().fullName}\n        </span>\n      </MentionItem>\n    );\n  };\n\n  return (\n    <MentionPopup\n      getItems={getItems}\n      trigger=\"#\"\n      onSelected={onSelected}\n      renderItem={renderItem}\n    />\n  );\n}\n\ninterface TagButtonProps {\n  noteId: VertexId<Note>;\n  className?: string;\n  onTagged: (tagItem: Tag) => void;\n  isSmall?: boolean;\n}\nexport default function TagButton({\n  noteId,\n  className,\n  onTagged,\n  isSmall = true,\n}: TagButtonProps) {\n  const styles = useStyles();\n\n  return (\n    <Menu\n      renderButton={() => (\n        <IconPlus size={isSmall ? IconSize.Small : IconSize.Medium} />\n      )}\n      position=\"top\"\n      align=\"center\"\n      direction=\"in\"\n      className={className}\n      popupClassName={cn(styles.popup)}\n    >\n      <AddTagActionPopup noteId={noteId} onTagged={onTagged} />\n    </Menu>\n  );\n}\n", "import React, { useCallback, useRef } from 'https://esm.sh/react@18.2.0';\nimport { VertexManager } from '../../../../cfds/client/graph/vertex-manager.ts';\nimport { Tag } from '../../../../cfds/client/graph/vertices/index.ts';\nimport { layout, styleguide } from '../../../../styles/index.ts';\nimport {\n  IconClose,\n  IconDropDownArrow,\n} from '../../../../styles/components/icons/index.ts';\nimport DropDown, {\n  DropDownItem,\n} from '../../../../styles/components/inputs/drop-down.tsx';\nimport { useTypographyStyles } from '../../../../styles/components/typography.tsx';\nimport {\n  cn,\n  keyframes,\n  makeStyles,\n} from '../../../../styles/css-objects/index.ts';\nimport { brandLightTheme as theme } from '../../../../styles/theme.tsx';\nimport { usePartialVertex } from '../../core/cfds/react/vertex.ts';\nimport { useAnimateWidth } from '../../core/react-utils/animate.ts';\n\nconst showAnim = keyframes({\n  '0%': {\n    opacity: 0,\n  },\n  '99%': {\n    opacity: 0,\n  },\n  '100%': {\n    opacity: 1,\n  },\n});\n\nconst useStyles = makeStyles(() => ({\n  tag: {\n    direction: 'ltr',\n    backgroundColor: theme.mono.m1,\n    height: styleguide.gridbase * 2,\n    minWidth: styleguide.gridbase * 5,\n    padding: [0, styleguide.gridbase],\n    flexShrink: 0,\n    fontSize: 12,\n    borderRadius: styleguide.gridbase,\n    ...styleguide.transition.short,\n    transitionProperty: 'all',\n    whiteSpace: 'nowrap',\n    boxSizing: 'border-box',\n    display: 'flex',\n    alignItems: 'center',\n    flexDirection: 'row',\n  },\n  tagName: {\n    marginLeft: styleguide.gridbase * 0.75,\n    marginRight: styleguide.gridbase / 2,\n    color: theme.colors.text,\n    animation: `${showAnim} ${styleguide.transition.duration.short}ms linear backwards`,\n    userSelect: 'none',\n    basedOn: [useTypographyStyles.textSmall],\n  },\n  tagDropDownName: {\n    marginLeft: styleguide.gridbase * 0.75,\n    marginRight: styleguide.gridbase / 2,\n    color: theme.colors.text,\n    animation: `${showAnim} ${styleguide.transition.duration.short}ms linear backwards`,\n    userSelect: 'none',\n    basedOn: [useTypographyStyles.text],\n  },\n  tagDelete: {\n    position: 'relative',\n    top: 1,\n    animation: `${showAnim} ${styleguide.transition.duration.short}ms backwards linear`,\n    cursor: 'pointer',\n  },\n  onHover: {\n    tagDelete: {\n      ...styleguide.transition.short,\n      transitionProperty: 'width',\n      overflow: 'hidden',\n      width: 0,\n    },\n    ':hover': {\n      tagDelete: {\n        width: styleguide.gridbase * 2,\n      },\n    },\n  },\n  hide: {\n    display: 'none',\n  },\n  circleContainer: {\n    height: styleguide.gridbase * 4,\n    width: styleguide.gridbase * 4,\n    basedOn: [layout.column, layout.centerCenter],\n  },\n  circle: {\n    height: styleguide.gridbase,\n    width: styleguide.gridbase,\n    borderRadius: '50%',\n  },\n  tagDropName: {\n    flexGrow: 1,\n    whiteSpace: 'nowrap',\n    marginLeft: styleguide.gridbase,\n    color: theme.colors.text,\n  },\n}));\n\ninterface TagPillViewProps {\n  tagMng: VertexManager<Tag>;\n  className?: string;\n  showMenu?: boolean | 'hover';\n}\n\nconst NOOP_STYLE = {};\n\nexport function TagPillView({\n  tagMng,\n  className,\n  showMenu = false,\n}: TagPillViewProps) {\n  const styles = useStyles();\n  const partialTag = usePartialVertex(tagMng, ['parentTag', 'name']);\n\n  const ref = useRef<any>();\n\n  let style = useAnimateWidth(ref, showMenu);\n  const tagName = partialTag.name;\n  const menuOnHover = showMenu === 'hover';\n  if (menuOnHover) {\n    style = NOOP_STYLE;\n  }\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        styles.tag,\n        !menuOnHover && showMenu && (styles as any).hover,\n        menuOnHover && styles.onHover,\n        className\n      )}\n      style={{\n        ...style,\n      }}\n    >\n      <div className={cn(styles.tagName)}>{tagName}</div>\n      <div className={cn(layout.flexSpacer)} />\n      <div\n        className={cn(\n          styles.tagDelete,\n          !menuOnHover && !showMenu && styles.hide\n        )}\n      >\n        <IconDropDownArrow className=\"\" />\n      </div>\n    </div>\n  );\n}\n\nexport interface PillViewProps {\n  tag: VertexManager<Tag>;\n  className?: string;\n  buttonClassName?: string;\n  onSelected: (tag: Tag) => void;\n  onDelete?: (tag: Tag) => void;\n  showMenu?: boolean | 'hover';\n  renderSelected?: (tagMng: VertexManager<Tag>) => JSX.Element;\n}\n// const renderTagItem = props => {\n//   return <TagMentionItem {...props} />;\n// };\n\nconst DELETE_TAG = 'DELETE_TAG';\n\nexport default function TagView({\n  tag,\n  className,\n  onSelected,\n  buttonClassName,\n  onDelete = () => {},\n  showMenu = false,\n  renderSelected,\n}: PillViewProps) {\n  const styles = useStyles();\n  const partialTag = usePartialVertex(tag, ['parentTag']);\n  const siblingsQuery = partialTag.parentTag?.childTagsQuery;\n  const siblings = siblingsQuery?.results || [];\n\n  const onChange = (t: Tag | typeof DELETE_TAG) => {\n    if (t === DELETE_TAG) {\n      onDelete(tag.getVertexProxy());\n    } else {\n      onSelected(t);\n    }\n  };\n  const renderButton = useCallback(() => {\n    if (renderSelected) {\n      return renderSelected(tag);\n    }\n    return (\n      <TagPillView tagMng={tag} className={className} showMenu={showMenu} />\n    );\n  }, [renderSelected, tag, className, showMenu]);\n\n  return (\n    <DropDown\n      value={tag}\n      onChange={onChange}\n      className={buttonClassName}\n      renderSelected={renderButton}\n    >\n      {siblings.map((t) => (\n        <DropDownItem value={t} key={t.key}>\n          <div className={cn(styles.circleContainer)}>\n            <div\n              className={cn(styles.circle)}\n              // style={{\n              //   backgroundColor: t.color,\n              // }}\n            />\n          </div>\n          <span className={cn(styles.tagDropDownName)}>\n            {t.getVertexProxy().name}\n          </span>\n        </DropDownItem>\n      ))}\n      <DropDownItem value={DELETE_TAG}>\n        <div className={cn(styles.circleContainer)}>\n          <IconClose className=\"\" />\n        </div>\n        <span className={cn(styles.tagDropDownName)}>Remove Tag</span>\n      </DropDownItem>\n    </DropDown>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\n\nexport function AssigneesIcon(props: { fill?: string; className?: string }) {\n  const { fill = '#706B80', className } = props;\n  return (\n    <svg\n      className={className}\n      width=\"18\"\n      height=\"18\"\n      viewBox=\"0 0 18 18\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M11.25 9C12.9075 9 14.25 7.6575 14.25 6C14.25 4.3425 12.9075 3 11.25 3C9.5925 3 8.25 4.3425 8.25 6C8.25 7.6575 9.5925 9 11.25 9ZM11.25 4.5C12.075 4.5 12.75 5.175 12.75 6C12.75 6.825 12.075 7.5 11.25 7.5C10.425 7.5 9.75 6.825 9.75 6C9.75 5.175 10.425 4.5 11.25 4.5ZM11.25 10.5C9.2475 10.5 5.25 11.505 5.25 13.5V15H17.25V13.5C17.25 11.505 13.2525 10.5 11.25 10.5ZM6.75 13.5C6.915 12.96 9.2325 12 11.25 12C13.275 12 15.6 12.9675 15.75 13.5H6.75ZM4.5 11.25V9H6.75V7.5H4.5V5.25H3V7.5H0.75V9H3V11.25H4.5Z\"\n        fill={fill}\n      />\n    </svg>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\n\nexport function TagIcon(props: { fill?: string; className?: string }) {\n  const { fill = '#706B80', className } = props;\n  return (\n    <svg\n      className={className}\n      width=\"18\"\n      height=\"18\"\n      viewBox=\"0 0 18 18\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M16.0575 8.685L9.3075 1.935C9.0375 1.665 8.6625 1.5 8.25 1.5H3C2.175 1.5 1.5 2.175 1.5 3V8.25C1.5 8.6625 1.665 9.0375 1.9425 9.315L8.6925 16.065C8.9625 16.335 9.3375 16.5 9.75 16.5C10.1625 16.5 10.5375 16.335 10.8075 16.0575L16.0575 10.8075C16.335 10.5375 16.5 10.1625 16.5 9.75C16.5 9.3375 16.3275 8.955 16.0575 8.685ZM9.75 15.0075L3 8.25V3H8.25V2.9925L15 9.7425L9.75 15.0075Z\"\n        fill={fill}\n      />\n      <path\n        d=\"M4.875 6C5.49632 6 6 5.49632 6 4.875C6 4.25368 5.49632 3.75 4.875 3.75C4.25368 3.75 3.75 4.25368 3.75 4.875C3.75 5.49632 4.25368 6 4.875 6Z\"\n        fill={fill}\n      />\n    </svg>\n  );\n}\n", "import { VertexManager } from './graph/vertex-manager.ts';\nimport { BaseVertex } from './graph/vertices/base.ts';\n\nexport interface ISortable {\n  sortStamp: string;\n}\n\nexport function sortStampCompare(a: ISortable, b: ISortable) {\n  const aSort = a.sortStamp as string;\n  const bSort = b.sortStamp as string;\n\n  if (aSort > bSort) {\n    return -1;\n  } else if (aSort < bSort) {\n    return 1;\n  }\n  return 0;\n}\n\nexport function sortMngStampCompare(\n  aMng: VertexManager<BaseVertex>,\n  bMng: VertexManager<BaseVertex>\n) {\n  const a = aMng.getVertexProxy();\n  const b = bMng.getVertexProxy();\n\n  return sortStampCompare(a, b);\n}\n", "import { uniqueId } from '../../base/common.ts';\nimport { fromTimestamp } from '../base/orderstamp.ts';\nimport { NS_NOTES } from '../base/scheme-types.ts';\nimport { CoreObject } from '../../base/core-types/index.ts';\nimport { isRefMarker, RefType } from '../richtext/model.ts';\nimport {\n  dfs,\n  isRichText,\n  isTextNode,\n  RichText,\n  TextNode,\n} from '../richtext/tree.ts';\nimport { GraphManager } from './graph/graph-manager.ts';\nimport { Note } from './graph/vertices/note.ts';\nimport { ISortable, sortStampCompare } from './sorting.ts';\n\nconst DUP_TITLE_SUFFIX = ' (copy)';\n\ninterface DuplicateCardOptions {\n  suffix?: string;\n}\n\nconst DEFAULT_DUPLICATE_OPTS: DuplicateCardOptions = {\n  suffix: DUP_TITLE_SUFFIX,\n};\n\n/**\n * Duplicates a card by 'rootKey'.\n * If the card or any of the child cards is not in a ready state (has error or loading),\n * The duplicate will fail and will return 'undefined'\n * Returns the duplicated root record state\n * @param client\n * @param rootKey The card key you want to duplicate\n */\nexport function duplicateCard(\n  graph: GraphManager,\n  rootKey: string,\n  opts: DuplicateCardOptions = {}\n): Note | undefined {\n  opts = {\n    ...DEFAULT_DUPLICATE_OPTS,\n    ...opts,\n  };\n  if (!checkRecords(graph, rootKey)) return;\n\n  const outRecords: { [s: string]: CoreObject } = {};\n  const newRootKey = deepDuplicateImpl(graph, rootKey, outRecords, undefined);\n  fixSorting(outRecords);\n  tryAppendText(outRecords[newRootKey], opts.suffix);\n\n  for (const [key, data] of Object.entries(outRecords)) {\n    graph.createVertex(NS_NOTES, data, key);\n  }\n  return graph.getVertex<Note>(newRootKey);\n}\n\n/**\n * Checks that all the records are not with an error or loading\n * @returns true means that duplicate process can proceed\n */\nfunction checkRecords(graph: GraphManager, rootKey: string) {\n  const root = graph.getVertex<Note>(rootKey);\n\n  if (root.isNull) {\n    return false;\n  }\n\n  for (const refKey of root.getBodyRefs()) {\n    if (!checkRecords(graph, refKey)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/**\n * The main deep duplicate function. Receives a rootKey and duplicate his children.\n * @param client\n * @param rootKey The old root key\n * @param outRecords\n * @param parentNoteNewKey The New Parent Key\n */\nfunction deepDuplicateImpl(\n  graph: GraphManager,\n  rootKey: string,\n  outRecords: { [s: string]: CoreObject },\n  parentNoteNewKey?: string\n) {\n  const root = graph.getVertex<Note>(rootKey);\n\n  const newKey = uniqueId();\n\n  const newData: CoreObject = {\n    ...root.cloneData(),\n    creationDate: new Date(),\n    sortStamp: root.sortStamp,\n  };\n\n  const newBody = newData.body;\n\n  if (newBody && isRichText(newBody)) {\n    for (const [node] of dfs(newBody.root)) {\n      if (isRefMarker(node) && node.type === RefType.InternalDoc) {\n        const oldTaskKey = node.ref;\n        const newTaskKey = deepDuplicateImpl(\n          graph,\n          oldTaskKey,\n          outRecords,\n          newKey\n        );\n        node.ref = newTaskKey;\n      }\n    }\n  }\n\n  if (parentNoteNewKey) {\n    newData.parentNote = parentNoteNewKey;\n  } else if (root.parentNote) {\n    delete newData.parentNote;\n  }\n\n  outRecords[newKey] = newData;\n\n  return newKey;\n}\n\n/**\n * Goes over all duplicated cards and fixes the sortStamp.\n * sort stamp will be relative to the sorting today\n */\nfunction fixSorting(outRecords: { [s: string]: CoreObject }) {\n  const sortedRecords = Object.entries(outRecords).sort((a, b) =>\n    sortStampCompare(a[1] as unknown as ISortable, b[1] as unknown as ISortable)\n  );\n\n  const timeStamp = new Date();\n  timeStamp.setTime(timeStamp.getTime() + sortedRecords.length);\n\n  for (const [key, data] of sortedRecords) {\n    data.sortStamp = fromTimestamp(timeStamp, key);\n    timeStamp.setTime(timeStamp.getTime() - 1);\n  }\n}\n\nfunction lastTextNode(rt: RichText) {\n  let textNode: TextNode | undefined;\n  for (const [node] of dfs(rt.root)) {\n    if (isTextNode(node) && node.text.length > 0) {\n      textNode = node;\n    }\n  }\n  return textNode;\n}\n\nfunction tryAppendText(noteData: CoreObject, text: string | undefined) {\n  const title = noteData.title;\n  if (!title || !text || !isRichText(title)) {\n    return;\n  }\n  const lastNode = lastTextNode(title);\n  if (!lastNode) {\n    return;\n  }\n  lastNode.text += text;\n  noteData.title = title;\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { IconSize, IconProps } from './types.ts';\n\nexport function IconDelete({ size = IconSize.Small, className }: IconProps) {\n  return (\n    <svg\n      className={className}\n      width={size}\n      height={size}\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        opacity=\"0.7\"\n        d=\"M2.5 3V13C2.5 14.1046 3.39543 15 4.5 15H11.5C12.6046 15 13.5 14.1046 13.5 13V3\"\n        stroke=\"#3F3F3F\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M6 3V2C6 1.44772 6.44772 1 7 1H9C9.55228 1 10 1.44772 10 2V3\"\n        stroke=\"#4D4D4D\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <line\n        opacity=\"0.7\"\n        x1=\"15\"\n        y1=\"3\"\n        x2=\"1\"\n        y2=\"3\"\n        stroke=\"#4D4D4D\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <line\n        opacity=\"0.7\"\n        x1=\"6\"\n        y1=\"7\"\n        x2=\"6\"\n        y2=\"12\"\n        stroke=\"#4D4D4D\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <line\n        opacity=\"0.7\"\n        x1=\"10\"\n        y1=\"7\"\n        x2=\"10\"\n        y2=\"12\"\n        stroke=\"#4D4D4D\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n    </svg>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { IconProps, IconSize } from './types.ts';\n\nexport function IconDuplicate({ size = IconSize.Small, className }: IconProps) {\n  return (\n    <svg\n      className={className}\n      width={size}\n      height={size}\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        opacity=\"0.7\"\n        d=\"M14 15H5\"\n        stroke=\"#4D4D4D\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M5 4V15\"\n        stroke=\"#3F3F3F\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M2 1V12\"\n        stroke=\"#3F3F3F\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M5 4H14\"\n        stroke=\"#3F3F3F\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M2 1H11\"\n        stroke=\"#3F3F3F\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M14 4V15\"\n        stroke=\"#4D4D4D\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <line\n        opacity=\"0.7\"\n        x1=\"11\"\n        y1=\"1\"\n        x2=\"11\"\n        y2=\"4\"\n        stroke=\"#8C8C8C\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <line\n        opacity=\"0.7\"\n        x1=\"2\"\n        y1=\"12\"\n        x2=\"5\"\n        y2=\"12\"\n        stroke=\"#8C8C8C\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n    </svg>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { brandLightTheme as theme } from '../../theme.tsx';\nimport { IconColor, IconProps, IconSize } from './types.ts';\n\nconst COLOR_MAP = {\n  [IconColor.Mono]: {\n    var1: theme.mono.m4,\n    var2: theme.mono.m3,\n    var3: theme.mono.m4,\n  },\n  [IconColor.Primary]: {\n    var1: theme.primary.p9,\n    var2: theme.primary.p8,\n    var3: theme.primary.p10,\n  },\n};\n\nexport interface IconTaskProps extends IconProps {\n  color: IconColor.Mono | IconColor.Primary;\n}\n\nexport function IconTask({\n  color = IconColor.Mono,\n  size = IconSize.Small,\n  className,\n}: IconTaskProps) {\n  const colorOpts = COLOR_MAP[color];\n\n  return (\n    <svg\n      className={className}\n      width={size}\n      height={size}\n      viewBox=\"0 0 17 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <g clipPath=\"url(#clip0_611_8550)\">\n        <path\n          opacity=\"0.7\"\n          d=\"M15 14.5H2\"\n          stroke={colorOpts.var1}\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.7\"\n          d=\"M2 1.5V14.5\"\n          stroke={colorOpts.var3}\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.7\"\n          d=\"M2 1.5H15\"\n          stroke={colorOpts.var3}\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.7\"\n          d=\"M15 1.5V14.5\"\n          stroke={colorOpts.var1}\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.6\"\n          d=\"M7.32618 10.739L11.5 5\"\n          stroke={colorOpts.var1}\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.6\"\n          d=\"M5.5 8.13037L7.32605 10.739\"\n          stroke={colorOpts.var3}\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n      </g>\n      <defs>\n        <clipPath id=\"clip0_611_8550\">\n          <rect\n            width=\"16\"\n            height=\"16\"\n            fill=\"white\"\n            transform=\"translate(0.5)\"\n          />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { brandLightTheme as theme } from '../../theme.tsx';\nimport { IconColor, IconProps, IconSize } from './types.ts';\n\nconst COLOR_MAP = {\n  [IconColor.Mono]: {\n    var1: theme.mono.m4,\n    var2: theme.mono.m3,\n    var3: theme.mono.m4,\n  },\n  [IconColor.Primary]: {\n    var1: theme.primary.p9,\n    var2: theme.primary.p8,\n    var3: theme.primary.p10,\n  },\n};\n\nexport interface IconNoteProps extends IconProps {\n  color?: IconColor.Primary | IconColor.Mono;\n}\n\nexport function IconNote({\n  color = IconColor.Mono,\n  size = IconSize.Small,\n  className,\n}: IconNoteProps) {\n  const colorOpts = COLOR_MAP[color];\n\n  return (\n    <svg\n      className={className}\n      width={size}\n      height={size}\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <g clip-path=\"url(#clip0_970_30419)\">\n        <path\n          opacity=\"0.7\"\n          d=\"M1 13V13.5C1 14.3284 1.67157 15 2.5 15V15C3.32843 15 4 14.3284 4 13.5V13\"\n          stroke={colorOpts.var1}\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.7\"\n          d=\"M1 10V13\"\n          stroke={colorOpts.var1}\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.7\"\n          d=\"M1 10H3.5\"\n          stroke={colorOpts.var1}\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.7\"\n          d=\"M15 12V13C15 14.1046 14.1046 15 13 15H12\"\n          stroke={colorOpts.var2}\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.7\"\n          d=\"M3 15H12\"\n          stroke={colorOpts.var2}\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.7\"\n          d=\"M15 1V12\"\n          stroke={colorOpts.var3}\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.7\"\n          d=\"M4 1H15\"\n          stroke={colorOpts.var3}\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.7\"\n          d=\"M4 1V13\"\n          stroke={colorOpts.var1}\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <line\n          opacity=\"0.7\"\n          x1=\"12\"\n          y1=\"5\"\n          x2=\"7\"\n          y2=\"5\"\n          stroke={colorOpts.var3}\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <line\n          opacity=\"0.7\"\n          x1=\"12\"\n          y1=\"8\"\n          x2=\"7\"\n          y2=\"8\"\n          stroke={colorOpts.var3}\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <line\n          opacity=\"0.7\"\n          x1=\"12\"\n          y1=\"11\"\n          x2=\"7\"\n          y2=\"11\"\n          stroke={colorOpts.var3}\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n      </g>\n      <defs>\n        <clipPath id=\"clip0_970_30419\">\n          <rect width=\"15.9983\" height=\"16\" fill=\"white\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { IconProps, IconSize } from './types.ts';\n\nexport function IconViewNote({ size = IconSize.Small, className }: IconProps) {\n  return (\n    <svg\n      className={className}\n      width={size}\n      height={size}\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        opacity=\"0.7\"\n        d=\"M1 13V13.5C1 14.3284 1.67157 15 2.5 15V15C3.32843 15 4 14.3284 4 13.5V13\"\n        stroke=\"#4D4D4D\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M1 10V13\"\n        stroke=\"#4D4D4D\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M1 10H3.5\"\n        stroke=\"#4D4D4D\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M15 12V13C15 14.1046 14.1046 15 13 15H12\"\n        stroke=\"#8C8C8C\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M3 15H12\"\n        stroke=\"#8C8C8C\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M15 1V12\"\n        stroke=\"#3F3F3F\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M4 1H15\"\n        stroke=\"#3F3F3F\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M4 1V13\"\n        stroke=\"#4D4D4D\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M8.82617 10.739L12.2727 6\"\n        stroke=\"#4D4D4D\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M7 8.13037L8.82605 10.739\"\n        stroke=\"#3F3F3F\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n    </svg>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { IconProps, IconSize } from './types.ts';\n\nexport function IconOpen({ size = IconSize.Small, className }: IconProps) {\n  return (\n    <svg\n      className={className}\n      width={size}\n      height={size}\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        opacity=\"0.7\"\n        d=\"M12.8999 1.5V6.65\"\n        stroke=\"#3F3F3F\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M1 1.5H12.9\"\n        stroke=\"#3F3F3F\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M1 1.5V13\"\n        stroke=\"#4D4D4D\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M4.1 13V13.15C4.1 14.006 3.40604 14.7 2.55 14.7V14.7C1.69396 14.7 1 14.006 1 13.15V13\"\n        stroke=\"#4D4D4D\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M4.1001 7.35V13\"\n        stroke=\"#4D4D4D\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.8\"\n        d=\"M15 7.35V12.5\"\n        stroke=\"#3F3F3F\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.8\"\n        d=\"M12.5 14.7H13C14.1046 14.7 15 13.8046 15 12.7V12.5\"\n        stroke=\"#8C8C8C\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M2.7998 14.7H12.4998\"\n        stroke=\"#8C8C8C\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.8\"\n        d=\"M4.1001 7.35H15.0001\"\n        stroke=\"#3F3F3F\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n    </svg>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { brandLightTheme as theme } from '../../theme.tsx';\nimport { IconProps, IconSize } from './types.ts';\n\nexport enum DueDateState {\n  None = 'none',\n  Late = 'late',\n}\n\nconst COLOR_MAP = {\n  [DueDateState.None]: {\n    var1: theme.mono.m5,\n    var2: theme.mono.m6,\n    var3: theme.mono.m4,\n  },\n  [DueDateState.Late]: {\n    var1: theme.supporting.O3,\n    var2: theme.supporting.O4,\n    var3: theme.supporting.O2,\n  },\n};\n\nexport interface IconDueDateProps extends IconProps {\n  state?: DueDateState;\n}\n\nexport function IconDueDate({\n  size = IconSize.Small,\n  className,\n  state = DueDateState.None,\n}: IconDueDateProps) {\n  const colors = COLOR_MAP[state];\n\n  return (\n    <svg\n      className={className}\n      width={size}\n      height={size}\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        opacity=\"0.6\"\n        d=\"M8 15C11.866 15 15 11.866 15 8\"\n        stroke={colors.var1}\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1\"\n        stroke={colors.var2}\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M15 8C15 4.13401 11.866 1 8 1\"\n        stroke={colors.var3}\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M8 8L10.5 10.5\"\n        stroke={colors.var3}\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M8 4.54541V7.99996\"\n        stroke={colors.var1}\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n    </svg>\n  );\n}\n", "import React, {\n  useCallback,\n  useContext,\n  useRef,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport { useNavigate } from 'https://esm.sh/react-router@6.7.0';\nimport { Path } from 'https://esm.sh/slate@0.87.0';\nimport { duplicateCard } from '../../../../../cfds/client/duplicate.ts';\nimport { VertexManager } from '../../../../../cfds/client/graph/vertex-manager.ts';\nimport {\n  Note,\n  NoteType,\n} from '../../../../../cfds/client/graph/vertices/note.ts';\nimport {\n  Button,\n  RaisedButton,\n} from '../../../../../styles/components/buttons.tsx';\nimport {\n  Dialog,\n  DialogActions,\n  DialogContent,\n} from '../../../../../styles/components/dialog/index.tsx';\nimport { IconDelete } from '../../../../../styles/components/new-icons/icon-delete.tsx';\nimport { IconDuplicate } from '../../../../../styles/components/new-icons/icon-duplicate.tsx';\nimport { IconTask } from '../../../../../styles/components/new-icons/icon-task.tsx';\nimport { IconNote } from '../../../../../styles/components/new-icons/icon-note.tsx';\nimport { IconViewNote } from '../../../../../styles/components/new-icons/icon-view-note.tsx';\nimport { IconOpen } from '../../../../../styles/components/new-icons/icon-open.tsx';\nimport { IconExportPdf } from '../../../../../styles/components/new-icons/icon-export-pdf.tsx';\nimport { IconExportMail } from '../../../../../styles/components/new-icons/icon-export-mail.tsx';\nimport { IconDueDate } from '../../../../../styles/components/new-icons/icon-due-date.tsx';\nimport { IconColor } from '../../../../../styles/components/new-icons/types.ts';\nimport { IconLink } from '../../../../../styles/components/icons/index.ts';\nimport { MenuAction } from '../../../../../styles/components/menu.tsx';\nimport { H3, Text } from '../../../../../styles/components/texts.tsx';\nimport {\n  toastContext,\n  useToastController,\n} from '../../../../../styles/components/toast/index.tsx';\nimport { useGraphManager } from '../../../core/cfds/react/graph.tsx';\nimport { useDocumentRouter } from '../../../core/react-utils/index.ts';\nimport { CardElement } from '../../../core/slate/elements/card.element/index.tsx';\nimport { OvvioEditor } from '../../../core/slate/types.ts';\nimport { ElementUtils } from '../../../core/slate/utils/element-utils.ts';\nimport { useDueDate } from '../../components/due-date-editor/index.tsx';\nimport {\n  usePartialVertex,\n  useVertex,\n} from '../../../core/cfds/react/vertex.ts';\nimport { useLogger } from '../../../core/cfds/react/logger.tsx';\nimport { UISource } from '../../../../../logging/client-events.ts';\n\ninterface CardActionProps {\n  cardManager: VertexManager<Note>;\n  source: UISource;\n}\ninterface EditItemActionProps extends CardActionProps {\n  editor?: OvvioEditor;\n}\nexport function EditCardAction({\n  cardManager,\n  source,\n  editor,\n  ...props\n}: EditItemActionProps) {\n  const logger = useLogger();\n  const docRouter = useDocumentRouter();\n\n  const openItem = () => {\n    logger.log({\n      severity: 'INFO',\n      event: 'Click',\n      source: 'menu:note:open',\n      destination: 'editor',\n      vertex: cardManager.key,\n    });\n    if (editor) {\n      editor.selection = null;\n    }\n    docRouter.goTo(cardManager);\n  };\n\n  return (\n    <MenuAction\n      {...props}\n      onClick={openItem}\n      IconComponent={IconOpen}\n      text=\"Open\"\n    />\n  );\n}\n\ninterface UploadAttachmentActionProps extends CardActionProps {\n  close?: () => void;\n}\n\nexport function EditDueDateAction({\n  cardManager,\n  source,\n  ...props\n}: CardActionProps) {\n  const dueDateEditor = useDueDate();\n  const onClick = () => {\n    dueDateEditor.edit(cardManager.getVertexProxy());\n  };\n  return (\n    <MenuAction\n      {...props}\n      onClick={onClick}\n      IconComponent={IconDueDate}\n      text=\"Add Due Date\"\n    />\n  );\n}\n\nexport function ViewInNoteAction({\n  cardManager,\n  source,\n  ...props\n}: CardActionProps) {\n  const logger = useLogger();\n  const navigate = useNavigate();\n  const pCard = usePartialVertex(cardManager, ['workspace', 'parentNote']);\n\n  const openNote = useCallback(() => {\n    logger.log({\n      severity: 'INFO',\n      event: 'Click',\n      source: 'menu:note:view-in-parent',\n      vertex: pCard.key,\n    });\n    navigate(`${pCard.workspace.key}/${pCard.parentNote!.key}`);\n  }, [pCard, logger, navigate]);\n\n  if (!pCard.parentNote) {\n    return null;\n  }\n\n  return (\n    <MenuAction\n      {...props}\n      onClick={openNote}\n      IconComponent={IconViewNote}\n      text=\"View In Note\"\n    />\n  );\n}\nexport function cardHasChildren(card: Note) {\n  try {\n    for (const [child] of card.inEdges('parentNote')) {\n      if (!child.isDeleted) return true;\n    }\n  } catch (e) {}\n  return false;\n}\n\ninterface DeleteCardActionProps extends CardActionProps {\n  onDeleted?: () => void;\n}\nexport function DeleteCardAction({\n  cardManager,\n  source,\n  onDeleted = () => {},\n  ...props\n}: DeleteCardActionProps) {\n  const [open, setOpen] = useState(false);\n  const resolveRef = useRef(() => {});\n  const logger = useLogger();\n  const card = useVertex(cardManager);\n  const navigate = useNavigate();\n\n  const onOpen = useCallback(() => {\n    setOpen(true);\n    logger.log({\n      severity: 'INFO',\n      event: 'Start',\n      flow: 'delete',\n      vertex: card.key,\n      source: source || 'menu:note:delete',\n    });\n    return new Promise<void>((resolve) => {\n      resolveRef.current = () => {\n        resolve();\n        resolveRef.current = () => {};\n      };\n    });\n  }, [setOpen, logger, card, source]);\n\n  const closeDialog = useCallback(\n    (isCancelled: boolean) => {\n      setOpen(false);\n      resolveRef.current();\n      if (isCancelled) {\n        logger.log({\n          severity: 'INFO',\n          event: 'Cancel',\n          flow: 'delete',\n          vertex: card.key,\n          source: source || 'menu:note:delete',\n        });\n      }\n    },\n    [setOpen, logger, card, source]\n  );\n\n  const onDeleteClick = useCallback(() => {\n    card.isDeleted = 1;\n    logger.log({\n      severity: 'INFO',\n      event: 'End',\n      flow: 'delete',\n      vertex: card.key,\n      source: source || 'menu:note:delete',\n    });\n    closeDialog(false);\n    onDeleted && onDeleted();\n    navigate('/');\n    // if (source === 'title' || source === 'editor:title') {\n    //   const prevState = history.getRouteInformation(1);\n    //   if (prevState === undefined || prevState === null) {\n    //     history.replace(LOGIN);\n    //   } else {\n    //     history.pop();\n    //   }\n    // }\n  }, [card, logger, closeDialog, onDeleted, source, navigate]);\n  const hasChildren = cardHasChildren(card);\n  const msg = hasChildren\n    ? 'Deleting this item is permanent and will include the data it contains; including text and items'\n    : 'Deleting this item is permanent';\n  const deleteText = hasChildren ? 'Delete Items' : 'Delete';\n  return (\n    <React.Fragment>\n      <MenuAction\n        {...props}\n        onClick={onOpen}\n        IconComponent={IconDelete}\n        text=\"Delete\"\n      />\n      <Dialog\n        open={open}\n        onClickOutside={() => closeDialog(true)}\n        onClose={() => closeDialog(true)}\n      >\n        <DialogContent>\n          <H3>Are you sure?</H3>\n          <Text>{msg}</Text>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => closeDialog(true)}>Cancel</Button>\n          <RaisedButton onClick={onDeleteClick}>{deleteText}</RaisedButton>\n        </DialogActions>\n      </Dialog>\n    </React.Fragment>\n  );\n}\n\ninterface DuplicateCardActionProps extends CardActionProps {\n  editorRootKey?: string;\n  source: UISource;\n  editor?: OvvioEditor;\n}\nexport function DuplicateCardAction({\n  editorRootKey,\n  cardManager,\n  source,\n  editor,\n  ...props\n}: DuplicateCardActionProps) {\n  const graph = useGraphManager();\n  const logger = useLogger();\n  const navigate = useNavigate();\n\n  const onDuplicate = () => {\n    const newCard = duplicateCard(graph, cardManager.key)!;\n    logger.log({\n      severity: 'INFO',\n      event: 'Duplicate',\n      vertex: cardManager.key,\n      target: newCard?.key,\n      source,\n    });\n\n    if (!editor || editorRootKey === cardManager.key) {\n      navigate(`${newCard?.workspace.key}/${newCard?.key}`);\n      return;\n    }\n    const cardEntry = ElementUtils.findNode(\n      editor,\n      (n) => CardElement.isCard(n) && n.ref === cardManager.key\n    );\n    if (!cardEntry) {\n      return;\n    }\n    const [, path] = cardEntry;\n    CardElement.insertNote(editor, newCard, Path.next(path!));\n  };\n\n  return (\n    <MenuAction\n      {...props}\n      onClick={onDuplicate}\n      IconComponent={IconDuplicate}\n      text=\"Duplicate\"\n    />\n  );\n}\n\nexport function ConvertNoteAction({ cardManager, source }: CardActionProps) {\n  const logger = useLogger();\n  const toastController = useToastController();\n  const { type } = usePartialVertex(cardManager, ['type']);\n  const text = type === NoteType.Note ? 'Convert To Task' : 'Convert To Note';\n  const onClick = () => {\n    const p = cardManager.getVertexProxy();\n    const newType = type === NoteType.Note ? NoteType.Task : NoteType.Note;\n    p.type = newType;\n    logger.log({\n      severity: 'INFO',\n      event: 'MetadataChanged',\n      source: 'menu:note:convert',\n      vertex: cardManager.key,\n    });\n\n    toastController.displayToast({\n      text: `${type} converted to ${newType}`,\n      action: {\n        text: 'Undo',\n        fn: (dismiss) => {\n          cardManager.getVertexProxy().type = type;\n          dismiss();\n        },\n      },\n      duration: 3000,\n    });\n  };\n  return (\n    <MenuAction\n      IconComponent={type === NoteType.Note ? IconTask : IconNote}\n      text={text}\n      onClick={onClick}\n      color={IconColor.Mono}\n    />\n  );\n}\n\n// export function CopyUrlAction({\n//   cardManager,\n//   source,\n//   ...props\n// }: CardActionProps) {\n//   const history = useHistoryStatic();\n//   const eventLogger = useEventLogger();\n//   const toastController = useToastController();\n\n//   return (\n//     <MenuAction\n//       {...props}\n//       IconComponent={IconLink}\n//       iconHeight=\"25\"\n//       iconWidth=\"20\"\n//       onClick={() => {\n//         const currentRoute = history.currentRoute;\n//         const cardUrl = path.join(config.origin, currentRoute.url);\n\n//         navigator.clipboard.writeText(cardUrl);\n\n//         eventLogger.cardAction('CARD_URL_COPIED', cardManager, {\n//           category: EventCategory.MENU_ITEM,\n//           source,\n//         });\n\n//         toastController.displayToast({\n//           text: 'Link copied to clipboard',\n//           duration: 3000,\n//         });\n//       }}\n//       text=\"Copy Link\"\n//     />\n//   );\n// }\n", "import React from 'https://esm.sh/react@18.2.0';\nimport Menu from '../../../../styles/components/menu.tsx';\nimport { IconOverflow } from '../../../../styles/components/icons/index.ts';\nimport {\n  EditCardAction,\n  // UploadAttachmentAction,\n  EditDueDateAction,\n  ViewInNoteAction,\n  DeleteCardAction,\n  // ExportMailAction,\n  // ExportPdfAction,\n  DuplicateCardAction,\n  // CopyUrlAction,\n  ConvertNoteAction,\n} from './actions/index.tsx';\nimport { Note } from '../../../../cfds/client/graph/vertices/note.ts';\nimport { VertexManager } from '../../../../cfds/client/graph/vertex-manager.ts';\nimport { OvvioEditor } from '../../core/slate/types.ts';\nimport { UISource } from '../../../../logging/client-events.ts';\nimport { useLogger } from '../../core/cfds/react/logger.tsx';\nimport { usePartialVertex } from '../../core/cfds/react/vertex.ts';\n\nexport interface CardMenuViewProps {\n  cardManager: VertexManager<Note>;\n  allowsEdit?: boolean;\n  onDeleted?: () => void;\n  className?: any;\n  source: UISource;\n  editorRootKey?: string;\n  direction?: 'in' | 'out';\n  position?: 'top' | 'bottom' | 'left' | 'right';\n  editor?: OvvioEditor;\n}\n\nexport default function CardMenuView({\n  cardManager,\n  allowsEdit,\n  onDeleted,\n  className,\n  source,\n  editorRootKey,\n  direction,\n  position,\n  editor,\n}: CardMenuViewProps) {\n  const logger = useLogger();\n  const partialNote = usePartialVertex(cardManager, ['parentNote']);\n  if (!cardManager) {\n    return null;\n  }\n\n  return (\n    <Menu\n      renderButton={() => <IconOverflow />}\n      align=\"end\"\n      direction={direction}\n      position={position}\n      className={className}\n    >\n      {allowsEdit && (\n        <EditCardAction\n          cardManager={cardManager}\n          source={source}\n          editor={editor}\n        />\n      )}\n      <EditDueDateAction cardManager={cardManager} source={source} />\n\n      {/* <UploadAttachmentAction cardManager={cardManager} source={source} /> */}\n      {partialNote.parentNote && (\n        <ViewInNoteAction cardManager={cardManager} source={source} />\n      )}\n      <DuplicateCardAction\n        cardManager={cardManager}\n        source={source}\n        editorRootKey={editorRootKey}\n        editor={editor}\n      />\n      {/* <ExportMailAction cardManager={cardManager} source={source} />\n      <ExportPdfAction cardManager={cardManager} source={source} /> */}\n      <ConvertNoteAction cardManager={cardManager} source={source} />\n      <DeleteCardAction\n        cardManager={cardManager}\n        source={source}\n        onDeleted={onDeleted}\n      />\n      {/* <CopyUrlAction cardManager={cardManager} source={source} /> */}\n    </Menu>\n  );\n}\n", "import React, { useCallback } from 'https://esm.sh/react@18.2.0';\nimport { useSlateStatic } from 'https://esm.sh/slate-react@0.87.1';\nimport { VertexManager } from '../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport { Note } from '../../../../../../../cfds/client/graph/vertices/note.ts';\nimport { useDueDate } from '../../../../../shared/components/due-date-editor/index.tsx';\nimport { usePartialVertex } from '../../../../cfds/react/vertex.ts';\nimport CardMenuView from '../../../../../shared/item-menu/index.tsx';\nimport { formatTimeDiff } from '../../../../../../../styles/utils/dateutils.ts';\nimport { layout, styleguide } from '../../../../../../../styles/index.ts';\nimport { IconButton } from '../../../../../../../styles/components/buttons.tsx';\nimport { IconCalendar } from '../../../../../../../styles/components/icons/index.ts';\nimport { Tooltip } from '../../../../../../../styles/components/tooltip/index.tsx';\nimport {\n  makeStyles,\n  cn,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { useLogger } from '../../../../cfds/react/logger.tsx';\n\nconst useStyles = makeStyles((theme) => ({\n  actionsContainer: {\n    height: styleguide.gridbase * 4,\n    alignItems: 'center',\n    basedOn: [layout.row],\n  },\n  uploading: {\n    color: theme.background.placeholderText,\n  },\n}));\n\nexport interface CardActionsProps {\n  editorRootKey: string;\n  card: VertexManager<Note>;\n  className?: string;\n}\n\nexport function CardActions({\n  editorRootKey,\n  card,\n  className,\n}: CardActionsProps) {\n  const styles = useStyles();\n  const editor = useSlateStatic();\n  return (\n    <div\n      contentEditable={false}\n      className={cn(styles.actionsContainer, className)}\n    >\n      <DueDateIndicator card={card} />\n      <CardMenuView\n        cardManager={card}\n        source={'editor:body:inline-task'}\n        editorRootKey={editorRootKey}\n        allowsEdit={true}\n        editor={editor}\n      />\n    </div>\n  );\n}\n\nfunction DueDateIndicator({ card }: { card: VertexManager<Note> }) {\n  const { dueDate } = usePartialVertex(card, ['dueDate']);\n  const dueDateEditor = useDueDate();\n  const logger = useLogger();\n\n  if (!dueDate) {\n    return null;\n  }\n\n  const onClick = () => {\n    logger.log({\n      severity: 'INFO',\n      event: 'Start',\n      flow: 'edit',\n      type: 'due',\n      source: 'editor:body:inline-task',\n      vertex: card.key,\n    });\n    dueDateEditor.edit(card.getVertexProxy());\n  };\n\n  const isOverdue = dueDate < new Date();\n\n  return (\n    <Tooltip text={`Due by ${formatTimeDiff(dueDate)}`}>\n      <IconButton onClick={onClick}>\n        <IconCalendar fill={isOverdue ? '#fe4a62' : '#9cb2cd'} />\n      </IconButton>\n    </Tooltip>\n  );\n}\n", "import React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport { Node } from 'https://esm.sh/slate@0.87.0';\nimport {\n  ReactEditor,\n  RenderElementProps,\n  useFocused,\n  useSelected,\n  useSlateStatic,\n} from 'https://esm.sh/slate-react@0.87.1';\nimport { Vertex } from '../../../../../../../cfds/client/graph/vertex.ts';\nimport { VertexManager } from '../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport {\n  Note,\n  Tag,\n  User,\n  Workspace,\n} from '../../../../../../../cfds/client/graph/vertices/index.ts';\nimport { layout, styleguide } from '../../../../../../../styles/index.ts';\nimport { getColorForUserId } from '../../../../../../../styles/colors.ts';\nimport { IconDropDownArrow } from '../../../../../../../styles/components/icons/index.ts';\nimport { CheckBox } from '../../../../../../../styles/components/inputs/index.ts';\nimport { Text } from '../../../../../../../styles/components/texts.tsx';\nimport {\n  cn,\n  keyframes,\n  makeStyles,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport {\n  useTheme,\n  brandLightTheme,\n} from '../../../../../../../styles/theme.tsx';\nimport { useGraphManager } from '../../../../cfds/react/graph.tsx';\nimport { usePartialVertex } from '../../../../cfds/react/vertex.ts';\nimport {\n  useAnimateHeight,\n  useAnimateWidth,\n} from '../../../../react-utils/animate.ts';\nimport { ElementUtils } from '../../../utils/element-utils.ts';\nimport { SelectionUtils } from '../../../utils/selection-utils.ts';\nimport AssigneesView, {\n  Assignee,\n  RenderAssignee,\n} from '../../../../../shared/card/assignees-view.tsx';\nimport { useCardPlaceholderText } from '../../../../../shared/card/placeholder.ts';\nimport {\n  Pill,\n  PillAction,\n  PillContent,\n  PillStyle,\n} from '../../../../../shared/pill/index.tsx';\nimport TagButton from '../../../../../shared/tags/tag-button.tsx';\nimport {\n  default as TagPillView,\n  default as TagView,\n} from '../../../../../shared/tags/tag-view.tsx';\nimport {\n  CardElement,\n  EditableCardContext,\n  LoadingCardElement,\n  useCurrentCard,\n} from '../index.tsx';\nimport { AssigneesIcon } from '../assignees-icon.tsx';\nimport { TagIcon } from '../tag-icon.tsx';\nimport { CardActions } from './card-actions.tsx';\nimport { NoteType } from '../../../../../../../cfds/client/graph/vertices/note.ts';\n\nconst animName = keyframes({\n  from: {\n    backgroundPosition: [styleguide.gridbase * -14, 0],\n  },\n  to: {\n    backgroundPosition: [styleguide.gridbase * 14, 0],\n  },\n});\n\nconst useStyles = makeStyles((theme, resolveClass) => ({\n  root: {\n    margin: [styleguide.gridbase, 0],\n    [`& + ${resolveClass!('root')}`]: {\n      marginBottom: 0,\n    },\n  },\n  card: {\n    borderBottom: `1px solid ${theme.background.placeholderText}`,\n    boxSizing: 'border-box',\n    ...styleguide.transition.short,\n    transitionProperty: 'height, color',\n    basedOn: [layout.column],\n    ':hover': {\n      actionsContainer: {\n        opacity: 1,\n      },\n    },\n  },\n  skeleton: {\n    animationDuration: '1s',\n    animationFillMode: 'forwards',\n    animationIterationCount: 'infinite',\n    animationName: animName,\n    animationTimingFunction: 'linear',\n    backgroundColor: theme.background[300],\n    background:\n      'linear-gradient(to left, #f0f3f7 8%, #ced8e5 18%, #f0f3f7 33%)',\n    backgroundSize: ['100%', '100%'],\n  },\n  cardDone: {\n    color: theme.background.placeholderText,\n  },\n  noteLine: {\n    position: 'relative',\n    height: styleguide.gridbase * 4,\n    flexShrink: 0,\n    flexGrow: 0,\n    flexBasis: styleguide.gridbase * 4,\n    alignItems: 'center',\n    basedOn: [layout.row],\n  },\n  actionsContainer: {\n    position: 'absolute',\n    top: 0,\n    right: styleguide.gridbase * 0.5,\n    opacity: 0,\n    ...styleguide.transition.short,\n    transitionProperty: 'opacity',\n  },\n  selected: {\n    backgroundColor: theme.background[100],\n  },\n  checkbox: {\n    userSelect: 'none',\n    marginRight: styleguide.gridbase,\n  },\n  inlineMetadata: {\n    userSelect: 'none',\n    marginLeft: styleguide.gridbase,\n    basedOn: [layout.row],\n  },\n  tagButton: {\n    userSelect: 'none',\n    marginLeft: styleguide.gridbase * 0.5,\n    padding: 0,\n  },\n  inlineTag: {\n    height: styleguide.gridbase * 3,\n    boxSizing: 'border-box',\n    border: '1px solid transparent',\n    padding: [0, styleguide.gridbase * 0.5],\n    borderRadius: styleguide.gridbase * 1.5,\n    alignItems: 'center',\n    whiteSpace: 'nowrap',\n    ...styleguide.transition.short,\n    transitionProperty: 'width border-color',\n    basedOn: [layout.row],\n  },\n  cardText: {\n    minWidth: 2,\n  },\n  inlineTagArrow: {\n    marginLeft: styleguide.gridbase * 0.5,\n  },\n  hideArrow: {\n    display: 'none',\n  },\n  extendedMetadata: {\n    paddingLeft: styleguide.gridbase * 4,\n    overflow: 'hidden',\n    userSelect: 'none',\n    basedOn: [layout.column],\n  },\n  tag: {\n    userSelect: 'none',\n    margin: [0, styleguide.gridbase * 0.5],\n  },\n  metadataRow: {\n    height: styleguide.gridbase * 3,\n    alignItems: 'center',\n    marginBottom: styleguide.gridbase,\n    basedOn: [layout.row],\n  },\n  assigneesIcon: {\n    marginRight: styleguide.gridbase * 0.5,\n  },\n  strikethroughAnchor: {\n    position: 'relative',\n    basedOn: [layout.row],\n  },\n  strikethrough: {\n    position: 'absolute',\n    height: 1,\n    backgroundColor: theme.background.placeholderText,\n    width: '100%',\n    left: 0,\n    top: '50%',\n    transform: 'scale(0)',\n    transformOrigin: 'left center',\n    ...styleguide.transition.standard,\n    transitionProperty: 'transform',\n  },\n  cardPlaceholder: {\n    position: 'relative',\n    left: -2,\n    whiteSpace: 'nowrap',\n    color: theme.background.placeholderText,\n    userSelect: 'none',\n    pointerEvents: 'none',\n    // position: 'absolute',\n    // top: '50%',\n    // left: '50%',\n    // transform: 'translate(-50%, -50%)'\n  },\n  strikeEnabled: {\n    transform: 'scale(1)',\n  },\n  hide: {\n    height: 0,\n  },\n  assigneePill: {\n    marginRight: styleguide.gridbase,\n  },\n}));\n\nexport interface CardElementProps extends RenderElementProps {\n  element: CardElement;\n}\n\nexport interface LoadingCardElementProps extends RenderElementProps {\n  element: LoadingCardElement;\n}\n\nexport function LoadingCardNode({\n  attributes,\n  children,\n}: LoadingCardElementProps) {\n  const styles = useStyles();\n  return (\n    <div {...attributes} className={cn(styles.root)}>\n      <div className={cn(styles.card)}>\n        <div className={cn(styles.noteLine, styles.skeleton)}>{children}</div>\n      </div>\n    </div>\n  );\n}\n\nfunction Placeholder({ element }: { element: CardElement }) {\n  const styles = useStyles();\n  const isEmpty = !Node.string(element);\n  const placeholder = useCardPlaceholderText();\n\n  if (!isEmpty) {\n    return null;\n  }\n\n  return (\n    <Text className={cn(styles.cardPlaceholder)} contentEditable={false}>\n      {placeholder}\n    </Text>\n  );\n}\n\nexport const CardNode = function ({\n  element,\n  attributes,\n  children,\n}: CardElementProps) {\n  const styles = useStyles();\n  const editor = useSlateStatic();\n  const rootCard = useCurrentCard();\n  const cardId = element.ref;\n  const graph = useGraphManager();\n  const cardManager = graph.getVertexManager<Note>(cardId);\n  const card = usePartialVertex(cardManager, [\n    'tags',\n    'title',\n    'workspace',\n    'type',\n  ]);\n\n  const theme = useTheme();\n  const divRef = useRef<HTMLDivElement>(null);\n  const selected = useSelected();\n  const focused = useFocused();\n  const [isExpanded, setIsExpanded] = useState(false);\n  useEffect(() => {\n    if (!ReactEditor.isFocused(editor)) {\n      return;\n    }\n    if (!selected) {\n      setIsExpanded(false);\n      return;\n    }\n    const [node, path] = SelectionUtils.extractSingleElement(editor);\n    if (!node) {\n      setIsExpanded(false);\n      return;\n    }\n    const thisNode = ElementUtils.getClosestNode(\n      editor,\n      path,\n      ((node) => CardElement.isCard(node) && node.ref === cardId) as (\n        node: Node\n      ) => node is CardElement\n    );\n    return setIsExpanded(!!thisNode);\n  }, [selected, editor, focused, cardId]);\n\n  const isActionable = card.type === NoteType.Task;\n\n  const done = card.status === 'Done';\n  const onChecked = () => {\n    card.status = card.status === 'Done' ? 'ToDo' : 'Done';\n  };\n\n  const style = useAnimateHeight(divRef, isExpanded);\n\n  return (\n    <EditableCardContext cardManager={cardManager}>\n      <div className={cn(styles.root)}>\n        <div\n          className={cn(\n            styles.card,\n            isExpanded && styles.selected,\n            done && styles.cardDone\n          )}\n          ref={divRef}\n          style={style}\n        >\n          <div className={cn(styles.noteLine)}>\n            {isActionable && (\n              <CheckBox\n                name={cardId}\n                checked={done}\n                onChange={onChecked}\n                contentEditable={false}\n                className={cn(styles.checkbox)}\n                color={theme.background[600]}\n              />\n            )}\n            <div className={cn(styles.strikethroughAnchor)}>\n              <div {...attributes} className={cn(styles.cardText)}>\n                {children}\n              </div>\n              <div\n                contentEditable={false}\n                className={cn(\n                  styles.strikethrough,\n                  done && styles.strikeEnabled\n                )}\n              />\n              <Placeholder element={element} />\n            </div>\n            {!isExpanded && <ShortCardMetadata cardManager={cardManager} />}\n            <CardActions\n              card={cardManager}\n              editorRootKey={rootCard!.key}\n              className={cn(styles.actionsContainer)}\n            />\n          </div>\n          <ExtendedCardMetadata\n            cardManager={cardManager}\n            className={cn(!isExpanded && styles.hide)}\n          />\n        </div>\n      </div>\n    </EditableCardContext>\n  );\n};\n\ntype AssignableVertexManager = VertexManager<Vertex & { name: string }>;\n\ninterface AssigneeDropDownProps {\n  assignable: AssignableVertexManager;\n  showExpanded?: boolean;\n  color: string;\n  prefix: string;\n}\n\nfunction AssigneeDropDown({\n  assignable,\n  color,\n  prefix,\n  showExpanded = false,\n}: AssigneeDropDownProps) {\n  const styles = useStyles();\n  const { name } = usePartialVertex(assignable, ['name']);\n  const ref = useRef(null);\n\n  const width = useAnimateWidth(ref, showExpanded);\n  const style = useMemo(() => {\n    const s: Record<string, any> = {\n      color,\n      ...width,\n    };\n    if (showExpanded) {\n      s.borderColor = color;\n    }\n    return s;\n  }, [color, showExpanded, width]);\n\n  return (\n    <div\n      contentEditable={false}\n      className={cn(styles.inlineTag)}\n      style={style}\n      ref={ref}\n    >\n      <Text>\n        {prefix}\n        {name}\n      </Text>\n      <IconDropDownArrow\n        className={cn(styles.inlineTagArrow, !showExpanded && styles.hideArrow)}\n        fill={color}\n      />\n    </div>\n  );\n}\n\nfunction InlineAssignee({\n  user,\n  workspaceManager,\n  cardManager,\n}: {\n  user: VertexManager<User>;\n  workspaceManager: VertexManager<Workspace>;\n  cardManager: VertexManager<Note>;\n}) {\n  const styles = useStyles();\n  const { users } = usePartialVertex(workspaceManager, ['users']);\n  const userManagers = useMemo(\n    () => Array.from(users).map((u) => u.manager as VertexManager<User>),\n    [users]\n  );\n\n  const { assignees } = usePartialVertex(cardManager, ['assignees']);\n  const assigneesManagers = useMemo(\n    () => Array.from(assignees).map((u) => u.manager as VertexManager<User>),\n    [assignees]\n  );\n\n  const [expanded, setExpanded] = useState(false);\n  const userKey = user.key;\n  const color = useMemo(() => getColorForUserId(`${userKey}`), [userKey]);\n  const renderSelected = useCallback(\n    ({ user }: { user: VertexManager<User> }) => (\n      <AssigneeDropDown\n        assignable={user}\n        showExpanded={expanded}\n        color={color}\n        prefix=\"@\"\n      />\n    ),\n    [expanded, color]\n  );\n\n  return (\n    <div\n      onMouseEnter={() => setExpanded(true)}\n      onMouseLeave={() => setExpanded(false)}\n      onClick={() => setExpanded(false)}\n    >\n      <Assignee\n        user={user}\n        users={userManagers}\n        cardManager={cardManager}\n        assignees={assigneesManagers}\n        source={'editor:title'}\n        onInviteUserSelected={() => {}}\n        renderSelected={renderSelected}\n        className={cn(styles.tagButton)}\n      />\n    </div>\n  );\n}\n\nfunction InlineTag({\n  tag,\n  cardManager,\n}: {\n  tag: VertexManager<Tag>;\n  cardManager: VertexManager<Note>;\n}) {\n  const [expanded, setExpanded] = useState(false);\n\n  const renderSelected = useCallback(\n    (tagMng: VertexManager<Tag>) => (\n      <AssigneeDropDown\n        assignable={tagMng}\n        color={brandLightTheme.mono.m1}\n        showExpanded={expanded}\n        prefix=\"#\"\n      />\n    ),\n    [expanded]\n  );\n\n  const onSelected = useCallback(\n    (t: Tag) => {\n      const note = cardManager.getVertexProxy();\n      note.tags.set(t.parentTag!, t);\n    },\n    [cardManager]\n  );\n\n  const onDelete = useCallback(\n    (t: Tag) => {\n      const note = cardManager.getVertexProxy();\n      note.tags.delete(t.parentTag!);\n    },\n    [cardManager]\n  );\n\n  return (\n    <div\n      onMouseEnter={() => setExpanded(true)}\n      onMouseLeave={() => setExpanded(false)}\n      onClick={() => setExpanded(false)}\n    >\n      <TagView\n        tag={tag}\n        onSelected={onSelected}\n        onDelete={onDelete}\n        renderSelected={renderSelected}\n      />\n    </div>\n  );\n}\n\nconst ShortCardMetadata = React.memo(function ({\n  cardManager,\n}: {\n  cardManager: VertexManager<Note>;\n}) {\n  const styles = useStyles();\n  const { workspace, tags, assignees } = usePartialVertex(cardManager, [\n    'workspace',\n    'tags',\n    'assignees',\n  ]);\n\n  return (\n    <div className={cn(styles.inlineMetadata)} contentEditable={false}>\n      {Array.from(assignees).map((user) => (\n        <InlineAssignee\n          key={user.key}\n          user={user.manager as VertexManager<User>}\n          workspaceManager={workspace.manager as VertexManager<Workspace>}\n          cardManager={cardManager}\n        />\n      ))}\n      {Array.from(tags).map(([parentTag, tag]) => (\n        <InlineTag\n          key={tag.key}\n          tag={tag.manager as VertexManager<Tag>}\n          cardManager={cardManager}\n        />\n      ))}\n    </div>\n  );\n});\n\nfunction AssigneePill({ user }: { user: VertexManager<User> }) {\n  const styles = useStyles();\n  const { name } = usePartialVertex(user, ['name']);\n  const color = getColorForUserId(user.key);\n\n  return (\n    <Pill\n      color={color}\n      pillStyle={PillStyle.Border}\n      extended={true}\n      className={cn(styles.assigneePill)}\n    >\n      <PillContent>{name}</PillContent>\n      <PillAction>\n        <IconDropDownArrow fill={color} />\n      </PillAction>\n    </Pill>\n  );\n}\n\ninterface ExtendedCardProps {\n  cardManager: VertexManager<Note>;\n  className?: string;\n}\n\nconst ExtendedCardMetadata = React.forwardRef<\n  HTMLDivElement,\n  ExtendedCardProps\n>(function ({ cardManager, className }, ref) {\n  const styles = useStyles();\n  const card = usePartialVertex(cardManager, ['tags', 'workspace']);\n\n  const wsMng = card.workspace.manager as VertexManager<Workspace>;\n\n  const tagsMng = new Map<VertexManager<Tag>, VertexManager<Tag>>();\n  for (const [p, c] of card.tags) {\n    tagsMng.set(\n      p.manager as VertexManager<Tag>,\n      c.manager as VertexManager<Tag>\n    );\n  }\n\n  const renderAssignee = useCallback<RenderAssignee>(\n    ({ user }) => <AssigneePill user={user} />,\n    []\n  );\n\n  const onTagSelected = (tag: Tag) => {\n    const currentTags = card.tags;\n    currentTags.set(tag.parentTag || tag, tag);\n    card.tags = currentTags;\n  };\n\n  const onTagDeleted = (tag: Tag) => {\n    const currentTags = card.tags;\n    currentTags.delete(tag.parentTag || tag);\n    card.tags = currentTags;\n  };\n  return (\n    <div\n      contentEditable={false}\n      ref={ref}\n      className={cn(className, styles.extendedMetadata)}\n    >\n      <div className={cn(styles.metadataRow)}>\n        <TagIcon />\n        {Array.from(card.tags).map(([_, tag]) => (\n          <TagPillView\n            buttonClassName={cn(styles.tag)}\n            key={tag.key}\n            tag={tag.manager as VertexManager<Tag>}\n            onSelected={onTagSelected}\n            onDelete={onTagDeleted}\n            showMenu={true}\n          />\n        ))}\n        <TagButton\n          noteId={card}\n          onTagged={onTagSelected}\n          className={cn(styles.tag)}\n        />\n      </div>\n      <div className={cn(styles.metadataRow)}>\n        <AssigneesIcon className={cn(styles.assigneesIcon)} />\n        <AssigneesView\n          cardManager={cardManager}\n          cardType=\"regular\"\n          source={'editor:body:inline-task'}\n          reverse={true}\n          renderAssignee={renderAssignee}\n        />\n      </div>\n    </div>\n  );\n});\n", "import { useEffect, useRef } from 'https://esm.sh/react@18.2.0';\n\nexport function useMountedIndicator() {\n  const isMountedRef = useRef(true);\n  useEffect(() => {\n    isMountedRef.current = true;\n    return () => {\n      isMountedRef.current = false;\n    };\n  }, []);\n\n  return isMountedRef;\n}\n", "import React, { useCallback } from 'https://esm.sh/react@18.2.0';\nimport { VertexManager } from '../../../../../cfds/client/graph/vertex-manager.ts';\nimport {\n  Note,\n  User,\n  Workspace,\n} from '../../../../../cfds/client/graph/vertices/index.ts';\nimport { IconCreateNew } from '../../../../../styles/components/icons/index.ts';\nimport { Text } from '../../../../../styles/components/texts.tsx';\nimport { usePartialVertex } from '../../cfds/react/vertex.ts';\nimport { useMountedIndicator } from '../../react-utils/base-utils.ts';\nimport AvatarView from '../../../shared/avatar/index.tsx';\nimport {\n  createMentionsPlugin,\n  filterSortMentions,\n  MentionOptions,\n} from './index.tsx';\nimport { useCurrentCard } from '../elements/card.element/index.tsx';\nimport { Plugin } from '../plugins/index.ts';\nimport {\n  RenderMentionPopupProps,\n  SuggestionItem,\n  SuggestionItemIcon,\n} from './mention-node.tsx';\n\n// const INVITE_USER = 'INVITE_USER';\ntype UserItem = VertexManager<User>; //| typeof INVITE_USER;\n\n// function InviteUserItem(props: {\n//   isSelected: boolean;\n//   onItemSelected: () => void;\n// }) {\n//   return (\n//     <SuggestionItem item={INVITE_USER} {...props}>\n//       <SuggestionItemIcon>\n//         <IconCreateNew />\n//       </SuggestionItemIcon>\n//       <Text>Invite</Text>\n//     </SuggestionItem>\n//   );\n// }\n\nfunction UserSuggestion({\n  item,\n  ...rest\n}: {\n  item: VertexManager<User>;\n  isSelected: boolean;\n  onItemSelected: (item: UserItem) => void;\n}) {\n  const { name } = usePartialVertex(item, ['name']);\n\n  return (\n    <SuggestionItem item={item} {...rest}>\n      <SuggestionItemIcon>\n        <AvatarView user={item} size=\"small\" />\n      </SuggestionItemIcon>\n      {name}\n    </SuggestionItem>\n  );\n}\n\nfunction UserItemComponent({\n  item,\n  ...rest\n}: {\n  item: UserItem;\n  isSelected: boolean;\n  onItemSelected: (item: UserItem) => void;\n}) {\n  // if (item === INVITE_USER) {\n  //   return <InviteUserItem {...rest} />;\n  // }\n\n  return <UserSuggestion item={item} {...rest} />;\n}\n\nfunction AssigneesSuggestionComponent({\n  filter,\n  SuggestionComponent,\n  closeMention,\n}: RenderMentionPopupProps<UserItem>) {\n  const card = useCurrentCard();\n  const partial = usePartialVertex(card as VertexManager<Note>, [\n    'assignees',\n    'workspace',\n    'workspaceKey',\n  ]);\n\n  const wsMng = partial.workspace.manager as VertexManager<Workspace>;\n  const isMounted = useMountedIndicator();\n  // const { openInvite } = useInvitations();\n  const availableAssignees = Array.from(partial.workspace.users);\n  const items = availableAssignees\n    .filter((u) => !partial.assignees.has(u))\n    .map((x) => x.manager as VertexManager<User>);\n\n  const filteredTags = filterSortMentions(\n    items,\n    filter,\n    (t) => t.getVertexProxy().name\n  ) as UserItem[]; //.concat(INVITE_USER);\n  const keyForItem = useCallback(\n    (item: UserItem) => item.key, //(item === INVITE_USER ? INVITE_USER : item.key),\n    []\n  );\n\n  const onItemSelected = (userItem: UserItem) => {\n    closeMention();\n    // if (userItem === INVITE_USER) {\n    //   (async () => {\n    //     const r = await openInvite({\n    //       workspace: wsMng,\n    //     });\n    //     if (isMounted.current && r.userInvited) {\n    //       const currentCard = card.getVertexProxy();\n    //       const { assignees } = currentCard;\n    //       r.users.forEach((u) => assignees.add(u.getVertexProxy()));\n    //       currentCard.assignees = assignees;\n    //     }\n    //   })();\n    //   return;\n    // }\n\n    const user = userItem.getVertexProxy();\n\n    const { assignees } = partial;\n    if (assignees.size === 1) {\n      assignees.clear();\n    }\n    assignees.add(user);\n    partial.assignees = assignees;\n  };\n\n  return (\n    <SuggestionComponent\n      items={filteredTags}\n      keyForItem={keyForItem}\n      onItemSelected={onItemSelected}\n      ItemSuggestionComponent={UserItemComponent}\n    />\n  );\n}\n\ninterface AssigneesPluginOptions\n  extends Pick<MentionOptions<User>, 'canOpen' | 'editor'> {}\n\nexport function createAssigneesPlugin(\n  options: AssigneesPluginOptions\n): Partial<Plugin> {\n  return createMentionsPlugin<UserItem>({\n    ...options,\n    trigger: '@',\n    MentionComponent: AssigneesSuggestionComponent,\n  });\n}\n", "import React, { ReactNode, useContext } from 'https://esm.sh/react@18.2.0';\nimport {\n  Editor,\n  Element,\n  Node,\n  NodeEntry,\n  Path,\n  Transforms,\n} from 'https://esm.sh/slate@0.87.0';\nimport { RenderElementProps } from 'https://esm.sh/slate-react@0.87.1';\nimport { NS_NOTES } from '../../../../../../cfds/base/scheme-types.ts';\nimport {\n  Note,\n  User,\n} from '../../../../../../cfds/client/graph/vertices/index.ts';\nimport { UnkeyedDocument } from '../../../../../../cfds/richtext/doc-state.ts';\nimport { ElementNode } from '../../../../../../cfds/richtext/tree.ts';\nimport { createTagsPlugin } from '../../mentions/tags.tsx';\nimport { ElementUtils } from '../../utils/element-utils.ts';\nimport { SelectionUtils } from '../../utils/selection-utils.ts';\nimport { VertexManager } from '../../../../../../cfds/client/graph/vertex-manager.ts';\nimport { mergePlugins } from '../../plugins/index.ts';\nimport { ParagraphElement } from '../../types.ts';\nimport { createAutoReplaceHandler } from '../../utils/auto-replace.ts';\nimport { HeaderElement } from '../header.element.tsx';\nimport { Header2Element } from '../header2.element.tsx';\nimport {\n  CardElementProps,\n  CardNode,\n  LoadingCardElementProps,\n  LoadingCardNode,\n} from './card-node/index.tsx';\nimport { createAssigneesPlugin } from '../../mentions/assignees.tsx';\nimport { NoteType } from '../../../../../../cfds/client/graph/vertices/note.ts';\nimport { Logger } from '../../../../../../logging/log.ts';\nimport { UISource } from '../../../../../../logging/client-events.ts';\nexport const CARD_TYPE = 'ref';\nexport const CARD_LOADING_TYPE = 'NON_EXISTENT';\nexport interface CardElement extends ElementNode {\n  tagName: typeof CARD_TYPE;\n  children: [ParagraphElement];\n  ref: string;\n  type: 'inter-doc';\n}\n\nexport interface LoadingCardElement extends ElementNode {\n  tagName: typeof CARD_LOADING_TYPE;\n  type: 'inter-doc';\n  ref: string;\n  loading: true;\n}\n\nconst cardContext = React.createContext<VertexManager<Note> | null>(null);\n\nexport function EditableCardContext({\n  cardManager,\n  children,\n}: {\n  cardManager: VertexManager<Note>;\n  children?: ReactNode;\n}) {\n  return (\n    <cardContext.Provider value={cardManager}>{children}</cardContext.Provider>\n  );\n}\n\nexport function useCurrentCard() {\n  return useContext(cardContext);\n}\n\nexport function isCardProps(\n  props: RenderElementProps\n): props is CardElementProps {\n  return (\n    props.element.tagName === CARD_TYPE && props.element.type === 'inter-doc'\n  );\n}\n\nexport function isLoadingCardProps(\n  props: RenderElementProps\n): props is LoadingCardElementProps {\n  return CardElement.isLoadingCard(props.element);\n}\n\nexport function renderCard(props: RenderElementProps) {\n  if (isCardProps(props)) {\n    return <CardNode {...props} />;\n  }\n  if (isLoadingCardProps(props)) {\n    return <LoadingCardNode {...props} />;\n  }\n}\n\ninterface CreateNoteOptions {\n  likeSibling?: Note;\n  body?: UnkeyedDocument;\n  title?: UnkeyedDocument;\n}\n\nexport function createNote(\n  parent: Note,\n  currentUser: User,\n  options?: CreateNoteOptions\n): Note {\n  //const refKey = uniqueId();\n  const {\n    likeSibling,\n    body = {\n      root: { children: [{ tagName: 'p', children: [{ text: '' }] }] },\n    },\n    title = {\n      root: { children: [{ tagName: 'p', children: [{ text: '' }] }] },\n    },\n  } = options || {};\n  // const tags = likeSibling ? likeSibling.tags : parent.workspace.taskTags;\n\n  // const tagsMap = new Map(Array.from(tags).map(([p, t]) => [p.key, t.key]));\n\n  // const taskTags = parent.workspace.taskTags;\n  // if (taskTags) {\n  //   for (const [p, c] of taskTags) {\n  //     tagsMap.set(p.key, c.key);\n  //   }\n  // }\n\n  const assignees = likeSibling ? likeSibling.assignees : [currentUser];\n\n  const child = parent.graph.createVertex<Note>(NS_NOTES, {\n    creationDate: new Date(),\n    workspace: parent.workspaceKey,\n    // tags: tagsMap,\n    title,\n    body,\n    type: NoteType.Task,\n    parentNote: parent.key,\n    assignees: new Set(Array.from(assignees).map((x) => x.key)),\n    createdBy: currentUser.key,\n  });\n\n  return child;\n}\n\nexport function createCardPlugin(\n  editor: Editor,\n  getContainingNote: () => VertexManager<Note>,\n  getCurrentUser: () => User,\n  logger: Logger\n) {\n  return mergePlugins([\n    createAutoReplaceHandler({\n      trigger: {\n        default: {\n          metaKeys: [],\n          key: ' ',\n        },\n      },\n      prefix: '-',\n      editor,\n      canTrigger: ([node]) => {\n        return CardElement.canTransformToCard(node);\n      },\n      onTriggered([node, path]: NodeEntry) {\n        const el = node as AllowedElementType;\n        CardElement.replaceAsCard(\n          editor,\n          el,\n          path,\n          getContainingNote(),\n          getCurrentUser()\n        );\n      },\n    }),\n    createTagsPlugin({\n      canOpen() {\n        return CardElement.isSingleCard(editor);\n      },\n      editor,\n    }),\n    createAssigneesPlugin({\n      canOpen() {\n        return CardElement.isSingleCard(editor);\n      },\n      editor,\n    }),\n    {\n      onKeyDown(e) {\n        if (e.key !== 'Enter' && e.key !== 'Backspace') {\n          return;\n        }\n        const [currentNode, currentPath] =\n          SelectionUtils.extractSingleElement(editor);\n        if (!currentNode) {\n          return;\n        }\n        const el = ElementUtils.getClosestNode(\n          editor,\n          currentPath,\n          CardElement.isCard\n        );\n        if (!el) {\n          return;\n        }\n\n        const containing = getContainingNote();\n        if (!containing) {\n          console.warn('No containing note found');\n          return;\n        }\n\n        const [node, path] = el;\n        if (CardElement.isEmptyCard(node)) {\n          e.preventDefault();\n\n          CardElement.unwrapCard(editor, currentPath);\n          logger.log({\n            severity: 'INFO',\n            event: 'Delete',\n            vertex: node.ref,\n            source: 'editor:key-down',\n            id: e.key,\n          });\n          return;\n        }\n        if (e.key === 'Backspace') {\n          return;\n        }\n        e.preventDefault();\n\n        // const current = containing.graph.getVertex<Note>(node.ref);\n        const child = createNote(containing.getVertexProxy(), getCurrentUser());\n\n        const insertAt = Path.next(path);\n        CardElement.insertNote(editor, child, insertAt);\n        Transforms.setSelection(editor, {\n          focus: {\n            path: [...insertAt, 0, 0],\n            offset: 0,\n          },\n          anchor: {\n            path: [...insertAt, 0, 0],\n            offset: 0,\n          },\n        });\n      },\n    },\n    { renderElement: renderCard },\n  ]);\n}\n\nexport type AllowedElementType =\n  | ParagraphElement\n  | HeaderElement\n  | Header2Element;\n\nexport const ALLOWED_ELEMENTS: AllowedElementType['tagName'][] = [\n  'p',\n  'h1',\n  'h2',\n];\n\n// eslint-disable-next-line\nexport const CardElement = {\n  isCard(value: any): value is CardElement {\n    return Element.isElement(value) && value.tagName === CARD_TYPE;\n  },\n  isLoadingCard(node: any): node is LoadingCardElement {\n    return (\n      Element.isElement(node) &&\n      node.type === 'inter-doc' &&\n      !!(node as any).loading\n    );\n  },\n  canTransformToCard(node: Node): boolean {\n    return (\n      Element.isElement(node) &&\n      ALLOWED_ELEMENTS.includes(node.tagName as AllowedElementType['tagName'])\n    );\n  },\n  isSingleCard(editor: Editor): boolean {\n    return ElementUtils.isSingleElement(editor, CardElement.isCard);\n  },\n  isEmptyCard(card: CardElement) {\n    return ElementUtils.isEmptyElement(card.children[0]);\n  },\n  insertNote(editor: Editor, note: Note, at: Path) {\n    Transforms.insertNodes(\n      editor,\n      [\n        {\n          tagName: 'ref',\n          type: 'inter-doc',\n          ref: note.key,\n          children: note.title.root.children as [ParagraphElement],\n        },\n      ],\n      { at }\n    );\n  },\n  unwrapCard(editor: Editor, at: Path) {\n    const el = ElementUtils.getClosestNode(editor, at, CardElement.isCard);\n    if (!el) {\n      return;\n    }\n\n    const [, cardPath] = el;\n    Transforms.unwrapNodes(editor, { at: cardPath });\n  },\n  replaceAsCard(\n    editor: Editor,\n    node: AllowedElementType,\n    path: Path,\n    parentNoteMng: VertexManager<Note>,\n    currentUser: User\n  ) {\n    const child = createNote(parentNoteMng.getVertexProxy(), currentUser, {\n      title: {\n        root: {\n          children: [\n            {\n              tagName: 'p',\n              children: node.children.map((x) => {\n                const { localKey, ...text } = x;\n                return text;\n              }),\n            },\n          ],\n        },\n      },\n    });\n    const reffedPath = Editor.pathRef(editor, path);\n\n    CardElement.insertNote(editor, child, path);\n    const cardPath = Editor.pathRef(editor, [...path, 0]);\n    if (Path.equals(path, [0])) {\n      // FIX: Slate has issues with a nested child as first child\n      Transforms.insertNodes(\n        editor,\n        {\n          tagName: 'p',\n          children: [{ text: '' }],\n        },\n        { at: path }\n      );\n    }\n    Transforms.setSelection(editor, {\n      focus: {\n        path: [...cardPath.current!, 0],\n        offset: 0,\n      },\n      anchor: {\n        path: [...cardPath.current!, 0],\n        offset: 0,\n      },\n    });\n    Transforms.removeNodes(editor, {\n      at: reffedPath.current || undefined,\n    });\n    reffedPath.unref();\n    cardPath.unref();\n  },\n};\n", "import {\n  BaseEditor,\n  BaseRange,\n  Editor,\n  Element,\n  Node,\n  Operation,\n  Path,\n} from 'https://esm.sh/slate@0.87.0';\nimport { ReactEditor } from 'https://esm.sh/slate-react@0.87.1';\nimport { uniqueId } from '../../../../../base/common.ts';\nimport { Range } from '../../../../../cfds/richtext/doc-state.ts';\nimport { TextNode } from '../../../../../cfds/richtext/tree.ts';\nimport { NodeKey, TreeKeys } from '../../../../../cfds/richtext/tree-keys.ts';\nimport { CoreValue } from '../../../../../base/core-types/base.ts';\nimport { ElementNodeType } from '../types.ts';\nimport { CardElement } from '../elements/card.element/index.tsx';\nimport { notReached } from '../../../../../base/error.ts';\n\nexport interface CfdsEditor extends BaseEditor {\n  localKey: { id: string };\n  onLocalSelectionChanged?: (selection: BaseRange) => void;\n  undo: () => void;\n  redo: () => void;\n}\n\nexport interface CfdsEditorInternal extends CfdsEditor {\n  _isCfdsInternal: boolean;\n  _isInExternalSelectionChange: boolean;\n  _treeKeys: TreeKeys;\n}\n\nexport default function withCfds<T extends Editor>(editor: T): T & CfdsEditor {\n  const { apply, insertFragment, isVoid } = editor;\n\n  const cfdsEditor = editor as CfdsEditorInternal & T;\n  editor.localKey = { id: uniqueId() };\n  cfdsEditor._isInExternalSelectionChange = false;\n  cfdsEditor._isCfdsInternal = true;\n  editor.apply = (operation: Operation) => {\n    // if (operation.type === 'insert_node' && operation.node) {\n    //   const { ...node } = operation.node;\n    //   // (node as any).localKey = uniqueId();\n    //   operation = {\n    //     ...operation,\n    //     node: node as Node,\n    //   };\n    // }\n    // if (operation.type === 'split_node' && operation.properties) {\n    //   const { ...properties } = operation.properties;\n    //   // (properties as any).localKey = uniqueId();\n    //   operation = {\n    //     ...operation,\n    //     properties,\n    //   };\n    // }\n    apply(operation);\n    if (\n      operation.type === 'set_selection' &&\n      !cfdsEditor._isInExternalSelectionChange &&\n      cfdsEditor.onLocalSelectionChanged\n    ) {\n      cfdsEditor.onLocalSelectionChanged(editor.selection!);\n    }\n  };\n  editor.insertFragment = (fragment: Node[]) => {\n    const sanitizedFragment: Node[] = fragment.map((node) => {\n      const { localKey, ...newNode } = node;\n      return newNode as Node;\n    });\n    insertFragment(sanitizedFragment);\n  };\n  editor.isVoid = (el: ElementNodeType) => {\n    return CardElement.isLoadingCard(el) || isVoid(el);\n  };\n  cfdsEditor.undo = () => {};\n  cfdsEditor.redo = () => {};\n\n  return cfdsEditor;\n}\n\nconst findKey = ReactEditor.findKey;\n\nexport function isCfdsInternal(\n  editor: BaseEditor\n): editor is CfdsEditorInternal {\n  return !!(editor as any)._isCfdsInternal;\n}\n\nReactEditor.findKey = (editor: ReactEditor, node: Node): NodeKey => {\n  if (!isCfdsInternal(editor)) {\n    return findKey(editor, node);\n  }\n  if (Editor.isEditor(node)) {\n    return editor.localKey;\n  }\n  return editor._treeKeys.keyFor(node as CoreValue);\n};\n\nfunction slateRangeToCfdsRange(editor: Editor, range: BaseRange): Range;\n\nfunction slateRangeToCfdsRange(\n  editor: Editor,\n  range: BaseRange | null\n): Range | undefined;\n\nfunction slateRangeToCfdsRange(\n  editor: Editor,\n  range: BaseRange | null\n): Range | undefined {\n  if (!range) return undefined;\n  const anchor = Node.get(editor, range.anchor.path);\n  const focus = Node.get(editor, range.focus.path);\n\n  return {\n    anchor: {\n      node: anchor as TextNode,\n      offset: range.anchor.offset,\n    },\n    focus: {\n      node: focus as TextNode,\n      offset: range.focus.offset,\n    },\n  };\n}\n\n// eslint-disable-next-line\nexport const CfdsEditor = {\n  setExternalSelection(editor: Editor, selection: BaseRange | null): void {\n    const cfdsEditor = editor as CfdsEditorInternal & Editor;\n    cfdsEditor._isInExternalSelectionChange = true;\n    // Transforms.setSelection(editor, selection);\n    cfdsEditor.selection = selection;\n    cfdsEditor._isInExternalSelectionChange = false;\n  },\n  slateRangeToCfdsRange,\n  findPath(parent: ElementNodeType | Editor, child: Node): Path {\n    for (let i = 0; i < parent.children.length; i++) {\n      const current = parent.children[i];\n      if (current === child) {\n        return [i];\n      }\n      if (Element.isElement(current) || Editor.isEditor(current)) {\n        const inner = CfdsEditor.findPath(current, child);\n        if (inner) {\n          inner.unshift(i);\n          return inner;\n        }\n      }\n    }\n    notReached('CfdsEditor.findPath() failed finding a path');\n  },\n  cfdsRangeToSlateRange(\n    editor: Editor,\n    range: Range | undefined\n  ): BaseRange | null {\n    if (!range) return null;\n    const anchor = range.anchor.node;\n    const focus = range.focus.node;\n\n    // const anchorPath = ReactEditor.findPath(editor, anchor);\n    // const focusPath = ReactEditor.findPath(editor, focus);\n\n    const anchorPath = CfdsEditor.findPath(editor, anchor);\n    const focusPath = CfdsEditor.findPath(editor, focus);\n\n    return {\n      anchor: {\n        path: anchorPath,\n        offset: range.anchor.offset,\n      },\n      focus: {\n        path: focusPath,\n        offset: range.focus.offset,\n      },\n    };\n  },\n};\n", "import { GraphManager } from '../../../../../cfds/client/graph/graph-manager.ts';\nimport { EVENT_CRITICAL_ERROR } from '../../../../../cfds/client/graph/vertex-manager.ts';\nimport { useEffect } from 'https://esm.sh/react@18.2.0';\nimport { useGraphManager } from './graph.tsx';\n\nfunction registerOnCriticalError(\n  manager: GraphManager | undefined | null,\n  onCriticalError: () => void\n): void | (() => void | undefined) {\n  if (manager === undefined || manager === null) {\n    return;\n  }\n\n  manager.on(EVENT_CRITICAL_ERROR, onCriticalError);\n  return () => {\n    manager.removeListener(EVENT_CRITICAL_ERROR, onCriticalError);\n  };\n}\n\nexport function useOnCriticalError(onCriticalError: () => void) {\n  const graphMng = useGraphManager();\n\n  useEffect(() => {\n    return registerOnCriticalError(graphMng, onCriticalError);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [graphMng]);\n}\n", "import React, {\n  useCallback,\n  useEffect,\n  useMemo,\n} from 'https://esm.sh/react@18.2.0';\nimport {\n  Descendant,\n  Editor,\n  Range as SlateRange,\n} from 'https://esm.sh/slate@0.87.0';\nimport { ReactEditor } from 'https://esm.sh/slate-react@0.87.1';\nimport { Vertex } from '../../../../../cfds/client/graph/vertex.ts';\nimport {\n  Document,\n  DocumentRanges,\n  Range,\n  UnkeyedDocument,\n} from '../../../../../cfds/richtext/doc-state.ts';\nimport { TreeNode } from '../../../../../cfds/richtext/tree.ts';\nimport { VertexManager } from '../../../../../cfds/client/graph/vertex-manager.ts';\nimport { mutationPackHasField } from '../../../../../cfds/client/graph/mutations.ts';\nimport { UndoContextOptions } from '../../../../../cfds/client/undo/context.ts';\nimport { usePartialVertex } from '../../cfds/react/vertex.ts';\nimport { CfdsEditor, isCfdsInternal } from './with-cfds.tsx';\nimport { useGraphManager } from '../../cfds/react/graph.tsx';\nimport { Note } from '../../../../../cfds/client/graph/vertices/note.ts';\nimport { useOnCriticalError } from '../../cfds/react/graph-use.ts';\n\nexport type RichtextKeys<T> = {\n  [K in keyof T]: T[K] extends UnkeyedDocument ? K : never;\n}[keyof T];\n\nexport interface EditorHandler {\n  value: Descendant[];\n  onChange: (newValue: Descendant[]) => void;\n}\n\ninterface CfdsEditorOptions {\n  undoAddBodyRefs: boolean;\n  expirationInMs: number;\n}\n\nconst DEFAULT_OPTS: CfdsEditorOptions = {\n  undoAddBodyRefs: false,\n  expirationInMs: 1000 * 10,\n};\n\nconst expirationBuffer = 10000;\n\nfunction makeExpirationDate(expirationInMs: number): Date {\n  return new Date(Date.now() + expirationInMs + expirationBuffer);\n}\n\nfunction useUndoContext(\n  editor: Editor,\n  vMng: VertexManager<Note>,\n  field: string,\n  addBodyRefs: boolean\n) {\n  const graph = useGraphManager();\n  useEffect(() => {\n    const options: UndoContextOptions = {\n      vertices: [\n        {\n          keys: [vMng.key],\n          filter: (_, mut) => {\n            return mutationPackHasField(mut, field);\n          },\n          snapshotFields: [field],\n        },\n      ],\n    };\n\n    if (addBodyRefs) {\n      const childKeys = vMng.getVertexProxy().getBodyRefs();\n\n      options.vertices?.push({\n        keys: childKeys,\n        filter: (_, mut) => {\n          return mutationPackHasField(mut, 'title');\n        },\n        snapshotFields: ['title'],\n      });\n    }\n    options.filters = [\n      {\n        filter: (v, mut) => {\n          return (\n            v instanceof Note &&\n            v.parentNote?.key === vMng.key &&\n            mutationPackHasField(mut, 'title')\n          );\n        },\n        initialSnapshot: { data: { isDeleted: 1 }, local: {} },\n        snapshotFields: ['title'],\n      },\n    ];\n\n    const undoCtx = graph.undoManager.createContext(options);\n\n    editor.undo = () => {\n      const res = undoCtx.undo();\n      if (!res && !ReactEditor.isFocused(editor)) {\n        ReactEditor.focus(editor);\n      }\n    };\n    editor.redo = () => {\n      const res = undoCtx.redo();\n      if (!res && !ReactEditor.isFocused(editor)) {\n        ReactEditor.focus(editor);\n      }\n    };\n\n    return () => {\n      editor.undo = () => {};\n      editor.redo = () => {};\n      undoCtx.dispose();\n    };\n  }, [editor, graph, vMng, field, addBodyRefs]);\n}\n\nfunction handleSelection(editor: Editor, selection: Range | undefined) {\n  if (!ReactEditor.isFocused(editor)) {\n    return;\n  }\n  const slateSelection = CfdsEditor.cfdsRangeToSlateRange(editor, selection);\n\n  if (!editor.selection && !slateSelection) {\n    return;\n  }\n\n  if (\n    (!editor.selection && slateSelection) ||\n    (editor.selection && !slateSelection) ||\n    !SlateRange.equals(slateSelection!, editor.selection!)\n  ) {\n    CfdsEditor.setExternalSelection(editor, slateSelection);\n  }\n}\n\n// Set this to false to disable updating of selection on external change\nconst SET_EXTERNAL_SELECTION = true;\n\nexport function useCfdsEditor<T extends Vertex, K extends RichtextKeys<T>>(\n  vertexMng: VertexManager<T>,\n  field: K,\n  editor: Editor,\n  selectionId: string,\n  opts: Partial<CfdsEditorOptions> = {}\n): EditorHandler {\n  const vertex = usePartialVertex(vertexMng, [field]);\n  const {\n    undoAddBodyRefs = DEFAULT_OPTS.undoAddBodyRefs,\n    expirationInMs = DEFAULT_OPTS.expirationInMs,\n  } = opts;\n\n  useOnCriticalError(() => {\n    ReactEditor.blur(editor);\n  });\n\n  useUndoContext(editor, vertexMng as any, field as string, undoAddBodyRefs);\n  const richtext = vertex[field] as unknown as Document;\n  const onChange = useCallback(\n    (newValue: Descendant[]) => {\n      const ranges: DocumentRanges = {};\n      if (editor.selection) {\n        ranges[selectionId] = {\n          ...CfdsEditor.slateRangeToCfdsRange(editor, editor.selection),\n          expiration: makeExpirationDate(expirationInMs),\n        };\n      }\n      const v = vertexMng.getVertexProxy();\n      v[field] = {\n        root: {\n          children: newValue as TreeNode[],\n        },\n        ranges,\n      } as unknown as T[K];\n    },\n    [vertexMng, editor, selectionId, expirationInMs, field]\n  );\n  const value = richtext.root.children as Descendant[];\n\n  const selection = (richtext.ranges || {})[selectionId];\n\n  const slateValue = useMemo(() => {\n    if (SET_EXTERNAL_SELECTION) {\n      editor.children = value;\n      handleSelection(editor, selection);\n    }\n    return value;\n  }, [value, selection, editor]);\n\n  useEffect(() => {\n    const intervalId = setInterval(() => {\n      const proxy = vertexMng.getVertexProxy();\n      const rt = proxy[field] as unknown as Document;\n      let selection = (rt.ranges || {})[selectionId];\n      if (!selection) {\n        if (!editor.selection) {\n          return;\n        }\n        selection = CfdsEditor.slateRangeToCfdsRange(editor, editor.selection);\n      }\n\n      proxy[field] = {\n        root: rt.root,\n        ranges: {\n          [selectionId]: {\n            ...selection,\n            expiration: makeExpirationDate(expirationInMs),\n          },\n        },\n      } as unknown as T[K];\n    }, expirationInMs);\n\n    return () => {\n      clearInterval(intervalId);\n    };\n  }, [vertexMng, field, expirationInMs, selectionId, editor]);\n\n  if (isCfdsInternal(editor)) {\n    editor._treeKeys = richtext.nodeKeys;\n  }\n\n  return {\n    onChange,\n    value: slateValue,\n  };\n}\n", "import {\n  Editor,\n  Element,\n  Node,\n  NodeEntry,\n  Path,\n  Transforms,\n} from 'https://esm.sh/slate@0.87.0';\nimport { BulletListElement } from '../elements/bullet-list.element.tsx';\nimport { ListItemElement } from '../elements/list-item.element.tsx';\nimport { NumberedListElement } from '../elements/numbered-list.element.tsx';\nimport { ElementUtils } from './element-utils.ts';\n\ntype NestedContainerElement = BulletListElement | NumberedListElement;\ntype NestedChild = ListItemElement;\n\nexport const ListUtils = {\n  isNestedContainer(value: any): value is NestedContainerElement {\n    // if (Editor.isEditor(value)) {\n    //   return true;\n    // }\n    if (!Element.isElement(value)) {\n      return false;\n    }\n    return value.tagName === 'ol' || value.tagName === 'ul';\n  },\n  isNestedChild(value: any): value is NestedChild {\n    return (\n      Element.isElement(value) &&\n      (value.tagName === 'li' || ListUtils.isNestedContainer(value))\n    );\n  },\n  getContainerParent(\n    editor: Editor,\n    path: Path\n  ): NodeEntry<NestedContainerElement> {\n    return Editor.above(editor, {\n      at: path,\n      mode: 'lowest',\n      match: (node, p) =>\n        !Path.equals(path, p) && ListUtils.isNestedContainer(node),\n    })!;\n  },\n  setList(editor: Editor, path: Path, listType: 'ul' | 'ol'): void {\n    const [node] = Editor.node(editor, path);\n    const texts = Array.from(Node.texts(node)).map(([text]) => text);\n    Transforms.removeNodes(editor, { at: path });\n    Transforms.insertNodes(\n      editor,\n      {\n        tagName: listType,\n        children: [\n          {\n            tagName: 'li',\n            children: texts,\n          },\n        ],\n      },\n      { at: path }\n    );\n    const newPath = [...path, 0, 0];\n    Transforms.setSelection(editor, {\n      anchor: {\n        path: newPath,\n        offset: 0,\n      },\n      focus: {\n        path: newPath,\n        offset: 0,\n      },\n    });\n  },\n  liftListItem(editor: Editor, path: Path): void {\n    const [item] = Editor.node(editor, path);\n    const [itemNode, itemPath] = ListUtils.isNestedChild(item)\n      ? [item, path]\n      : Editor.above(editor, {\n          at: path,\n          mode: 'lowest',\n          match: ListUtils.isNestedChild,\n        })!;\n    const itemRef = Editor.pathRef(editor, itemPath);\n    const [containerNode, containerPath] = ListUtils.getContainerParent(\n      editor,\n      itemPath\n    );\n    // let [upperContainer, upperContainerPath] = ListUtils.getContainerParent(editor, containerPath);\n    const containerPathRef = Editor.pathRef(editor, containerPath);\n    const itemIndex = itemPath[itemPath.length - 1];\n    if (itemIndex !== 0 && itemIndex !== containerNode.children.length - 1) {\n      const splitPath = Path.next(containerPath);\n      Transforms.insertNodes(\n        editor,\n        {\n          tagName: containerNode.tagName,\n          children: [],\n        },\n        {\n          at: splitPath,\n        }\n      );\n      Transforms.moveNodes(editor, {\n        at: containerPath,\n        to: [...splitPath, 0],\n        match: (_, p) =>\n          Path.isSibling(p, itemRef.current!) &&\n          Path.isAfter(p, itemRef.current!),\n      });\n    }\n    const indexAfterSplit = itemRef.current![itemRef.current!.length - 1];\n\n    Transforms.moveNodes(editor, {\n      at: itemRef.current!,\n      to: indexAfterSplit === 0 ? containerPath : Path.next(containerPath),\n    });\n    const newContainer = ListUtils.getContainerParent(editor, itemRef.current!);\n    if (itemNode.tagName === 'li' && !newContainer) {\n      Transforms.setNodes(editor, { tagName: 'p' }, { at: itemRef.current! });\n    }\n    itemRef.unref();\n\n    const [updatedContainer] = Editor.node(editor, containerPathRef.current!);\n\n    if (ElementUtils.isEmptyElement(updatedContainer)) {\n      Transforms.removeNodes(editor, { at: containerPathRef.current! });\n    }\n    containerPathRef.unref();\n  },\n};\n", "import React, { useContext } from 'https://esm.sh/react@18.2.0';\nimport { Editor, Element } from 'https://esm.sh/slate@0.87.0';\nimport { RenderElementProps } from 'https://esm.sh/slate-react@0.87.1';\nimport { Plugin } from '../plugins/index.ts';\nimport { TextType } from '../types.ts';\nimport { ElementUtils } from '../utils/element-utils.ts';\nimport { Text as TextElement } from '../../../../../styles/components/texts.tsx';\nimport { ListUtils } from '../utils/list-utils.ts';\nimport { ElementNode } from '../../../../../cfds/richtext/tree.ts';\n\nimport { cn, makeStyles } from '../../../../../styles/css-objects/index.ts';\n\nexport const listContext = React.createContext(0);\n\nconst useStyles = makeStyles((theme) => {\n  let levelStyles = {};\n  for (let level = 1; level < 6; level++) {\n    levelStyles[`level_${level}_ltr`] = {\n      marginLeft: level * 20,\n      textAlign: 'start',\n    };\n    levelStyles[`level_${level}_rtl`] = {\n      marginRight: level * 20,\n      textAlign: 'start',\n    };\n  }\n  return levelStyles;\n}, 'list-item_element_ce3599');\n\nexport const LIST_ITEM_TYPE = 'li';\n\nexport interface ListItemElement extends ElementNode {\n  tagName: typeof LIST_ITEM_TYPE;\n  children: TextType[];\n}\n\nexport function isListItemProps(\n  props: RenderElementProps\n): props is ListItemProps {\n  return props.element.tagName === LIST_ITEM_TYPE;\n}\n\ninterface ListItemProps extends RenderElementProps {\n  element: ListItemElement;\n}\n\nexport function ListItemElementNode(props: ListItemProps) {\n  const styles = useStyles();\n  const { dir } = props.attributes;\n  const isRtl = dir === 'rtl';\n  const level = useContext(listContext);\n  return (\n    <li\n      {...props.attributes}\n      className={cn(styles[`level_${level}_${isRtl ? 'rtl' : 'ltr'}`])}\n    >\n      <TextElement>{props.children}</TextElement>\n    </li>\n  );\n}\n\nexport function renderElementItem(props: RenderElementProps) {\n  if (isListItemProps(props)) {\n    return <ListItemElementNode {...props} />;\n  }\n}\n\nexport function createListItemPlugin(editor: Editor): Partial<Plugin> {\n  return {\n    renderElement: renderElementItem,\n    onKeyDown(e) {\n      if (e.key !== 'Tab' || e.shiftKey) {\n        return;\n      }\n      if (ListItemElement.isSingleListItem(editor)) {\n        e.preventDefault();\n        const [, path] = ElementUtils.getClosestNode(\n          editor,\n          editor.selection,\n          ListItemElement.isListItem\n        );\n        const [parent] = ListUtils.getContainerParent(editor, path);\n        ListUtils.setList(editor, path, parent.tagName);\n      }\n    },\n  };\n}\n// eslint-disable-next-line\nexport const ListItemElement = {\n  isListItem(value: any): value is ListItemElement {\n    return Element.isElement(value) && value.tagName === 'li';\n  },\n  isSingleListItem(editor: Editor): boolean {\n    return ElementUtils.isSingleElement(editor, ListItemElement.isListItem);\n  },\n};\n", "import React, { useContext } from 'https://esm.sh/react@18.2.0';\nimport { Editor, NodeEntry } from 'https://esm.sh/slate@0.87.0';\nimport { RenderElementProps } from 'https://esm.sh/slate-react@0.87.1';\nimport { ElementNode } from '../../../../../cfds/richtext/tree.ts';\nimport { makeStyles, cn } from '../../../../../styles/css-objects/index.ts';\nimport { mergePlugins } from '../plugins/index.ts';\nimport { createAutoReplaceHandler } from '../utils/auto-replace.ts';\nimport { ListUtils } from '../utils/list-utils.ts';\nimport { listContext, ListItemElement } from './list-item.element.tsx';\nimport { NumberedListElement } from './numbered-list.element.tsx';\n\nconst useStyles = makeStyles(() => ({\n  bulletList: {\n    padding: 0,\n    paddingInlineStart: 0,\n  },\n}));\n\nexport const BULLET_LIST_TYPE = 'ul';\n\nexport interface BulletListElement extends ElementNode {\n  tagName: typeof BULLET_LIST_TYPE;\n  children: (ListItemElement | BulletListElement | NumberedListElement)[];\n}\n\nexport function isBulletListProps(\n  props: RenderElementProps\n): props is BulletListProps {\n  return props.element.tagName === BULLET_LIST_TYPE;\n}\n\ninterface BulletListProps extends RenderElementProps {\n  element: BulletListElement;\n}\n\nexport function BulletListElementNode(props: BulletListProps) {\n  const styles = useStyles();\n  const level = useContext(listContext);\n\n  return (\n    <ul {...props.attributes} className={cn(styles.bulletList)}>\n      <listContext.Provider value={level + 1}>\n        {props.children}\n      </listContext.Provider>\n    </ul>\n  );\n}\n\nexport function renderBulletList(props: RenderElementProps) {\n  if (isBulletListProps(props)) {\n    return <BulletListElementNode {...props} />;\n  }\n}\n\nexport function createBulletListPlugin(editor: Editor) {\n  return mergePlugins([\n    createAutoReplaceHandler({\n      trigger: {\n        default: {\n          metaKeys: [],\n          key: ' ',\n        },\n      },\n      prefix: '*',\n      editor,\n      onTriggered([node, path]: NodeEntry) {\n        ListUtils.setList(editor, path, BULLET_LIST_TYPE);\n      },\n    }),\n    { renderElement: renderBulletList },\n  ]);\n}\n", "import { NS_NOTES, TypeOfScheme } from '../../../../cfds/base/scheme-types.ts';\nimport { NOTE_SCHEME } from '../../../../cfds/base/scheme-versions.ts';\nimport { GraphManager } from '../../../../cfds/client/graph/graph-manager.ts';\nimport {\n  VertexId,\n  KeyFromVertexId,\n} from '../../../../cfds/client/graph/vertex.ts';\nimport {\n  Note,\n  Workspace,\n} from '../../../../cfds/client/graph/vertices/index.ts';\nimport { NoteType } from '../../../../cfds/client/graph/vertices/note.ts';\n\ntype PartialCardData = Partial<TypeOfScheme<typeof NOTE_SCHEME>>;\nexport type CardData = Omit<PartialCardData, 'type'> & { type: NoteType };\n\nexport const emptyDoc = () => ({\n  root: { children: [{ tagName: 'p', children: [{ text: '' }] }] },\n});\n\nexport function createNewNote(\n  graph: GraphManager,\n  ws: VertexId<Workspace>,\n  data: CardData\n): Note {\n  const { type } = data;\n  // const tagsMap = new Map(\n  //   Array.from(type === NoteType.Note ? ws.noteTags : ws.taskTags).map(\n  //     ([p, t]) => [p.key, t.key]\n  //   )\n  // );\n\n  const baseData: CardData = {\n    workspace: KeyFromVertexId(ws),\n    createdBy: graph.rootKey,\n    title: emptyDoc(),\n    body: emptyDoc(),\n    type: type,\n    assignees: new Set<string>([graph.rootKey]),\n    // tags: tagsMap,\n    creationDate: new Date(),\n  };\n  const card = graph.createVertex<Note>(NS_NOTES, {\n    ...baseData,\n    ...data,\n  });\n  return card;\n}\n", "import { Editor, Node, Path, Transforms } from 'https://esm.sh/slate@0.87.0';\nimport { duplicateCard } from '../../../../../../cfds/client/duplicate.ts';\nimport { VertexManager } from '../../../../../../cfds/client/graph/vertex-manager.ts';\nimport { Note } from '../../../../../../cfds/client/graph/vertices/note.ts';\nimport { initRichText } from '../../../../../../cfds/richtext/tree.ts';\nimport { createNewNote } from '../../../../shared/card/create.ts';\nimport { CardElement } from './index.tsx';\n\nexport function withCards(\n  editor: Editor,\n  getNote?: () => VertexManager<Note>\n): Editor {\n  const { insertFragment, normalizeNode } = editor;\n\n  editor.insertFragment = (fragment: Node[]) => {\n    const sanitized = fragment.map((node) => {\n      if (CardElement.isCard(node)) {\n        // If pasting from a different account / stage then the graph won't\n        // have the target vertex. In this case we strip the task to its\n        // contents.\n        const noteMgr = getNote && getNote();\n        if (noteMgr !== undefined && noteMgr.graph.hasVertex(node.ref)) {\n          // First, try to duplicate the inner task including its subtasks\n          let duplicatedTask = duplicateCard(noteMgr.graph, node.ref, {\n            suffix: '',\n          });\n          // Duplicate will fail if not all subtasks are accessible. If this\n          // happens, our next best effort is to duplicate the subtask without\n          // its inner tasks\n          if (duplicatedTask === undefined) {\n            duplicatedTask = createNewNote(\n              noteMgr.graph,\n              noteMgr.getVertexProxy().workspace,\n              {\n                ...noteMgr.graph.getVertex<Note>(node.ref).record.cloneData(),\n                body: initRichText(),\n              }\n            );\n          }\n          // If we've managed to create a duplicate, replace the ref's key\n          if (duplicatedTask !== undefined) {\n            node.ref = duplicatedTask.key;\n          } else {\n            // Failed to create a duplicate. We have no choice but to strip\n            // the ref and keep its only its contents (task title)\n            node = node.children[0];\n          }\n        } else {\n          // We're dealing with a task that's not available in our graph.\n          // Strip it away and keep only its contents\n          node = node.children[0];\n        }\n      }\n      return node;\n    });\n    insertFragment(sanitized);\n  };\n\n  editor.normalizeNode = (entry) => {\n    const [node, path] = entry;\n\n    if (\n      CardElement.isCard(node) &&\n      Path.equals(path, [editor.children.length - 1])\n    ) {\n      Transforms.insertNodes(\n        editor,\n        {\n          tagName: 'p',\n          children: [{ text: '' }],\n        },\n        { at: [editor.children.length] }\n      );\n      return;\n    }\n\n    normalizeNode(entry);\n  };\n\n  return editor;\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport {\n  Editor,\n  Element,\n  NodeEntry,\n  Point,\n  Transforms,\n  Range,\n} from 'https://esm.sh/slate@0.87.0';\nimport { RenderElementProps } from 'https://esm.sh/slate-react@0.87.1';\nimport { ElementNode, TextNode } from '../../../../../cfds/richtext/tree.ts';\nimport { styleguide } from '../../../../../styles/index.ts';\nimport { H2 } from '../../../../../styles/components/texts.tsx';\nimport { makeStyles, cn } from '../../../../../styles/css-objects/index.ts';\nimport { KeyDownHandler, mergePlugins } from '../plugins/index.ts';\nimport { TextType } from '../types.ts';\nimport { createAutoReplaceHandler } from '../utils/auto-replace.ts';\nimport { isKeyPressed } from '../utils/hotkeys.ts';\nimport { MarkupNode } from '../../../../../cfds/richtext/model.ts';\n\nconst useStyles = makeStyles(() => ({\n  header: {\n    marginBottom: styleguide.gridbase * 2,\n  },\n}));\n\nexport const HEADING_1_TYPE = 'h1';\n\nexport interface HeaderElement extends ElementNode {\n  tagName: typeof HEADING_1_TYPE;\n  children: TextType[];\n}\n\nexport function isHeaderProps(\n  props: RenderElementProps\n): props is HeaderElementProps {\n  return props.element.tagName === HEADING_1_TYPE;\n}\n\ninterface HeaderElementProps extends RenderElementProps {\n  element: HeaderElement;\n}\n\nexport function HeaderElementNode(props: HeaderElementProps) {\n  const styles = useStyles();\n  return (\n    <H2 {...props.attributes} className={cn(styles.header)}>\n      {props.children}\n    </H2>\n  );\n}\n\nexport function renderHeader(props: RenderElementProps) {\n  if (isHeaderProps(props)) {\n    return <HeaderElementNode {...props} />;\n  }\n}\nfunction selectionStartEndPoints(editor: Editor) {\n  if (Range.isCollapsed(editor.selection)) {\n    return [editor.selection.focus, editor.selection.focus];\n  } else {\n    return Range.edges(\n      Editor.unhangRange(editor, editor.selection, { voids: true })\n    );\n  }\n}\nfunction rangeOfBlockAtPoint(editor: Editor, point: Point) {\n  let [headerNode, rootPath] = Editor.parent(editor, point);\n  let rangeStart: Point = { path: rootPath.concat([0]), offset: 0 };\n  let lastNodeIndex = headerNode.children.length - 1;\n  let lastNode = headerNode.children[lastNodeIndex] as TextNode;\n  let rangeEnd: Point = {\n    path: rootPath.concat([lastNodeIndex]),\n    offset: lastNode.text.length,\n  };\n\n  return [rangeStart, rangeEnd];\n}\n\nexport function createEnterHandler(\n  editor: Editor,\n  tagName: Element['tagName']\n): KeyDownHandler {\n  return {\n    onKeyDown(e) {\n      if (!isKeyPressed(e, 'Enter')) {\n        return;\n      }\n      let [selectionStart, selectionEnd] = selectionStartEndPoints(editor);\n      let elementAtStart = Editor.parent(\n        editor,\n        selectionStart\n      )[0] as MarkupNode;\n\n      if (elementAtStart.tagName !== tagName) {\n        return;\n      }\n\n      e.preventDefault();\n\n      let setPrefix = false,\n        setSuffix = false;\n\n      if (\n        Point.equals(\n          selectionStart,\n          rangeOfBlockAtPoint(editor, selectionStart)[0]\n        )\n      ) {\n        setPrefix = true;\n      } else if (\n        Point.equals(selectionEnd, rangeOfBlockAtPoint(editor, selectionEnd)[1])\n      ) {\n        setSuffix = true;\n      }\n\n      Editor.insertBreak(editor);\n      if (setSuffix) {\n        Transforms.setNodes(editor, { tagName: 'p' });\n      } else if (setPrefix) {\n        Transforms.setNodes(editor, { tagName: 'p' }, { at: selectionStart });\n      }\n    },\n  };\n}\n\nexport function createHeaderPlugin(editor: Editor) {\n  return mergePlugins([\n    createAutoReplaceHandler({\n      trigger: {\n        default: {\n          metaKeys: [],\n          key: ' ',\n        },\n      },\n      prefix: '#',\n      editor,\n      onTriggered([node, path]: NodeEntry) {\n        Transforms.setNodes(editor, { tagName: HEADING_1_TYPE }, { at: path });\n      },\n    }),\n    { renderElement: renderHeader },\n    createEnterHandler(editor, 'h1'),\n  ]);\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { Editor, NodeEntry, Transforms } from 'https://esm.sh/slate@0.87.0';\nimport { RenderElementProps } from 'https://esm.sh/slate-react@0.87.1';\nimport { ElementNode } from '../../../../../cfds/richtext/tree.ts';\nimport { styleguide } from '../../../../../styles/index.ts';\nimport { makeStyles, cn } from '../../../../../styles/css-objects/index.ts';\nimport { mergePlugins } from '../plugins/index.ts';\nimport { TextType } from '../types.ts';\nimport { createAutoReplaceHandler } from '../utils/auto-replace.ts';\nimport { H3 } from '../../../../../styles/components/texts.tsx';\nimport { createEnterHandler } from './header.element.tsx';\nconst useStyles = makeStyles((theme) => ({\n  header2: {\n    marginBottom: styleguide.gridbase,\n  },\n}));\n\nexport const HEADING_2_TYPE = 'h2';\n\nexport interface Header2Element extends ElementNode {\n  tagName: typeof HEADING_2_TYPE;\n  children: TextType[];\n}\n\nexport function isHeader2Props(\n  props: RenderElementProps\n): props is Header2ElementProps {\n  return props.element.tagName === HEADING_2_TYPE;\n}\n\ninterface Header2ElementProps extends RenderElementProps {\n  element: Header2Element;\n}\n\nexport function Header2ElementNode(props: Header2ElementProps) {\n  const styles = useStyles();\n  return (\n    <H3 {...props.attributes} className={cn(styles.header2)}>\n      {props.children}\n    </H3>\n  );\n}\n\nexport function renderHeader2(props: RenderElementProps) {\n  if (isHeader2Props(props)) {\n    return <Header2ElementNode {...props} />;\n  }\n}\n\nexport function createHeader2Plugin(editor: Editor) {\n  return mergePlugins([\n    createAutoReplaceHandler({\n      trigger: {\n        default: {\n          metaKeys: [],\n          key: ' ',\n        },\n      },\n      prefix: '##',\n      editor,\n      onTriggered([node, path]: NodeEntry) {\n        Transforms.setNodes(editor, { tagName: HEADING_2_TYPE }, { at: path });\n      },\n    }),\n    { renderElement: renderHeader2 },\n    createEnterHandler(editor, 'h2'),\n  ]);\n}\n", "import React, { useContext } from 'https://esm.sh/react@18.2.0';\nimport { Editor, NodeEntry } from 'https://esm.sh/slate@0.87.0';\nimport { RenderElementProps } from 'https://esm.sh/slate-react@0.87.1';\nimport { ElementNode } from '../../../../../cfds/richtext/tree.ts';\nimport { makeStyles, cn } from '../../../../../styles/css-objects/index.ts';\nimport { mergePlugins } from '../plugins/index.ts';\nimport { createAutoReplaceHandler } from '../utils/auto-replace.ts';\nimport { ListUtils } from '../utils/list-utils.ts';\nimport { listContext, ListItemElement } from './list-item.element.tsx';\n\nconst useStyles = makeStyles(() => ({\n  numberedList: {\n    padding: 0,\n    paddingInlineStart: 0,\n  },\n}));\n\nexport const NUMBERED_LIST_TYPE = 'ol';\n\nexport interface NumberedListElement extends ElementNode {\n  tagName: typeof NUMBERED_LIST_TYPE;\n  children: ListItemElement[];\n}\n\nexport function isNumberedListProps(\n  props: RenderElementProps\n): props is NumberedListProps {\n  return props.element.tagName === NUMBERED_LIST_TYPE;\n}\n\ninterface NumberedListProps extends RenderElementProps {\n  element: NumberedListElement;\n}\n\nexport function NumberedListElementNode(props: NumberedListProps) {\n  const styles = useStyles();\n  const level = useContext(listContext);\n  return (\n    <ol {...props.attributes} className={cn(styles.numberedList)}>\n      <listContext.Provider value={level + 1}>\n        {props.children}\n      </listContext.Provider>\n    </ol>\n  );\n}\n\nexport function renderNumberedList(props: RenderElementProps) {\n  if (isNumberedListProps(props)) {\n    return <NumberedListElementNode {...props} />;\n  }\n}\n\nexport function createNumberedListPlugin(editor: Editor) {\n  return mergePlugins([\n    createAutoReplaceHandler({\n      trigger: {\n        default: {\n          metaKeys: [],\n          key: ' ',\n        },\n      },\n      prefix: '1.',\n      editor,\n      onTriggered([node, path]: NodeEntry) {\n        ListUtils.setList(editor, path, NUMBERED_LIST_TYPE);\n      },\n    }),\n    {\n      renderElement: renderNumberedList,\n    },\n  ]);\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { BaseRange, Editor, Node } from 'https://esm.sh/slate@0.87.0';\nimport { RenderLeafProps } from 'https://esm.sh/slate-react@0.87.1';\nimport { makeStyles, cn } from '../../../../../styles/css-objects/index.ts';\nimport { KeyDownHandler, Plugin } from './index.ts';\nimport { FormattedText } from '../types.ts';\nimport {\n  getPlatformHotkey,\n  Hotkey,\n  isHotkeyActive,\n  MetaKeys,\n  Shortcut,\n} from '../utils/hotkeys.ts';\n\nconst useStyles = makeStyles(() => ({\n  bold: {\n    fontWeight: '600',\n  },\n  underline: {\n    textDecoration: 'underline',\n  },\n  strikethrough: {\n    textDecoration: 'line-through',\n    '&underline': {\n      textDecoration: 'underline line-through',\n    },\n  },\n  italic: {\n    fontStyle: 'italic',\n  },\n}));\n\nconst MARK_PROPS = ['bold', 'italic', 'underline', 'strikethrough'];\n\nfunction Leaf(props: RenderLeafProps) {\n  const styles = useStyles();\n  const { leaf } = props;\n  const classes = cn(MARK_PROPS.map((p) => leaf[p] && styles[p]));\n\n  return (\n    <span {...props.attributes} className={classes}>\n      {props.children}\n    </span>\n  );\n}\n\nfunction renderLeaf(props: RenderLeafProps): JSX.Element {\n  return <Leaf {...props} />;\n}\n\nconst BOLD_SHORTCUT: Shortcut = {\n  default: {\n    metaKeys: [MetaKeys.Meta],\n    key: 'b',\n  },\n};\nconst ITALIC_SHORTCUT: Shortcut = {\n  default: {\n    metaKeys: [MetaKeys.Meta],\n    key: 'i',\n  },\n};\n\nconst STRIKETHROUGH_SHORTCUT: Shortcut = {\n  default: {\n    metaKeys: [MetaKeys.Meta],\n    key: 's',\n  },\n};\n\nconst UNDERLINE_SHORTCUT: Shortcut = {\n  default: {\n    metaKeys: [MetaKeys.Meta],\n    key: 'u',\n  },\n};\n\nconst handlers: { prop: keyof FormattedText; hotkey: Hotkey }[] = (\n  [\n    [BOLD_SHORTCUT, 'bold'],\n    [ITALIC_SHORTCUT, 'italic'],\n    [STRIKETHROUGH_SHORTCUT, 'strikethrough'],\n    [UNDERLINE_SHORTCUT, 'underline'],\n  ] as [Shortcut, keyof FormattedText][]\n).map(([shortcut, prop]) => ({\n  prop,\n  hotkey: getPlatformHotkey(shortcut),\n}));\n\nfunction createKeyDownHandlers(editor: Editor): KeyDownHandler {\n  return {\n    onKeyDown(e) {\n      for (const handler of handlers) {\n        if (isHotkeyActive(e, handler.hotkey)) {\n          e.preventDefault();\n          e.stopPropagation();\n          LeafUtils.toggleMark(editor, editor.selection!, handler.prop);\n          return;\n        }\n      }\n    },\n  };\n}\n\nexport function createLeafPlugin(editor: Editor): Partial<Plugin> {\n  return {\n    renderLeaf,\n    ...createKeyDownHandlers(editor),\n  };\n}\n\nexport enum MarkToggleStatus {\n  Off,\n  Partial,\n  On,\n}\n\nexport const LeafUtils = {\n  getMarkStatus(\n    editor: Editor,\n    at: BaseRange,\n    mark: keyof FormattedText\n  ): MarkToggleStatus {\n    const fragment = Node.fragment(editor, at);\n    const leaves = fragment.flatMap((x) =>\n      Array.from(Node.texts(x)).map(([text, path]) => [x, text, path])\n    );\n\n    let all = true;\n    let some = false;\n\n    for (const [, text] of leaves) {\n      const markVal = (text as FormattedText)[mark] as boolean;\n      all = all && markVal;\n      some = some || markVal;\n    }\n    if (all) {\n      return MarkToggleStatus.On;\n    }\n    if (some) {\n      return MarkToggleStatus.Partial;\n    }\n    return MarkToggleStatus.Off;\n  },\n  toggleMark(editor: Editor, at: BaseRange, mark: keyof FormattedText) {\n    const markStatus = LeafUtils.getMarkStatus(editor, at, mark);\n    if (markStatus === MarkToggleStatus.On) {\n      Editor.removeMark(editor, mark as string);\n    } else {\n      Editor.addMark(editor, mark as string, true);\n    }\n  },\n};\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { Editor } from 'https://esm.sh/slate@0.87.0';\nimport {\n  ReactEditor,\n  RenderElementProps,\n} from 'https://esm.sh/slate-react@0.87.1';\nimport { useStyles as typography } from '../../../../../styles/components/texts.tsx';\nimport { cn } from '../../../../../styles/css-objects/index.ts';\nimport {\n  KeyDownHandler,\n  mergePlugins,\n  Plugin,\n  RenderElementHandler,\n} from './index.ts';\nimport { ElementUtils } from '../utils/element-utils.ts';\nimport { isKeyPressed } from '../utils/hotkeys.ts';\nimport { ListUtils } from '../utils/list-utils.ts';\nimport { createLeafPlugin } from './leaves.tsx';\n\n// const Paragraph = React.forwardRef<HTMLDivElement, RenderElementProps>(\n//   ({ attributes, children }, ref) => {\n//     return (\n//       <div ref={ref} {...attributes} className={cn(className, typography.text)} />\n//     );\n//   }\n// );\n\nconst Paragraph = ({ children, attributes }: RenderElementProps) => {\n  return (\n    <div {...attributes} className={cn(typography.text)}>\n      {children}\n    </div>\n  );\n};\n\nexport function createBaseRender(\n  editor: Editor,\n  Component: any = Paragraph\n): RenderElementHandler {\n  return {\n    renderElement(props) {\n      // if (props.element.tagName !== 'p') {\n      //   console.warn(\n      //     'Received unhandled element to base render, rendering as default paragraph',\n      //     props.element\n      //   );\n      // }\n      if (props.element.tagName === 'p') {\n        return <Component {...props}>{props.children}</Component>;\n      }\n    },\n  };\n}\nfunction createNestedContainersHandler(editor: Editor): KeyDownHandler {\n  return {\n    onKeyDown(e) {\n      const isNestedChild = ElementUtils.isSingleElement(\n        editor,\n        ListUtils.isNestedChild\n      );\n      if (!isNestedChild) {\n        return;\n      }\n      const [node, path] = Editor.node(editor, editor.selection!);\n      switch (e.key) {\n        case 'Enter':\n        case 'Backspace': {\n          if (!ElementUtils.isEmpty(node)) {\n            return;\n          }\n          e.preventDefault();\n          ListUtils.liftListItem(editor, path);\n          break;\n        }\n        case 'Tab': {\n          if (e.shiftKey) {\n            e.preventDefault();\n            ListUtils.liftListItem(editor, path);\n            break;\n          }\n        }\n      }\n    },\n  };\n}\n\nexport function createBaseBodyPlugin(editor: Editor): Plugin {\n  return mergePlugins([\n    createNestedContainersHandler(editor),\n    createLeafPlugin(editor),\n  ]);\n}\n\nexport function createBaseTitlePlugin(\n  editor: Editor,\n  DefaultComponent: any,\n  onFocusNext: () => void\n): Plugin {\n  return mergePlugins([\n    {\n      onKeyDown(e) {\n        if (isKeyPressed(e, 'Enter') || isKeyPressed(e, 'Tab')) {\n          ReactEditor.blur(editor);\n          e.preventDefault();\n          e.stopPropagation();\n          window.setTimeout(() => {\n            onFocusNext();\n          }, 0);\n        }\n      },\n    },\n    createBaseRender(editor, DefaultComponent),\n    createLeafPlugin(editor),\n  ]);\n}\n", "import { isMention } from '../../mentions/index.tsx';\nimport { FormattedText } from '../../types.ts';\nimport React, {\n  MouseEvent,\n  useCallback,\n  useRef,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport { RenderLeafProps } from 'https://esm.sh/slate-react@0.87.1';\nimport { styleguide, layout } from '../../../../../../styles/index.ts';\nimport { IconLink } from '../../../../../../styles/components/icons/index.ts';\nimport Popper from '../../../../../../styles/components/popper.tsx';\nimport { makeStyles, cn } from '../../../../../../styles/css-objects/index.ts';\n\nconst useStyles = makeStyles((theme) => ({\n  anchor: {\n    color: '-webkit-link',\n    textDecoration: 'underline',\n  },\n  button: {\n    marginLeft: styleguide.gridbase,\n    backgroundColor: theme.background[0],\n    borderRadius: 4,\n    height: styleguide.gridbase * 3,\n    width: styleguide.gridbase * 3,\n    userSelect: 'none',\n    boxShadow: '0 3px 5px 0 rgba(42, 62, 82, 0.12)',\n    basedOn: [layout.column, layout.centerCenter],\n  },\n  icon: {\n    transform: 'scale(1.5)',\n    transformOrigin: 'center center',\n  },\n}));\n\ninterface LinkText extends FormattedText {\n  link: string;\n}\n\nexport interface LinkLeafProps extends RenderLeafProps {\n  leaf: LinkText;\n}\n\nexport function isLinkLeafProps(\n  props: RenderLeafProps\n): props is LinkLeafProps {\n  const { leaf } = props;\n  return !isMention(leaf) && !!leaf.link;\n}\n\nexport function LinkLeaf({ leaf, children, attributes }: LinkLeafProps) {\n  const styles = useStyles();\n  const ref = useRef(null);\n  const [isOpen, setIsOpen] = useState(false);\n  const onMouseEnter = useCallback(() => setIsOpen(true), []);\n  const onMouseLeave = useCallback(() => setIsOpen(false), []);\n  const onClick = useCallback((e: MouseEvent) => e.stopPropagation(), []);\n\n  const { link } = leaf;\n\n  return (\n    <span\n      {...attributes}\n      ref={ref}\n      className={cn(styles.anchor)}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n    >\n      {children}\n      <Popper\n        open={isOpen}\n        anchor={ref.current!}\n        contentEditable={false}\n        position=\"right\"\n        direction=\"out\"\n      >\n        <a\n          className={cn(styles.button)}\n          href={link}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          onClick={onClick}\n        >\n          <IconLink fill=\"#9CB2CD\" className={cn(styles.icon)} />\n        </a>\n      </Popper>\n    </span>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { BaseRange, Text } from 'https://esm.sh/slate@0.87.0';\nimport { isMention } from '../../mentions/index.tsx';\nimport { DecorateHandler, RenderLeafHandler } from '../index.ts';\nimport { isLinkLeafProps, LinkLeaf } from './link-leaf.tsx';\n\nfunction getUrlRanges(\n  str: string\n): { start: number; end: number; url: string }[] {\n  const ranges = [];\n  let index = 0;\n  while (index + 'http://'.length <= str.length) {\n    const letters = str.substring(index, index + 'https://'.length);\n    if (letters.startsWith('http://') || letters === 'https://') {\n      let rangeEnd = str.indexOf(' ', index + letters.length);\n      if (rangeEnd === -1) {\n        rangeEnd = str.length;\n      }\n      ranges.push({\n        start: index,\n        end: rangeEnd,\n        url: str.substring(index, rangeEnd),\n      });\n      index = rangeEnd;\n    } else {\n      index++;\n    }\n  }\n\n  return ranges;\n}\n\nconst EMPTY: BaseRange[] = [];\n\nexport function createLinkDecoration(): DecorateHandler & RenderLeafHandler {\n  return {\n    decorate([node, path]) {\n      if (!Text.isText(node) || isMention(node)) {\n        return EMPTY;\n      }\n\n      const urls = getUrlRanges(node.text);\n      return urls.map((data) => ({\n        link: data.url,\n        anchor: { path, offset: data.start },\n        focus: { path, offset: data.end },\n      }));\n    },\n    renderLeaf(props) {\n      if (isLinkLeafProps(props)) {\n        return <LinkLeaf {...props} />;\n      }\n      return null;\n    },\n  };\n}\n", "import { Note } from '../../../../cfds/client/graph/vertices/note.ts';\nimport { useCfdsContext } from '../cfds/react/graph.tsx';\nimport { useEffect, useMemo, useRef } from 'https://esm.sh/react@18.2.0';\nimport { createEditor, Editor } from 'https://esm.sh/slate@0.87.0';\nimport {\n  RenderElementProps,\n  withReact,\n} from 'https://esm.sh/slate-react@0.87.1';\nimport { VertexManager } from '../../../../cfds/client/graph/vertex-manager.ts';\nimport { useCfdsEditor, EditorHandler } from './cfds/use-cfds-editor.ts';\nimport withCfds from './cfds/with-cfds.tsx';\nimport { createBulletListPlugin } from './elements/bullet-list.element.tsx';\nimport { createCardPlugin } from './elements/card.element/index.tsx';\nimport { withCards } from './elements/card.element/with-cards.ts';\nimport { createHeaderPlugin } from './elements/header.element.tsx';\nimport { createHeader2Plugin } from './elements/header2.element.tsx';\nimport { createListItemPlugin } from './elements/list-item.element.tsx';\nimport { createNumberedListPlugin } from './elements/numbered-list.element.tsx';\nimport { withMentions } from './mentions/index.tsx';\nimport { createTagsPlugin } from './mentions/tags.tsx';\nimport { createPluginStack, PluginStack } from './plugins/index.ts';\nimport {\n  createBaseBodyPlugin,\n  createBaseRender,\n  createBaseTitlePlugin,\n} from './plugins/base.tsx';\nimport { createAssigneesPlugin } from './mentions/assignees.tsx';\nimport { useCurrentUser } from '../cfds/react/vertex.ts';\nimport { isDefined } from '../../../../base/comparisons.ts';\nimport { createLinkDecoration } from './plugins/link-decoration/index.tsx';\nimport { useLogger } from '../cfds/react/logger.tsx';\nimport { UISource } from '../../../../logging/client-events.ts';\n\nexport function createOvvioEditor(getNote?: () => VertexManager<Note>): Editor {\n  return withCfds(withCards(withReact(withMentions(createEditor())), getNote));\n}\n\nexport function useBodyEditor(noteManager: VertexManager<Note>): {\n  editor: Editor;\n  plugins: PluginStack;\n  handlers: EditorHandler;\n} {\n  const { sessionId } = useCfdsContext();\n  const noteManagerRef = useRef(noteManager);\n  const currentUser = useCurrentUser();\n  const editor = useMemo(\n    () => createOvvioEditor(() => noteManagerRef.current),\n    []\n  );\n  const logger = useLogger();\n\n  useEffect(() => {\n    noteManagerRef.current = noteManager;\n  }, [noteManager]);\n\n  const plugins = useMemo(\n    () =>\n      createPluginStack([\n        createBaseRender(editor),\n        createHeader2Plugin(editor),\n        createHeaderPlugin(editor),\n        createListItemPlugin(editor),\n        createBulletListPlugin(editor),\n        createNumberedListPlugin(editor),\n        createCardPlugin(\n          editor,\n          () => noteManager,\n          () => currentUser,\n          logger\n        ),\n        createLinkDecoration(),\n        createBaseBodyPlugin(editor),\n      ]),\n    [editor, logger, currentUser, noteManager]\n  );\n  const handlers = useCfdsEditor(\n    noteManager,\n    'body',\n    editor,\n    `${currentUser.key}/${sessionId}`,\n    { undoAddBodyRefs: true }\n  );\n\n  return {\n    editor,\n    plugins,\n    handlers,\n  };\n}\n\nconst noop = () => {};\n\nexport interface UseTitleEditorOptions {\n  onFocusNext: () => void;\n}\n\nconst DEFAULT_OPTS: UseTitleEditorOptions = {\n  onFocusNext: noop,\n};\n\nexport function useTitleEditor(\n  note: VertexManager<Note>,\n  DefaultComponent: React.ReactNode | React.ComponentType<RenderElementProps>,\n  source?: UISource,\n  opts: Partial<UseTitleEditorOptions> = {}\n): {\n  editor: Editor;\n  plugins: PluginStack;\n  handlers: EditorHandler;\n  source?: UISource;\n} {\n  const { onFocusNext } = {\n    ...DEFAULT_OPTS,\n    ...opts,\n  };\n  const { sessionId } = useCfdsContext();\n  const user = useCurrentUser();\n  const noteRef = useRef(note);\n  useEffect(() => {\n    noteRef.current = note;\n  }, [note]);\n  const editor = useMemo(() => createOvvioEditor(() => noteRef.current), []);\n\n  const plugins = useMemo(\n    () =>\n      createPluginStack(\n        [\n          !source || source !== 'list'\n            ? createTagsPlugin({\n                canOpen: () => true,\n                editor,\n              })\n            : undefined,\n          !source || source !== 'list'\n            ? createAssigneesPlugin({\n                canOpen: () => true,\n                editor,\n              })\n            : undefined,\n          createBaseTitlePlugin(editor, DefaultComponent, onFocusNext),\n        ].filter(isDefined)\n      ),\n    [editor, source, DefaultComponent, onFocusNext]\n  );\n  const handlers = useCfdsEditor(\n    note,\n    'title',\n    editor,\n    `${user.key}/${sessionId}`\n  );\n\n  return {\n    editor,\n    plugins,\n    handlers,\n  };\n}\n", "import React, { useEffect } from 'https://esm.sh/react@18.2.0';\nimport { useFocused } from 'https://esm.sh/slate-react@0.87.1';\nimport { VertexManager } from '../../../../../../cfds/client/graph/vertex-manager.ts';\nimport { Note } from '../../../../../../cfds/client/graph/vertices/note.ts';\nimport { UISource } from '../../../../../../logging/client-events.ts';\nimport { useLogger } from '../../../../core/cfds/react/logger.tsx';\n\ninterface FocusReporterProps {\n  cardManager: VertexManager<Note>;\n  source: UISource;\n}\n\nexport function FocusReporter({ cardManager, source }: FocusReporterProps) {\n  const focused = useFocused();\n  const logger = useLogger();\n\n  useEffect(() => {\n    logger.log({\n      severity: 'INFO',\n      event: focused ? 'Start' : 'End',\n      flow: 'edit',\n      vertex: cardManager.key,\n      source,\n    });\n  }, [focused, logger, cardManager, source]);\n\n  return null;\n}\n", "import React, {\n  MouseEvent,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport { Editor, Element, Path } from 'https://esm.sh/slate@0.87.0';\nimport {\n  ReactEditor,\n  useSlate,\n  useSlateStatic,\n} from 'https://esm.sh/slate-react@0.87.1';\nimport { VertexManager } from '../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport { Note } from '../../../../../../../cfds/client/graph/vertices/note.ts';\nimport { layout, styleguide } from '../../../../../../../styles/index.ts';\nimport { Button } from '../../../../../../../styles/components/buttons.tsx';\nimport {\n  IconBold,\n  IconBulletList,\n  IconItalic,\n  IconNumberList,\n  IconStrikethrough,\n  IconTask,\n  IconUnderline,\n} from '../../../../../../../styles/components/icons/index.ts';\nimport { Tooltip } from '../../../../../../../styles/components/tooltip/index.tsx';\nimport {\n  cn,\n  makeStyles,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { useCurrentUser } from '../../../../../core/cfds/react/vertex.ts';\nimport {\n  AllowedElementType,\n  ALLOWED_ELEMENTS,\n  CardElement,\n} from '../../../../../core/slate/elements/card.element/index.tsx';\nimport { LeafUtils } from '../../../../../core/slate/plugins/leaves.tsx';\nimport { FormattedText } from '../../../../../core/slate/types.ts';\nimport {\n  ElementUtils,\n  NodeToggleStatus,\n} from '../../../../../core/slate/utils/element-utils.ts';\nimport { ListUtils } from '../../../../../core/slate/utils/list-utils.ts';\nimport { SelectionUtils } from '../../../../../core/slate/utils/selection-utils.ts';\nimport { TreeNode } from '../../../../../../../cfds/richtext/tree.ts';\nimport { useLogger } from '../../../../../core/cfds/react/logger.tsx';\n\nconst useStyles = makeStyles((theme) => ({\n  menu: {\n    position: 'absolute',\n    bottom: styleguide.gridbase * 3,\n    height: styleguide.gridbase * 5,\n    left: '50%',\n    transform: `translate(-50%, ${styleguide.gridbase * 3}px)`,\n    backgroundColor: theme.background[800],\n    color: theme.background[0],\n    border: `1px solid ${theme.background[100]}`,\n    padding: [0, styleguide.gridbase * 0.5],\n    borderRadius: 6,\n    opacity: 0,\n    ...styleguide.transition.short,\n    transitionProperty: 'opacity transform',\n    alignItems: 'center',\n    userSelect: 'none',\n    basedOn: [layout.row],\n  },\n  visible: {\n    opacity: 1,\n    transform: 'translateX(-50%)',\n  },\n  menuButton: {\n    color: theme.background[0],\n    width: styleguide.gridbase * 4,\n    height: '100%',\n    userSelect: 'none',\n  },\n  icon: {\n    userSelect: 'none',\n  },\n  separator: {\n    height: `calc(100% - ${styleguide.gridbase * 2}px)`,\n    width: 1,\n    backgroundColor: theme.background[100],\n  },\n  active: {\n    color: theme.primary[500],\n  },\n}));\n\nconst HEADER_MAP = {\n  h1: {\n    button: 'H1',\n    tooltip: 'Heading 1',\n  },\n  h2: {\n    button: 'H2',\n    tooltip: 'Heading 2',\n  },\n};\n\nfunction HeaderButton({\n  editor,\n  headerType,\n}: {\n  editor: Editor;\n  headerType: 'h1' | 'h2';\n}) {\n  const styles = useStyles();\n  const { selection } = editor;\n  const isActive =\n    selection &&\n    ElementUtils.getNodeToggleStatus(\n      editor,\n      selection,\n      (node) => Element.isElement(node) && node.tagName === headerType\n    ) === NodeToggleStatus.On;\n  const otherTags = useMemo(\n    () => ALLOWED_ELEMENTS.filter((x) => x !== headerType),\n    [headerType]\n  );\n\n  const onClick = (e: MouseEvent) => {\n    e.preventDefault();\n\n    ElementUtils.toggleNode(\n      editor,\n      selection!,\n      { tagName: headerType },\n      (node: TreeNode) =>\n        Element.isElement(node) &&\n        (node.tagName === headerType ||\n          !(otherTags as string[]).includes(node.tagName)),\n      {\n        match: (n: TreeNode) =>\n          Element.isElement(n) &&\n          (ALLOWED_ELEMENTS as string[]).includes(n.tagName),\n      }\n    );\n  };\n  const texts = HEADER_MAP[headerType];\n  return (\n    <Tooltip text={texts.tooltip}>\n      <Button\n        className={cn(styles.menuButton, isActive && styles.active)}\n        onClick={onClick}\n      >\n        {texts.button}\n      </Button>\n    </Tooltip>\n  );\n}\n\nfunction makeMarkButton(\n  mark: keyof FormattedText,\n  tooltip: string,\n  IconComponent: React.ElementType<{ fill: string; className?: string }>\n) {\n  return ({ marks }: { marks: Omit<FormattedText, 'text'> }) => {\n    const styles = useStyles();\n    const isActive = marks && marks[mark];\n    const editor = useSlateStatic();\n    const handler = useCallback(\n      (e: MouseEvent) => {\n        e.preventDefault();\n        ReactEditor.focus(editor);\n        setTimeout(() => {\n          ReactEditor.focus(editor);\n          LeafUtils.toggleMark(editor, editor.selection!, mark);\n        }, 0);\n      },\n      [editor]\n    );\n    return (\n      <Tooltip text={tooltip}>\n        <Button\n          className={cn(styles.menuButton, isActive && styles.active)}\n          onClick={handler}\n        >\n          <IconComponent fill=\"currentColor\" className={cn(styles.icon)} />\n        </Button>\n      </Tooltip>\n    );\n  };\n}\n\nconst BoldButton = makeMarkButton('bold', 'Bold', IconBold);\nconst ItalicButton = makeMarkButton('italic', 'Italic', IconItalic);\nconst StrikethroughButton = makeMarkButton(\n  'strikethrough',\n  'Strikethrough',\n  IconStrikethrough\n);\nconst UnderlineButton = makeMarkButton('underline', 'Underline', IconUnderline);\n\nenum TaskButtonState {\n  Hidden,\n  Visible,\n  Active,\n}\n\nfunction TaskButton({\n  isVisible,\n  rootManager,\n  setVisible,\n}: {\n  isVisible: boolean;\n  setVisible: (visible: boolean) => void;\n  rootManager: VertexManager<Note>;\n}) {\n  const styles = useStyles();\n  const editor = useSlate();\n  const user = useCurrentUser();\n  const { selection } = editor;\n  const logger = useLogger();\n\n  const selectionState = useMemo(() => {\n    if (!isVisible) {\n      return TaskButtonState.Hidden;\n    }\n    const entry = ElementUtils.getSingleElement(editor);\n    if (!entry) {\n      return TaskButtonState.Hidden;\n    }\n    const [node] = entry;\n    if (CardElement.isCard(node)) {\n      return TaskButtonState.Active;\n    }\n    if (CardElement.canTransformToCard(node)) {\n      return TaskButtonState.Visible;\n    }\n    return TaskButtonState.Hidden;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isVisible, selection]);\n\n  useEffect(() => {\n    setVisible(selectionState !== TaskButtonState.Hidden);\n  }, [selectionState, setVisible]);\n\n  if (selectionState === TaskButtonState.Hidden) {\n    return null;\n  }\n\n  const handler = () => {\n    if (selectionState === TaskButtonState.Active) {\n      CardElement.unwrapCard(editor, editor.selection!.focus.path);\n    } else {\n      const [node, path] =\n        ElementUtils.getSingleElement<AllowedElementType>(editor)!;\n      CardElement.replaceAsCard(editor, node, path, rootManager, user);\n    }\n  };\n\n  return (\n    <Tooltip text=\"Task\">\n      <Button\n        className={cn(\n          styles.menuButton,\n          selectionState === TaskButtonState.Active && styles.active\n        )}\n        onClick={handler}\n      >\n        <IconTask fill=\"currentColor\" className={cn(styles.icon)} />\n      </Button>\n    </Tooltip>\n  );\n}\n\nconst LIST_MAP = {\n  ol: {\n    Icon: IconNumberList,\n    tooltip: 'Numbered List',\n  },\n  ul: {\n    Icon: IconBulletList,\n    tooltip: 'Bullet List',\n  },\n};\n\nfunction ListButton({\n  editor,\n  listType,\n  setVisible,\n}: {\n  editor: Editor;\n  listType: 'ul' | 'ol';\n  setVisible: (visible: boolean) => void;\n}) {\n  const styles = useStyles();\n  const list = useMemo(() => LIST_MAP[listType], [listType]);\n  const { selection } = editor;\n  const [el, path] = SelectionUtils.extractSingleElement(editor, selection);\n\n  const isParagraph =\n    path && Path.isChild(path, []) && el && el.tagName === 'p';\n  const onClick = (e: MouseEvent) => {\n    e.preventDefault();\n    // const nodes = Editor.nodes(editor, {\n    //   at: selection,\n    //   mode: 'highest',\n    //   match: n => !Editor.isEditor(n),\n    // });\n    // for (const [node, path] of nodes) {\n    ListUtils.setList(editor, path!, listType);\n    // }\n  };\n  useEffect(() => {\n    setVisible(isParagraph === true);\n  }, [isParagraph, setVisible]);\n  if (!isParagraph) {\n    return null;\n  }\n  return (\n    <Tooltip text={list.tooltip}>\n      <Button className={cn(styles.menuButton)} onClick={onClick}>\n        <list.Icon fill=\"currentColor\" className={cn(styles.icon)} />\n      </Button>\n    </Tooltip>\n  );\n}\n\nexport const FloatingMenu = React.memo(\n  ({ rootManager }: { rootManager: VertexManager<Note> }) => {\n    const styles = useStyles();\n    const editor = useSlate();\n    // const focused = useThrottledFocused();\n    const [listsVisible, setListsVisible] = useState<\n      [boolean, boolean, boolean]\n    >([false, false, false]);\n\n    const setVisible = (index: number, visible: boolean) => {\n      setListsVisible((current) => {\n        const v = current.concat();\n        if (v[index] === visible) {\n          return current;\n        }\n        v[index] = visible;\n        return v as [boolean, boolean, boolean];\n      });\n    };\n\n    const handleClick = (e: MouseEvent) => {\n      e.stopPropagation();\n      e.preventDefault();\n      ReactEditor.focus(editor);\n    };\n    const marks = Editor.marks(editor) || {};\n\n    const showSeparator = listsVisible.some((x) => x);\n\n    return (\n      <div className={cn(styles.menu, styles.visible)} onClick={handleClick}>\n        <HeaderButton editor={editor} headerType=\"h1\" />\n        <HeaderButton editor={editor} headerType=\"h2\" />\n        <div className={cn(styles.separator)} />\n        <BoldButton marks={marks} />\n        <ItalicButton marks={marks} />\n        <UnderlineButton marks={marks} />\n        <StrikethroughButton marks={marks} />\n        {showSeparator && <div className={cn(styles.separator)} />}\n        <ListButton\n          editor={editor}\n          listType=\"ol\"\n          setVisible={(x) => setVisible(0, x)}\n        />\n        <ListButton\n          editor={editor}\n          listType=\"ul\"\n          setVisible={(x) => setVisible(1, x)}\n        />\n        <TaskButton\n          isVisible={true}\n          rootManager={rootManager}\n          setVisible={(x) => setVisible(2, x)}\n        />\n      </div>\n    );\n  }\n);\n", "{\n  \"en\": {\n    \"createTaskCta\": \"Type '-' and hit 'Space' to create a task\",\n    \"CreateTaskTitle\": \"Add a task\",\n    \"CreateTaskText\": \"Add an action item to your note by typing '-' and hitting 'Space'\"\n  }\n}", "import React from 'https://esm.sh/react@18.2.0';\nimport { Editor, Node } from 'https://esm.sh/slate@0.87.0';\nimport { useSlate } from 'https://esm.sh/slate-react@0.87.1';\nimport {\n  makeStyles,\n  cn,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { Text } from '../../../../../../../styles/components/texts.tsx';\nimport { styleguide } from '../../../../../../../styles/styleguide.ts';\nimport { ElementUtils } from '../../../../../core/slate/utils/element-utils.ts';\nimport { CardElement } from '../../../../../core/slate/elements/card.element/index.tsx';\nimport { createUseStrings } from '../../../../../core/localization/index.tsx';\nimport localization from './body-editor.strings.json' assert { type: 'json' };\n\nconst useStyles = makeStyles((theme) => ({\n  placeholder: {\n    marginTop: styleguide.gridbase,\n    height: styleguide.gridbase * 3,\n    lineHeight: `${styleguide.gridbase * 3}px `,\n    color: 'rgba(17, 8, 43, 0.3)',\n    userSelect: 'none',\n  },\n}));\n\nconst useStrings = createUseStrings(localization);\n\nfunction shouldShowPlaceholder(editor: Editor) {\n  if (editor.children.length === 1 && !Node.string(editor)) {\n    return false;\n  }\n\n  const [node] = ElementUtils.findNode(editor, CardElement.isCard);\n  return !node;\n}\n\ninterface TaskCtaProps {\n  onClick?: () => void;\n}\n\nexport default function TaskCtaView({ onClick = () => {} }: TaskCtaProps) {\n  const styles = useStyles();\n  const editor = useSlate();\n  const strings = useStrings();\n\n  if (!shouldShowPlaceholder(editor)) {\n    return null;\n  }\n\n  return (\n    <div className={cn(styles.placeholder)} onClick={onClick}>\n      <Text>{strings.createTaskCta}</Text>\n    </div>\n  );\n}\n", "import React, {\n  MouseEvent,\n  useImperativeHandle,\n} from 'https://esm.sh/react@18.2.0';\nimport { Node } from 'https://esm.sh/slate@0.87.0';\nimport { Editable, Slate } from 'https://esm.sh/slate-react@0.87.1';\nimport { VertexManager } from '../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport { Note } from '../../../../../../../cfds/client/graph/vertices/note.ts';\nimport { usePartialVertex } from '../../../../../core/cfds/react/vertex.ts';\nimport { useBodyEditor } from '../../../../../core/slate/index.tsx';\nimport { EditableCardContext } from '../../../../../core/slate/elements/card.element/index.tsx';\nimport { SelectionUtils } from '../../../../../core/slate/utils/selection-utils.ts';\nimport { styleguide } from '../../../../../../../styles/styleguide.ts';\nimport {\n  makeStyles,\n  cn,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { FocusReporter } from '../focus-reporter.tsx';\nimport { FloatingMenu } from './floating-menu.tsx';\nimport TaskCtaView from './task-cta-view.tsx';\nimport { useLogger } from '../../../../../core/cfds/react/logger.tsx';\n\nconst useStyles = makeStyles((theme) => ({\n  editor: {\n    margin: '0 auto',\n    boxSizing: 'border-box',\n    '::selection': {\n      backgroundColor: theme.primary[500],\n    },\n    '& *': {\n      '::selection': {\n        backgroundColor: theme.primary[400],\n      },\n    },\n    color: theme.background.text,\n  },\n  rtl: {\n    direction: 'rtl',\n    placeholder: {\n      right: styleguide.gridbase * 8,\n      left: 'unset',\n    },\n  },\n  placeholder: {\n    position: 'absolute',\n    top: 0,\n    left: styleguide.gridbase * 8,\n    color: 'rgba(17, 8, 43, 0.3)',\n    height: styleguide.gridbase * 3,\n    fontSize: styleguide.gridbase * 2,\n    lineHeight: `${styleguide.gridbase * 3}px`,\n    pointerEvents: 'none',\n  },\n}));\n\n// function Placeholder({ card }: { card: Note }) {\n//   const pcard = usePartialVertex(card, ['body', 'title']);\n//   const body = pcard.body;\n//   const title = pcard.title;\n\n//   // if (body.hasContent() || !title.hasContent()) {\n//   //   return null;\n//   // }\n\n//   return <div className={cn(styles.placeholder)}>Start writing here...</div>;\n// }\n\nfunction usePlaceholder(cardManager: VertexManager<Note>): string {\n  const { title } = usePartialVertex(cardManager, ['title']);\n  const text = Node.string(title.root as unknown as Node);\n  if (!text) {\n    return '';\n  }\n\n  return 'Start writing here';\n}\n\ninterface BodyProps {\n  cardManager: VertexManager<Note>;\n  className?: string;\n  isRtl?: boolean;\n}\nexport interface EditorHandle {\n  focus: () => void;\n}\n\nexport default React.forwardRef<EditorHandle, BodyProps>(function BodyView(\n  { cardManager, className, isRtl },\n  ref\n) {\n  const styles = useStyles();\n  const placeholder = usePlaceholder(cardManager);\n  const { editor, plugins, handlers } = useBodyEditor(cardManager);\n  const logger = useLogger();\n  useImperativeHandle(\n    ref,\n    () => ({\n      focus() {\n        SelectionUtils.focusAtEnd(editor);\n      },\n    }),\n    [editor]\n  );\n  const onCtaClick = () => {\n    logger.log({\n      severity: 'INFO',\n      event: 'Click',\n      source: 'editor:task-cta',\n      vertex: cardManager.key,\n    });\n    SelectionUtils.focusAtEnd(editor);\n  };\n\n  const onClick = (e: MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    if (!editor.selection) {\n      SelectionUtils.focusAtEnd(editor);\n    }\n  };\n\n  return (\n    <div\n      className={cn(className, styles.editor, isRtl && styles.rtl)}\n      onClick={onClick}\n    >\n      <React.StrictMode>\n        <EditableCardContext cardManager={cardManager}>\n          <Slate editor={editor} {...handlers}>\n            <FocusReporter cardManager={cardManager} source=\"editor:body\" />\n            <Editable\n              {...plugins}\n              tabIndex={1}\n              placeholder={placeholder}\n              // onFocus={e => {\n              //   if (!editor.selection) {\n              //     e.preventDefault();\n              //   }\n              // }}\n              onClick={(e) => e.stopPropagation()}\n            />\n            <FloatingMenu rootManager={cardManager} />\n            <TaskCtaView onClick={onCtaClick} />\n          </Slate>\n        </EditableCardContext>\n      </React.StrictMode>\n    </div>\n  );\n});\n", "import React, {\n  useState,\n  useEffect,\n  useRef,\n} from 'https://esm.sh/react@18.2.0';\nimport {\n  IconKeyboard,\n  IconClose,\n} from '../../../../../../styles/components/icons/index.ts';\nimport {\n  IconButton,\n  Button,\n} from '../../../../../../styles/components/buttons.tsx';\nimport {\n  makeStyles,\n  cn,\n  keyframes,\n} from '../../../../../../styles/css-objects/index.ts';\nimport { styleguide, layout } from '../../../../../../styles/index.ts';\nimport { H3, Text, Bold } from '../../../../../../styles/components/texts.tsx';\nimport Popper from '../../../../../../styles/components/popper.tsx';\nimport { isMacOS } from '../../../../utils.ts';\nimport { useLogger } from '../../../../core/cfds/react/logger.tsx';\n\nconst blinkAnim = keyframes((theme) => ({\n  from: {\n    backgroundColor: 'transparent',\n  },\n  to: {\n    backgroundColor: theme.primary[400],\n  },\n}));\n\nconst useStyles = makeStyles((theme) => ({\n  hintButton: {\n    position: 'absolute',\n    bottom: styleguide.gridbase * 2,\n    right: styleguide.gridbase * 2,\n  },\n  blink: {\n    animation: `2s ${blinkAnim} infinite linear alternate`,\n  },\n  header: {\n    borderBottom: '1px solid rgba(156, 178, 205, 0.6)',\n    height: styleguide.gridbase * 5,\n    marginTop: styleguide.gridbase * 4,\n    alignItems: 'center',\n    basedOn: [layout.row],\n  },\n  section: {\n    marginTop: styleguide.gridbase * 5,\n  },\n  shortcut: {\n    marginTop: styleguide.gridbase * 2.5,\n    basedOn: [layout.row, layout.centerCenter],\n  },\n  key: {\n    marginRight: styleguide.gridbase,\n    padding: [0, styleguide.gridbase],\n    borderRadius: 5,\n    boxSizing: 'border-box',\n    height: styleguide.gridbase * 3,\n    backgroundColor: '#e6e8eb',\n    basedOn: [layout.column, layout.centerCenter],\n    minWidth: styleguide.gridbase * 3,\n    ':last-child': {\n      marginRight: 0,\n    },\n  },\n  plus: {\n    marginRight: styleguide.gridbase,\n  },\n  legendBackdrop: {\n    position: 'absolute',\n    top: 0,\n    right: 0,\n    bottom: 0,\n    left: 0,\n  },\n  legend: {\n    position: 'absolute',\n    top: 0,\n    right: 0,\n    bottom: 0,\n    backgroundColor: theme.background[0],\n    width: '100%',\n    maxWidth: styleguide.gridbase * 45,\n    boxSizing: 'border-box',\n    padding: styleguide.gridbase * 4,\n    overflowY: 'auto',\n    ...styleguide.transition.standard,\n    transform: 'translateX(100%)',\n    boxShadow: theme.shadows.z2,\n  },\n  h1: {\n    fontWeight: '900',\n  },\n  h2: {\n    fontWeight: '500',\n  },\n  closeButton: {\n    position: 'absolute',\n    top: styleguide.gridbase * 2,\n    right: styleguide.gridbase * 2,\n    color: 'rgba(17, 8, 43, 0.6)',\n    basedOn: [layout.row, layout.centerCenter],\n  },\n  closeText: {\n    lineHeight: `${styleguide.gridbase * 2}px`,\n    marginRight: styleguide.gridbase,\n  },\n  open: {\n    transform: 'translateX(0)',\n  },\n  bold: {\n    fontWeight: 'bold',\n  },\n  italic: {\n    fontStyle: 'italic',\n  },\n  underline: {\n    textDecoration: 'underline',\n  },\n  strikethrough: {\n    textDecoration: 'line-through',\n  },\n  tooltip: {\n    position: 'relative',\n    backgroundColor: theme.background[0],\n    boxSizing: 'border-box',\n    width: styleguide.gridbase * 30,\n    padding: styleguide.gridbase * 2,\n    borderRadius: 6,\n    boxShadow: '0 8px 8px 0 rgba(0, 0, 0, 0.08), 0 0 8px 0 rgba(0, 0, 0, 0.12)',\n    basedOn: [layout.column],\n  },\n  tooltipClose: {\n    position: 'absolute',\n    top: styleguide.gridbase * 2,\n    right: styleguide.gridbase * 2,\n    width: styleguide.gridbase * 2,\n    height: styleguide.gridbase * 2,\n  },\n  tooltipIcon: {\n    width: styleguide.gridbase * 2,\n    height: styleguide.gridbase * 2,\n  },\n}));\n\nfunction mapKey(key: string) {\n  if (key !== 'Meta') {\n    return key;\n  }\n  if (isMacOS()) {\n    return '\u2318';\n  }\n  return 'Ctrl';\n}\n\ninterface ShortcutProps {\n  children: React.ReactNode;\n  keys: string[];\n  macOSKeys?: string[];\n}\nfunction Shortcut({ children, keys, macOSKeys }: ShortcutProps) {\n  const styles = useStyles();\n  let actualKeys = keys;\n  if (macOSKeys && isMacOS()) {\n    actualKeys = macOSKeys;\n  }\n\n  return (\n    <div className={cn(styles.shortcut)}>\n      {children}\n      <div className={cn(layout.flexSpacer)} />\n      {actualKeys.map((x, i) => {\n        const hasPlus = i < actualKeys.length - 1 && actualKeys[i + 1] !== x;\n        return (\n          <React.Fragment key={`${x}${i}`}>\n            <div className={cn(styles.key)}>\n              <Text>{mapKey(x)}</Text>\n            </div>\n            {hasPlus && <Text className={cn(styles.plus)}>+</Text>}\n          </React.Fragment>\n        );\n      })}\n    </div>\n  );\n}\n\ninterface LegendTooltipProps {\n  anchor: HTMLElement;\n  open: boolean;\n  onClose: React.MouseEventHandler<HTMLButtonElement>;\n}\n\nfunction LegendTooltip({ anchor, open, onClose }: LegendTooltipProps) {\n  const styles = useStyles();\n  return (\n    <Popper\n      position=\"top\"\n      direction=\"out\"\n      align=\"end\"\n      anchor={anchor}\n      open={open}\n    >\n      <div className={cn(styles.tooltip)}>\n        <Bold>Want to work fast?</Bold>\n        <Text>\n          Click here to open the keyboard shortcuts cheat-sheet in order to make\n          the most out of your work.\n        </Text>\n        <Button className={cn(styles.tooltipClose)} onClick={onClose}>\n          <IconClose className={cn(styles.tooltipIcon)} />\n        </Button>\n      </div>\n    </Popper>\n  );\n}\n\nenum LegendState {\n  Close,\n  Opening,\n  Open,\n  Closing,\n}\n\ninterface LegendViewProps {\n  legendState: LegendState;\n  changeState: (newState: LegendState) => void;\n  onClose: () => void;\n}\nfunction LegendView({ legendState, changeState, onClose }: LegendViewProps) {\n  const styles = useStyles();\n  useEffect(() => {\n    if (legendState === LegendState.Opening) {\n      changeState(LegendState.Open);\n    } else if (legendState === LegendState.Closing) {\n      setTimeout(() => {\n        changeState(LegendState.Close);\n      }, 500);\n    }\n  }, [legendState, changeState]);\n\n  if (legendState === LegendState.Close) {\n    return null;\n  }\n  return (\n    <React.Fragment>\n      {legendState === LegendState.Open && (\n        <div className={cn(styles.legendBackdrop)} onClick={onClose} />\n      )}\n      <div\n        className={cn(\n          styles.legend,\n          legendState === LegendState.Open && styles.open\n        )}\n      >\n        <Button className={cn(styles.closeButton)} onClick={onClose}>\n          <Text className={cn(styles.closeText)}>Close</Text>\n          <IconClose fill=\"#a09caa\" />\n        </Button>\n        <div className={cn(styles.header)}>\n          <Text>Keyboard Shortcuts</Text>\n        </div>\n        <div className={cn(styles.section)}>\n          <H3>Insert/Actions</H3>\n          <Shortcut keys={['-', 'Space']}>\n            <Text>Create a task</Text>\n          </Shortcut>\n          <Shortcut keys={['#hashtag']}>\n            <Text>Add a tag</Text>\n          </Shortcut>\n          <Shortcut keys={['@Name']}>\n            <Text>Assign a task</Text>\n          </Shortcut>\n        </div>\n        <div className={cn(styles.section)}>\n          <H3>Text Formatting</H3>\n          <Shortcut keys={['#', 'Space']}>\n            <Text>\n              <span className={cn(styles.h1)}>H1</span> headline\n            </Text>\n          </Shortcut>\n          <Shortcut keys={['#', '#', 'Space']}>\n            <Text>\n              <span className={cn(styles.h2)}>H2</span> headline\n            </Text>\n          </Shortcut>\n          <Shortcut keys={['Meta', 'b']}>\n            <Text className={cn(styles.bold)}>Bold</Text>\n          </Shortcut>\n          <Shortcut keys={['Meta', 'i']}>\n            <Text className={cn(styles.italic)}>italic</Text>\n          </Shortcut>\n          <Shortcut keys={['Meta', 'u']}>\n            <Text className={cn(styles.underline)}>Underline</Text>\n          </Shortcut>\n          <Shortcut keys={['Meta', 's']}>\n            <Text className={cn(styles.strikethrough)}>Strikethrough</Text>\n          </Shortcut>\n          <Shortcut keys={['*', 'Space']}>\n            <Text>Bullet List</Text>\n          </Shortcut>\n          <Shortcut keys={['1.', 'Space']}>\n            <Text>Numbered List</Text>\n          </Shortcut>\n        </div>\n      </div>\n    </React.Fragment>\n  );\n}\n\nfunction shouldBeOpen() {\n  const didClick = window.localStorage.getItem('did_dismiss_legend');\n  return !didClick;\n}\n\nexport default function LegendButton() {\n  const styles = useStyles();\n  const anchor = useRef(null);\n  const [showTooltip, setShowTooltip] = useState(false);\n  const [legendState, setLegendState] = useState(LegendState.Close);\n\n  const logger = useLogger();\n  useEffect(() => {\n    const t = setTimeout(() => {\n      if (shouldBeOpen()) {\n        setShowTooltip(true);\n      }\n    }, 2000);\n    return () => {\n      clearTimeout(t);\n    };\n  }, []);\n  const click = () => {\n    logger.log({\n      severity: 'INFO',\n      event: 'Navigation',\n      type: 'open',\n      source: 'editor:legend',\n    });\n\n    setShowTooltip(false);\n    setLegendState(LegendState.Opening);\n  };\n\n  const onClose = () => {\n    logger.log({\n      severity: 'INFO',\n      event: 'Navigation',\n      type: 'close',\n      source: 'editor:legend',\n    });\n    localStorage.setItem('did_dismiss_legend', Date.now() + '');\n    setLegendState(LegendState.Closing);\n  };\n\n  const hideTooltip = () => {\n    logger.log({\n      severity: 'INFO',\n      event: 'Navigation',\n      type: 'close',\n      source: 'editor:tooltip',\n    });\n    window.localStorage.setItem('did_dismiss_legend', Date.now() + '');\n    setShowTooltip(false);\n  };\n\n  const changeState = (newState: LegendState) => {\n    setLegendState(newState);\n  };\n\n  return (\n    <div>\n      <IconButton\n        ref={anchor}\n        className={cn(styles.hintButton)}\n        onClick={click}\n      >\n        <IconKeyboard />\n      </IconButton>\n      <LegendTooltip\n        anchor={anchor.current!}\n        open={showTooltip}\n        onClose={hideTooltip}\n      />\n      <LegendView\n        legendState={legendState}\n        changeState={changeState}\n        onClose={onClose}\n      />\n    </div>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { IconProps, IconSize } from './types.ts';\n\nexport function IconContent({ className, size = IconSize.Small }: IconProps) {\n  return (\n    <svg\n      width={size}\n      height={size}\n      viewBox=\"0 0 17 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        opacity=\"0.6\"\n        d=\"M3.99832 6.31999H13.9983\"\n        stroke=\"#3F3F3F\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M3.99832 2.98673H13.9983\"\n        stroke=\"#8C8C8C\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M3.99832 9.65348H13.9983\"\n        stroke=\"#8C8C8C\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M3.99832 12.9867H13.9983\"\n        stroke=\"#262626\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n    </svg>\n  );\n}\n", "import React, { useCallback, useMemo } from 'https://esm.sh/react@18.2.0';\nimport { VertexManager } from '../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport {\n  Tag,\n  Workspace,\n} from '../../../../../../../cfds/client/graph/vertices/index.ts';\nimport { usePartialVertex } from '../../../../../core/cfds/react/vertex.ts';\nimport {\n  Pill,\n  PillStyle,\n  PillContent,\n  PillAction,\n} from '../../../../../shared/pill/index.tsx';\nimport TagButton from '../../../../../shared/tags/tag-button.tsx';\nimport TagView from '../../../../../shared/tags/tag-view.tsx';\nimport { styleguide, layout } from '../../../../../../../styles/index.ts';\nimport { IconDropDownArrow } from '../../../../../../../styles/components/icons/index.ts';\nimport { Text } from '../../../../../../../styles/components/texts.tsx';\nimport {\n  makeStyles,\n  cn,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { CardHeaderPartProps, CardSize } from './index.tsx';\nimport { useLogger } from '../../../../../core/cfds/react/logger.tsx';\nimport { coreValueCompare } from '../../../../../../../base/core-types/comparable.ts';\n\nconst useStyles = makeStyles((theme) => ({\n  tagsView: {\n    // height: styleguide.gridbase * 3,\n    alignItems: 'center',\n    basedOn: [layout.row],\n  },\n  tagsWrap: {\n    flexWrap: 'wrap',\n    alignItems: 'flex-start',\n    marginBottom: styleguide.gridbase,\n    tag: {\n      marginBottom: styleguide.gridbase,\n    },\n  },\n  tag: {\n    marginRight: styleguide.gridbase * 0.5,\n  },\n  hide: {\n    opacity: 0,\n  },\n}));\n\ninterface TagPillProps {\n  tag: VertexManager<Tag>;\n  setTag: (tag: VertexManager<Tag>) => void;\n  isExpanded: boolean;\n  onDelete: () => void;\n}\n\nfunction TagPill({ tag, setTag, onDelete, isExpanded }: TagPillProps) {\n  const styles = useStyles();\n  const { name } = usePartialVertex(tag, ['name']);\n  const renderSelected = useCallback(\n    () => (\n      <Pill\n        className={cn(styles.tag)}\n        extended={isExpanded}\n        pillStyle={isExpanded ? PillStyle.Border : PillStyle.None}\n      >\n        <PillContent>\n          <Text>#{name}</Text>\n        </PillContent>\n        <PillAction>\n          <IconDropDownArrow />\n        </PillAction>\n      </Pill>\n    ),\n    [name, isExpanded, styles]\n  );\n\n  return (\n    <TagView\n      key={tag.key}\n      tag={tag}\n      onDelete={onDelete}\n      renderSelected={renderSelected}\n      onSelected={(tag: Tag) => setTag(tag.manager as VertexManager<Tag>)}\n    />\n  );\n}\n\nexport function CardTags({\n  card,\n  size,\n  isExpanded,\n  source,\n}: CardHeaderPartProps) {\n  const { tags, workspace } = usePartialVertex(card, ['tags', 'workspace']);\n  const styles = useStyles();\n  const logger = useLogger();\n  const cardTags = Array.from(tags.values()).filter(\n    (tag) =>\n      !tag.isNull &&\n      !tag.isDeleted &&\n      (!tag.parentTag || !tag.parentTag.isDeleted)\n  );\n\n  // const tagManagers = useMemo(\n  //   () =>\n  //     new Map(\n  //       Array.from(tags.entries()).map(([parent, child]) => [\n  //         parent.manager as VertexManager<Tag>,\n  //         child.manager as VertexManager<Tag>,\n  //       ])\n  //     ),\n  //   [tags]\n  // );\n\n  const onDelete = useCallback(\n    (tagManager: VertexManager<Tag>) => {\n      const tag = tagManager.getVertexProxy();\n      const proxy = card.getVertexProxy();\n      const newTags = proxy.tags;\n      const tagToDelete = tag.parentTag || tag;\n      newTags.delete(tagToDelete);\n      proxy.tags = newTags;\n\n      logger.log({\n        severity: 'INFO',\n        event: 'MetadataChanged',\n        type: 'tag',\n        removed: tag.key,\n        vertex: card.key,\n        source,\n      });\n    },\n    [card, logger]\n  );\n\n  const onTag = useCallback(\n    (tagManager: VertexManager<Tag>) => {\n      const proxy = card.getVertexProxy();\n      const tag = tagManager.getVertexProxy();\n      const newTags = proxy.tags;\n\n      const tagKey = tag.parentTag || tag;\n\n      const currentTag = newTags.get(tagKey);\n      newTags.set(tagKey, tag);\n      proxy.tags = newTags;\n\n      logger.log({\n        severity: 'INFO',\n        event: 'MetadataChanged',\n        type: 'tag',\n        vertex: card.key,\n        removed: currentTag?.key,\n        added: tag.key,\n        source,\n      });\n    },\n    [card, logger]\n  );\n\n  return (\n    <div\n      className={cn(\n        styles.tagsView,\n        size === CardSize.Small && styles.tagsWrap\n      )}\n    >\n      {cardTags.sort(coreValueCompare).map((tag) => (\n        <TagPill\n          key={tag.key}\n          tag={tag.manager as VertexManager<Tag>}\n          onDelete={() => onDelete(tag.manager as VertexManager<Tag>)}\n          setTag={onTag}\n          isExpanded={isExpanded}\n        />\n      ))}\n      <TagButton\n        onTagged={(t) => onTag(t.manager as VertexManager<Tag>)}\n        noteId={card}\n        className={cn(!isExpanded && styles.hide)}\n      />\n    </div>\n  );\n}\n", "import { assert } from '../../../../base/error.ts';\nimport { duplicateCard } from '../../../../cfds/client/duplicate.ts';\nimport { GraphManager } from '../../../../cfds/client/graph/graph-manager.ts';\nimport { VertexManager } from '../../../../cfds/client/graph/vertex-manager.ts';\nimport {\n  Note,\n  Tag,\n  Workspace,\n} from '../../../../cfds/client/graph/vertices/index.ts';\nimport { UISource } from '../../../../logging/client-events.ts';\nimport { Logger } from '../../../../logging/log.ts';\n\n/**\n * This function recursively for this card down, looks for tags that are not\n * in the card's workspace, and either matches them with the correct tags or\n * removes them.\n *\n * @param card The root card.\n */\n// function fixupCardTagsToWorkspace(card: Note): void {\n//   const workspace = card.workspace;\n//   for (const [parent, child] of Array.from(card.tags.entries())) {\n//     // Skip tags that are in our card's workspace\n//     if (parent.workspace === workspace) {\n//       assert(child.workspace === workspace); // Sanity check\n//       continue;\n//     }\n\n//     // Found a parent that's not a part of our workspace. Try to match it with\n//     // a tag that is\n//     const matchingTags = matchTagsToWorkspace(parent, child, workspace);\n//     const newTags = card.tags;\n//     newTags.delete(parent);\n//     if (matchingTags !== undefined) {\n//       newTags.set(matchingTags[0], matchingTags[1]);\n//     }\n//     card.tags = newTags;\n//   }\n//   for (const childCard of card.childCards) {\n//     fixupCardTagsToWorkspace(childCard);\n//   }\n// }\n\n/**\n * Given a parent / child tags pair, this method looks  for a matching pair\n * in the given workspace.\n *\n * @returns A [parent, child] pair or undefined if no match is found.\n */\n// function matchTagsToWorkspace(\n//   parentTag: Tag,\n//   childTag: Tag,\n//   workspace: Workspace\n// ): [Tag, Tag] | undefined {\n//   const crossWsParentKey = crossWorkspaceTagKey(parentTag);\n//   const crossWsChildKey = crossWorkspaceTagKey(childTag);\n//   for (const parent of workspace.parentTags) {\n//     if (crossWsParentKey === crossWorkspaceTagKey(parent)) {\n//       for (const child of parent.childTags) {\n//         if (crossWsChildKey === crossWorkspaceTagKey(child)) {\n//           return [parent, child];\n//         }\n//       }\n//     }\n//   }\n//   return undefined;\n// }\n\nfunction stripAssigneesNotInWorkspace(card: Note): void {\n  const wsUsers = card.workspace.users;\n  const newAssignees = new Set(card.assignees);\n  for (const u of card.assignees) {\n    if (!wsUsers.has(u)) {\n      newAssignees.delete(u);\n    }\n  }\n  card.assignees = newAssignees;\n  for (const child of card.childCards) {\n    stripAssigneesNotInWorkspace(child);\n  }\n}\n\nexport function moveCard(\n  cardManager: VertexManager<Note>,\n  destinationMng: VertexManager<Workspace>,\n  graph: GraphManager,\n  logger: Logger,\n  source: UISource\n): Note | undefined {\n  const result = duplicateCard(graph, cardManager.key, {\n    suffix: '',\n  });\n\n  if (result !== undefined) {\n    result.workspace = destinationMng.getVertexProxy();\n    // fixupCardTagsToWorkspace(result);\n    stripAssigneesNotInWorkspace(result);\n    cardManager.getVertexProxy().isDeleted = 1;\n    logger.log({\n      severity: 'INFO',\n      event: 'VertexMoved',\n      vertex: result.key,\n      origin: cardManager.key,\n      uiSource: source,\n    });\n  } else {\n    logger.log({\n      severity: 'INFO',\n      error: 'DuplicateFailed',\n      vertex: cardManager.key,\n      uiSource: source,\n    });\n  }\n  return result;\n}\n", "import React, {\n  useCallback,\n  useRef,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport { useNavigate } from 'https://esm.sh/react-router@6.7.0';\nimport { VertexManager } from '../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport {\n  Note,\n  User,\n  Workspace,\n} from '../../../../../../../cfds/client/graph/vertices/index.ts';\nimport { sortStampCompare } from '../../../../../../../cfds/client/sorting.ts';\nimport { layout, styleguide } from '../../../../../../../styles/index.ts';\nimport {\n  Button,\n  RaisedButton,\n} from '../../../../../../../styles/components/buttons.tsx';\nimport {\n  Dialog,\n  DialogActions,\n  DialogContent,\n} from '../../../../../../../styles/components/dialog/index.tsx';\nimport { IconDropDownArrow } from '../../../../../../../styles/components/icons/index.ts';\nimport Menu, {\n  MenuItem,\n} from '../../../../../../../styles/components/menu.tsx';\nimport { H2, Text } from '../../../../../../../styles/components/texts.tsx';\nimport { useToastController } from '../../../../../../../styles/components/toast/index.tsx';\nimport {\n  cn,\n  keyframes,\n  makeStyles,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { useTheme } from '../../../../../../../styles/theme.tsx';\nimport {\n  useGraphManager,\n  useRootUser,\n} from '../../../../../core/cfds/react/graph.tsx';\nimport {\n  useCurrentUser,\n  usePartialVertex,\n  useVertices,\n} from '../../../../../core/cfds/react/vertex.ts';\nimport { useAnimateWidth } from '../../../../../core/react-utils/animate.ts';\nimport { Scroller } from '../../../../../core/react-utils/scrolling.tsx';\nimport { moveCard } from '../../../../../shared/utils/move.ts';\nimport WorkspaceIcon from '../../../../../shared/workspace-icon/index.tsx';\nimport { UISource } from '../../../../../../../logging/client-events.ts';\nimport { useLogger } from '../../../../../core/cfds/react/logger.tsx';\nimport { coreValueCompare } from '../../../../../../../base/core-types/comparable.ts';\nimport { useSharedQuery } from '../../../../../core/cfds/react/query.ts';\n\nconst showAnim = keyframes({\n  '0%': {\n    opacity: 0,\n  },\n  '99%': {\n    opacity: 0,\n  },\n  '100%': {\n    opacity: 1,\n  },\n});\n\nconst useStyles = makeStyles((theme) => ({\n  workspaceItem: {\n    alignItems: 'center',\n    basedOn: [layout.row],\n  },\n  indicatorButton: {\n    ...styleguide.transition.short,\n    transitionProperty: 'all',\n  },\n  wsName: {\n    marginLeft: styleguide.gridbase,\n    marginRight: styleguide.gridbase * 0.5,\n    whiteSpace: 'nowrap',\n    color: theme.background.placeholderText,\n  },\n  wsSeparator: {\n    alignSelf: 'center',\n    height: styleguide.gridbase * 2,\n    width: 1,\n    backgroundColor: theme.background.placeholderText,\n    opacity: 0.7,\n    marginRight: styleguide.gridbase,\n    marginLeft: styleguide.gridbase * 0.5,\n  },\n  wsArrow: {\n    position: 'relative',\n    top: 1,\n    animation: `${showAnim} ${styleguide.transition.duration.short}ms backwards linear`,\n    cursor: 'pointer',\n  },\n  hide: {\n    display: 'none',\n  },\n  dialogTitle: {\n    marginBottom: styleguide.gridbase * 2,\n  },\n  move: {\n    overflowY: 'auto',\n    maxHeight: styleguide.gridbase * 32,\n  },\n  moveWsItem: {\n    backgroundColor: theme.background[0],\n    transition: `opacity linear ${styleguide.transition.duration.short}ms`,\n    ':hover': {\n      backgroundColor: theme.background[300],\n    },\n  },\n  selectedWs: {\n    backgroundColor: theme.background[400],\n  },\n}));\n\nexport type WorkspaceIndicatorButtonProps = Omit<\n  WorkspaceIndicatorProps,\n  'setWorkspace'\n>;\n\nfunction WorkspaceIndicatorButton({\n  workspace,\n  isExpanded,\n  className,\n  readOnly,\n}: WorkspaceIndicatorButtonProps) {\n  const styles = useStyles();\n  const { name } = usePartialVertex(workspace, ['name']);\n  const ref = useRef(null);\n  const style = useAnimateWidth(ref, isExpanded);\n  const theme = useTheme();\n\n  return (\n    <div\n      className={cn(styles.workspaceItem, styles.indicatorButton, className)}\n      ref={ref}\n      style={style}\n    >\n      <WorkspaceIcon\n        workspaceManager={workspace}\n        size={styleguide.gridbase * 2.75}\n      />\n      <Text className={cn(styles.wsName)}>{name}</Text>\n      {readOnly !== true && (\n        <div className={cn(styles.wsArrow, !isExpanded && styles.hide)}>\n          <IconDropDownArrow fill={theme.background.placeholderText} />\n        </div>\n      )}\n      <div className={cn(styles.wsSeparator)} />\n    </div>\n  );\n}\n\ninterface CardWorkspaceIndicatorProps {\n  card: VertexManager<Note>;\n  isExpanded: boolean;\n  source: UISource;\n  className?: string;\n}\n\nexport function CardWorkspaceIndicator({\n  card,\n  isExpanded,\n  source,\n  className,\n}: CardWorkspaceIndicatorProps) {\n  const { workspace } = usePartialVertex(card, ['workspace']);\n  const workspaceManager = workspace?.manager as VertexManager<Workspace>;\n  const graph = useGraphManager();\n  const toastController = useToastController();\n  const logger = useLogger();\n  const navigate = useNavigate();\n\n  if (!workspaceManager) {\n    return null;\n  }\n\n  const onMove = (ws: VertexManager<Workspace>) => {\n    const newCard = moveCard(card, ws, graph, logger, source);\n    if (!newCard) {\n      toastController.displayToast({\n        text: `Move failed. Try again later`,\n        duration: 1500,\n      });\n      return;\n    }\n    toastController.displayToast({\n      text: `Card moved to ${ws.getVertexProxy().name}`,\n      duration: 1500,\n    });\n\n    if (source === 'title') {\n      navigate(`/${newCard.workspace.key}/${newCard.key}`);\n    }\n  };\n\n  return (\n    <WorkspaceIndicator\n      workspace={workspaceManager}\n      setWorkspace={onMove}\n      className={className}\n      isExpanded={isExpanded}\n      readOnly={false}\n    />\n  );\n}\n\nexport interface WorkspaceIndicatorProps {\n  workspace: VertexManager<Workspace>;\n  setWorkspace: (workspace: VertexManager<Workspace>) => void;\n  isExpanded: boolean;\n  className?: string;\n  readOnly?: boolean;\n  menuClassName?: string;\n  ButtonComponent?: React.ComponentType<WorkspaceIndicatorButtonProps>;\n  validateMove?: boolean;\n}\n\nexport function WorkspaceIndicator({\n  workspace,\n  setWorkspace,\n  isExpanded,\n  className,\n  readOnly,\n  menuClassName,\n  ButtonComponent = WorkspaceIndicatorButton,\n  validateMove = true,\n}: WorkspaceIndicatorProps) {\n  const renderButton = useCallback(\n    () => (\n      <ButtonComponent\n        workspace={workspace}\n        className={className}\n        isExpanded={isExpanded}\n        readOnly={readOnly}\n      />\n    ),\n    [workspace, className, isExpanded, readOnly, ButtonComponent]\n  );\n\n  const [changeTo, setChangeTo] = useState<VertexManager<Workspace> | null>(\n    null\n  );\n  const onWsChanged = (ws: VertexManager<Workspace>) => {\n    if (validateMove) {\n      setChangeTo(ws);\n    } else {\n      setWorkspace(ws);\n    }\n  };\n\n  const onMove = () => {\n    setWorkspace(changeTo!);\n    setChangeTo(null);\n  };\n\n  if (readOnly) {\n    return renderButton();\n  }\n\n  return (\n    <React.Fragment>\n      <Menu\n        className={menuClassName}\n        renderButton={renderButton}\n        align=\"start\"\n        position=\"top\"\n      >\n        <SelectWorkspaceMenu value={workspace} onChange={onWsChanged} />\n      </Menu>\n      <MoveWorkspaceDialog\n        isOpen={!!changeTo}\n        close={() => setChangeTo(null)}\n        onMove={onMove}\n      />\n    </React.Fragment>\n  );\n}\n\nexport function sortWorkspaces(\n  ws1: Workspace,\n  ws2: Workspace,\n  pinnedWorkspaces: Set<string>,\n  hiddenWorkspaces: Set<string>\n) {\n  if (pinnedWorkspaces.has(ws1.key) && !pinnedWorkspaces.has(ws2.key)) {\n    return -1;\n  }\n  if (!pinnedWorkspaces.has(ws1.key) && pinnedWorkspaces.has(ws2.key)) {\n    return 1;\n  }\n\n  if (hiddenWorkspaces.has(ws1.key) && !hiddenWorkspaces.has(ws2.key)) {\n    return 1;\n  }\n  if (!hiddenWorkspaces.has(ws1.key) && hiddenWorkspaces.has(ws2.key)) {\n    return -1;\n  }\n\n  return coreValueCompare(ws1, ws2);\n}\n\nexport interface SelectWorkspaceMenuProps {\n  value: VertexManager<Workspace> | null;\n  onChange: (wsMng: VertexManager<Workspace>) => void;\n}\nexport function SelectWorkspaceMenu({\n  value,\n  onChange,\n}: SelectWorkspaceMenuProps) {\n  const styles = useStyles();\n  const graph = useGraphManager();\n  const user = useCurrentUser();\n  const { hiddenWorkspaces, pinnedWorkspaces } = usePartialVertex(\n    user.settings,\n    ['hiddenWorkspaces', 'pinnedWorkspaces']\n  );\n  const workspacesQuery = useSharedQuery('workspaces');\n  const workspaces = useVertices(workspacesQuery.results);\n  const sortedWorkspaces = Array.from(workspaces)\n    .filter((x) => !!x.name)\n    .sort((ws1, ws2) =>\n      sortWorkspaces(ws1, ws2, pinnedWorkspaces, hiddenWorkspaces)\n    );\n  const onSelect = (wsMng: VertexManager<Workspace>) => {\n    if (value && wsMng.key === value.key) {\n      return;\n    }\n    onChange(wsMng);\n  };\n  return (\n    <Scroller>\n      {(ref) => (\n        <div ref={ref} className={cn(styles.move)}>\n          {sortedWorkspaces.map((ws) => (\n            <MenuItem\n              key={ws.key}\n              className={cn(\n                styles.workspaceItem,\n                styles.moveWsItem,\n                value?.key === ws.key && styles.selectedWs\n              )}\n              onClick={() => onSelect(ws.manager as VertexManager<Workspace>)}\n            >\n              <WorkspaceIcon\n                workspaceManager={ws.manager as VertexManager<Workspace>}\n                size={styleguide.gridbase * 2.75}\n              />\n              <Text className={cn(styles.wsName)}>{ws.name}</Text>\n            </MenuItem>\n          ))}\n        </div>\n      )}\n    </Scroller>\n  );\n}\n\ninterface MoveWorkspaceDialogProps {\n  onMove: () => void;\n  close: () => void;\n  isOpen: boolean;\n}\nfunction MoveWorkspaceDialog({\n  onMove,\n  close,\n  isOpen,\n}: MoveWorkspaceDialogProps) {\n  const styles = useStyles();\n  return (\n    <Dialog open={isOpen} onClose={close} onClickOutside={close}>\n      <DialogContent>\n        <H2 className={cn(styles.dialogTitle)}>Are you sure?</H2>\n        <Text>\n          Moving this card will move all of its children and will remove tags\n          that don't exist in the destination workspace\n        </Text>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={close}>Cancel</Button>\n        <RaisedButton onClick={onMove}>Move</RaisedButton>\n      </DialogActions>\n    </Dialog>\n  );\n}\n", "import React, {\n  useCallback,\n  useRef,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport {\n  Editable,\n  RenderElementProps,\n  Slate,\n} from 'https://esm.sh/slate-react@0.87.1';\nimport { VertexManager } from '../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport {\n  Note,\n  NoteType,\n} from '../../../../../../../cfds/client/graph/vertices/note.ts';\nimport { usePartialVertex } from '../../../../../core/cfds/react/vertex.ts';\nimport { useDocumentRouter } from '../../../../../core/react-utils/index.ts';\nimport { useAnimateHeight } from '../../../../../core/react-utils/animate.ts';\nimport { useTitleEditor } from '../../../../../core/slate/index.tsx';\nimport CardMenuView from '../../../../../shared/item-menu/index.tsx';\nimport AssigneesView from '../../../../../shared/card/assignees-view.tsx';\nimport { layout, styleguide } from '../../../../../../../styles/index.ts';\nimport { IconExpander } from '../../../../../../../styles/components/icons/index.ts';\nimport { CheckBox } from '../../../../../../../styles/components/inputs/index.ts';\nimport { Text } from '../../../../../../../styles/components/texts.tsx';\nimport {\n  makeStyles,\n  cn,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { useTheme } from '../../../../../../../styles/theme.tsx';\nimport { CardFooter } from './card-footer.tsx';\nimport { CardTags } from './card-tag-view.tsx';\nimport { CardWorkspaceIndicator } from './workspace-indicator.tsx';\nimport { UISource } from '../../../../../../../logging/client-events.ts';\nimport { useLogger } from '../../../../../core/cfds/react/logger.tsx';\n\nconst TITLE_LINE_HEIGHT = styleguide.gridbase * 3;\n\nexport enum CardSize {\n  Regular = 'regular',\n  Small = 'small',\n}\n\nfunction getStrikethroughSVG(fill: string) {\n  return encodeURIComponent(\n    `\n  <svg xmlns='http://www.w3.org/2000/svg' \n    width='${TITLE_LINE_HEIGHT}' \n    height='${TITLE_LINE_HEIGHT}'\n    viewBox='0 0 ${TITLE_LINE_HEIGHT} ${TITLE_LINE_HEIGHT}'>\n    <line x1='0' y1='${TITLE_LINE_HEIGHT / 2}' x2='${TITLE_LINE_HEIGHT}' y2='${\n      TITLE_LINE_HEIGHT / 2\n    }' stroke='${fill}'/>\n  </svg>\n  `.replace(/\\n/g, '')\n  );\n}\n\nconst useStyles = makeStyles((theme) => ({\n  cardContainer: {\n    position: 'relative',\n  },\n  expander: {\n    position: 'absolute',\n    cursor: 'pointer',\n    top: styleguide.gridbase,\n    left: 0,\n    transform: `translateX(calc(-100% - ${styleguide.gridbase * 0.5}px))`,\n  },\n  expanderIcon: {\n    ...styleguide.transition.short,\n    transitionProperty: 'transform',\n    transform: 'rotate(0)',\n  },\n  expanderIconExpanded: {\n    transform: 'rotate(180deg)',\n  },\n  card: {\n    backgroundColor: theme.background[0],\n    cursor: 'pointer',\n    padding: styleguide.gridbase,\n    boxSizing: 'border-box',\n    boxShadow: theme.shadows.z2,\n    borderRadius: 6,\n    basedOn: [layout.column],\n  },\n  [CardSize.Regular]: {\n    preview: {\n      paddingRight: styleguide.gridbase * 12,\n    },\n  },\n  [CardSize.Small]: {},\n  taskCard: {\n    preview: {\n      // marginLeft: styleguide.gridbase * 4.5,\n    },\n  },\n  header: {\n    position: 'relative',\n    alignItems: 'center',\n    flexWrap: 'wrap',\n    marginBottom: styleguide.gridbase,\n    basedOn: [layout.row],\n  },\n  menu: {\n    opacity: 0,\n    transition: `${styleguide.transition.duration.short}ms linear opacity`,\n  },\n  menuVisible: {\n    opacity: 1,\n  },\n  titleRow: {\n    alignItems: 'flex-start',\n    basedOn: [layout.row],\n  },\n  titleTextContainer: {\n    // padding: [0, styleguide.gridbase * 0],\n    position: 'relative',\n  },\n  strikethrough: {\n    width: '100%',\n    position: 'absolute',\n    left: '0',\n    top: '0',\n    height: '100%',\n    // height: 1,\n    // top: '50%',\n    // backgroundColor: theme.background.text,\n    ...styleguide.transition.short,\n    transitionProperty: 'transform',\n    transform: 'scale(0)',\n    transformOrigin: 'left center',\n    backgroundImage: `url(\"data:image/svg+xml;utf8,${getStrikethroughSVG(\n      theme.background.text\n    )}\")`,\n  },\n  strikethroughDone: {\n    transform: 'scale(1)',\n  },\n  checkboxPlaceholder: {\n    width: styleguide.gridbase * 3,\n    height: styleguide.gridbase * 3,\n  },\n  status: {\n    marginRight: styleguide.gridbase,\n    height: styleguide.gridbase * 3,\n    width: styleguide.gridbase * 3,\n    basedOn: [layout.column, layout.centerCenter],\n  },\n  titleText: {\n    fontSize: 16,\n    lineHeight: `${TITLE_LINE_HEIGHT}px`,\n  },\n  preview: {\n    marginTop: styleguide.gridbase * 1.25,\n    marginLeft: styleguide.gridbase * 4,\n  },\n  childList: {\n    paddingLeft: styleguide.gridbase * 4,\n    ...styleguide.transition.short,\n    transitionProperty: 'height',\n  },\n  hide: {\n    overflow: 'hidden',\n  },\n  child: {\n    margin: [styleguide.gridbase * 2, 0],\n  },\n}));\n\ninterface TitleElementProps extends RenderElementProps {\n  className?: string;\n}\n\nconst TitleNode = React.forwardRef(\n  (\n    { className, ...props }: TitleElementProps,\n    ref: React.ForwardedRef<HTMLSpanElement>\n  ) => {\n    const styles = useStyles();\n    return (\n      <Text ref={ref} className={cn(styles.titleText, className)} {...props} />\n    );\n  }\n);\n\nfunction Title({\n  card,\n  source,\n}: {\n  card: VertexManager<Note>;\n  source: UISource;\n}) {\n  const { editor, plugins, handlers } = useTitleEditor(card, TitleNode, source);\n\n  return (\n    <div>\n      <Slate editor={editor} {...handlers}>\n        <Editable {...plugins} readOnly={true} />\n      </Slate>\n    </div>\n  );\n}\n\nexport interface CardHeaderPartProps extends CardItemProps {\n  isExpanded: boolean;\n  source: UISource;\n  hideMenu?: boolean;\n}\n\nexport function CardHeader({\n  card,\n  className,\n  isExpanded,\n  source,\n  hideMenu,\n  size,\n}: CardHeaderPartProps) {\n  const styles = useStyles();\n  return (\n    <div className={className}>\n      <div className={cn(styles.header)}>\n        <CardWorkspaceIndicator\n          card={card}\n          source={source}\n          isExpanded={isExpanded}\n        />\n        {size === CardSize.Regular && (\n          <CardTags\n            size={size}\n            card={card}\n            isExpanded={isExpanded}\n            source={source}\n          />\n        )}\n        <div className={cn(layout.flexSpacer)} />\n        <AssigneesView\n          cardManager={card}\n          cardType=\"small\"\n          source={source}\n          isExpanded={isExpanded}\n        />\n        {!hideMenu && (\n          <CardMenuView\n            cardManager={card}\n            allowsEdit={true}\n            source={source}\n            className={cn(styles.menu, isExpanded && styles.menuVisible)}\n          />\n        )}\n      </div>\n      {size === CardSize.Small && (\n        <CardTags\n          size={size}\n          card={card}\n          isExpanded={isExpanded}\n          source={source}\n        />\n      )}\n    </div>\n  );\n}\n\nexport function StatusCheckbox({\n  card,\n  source,\n}: {\n  card: VertexManager<Note>;\n  source: UISource;\n}) {\n  const styles = useStyles();\n  const theme = useTheme();\n  const logger = useLogger();\n  const pCard = usePartialVertex(card, ['tags', 'workspace', 'type', 'status']);\n  if (pCard.type !== NoteType.Task || pCard.status !== 'Done') {\n    return <div className={cn(styles.checkboxPlaceholder, styles.status)} />;\n  }\n\n  const isDone = pCard.status === 'Done';\n\n  const onChange = useCallback(() => {\n    pCard.status = pCard.status === 'Done' ? 'ToDo' : 'Done';\n    logger.log({\n      severity: 'INFO',\n      event: 'MetadataChanged',\n      type: 'status',\n      vertex: pCard.key,\n      status: pCard.status,\n      source,\n    });\n  }, [pCard, logger, source, isDone]);\n\n  return (\n    <div className={cn(styles.status)}>\n      <CheckBox\n        color={theme.background.text}\n        checked={isDone}\n        onChange={onChange}\n        name=\"status\"\n      />\n    </div>\n  );\n}\n\nexport interface CardItemProps {\n  card: VertexManager<Note>;\n  size: CardSize;\n  showChildCards?: boolean;\n  className?: string;\n  style?: {};\n}\n\nexport const CardItem = React.forwardRef(function CardItemView(\n  { card, className, showChildCards, size, ...rest }: CardItemProps,\n  ref: React.ForwardedRef<HTMLDivElement>\n) {\n  const styles = useStyles();\n  const childListRef = useRef(null);\n  const documentRouter = useDocumentRouter();\n  const pCard = usePartialVertex(card, [\n    'childCards',\n    'tags',\n    'type',\n    'status',\n  ]);\n  const { childCards } = pCard;\n  const [expanded, setExpanded] = useState(false);\n  const style = useAnimateHeight(childListRef, expanded);\n  const [isInHover, setIsInHover] = useState(false);\n  const isTask = pCard.type === NoteType.Task;\n  const isDone = pCard.status === 'Done';\n  const logger = useLogger();\n\n  const onMouseEnter = useCallback(() => {\n    setIsInHover(true);\n  }, []);\n\n  const onMouseLeave = useCallback(() => {\n    setIsInHover(false);\n  }, []);\n\n  const source: UISource = 'list';\n\n  const onClick = useCallback(() => {\n    documentRouter.goTo(card);\n    logger.log({\n      severity: 'INFO',\n      event: 'Navigation',\n      type: 'open',\n      source,\n      destination: 'editor',\n      vertex: card.key,\n    });\n  }, [card, documentRouter, logger, source]);\n\n  return (\n    <div\n      className={cn(styles.cardContainer, className)}\n      ref={ref}\n      // style={style}\n\n      {...rest}\n    >\n      <div\n        className={cn(styles.card, isTask && styles.taskCard, styles[size])}\n        onMouseEnter={onMouseEnter}\n        onMouseLeave={onMouseLeave}\n        onClick={onClick}\n      >\n        <CardHeader\n          size={size}\n          card={card}\n          isExpanded={isInHover}\n          source={source}\n        />\n        <div className={cn(styles.titleRow)}>\n          <StatusCheckbox source={source} card={card} />\n          <div className={cn(styles.titleTextContainer)}>\n            <Title source={source} card={card} />\n            <div\n              className={cn(\n                styles.strikethrough,\n                isDone && styles.strikethroughDone\n              )}\n            />\n          </div>\n        </div>\n        {/* {size === CardSize.Regular ? (\n          <BodyPreview card={card} className={cn(styles.preview)} />\n        ) : ( */}\n        <div className={cn(styles.preview)} />\n        {/* )} */}\n        <CardFooter size={size} card={card} source={source} />\n      </div>\n      {showChildCards && !!childCards.length && (\n        <div\n          className={cn(styles.expander)}\n          onClick={() => setExpanded((x) => !x)}\n        >\n          <IconExpander\n            className={cn(\n              styles.expanderIcon,\n              expanded && styles.expanderIconExpanded\n            )}\n          />\n        </div>\n      )}\n      {showChildCards && (\n        <div\n          className={cn(styles.childList, !expanded && styles.hide)}\n          ref={childListRef}\n          style={style}\n        >\n          {expanded &&\n            childCards.map((child, index) => (\n              <ChildCard\n                size={size}\n                key={child.key}\n                card={child.manager as VertexManager<Note>}\n                index={index}\n                isVisible={expanded}\n              />\n            ))}\n        </div>\n      )}\n    </div>\n  );\n});\n\ninterface ChildCardProps {\n  card: VertexManager<Note>;\n  index: number;\n  size: CardSize;\n  isVisible: boolean;\n}\n\nfunction ChildCard({ card, size, index, isVisible }: ChildCardProps) {\n  const styles = useStyles();\n  // const style = useMemo(() => {\n  //   return {\n  //     transform: isVisible\n  //       ? 'translateY(0)'\n  //       : `translateY(${-(index + 1) * (16 + 64)}px)`,\n  //   };\n  // }, [index, isVisible]);\n  return <CardItem size={size} card={card} className={cn(styles.child)} />;\n}\n", "import React, { MouseEvent, useCallback } from 'https://esm.sh/react@18.2.0';\nimport { formatTimeDiff } from '../../../../../../../base/date.ts';\nimport { VertexManager } from '../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport { Note } from '../../../../../../../cfds/client/graph/vertices/note.ts';\nimport { usePartialVertex } from '../../../../../core/cfds/react/vertex.ts';\nimport {\n  createUseStrings,\n  format,\n} from '../../../../../core/localization/index.tsx';\nimport { useDueDate } from '../../../../../shared/components/due-date-editor/index.tsx';\nimport { layout, styleguide } from '../../../../../../../styles/index.ts';\nimport { Button } from '../../../../../../../styles/components/buttons.tsx';\nimport {\n  IconAttachment,\n  IconCalendar,\n} from '../../../../../../../styles/components/icons/index.ts';\nimport { IconContent } from '../../../../../../../styles/components/new-icons/icon-content.tsx';\nimport Menu from '../../../../../../../styles/components/menu.tsx';\nimport { Text } from '../../../../../../../styles/components/texts.tsx';\nimport {\n  makeStyles,\n  cn,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { useTheme } from '../../../../../../../styles/theme.tsx';\nimport { CardSize } from './index.tsx';\n// import localization from './card.strings.json' assert { type: 'json' };\nimport { UISource } from '../../../../../../../logging/client-events.ts';\nimport { useLogger } from '../../../../../core/cfds/react/logger.tsx';\n\nexport const FOOTER_HEIGHT = styleguide.gridbase * 2;\n\nconst useStyles = makeStyles((theme) => ({\n  footer: {\n    alignItems: 'center',\n    minHeight: styleguide.gridbase,\n    color: theme.background.textSecondary,\n    basedOn: [layout.row],\n  },\n  footerItem: {\n    marginTop: styleguide.gridbase * 0.5,\n    height: FOOTER_HEIGHT,\n  },\n  attachments: {\n    alignItems: 'center',\n    basedOn: [layout.row],\n  },\n  attachment: {\n    color: theme.background.textSecondary,\n  },\n  margin: {\n    marginRight: styleguide.gridbase,\n  },\n}));\n\n// const useStrings = createUseStrings(localization);\n\nexport interface CardFooterProps {\n  card: VertexManager<Note>;\n  source: UISource;\n  size?: CardSize;\n  className?: string;\n}\n\n// function Attachments({ card, source }: CardFooterProps) {\n//   const styles = useStyles();\n//   const { attachments, openAttachment, removeAttachment } = useAttachments(\n//     card,\n//     source\n//   );\n//   const strings = useStrings();\n\n//   const renderButton = useCallback(\n//     () => (\n//       <div className={cn(styles.attachments)}>\n//         <IconAttachment size=\"small\" />\n//         <Text className={cn(styles.attachment)}>\n//           {attachments.length === 1\n//             ? strings.singleAttachment\n//             : format(strings.multipleAttachments, {\n//                 count: attachments.length,\n//               })}\n//         </Text>\n//       </div>\n//     ),\n//     [attachments, strings, styles]\n//   );\n\n//   if (!attachments?.length) {\n//     return null;\n//   }\n\n//   return (\n//     <Menu renderButton={renderButton} className={cn(styles.footerItem)}>\n//       {attachments.map((file) => (\n//         <AttachmentItem\n//           key={file.fileId}\n//           file={file}\n//           openAttachment={openAttachment}\n//           removeAttachment={removeAttachment}\n//         />\n//       ))}\n//     </Menu>\n//   );\n// }\n\nfunction DueDateIndicator({ card, source }: CardFooterProps) {\n  const styles = useStyles();\n  const { dueDate } = usePartialVertex(card, ['dueDate']);\n  const dueDateEditor = useDueDate();\n  const logger = useLogger();\n  const theme = useTheme();\n  if (!dueDate) {\n    return null;\n  }\n  const onClick = (e: MouseEvent) => {\n    e.stopPropagation();\n    logger.log({\n      severity: 'INFO',\n      event: 'Start',\n      flow: 'edit',\n      type: 'due',\n      vertex: card.key,\n      source,\n    });\n    dueDateEditor!.edit(card.getVertexProxy());\n  };\n\n  const isOverdue = dueDate < new Date();\n  const color = isOverdue ? theme.primary[400] : theme.background.textSecondary;\n\n  return (\n    <Button className={cn(styles.footerItem)} onClick={onClick}>\n      <IconCalendar fill={color} />\n      <Text style={{ color }}>{formatTimeDiff(dueDate)}</Text>\n    </Button>\n  );\n}\n\nfunction ContentIndicator({ card }: { card: VertexManager<Note> }) {\n  const { bodyPreview } = usePartialVertex(card, ['bodyPreview']);\n  const styles = useStyles();\n  if (!bodyPreview.trim()) {\n    return null;\n  }\n\n  return (\n    <div className={cn(styles.footerItem, styles.margin)}>\n      <IconContent />\n    </div>\n  );\n}\n\nexport function CardFooter({\n  card,\n  source,\n  className,\n  size = CardSize.Regular,\n}: CardFooterProps) {\n  const styles = useStyles();\n  return (\n    <div className={cn(styles.footer, className)}>\n      {size === CardSize.Small && <ContentIndicator card={card} />}\n      <div className={cn(layout.flexSpacer)} />\n      <DueDateIndicator card={card} source={source} />\n    </div>\n  );\n}\n", "import React, { useRef, useEffect } from 'https://esm.sh/react@18.2.0';\nimport {\n  Editable,\n  RenderElementProps,\n  Slate,\n} from 'https://esm.sh/slate-react@0.87.1';\nimport {\n  makeStyles,\n  cn,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { styleguide, layout } from '../../../../../../../styles/index.ts';\nimport { H1 } from '../../../../../../../styles/components/texts.tsx';\nimport { Note } from '../../../../../../../cfds/client/graph/vertices/note.ts';\nimport { VertexManager } from '../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport { useTitleEditor } from '../../../../../core/slate/index.tsx';\nimport { EditableCardContext } from '../../../../../core/slate/elements/card.element/index.tsx';\nimport CardMenuView from '../../../../../shared/item-menu/index.tsx';\n// import { useEventLogger } from '../../../../../core/analytics';\nimport { FocusReporter } from '../focus-reporter.tsx';\nimport { CardFooter } from '../../cards-display/card-item/card-footer.tsx';\nimport { CardHeader, CardSize } from '../../cards-display/card-item/index.tsx';\n\nconst useStyles = makeStyles((theme) => ({\n  placeholder: {\n    marginLeft: styleguide.gridbase * 1.5,\n    marginRight: styleguide.gridbase * 1.5,\n    marginBottom: styleguide.gridbase * 2,\n    color: '#b7b4bf',\n    fontSize: 12,\n    position: 'absolute',\n    top: '50%',\n    transform: 'translateY(-50%)',\n    pointerEvents: 'none',\n    direction: 'ltr',\n  },\n  header: {\n    position: 'relative',\n  },\n  textContainer: {\n    position: 'relative',\n    alignItems: 'center',\n    minHeight: styleguide.gridbase * 7,\n    basedOn: [layout.row],\n    ':hover': {\n      backgroundColor: theme.background[100],\n      overflowIcon: {\n        opacity: 1,\n      },\n    },\n  },\n  tags: {\n    marginLeft: 0,\n    marginBottom: styleguide.gridbase * 2,\n    '& > :first-child': {\n      marginLeft: 0,\n    },\n  },\n  footer: {\n    height: styleguide.gridbase * 4,\n  },\n  rtl: {\n    direction: 'rtl',\n  },\n  noteHeader: {\n    fontSize: 56,\n  },\n  noteEditor: {\n    maxWidth: '100%',\n    flexShrink: 1,\n  },\n  pills: {\n    flexShrink: 1,\n    flexWrap: 'wrap',\n    basedOn: [layout.row],\n  },\n  assignees: {\n    alignSelf: 'center',\n  },\n}));\n\n// function TagsPlaceholder({ value, hasTags, text, isRtl }) {\n//   const doc = value.document;\n//   const texts = doc.getTexts();\n//   const firstText = texts.get(0);\n//   const inlines = doc.getInlines();\n//   const [left, setLeft] = useState(-9999);\n//   const [right, setRight] = useState(null);\n//   useLayoutEffect(() => {\n//     if (texts.size > 1 || inlines.size) {\n//       setLeft(-9999);\n//       setRight(null);\n//       return;\n//     }\n//     try {\n//       // TODO: fix\n//       // const domNode = findDOMNode(firstText);\n//       // const width = domNode.getBoundingClientRect().width;\n//       const width = 0;\n//       if (isRtl) {\n//         setLeft(null);\n//         setRight(width);\n//       } else {\n//         setLeft(width);\n//         setRight(null);\n//       }\n//     } catch (e) {\n//       setLeft(-9999);\n//       setRight(null);\n//     }\n//   }, [texts, inlines, firstText, isRtl]);\n//   if (hasTags || (firstText && !firstText.text.length)) {\n//     return null;\n//   }\n//   return (\n//     <div\n//       className={cn(styles.placeholder)}\n//       style={{\n//         left: left && left + 'px',\n//         right: right && right + 'px',\n//       }}>\n//       {text}\n//     </div>\n//   );\n// }\n\nfunction Title({ children, attributes }: RenderElementProps): JSX.Element {\n  return <H1 {...attributes}>{children}</H1>;\n}\n\ninterface TitleEditorProps {\n  cardManager: VertexManager<Note>;\n  className?: string;\n  isRtl?: boolean;\n  focusNext?: () => void;\n  onDelete?: () => void;\n  showWS?: boolean;\n}\n\nexport default function TitleEditorView({\n  cardManager,\n  className,\n  isRtl,\n  focusNext,\n  onDelete,\n}: TitleEditorProps) {\n  const styles = useStyles();\n  const { editor, plugins, handlers } = useTitleEditor(\n    cardManager,\n    Title,\n    'title',\n    {\n      onFocusNext: focusNext,\n    }\n  );\n\n  return (\n    <div className={cn(className, styles.header, isRtl && styles.rtl)}>\n      <Slate editor={editor} {...handlers}>\n        <CardHeader\n          size={CardSize.Regular}\n          card={cardManager}\n          source=\"title\"\n          isExpanded={true}\n          hideMenu={true}\n        />\n        <div className={cn(styles.textContainer)}>\n          <div className={cn(layout.flex, styles.noteEditor)}>\n            <EditableCardContext cardManager={cardManager}>\n              <FocusReporter cardManager={cardManager} source=\"editor:title\" />\n              <Editable\n                {...plugins}\n                placeholder=\"Name your card\"\n                tabIndex={0}\n              />\n            </EditableCardContext>\n          </div>\n          {/* <TagsPlaceholder\n            value={value}\n            text={`Tag this card (# Tag Name)`}\n            isRtl={isRtl}\n            hasTags={pcard.get('tags', new COWMap([])).size}\n          /> */}\n          <CardMenuView\n            cardManager={cardManager}\n            onDeleted={onDelete}\n            source=\"title\"\n            position=\"bottom\"\n            editorRootKey={cardManager.key}\n          />\n        </div>\n        <CardFooter\n          className={cn(styles.footer)}\n          card={cardManager}\n          source=\"title\"\n        />\n      </Slate>\n    </div>\n  );\n}\n", "import React, {\n  useCallback,\n  useReducer,\n  useRef,\n} from 'https://esm.sh/react@18.2.0';\nimport { Note } from '../../../../../../cfds/client/graph/vertices/note.ts';\nimport { VertexManager } from '../../../../../../cfds/client/graph/vertex-manager.ts';\nimport { makeStyles, cn } from '../../../../../../styles/css-objects/index.ts';\nimport { layout, styleguide } from '../../../../../../styles/index.ts';\nimport { MediaQueries } from '../../../../../../styles/responsive.ts';\nimport BodyEditor, { EditorHandle } from './body-editor/index.tsx';\nimport { Scroller } from '../../../../core/react-utils/scrolling.tsx';\nimport LegendButton from './legend-view.tsx';\nimport reducer, { initialState } from './editor-reducer.ts';\nimport TitleEditorView from './title-editor/index.tsx';\n\nconst useStyles = makeStyles((theme) => ({\n  container: {\n    flexShrink: 1,\n    overflowY: 'auto',\n    width: '100%',\n    paddingTop: styleguide.gridbase * 10,\n    margin: [0, 'auto'],\n    basedOn: [layout.flex],\n  },\n  headerContainer: {\n    paddingTop: styleguide.gridbase * 4,\n    paddingBottom: styleguide.gridbase * 4,\n    [MediaQueries.TabletAndMobile]: {\n      paddingTop: styleguide.gridbase * 3,\n      paddingBottom: styleguide.gridbase * 3,\n    },\n  },\n  header: {\n    fontSize: 32,\n    fontWeight: 'bold',\n    margin: '0 auto',\n    '::selection': {\n      backgroundColor: theme.primary[500],\n    },\n    '& *': {\n      '::selection': {\n        backgroundColor: theme.primary[400],\n      },\n    },\n    outline: 'none',\n    border: 'none',\n    background: 'transparent',\n    color: theme.background.text,\n  },\n  contained: {\n    width: '100%',\n    maxWidth: styleguide.gridbase * 100,\n    padding: [styleguide.gridbase * 16, styleguide.gridbase * 8],\n    paddingTop: 0,\n    [MediaQueries.Tablet]: {\n      padding: [styleguide.gridbase * 3, styleguide.gridbase * 2],\n      paddingTop: 0,\n    },\n    [MediaQueries.Mobile]: {\n      padding: [styleguide.gridbase * 3, styleguide.gridbase],\n      paddingTop: 0,\n    },\n  },\n}));\n// const plainTextSerializer = new PlainTextSerializer();\n\ninterface CardEditorProps {\n  cardManager: VertexManager<Note>;\n  showWS?: boolean;\n}\n\nexport default function CardEditorContent({\n  cardManager,\n  showWS = false,\n}: CardEditorProps) {\n  const styles = useStyles();\n  // const rtl = useMemo(() => {\n  //   const str = plainTextSerializer.deserialize(title);\n\n  //   return isRTL(str);\n  // }, [title]);\n  const rtl = false;\n  const bodyEditorRef = useRef<EditorHandle>(null);\n  const focusNext = useCallback(() => {\n    bodyEditorRef.current?.focus();\n  }, []);\n  // const focusBody = () => {\n  //   //bodyEditorRef.current && (bodyEditorRef.current as any).focus();\n  // };\n\n  return (\n    <Scroller>\n      {(ref) => (\n        <div className={cn(styles.container)} ref={ref}>\n          <div\n            className={cn(styles.headerContainer)}\n            onClick={(e) => e.stopPropagation()}\n          >\n            <TitleEditorView\n              cardManager={cardManager}\n              isRtl={rtl}\n              className={cn(styles.header, styles.contained)}\n              showWS={showWS}\n              focusNext={focusNext}\n            />\n          </div>\n          {/* <RichtextContext card={card} field=\"body\" fieldType={FieldTypes.body}>\n            {props => ( */}\n          <BodyEditor\n            className={cn(styles.contained)}\n            cardManager={cardManager}\n            isRtl={rtl}\n            ref={bodyEditorRef}\n          />\n          {/* )}\n          </RichtextContext> */}\n          <LegendButton />\n          {/* <InvitationDialog\n            workspace={workspace}\n            open={state.inviteOpen}\n            hide={() => dispatch({ type: EditorActions.CLOSE })}\n          /> */}\n        </div>\n      )}\n    </Scroller>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { Navigate, useParams } from 'https://esm.sh/react-router-dom@6.7.0';\nimport { Note } from '../../../../../../cfds/client/graph/vertices/note.ts';\nimport { layout } from '../../../../../../styles/layout.ts';\nimport SpinnerView from '../../../../../../styles/components/spinner-view.tsx';\nimport { cn, makeStyles } from '../../../../../../styles/css-objects/index.ts';\nimport { useVertex } from '../../../../core/cfds/react/vertex.ts';\nimport FloatingBackButton from '../../../../shared/components/floating-back-button.tsx';\nimport { useGraphManager } from '../../../../core/cfds/react/graph.tsx';\nimport CardContentView from './content.tsx';\n\nconst kAllowEditorCrashes = false;\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    position: 'relative',\n    height: '100%',\n    width: '100%',\n    flexShrink: 1,\n    basedOn: [layout.column, layout.flex],\n  },\n  relative: {\n    position: 'relative',\n    overflow: 'hidden',\n    flexShrink: 1,\n    basedOn: [layout.flex, layout.column],\n  },\n  loader: {\n    basedOn: [layout.column, layout.flex, layout.centerCenter],\n  },\n}));\n\nfunction NoteNotFound() {\n  return <Navigate to=\"/\" replace={true} />;\n}\n\ntype ErrorBoundaryProps = React.PropsWithChildren;\n\nclass ErrorBoundary extends React.Component<\n  ErrorBoundaryProps,\n  { hasError: boolean }\n> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static getDerivedStateFromError(error: Error) {\n    if (kAllowEditorCrashes) {\n      return { hasError: false };\n    }\n    return { hasError: true };\n  }\n\n  componentDidCatch(error: Error, errorInfo: unknown) {\n    console.error(error, errorInfo);\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return <Navigate to=\"/\" />;\n    }\n\n    return this.props.children;\n  }\n}\n\ninterface NotesViewProps {\n  noteId?: string;\n}\n\nexport default function NoteView({ noteId }: NotesViewProps) {\n  const routeNoteId = useParams().noteId;\n  if (!noteId && routeNoteId) {\n    noteId = routeNoteId;\n  }\n\n  return noteId ? <InnerNoteView noteId={noteId} /> : <NoteNotFound />;\n}\n\ninterface InnerNotesViewProps {\n  noteId: string;\n}\n\nexport function InnerNoteView({ noteId }: InnerNotesViewProps) {\n  const styles = useStyles();\n  const graph = useGraphManager();\n  const cardManager = graph.getVertexManager<Note>(noteId);\n  const card = useVertex(cardManager);\n\n  let content = null;\n  if (card.isDeleted) {\n    return <NoteNotFound />;\n    // } else if (card.isLoading) {\n    //   content = (\n    //     <div className={cn(styles.loader)}>\n    //       <SpinnerView />\n    //     </div>\n    //   );\n  } else {\n    content = <CardContentView cardManager={cardManager} />;\n  }\n\n  return (\n    <ErrorBoundary>\n      <div className={cn(styles.root)}>\n        <div className={cn(styles.relative)}>\n          <FloatingBackButton />\n          {content}\n        </div>\n      </div>\n    </ErrorBoundary>\n  );\n}\n", "import React, {\n  useContext,\n  useEffect,\n  useMemo,\n  useReducer,\n  useRef,\n} from 'https://esm.sh/react@18.2.0';\nimport { CANCELLATION_REASONS } from './index.ts';\nimport { DragPosition } from './droppable.tsx';\n\nfunction generateId() {\n  return ++_id;\n}\n\ninterface DNDCallbacks {\n  onDragStarted?: <T>(\n    data: T,\n    index: number,\n    dropZone: string,\n    placeholderStyle: {}\n  ) => void;\n  setDragOverIndex?: (\n    index: number,\n    dragPosition: DragPosition,\n    dropZone: string\n  ) => void;\n  onDragCancelled?: (e: {\n    reason: CANCELLATION_REASONS;\n    context?: any;\n  }) => void;\n  onDrop?: <T>(\n    item: T,\n    relativeTo: T,\n    dragPosition: DragPosition,\n    index?: number\n  ) => void;\n}\n\ninterface DNDContext extends DNDCallbacks {\n  id: string;\n  state: DragAndDropState;\n}\n\nconst dragCtx = React.createContext<DNDContext | null>(null);\n\nlet _id = 0;\n\nconst START_DRAG = 'START_DRAG';\nconst CANCEL_DRAG = 'CANCEL_DRAG';\nconst END_DRAG = 'END_DRAG';\nconst SET_OVER_INDEX = 'SET_OVER_INDEX';\nconst SET_DISABLED = 'SET_DISABLED';\n\ntype DNDAction =\n  | {\n      type: 'START_DRAG';\n      payload: {\n        data: any;\n        index: number;\n        dropZone: string;\n        placeholderStyle?: {};\n      };\n    }\n  | {\n      type: 'CANCEL_DRAG';\n    }\n  | {\n      type: 'END_DRAG';\n    }\n  | {\n      type: 'SET_OVER_INDEX';\n      payload: {\n        dropZone: string;\n        dragPosition: DragPosition;\n        index: number;\n      };\n    }\n  | {\n      type: 'SET_DISABLED';\n      payload: {\n        disabled: boolean;\n      };\n    };\n\ninterface DragAndDropState {\n  disabled: boolean;\n  dragData: null | {\n    data: any;\n    index: number;\n    dropZone: string;\n    placeholderStyle: {};\n  };\n  dragOverData: null | {\n    dropZone: string;\n    dragPosition: DragPosition;\n    index: number;\n  };\n}\n\nfunction init(disabled: boolean): DragAndDropState {\n  return {\n    dragData: null,\n    dragOverData: null,\n    disabled,\n  };\n}\nfunction dndReducer(\n  state: DragAndDropState,\n  action: DNDAction\n): DragAndDropState {\n  // if (state.disabled && type !== SET_DISABLED) {\n  //   return state;\n  // }\n  switch (action.type) {\n    case START_DRAG: {\n      const { payload } = action;\n      return {\n        ...state,\n        dragData: {\n          data: payload.data,\n          index: payload.index,\n          dropZone: payload.dropZone,\n          placeholderStyle: payload.placeholderStyle || {},\n        },\n        dragOverData: {\n          dropZone: payload.dropZone,\n          dragPosition: { y: 'bottom', x: 'right' },\n          index: payload.index - 1,\n        },\n      };\n    }\n    case CANCEL_DRAG:\n    case END_DRAG: {\n      return {\n        ...state,\n        dragData: null,\n        dragOverData: null,\n      };\n    }\n    case SET_OVER_INDEX: {\n      const { payload } = action;\n      if (state.disabled) {\n        return state;\n      }\n      if (\n        payload.dropZone === state.dragData?.dropZone &&\n        (payload.index === state.dragData.index ||\n          payload.index === state.dragData.index - 1)\n      ) {\n        return {\n          ...state,\n          dragOverData: {\n            index: state.dragData.index - 1,\n            dragPosition: payload.dragPosition,\n            dropZone: payload.dropZone,\n          },\n        };\n      }\n      return {\n        ...state,\n        dragOverData: {\n          index: payload.index,\n          dragPosition: payload.dragPosition,\n          dropZone: payload.dropZone,\n        },\n      };\n    }\n    case SET_DISABLED: {\n      const { payload } = action;\n      if (payload.disabled === state.disabled) {\n        return state;\n      }\n      return init(payload.disabled);\n    }\n    default:\n      throw new Error('Unknown action type');\n  }\n}\n\ninterface DragAndDropProps extends DNDCallbacks {\n  children: React.ReactNode;\n  disabled?: boolean;\n}\n\nexport function DragAndDropContext({\n  children,\n  onDragStarted = () => {},\n  onDragCancelled = () => {},\n  onDrop = () => {},\n  disabled = false,\n}: DragAndDropProps) {\n  const [state, dispatch] = useReducer(dndReducer, disabled, init);\n  const listeners = useRef({\n    onDragStarted,\n    onDragCancelled,\n    onDrop,\n  });\n  const id = useMemo(() => `ctx_${generateId()}`, []);\n  const ctx = useMemo<DNDContext>(\n    () => ({\n      id,\n      onDragStarted(data, index, dropZone, placeholderStyle) {\n        dispatch({\n          type: START_DRAG,\n          payload: {\n            data,\n            index,\n            dropZone,\n            placeholderStyle,\n          },\n        });\n        listeners.current.onDragStarted(\n          data,\n          index,\n          dropZone,\n          placeholderStyle\n        );\n      },\n      onDragCancelled(e) {\n        dispatch({ type: CANCEL_DRAG });\n        listeners.current.onDragCancelled(e);\n      },\n      onDrop(item, relativeTo, dragPosition, index) {\n        dispatch({ type: END_DRAG });\n        listeners.current.onDrop(item, relativeTo, dragPosition, index);\n      },\n      setDragOverIndex(\n        index: number,\n        dragPosition: DragPosition,\n        dropZone: string\n      ) {\n        if (\n          state.dragOverData &&\n          state.dragOverData.index === index &&\n          state.dragOverData.dropZone === dropZone //||\n          // (!state.dragOverData &&\n          //   state.dragData.dropZone === dropZone &&\n          //   (state.dragData.index === index ||\n          //     state.dragData.index - 1 === index))\n        ) {\n          return;\n        }\n        dispatch({\n          type: SET_OVER_INDEX,\n          payload: { index, dragPosition, dropZone },\n        });\n      },\n      state,\n    }),\n    [id, state]\n  );\n  useEffect(() => {\n    listeners.current = {\n      onDragStarted,\n      onDragCancelled,\n      onDrop,\n    };\n  }, [onDragStarted, onDragCancelled, onDrop]);\n  useEffect(() => {\n    dispatch({\n      type: SET_DISABLED,\n      payload: { disabled },\n    });\n  }, [disabled]);\n  return <dragCtx.Provider value={ctx}>{children}</dragCtx.Provider>;\n}\n\nexport function useDndContext<T>(data: T) {\n  const ctx = useContext(dragCtx);\n  if (!ctx) {\n    throw new Error(\n      'Draggable and Droppable components must be descendant components of DragAndDropContext'\n    );\n  }\n  const gid = useMemo(generateId, []);\n  const id = `${ctx.id}:${gid}`;\n\n  return { id, ctx };\n}\n\nexport function isSameContext(myId: string, other: string) {\n  const [ctxA] = myId.split(':');\n  const [ctxB] = other.split(':');\n  return ctxA === ctxB;\n}\n", "export enum CANCELLATION_REASONS {\n  USER_CANCELLED = 'USER_CANCELLED',\n  DISABLED = 'DISABLED',\n  NO_DATA = 'NO_DATA',\n  NOT_ALLOWED = 'NOT_ALLOWED',\n}\n\nexport default CANCELLATION_REASONS;\n", "import React from 'https://esm.sh/react@18.2.0';\nimport CANCELLATION_REASONS from './cancellation-reasons.tsx';\nimport { useDndContext } from './context.tsx';\n\nconst DROP_ZONE = 'DROP_ZONE';\n\nexport const dropZoneContext = React.createContext<string>('');\n\n// function getDragId(el) {\n//   let dragId = el.dataset.dragId;\n//   while (!dragId && el.parentElement) {\n//     el = el.parentElement;\n//     dragId = el.dataset.dragId;\n//   }\n//   return dragId;\n// }\n\nexport type DragPosition = {\n  x: 'left' | 'right';\n  y: 'top' | 'bottom';\n};\n\nexport interface RenderDroppableProps {\n  attributes: any;\n  isInDrag: boolean;\n  isDragOver: boolean;\n}\n\nexport type RenderDroppableHandler = (\n  props: RenderDroppableProps\n) => React.ReactNode;\n\nexport type AllowsDropResult = {\n  isAllowed: boolean;\n  context?: any;\n};\n\nfunction isAllowsDropResult(\n  result: boolean | AllowsDropResult\n): result is AllowsDropResult {\n  return typeof result !== 'boolean';\n}\n\nexport interface DroppableProps<T> {\n  children: RenderDroppableHandler | React.ReactNode;\n  allowsDrop?: (item: any) => boolean | AllowsDropResult | boolean;\n  items: readonly T[];\n  onDrop: (item: T, relativeTo: T, dragPosition: DragPosition) => void;\n}\nexport function Droppable<T>({\n  children,\n  allowsDrop = (item) => !!item,\n  items,\n  onDrop,\n}: DroppableProps<T>) {\n  const { id, ctx } = useDndContext(DROP_ZONE);\n  const onDropImpl = (e: DragEvent) => {\n    const { dragOverData, disabled, dragData } = ctx.state;\n    if (!dragData) {\n      return ctx.onDragCancelled!({\n        reason: CANCELLATION_REASONS.USER_CANCELLED,\n      });\n    }\n    if (disabled) {\n      return ctx.onDragCancelled!({\n        reason: CANCELLATION_REASONS.DISABLED,\n      });\n    }\n    if (!dragOverData || dragOverData.dropZone !== id) {\n      return ctx.onDragCancelled!({\n        reason: CANCELLATION_REASONS.NO_DATA,\n      });\n    }\n    const item = ctx.state.dragData?.data;\n    if (!item) {\n      return ctx.onDragCancelled!({\n        reason: CANCELLATION_REASONS.NO_DATA,\n      });\n    }\n    // if (\n    //   dragOverData.index === ctx.state.dragData.index ||\n    //   dragOverData.index === ctx.state.dragData.index - 1\n    // ) {\n    //   return ctx.onDragCancelled({\n    //     reason: CANCELLATION_REASONS.USER_CANCELLED,\n    //   });\n    // }\n    let relativeTo = items[dragOverData.index];\n    const { dragPosition } = dragOverData;\n    const res = typeof allowsDrop === 'boolean' ? allowsDrop : allowsDrop(item);\n    if ((isAllowsDropResult(res) && !res.isAllowed) || !res) {\n      return ctx.onDragCancelled!({\n        reason: CANCELLATION_REASONS.NOT_ALLOWED,\n        context: isAllowsDropResult(res) && res.context,\n      });\n    }\n    if (item === relativeTo) {\n      return ctx.onDragCancelled!({\n        reason: CANCELLATION_REASONS.USER_CANCELLED,\n      });\n    }\n    onDrop(item, relativeTo, dragPosition);\n    ctx.onDrop!(item, relativeTo, dragPosition);\n  };\n\n  const onDragOver = (e: DragEvent) => {\n    if (e.dataTransfer?.types.includes('text/ovvio')) {\n      if (!ctx.state.dragData) {\n        return;\n      }\n      e.preventDefault();\n      if (!items.length) {\n        ctx.setDragOverIndex!(0, { x: 'left', y: 'top' }, id);\n      }\n    }\n  };\n  const onDragLeave = (e: DragEvent) => {};\n\n  const isInDrag = !!ctx.state.dragData;\n  const isDragOver =\n    ctx.state.dragOverData !== null && ctx.state.dragOverData.dropZone === id;\n\n  const attributes = {\n    onDragOver,\n    onDragLeave,\n    onDrop: onDropImpl,\n    'data-drag-id': id,\n  };\n\n  return (\n    <dropZoneContext.Provider value={id}>\n      {typeof children === 'function'\n        ? children({ attributes, isInDrag, isDragOver })\n        : children}\n    </dropZoneContext.Provider>\n  );\n}\n", "import React, {\n  useCallback,\n  useEffect,\n  useRef,\n} from 'https://esm.sh/react@18.2.0';\nimport { DragPosition } from './droppable.tsx';\n\nexport function serializeId(id) {\n  return id;\n}\n\nexport const DragPositions = {\n  TopLeft: {\n    x: 'left',\n    y: 'top',\n  } as DragPosition,\n  TopRight: {\n    x: 'right',\n    y: 'top',\n  } as DragPosition,\n  BottomLeft: {\n    x: 'left',\n    y: 'bottom',\n  } as DragPosition,\n  BottomRight: {\n    x: 'right',\n    y: 'bottom',\n  } as DragPosition,\n};\n\nconst PosMap: {\n  [pos in 'top' | 'bottom']: { [x in 'left' | 'right']: DragPosition };\n} = {\n  top: {\n    left: DragPositions.TopLeft,\n    right: DragPositions.TopRight,\n  },\n  bottom: {\n    left: DragPositions.BottomLeft,\n    right: DragPositions.BottomRight,\n  },\n};\n\nexport function deserializeId(id: string): string | undefined {\n  if (!id || !id.startsWith('ovvdnd:')) {\n    return;\n  }\n\n  return id.substring('ovvdnd:'.length);\n}\n\n// function parsePx(val) {\n//   if (!val) {\n//     return 0;\n//   }\n//   if (val.endsWith('px')) {\n//     return parseFloat(val.substring(0, val.length - 2));\n//   }\n//   throw new Error(`unsupported css value ${val}`);\n// }\n\nfunction getBoundingBoxes(el) {\n  const rect = el.getBoundingClientRect();\n  return rect;\n  // const style = window.getComputedStyle(el);\n\n  // const outside = ['Top', 'Bottom', 'Left', 'Right']\n  //   .map(dir => {\n  //     const padding = parsePx(style[`padding${dir}`]);\n  //     const margin = parsePx(style[`margin${dir}`]);\n  //     const border = parsePx(style[`border${dir}Width`]);\n\n  //     return {\n  //       [`padding${dir}`]: padding,\n  //       [`margin${dir}`]: margin,\n  //       [`border${dir}`]: border,\n  //     };\n  //   })\n  //   .reduce((accum, val) => ({\n  //     ...accum,\n  //     ...val,\n  //   }));\n\n  // const marginHeight = rect.height + outside.marginTop + outside.marginBottom;\n  // const marginWidth = rect.width + outside.marginLeft + outside.marginRight;\n\n  // const marginX = rect.x - outside.marginLeft;\n  // const marginY = rect.y - outside.marginTop;\n\n  // return {\n  //   top: rect.top,\n  //   left: rect.left,\n  //   right: rect.right,\n  //   bottom: rect.bottom,\n  //   x: rect.x,\n  //   y: rect.y,\n  //   height: rect.height,\n  //   width: rect.width,\n  //   ...outside,\n  //   marginHeight,\n  //   marginWidth,\n  //   marginX,\n  //   marginY,\n  //   topSpace: outside.marginTop + outside.borderTop + outside.paddingTop,\n  //   bottomSpace:\n  //     outside.marginBottom + outside.borderBottom + outside.paddingBottom,\n  // };\n}\n\nexport function useDragPositionCalculator(isDragActive: boolean) {\n  const boundingBoxCache = useRef<WeakMap<EventTarget, any>>(new WeakMap());\n\n  useEffect(() => {\n    boundingBoxCache.current = new WeakMap();\n  }, [isDragActive]);\n\n  const calcPosition = useCallback((e: DragEvent, prevPos?: DragPosition) => {\n    const { target } = e;\n    if (!target) {\n      return;\n    }\n    let rect = boundingBoxCache.current.get(e.target);\n    if (!rect) {\n      rect = getBoundingBoxes(target);\n      boundingBoxCache.current.set(target, rect);\n    }\n    return calcDragPosition(e, rect, prevPos);\n  }, []);\n\n  return calcPosition;\n}\n\nfunction calcDragPosition(\n  e: DragEvent,\n  rect: any,\n  prevPos?: DragPosition\n): DragPosition {\n  const y = e.clientY;\n  const relativeY = y - rect.y;\n  const pos = relativeY / rect.height;\n  let yPos: 'top' | 'bottom' = 'top';\n  if (pos < 0.9 && pos > 0.5) {\n    yPos = 'bottom';\n  }\n  const x = e.clientX;\n  const relativeX = x - rect.x;\n  const p = relativeX / rect.width;\n  let xPos: 'left' | 'right' = 'left';\n  if (p > 0.5) {\n    xPos = 'right';\n  }\n  return PosMap[yPos][xPos];\n  // const relativeY = y - rect.marginY;\n  // if (relativeY < rect.topSpace) {\n  //   return 'before';\n  // }\n  // if (relativeY > rect.marginHeight - rect.bottomSpace) {\n  //   return 'after';\n  // }\n  // const pos =\n  //   (relativeY - rect.topSpace) /\n  //   (rect.marginHeight - rect.topSpace - rect.bottomSpace);\n  // if (pos < 0.5) {\n  //   return 'after';\n  //   if (pos > 0.6) {\n  //     return 'after';\n  //   }\n  //   return prevPos || 'after';\n  // }\n  // return 'before';\n  // if (pos < 0.4) {\n  //   return 'before';\n  // }\n  // return prevPos || 'before';\n}\n\nexport function throttle<T extends CallableFunction>(\n  fn: T,\n  limit = 1000 / 60\n): T {\n  let lastRun: number;\n  let result;\n  return function (...args) {\n    if (!lastRun || performance.now() - lastRun < limit) {\n      return result;\n    }\n    result = fn(...args);\n    lastRun = performance.now();\n  } as unknown as T;\n}\n", "import React, {\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport { MutableRefObject } from 'https://esm.sh/v96/@types/react@18.0.21/index.d.ts';\nimport CANCELLATION_REASONS from './cancellation-reasons.tsx';\nimport { useDndContext } from './context.tsx';\nimport { DragPosition, dropZoneContext } from './droppable.tsx';\nimport { serializeId, throttle, useDragPositionCalculator } from './util.ts';\n\ntype TypeOf<T, K extends keyof T> = T[K];\n\nexport interface RenderDraggableProps {\n  attributes: any;\n  isInDrag: boolean;\n  isDragActive: boolean;\n  dragPosition: DragPosition;\n  dropOverBefore: boolean;\n  placeholderStyle: any;\n  isDraggedOver: boolean;\n}\n\nexport type RenderDraggableHandler<TElement extends HTMLElement> = (\n  props: RenderDraggableProps,\n  ref: React.MutableRefObject<TElement>\n) => JSX.Element;\n\nexport interface DraggableProps<TElement extends HTMLElement> {\n  children: RenderDraggableHandler<TElement>;\n  data: any;\n  index: number;\n  effectAllowed?: TypeOf<TypeOf<DragEvent, 'dataTransfer'>, 'effectAllowed'>;\n}\n\nexport function Draggable<TElement extends HTMLElement = HTMLDivElement>({\n  children,\n  data,\n  index,\n  effectAllowed = 'all',\n}: DraggableProps<TElement>) {\n  const { id, ctx } = useDndContext(data);\n  const { disabled } = ctx.state;\n  const [isInDrag, setIsInDrag] = useState(false);\n  const dropZoneId = useContext(dropZoneContext);\n  const calcPosition = useDragPositionCalculator(\n    ctx.state.dragData?.dropZone === dropZoneId\n  );\n  const [dragPosition, setDragPosition] = useState<undefined | DragPosition>(\n    undefined\n  );\n  // const isInDrag =\n  //   ctx.state.dragData &&\n  //   ctx.state.dragData.dropZone === dropZoneId &&\n  //   ctx.state.dragData.index === index;\n\n  useEffect(() => {\n    const val =\n      ctx.state.dragData?.dropZone === dropZoneId &&\n      ctx.state.dragData?.index === index;\n    let cancelled = false;\n    requestAnimationFrame(() => {\n      if (!cancelled) {\n        setIsInDrag(val);\n      }\n    });\n\n    return () => {\n      cancelled = true;\n    };\n  }, [ctx, dropZoneId, index]);\n  const ref = useRef<TElement>();\n  const placeHolder = useRef<TElement>();\n\n  const onDragStart = (e: DragEvent) => {\n    if (placeHolder.current) {\n      placeHolder.current.remove();\n      placeHolder.current = undefined;\n    }\n    const serialized = serializeId(id);\n    e.dataTransfer?.setData('text/ovvio', serialized);\n    e.dataTransfer.effectAllowed = effectAllowed;\n    let placeholderStyle = {};\n    if (ref.current) {\n      const el = ref.current.cloneNode(true) as TElement;\n      placeHolder.current = el;\n      el.style.position = 'absolute';\n      el.style.top = '-99999px';\n      const rect = ref.current.getBoundingClientRect();\n      el.style.width = rect.width + 'px';\n      el.style.height = rect.height + 'px';\n      el.style.cursor = 'grabbing';\n      el.style.display = 'grid';\n      document.body.appendChild(el);\n      placeholderStyle = {\n        height: rect.height,\n      };\n      e.dataTransfer?.setDragImage(\n        el,\n        e.clientX - rect.left,\n        e.clientY - rect.top\n      );\n    }\n\n    ctx.onDragStarted(data, index, dropZoneId, placeholderStyle);\n  };\n\n  const onDragEnter = useCallback(\n    (e: DragEvent) => {\n      if (!ctx.state.dragData) {\n        return;\n      }\n      const pos = calcPosition(e);\n      if (pos) {\n        setDragPosition(pos);\n        ctx.setDragOverIndex(index, pos, dropZoneId);\n      }\n    },\n    [ctx, calcPosition, index, dropZoneId]\n  );\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const onDragOver = useCallback(\n    throttle((e: DragEvent) => {\n      if (!ctx.state.dragData) {\n        return;\n      }\n      setDragPosition((current) => {\n        const pos = calcPosition(e, current);\n        if (pos) {\n          ctx.setDragOverIndex(index, pos, dropZoneId);\n          return pos;\n        }\n        return current;\n      });\n    }, 100),\n    [ctx, calcPosition, index, dropZoneId]\n  );\n\n  const onDragLeave = (e: DragEvent) => {};\n\n  const onDrop = (e: DragEvent) => {};\n\n  const onDragEnd = (e: DragEvent) => {\n    if (placeHolder.current) {\n      placeHolder.current.remove();\n      placeHolder.current = undefined;\n    }\n    // setIsInDrag(false);\n    if (e.dataTransfer?.dropEffect === 'none') {\n      ctx.onDragCancelled({\n        reason: CANCELLATION_REASONS.USER_CANCELLED,\n      });\n    }\n  };\n\n  const dropOverBefore =\n    ctx.state.dragOverData &&\n    ctx.state.dragOverData.dropZone === dropZoneId &&\n    ctx.state.dragOverData.index < index;\n\n  const attributes = {\n    onDragStart,\n    draggable: !disabled,\n    onDragEnter,\n    onDragOver,\n    onDragLeave,\n    onDragEnd,\n    onDrop,\n    'data-drag-id': id,\n    'data-drag-index': index,\n  };\n\n  return children(\n    {\n      attributes,\n      isInDrag,\n      isDragActive: ctx.state.dragData?.dropZone === dropZoneId,\n      dragPosition: dragPosition!,\n      dropOverBefore: dropOverBefore!,\n      isDraggedOver:\n        ctx.state.dragOverData?.dropZone === dropZoneId &&\n        ctx.state.dragOverData?.index === index,\n      placeholderStyle:\n        (ctx.state.dragData && ctx.state.dragData.placeholderStyle) || {},\n    },\n    ref as MutableRefObject<TElement>\n  );\n}\n", "import { DragAndDropContext } from './context.tsx';\nimport { Draggable } from './draggable.tsx';\nimport { Droppable } from './droppable.tsx';\nimport CANCELLATION_REASONS from './cancellation-reasons.tsx';\nexport { DragAndDropContext, Draggable, Droppable, CANCELLATION_REASONS };\n\nexport enum DragSource {\n  List = 'LIST',\n  AssigneeBoard = 'ASSIGNEE_BOARD',\n  WorkspaceBoard = 'WORKSPACE_BOARD',\n  TagBoard = 'TAG_BOARD',\n  ChildTag = 'CHILD_TAG',\n}\n", "import React, { useMemo, useRef } from 'https://esm.sh/react@18.2.0';\nimport {\n  between,\n  past,\n  present,\n} from '../../../../../../../cfds/base/orderstamp.ts';\nimport { VertexManager } from '../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport { Note } from '../../../../../../../cfds/client/graph/vertices/note.ts';\nimport { useAnimateHeight } from '../../../../../core/react-utils/animate.ts';\nimport { RenderDraggableProps } from '../../../../../shared/dragndrop/draggable.tsx';\nimport { DragPosition } from '../../../../../shared/dragndrop/droppable.tsx';\nimport { styleguide } from '../../../../../../../styles/index.ts';\nimport {\n  makeStyles,\n  cn,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { CardItem, CardItemProps } from './index.tsx';\n\nconst useStyles = makeStyles((theme) => ({\n  noMargin: {\n    margin: 0,\n  },\n  draggableCard: {\n    position: 'relative',\n  },\n  draggedIndicator: {\n    position: 'absolute',\n    width: '100%',\n    height: styleguide.gridbase * 0.5,\n    backgroundColor: theme.primary[400],\n  },\n  'drag-top': {\n    top: 0,\n  },\n  'drag-bottom': {\n    bottom: 0,\n  },\n  dragAnimator: {\n    ...styleguide.transition.short,\n    transitionProperty: 'height',\n  },\n  hide: {\n    height: 0,\n    overflow: 'hidden',\n  },\n}));\n\nexport function setDragSort(\n  items: readonly VertexManager<Note>[],\n  item: VertexManager<Note>,\n  relativeTo: VertexManager<Note>,\n  dragPosition: DragPosition\n) {\n  if (!items.length) {\n    return;\n  }\n  const index = items.indexOf(relativeTo);\n  const nextIndex = dragPosition.y === 'top' ? index - 1 : index + 1;\n  let nextStamp: string;\n  if (nextIndex <= 0) {\n    nextStamp = present();\n  } else if (nextIndex >= items.length) {\n    nextStamp = past();\n  } else {\n    const x = items[nextIndex].getVertexProxy();\n    nextStamp = x.sortStamp;\n  }\n  item.vertex.sortStamp = between(relativeTo.vertex.sortStamp, nextStamp);\n}\n\nexport const DraggableCard = React.forwardRef(function (\n  {\n    attributes,\n    isInDrag,\n    isDragActive,\n    dragPosition,\n    dropOverBefore,\n    placeholderStyle,\n    isDraggedOver,\n    className,\n    ...cardProps\n  }: CardItemProps & RenderDraggableProps,\n  ref: React.ForwardedRef<HTMLDivElement>\n) {\n  const styles = useStyles();\n  const dragRef = useRef(null);\n  const { height } = useAnimateHeight(dragRef, isInDrag);\n  const style = useMemo(\n    () => (isDragActive ? { height: isInDrag ? 0 : height } : {}),\n    [isInDrag, height, isDragActive]\n  );\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        className,\n        styles.draggableCard,\n        isInDrag && styles.noMargin\n      )}\n      {...attributes}\n    >\n      <div\n        ref={dragRef}\n        style={style}\n        className={cn(styles.dragAnimator, isInDrag && styles.hide)}\n      >\n        <CardItem {...cardProps} />\n        {isDraggedOver && (\n          <div\n            className={cn(\n              styles.draggedIndicator,\n              dragPosition && styles[`drag-${dragPosition.y}`]\n            )}\n          />\n        )}\n      </div>\n    </div>\n  );\n});\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { VertexManager } from '../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport { Note } from '../../../../../../../cfds/client/graph/vertices/note.ts';\nimport { styleguide } from '../../../../../../../styles/styleguide.ts';\nimport {\n  makeStyles,\n  cn,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { Draggable } from '../../../../../shared/dragndrop/draggable.tsx';\nimport { CardSize } from '../card-item/index.tsx';\nimport { DraggableCard } from '../card-item/draggable-card.tsx';\n\nconst useStyles = makeStyles((theme) => ({\n  item: {\n    marginBottom: styleguide.gridbase * 2,\n  },\n}));\n\nexport function BoardCard({\n  card,\n  index,\n}: {\n  card: VertexManager<Note>;\n  index: number;\n}) {\n  const styles = useStyles();\n  return (\n    <Draggable data={card} index={index}>\n      {(props, ref) => (\n        <DraggableCard\n          {...props}\n          ref={ref}\n          size={CardSize.Small}\n          key={card.key}\n          card={card}\n          className={cn(styles.item)}\n        />\n      )}\n    </Draggable>\n  );\n}\n", "import React, { useEffect, useState } from 'https://esm.sh/react@18.2.0';\nimport { layout, styleguide } from '../../../../../../../styles/index.ts';\nimport { Button } from '../../../../../../../styles/components/buttons.tsx';\nimport { IconCreateNew } from '../../../../../../../styles/components/icons/index.ts';\nimport Layer from '../../../../../../../styles/components/layer.tsx';\nimport { H4 } from '../../../../../../../styles/components/texts.tsx';\nimport {\n  cn,\n  makeStyles,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { useScrollParent } from '../../../../../core/react-utils/scrolling.tsx';\nimport {\n  Droppable,\n  DroppableProps,\n} from '../../../../../shared/dragndrop/droppable.tsx';\n\nconst useStyles = makeStyles((theme) => ({\n  column: {\n    marginTop: styleguide.gridbase,\n    position: 'relative',\n    maxWidth: styleguide.gridbase * 40,\n    minWidth: styleguide.gridbase * 30,\n    flexShrink: 0,\n    flexBasis: '33%',\n    boxSizing: 'border-box',\n    marginRight: styleguide.gridbase,\n    backgroundColor: theme.background[400],\n    borderRadius: 4,\n  },\n  columnHeader: {\n    paddingBottom: styleguide.gridbase,\n    alignItems: 'center',\n    basedOn: [layout.row],\n  },\n  columnTitle: {\n    background: 'inherit',\n    position: 'sticky',\n    top: 0,\n    padding: styleguide.gridbase,\n    ...styleguide.transition.short,\n    transitionProperty: 'box-shadow',\n  },\n  stickyShadow: {\n    boxShadow: theme.shadows.z1,\n  },\n  stickyNotifier: {\n    backgroundColor: 'yellow',\n    position: 'absolute',\n    visibility: 'hidden',\n    width: '100%',\n    top: -styleguide.gridbase,\n    height: 1,\n  },\n  titleText: {},\n  columnContent: {\n    boxSizing: 'border-box',\n    padding: styleguide.gridbase,\n    width: '100%',\n  },\n  item: {\n    marginBottom: styleguide.gridbase * 2,\n  },\n}));\n\nexport interface BoardColumnProps<T> extends DroppableProps<T> {\n  title: string;\n  onCreateCard?: () => void;\n  children: React.ReactNode;\n}\n\nexport interface ColumnTitleProps {\n  title: string;\n  onCreateCard?: () => void;\n}\n\nfunction ColumnTitle({ title, onCreateCard }: ColumnTitleProps) {\n  const styles = useStyles();\n  const [sentinel, setSentinel] = useState<HTMLDivElement | null>(null);\n  const scrollParent = useScrollParent();\n  const [isSticky, setIsSticky] = useState(false);\n\n  useEffect(() => {\n    if (!sentinel) {\n      return;\n    }\n\n    const observer = new IntersectionObserver(\n      (records) => {\n        for (const record of records) {\n          const targetInfo = record.boundingClientRect;\n          const rootBoundsInfo = record.rootBounds;\n          if (targetInfo.bottom < (rootBoundsInfo?.top || 0)) {\n            setIsSticky(true);\n          }\n\n          if (\n            targetInfo.bottom > (rootBoundsInfo?.top || 0) &&\n            targetInfo.bottom < (rootBoundsInfo?.bottom || 0)\n          ) {\n            setIsSticky(false);\n          }\n        }\n      },\n      { threshold: [0], root: scrollParent }\n    );\n    observer.observe(sentinel);\n    return () => {\n      observer.disconnect();\n    };\n  }, [sentinel, scrollParent]);\n  return (\n    <Layer>\n      {(style) => (\n        <div\n          className={cn(styles.columnTitle, isSticky && styles.stickyShadow)}\n          style={style}\n        >\n          <div className={cn(styles.columnHeader)}>\n            <H4 className={cn(styles.titleText)}>{title}</H4>\n            <div className={cn(layout.flexSpacer)} />\n            {onCreateCard && (\n              <Button onClick={onCreateCard}>\n                <IconCreateNew />\n              </Button>\n            )}\n          </div>\n          <div\n            className={cn(styles.stickyNotifier)}\n            ref={(ref) => setSentinel(ref)}\n          />\n        </div>\n      )}\n    </Layer>\n  );\n}\n\nexport function Column<T>({\n  children,\n  title,\n  onCreateCard,\n  ...rest\n}: BoardColumnProps<T>) {\n  const styles = useStyles();\n  return (\n    <div className={cn(styles.column)} /*{...rest}*/>\n      <ColumnTitle title={title} onCreateCard={onCreateCard} {...rest} />\n      <div className={cn(styles.columnContent)}>{children}</div>\n    </div>\n  );\n}\n\n// export const BoardColumn: React.FC<\n//   Omit<DroppableProps<VertexManager<Note>>, 'children'> & BoardColumnProps\n// > = ({ title, children, ...props }) => {\nexport function BoardColumn<T>({\n  title,\n  children,\n  ...props\n}: BoardColumnProps<T>) {\n  return (\n    <Droppable<T> {...props}>\n      {(droppableProps) => (\n        <Column {...droppableProps.attributes} title={title}>\n          {children}\n        </Column>\n      )}\n    </Droppable>\n  );\n}\n", "{\n  \"en\": {\n    \"userNotInWorkspace\": \"Selected user is not a part of {workspace} workspace\",\n    \"tagNotInWorkspace\": \"Tag `{tag}` does not exist in `{workspace}` workspace\",\n    \"invite\": \"Invite\",\n    \"unassigned\": \"Unassigned\",\n    \"dragNotSupported\": \"Drag and drop is not allowed in this view\"\n  }\n}", "import React, { useCallback, useMemo } from 'https://esm.sh/react@18.2.0';\nimport { VertexManager } from '../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport {\n  Note,\n  User,\n} from '../../../../../../../cfds/client/graph/vertices/index.ts';\nimport { sortMngStampCompare } from '../../../../../../../cfds/client/sorting.ts';\nimport {\n  usePartialVertices,\n  useVertices,\n} from '../../../../../core/cfds/react/vertex.ts';\nimport {\n  createUseStrings,\n  format,\n} from '../../../../../core/localization/index.tsx';\nimport {\n  CANCELLATION_REASONS,\n  DragAndDropContext,\n  DragSource,\n} from '../../../../../shared/dragndrop/index.ts';\nimport { DragPosition } from '../../../../../shared/dragndrop/droppable.tsx';\nimport { useToastController } from '../../../../../../../styles/components/toast/index.tsx';\nimport { setDragSort } from '../card-item/draggable-card.tsx';\nimport { BoardCard } from './board-card.tsx';\nimport { BoardColumn } from './board-column.tsx';\nimport localization from './board.strings.json' assert { type: 'json' };\nimport {\n  GroupId,\n  Query,\n} from '../../../../../../../cfds/client/graph/query.ts';\nimport { useQuery2 } from '../../../../../core/cfds/react/query.ts';\nimport { useLogger } from '../../../../../core/cfds/react/logger.tsx';\nimport {\n  mapIterable,\n  filterIterable,\n} from '../../../../../../../base/common.ts';\nimport { coreValueCompare } from '../../../../../../../base/core-types/comparable.ts';\n\nexport interface AssigneesBoardViewProps {\n  query: Query<Note>;\n}\n\ninterface AssigneesDnDContext {\n  user: VertexManager<User> | undefined;\n  card: VertexManager<Note>;\n}\n\nconst useStrings = createUseStrings(localization);\n\nexport function AssigneesBoardView({ query }: AssigneesBoardViewProps) {\n  useQuery2(query);\n  const logger = useLogger();\n  const strings = useStrings();\n  const toast = useToastController();\n  const sortedUsers = usePartialVertices<User>(\n    filterIterable(\n      query.groups.keys(),\n      (id: GroupId | undefined) => typeof id !== 'undefined'\n    ),\n    ['name']\n  ).sort(coreValueCompare);\n  const onDragCancelled = useCallback(\n    ({\n      reason,\n      context,\n    }: {\n      reason: CANCELLATION_REASONS;\n      context?: AssigneesDnDContext;\n    }) => {\n      if (reason === CANCELLATION_REASONS.NOT_ALLOWED) {\n        logger.log({\n          severity: 'INFO',\n          event: 'Cancel',\n          flow: 'dnd',\n          type: 'assignee',\n          reason: 'denied',\n          source: 'board',\n          added: context?.user?.key,\n          vertex: context?.card.key,\n        });\n        const wsName = context?.card.vertex.workspace.name;\n        toast.displayToast({\n          duration: 5000,\n          text: format(strings.userNotInWorkspace, { workspace: wsName }),\n          // action: {\n          //   text: strings.invite,\n          //   fn: dismiss => {\n          //     dismiss();\n          //   },\n          // },\n        });\n      }\n    },\n    [toast, strings, logger]\n  );\n\n  const onDrop = (\n    // sourceUser: VertexManager<User> | undefined,\n    destinationUser: VertexManager<User>, // | undefined,\n    items: readonly VertexManager<Note>[],\n    item: VertexManager<Note>,\n    relativeTo: VertexManager<Note>,\n    dragPosition: DragPosition\n  ) => {\n    const card = item.getVertexProxy();\n    logger.log({\n      severity: 'INFO',\n      event: 'End',\n      flow: 'dnd',\n      type: 'assignee',\n      vertex: item.key,\n      source: 'board',\n      added: destinationUser?.key,\n      removed: Array.from(card.assignees).map((u) => u.key),\n    });\n    // if (typeof destinationUser === 'undefined') {\n    card.clearAssignees();\n    // } else {\n    // if (sourceUser) {\n    // card.assignees.delete(sourceUser.vertex);\n    // }\n    card.assignees.add(destinationUser.vertex);\n    // }\n    setDragSort(items, item, relativeTo, dragPosition);\n  };\n\n  const allowsDrop = (user: User | undefined, note: Note) => {\n    if (typeof user === 'undefined') {\n      return true;\n    }\n    return (\n      note.workspace.users.has(user) || {\n        isAllowed: false,\n        context: {\n          user: user?.manager,\n          card: note.manager,\n        } as AssigneesDnDContext,\n      }\n    );\n  };\n\n  return (\n    <DragAndDropContext onDragCancelled={onDragCancelled}>\n      {sortedUsers.map((user) => (\n        <BoardColumn\n          title={user ? user.name : strings.unassigned}\n          key={user?.key}\n          items={query.groups.get(user?.key)!}\n          allowsDrop={(item) => allowsDrop(user as User, item)}\n          onDrop={(item, relativeTo, dragPosition) =>\n            onDrop(\n              user!.manager,\n              query.groups.get(user?.key)!,\n              item,\n              relativeTo,\n              dragPosition\n            )\n          }\n        >\n          {query.groups.get(user?.key)!.map((card, index) => (\n            <BoardCard card={card} index={index} key={card.key} />\n          ))}\n        </BoardColumn>\n      ))}\n    </DragAndDropContext>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { VertexManager } from '../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport {\n  Note,\n  Tag,\n} from '../../../../../../../cfds/client/graph/vertices/index.ts';\nimport { usePartialVertices } from '../../../../../core/cfds/react/vertex.ts';\nimport {\n  createUseStrings,\n  format,\n} from '../../../../../core/localization/index.tsx';\nimport { DragAndDropContext } from '../../../../../shared/dragndrop/index.ts';\nimport { DragPosition } from '../../../../../shared/dragndrop/droppable.tsx';\nimport { Query } from '../../../../../../../cfds/client/graph/query.ts';\nimport { setDragSort } from '../card-item/draggable-card.tsx';\nimport { BoardCard } from './board-card.tsx';\nimport { BoardColumn } from './board-column.tsx';\nimport localization from './board.strings.json' assert { type: 'json' };\nimport { useLogger } from '../../../../../core/cfds/react/logger.tsx';\nimport { useQuery2 } from '../../../../../core/cfds/react/query.ts';\nimport { usePartialFilter } from '../../../../index.tsx';\nimport { useGraphManager } from '../../../../../core/cfds/react/graph.tsx';\nimport {\n  filterIterable,\n  mapIterable,\n} from '../../../../../../../base/common.ts';\n\nconst useStrings = createUseStrings(localization);\n\nexport interface TagBoardViewProps {\n  query: Query<Note, Note>;\n}\n\nexport function TagBoardView({ query }: TagBoardViewProps) {\n  useQuery2(query, false);\n  const logger = useLogger();\n  const groups = query.groups;\n  const groupBy = usePartialFilter(['groupByPivot']).groupByPivot as Tag;\n  const graph = useGraphManager();\n  const childTagManagers = Array.from(\n    mapIterable(\n      filterIterable(groups.keys(), (k) => typeof k === 'string'),\n      (k) => graph.getVertexManager<Tag>(k!)\n    )\n  );\n  const sortedChildTags = usePartialVertices(childTagManagers, ['name']).sort();\n  const unassigned = groups.get(undefined);\n  const strings = useStrings();\n\n  const onDrop = (\n    tag: VertexManager<Tag> | undefined,\n    items: readonly VertexManager<Note>[],\n    item: VertexManager<Note>,\n    relativeTo: VertexManager<Note>,\n    dragPosition: DragPosition\n  ) => {\n    const note = item.getVertexProxy();\n    logger.log({\n      severity: 'INFO',\n      event: 'End',\n      flow: 'dnd',\n      vertex: item.key,\n      type: 'tag',\n      source: 'board',\n      added: tag?.key,\n      removed: tag === undefined ? note.tags.get(groupBy)?.key : undefined,\n    });\n\n    if (typeof tag === 'undefined') {\n      note.tags.delete(groupBy);\n    } else {\n      note.tags.set(groupBy, tag.vertex);\n    }\n    setDragSort(items, item, relativeTo, dragPosition);\n  };\n\n  return (\n    <DragAndDropContext>\n      {unassigned?.length || 0 > 0 ? (\n        <BoardColumn\n          key={undefined}\n          items={groups.get(undefined)!}\n          title={strings.unassigned}\n          onDrop={(...args) =>\n            onDrop(undefined, groups.get(undefined)!, ...args)\n          }\n        >\n          {groups.get(undefined)!.map((note, index) => (\n            <BoardCard key={note.key} card={note} index={index} />\n          ))}\n        </BoardColumn>\n      ) : null}\n      {sortedChildTags.map((tag) => (\n        <BoardColumn\n          key={tag.key}\n          items={groups.get(tag.key)!}\n          title={tag.name}\n          onDrop={(...args) =>\n            onDrop(\n              tag.manager as VertexManager<Tag>,\n              groups.get(tag.key)!,\n              ...args\n            )\n          }\n        >\n          {groups.get(tag.key)!.map((card, index) => (\n            <BoardCard key={card.key} card={card} index={index} />\n          ))}\n        </BoardColumn>\n      ))}\n    </DragAndDropContext>\n  );\n}\n", "import React, { useCallback, useMemo } from 'https://esm.sh/react@18.2.0';\nimport { VertexManager } from '../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport {\n  Note,\n  Workspace,\n} from '../../../../../../../cfds/client/graph/vertices/index.ts';\nimport { sortMngStampCompare } from '../../../../../../../cfds/client/sorting.ts';\nimport { useToastController } from '../../../../../../../styles/components/toast/index.tsx';\nimport { usePartialVertices } from '../../../../../core/cfds/react/vertex.ts';\nimport { createUseStrings } from '../../../../../core/localization/index.tsx';\nimport {\n  DragAndDropContext,\n  DragSource,\n} from '../../../../../shared/dragndrop/index.ts';\nimport { DragPosition } from '../../../../../shared/dragndrop/droppable.tsx';\nimport { BoardCard } from './board-card.tsx';\nimport { BoardColumn } from './board-column.tsx';\nimport localization from './board.strings.json' assert { type: 'json' };\nimport { useLogger } from '../../../../../core/cfds/react/logger.tsx';\nimport {\n  GroupId,\n  Query,\n} from '../../../../../../../cfds/client/graph/query.ts';\nimport { Dictionary } from '../../../../../../../base/collections/dict.ts';\nimport { mapIterable } from '../../../../../../../base/common.ts';\nimport { useGraphManager } from '../../../../../core/cfds/react/graph.tsx';\nimport { coreValueCompare } from '../../../../../../../base/core-types/comparable.ts';\nimport { useQuery2 } from '../../../../../core/cfds/react/query.ts';\n\nconst useStrings = createUseStrings(localization);\n\nexport interface WorkspaceBoardViewProps {\n  query: Query<Note, Note>;\n}\n\nexport function WorkspaceBoardView({ query }: WorkspaceBoardViewProps) {\n  useQuery2(query, false);\n  const groups = query.groups;\n  const workspaces = usePartialVertices<Workspace>(groups.keys(), [\n    'name',\n    'sortStamp',\n  ]) as Workspace[];\n  const logger = useLogger();\n  const toast = useToastController();\n  const strings = useStrings();\n  const columns = workspaces.sort(coreValueCompare);\n\n  const onDragCancelled = useCallback(() => {\n    logger.log({\n      severity: 'INFO',\n      event: 'Cancel',\n      flow: 'dnd',\n      source: 'board',\n      type: 'workspace',\n      status: 'cancelled',\n      reason: 'not-supported',\n    });\n    toast.displayToast({\n      duration: 5000,\n      text: strings.dragNotSupported,\n    });\n  }, [toast, logger, strings]);\n\n  const onDrop = (\n    workspace: VertexManager<Workspace>,\n    items: readonly VertexManager<Note>[],\n    item: VertexManager<Note>,\n    relativeTo: VertexManager<Note>,\n    dragPosition: DragPosition\n  ) => {\n    // eventLogger.cardAction('DRAG_DONE', item, {\n    //   source: DragSource.WorkspaceBoard,\n    // });\n    // moveCard(item, workspace, graph, eventLogger, CARD_SOURCE.BOARD);\n    // setDragSort(items, item, relativeTo, dragPosition);\n  };\n\n  return (\n    <DragAndDropContext onDragCancelled={onDragCancelled}>\n      {columns.map((column) => (\n        <BoardColumn\n          title={column.name}\n          key={column.key}\n          items={groups.get(column.key)!}\n          allowsDrop={() => false}\n          onDrop={(\n            item: VertexManager<Note>,\n            relativeTo: VertexManager<Note>,\n            dragPosition: DragPosition\n          ) =>\n            onDrop(\n              column.manager as VertexManager<Workspace>,\n              groups.get(column.key)!,\n              item,\n              relativeTo,\n              dragPosition\n            )\n          }\n        >\n          {groups.get(column.key)!.map((card, index) => (\n            <BoardCard card={card} index={index} key={card.key} />\n          ))}\n        </BoardColumn>\n      ))}\n    </DragAndDropContext>\n  );\n}\n", "import React, { ReactFragment, useMemo } from 'https://esm.sh/react@18.2.0';\nimport { layout, styleguide } from '../../../../../../../styles/index.ts';\nimport {\n  cn,\n  makeStyles,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport {\n  usePartialVertices,\n  useVertex,\n} from '../../../../../core/cfds/react/vertex.ts';\nimport { Scroller } from '../../../../../core/react-utils/scrolling.tsx';\nimport { GroupBy } from '../display-bar/index.tsx';\nimport { AssigneesBoardView } from './assignees-board-view.tsx';\nimport { TagBoardView } from './tag-board-view.tsx';\nimport { WorkspaceBoardView } from './workspace-board-view.tsx';\nimport { Filter } from '../../../../../../../cfds/client/graph/vertices/filter.ts';\nimport { useQuery2 } from '../../../../../core/cfds/react/query.ts';\nimport { VertexManager } from '../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport { useFilter } from '../../../../index.tsx';\n\nconst useStyles = makeStyles((theme) => ({\n  boardRoot: {\n    overflowY: 'auto',\n    height: '100%',\n    paddingBottom: styleguide.gridbase * 2,\n    boxSizing: 'border-box',\n    alignItems: 'flex-start',\n    basedOn: [layout.row],\n  },\n}));\n\nexport interface BoardViewProps {\n  className?: string;\n}\n\n// type PartialTaskData = Partial<TypeOfScheme<typeof NOTE_SCHEME>>;\n// type TaskData = PartialTaskData & Required<Pick<PartialTaskData, 'workspace'>>;\n\nexport function BoardView({ className }: BoardViewProps) {\n  const styles = useStyles();\n  const filter = useFilter();\n  const query = useQuery2(filter.buildQuery('BoardView'));\n\n  let content: React.ReactNode = null;\n  // const onCreateCard = (data: TaskData) => {\n  //   const workspace = selectedWorkspaces.find(x => x.key === data.workspace);\n  //   if (!workspace) {\n  //     return;\n  //   }\n  //   const ws = workspace.getVertexProxy();\n  //   const tagsMap = new COWMap(\n  //     Array.from(noteType === NoteType.Note ? ws.noteTags : ws.taskTags).map(\n  //       ([p, t]) => [p.key, t.key]\n  //     )\n  //   );\n\n  //   const baseData: PartialTaskData = {\n  //     createdBy: graph.rootKey,\n  //     title: emptyDoc(),\n  //     body: emptyDoc(),\n  //     type: noteType,\n  //     assignees: new Set<string>([graph.rootKey]),\n  //     tags: tagsMap,\n  //     creationDate: new Date(),\n  //   };\n  //   const card = graph.createVertex<Note>(NS_NOTES, {\n  //     ...baseData,\n  //     ...data,\n  //   });\n\n  //   docRouter.goTo(card);\n  // };\n\n  const groupBy = filter.groupBy;\n\n  if (groupBy === 'workspace') {\n    content = <WorkspaceBoardView query={query} />;\n  } else if (groupBy === 'tag') {\n    content = <TagBoardView query={query} />;\n  } else {\n    content = <AssigneesBoardView query={query} />;\n  }\n\n  return (\n    <Scroller>\n      {(ref) => (\n        <div ref={ref} className={cn(styles.boardRoot, className)}>\n          {content}\n        </div>\n      )}\n    </Scroller>\n  );\n}\n", "{\n  \"en\": {\n    \"list\": \"List View\",\n    \"group\": \"Group View\",\n    \"board\": \"Board View\",\n    \"priority\": \"Priority\",\n    \"groupBy\": \"Group By\",\n    \"created\": \"Date Created\",\n    \"modified\": \"Date Modified\",\n    \"due\": \"Due Date\",\n    \"workspace\": \"Workspace\",\n    \"assignee\": \"Assignee\",\n    \"tag\": \"Tag\",\n    \"groupByTag\": \"Tag...\",\n    \"filter\": \"Filter\",\n    \"searchResults\": \"Search Results\",\n    \"compose\": \"Compose\",\n    \"task\": \"Tasks\",\n    \"note\": \"Notes\",\n    \"newTask\": \"New Task\",\n    \"newNote\": \"New Note\",\n    \"search\": \"Search...\",\n    \"clear\": \"Clear\"\n  }\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { IconSize, IconProps } from './types.ts';\n\nexport function IconSort({ size = IconSize.Small, className }: IconProps) {\n  return (\n    <svg\n      className={className}\n      width={size}\n      height={size}\n      viewBox=\"0 0 17 17\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        opacity=\"0.6\"\n        d=\"M9.00012 5H14.5001\"\n        stroke=\"#262626\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M9.00012 1H16.0001\"\n        stroke=\"#262626\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M9.00012 9H13.0001\"\n        stroke=\"#262626\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M4.79822 15.0254L1.99821 12.4004\"\n        stroke=\"#262626\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M7.59802 12.4004L4.79801 15.0254\"\n        stroke=\"#262626\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M4.79968 1V15\"\n        stroke=\"#262626\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n    </svg>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { IconSize, IconProps } from './types.ts';\n\nexport function IconFilter({ size = IconSize.Small, className }: IconProps) {\n  return (\n    <svg\n      className={className}\n      width={size}\n      height={size}\n      viewBox=\"0 0 16 17\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <circle\n        opacity=\"0.6\"\n        cx=\"2.75\"\n        cy=\"11.125\"\n        r=\"1.75\"\n        transform=\"rotate(-90 2.75 11.125)\"\n        stroke=\"#262626\"\n        strokeWidth=\"2\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M2.75 15.5L2.75 12.875\"\n        stroke=\"#262626\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M2.75 9.375L2.75 1.5\"\n        stroke=\"#262626\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <circle\n        opacity=\"0.6\"\n        cx=\"13.25\"\n        cy=\"11.125\"\n        r=\"1.75\"\n        transform=\"rotate(-90 13.25 11.125)\"\n        stroke=\"#262626\"\n        strokeWidth=\"2\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M13.25 15.5L13.25 12.875\"\n        stroke=\"#262626\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M13.25 9.375L13.25 1.5\"\n        stroke=\"#262626\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <circle\n        opacity=\"0.6\"\n        cx=\"8\"\n        cy=\"5.875\"\n        r=\"1.75\"\n        transform=\"rotate(-90 8 5.875)\"\n        stroke=\"#262626\"\n        strokeWidth=\"2\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M8 15.5L8 7.625\"\n        stroke=\"#262626\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M8 4.125L8 1.5\"\n        stroke=\"#262626\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n    </svg>\n  );\n}\n", "import React, { MouseEvent } from 'https://esm.sh/react@18.2.0';\nimport { makeStyles, cn } from '../../css-objects/index.ts';\nimport { styleguide } from '../../styleguide.ts';\nimport { layout } from '../../layout.ts';\nimport { Button } from '../buttons.tsx';\nimport { brandLightTheme } from '../../theme.tsx';\nimport { useTypographyStyles } from '../typography.tsx';\nimport { NoteType } from '../../../cfds/client/graph/vertices/note.ts';\n\nconst useStyles = makeStyles(\n  (theme) => ({\n    header: {\n      position: 'relative',\n      basedOn: [layout.row],\n    },\n    tab: {\n      height: styleguide.gridbase * 6,\n      color: brandLightTheme.colors.text,\n      borderBottom: `1px solid ${brandLightTheme.supporting.O1}`,\n      transitionDuration: `${styleguide.transition.duration.standard}ms`,\n      transitionProperty: 'color',\n      transitionTimingFunction: 'linear',\n      basedOn: [layout.row, layout.centerCenter, useTypographyStyles.h5],\n    },\n    selected: {\n      ...useTypographyStyles.label.rules,\n    },\n    selectedTabIndicator: {\n      position: 'absolute',\n      bottom: 0,\n      left: 0,\n      height: 2,\n      transform: 'translateX(0)',\n      backgroundColor: brandLightTheme.supporting.O2,\n      ...styleguide.transition.standard,\n      transitionProperty: 'transform',\n    },\n    tabsRoot: {\n      width: '100%',\n      boxSizing: 'border-box',\n      overflow: 'hidden',\n    },\n    tabsFlipper: {\n      flexShrink: 0,\n      overflow: 'visible',\n      ...styleguide.transition.standard,\n      transitionProperty: 'transform',\n      basedOn: [layout.row],\n    },\n  }),\n  'tabs_3a7361'\n);\n\nexport interface TabButtonProps {\n  children: any;\n  renderContent?: any;\n  value: any;\n  style?: any;\n  isSelected?: boolean;\n  setSelected?: any;\n  className?: string;\n  onSelected?: (value: any) => void;\n}\nexport function TabButton({\n  children,\n  renderContent,\n  value,\n  style,\n  isSelected,\n  setSelected,\n  className,\n  onSelected,\n}: TabButtonProps) {\n  const styles = useStyles();\n  const onClick = (e: MouseEvent) => {\n    e.stopPropagation();\n    setSelected(value);\n    if (onSelected) {\n      onSelected(value);\n    }\n  };\n\n  const content = renderContent ? renderContent({ isSelected }) : children;\n\n  return (\n    <Button\n      className={cn(styles.tab, isSelected && styles.selected, className)}\n      style={style}\n      onClick={onClick}\n    >\n      {content}\n    </Button>\n  );\n}\n\nexport interface TabsHeaderProps extends React.PropsWithChildren {\n  selected: NoteType;\n  setSelected: (type: NoteType) => void;\n  className?: string;\n}\nexport function TabsHeader({\n  children,\n  selected,\n  setSelected,\n  className,\n}: TabsHeaderProps) {\n  const styles = useStyles();\n  const count = React.Children.count(children);\n  let selectedIndex = 0;\n  return (\n    <div className={cn(styles.header, className)}>\n      {React.Children.map(children, (tab, i) => {\n        if (!React.isValidElement(tab)) {\n          return tab;\n        }\n\n        const { value } = tab.props as TabProps;\n        const style = (tab.props as TabProps).style || {};\n        const isSelected = value === selected;\n        if (isSelected) {\n          selectedIndex = i;\n        }\n        const newProps = {\n          isSelected: isSelected,\n          setSelected,\n          style: {\n            ...style,\n            flexBasis: `${100 / count}%`,\n          },\n        };\n\n        return React.cloneElement(tab, newProps);\n      })}\n      <div\n        className={cn(styles.selectedTabIndicator)}\n        style={{\n          width: `${100 / count}%`,\n          transform: `translateX(${100 * selectedIndex}%)`,\n        }}\n      />\n    </div>\n  );\n}\n\nexport interface TabsProps extends React.PropsWithChildren {\n  selectedTab: NoteType;\n  className?: string;\n}\nexport function Tabs({ children, selectedTab, className }: TabsProps) {\n  const styles = useStyles();\n  let length = React.Children.count(children);\n  let selectedIndex = 0;\n\n  React.Children.forEach(children, (tab, index) => {\n    if (!React.isValidElement(tab)) {\n      length--;\n      return;\n    }\n    if ((tab.props as TabProps).value === selectedTab) {\n      selectedIndex = index;\n    }\n  });\n  const style = {\n    transform: `translateX(${(-100 / length) * selectedIndex}%)`,\n    width: `${length * 100}%`,\n  };\n\n  const mappedChildren = React.Children.map(children, (tab, i) => {\n    if (!React.isValidElement(tab)) {\n      return tab;\n    }\n    const style = (tab.props as TabProps).style || {};\n    const newProps = {\n      style: {\n        ...style,\n        width: `${100 / length}%`,\n      },\n    };\n\n    return React.cloneElement(tab, newProps);\n  });\n\n  return (\n    <div className={cn(styles.tabsRoot, className)}>\n      <div className={cn(styles.tabsFlipper)} style={style}>\n        {mappedChildren}\n      </div>\n    </div>\n  );\n}\n\nexport interface TabProps<TV = any> extends React.PropsWithChildren {\n  style?: any;\n  className?: string;\n  value: TV;\n}\nexport function Tab<TV>({ children, style, className }: TabProps<TV>) {\n  return (\n    <div style={style} className={className}>\n      {children}\n    </div>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { IconProps, IconSize } from './types.ts';\n\nexport function IconCompose({ size = IconSize.Small, className }: IconProps) {\n  return (\n    <svg\n      className={className}\n      width={size}\n      height={size}\n      viewBox=\"0 0 17 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <g clipPath=\"url(#clip0_1176_37502)\">\n        <path\n          opacity=\"0.7\"\n          d=\"M5 13.2578L2.87868 11.1365\"\n          stroke=\"white\"\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.7\"\n          d=\"M5 13.2578L14.8995 3.35832\"\n          stroke=\"white\"\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.7\"\n          d=\"M10.6565 3.35817L12.7778 5.47949\"\n          stroke=\"white\"\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.7\"\n          d=\"M12.657 1.35817L14.7783 3.47949\"\n          stroke=\"white\"\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.7\"\n          d=\"M2.87854 11.1362L12.778 1.23674\"\n          stroke=\"white\"\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.7\"\n          d=\"M2.87868 11.1365L5 13.2578\"\n          stroke=\"white\"\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.7\"\n          d=\"M1.81825 14.3182L5.00023 13.2576\"\n          stroke=\"white\"\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.7\"\n          d=\"M1.81842 14.3184L2.87908 11.1364\"\n          stroke=\"white\"\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.6\"\n          d=\"M12.5962 3.53996L14.364 5.30773C15.145 6.08878 15.145 7.35511 14.364 8.13615L13.6568 8.84326\"\n          stroke=\"#F5F9FB\"\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n      </g>\n      <defs>\n        <clipPath id=\"clip0_1176_37502\">\n          <rect\n            width=\"16\"\n            height=\"16\"\n            fill=\"white\"\n            transform=\"translate(0.5)\"\n          />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n", "import React, { useCallback, useState } from 'https://esm.sh/react@18.2.0';\nimport { Workspace } from '../../../../../../../cfds/client/graph/vertices/workspace.ts';\nimport {\n  Note,\n  NoteType,\n} from '../../../../../../../cfds/client/graph/vertices/note.ts';\nimport { layout, styleguide } from '../../../../../../../styles/index.ts';\nimport { Button } from '../../../../../../../styles/components/buttons.tsx';\nimport Menu from '../../../../../../../styles/components/menu.tsx';\nimport { IconCompose } from '../../../../../../../styles/components/new-icons/icon-compose.tsx';\nimport { useTypographyStyles } from '../../../../../../../styles/components/typography.tsx';\nimport {\n  cn,\n  makeStyles,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { MediaQueries } from '../../../../../../../styles/responsive.ts';\nimport { brandLightTheme as theme } from '../../../../../../../styles/theme.tsx';\nimport { createUseStrings } from '../../../../../core/localization/index.tsx';\nimport { useDocumentRouter } from '../../../../../core/react-utils/index.ts';\nimport { SelectWorkspaceMenu } from '../card-item/workspace-indicator.tsx';\nimport localization from '../cards-display.strings.json' assert { type: 'json' };\nimport { useLogger } from '../../../../../core/cfds/react/logger.tsx';\nimport { NS_NOTES } from '../../../../../../../cfds/base/scheme-types.ts';\nimport { createNewNote } from '../../../../../shared/card/create.ts';\nimport { useSharedQuery } from '../../../../../core/cfds/react/query.ts';\nimport { useGraphManager } from '../../../../../core/cfds/react/graph.tsx';\nimport { VertexId } from '../../../../../../../cfds/client/graph/vertex.ts';\n\nconst useStyles = makeStyles(() => ({\n  compose: {\n    background: theme.colors.primaryButton,\n    height: styleguide.gridbase * 4,\n    boxSizing: 'border-box',\n    padding: [0, styleguide.gridbase],\n    borderRadius: styleguide.gridbase * 2,\n    ...styleguide.transition.short,\n    transitionProperty: 'box-shadow',\n    ':hover': {\n      boxShadow: theme.shadows.z2,\n    },\n    alignItems: 'center',\n    basedOn: [layout.row],\n  },\n  text: {\n    color: theme.colors.primaryButtonText,\n    padding: [0, styleguide.gridbase],\n    basedOn: [useTypographyStyles.button],\n    [MediaQueries.TabletAndMobile]: {\n      display: 'none',\n    },\n  },\n  workspacesList: {\n    maxHeight: styleguide.gridbase * 30,\n    overflowY: 'auto',\n  },\n}));\n\nconst useStrings = createUseStrings(localization);\n\nconst ComposeInternalButton = React.forwardRef(\n  (\n    { className }: { className?: string },\n    ref: React.ForwardedRef<HTMLDivElement>\n  ) => {\n    const styles = useStyles();\n    const strings = useStrings();\n\n    return (\n      <div className={cn(styles.compose, className)} ref={ref}>\n        <IconCompose />\n        <span className={cn(styles.text)}>{strings.compose}</span>\n      </div>\n    );\n  }\n);\n\nexport function ComposeButton() {\n  const styles = useStyles();\n  const logger = useLogger();\n  const docRouter = useDocumentRouter();\n  const selectedWorkspacesQuery = useSharedQuery('selectedWorkspaces');\n  const [container, setContainer] = useState<HTMLDivElement | null>(null);\n  const graph = useGraphManager();\n\n  const createCard = useCallback(\n    (ws: VertexId<Workspace>) => {\n      const note = createNewNote(graph, ws, {\n        type: NoteType.Note,\n      });\n\n      logger.log({\n        severity: 'INFO',\n        event: 'Create',\n        type: 'note',\n        source: 'toolbar:compose',\n        vertex: note.key,\n      });\n\n      docRouter.goTo(note);\n    },\n    [logger, graph, docRouter]\n  );\n\n  if (selectedWorkspacesQuery.count === 1) {\n    return (\n      <Button onClick={() => createCard(selectedWorkspacesQuery.results[0])}>\n        <ComposeInternalButton ref={(div) => setContainer(div)} />\n      </Button>\n    );\n  }\n  return (\n    <Menu\n      renderButton={() => (\n        <ComposeInternalButton ref={(div) => setContainer(div)} />\n      )}\n      position=\"right\"\n      align=\"center\"\n      direction=\"in\"\n      popupClassName={cn(styles.workspacesList)}\n    >\n      <SelectWorkspaceMenu value={null} onChange={(ws) => createCard(ws)} />\n      {/* {selectedWorkspaces.map(workspace => (\n        <MenuItem\n          key={workspace.key}\n          onClick={() => createCard(workspace.getVertexProxy())}\n        >\n          <WorkspaceItem workspace={workspace} />\n        </MenuItem>\n      ))} */}\n    </Menu>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { IconProps, IconSize } from './types.ts';\n\nexport function IconGroup({ size = IconSize.Small, className }: IconProps) {\n  return (\n    <svg\n      className={className}\n      width={size}\n      height={size}\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        opacity=\"0.7\"\n        d=\"M1 1H15\"\n        stroke=\"#262626\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M1 15H15\"\n        stroke=\"#262626\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M15 1L15 15\"\n        stroke=\"#262626\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M1 1L0.999999 15\"\n        stroke=\"#262626\"\n        stroke-width=\"2\"\n        stroke-linecap=\"round\"\n      />\n      <rect\n        opacity=\"0.7\"\n        x=\"4.5\"\n        y=\"4.5\"\n        width=\"2\"\n        height=\"2\"\n        stroke=\"#262626\"\n        stroke-width=\"2\"\n        stroke-linejoin=\"round\"\n      />\n      <rect\n        opacity=\"0.7\"\n        x=\"4.5\"\n        y=\"9.5\"\n        width=\"2\"\n        height=\"2\"\n        stroke=\"#262626\"\n        stroke-width=\"2\"\n        stroke-linejoin=\"round\"\n      />\n      <rect\n        opacity=\"0.7\"\n        x=\"9.5\"\n        y=\"4.5\"\n        width=\"2\"\n        height=\"2\"\n        stroke=\"#262626\"\n        stroke-width=\"2\"\n        stroke-linejoin=\"round\"\n      />\n      <rect\n        opacity=\"0.7\"\n        x=\"9.5\"\n        y=\"9.5\"\n        width=\"2\"\n        height=\"2\"\n        stroke=\"#262626\"\n        stroke-width=\"2\"\n        stroke-linejoin=\"round\"\n      />\n    </svg>\n  );\n}\n", "import React, { useCallback } from 'https://esm.sh/react@18.2.0';\nimport { VertexManager } from '../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport { layout, styleguide } from '../../../../../../../styles/index.ts';\nimport { IconGroup } from '../../../../../../../styles/components/new-icons/icon-group.tsx';\nimport Menu, {\n  MenuItem,\n  SecondaryMenuItem,\n} from '../../../../../../../styles/components/menu.tsx';\nimport { Text } from '../../../../../../../styles/components/texts.tsx';\nimport {\n  cn,\n  makeStyles,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { createUseStrings } from '../../../../../core/localization/index.tsx';\nimport localization from '../cards-display.strings.json' assert { type: 'json' };\nimport { useLogger } from '../../../../../core/cfds/react/logger.tsx';\nimport { usePartialFilter } from '../../../../index.tsx';\nimport { useSharedQuery } from '../../../../../core/cfds/react/query.ts';\nimport { Tag } from '../../../../../../../cfds/client/graph/vertices/tag.ts';\nimport { usePartialVertex } from '../../../../../core/cfds/react/vertex.ts';\nimport { FilterGroupBy } from '../../../../../../../cfds/base/scheme-types.ts';\nimport { VertexId } from '../../../../../../../cfds/client/graph/vertex.ts';\n\nconst useStyles = makeStyles((theme) => ({\n  dropDownButtonText: {\n    marginLeft: styleguide.gridbase,\n  },\n  dropDownButton: {\n    marginRight: styleguide.gridbase * 3,\n    basedOn: [layout.row, layout.centerCenter],\n  },\n}));\n\nconst useStrings = createUseStrings(localization);\n\ninterface GroupByTagButtonProps {\n  tag: VertexId<Tag>;\n}\n\nfunction GroupByTagButton({ tag }: GroupByTagButtonProps) {\n  const { parentTag, name: childName } = usePartialVertex(tag, [\n    'parentTag',\n    'name',\n  ]);\n  const { name: parentName } = usePartialVertex(parentTag!.manager, ['name']);\n  return <Text>{`${parentName}/${childName}`}</Text>;\n}\n\nexport function GroupByDropDown() {\n  const styles = useStyles();\n  const logger = useLogger();\n  const strings = useStrings();\n  const partialFilter = usePartialFilter(['groupBy', 'groupByPivot']);\n  const parentTagsQuery = useSharedQuery('parentTags');\n\n  const setGroup = useCallback(\n    (group: 'assignee' | 'workspace') => {\n      logger.log({\n        severity: 'INFO',\n        event: 'FilterChange',\n        type: ('groupBy:' + group) as FilterGroupBy,\n      });\n      partialFilter.groupBy = group;\n    },\n    [logger, partialFilter]\n  );\n  const renderButton = useCallback(() => {\n    const content =\n      partialFilter.groupBy === 'tag' ? (\n        <GroupByTagButton\n          tag={partialFilter.groupByPivot!.manager as VertexManager<Tag>}\n        />\n      ) : (\n        <Text>{strings[partialFilter.groupBy!]}</Text>\n      );\n\n    return (\n      <div className={cn(styles.dropDownButton)}>\n        <IconGroup />\n        <Text className={cn(styles.dropDownButtonText)}>\n          {strings.groupBy}:&nbsp;\n        </Text>\n        {content}\n      </div>\n    );\n  }, [strings, partialFilter, styles]);\n\n  const setTag = useCallback(\n    (tag: Tag) => {\n      logger.log({\n        severity: 'INFO',\n        event: 'FilterChange',\n        type: 'groupBy:tag',\n        vertex: tag.key,\n      });\n      partialFilter.groupBy = 'tag';\n      partialFilter.groupByPivot = tag;\n    },\n    [logger, partialFilter]\n  );\n\n  return (\n    <Menu renderButton={renderButton} align=\"start\">\n      <MenuItem onClick={() => setGroup('workspace')}>\n        {strings.workspace}\n      </MenuItem>\n      <MenuItem onClick={() => setGroup('assignee')}>\n        {strings.assignee}\n      </MenuItem>\n      <SecondaryMenuItem text={strings.groupByTag}>\n        {parentTagsQuery.map((tag) => (\n          <MenuItem key={tag.key} onClick={() => setTag(tag)}>\n            {tag.name}\n          </MenuItem>\n        ))}\n      </SecondaryMenuItem>\n    </Menu>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { brandLightTheme } from '../../theme.tsx';\nimport { IconProps, IconSize } from './types.ts';\n\nexport interface IconListViewProps extends IconProps {\n  isToggled: boolean;\n}\n\nexport function IconListView({\n  size = IconSize.Medium,\n  className,\n  isToggled,\n}: IconListViewProps) {\n  const color = isToggled\n    ? brandLightTheme.colors.toggleButtonActiveIcon\n    : brandLightTheme.colors.toggleButtonInactiveIcon;\n\n  return (\n    <svg\n      width={size}\n      height={size}\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M2.99988 5.47693H20.723\"\n        stroke={color}\n        strokeWidth=\"3\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        d=\"M2.99988 12.0004H20.723\"\n        stroke={color}\n        strokeWidth=\"3\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        d=\"M2.99988 18.5228H20.723\"\n        stroke={color}\n        strokeWidth=\"3\"\n        strokeLinecap=\"round\"\n      />\n    </svg>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { brandLightTheme } from '../../theme.tsx';\nimport { IconProps, IconSize } from './types.ts';\n\ninterface IconBoardViewProps extends IconProps {\n  isToggled: boolean;\n}\n\nexport function IconBoardView({\n  size = IconSize.Medium,\n  className,\n  isToggled,\n}: IconBoardViewProps) {\n  const color = isToggled\n    ? brandLightTheme.colors.toggleButtonActiveIcon\n    : brandLightTheme.colors.toggleButtonInactiveIcon;\n\n  return (\n    <svg\n      className={className}\n      width={size}\n      height={size}\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M3 3C2.44772 3 2 3.44772 2 4L2 11C2 11.5523 2.44772 12 3 12H7C7.55229 12 8 11.5523 8 11V4C8 3.44772 7.55229 3 7 3L3 3Z\"\n        fill={color}\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M10.4998 3C9.94747 3 9.49976 3.44772 9.49976 4L9.49976 20C9.49976 20.5523 9.94747 21 10.4998 21H14.4998C15.052 21 15.4998 20.5523 15.4998 20L15.4998 4C15.4998 3.44772 15.052 3 14.4998 3L10.4998 3Z\"\n        fill={color}\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M18.0002 3C17.448 3 17.0002 3.44772 17.0002 4L17.0002 16C17.0002 16.5523 17.448 17 18.0002 17H22.0002C22.5525 17 23.0002 16.5523 23.0002 16V4C23.0002 3.44772 22.5525 3 22.0002 3L18.0002 3Z\"\n        fill={color}\n      />\n    </svg>\n  );\n}\n", "import React, { useCallback } from 'https://esm.sh/react@18.2.0';\nimport { layout, styleguide } from '../../../../../../../styles/index.ts';\nimport { Button } from '../../../../../../../styles/components/buttons.tsx';\nimport { IconListView } from '../../../../../../../styles/components/new-icons/icon-list-view.tsx';\nimport { IconBoardView } from '../../../../../../../styles/components/new-icons/icon-board-view.tsx';\nimport Tooltip from '../../../../../../../styles/components/tooltip/index.tsx';\nimport {\n  cn,\n  makeStyles,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { createUseStrings } from '../../../../../core/localization/index.tsx';\nimport { ViewType } from './index.tsx';\nimport localization from '../cards-display.strings.json' assert { type: 'json' };\nimport { useLogger } from '../../../../../core/cfds/react/logger.tsx';\nimport {\n  FilterKeyNotes,\n  FilterKeyTasks,\n  useFilterContext,\n  usePartialFilter,\n} from '../../../../index.tsx';\nimport { NoteType } from '../../../../../../../cfds/client/graph/vertices/note.ts';\n\nconst HEIGHT = styleguide.gridbase * 4;\n\nconst useStyles = makeStyles((theme) => ({\n  container: {\n    basedOn: [layout.row],\n  },\n  toggleButton: {\n    height: HEIGHT,\n    minWidth: styleguide.gridbase * 4,\n    padding: [0, styleguide.gridbase * 1.5],\n    boxSizing: 'border-box',\n    backgroundColor: theme.background[400],\n    color: theme.background[600],\n    ':first-child': {\n      borderTopLeftRadius: HEIGHT / 2,\n      borderBottomLeftRadius: HEIGHT / 2,\n    },\n    ':last-child': {\n      borderTopRightRadius: HEIGHT / 2,\n      borderBottomRightRadius: HEIGHT / 2,\n    },\n    alignItems: 'center',\n    basedOn: [layout.row],\n  },\n  text: {\n    justifyContent: 'center',\n    basedOn: [layout.flexSpacer, layout.row],\n  },\n  selected: {\n    color: theme.background[0],\n    backgroundColor: theme.background[600],\n  },\n}));\n\nconst useStrings = createUseStrings(localization);\n\nexport interface ViewToggleProps {\n  className?: string;\n}\n\nexport function ViewToggle({ className }: ViewToggleProps) {\n  const styles = useStyles();\n  const logger = useLogger();\n  const strings = useStrings();\n  const partialFilter = usePartialFilter(['viewType']);\n\n  const setView = useCallback(\n    (type: ViewType) => {\n      logger.log({\n        severity: 'INFO',\n        event: 'Navigation',\n        type: type,\n        source: 'toolbar',\n      });\n      partialFilter.viewType = type;\n    },\n    [logger, partialFilter]\n  );\n\n  return (\n    <div className={cn(className, styles.container)}>\n      <Tooltip text={strings.list}>\n        <Button\n          className={cn(\n            styles.toggleButton,\n            partialFilter.viewType === ViewType.List && styles.selected\n          )}\n          onClick={() => setView(ViewType.List)}\n        >\n          <IconListView isToggled={partialFilter.viewType === ViewType.List} />\n        </Button>\n      </Tooltip>\n      <Tooltip text={strings.board}>\n        <Button\n          className={cn(\n            styles.toggleButton,\n            partialFilter.viewType === ViewType.Board && styles.selected\n          )}\n          onClick={() => setView(ViewType.Board)}\n        >\n          <IconBoardView\n            isToggled={partialFilter.viewType === ViewType.Board}\n          />\n        </Button>\n      </Tooltip>\n    </div>\n  );\n}\n", "import React, { useCallback } from 'https://esm.sh/react@18.2.0';\nimport { VertexManager } from '../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport { Workspace } from '../../../../../../../cfds/client/graph/vertices/workspace.ts';\nimport { NoteType } from '../../../../../../../cfds/client/graph/vertices/note.ts';\nimport { layout, styleguide } from '../../../../../../../styles/index.ts';\nimport {\n  Button,\n  useButtonStyles,\n} from '../../../../../../../styles/components/buttons.tsx';\nimport { IconSort } from '../../../../../../../styles/components/new-icons/icon-sort.tsx';\nimport { IconFilter } from '../../../../../../../styles/components/new-icons/icon-filter.tsx';\nimport DropDown, {\n  DropDownItem,\n} from '../../../../../../../styles/components/inputs/drop-down.tsx';\nimport {\n  TabButton,\n  TabsHeader,\n} from '../../../../../../../styles/components/tabs/index.tsx';\nimport { Text } from '../../../../../../../styles/components/texts.tsx';\nimport {\n  cn,\n  makeStyles,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { brandLightTheme as theme } from '../../../../../../../styles/theme.tsx';\nimport { MediaQueries } from '../../../../../../../styles/responsive.ts';\nimport { createUseStrings } from '../../../../../core/localization/index.tsx';\nimport { ToolbarRightItem } from '../../toolbar/index.tsx';\nimport localization from '../cards-display.strings.json' assert { type: 'json' };\nimport { ComposeButton } from './compose-button.tsx';\nimport { GroupByDropDown } from './group-by-drop-down.tsx';\nimport { ViewToggle } from './view-toggle.tsx';\nimport {\n  FilterSortBy,\n  FilterSortByValues,\n} from '../../../../../../../cfds/base/scheme-types.ts';\nimport { Filter } from '../../../../../../../cfds/client/graph/vertices/index.ts';\nimport { useLogger } from '../../../../../core/cfds/react/logger.tsx';\nimport {\n  FilterKeyNotes,\n  FilterKeyTasks,\n  useFilter,\n  useFilterContext,\n  usePartialFilter,\n} from '../../../../index.tsx';\nimport {\n  FilterType,\n  UISource,\n} from '../../../../../../../logging/client-events.ts';\nimport { useGraphManager } from '../../../../../core/cfds/react/graph.tsx';\n\nconst BUTTON_HEIGHT = styleguide.gridbase * 4;\nexport const SIDES_PADDING = styleguide.gridbase * 11;\nexport const MOBILE_PADDING = styleguide.gridbase;\nexport const TABLET_PADDING = styleguide.gridbase;\n\nconst useStyles = makeStyles(() => ({\n  bar: {\n    justifyContent: 'flex-end',\n    alignItems: 'stretch',\n    marginTop: styleguide.gridbase * 2,\n    boxSizing: 'border-box',\n    basedOn: [layout.column],\n  },\n  barRow: {\n    padding: [0, SIDES_PADDING],\n    height: styleguide.gridbase * 6,\n    basedOn: [layout.row, layout.centerCenter],\n  },\n  viewRow: {\n    borderBottom: `${theme.supporting.O1} 1px solid`,\n    marginBottom: styleguide.gridbase,\n    padding: 0,\n  },\n  filters: {\n    padding: [0, SIDES_PADDING],\n    [MediaQueries.TabletOnly]: {\n      padding: [0, TABLET_PADDING],\n    },\n    [MediaQueries.Mobile]: {\n      padding: [0, MOBILE_PADDING],\n    },\n  },\n  dropDownButtonText: {\n    marginLeft: styleguide.gridbase,\n  },\n  dropDownButton: {\n    marginRight: styleguide.gridbase * 3,\n    basedOn: [layout.row, layout.centerCenter],\n  },\n\n  viewToggle: {},\n  noteTypeToggle: {\n    width: styleguide.gridbase * 40,\n  },\n  separator: {\n    height: BUTTON_HEIGHT,\n    width: 1,\n    margin: [0, styleguide.gridbase],\n    background: theme.secondary.s5,\n  },\n  filterButton: {\n    height: BUTTON_HEIGHT,\n    borderRadius: BUTTON_HEIGHT * 0.5,\n    padding: [0, styleguide.gridbase * 2],\n    background: theme.colors.secondaryButton,\n    color: theme.colors.text,\n    basedOn: [useButtonStyles.button],\n  },\n  hasFilters: {\n    backgroundColor: theme.colors.secondaryButtonActive,\n  },\n}));\n\nconst useStrings = createUseStrings(localization);\n\nexport enum ViewType {\n  List = 'list',\n  // Grouped = 'grouped',\n  Board = 'board',\n}\n\ntype ExtraFiltersProps = {\n  // filters: FiltersStateController;\n  viewType: ViewType;\n  // sortBy: SortBy;\n  // setSortBy: (sortBy: SortBy) => void;\n  // groupBy: GroupBy;\n  // setGroupBy: (groupBy: GroupBy) => void;\n  // selectedWorkspaces: VertexManager<Workspace>[];\n};\n\nfunction SortByDropDown({ source }: { source?: UISource }) {\n  const styles = useStyles();\n  const strings = useStrings();\n  const logger = useLogger();\n  const partialFilter = usePartialFilter(['sortBy']);\n  const sortBy = partialFilter.sortBy;\n\n  const renderSelected = useCallback(\n    () => (\n      <div className={cn(styles.dropDownButton)}>\n        <IconSort />\n        <Text className={cn(styles.dropDownButtonText)}>{strings[sortBy]}</Text>\n      </div>\n    ),\n    [strings, sortBy, styles]\n  );\n\n  const onChange = useCallback(\n    (val: FilterSortBy) => {\n      logger.log({\n        severity: 'INFO',\n        event: 'FilterChange',\n        type: ('sortBy:' + val) as FilterType,\n        vertex: partialFilter.key,\n        source,\n      });\n      partialFilter.sortBy = val;\n    },\n    [logger, partialFilter, source]\n  );\n\n  return (\n    <DropDown\n      value={sortBy}\n      onChange={onChange}\n      renderSelected={renderSelected}\n    >\n      {FilterSortByValues.map((x) => (\n        <DropDownItem value={x} key={x}>\n          <Text>{strings[x]}</Text>\n        </DropDownItem>\n      ))}\n    </DropDown>\n  );\n}\n\nfunction ExtraFilters(props: ExtraFiltersProps) {\n  let content = null;\n  if (props.viewType === ViewType.List) {\n    content = <SortByDropDown />;\n  } else {\n    content = <GroupByDropDown />;\n  }\n\n  return <>{content}</>;\n}\n\ninterface FilterButtonProps {\n  showFilters: boolean;\n  setShowFilters: React.Dispatch<React.SetStateAction<boolean>>;\n}\n\nfunction FilterButton({ showFilters, setShowFilters }: FilterButtonProps) {\n  const styles = useStyles();\n  const strings = useStrings();\n  const logger = useLogger();\n\n  const filterButtonClicked = useCallback(() => {\n    logger.log({\n      severity: 'INFO',\n      event: 'Click',\n      source: 'toolbar:filterButton',\n      flag: !showFilters,\n    });\n    setShowFilters((x) => !x);\n  }, [logger, showFilters, setShowFilters]);\n\n  return (\n    <Button\n      onClick={filterButtonClicked}\n      className={cn(styles.filterButton, showFilters && styles.hasFilters)}\n    >\n      <IconFilter />\n      <Text className={cn(styles.dropDownButtonText)}>{strings.filter}</Text>\n    </Button>\n  );\n}\n\n// interface NoteTypeToggleProps {\n//   noteType: NoteType;\n//   setNoteType: (noteType: NoteType) => void;\n// }\n\n// function parseNoteType(val: string): NoteType {\n//   if (val && val.toLowerCase() === NoteType.Note) {\n//     return NoteType.Note;\n//   }\n//   return NoteType.Task;\n// }\n\nfunction NoteTypeToggle() {\n  const strings = useStrings();\n  const styles = useStyles();\n  const filterContext = useFilterContext();\n  const graph = useGraphManager();\n  // useSyncUrlParam('type', false, noteType, (val) =>\n  //   setNoteType(parseNoteType(val))\n  // );\n  return (\n    <TabsHeader\n      selected={filterContext.filter.getVertexProxy().noteType!}\n      setSelected={(type: NoteType) =>\n        filterContext.setFilter(\n          graph.getVertexManager(\n            type === NoteType.Note ? FilterKeyNotes : FilterKeyTasks\n          )\n        )\n      }\n      className={cn(styles.noteTypeToggle)}\n    >\n      <TabButton value={NoteType.Task}>{strings.task}</TabButton>\n      <TabButton value={NoteType.Note}>{strings.note}</TabButton>\n    </TabsHeader>\n  );\n}\n\nexport type DisplayBarProps = ExtraFiltersProps &\n  FilterButtonProps & {\n    setViewType: (viewType: ViewType) => void;\n    className?: string;\n  };\n\n// const After = [VideoTutorialId];\n\nexport function DisplayBar(props: DisplayBarProps) {\n  const { setViewType, className, showFilters, setShowFilters, ...rest } =\n    props;\n  const { viewType } = props;\n  const styles = useStyles();\n  // const steps = useDisplayBarTutorialSteps();\n  // useSyncedFilter(props);\n\n  return (\n    // <UserOnboard playAfter={After} tutorialId=\"DISPLAY_BAR\" steps={steps}>\n    <div className={cn(styles.bar, className)}>\n      <div className={cn(styles.barRow, styles.viewRow)}>\n        <NoteTypeToggle />\n      </div>\n      <div className={cn(styles.barRow)}>\n        <FilterButton\n          showFilters={showFilters}\n          setShowFilters={setShowFilters}\n        />\n        <div className={cn(styles.separator)} />\n        <ViewToggle className={cn(styles.viewToggle)} />\n        <div className={cn(layout.flexSpacer)} />\n        <ExtraFilters {...rest} />\n        <ToolbarRightItem>\n          <ComposeButton />\n        </ToolbarRightItem>\n      </div>\n    </div>\n    // </UserOnboard>\n  );\n}\n", "import React, { ChangeEvent } from 'https://esm.sh/react@18.2.0';\nimport {\n  cn,\n  makeStyles,\n} from '../../../../../../../../styles/css-objects/index.ts';\nimport { styleguide } from '../../../../../../../../styles/index.ts';\n\nconst SIZE = styleguide.gridbase * 2;\n\nconst useStyles = makeStyles(\n  (theme) => ({\n    checkbox: {\n      display: 'inline-flex',\n      flexDirection: 'row',\n      alignItems: 'center',\n      justifyContent: 'center',\n      width: SIZE,\n      height: SIZE,\n      borderRadius: SIZE * 0.5,\n      background: theme.background[0],\n    },\n    input: {\n      appearance: 'none',\n      margin: 0,\n    },\n  }),\n  'filter-checkbox_e52d7c'\n);\n\nexport enum FilterCheckboxState {\n  Partial = -1,\n  Off = 0,\n  On = 1,\n}\n\nexport interface FilterCheckboxProps {\n  checked: boolean | FilterCheckboxState;\n  onChecked: () => void;\n}\n\nfunction getChecked(checked: boolean | FilterCheckboxState): boolean {\n  switch (checked) {\n    case FilterCheckboxState.Partial:\n    case FilterCheckboxState.Off:\n      return false;\n    case FilterCheckboxState.On:\n      return true;\n    default:\n      return !!checked;\n  }\n}\n\nfunction CheckedIcon() {\n  return (\n    <svg\n      width=\"8\"\n      height=\"8\"\n      viewBox=\"0 0 8 8\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        opacity=\"0.6\"\n        d=\"M2.82642 6.73901L7.00024 1\"\n        stroke=\"#3184DD\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M1.00024 4.13037L2.8263 6.73901\"\n        stroke=\"#1960CF\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n    </svg>\n  );\n}\n\nfunction PartialIcon() {\n  return (\n    <svg\n      width=\"8\"\n      height=\"2\"\n      viewBox=\"0 0 8 2\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        opacity=\"0.6\"\n        d=\"M1 1L7 1\"\n        stroke=\"#1960CF\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n    </svg>\n  );\n}\n\nexport function FilterCheckbox({ checked, onChecked }: FilterCheckboxProps) {\n  const styles = useStyles();\n  const isChecked = getChecked(checked);\n  const onChange = (e: ChangeEvent) => {\n    e.stopPropagation();\n    onChecked();\n  };\n\n  return (\n    <label className={cn(styles.checkbox)}>\n      {isChecked && <CheckedIcon />}\n      {checked === FilterCheckboxState.Partial && <PartialIcon />}\n      <input\n        onChange={onChange}\n        className={cn(styles.input)}\n        type=\"checkbox\"\n        checked={isChecked}\n      />\n    </label>\n  );\n}\n", "{\n  \"en\": {\n    \"assignees\": \"Assignees\",\n    \"showMore\": \"Show More...\",\n    \"showLess\": \"Show less\"\n  }\n}", "import React, {\n  MouseEvent,\n  useState,\n  useCallback,\n} from 'https://esm.sh/react@18.2.0';\nimport {\n  Filter,\n  Tag,\n  User,\n} from '../../../../../../../../cfds/client/graph/vertices/index.ts';\nimport { layout, styleguide } from '../../../../../../../../styles/index.ts';\nimport Layer from '../../../../../../../../styles/components/layer.tsx';\nimport { useTypographyStyles } from '../../../../../../../../styles/components/typography.tsx';\nimport {\n  cn,\n  makeStyles,\n} from '../../../../../../../../styles/css-objects/index.ts';\nimport { brandLightTheme as theme } from '../../../../../../../../styles/theme.tsx';\nimport { createUniversalPortal } from '../../../../../../../../styles/utils/ssr.ts';\nimport {\n  usePartialVertex,\n  useVertex,\n  useVertices,\n} from '../../../../../../core/cfds/react/vertex.ts';\nimport { createUseStrings } from '../../../../../../core/localization/index.tsx';\nimport { FilterCheckbox, FilterCheckboxState } from './filter-checkbox.tsx';\nimport localization from './filters.strings.json' assert { type: 'json' };\nimport {\n  useExistingQuery,\n  useSharedQuery,\n} from '../../../../../../core/cfds/react/query.ts';\nimport * as SetUtils from '../../../../../../../../base/set.ts';\nimport { coreValueCompare } from '../../../../../../../../base/core-types/comparable.ts';\nimport { useFilter } from '../../../../../index.tsx';\nimport { VertexId } from '../../../../../../../../cfds/client/graph/vertex.ts';\n\nconst useStyles = makeStyles(\n  () => ({\n    root: {\n      position: 'relative',\n      overflow: 'visible',\n    },\n    animator: {\n      position: 'absolute',\n      top: '100%',\n      left: 0,\n      right: 0,\n      opacity: 1,\n      transform: 'translateY(0)',\n      overflow: 'hidden',\n      ...styleguide.transition.standard,\n\n      transitionProperty: 'all',\n      background: theme.secondary.s2,\n      boxShadow: theme.shadows.z1,\n    },\n    hide: {\n      pointerEvents: 'none',\n      boxShadow: 'none',\n      opacity: 0,\n      transform: `translateY(${styleguide.gridbase * -2}px)`,\n    },\n    container: {},\n    filtersView: {\n      width: '100%',\n      maxHeight: styleguide.gridbase * 30,\n      overflowY: 'auto',\n      boxSizing: 'border-box',\n      padding: [styleguide.gridbase * 2, 0],\n      flexWrap: 'wrap',\n      basedOn: [layout.row],\n    },\n    section: {\n      width: styleguide.gridbase * 22,\n      marginRight: styleguide.gridbase * 4,\n      marginBottom: styleguide.gridbase * 2,\n    },\n    sectionHeader: {\n      marginBottom: styleguide.gridbase,\n      alignItems: 'center',\n      cursor: 'pointer',\n      userSelect: 'none',\n      basedOn: [useTypographyStyles.bold, layout.row],\n    },\n    sectionOption: {\n      height: styleguide.gridbase * 2.5,\n      marginBottom: styleguide.gridbase * 0.5,\n      alignItems: 'center',\n      cursor: 'pointer',\n      userSelect: 'none',\n      basedOn: [useTypographyStyles.text, layout.row],\n    },\n    showMore: {\n      height: styleguide.gridbase * 2.5,\n      marginBottom: styleguide.gridbase * 0.5,\n      textDecoration: 'underline',\n      alignItems: 'center',\n      cursor: 'pointer',\n      userSelect: 'none',\n      basedOn: [useTypographyStyles.text, layout.row],\n    },\n    backdrop: {\n      position: 'absolute',\n      top: 0,\n      right: 0,\n      left: 0,\n      bottom: 0,\n    },\n    checkbox: {\n      marginRight: styleguide.gridbase,\n      basedOn: [layout.column, layout.centerCenter],\n    },\n  }),\n  'filters_965b1f'\n);\n\nconst useStrings = createUseStrings(localization);\n\nfunction AssigneeView({\n  selected,\n  user,\n  onToggle,\n}: {\n  selected: boolean;\n  user: VertexId<User>;\n  onToggle: () => void;\n}) {\n  const u = usePartialVertex(user, ['name']);\n  const styles = useStyles();\n  return (\n    <div className={cn(styles.sectionOption)} onClick={onToggle}>\n      <RadioCheckBox checked={selected} onChecked={onToggle} /> {u.name}\n    </div>\n  );\n}\n\nexport interface FiltersViewProps {\n  className?: string;\n  isVisible: boolean;\n  setIsVisible: (visible: boolean) => void;\n}\n\nfunction FilterBackdrop({\n  style,\n  onClick,\n}: {\n  style: {};\n  onClick?: () => void;\n}) {\n  const styles = useStyles();\n\n  const click = useCallback(\n    (e: MouseEvent) => {\n      e.stopPropagation();\n      e.preventDefault();\n      if (onClick) {\n        onClick();\n      }\n    },\n    [onClick]\n  );\n\n  return createUniversalPortal(\n    <div style={style} className={styles.backdrop} onClick={click} />\n  );\n}\n\nexport function FiltersView({\n  className,\n  isVisible,\n  setIsVisible,\n}: FiltersViewProps) {\n  const styles = useStyles();\n  return (\n    <div className={cn(styles.root)}>\n      <Layer>\n        {(style) => (\n          <React.Fragment>\n            {isVisible && (\n              <FilterBackdrop\n                style={style}\n                onClick={() => setIsVisible(false)}\n              />\n            )}\n\n            <div\n              className={cn(\n                className,\n                styles.animator,\n                !isVisible && styles.hide\n              )}\n              style={{ zIndex: style.zIndex + 1 }}\n            >\n              <InternalFiltersView />\n            </div>\n          </React.Fragment>\n        )}\n      </Layer>\n    </div>\n  );\n}\n\nconst SECTION_SIZE = 5;\n\nfunction toggleTag(filter: Filter, tag: Tag): void {\n  if (tag.parent) {\n    if (filter.tags.has(tag)) {\n      filter.tags.delete(tag);\n    } else {\n      filter.tags.add(tag);\n    }\n  } else {\n    for (const t of tag.childTagsQuery.results) {\n      const childTag = t.getVertexProxy();\n      if (filter.tags.has(childTag)) {\n        filter.tags.delete(childTag);\n      } else {\n        filter.tags.add(childTag);\n      }\n    }\n  }\n}\n\nfunction getTagState(filter: Filter, tag: Tag): FilterCheckboxState {\n  const filterTags = filter.tags;\n  if (filterTags.has(tag)) {\n    return FilterCheckboxState.On;\n  }\n  if (!tag.parentTag) {\n    for (const childMgr of tag.childTagsQuery.results) {\n      if (filterTags.has(childMgr.getVertexProxy())) {\n        return FilterCheckboxState.Partial;\n      }\n    }\n  }\n  return FilterCheckboxState.Off;\n}\n\nfunction TagSection({ tag }: { tag: VertexId<Tag> }) {\n  const styles = useStyles();\n  const strings = useStrings();\n  const [showMore, setShowMore] = useState(false);\n  const parentTag = useVertex(tag);\n  const childTagsQuery = useExistingQuery(parentTag.childTagsQuery);\n  const filter = useFilter();\n\n  let visibleTags = useVertices(childTagsQuery.results);\n  const hasMore = visibleTags.length > SECTION_SIZE;\n  if (!showMore) {\n    visibleTags = visibleTags.slice(0, SECTION_SIZE);\n  }\n\n  return (\n    <div className={cn(styles.section)}>\n      <div className={cn(styles.sectionHeader)}>\n        <RadioCheckBox\n          checked={getTagState(filter, parentTag)}\n          onChecked={() => toggleTag(filter, parentTag)}\n        />\n        {parentTag.name}\n      </div>\n      {visibleTags.map((childTag) => (\n        <div\n          className={cn(styles.sectionOption)}\n          key={childTag.key}\n          onClick={() => toggleTag(filter, childTag)}\n        >\n          <RadioCheckBox\n            checked={getTagState(filter, childTag)}\n            onChecked={() => toggleTag(filter, childTag)}\n          />\n          {childTag.name}\n        </div>\n      ))}\n      {hasMore && (\n        <div\n          onClick={() => setShowMore((x) => !x)}\n          className={cn(styles.showMore)}\n        >\n          {showMore ? strings.showLess : strings.showMore}\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction InternalFiltersView() {\n  const styles = useStyles();\n  const strings = useStrings();\n  const filter = useFilter();\n  const selectedWorkspacesQuery = useSharedQuery('selectedWorkspaces');\n  const selectedWorkspaces = useVertices(selectedWorkspacesQuery.results);\n  const parentTagsQuery = useSharedQuery('parentTags');\n  const assigneesSet = new Set<User>();\n  for (const ws of selectedWorkspaces) {\n    SetUtils.update(assigneesSet, ws.users);\n  }\n  let assignees = Array.from(assigneesSet).sort(coreValueCompare);\n\n  const [showMore, setShowMore] = useState(false);\n\n  const hasMore = assignees.length > SECTION_SIZE;\n  if (!showMore) {\n    assignees = assignees.slice(0, SECTION_SIZE);\n  }\n\n  return (\n    <div className={cn(styles.filtersView)}>\n      <div className={cn(styles.section)}>\n        <div className={cn(styles.sectionHeader)}>{strings.assignees}</div>\n        {assignees.map((user) => (\n          <AssigneeView\n            user={user}\n            {...user}\n            onToggle={() => SetUtils.toggleMembership(filter.assignees, user)}\n          />\n        ))}\n        {hasMore && (\n          <div\n            onClick={() => setShowMore((x) => !x)}\n            className={cn(styles.showMore)}\n          >\n            {showMore ? strings.showLess : strings.showMore}\n          </div>\n        )}\n      </div>\n      {parentTagsQuery.map((tag) => (\n        <TagSection tag={tag} />\n      ))}\n    </div>\n  );\n}\n\nfunction RadioCheckBox({\n  checked,\n  onChecked,\n}: {\n  checked: boolean | FilterCheckboxState;\n  onChecked: () => void;\n}) {\n  const styles = useStyles();\n  return (\n    <div className={cn(styles.checkbox)}>\n      <FilterCheckbox checked={checked} onChecked={onChecked} />\n    </div>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { VertexManager } from '../../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport { User } from '../../../../../../../../cfds/client/graph/vertices/user.ts';\nimport { layout, styleguide } from '../../../../../../../../styles/index.ts';\nimport { Button } from '../../../../../../../../styles/components/buttons.tsx';\nimport { useTypographyStyles } from '../../../../../../../../styles/components/typography.tsx';\nimport {\n  cn,\n  makeStyles,\n} from '../../../../../../../../styles/css-objects/index.ts';\nimport {\n  useTheme,\n  brandLightTheme as theme,\n} from '../../../../../../../../styles/theme.tsx';\nimport { usePartialVertex } from '../../../../../../core/cfds/react/vertex.ts';\nimport { Tag } from '../../../../../../../../cfds/client/graph/vertices/tag.ts';\nimport { useFilter } from '../../../../../index.tsx';\nimport { coreValueCompare } from '../../../../../../../../base/core-types/comparable.ts';\n\nconst useStyles = makeStyles(\n  () => ({\n    filtersView: {\n      alignItems: 'center',\n      basedOn: [layout.row],\n    },\n    filterPill: {\n      height: styleguide.gridbase * 2,\n      borderRadius: styleguide.gridbase,\n      background: theme.mono.m1,\n      marginRight: styleguide.gridbase,\n      alignItems: 'center',\n      justifyContent: 'space-between',\n      basedOn: [layout.row],\n    },\n    filterText: {\n      marginLeft: styleguide.gridbase * 0.5,\n      fontSize: '10px',\n      lineHeight: '14px',\n      basedOn: [useTypographyStyles.text],\n    },\n    closeIcon: {\n      cursor: 'pointer',\n      marginLeft: styleguide.gridbase * 0.5,\n      height: '100%',\n      basedOn: [layout.column, layout.centerCenter],\n    },\n  }),\n  'active-filters_347c3d'\n);\n\nexport interface ActiveFiltersViewProps {\n  className?: string;\n}\n\nfunction CloseIcon({ onClick }: { onClick?: () => void }) {\n  const theme = useTheme();\n  const styles = useStyles();\n  return (\n    <div onClick={onClick} className={cn(styles.closeIcon)}>\n      <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\">\n        <path\n          opacity=\"0.6\"\n          d=\"M9.41436 9.41436L6.58594 6.58594\"\n          stroke={theme.background.text}\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.6\"\n          d=\"M6.58594 9.41406L9.41436 6.58564\"\n          stroke={theme.background.text}\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n      </svg>\n    </div>\n  );\n}\n\nfunction AssigneePill({\n  user,\n  onDelete,\n}: {\n  user: VertexManager<User>;\n  onDelete: (user: VertexManager<User>) => void;\n}) {\n  const styles = useStyles();\n  const { name } = usePartialVertex(user, ['name']);\n\n  return (\n    <div className={cn(styles.filterPill)}>\n      <span className={cn(styles.filterText)}>{name}</span>\n      <CloseIcon onClick={() => onDelete(user)} />\n    </div>\n  );\n}\n\nfunction TagPill({\n  tag,\n  onDelete,\n}: {\n  tag: Tag;\n  onDelete: (tag: Tag) => void;\n}) {\n  const styles = useStyles();\n  return (\n    <div className={cn(styles.filterPill)}>\n      <span className={cn(styles.filterText)}>{tag.name}</span>\n      <CloseIcon onClick={() => onDelete(tag)} />\n    </div>\n  );\n}\n\nexport function ActiveFiltersView({ className }: ActiveFiltersViewProps) {\n  const styles = useStyles();\n  const filter = useFilter();\n  const showClear = filter.tags.size + filter.assignees.size > 0;\n\n  return (\n    <div className={className}>\n      <div className={cn(styles.filtersView)}>\n        {Array.from(filter.assignees)\n          .sort(coreValueCompare)\n          .map((user) => (\n            <AssigneePill\n              key={user.key}\n              user={user.manager}\n              onDelete={() => filter.assignees.delete(user)}\n            />\n          ))}\n        {Array.from(filter.tags)\n          .sort(coreValueCompare)\n          .map((tag) => (\n            <TagPill\n              key={tag.key}\n              tag={tag}\n              onDelete={() => filter.tags.delete(tag)}\n            />\n          ))}\n        {showClear && (\n          <Button\n            onClick={() => {\n              filter.assignees.clear();\n              filter.tags.clear();\n            }}\n          >\n            Clear\n          </Button>\n        )}\n      </div>\n    </div>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { layout, styleguide } from '../../../../../../../styles/index.ts';\nimport { Button } from '../../../../../../../styles/components/buttons.tsx';\nimport { TextField } from '../../../../../../../styles/components/inputs/index.ts';\nimport {\n  cn,\n  makeStyles,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { createUseStrings } from '../../../../../core/localization/index.tsx';\nimport localization from '../cards-display.strings.json' assert { type: 'json' };\nimport { brandLightTheme as theme } from '../../../../../../../styles/theme.tsx';\nimport { useTextfieldStyles } from '../../../../../../../styles/components/inputs/TextField.tsx';\nimport { useLogger } from '../../../../../core/cfds/react/logger.tsx';\n\nconst useStyles = makeStyles(() => ({\n  base: {\n    position: 'relative',\n    marginLeft: styleguide.gridbase * 3,\n    basedOn: [layout.row, layout.flex],\n  },\n\n  input: {\n    background:\n      'radial-gradient(92.31% 92.31% at 7.69% 7.69%, rgba(255, 255, 255, 0.3) 0%, rgba(229, 229, 229, 0.3) 100%)',\n    width: '100%',\n    height: styleguide.gridbase * 4,\n    border: `${theme.primary.p9} solid 1px`,\n    borderRadius: styleguide.gridbase * 2,\n    basedOn: [useTextfieldStyles.textField],\n  },\n  icon: {\n    alignItems: 'flex-start',\n    marginTop: styleguide.gridbase,\n  },\n  clear: {\n    position: 'absolute',\n    right: styleguide.gridbase,\n    top: '50%',\n    transform: 'translateY(-50%)',\n    fontSize: 12,\n    height: styleguide.gridbase * 2,\n    boxSizing: 'border-box',\n    padding: [0, styleguide.gridbase],\n    borderRadius: styleguide.gridbase * 0.75,\n    backgroundColor: theme.mono.m1,\n    color: theme.colors.text,\n  },\n}));\n\nconst useStrings = createUseStrings(localization);\n\nexport interface SearchFieldProps {\n  query: string;\n  setQuery: (query: string) => void;\n}\n\nexport function SearchField({ query, setQuery }: SearchFieldProps) {\n  const styles = useStyles();\n  const strings = useStrings();\n  const logger = useLogger();\n\n  return (\n    <div className={cn(styles.base)}>\n      <TextField\n        placeholder={strings.search}\n        value={query}\n        onChange={(e: any) => setQuery(e.target.value)}\n        onFocus={() => {\n          logger.log({\n            severity: 'INFO',\n            event: 'Start',\n            source: 'toolbar:search',\n            flow: 'edit',\n          });\n        }}\n        onBlur={() => {\n          logger.log({\n            severity: 'INFO',\n            event: 'End',\n            source: 'toolbar:search',\n            flow: 'edit',\n          });\n        }}\n        className={cn(styles.input)}\n      />\n      {query && (\n        <Button className={cn(styles.clear)} onClick={() => setQuery('')}>\n          {strings.clear}\n        </Button>\n      )}\n    </div>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\ninterface EmptyActivityProps {\n  className?: string;\n  style?: any;\n}\nexport default function EmptyActivity({\n  className,\n  style,\n}: EmptyActivityProps) {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      width=\"689\"\n      height=\"369\"\n      viewBox=\"0 0 689 369\"\n    >\n      <g fill=\"none\" fillRule=\"evenodd\" opacity=\".6\">\n        <path\n          fill=\"#E1DBFF\"\n          d=\"M378.846 321.074h57.084v28.706h-57.084zM377.367 286.005h57.084v21.754h-57.084zM372.292 307.765h57.084v9.822h-57.084z\"\n        />\n        <path fill=\"#E1DBFF\" d=\"M375.729 317.586h57.084v3.487h-57.084z\" />\n        <path\n          fill=\"#F0EDFF\"\n          d=\"M366.647 321.074h57.084v28.706h-57.084zM365.167 286.005h57.084v21.754h-57.084zM360.092 307.765h57.084v9.822h-57.084z\"\n        />\n        <path fill=\"#F0EDFF\" d=\"M363.529 317.586h57.084v3.487h-57.084z\" />\n        <path\n          fill=\"#E1DBFF\"\n          d=\"M423.731 329.044v-7.97h-51.174zM379.332 255.291h57.084v17.741h-57.084zM385.267 273.032h57.084v12.973h-57.084z\"\n        />\n        <path\n          fill=\"#F0EDFF\"\n          d=\"M367.133 255.291h57.084v17.741h-57.084zM373.068 273.032h57.084v12.973h-57.084z\"\n        />\n        <path\n          fill=\"#E1DBFF\"\n          d=\"M430.152 278.273v-5.241h-33.651zM417.176 311.714v-3.95h-25.354z\"\n        />\n        <path\n          fill=\"#CCC2FF\"\n          d=\"M387.451 285.427h2.722v1.156h-2.722zM393.029 285.427h31.594v1.156h-31.594z\"\n        />\n        <path\n          fill=\"#FFF\"\n          d=\"M377.769 307.181h30.233v1.156h-30.233zM365.167 307.181h8.556v1.156h-8.556zM377.486 272.454h40.334v1.156h-40.334z\"\n        />\n        <path\n          fill=\"#CCC2FF\"\n          d=\"M435.029 293.159h-1.156v-7.732h7.9V273.61h-5.934v-9.448h1.156v8.292h5.934v14.129h-7.9zM435.839 255.291h1.156v4.645h-1.156z\"\n        />\n        <path fill=\"#CCC2FF\" d=\"M432.464 272.454h6.265v1.156h-6.265z\" />\n        <path fill=\"#B3A4F5\" d=\"M442.508 305.395h61.935v44.385h-61.935z\" />\n        <path fill=\"#CCC2FF\" d=\"M429.272 305.395h61.935v44.385h-61.935z\" />\n        <path fill=\"#B3A4F5\" d=\"M442.508 295.757h64.132v9.637h-64.132z\" />\n        <path fill=\"#CCC2FF\" d=\"M427.075 295.757h64.132v9.637h-64.132z\" />\n        <path fill=\"#B3A4F5\" d=\"M491.207 312.615v-7.22h-41.368z\" />\n        <path\n          fill=\"#40327A\"\n          d=\"M466.371 317.442h-12.264a2.929 2.929 0 1 1 0-5.856h12.264a2.929 2.929 0 1 1 0 5.856z\"\n        />\n        <path fill=\"#FFF\" d=\"M446.2 322.695h28.079v14.733H446.2z\" />\n        <path\n          fill=\"#624AC9\"\n          d=\"M442.508 304.817h64.132v1.156h-64.132zM434.352 304.817h3.468v1.156h-3.468z\"\n        />\n        <path\n          fill=\"#FFF\"\n          d=\"M426.498 295.757h1.156v9.637h-1.156zM428.694 331.34h1.156v2.383h-1.156zM428.694 305.395h1.156v20.24h-1.156z\"\n        />\n        <path\n          fill=\"#E1DBFF\"\n          d=\"M125.412 321.074h57.084v28.706h-57.084zM130.718 286.005h57.084v21.754h-57.084zM120.61 307.765h57.085v9.822H120.61z\"\n        />\n        <path fill=\"#E1DBFF\" d=\"M122.294 317.586h57.084v3.487h-57.084z\" />\n        <path\n          fill=\"#F0EDFF\"\n          d=\"M113.212 321.074h57.084v28.706h-57.084zM118.518 286.005h57.084v21.754h-57.084zM108.412 307.765h57.084v9.822h-57.084z\"\n        />\n        <path fill=\"#F0EDFF\" d=\"M110.094 317.586h57.084v3.487h-57.084z\" />\n        <path\n          fill=\"#E1DBFF\"\n          d=\"M170.296 329.044v-7.97h-51.174zM122.705 268.22h57.084v17.741h-57.084z\"\n        />\n        <path fill=\"#F0EDFF\" d=\"M110.505 268.22h57.084v17.741h-57.084z\" />\n        <path\n          fill=\"#E1DBFF\"\n          d=\"M165.495 311.714v-3.95h-25.354zM82.353 262.737h57.084v28.706H82.353z\"\n        />\n        <path\n          fill=\"#E1DBFF\"\n          d=\"M75.603 291.443h57.084v17.741H75.603zM80.874 227.668h57.084v21.754H80.874zM75.799 249.428h57.084v9.822H75.799z\"\n        />\n        <path fill=\"#E1DBFF\" d=\"M79.236 259.249h57.084v3.487H79.236z\" />\n        <path fill=\"#F0EDFF\" d=\"M70.154 262.737h57.084v28.706H70.154z\" />\n        <path\n          fill=\"#F0EDFF\"\n          d=\"M63.403 291.443h57.084v17.741H63.403zM68.674 227.668h57.084v21.754H68.674zM63.599 249.428h57.084v9.822H63.599z\"\n        />\n        <path fill=\"#F0EDFF\" d=\"M67.036 259.249h57.084v3.487H67.036z\" />\n        <path\n          fill=\"#E1DBFF\"\n          d=\"M127.238 270.707v-7.97H76.064zM120.487 295.392v-3.949H95.133zM72.86 196.954h57.085v17.741H72.86zM74.615 214.695h57.084v12.973H74.615z\"\n        />\n        <path\n          fill=\"#F0EDFF\"\n          d=\"M60.66 196.954h57.085v17.741H60.66zM62.416 214.695H119.5v12.973H62.416z\"\n        />\n        <path\n          fill=\"#E1DBFF\"\n          d=\"M119.5 219.936v-5.241H85.847zM120.683 253.377v-3.95H95.328z\"\n        />\n        <path fill=\"#8B77E8\" d=\"M126.47 309.183h14.896v40.597H126.47z\" />\n        <path fill=\"#CCC2FF\" d=\"M56.771 309.183h69.699v40.597H56.771z\" />\n        <path\n          fill=\"#B3A4F5\"\n          d=\"M149.605 327.855H134.71l-8.24-18.672h14.895zM126.618 338.737v-10.882H64.27z\"\n        />\n        <path fill=\"#B3A4F5\" d=\"M115.449 309.183h11.02v21.897h-11.02z\" />\n        <path fill=\"#CCC2FF\" d=\"M118.23 327.855h-69.7l8.24-18.672h69.7z\" />\n        <g fill=\"#FFF\">\n          <path d=\"M111.5 327.277h2.059v1.156H111.5zM54.737 312.368l1.119-2.537 1.058.467-1.12 2.537zM105.47 328.433H47.644l5.838-13.23 1.058.467-5.123 11.607h56.053z\" />\n        </g>\n        <path\n          fill=\"#624AC9\"\n          d=\"M91.617 308.606h49.748v1.156H91.617zM78.393 308.606h7.518v1.156h-7.518z\"\n        />\n        <path\n          fill=\"#CCC2FF\"\n          d=\"M183.074 349.78h-1.156v-28.128H178.8v-3.488h-1.683v-10.977l10.107-.005v-20.6h-9.852v-1.155h11.007v22.91l-10.106.005v8.667h1.683v3.487h3.118z\"\n        />\n        <path\n          fill=\"#CCC2FF\"\n          d=\"M163.599 285.382h16.189v1.156h-16.19zM172.17 316.864h7.208v1.156h-7.207zM132.109 302.536h1.156v2.859h-1.156zM133.265 298.02h-1.156v-7.155h6.75v-27.55h-3.117v-3.488h-3.437V248.85l5.075-.005v-20.6h-6.259v-8.802h1.156v7.647h6.258V250l-5.075.005v8.666h3.437v3.488h3.118v29.862h-6.75z\"\n        />\n        <g>\n          <path\n            fill=\"#FF95A9\"\n            d=\"M189.26 336.036h27.616v2.66H189.26zM189.26 347.12h27.616v2.66H189.26z\"\n          />\n          <path fill=\"#FF95A9\" d=\"M189.26 349.78v-13.744h2.661v13.744z\" />\n          <path fill=\"#FFB0BF\" d=\"M136.569 336.036h52.692v13.744h-52.692z\" />\n          <g transform=\"translate(174.95 338.1)\">\n            <ellipse\n              cx=\"5.08\"\n              cy=\"4.833\"\n              fill=\"#FFF\"\n              rx=\"3.99\"\n              ry=\"3.991\"\n              transform=\"rotate(-76.714 5.08 4.833)\"\n            />\n            <ellipse\n              cx=\"5.098\"\n              cy=\"4.812\"\n              fill=\"#40327A\"\n              rx=\"2.661\"\n              ry=\"2.66\"\n              transform=\"rotate(-22.5 5.098 4.812)\"\n            />\n          </g>\n          <path fill=\"#CCC2FF\" d=\"M191.922 338.696h21.989v8.424h-21.99z\" />\n          <path fill=\"#FFF\" d=\"M143.754 339.527h23.172v6.761h-23.172z\" />\n        </g>\n        <path fill=\"#8B77E8\" d=\"M191.922 338.696h24.954v1.156h-24.954z\" />\n        <path\n          fill=\"#E1DBFF\"\n          d=\"M76.505 168.225h57.084v28.706H76.505zM82.967 146.471h57.084v21.754H82.967z\"\n        />\n        <path\n          fill=\"#F0EDFF\"\n          d=\"M64.305 168.225h57.084v28.706H64.305zM70.767 146.471h57.084v21.754H70.767z\"\n        />\n        <path\n          fill=\"#E1DBFF\"\n          d=\"M121.39 175.618v-7.393H73.922zM74.954 115.757h57.084v17.741H74.954z\"\n        />\n        <path fill=\"#E1DBFF\" d=\"M76.709 133.497h57.084v12.973H76.709z\" />\n        <path fill=\"#F0EDFF\" d=\"M62.754 115.757h57.084v17.741H62.754z\" />\n        <path fill=\"#F0EDFF\" d=\"M64.509 133.497h57.084v12.973H64.509z\" />\n        <path fill=\"#E1DBFF\" d=\"M127.33 202.323v-5.24H93.68z\" />\n        <path\n          fill=\"#CCC2FF\"\n          d=\"M133.215 141.441h1.156v1.372h-1.156zM134.37 139.13h-1.156v-5.055h-1.754v-18.318h1.156v17.162h1.754z\"\n        />\n        <path\n          fill=\"#CCC2FF\"\n          d=\"M113.582 132.919h18.456v1.156h-18.456zM140.629 168.803h-27.94v-1.156h26.784v-1.773h1.156zM139.473 161.83h1.156v1.348h-1.156zM134.167 197.509h-9.023v-1.156h7.867v-25.045h1.156z\"\n        />\n        <path\n          fill=\"#CCC2FF\"\n          d=\"M129.367 196.954h1.156v11.043h-1.156zM102.243 167.647h7.242v1.156h-7.242zM90.958 227.09h2.722v1.156h-2.722zM96.536 227.09h31.595v1.156H96.536z\"\n        />\n        <path fill=\"#FFF\" d=\"M181.973 290.865h34.902v1.156h-34.902z\" />\n        <g transform=\"translate(342.4 159.6)\">\n          <path\n            fill=\"#C4B8FF\"\n            d=\"M10.044 19.67L.968 17.835l1.464-7.246 9.077 1.834z\"\n          />\n          <path fill=\"#FF809F\" d=\"M10.864 30.405h-9.26v-7.392h9.26z\" />\n          <path\n            fill=\"#FFC359\"\n            d=\"M10.527 40.117l-9.155 1.387-1.108-7.308 9.155-1.387z\"\n          />\n          <path fill=\"#DDD6FF\" d=\"M99.36 65.628H5.88V.622h93.48z\" />\n          <path\n            fill=\"#B3A4F5\"\n            d=\"M99.36 36.08v14.187H8.26l3.2-.499zM8.26 50.267h91.1v15.361H8.26z\"\n          />\n          <path fill=\"#8B77E8\" d=\"M63.672 35.198l8.732 30.43h-7.551z\" />\n          <path\n            fill=\"#8B77E8\"\n            d=\"M99.937 66.206H49.706V65.05H98.78v-8.94h1.156z\"\n          />\n          <path\n            fill=\"#CCC2FF\"\n            d=\"M44.6 79.88h23.71l-5.216-44.682H44.6zM8.26 14.81V.621h91.1l-3.2.5z\"\n          />\n          <g fill=\"#FFF\">\n            <path d=\"M20.529 23.447l78.737-12.253.178 1.142-78.738 12.252zM48.843 14.34l50.424-7.846.178 1.141-50.424 7.847zM30.652 17.174l10.056-1.565.178 1.142-10.056 1.565z\" />\n          </g>\n          <path fill=\"#CCC2FF\" d=\"M26.035 77.569h27.74v2.311h-27.74z\" />\n          <path\n            fill=\"#B3A4F5\"\n            d=\"M99.937 21.106h-1.156V1.2h-56.66V.044h57.816zM5.88.044H16.62V1.2H5.88z\"\n          />\n          <path\n            fill=\"#FFF\"\n            d=\"M44.023 59.528h1.156v1.3h-1.156zM45.178 56.11h-1.156V34.62h14.656v1.156h-13.5z\"\n          />\n          <path fill=\"#8B77E8\" d=\"M98.782 52.306h1.156v1.878h-1.156z\" />\n          <path\n            fill=\"#B3A4F5\"\n            d=\"M98.782 24.7h1.156v4.928h-1.156zM62.535 35.276l1.148-.134 5.215 44.684-1.148.134z\"\n          />\n          <ellipse\n            cx=\"54.827\"\n            cy=\"45.654\"\n            fill=\"#8B77E8\"\n            rx=\"4.615\"\n            ry=\"4.613\"\n          />\n          <path\n            fill=\"#FFF\"\n            d=\"M58.428 43.827a4.062 4.062 0 0 0-.777-1.057l.809-.826a5.2 5.2 0 0 1 .998 1.36l-1.03.523zM51.238 49.406a5.145 5.145 0 0 1-1.604-3.752 5.198 5.198 0 0 1 7.214-4.783l-.45 1.064a4.04 4.04 0 0 0-5.608 3.718c0 1.113.443 2.149 1.247 2.918l-.799.835z\"\n          />\n        </g>\n        <g>\n          <path\n            fill=\"#E1DBFF\"\n            d=\"M431.858 152.27h57.084v28.706h-57.084zM421.344 180.976h57.084v17.741h-57.084zM437.925 138.961h57.084v9.822h-57.084zM427.668 198.717h57.084v12.973h-57.084z\"\n          />\n          <path fill=\"#E1DBFF\" d=\"M428.74 148.783h57.084v3.487H428.74z\" />\n          <path\n            fill=\"#F0EDFF\"\n            d=\"M419.658 152.27h57.084v28.706h-57.084zM409.144 180.976h57.084v17.741h-57.084zM425.725 138.961h57.084v9.822h-57.084zM415.468 198.717h57.084v12.973h-57.084z\"\n          />\n          <path fill=\"#F0EDFF\" d=\"M416.541 148.783h57.084v3.487h-57.084z\" />\n          <path\n            fill=\"#E1DBFF\"\n            d=\"M476.743 160.24v-7.97h-51.174zM466.229 184.926v-3.95h-25.355zM421.213 108.248h57.084v17.741h-57.084z\"\n          />\n          <path fill=\"#E1DBFF\" d=\"M422.968 125.988h57.084v12.973h-57.084z\" />\n          <path fill=\"#F0EDFF\" d=\"M409.014 108.248h57.084v17.741h-57.084z\" />\n          <path fill=\"#F0EDFF\" d=\"M410.768 125.988h57.084v12.973h-57.084z\" />\n          <path\n            fill=\"#E1DBFF\"\n            d=\"M467.852 131.23v-5.242h-33.65zM482.81 142.91v-3.949h-25.355z\"\n          />\n          <path\n            fill=\"#FFF\"\n            d=\"M430.94 214.35h-27.614v-2.66h27.615zM430.94 225.435h-27.614v-2.66h27.615z\"\n          />\n          <path fill=\"#FFF\" d=\"M428.28 225.434V211.69h2.66v13.744z\" />\n          <path fill=\"#B3A4F5\" d=\"M483.633 225.434h-52.692V211.69h52.692z\" />\n          <g transform=\"translate(436.027 214.5)\">\n            <ellipse cx=\"4.135\" cy=\"4.062\" fill=\"#FFF\" rx=\"3.991\" ry=\"3.99\" />\n            <ellipse\n              cx=\"4.135\"\n              cy=\"4.062\"\n              fill=\"#40327A\"\n              rx=\"2.661\"\n              ry=\"2.66\"\n            />\n          </g>\n          <path fill=\"#E9E6FF\" d=\"M428.28 222.774h-21.99v-8.424h21.99z\" />\n          <path fill=\"#FFF\" d=\"M476.447 221.942h-23.172v-6.76h23.172z\" />\n          <path\n            fill=\"#FF8FAA\"\n            d=\"M461.233 225.434h27.615v2.66h-27.615zM461.233 236.518h27.615v2.66h-27.615z\"\n          />\n          <path fill=\"#FF8FAA\" d=\"M461.233 239.178v-13.744h2.66v13.744z\" />\n          <path fill=\"#FFD259\" d=\"M408.54 225.434h52.692v13.744H408.54z\" />\n          <g transform=\"translate(447.13 227.4)\">\n            <ellipse\n              cx=\"4.892\"\n              cy=\"4.94\"\n              fill=\"#FFF\"\n              rx=\"3.99\"\n              ry=\"3.991\"\n              transform=\"rotate(-76.714 4.892 4.94)\"\n            />\n            <ellipse\n              cx=\"4.895\"\n              cy=\"4.903\"\n              fill=\"#40327A\"\n              rx=\"2.661\"\n              ry=\"2.66\"\n              transform=\"rotate(-22.5 4.895 4.903)\"\n            />\n          </g>\n          <path fill=\"#CCC2FF\" d=\"M463.893 228.095h21.99v8.424h-21.99z\" />\n          <path fill=\"#FFF\" d=\"M415.726 228.926h23.172v6.761h-23.172z\" />\n          <path fill=\"#624AC9\" d=\"M414.466 211.112h69.167v1.156h-69.167z\" />\n          <path\n            fill=\"#CCC2FF\"\n            d=\"M485.33 211.69h-1.156v-12.395h-6.324v-5.266h1.156v4.11h6.324zM479.006 188.457h-1.156v-8.058h10.514v-27.551h-3.117v-4.643h9.184v-8.666h-14.957v-12.973h-1.755v-14.293h1.156v13.137h1.755v12.973h14.957v10.977h-9.184v2.332h3.117v29.862h-10.514z\"\n          />\n          <path\n            fill=\"#CCC2FF\"\n            d=\"M481.058 151.692h4.767v1.156h-4.767zM459 151.692h20.181v1.156h-20.18zM469.114 180.399h14.52v1.156h-14.52z\"\n          />\n          <path fill=\"#8B77E8\" d=\"M470.93 228.095h17.918v1.156H470.93z\" />\n          <path fill=\"#B3A4F5\" d=\"M419.332 81.722h57.792v26.526h-57.792z\" />\n          <path fill=\"#CCC2FF\" d=\"M406.98 81.722h57.793v26.526H406.98z\" />\n          <path fill=\"#B3A4F5\" d=\"M419.332 72.729h59.842v8.993h-59.842z\" />\n          <path fill=\"#CCC2FF\" d=\"M404.932 72.729h59.842v8.993h-59.842z\" />\n          <path fill=\"#B3A4F5\" d=\"M464.773 88.46v-6.738h-38.6z\" />\n          <path\n            fill=\"#40327A\"\n            d=\"M441.599 92.963h-11.444a2.733 2.733 0 1 1 0-5.464H441.6a2.733 2.733 0 1 1 0 5.464z\"\n          />\n          <path\n            fill=\"#624AC9\"\n            d=\"M419.332 81.144h59.84V82.3h-59.84zM411.722 81.144h3.236V82.3h-3.236z\"\n          />\n          <path\n            fill=\"#8B77E8\"\n            d=\"M430.109 107.67h27.897v1.156h-27.897zM462.93 107.67h7.203v1.156h-7.203z\"\n          />\n          <path\n            fill=\"#E1DBFF\"\n            d=\"M423.441 44.023h57.084v28.706h-57.084zM429.508 30.714h57.084v9.822h-57.084z\"\n          />\n          <path fill=\"#E1DBFF\" d=\"M420.323 40.535h57.084v3.487h-57.084z\" />\n          <path\n            fill=\"#F0EDFF\"\n            d=\"M411.241 44.023h57.084v28.706h-57.084zM417.308 30.714h57.084v9.822h-57.084z\"\n          />\n          <path fill=\"#F0EDFF\" d=\"M408.123 40.535h57.084v3.487h-57.084z\" />\n          <path\n            fill=\"#E1DBFF\"\n            d=\"M468.326 51.993v-7.97h-51.174zM422.531 0h57.084v17.741h-57.084zM424.285 17.741h57.084v12.973h-57.084z\"\n          />\n          <path\n            fill=\"#F0EDFF\"\n            d=\"M410.331 0h57.084v17.741h-57.084zM412.086 17.741h57.084v12.973h-57.084z\"\n          />\n          <path\n            fill=\"#E1DBFF\"\n            d=\"M469.17 22.982V17.74h-33.651zM474.392 34.663v-3.95h-25.354z\"\n          />\n          <path\n            fill=\"#CCC2FF\"\n            d=\"M481.103 72.729h-1.156V44.6h-3.117v-4.643h9.184v-8.666h-5.223V18.319h-1.754V4.026h1.156v13.137h1.754v12.973h5.223v10.977h-9.184v2.332h3.117z\"\n          />\n          <path fill=\"#CCC2FF\" d=\"M472.641 43.445h4.767v1.156h-4.767z\" />\n        </g>\n        <g fill=\"#B3A4F5\">\n          <path d=\"M237.565 159.005l6.029-11.445h-5.598v-2.203h9.523l-6.028 11.445h6.18v2.203h-10.106zM258.336 148.31l7.77-14.752h-7.215v-2.84h12.276l-7.77 14.753h7.965v2.84zM279.107 137.616l9.512-18.06h-8.833v-3.475h15.028l-9.512 18.06h9.752v3.475z\" />\n        </g>\n        <g>\n          <path\n            fill=\"#DDD6FF\"\n            d=\"M232.246 338.464v-3.467l44.255-3.467v6.934z\"\n          />\n          <path fill=\"#C4B8FF\" d=\"M275.924 286.494h6.935v51.97h-6.935z\" />\n          <path\n            fill=\"#C4B8FF\"\n            d=\"M326.535 338.464v-3.467l-44.255-3.467v6.934z\"\n          />\n          <path fill=\"#A796F2\" d=\"M282.86 286.494v11.37l-6.936-.796v-10.574z\" />\n          <g fill=\"#4F37B3\" transform=\"translate(229.567 339.3)\">\n            <ellipse\n              cx=\"5.399\"\n              cy=\"6.174\"\n              rx=\"4.333\"\n              ry=\"4.334\"\n              transform=\"rotate(-76.714 5.4 6.174)\"\n            />\n            <circle\n              cx=\"49.821\"\n              cy=\"6.146\"\n              r=\"4.334\"\n              transform=\"rotate(-45 49.82 6.146)\"\n            />\n            <circle\n              cx=\"94.24\"\n              cy=\"6.147\"\n              r=\"4.334\"\n              transform=\"rotate(-45 94.24 6.147)\"\n            />\n          </g>\n          <path\n            fill=\"#7760DB\"\n            d=\"M282.282 286.494h1.156v33.866h-1.156zM282.282 322.19h1.156v2.215h-1.156zM232.246 337.886h22.128v1.156h-22.128zM257.978 337.886h4.045v1.156h-4.045zM271.27 337.886h55.266v1.156H271.27z\"\n          />\n        </g>\n        <path\n          fill=\"#FFD259\"\n          d=\"M326.1 264.549h-29.412l-42.767-75.893a9.248 9.248 0 0 0-8.057-4.707h-47.452c-7.142 0-11.588 7.75-7.982 13.912l40.59 69.367a38.95 38.95 0 0 0 33.619 19.276H326.1c6.064 0 10.98-4.914 10.98-10.977 0-6.063-4.916-10.978-10.98-10.978z\"\n        />\n        <g fill=\"#E5659B\">\n          <path d=\"M192.357 202.305l.998-.584 20.398 34.864-.998.583zM192.354 202.293l-2.422-4.14a10.087 10.087 0 0 1-.869-1.915l1.097-.363c.193.582.452 1.152.77 1.695l2.422 4.14-.998.583zM188.62 194.146a9.591 9.591 0 0 1-.038-1.347l1.155.05c-.017.395-.006.793.033 1.184l-1.15.113zM331.154 266.434a10.32 10.32 0 0 0-.932-.46l.458-1.06c.353.152.702.324 1.036.51l-.562 1.01zM326.1 287.082h-3.094v-1.155h3.094c5.736 0 10.403-4.666 10.403-10.4 0-2.71-1.036-5.274-2.917-7.222l.83-.803a11.496 11.496 0 0 1 3.243 8.025c0 6.371-5.186 11.555-11.56 11.555zM311.689 285.927h4.578v1.156h-4.578zM309.907 287.082H264.64c-13.984 0-27.057-7.496-34.118-19.562l-7.795-13.323.997-.583 7.796 13.322c6.854 11.714 19.545 18.99 33.12 18.99h45.268v1.156zM220.407 250.214l.998-.584.67 1.145-.998.584z\" />\n        </g>\n        <circle\n          cx=\"413.994\"\n          cy=\"234.303\"\n          r=\"4.877\"\n          fill=\"#7760DB\"\n          transform=\"rotate(-45 413.994 234.303)\"\n        />\n        <ellipse\n          cx=\"264.816\"\n          cy=\"204.263\"\n          fill=\"#7760DB\"\n          rx=\"11.557\"\n          ry=\"11.557\"\n          transform=\"rotate(-39.156 264.816 204.263)\"\n        />\n        <ellipse\n          cx=\"295.723\"\n          cy=\"258.56\"\n          fill=\"#7760DB\"\n          rx=\"7.888\"\n          ry=\"7.888\"\n          transform=\"rotate(-37.508 295.723 258.56)\"\n        />\n        <path\n          fill=\"#FFF\"\n          d=\"M240.055 206.206l31.012 29.681-9.492-28.858-6.49-10.293z\"\n        />\n        <g>\n          <path fill=\"#DDD6FF\" d=\"M126.47 359.61H42.294h84.176z\" />\n          <path fill=\"#C4B8FF\" d=\"M42.293 359.033h84.176v1.156H42.293z\" />\n        </g>\n        <g>\n          <path fill=\"#DDD6FF\" d=\"M141.365 359.61h-5.797 5.797z\" />\n          <path fill=\"#C4B8FF\" d=\"M135.568 359.033h5.797v1.156h-5.797z\" />\n        </g>\n        <g>\n          <path fill=\"#DDD6FF\" d=\"M379.205 359.61H155.34h223.865z\" />\n          <path fill=\"#C4B8FF\" d=\"M155.34 359.033h223.865v1.156H155.34z\" />\n        </g>\n        <g>\n          <path fill=\"#DDD6FF\" d=\"M633.691 359.61H396.69 633.69z\" />\n          <path fill=\"#C4B8FF\" d=\"M396.69 359.033h237.002v1.156H396.69z\" />\n        </g>\n        <g>\n          <path fill=\"#DDD6FF\" d=\"M274.329 368.415H88.869h185.46z\" />\n          <path fill=\"#C4B8FF\" d=\"M88.868 367.837h185.46v1.156H88.868z\" />\n        </g>\n        <g>\n          <path fill=\"#DDD6FF\" d=\"M571.308 368.415H293.264h278.044z\" />\n          <path fill=\"#C4B8FF\" d=\"M293.264 367.837h278.044v1.156H293.264z\" />\n        </g>\n        <path\n          fill=\"#C4B8FF\"\n          d=\"M683.372 349.784h5.619v1.156h-5.619zM0 349.784h673.543v1.156H0z\"\n        />\n        <path\n          fill=\"#40327A\"\n          d=\"M208.269 349.785h170.935v1.156H208.269zM536.533 349.784h89.196v1.156h-89.196zM463.175 349.784h56.213v1.156h-56.213zM191.685 349.785h5.715v1.156h-5.715zM152.417 349.785h32.092v1.156h-32.092zM17.277 349.785h3.144v1.156h-3.144zM120.487 349.785h24.382v1.156h-24.382z\"\n        />\n        <path\n          fill=\"#C4B8FF\"\n          d=\"M640.325 359.033h9.417v1.156h-9.417zM75.602 367.837h5.426v1.156h-5.426z\"\n        />\n        <g>\n          <path fill=\"#DDD6FF\" d=\"M589.069 368.415h7.32-7.32z\" />\n          <path fill=\"#C4B8FF\" d=\"M589.069 367.837h7.32v1.156h-7.32z\" />\n        </g>\n        <path fill=\"#40327A\" d=\"M439.15 349.785h11.985v1.156H439.15z\" />\n        <path\n          fill=\"#FFF\"\n          d=\"M492.12 292.225l1.149-.126 5.418 49.393-1.15.126z\"\n        />\n        <path\n          fill=\"#40327A\"\n          d=\"M48.53 349.784h66.919v1.156H48.53zM632.854 349.784h7.161v1.156h-7.161z\"\n        />\n        <path\n          fill=\"#FFF\"\n          d=\"M409.722 198.717h-1.156v-18.318h10.515v-18.781h1.155v19.936h-10.514zM432.161 180.399h22.512v1.156h-22.512zM423.708 180.399h2.312v1.156h-2.312zM414.401 125.41h28.421v1.156h-28.421zM449.252 39.957h2.731v1.156h-2.731zM417.308 39.957h27.023v1.156h-27.023z\"\n        />\n        <path fill=\"#40327A\" d=\"M28.319 349.784h13.974v1.156H28.319z\" />\n        <g>\n          <path\n            fill=\"#FF95A9\"\n            fillRule=\"nonzero\"\n            d=\"M594.72 134.167c-.441.127-.904.203-1.385.209l-.525.007-.092-7.116h.001a3.15 3.15 0 1 0-.081-6.3h-.002l-3.122.04a3.179 3.179 0 0 1-3.22-3.137l-.039-3.022c-.76 1.275-2.194 2.126-3.774 2.147l-2.094.027-3.663.047-2.188.028-4.953.064a7.34 7.34 0 0 1-.583-.021l.127 9.765.072 5.609a7.512 7.512 0 0 0 7.61 7.413l4.068-.053.967 7.644h14.563l-1.687-13.35zm-20.115-.596l-1.8.057-.06-1.903 2.896-.77a2.64 2.64 0 0 1 2.91 1.14l1.19 1.883s-1.44-.524-5.136-.407z\"\n          />\n          <path\n            fill=\"#FFF\"\n            d=\"M578.642 159.686l3.07 12.278 3.715-21.684h1.156l3.716 21.684 6.11-24.446h-17.767z\"\n          />\n          <path\n            fill=\"#40327A\"\n            d=\"M585.427 150.28l-3.716 21.684.56 2.244 7.117 1.403.911-3.647-3.716-21.684zM575.384 344.002l-5.602 3.055a1.45 1.45 0 0 0 .694 2.724h14.669v-5.778H575.384z\"\n          />\n          <path fill=\"#FF95A9\" d=\"M586.2 110.598l-.043-3.352.043 3.352z\" />\n          <path\n            fill=\"#40327A\"\n            d=\"M569.583 117.161l4.953-.064 2.188-.028 3.663-.047 2.094-.027c1.58-.021 3.015-.872 3.774-2.147l.039 3.022a3.178 3.178 0 0 0 3.22 3.137l3.122-.04h.002a3.151 3.151 0 1 1 .081 6.3h-.001l.092 7.116.525-.007a5.253 5.253 0 0 0 1.385-.209 5.25 5.25 0 0 0 3.8-5.11l-.129-9.884-.082-6.365c-.075-5.8-4.839-10.44-10.64-10.365l-1.574.02.062 4.783.043 3.353-.043-3.353-.062-4.782-11.747.151-2.432.032-2.52.032a7.243 7.243 0 0 0-7.15 7.335 7.237 7.237 0 0 0 3.789 6.269 7.205 7.205 0 0 0-1.213 4.103 7.237 7.237 0 0 0 4.304 6.52L569 117.14c.193.012.386.024.583.021z\"\n          />\n          <path\n            fill=\"#FF95A9\"\n            d=\"M611.245 174.524a4.624 4.624 0 0 0-6.414-1.27l-6.073 4.064-.402.06 12.727 2.51a4.619 4.619 0 0 0 .162-5.364zM578.415 177.376l1.114-3.707a3.45 3.45 0 0 0-2.054.22l-7.416 3.22a4.62 4.62 0 0 0-2.726 4.923l10.608-1.591-.399-.163.873-2.902z\"\n          />\n          <path\n            fill=\"#7760DB\"\n            fillRule=\"nonzero\"\n            d=\"M629.805 186.94l.007-.005-15.715-34.46-.004.003a11.572 11.572 0 0 0-1.12-1.945c-3.591-5.015-10.45-6.287-15.592-3.015h-18.537a11.454 11.454 0 0 0-2.718-.926 11.573 11.573 0 0 0-10.78 1.667l.342.454a10.926 10.926 0 0 0-2.776 3.064 11.058 11.058 0 0 0-.927 1.922l-.223.605-.004-.002-1.587 4.293-.542-.2-.893 2.416.542.2-10.424 28.212a7.31 7.31 0 0 0 .98 6.865l-.463.342a7.88 7.88 0 0 0 7.508 3.11 7.866 7.866 0 0 0 1.483-.382l.003.013 8.047-2.869-.195-.544 25.367-9.113-12.091-4.945.437-1.07 22.918 9.372-.438 1.07-9.228-3.774-25.054 9.001.848 17.288c0 .689.036 1.369.1 2.041l.287 5.846.02.386c0 .018.003.036.005.054l2.382 48.52c0 .251.017.497.043.74l3.576 72.83h9.756v-73.57h-.007l.004-36.361a21.112 21.112 0 0 0 11.212-.381l13.083 110.326.028-.015h9.76c0-.115-.009-.228-.017-.341h.006l-8.47-122.41.276-5.623c.064-.672.1-1.353.1-2.042l.942-19.193 7.579 3.099.001-.005a7.883 7.883 0 0 0 10.725-5.765 7.829 7.829 0 0 0-.562-4.784zm-31.449-9.561l.402-.06 6.073-4.065a4.625 4.625 0 0 1 6.414 1.27 4.619 4.619 0 0 1-.162 5.363l-12.727-2.508zm-1.948-29.861l-6.109 24.446-.91 3.647-7.117-1.403-.56-2.245-3.07-12.277v-12.168h17.766zm-16.265 32.593l-2.202.33-.398-.163.398.163-10.608 1.592a4.62 4.62 0 0 1 2.726-4.924l7.416-3.22a3.448 3.448 0 0 1 2.054-.22l-1.114 3.707 1.115-3.708 3.005.592-2.392 5.85zm29.127 13.765l-4.68-1.914.438-1.07 4.68 1.914-.438 1.07z\"\n          />\n          <path\n            fill=\"#FFF\"\n            d=\"M579.53 173.668l-1.115 3.708-.873 2.902.4.163 2.2-.33 2.392-5.851z\"\n          />\n          <path\n            fill=\"#40327A\"\n            d=\"M604.559 191.97l.437-1.07 4.68 1.912-.438 1.07zM602.411 191.071l.438-1.07-22.918-9.37-.438 1.069 12.092 4.944-25.368 9.113.196.544.195.544 1.52-.546 25.055-9.001zM561.758 154.302l.004.001.223-.605c.251-.678.563-1.324.927-1.921a10.93 10.93 0 0 1 2.776-3.064l-.341-.455-.353-.47a12.067 12.067 0 0 0-3.855 4.912l-.018-.009-2.034 5.503.542.2.542.2 1.587-4.292zM548.485 192.829a7.31 7.31 0 0 1 .369-3.607l10.424-28.212-.542-.2-.542-.2-10.426 28.21-.178.487.015.008a8.473 8.473 0 0 0 1.3 7.46l.467-.346.462-.342a7.31 7.31 0 0 1-1.35-3.258z\"\n          />\n          <path\n            fill=\"#FFF\"\n            d=\"M575.64 130.955l-2.896.77.06 1.903 1.801-.057c3.696-.117 5.136.407 5.136.407l-1.19-1.883a2.64 2.64 0 0 0-2.91-1.14z\"\n          />\n          <path\n            fill=\"#40327A\"\n            d=\"M609.465 344.002l-.027.015-5.575 3.04a1.45 1.45 0 0 0 .695 2.724h14.668v-5.778h-9.76z\"\n          />\n        </g>\n        <g fill=\"#CCC2FF\">\n          <path d=\"M572.338 94.985h-1.156c0-2.207-1.046-3.31-2.152-4.476l-.106-.112.84-.794.105.11c1.157 1.22 2.469 2.605 2.469 5.272zM567.717 85.237h-1.156c0-2.667 1.312-4.05 2.469-5.271 1.106-1.168 2.152-2.27 2.152-4.477 0-2.206-1.045-3.309-2.152-4.476-1.157-1.22-2.469-2.603-2.469-5.27 0-2.667 1.312-4.05 2.469-5.271 1.106-1.167 2.152-2.27 2.152-4.476h1.156c0 2.667-1.312 4.05-2.47 5.27-1.106 1.168-2.15 2.27-2.15 4.477 0 2.206 1.044 3.308 2.151 4.475 1.157 1.22 2.469 2.604 2.469 5.271s-1.312 4.05-2.469 5.271c-1.106 1.168-2.152 2.27-2.152 4.477zM581.53 94.985h-1.156c0-2.207-1.045-3.31-2.151-4.477-1.158-1.22-2.469-2.604-2.469-5.271s1.311-4.05 2.469-5.271c1.106-1.168 2.151-2.27 2.151-4.477 0-2.206-1.045-3.309-2.151-4.476-1.158-1.22-2.469-2.603-2.469-5.27 0-2.667 1.311-4.05 2.469-5.271 1.106-1.167 2.151-2.27 2.151-4.476h1.156c0 2.667-1.311 4.05-2.468 5.27-1.107 1.168-2.152 2.27-2.152 4.477 0 2.206 1.045 3.308 2.152 4.475 1.157 1.221 2.468 2.604 2.468 5.271s-1.311 4.05-2.468 5.271c-1.107 1.168-2.152 2.27-2.152 4.477 0 2.207 1.045 3.31 2.152 4.477 1.157 1.22 2.468 2.604 2.468 5.27zM590.723 94.985h-1.156c0-2.207-1.045-3.31-2.152-4.477-1.157-1.22-2.468-2.604-2.468-5.271s1.311-4.051 2.468-5.272c.164-.173.328-.345.489-.522l.855.778c-.166.182-.335.36-.505.54-1.106 1.167-2.152 2.27-2.152 4.476s1.045 3.31 2.152 4.476c1.158 1.22 2.469 2.604 2.469 5.272zM590.723 75.49h-1.156c0-2.207-1.045-3.31-2.152-4.476-1.157-1.221-2.468-2.604-2.468-5.271h1.156c0 2.206 1.045 3.309 2.151 4.476 1.158 1.22 2.469 2.603 2.469 5.27zM588.468 61.041l-.842-.791c1.1-1.17 1.941-2.225 1.941-4.254h1.156c0 2.446-1.067 3.782-2.255 5.045z\" />\n        </g>\n        <g>\n          <path d=\"M234.312 200.887a5.253 5.253 0 0 1-6.596 3.415l-5.186-1.646-4.308-1.368-5.079 12.571 20.936-3.887 5.977-3.766-5.688-5.495-.056.176zM248.589 183.992l-2.521 7.935 6.571 6.35 2.384-1.502 5.656-18.58-12.108 3.203c.27.812.298 1.712.018 2.594z\" />\n          <path\n            fill=\"#FF95A9\"\n            d=\"M246.06 191.949a8.404 8.404 0 0 1-10.552 5.464l-9.376-2.977-.822-.262a3.152 3.152 0 1 0 2.05 3.956v-.002l7.11 2.258-.103.325 5.688 5.495 12.584-7.93-6.572-6.35-.006.023z\"\n          />\n          <path\n            fill=\"#7760DB\"\n            fillRule=\"nonzero\"\n            d=\"M340.409 225.808c-1.216 0-2.352.329-3.335.896l-.003-.005-13.885 8.015 15.657-21.138-10.59-8.158-31.407 39.122-22.255-39.46 1.738.35 3.857-37.679-.008-.001a7.832 7.832 0 0 0-.744-4.246 7.885 7.885 0 0 0-10.536-3.644c-.018.009-.033.02-.05.028l-33.183 16.12 9.992 2.646a4.2 4.2 0 0 1 2.913 2.744l12.108-3.204-5.656 18.58-2.383 1.502-12.584 7.93-5.976 3.766-20.936 3.887 5.078-12.571-3.321-1.055a10.452 10.452 0 0 1-5.523-4.14l-4.3 6.597.488.318-2.19 3.359-.487-.317-.753 1.155.486.317-8.297 12.727a7.24 7.24 0 0 0-1.03 5.488 7.255 7.255 0 0 0 3.161 4.614 7.231 7.231 0 0 0 3.914 1.178l.574.017 35.933.35 15.45 22.034-.472.332 3.708 5.288.473-.332 1.053 1.502-.473.332 1.555 2.218.474-.332 2.323 3.313c6.228 8.882 18.33 11.357 27.553 5.636l25.373-15.753.305.492 3.54-2.197-.305-.491 16.288-10.11.304.49 8.28-5.14h71.693v-9.752l-72.85-3.575a6.753 6.753 0 0 0-.74-.043zm-82.146-2.178l-18.207-17.423 15.03-9.47 6.49 10.293 3.952 12.022 5.539 16.836-12.804-12.257z\"\n          />\n          <path\n            fill=\"#40327A\"\n            d=\"M423.102 223.064c-.282 0-.555.09-.782.256l-8.321 6.1v9.759h5.201l5.147-14.347a1.322 1.322 0 0 0-1.245-1.768z\"\n          />\n          <path\n            fill=\"#4F37B3\"\n            d=\"M317.434 253.938l.305.49.305.492 16.287-10.111-.305-.49-.305-.492z\"\n          />\n          <path\n            fill=\"#FFF\"\n            d=\"M250.818 202.69l14.71 16.362-3.953-12.022-6.49-10.294-15.03 9.47 18.208 17.424-8.423-20.325z\"\n          />\n          <path\n            fill=\"#40327A\"\n            d=\"M250.818 202.69l-.978.616 8.423 20.324 12.804 12.258-5.54-16.836z\"\n          />\n          <path\n            fill=\"#FF95A9\"\n            d=\"M222.787 173.07l-2.937 9.244a8.81 8.81 0 0 1-4.703 5.327l11.996 3.809a3.5 3.5 0 0 0 4.341-2.292l4.177-13.15-7.034-1.865-2.62-.694a11.574 11.574 0 0 0-3.22-.38z\"\n          />\n          <path\n            fill=\"#40327A\"\n            fillRule=\"nonzero\"\n            d=\"M214.9 200.233l3.322 1.055 4.308 1.368 5.186 1.646a5.253 5.253 0 0 0 6.596-3.415l.056-.176.103-.325-7.11-2.258-.002.002a3.152 3.152 0 1 1-2.05-3.956l.824.261v.001l9.375 2.977a8.404 8.404 0 0 0 10.553-5.464l.007-.022 2.52-7.935a4.178 4.178 0 0 0-.017-2.594 4.2 4.2 0 0 0-2.913-2.744l-9.992-2.645h-.004l-4.177 13.15a3.5 3.5 0 0 1-4.342 2.291l-11.996-3.808a8.81 8.81 0 0 0 4.703-5.327l2.938-9.245a11.555 11.555 0 0 1 3.22.38l2.62.694a7.086 7.086 0 0 0-4.879-7.675 7.073 7.073 0 0 0-6.253.987 6.3 6.3 0 0 0-6.726 2.627 4.188 4.188 0 0 0-.664 1.27l-.097.306-.003.007-1.543 4.86-.159.5a4.183 4.183 0 0 0 .23 3.108 4.192 4.192 0 0 0-2.522 2.656 4.2 4.2 0 0 0 1.887 4.897 10.468 10.468 0 0 0 1.48 8.407 10.446 10.446 0 0 0 5.521 4.14zm24.129-20.363c.532-.205 1.215.282 1.525 1.088.31.805.13 1.624-.404 1.829-.532.204-1.215-.283-1.525-1.088-.31-.805-.129-1.624.404-1.829z\"\n          />\n          <path\n            fill=\"#4F37B3\"\n            d=\"M236.876 231.896l-35.933-.35-.573-.017a7.231 7.231 0 0 1-3.914-1.177 7.254 7.254 0 0 1-3.161-4.615 7.24 7.24 0 0 1 1.03-5.488l8.297-12.727-.486-.317-.482-.314-8.259 12.666-.075.108-.005.018a8.388 8.388 0 0 0-1.151 6.292 8.403 8.403 0 0 0 3.66 5.344 8.367 8.367 0 0 0 3.964 1.342v.03l36.483.355 15.11 21.547.474-.331.473-.332-15.452-22.034zM205.565 203.008l-.487-.318-.481-.313-2.19 3.359.482.314.486.317zM288.52 271.887c-9.222 5.721-21.324 3.246-27.552-5.636l-2.324-3.313-.473.331-.473.332 2.323 3.313c4.189 5.974 10.892 9.204 17.725 9.204 3.9 0 7.843-1.053 11.384-3.25l25.373-15.752-.305-.49-.305-.491-25.372 15.752zM256.036 259.218l-.473.331-.474.332 1.054 1.502.473-.331.473-.332z\"\n          />\n          <path\n            fill=\"#FFF\"\n            d=\"M240.15 182.787c.533-.205.714-1.024.404-1.83-.31-.805-.993-1.292-1.525-1.087-.533.205-.714 1.024-.404 1.83.31.804.993 1.291 1.525 1.087z\"\n          />\n        </g>\n        <g>\n          <g fill=\"#DDD6FF\">\n            <path d=\"M185.161 239.187l-.607 5.778L173.06 349.78h-2.918l8.628-110.593zM486.928 239.187l.606 5.778L499.03 349.78h2.919l-8.63-110.593z\" />\n          </g>\n          <path fill=\"#B3A4F5\" d=\"M166.762 239.187h337.542v5.778H166.762z\" />\n          <path fill=\"#F8F7FF\" d=\"M166.762 244.965h138.412-138.412z\" />\n          <path fill=\"#40327A\" d=\"M166.761 244.387h138.412v1.156H166.761z\" />\n          <path fill=\"#F8F7FF\" d=\"M465.284 244.965h39.02-39.02z\" />\n          <path fill=\"#40327A\" d=\"M465.284 244.387h39.02v1.156h-39.02z\" />\n          <path fill=\"#F8F7FF\" d=\"M454.102 244.965h5.334-5.334z\" />\n          <path fill=\"#40327A\" d=\"M454.102 244.387h5.334v1.156h-5.334z\" />\n          <path\n            fill=\"#F8F7FF\"\n            d=\"M176.316 320.084l-1.933 17.624 1.933-17.624z\"\n          />\n          <path\n            fill=\"#B3A4F5\"\n            d=\"M173.829 337.647l1.931-17.625 1.15.126-1.932 17.625z\"\n          />\n          <g>\n            <path\n              fill=\"#F8F7FF\"\n              d=\"M184.038 249.675l-7.142 65.118 7.142-65.118z\"\n            />\n            <path\n              fill=\"#B3A4F5\"\n              d=\"M176.342 314.732l7.136-65.122 1.15.125-7.137 65.123z\"\n            />\n          </g>\n          <g>\n            <path fill=\"#F8F7FF\" d=\"M498.13 300.84l.498 6.378-.498-6.378z\" />\n            <path\n              fill=\"#B3A4F5\"\n              d=\"M497.582 300.87l1.152-.09.498 6.377-1.152.09z\"\n            />\n          </g>\n          <g>\n            <path\n              fill=\"#F8F7FF\"\n              d=\"M494.018 248.131l3.704 47.477-3.704-47.477z\"\n            />\n            <path\n              fill=\"#B3A4F5\"\n              d=\"M493.465 248.164l1.152-.09 3.706 47.478-1.152.09z\"\n            />\n          </g>\n          <g>\n            <path fill=\"#F8F7FF\" d=\"M342.656 244.965h105.101-105.101z\" />\n            <path fill=\"#40327A\" d=\"M342.656 244.387h105.101v1.156h-105.1z\" />\n          </g>\n        </g>\n        <g>\n          <path\n            fill=\"#40327A\"\n            d=\"M405.995 235.701a1.45 1.45 0 0 0-1.48.065l-5.338 3.495-4.608 8.602 5.095 2.728 6.925-12.927a1.45 1.45 0 0 0-.594-1.963z\"\n          />\n          <path\n            fill=\"#7760DB\"\n            d=\"M336.785 203.749l-.004.007a6.713 6.713 0 0 0-.848-.416 6.68 6.68 0 1 0-5.481 12.17l-.002.003 9.959 5.025.26-.516 15.476 7.809-.26.515 5.133 2.59.26-.516 13.09 6.605-.26.516 2.902 1.465.26-.516 3.406 1.718-.26.516 14.079 7.103 4.604-8.594-62.314-35.484z\"\n          />\n          <path\n            fill=\"#4F37B3\"\n            d=\"M340.67 220.022l-.261.516-.26.516 15.475 7.809.26-.516.261-.516zM361.278 230.42l-.26.517-.26.515 13.089 6.605.26-.516.26-.515zM377.27 238.49l-.26.516-.26.516 3.405 1.718.26-.516.261-.515z\"\n          />\n        </g>\n      </g>\n    </svg>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport {\n  makeStyles,\n  cn,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { Text } from '../../../../../../../styles/components/texts.tsx';\nimport { layout } from '../../../../../../../styles/index.ts';\nimport EmptyIllustration from './empty-illustration.tsx';\n\nconst useStyles = makeStyles((theme) => ({\n  image: {\n    display: 'flex',\n    marginTop: '30px',\n  },\n  text: {\n    display: 'inline-block',\n    textAlign: 'center',\n  },\n  header1: {\n    fontSize: '24px',\n    color: '#273142',\n    marginTop: '8%',\n    fontWeight: 'normal',\n  },\n  header2: {\n    fontSize: '18px',\n    marginTop: '15px',\n    color: 'rgba(17, 8, 43, 0.8)',\n  },\n}));\n\nexport function EmptyListState() {\n  const styles = useStyles();\n  return (\n    <div className={cn(layout.column, layout.flex)}>\n      <Text className={cn(styles.header1, styles.text)}>\n        Time to Start Moving\n      </Text>\n      <Text className={cn(styles.header2, styles.text)}>\n        Create notes, invite team members and get some work done\n      </Text>\n      <div className={cn(layout.centerCenter, styles.image)}>\n        <EmptyIllustration />\n      </div>\n    </div>\n  );\n}\n", "import React, {\n  useEffect,\n  useRef,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport { useScrollParent } from '../../../../../core/react-utils/scrolling.tsx';\nimport { layout, styleguide } from '../../../../../../../styles/index.ts';\nimport SpinnerView from '../../../../../../../styles/components/spinner-view.tsx';\nimport {\n  makeStyles,\n  cn,\n} from '../../../../../../../styles/css-objects/index.ts';\n\nconst useStyles = makeStyles((theme) => ({\n  loaderContainer: {\n    basedOn: [layout.row, layout.centerCenter],\n  },\n}));\n\ninterface InfiniteScrollProps {\n  recordsLength: number;\n  limit: number;\n  setLimit: React.Dispatch<React.SetStateAction<number>>;\n  pageSize: number;\n  isVisible: boolean;\n}\nconst THRESHOLD = 300;\n\nexport function InfiniteScroll({\n  recordsLength,\n  limit,\n  setLimit,\n  pageSize,\n  isVisible,\n}: InfiniteScrollProps) {\n  const styles = useStyles();\n  const scrollParent = useScrollParent();\n  const parentEl = scrollParent;\n  const previousLimit = useRef(limit);\n  const canLoadMore = recordsLength >= limit;\n  const [didMount, setDidMount] = useState(false);\n  useEffect(() => {\n    if (limit < previousLimit.current) {\n      if (parentEl) {\n        parentEl.scrollTop = 0;\n      }\n    }\n    previousLimit.current = limit;\n  }, [limit, parentEl]);\n  useEffect(() => {\n    if (parentEl && canLoadMore) {\n      const handler = () => {\n        const diff =\n          parentEl.scrollHeight - (parentEl.scrollTop + parentEl.clientHeight);\n        if (diff < THRESHOLD) {\n          setLimit((x) => x + pageSize);\n        }\n      };\n      parentEl.addEventListener('scroll', handler);\n\n      return () => {\n        parentEl.removeEventListener('scroll', handler);\n      };\n    }\n  }, [parentEl, canLoadMore, pageSize, didMount, setLimit]);\n  useEffect(() => {\n    let canMount = true;\n    window.setTimeout(() => {\n      if (canMount) {\n        setDidMount(true);\n      }\n    }, 0);\n    return () => {\n      canMount = false;\n    };\n  }, []);\n\n  if (canLoadMore && isVisible) {\n    return (\n      <div className={cn(styles.loaderContainer)}>\n        <SpinnerView size={styleguide.gridbase * 3} />\n      </div>\n    );\n  }\n  return null;\n}\n", "import { CoreValue } from '../../../../base/core-types/base.ts';\nimport { coreValueCompare } from '../../../../base/core-types/comparable.ts';\nimport * as SetUtils from '../../../../base/set.ts';\nimport {\n  FilterGroupBy,\n  FilterSortBy,\n  NoteStatus,\n  ViewType,\n} from '../../../base/scheme-types.ts';\nimport {\n  GroupByFuncResult,\n  Query,\n  QueryOptions,\n  SourceProducer,\n  SourceType,\n  UnionQuery,\n} from '../query.ts';\nimport { Vertex, VertexId } from '../vertex.ts';\nimport { BaseVertex, Note, Tag, User, Workspace } from './index.ts';\nimport { NoteType } from './note.ts';\n\nexport class Filter extends BaseVertex {\n  get parent(): Vertex {\n    return this.owner;\n  }\n\n  get owner(): User {\n    return this.graph.getVertex<User>(this.record.get<string>('owner')!);\n  }\n\n  set owner(u: User) {\n    this.record.set('owner', u.key);\n  }\n\n  clearOwner(): void {\n    this.record.set('owner', this.graph.rootKey);\n  }\n\n  get tags(): Set<Tag> {\n    return this.vertSetForField('tags');\n  }\n\n  set tags(tags: Set<Tag>) {\n    this.record.set(\n      'tags',\n      SetUtils.map(tags, (t) => t.key)\n    );\n  }\n\n  get assignees(): Set<User> {\n    return this.vertSetForField('assignees');\n  }\n\n  set assignees(assignees: Set<User>) {\n    this.record.set(\n      'assignees',\n      SetUtils.map(assignees, (u) => u.key)\n    );\n  }\n\n  // get workspaces(): Set<Workspace> {\n  //   return this.vertSetForField('workspaces');\n  // }\n\n  // set workspaces(workspaces: Set<Workspace>) {\n  //   this.record.set(\n  //     'workspaces',\n  //     SetUtils.map(workspaces, (ws) => ws.key)\n  //   );\n  // }\n\n  get noteType(): NoteType | undefined {\n    return this.record.get<NoteType>('noteType');\n  }\n\n  set noteType(type: NoteType | undefined) {\n    if (!type) {\n      this.record.delete('noteType');\n    } else {\n      this.record.set('noteType', type);\n    }\n  }\n\n  get statuses(): Set<NoteStatus> | undefined {\n    return this.record.get<Set<NoteStatus>>('statuses');\n  }\n\n  set statuses(s: Set<NoteStatus> | undefined) {\n    if (s && s.size > 0) {\n      this.record.set('statuses', s);\n    } else {\n      this.record.delete('statuses');\n    }\n  }\n\n  get sortBy(): FilterSortBy {\n    return this.record.get<FilterSortBy>('sortBy', 'priority');\n  }\n\n  set sortBy(v: FilterSortBy) {\n    this.record.set('sortBy', v);\n  }\n\n  get pinned(): boolean | undefined {\n    const v = this.record.get<number>('pinned');\n    if (typeof v === 'undefined') {\n      return undefined;\n    }\n    return v !== 0;\n  }\n\n  set pinned(v: boolean | undefined) {\n    if (typeof v === 'undefined') {\n      this.record.delete('pinned');\n    } else {\n      this.record.set('pinned', v ? 1 : 0);\n    }\n  }\n\n  get groupBy(): FilterGroupBy | undefined {\n    return this.record.get<FilterGroupBy>('groupBy');\n  }\n\n  set groupBy(groupBy: FilterGroupBy | undefined) {\n    if (!groupBy) {\n      this.record.delete('groupBy');\n    } else {\n      this.record.set('groupBy', groupBy);\n    }\n  }\n\n  get groupByPivot(): Vertex | undefined {\n    const key = this.record.get<string>('groupByPivot');\n    return key ? this.graph.getVertex(key) : undefined;\n  }\n\n  set groupByPivot(v: Vertex | undefined) {\n    if (v) {\n      this.record.set('groupByPivot', v.key);\n    } else {\n      this.record.delete('groupByPivot');\n    }\n  }\n\n  get textQuery(): string {\n    return this.record.get<string>('textQuery', '');\n  }\n\n  set textQuery(q: string | undefined) {\n    if (q && q.length > 0) {\n      this.record.set('textQuery', q);\n    } else {\n      this.record.delete('textQuery');\n    }\n  }\n\n  getEffectiveWorkspaces(): Workspace[] {\n    // if (this.workspaces) {\n    //   return Array.from(this.workspaces);\n    // }\n    return this.graph.sharedQueriesManager.selectedWorkspaces.results.map(\n      (mgr) => mgr.getVertexProxy()\n    );\n  }\n\n  get viewType(): ViewType {\n    return this.record.get('viewType', ViewType.List);\n  }\n\n  set viewType(type: ViewType) {\n    this.record.set('viewType', type);\n  }\n\n  private buildQuerySource(\n    pinned: boolean,\n    workspaces?: Set<Workspace>\n  ): SourceType<Note> | SourceProducer<Note> {\n    if (workspaces) {\n      return new UnionQuery(\n        SetUtils.map(workspaces, (ws) =>\n          pinned ? ws.pinnedNotesQuery : ws.notesQuery\n        )\n      );\n    }\n    return () =>\n      new UnionQuery(\n        this.getEffectiveWorkspaces().map((ws) =>\n          pinned ? ws.pinnedNotesQuery : ws.notesQuery\n        )\n      );\n  }\n\n  buildQuery(\n    name: string,\n    pinned?: boolean,\n    workspaces?: Set<Workspace>\n  ): Query<Note, Note> {\n    // if (!workspaces) {\n    //   workspaces = this.workspaces;\n    // }\n    if (typeof pinned === 'undefined') {\n      pinned = this.pinned;\n    }\n    const graph = this.graph;\n    const sharedQueriesManager = graph.sharedQueriesManager;\n    const deps: Query[] = [];\n    if (!workspaces) {\n      deps.push(sharedQueriesManager.selectedWorkspaces as unknown as Query);\n    }\n    const type = this.noteType;\n    const assignees = this.assignees;\n    const tagsByParent = this.breakTagsByParents(this.tags);\n    let sortByField: keyof Note;\n    switch (this.sortBy) {\n      case 'created':\n        sortByField = 'creationDate';\n        break;\n\n      case 'modified':\n        sortByField = 'lastModified';\n        break;\n\n      case 'due':\n        sortByField = 'dueDate';\n        break;\n\n      case 'priority':\n        sortByField = 'sortStamp';\n        break;\n    }\n    const opts: QueryOptions<Note> = {\n      name,\n      deps,\n      sortBy: (n1, n2) =>\n        coreValueCompare(\n          n2[sortByField] as CoreValue,\n          n1[sortByField] as CoreValue\n        ),\n    };\n    switch (this.groupBy) {\n      case 'assignee':\n        opts.groupBy = groupByField('assignees');\n        break;\n\n      case 'workspace':\n        opts.groupBy = groupByField('workspace');\n        break;\n\n      case 'tag': {\n        const pivotTag = this.groupByPivot;\n        if (!(pivotTag instanceof Tag)) {\n          break;\n        }\n        const childTagsQuery = pivotTag.childTagsQuery;\n        deps.push(childTagsQuery as unknown as Query);\n        opts.groupBy = (note) => note.tags.get(pivotTag);\n        break;\n      }\n    }\n\n    return new Query(\n      this.buildQuerySource(pinned === true, workspaces),\n      (note) =>\n        (!type || note.type === type) &&\n        note.parentType !== NoteType.Task &&\n        (!pinned || note.isPinned === pinned) &&\n        (assignees.size === 0 ||\n          (SetUtils.intersects(note.assignees, assignees) &&\n            this.checkNoteMatchesTags(note, tagsByParent))),\n      opts\n    );\n  }\n\n  private breakTagsByParents(tags: Iterable<Tag>): Map<Tag, Set<Tag>> {\n    const result = new Map<Tag, Set<Tag>>();\n    for (const t of tags) {\n      const parent = t.parentTag;\n      let childrenSet = result.get(parent || t);\n      if (!childrenSet) {\n        childrenSet = new Set();\n        result.set(parent || t, childrenSet);\n      }\n      if (parent) {\n        childrenSet.add(t);\n      } else {\n        // We found a selected parent. Include all of its children.\n        SetUtils.update(\n          childrenSet,\n          Query.blocking(\n            this.graph.sharedQueriesManager.tags,\n            (x) => x.parentTag === t\n          ).map((mgr) => mgr.getVertexProxy())\n        );\n      }\n    }\n    return result;\n  }\n\n  private checkNoteMatchesTags(\n    note: Note,\n    tagsByParent: Map<Tag, Set<Tag>>\n  ): boolean {\n    if (tagsByParent.size === 0) {\n      return true;\n    }\n    const noteTags = note.tags;\n    for (const [parent, selectedChildren] of tagsByParent) {\n      const child = noteTags.get(parent);\n      if (!child || !selectedChildren.has(child)) {\n        return false;\n      }\n    }\n    return true;\n  }\n}\n\nfunction groupByField<T extends Vertex, FT extends keyof T>(\n  field: FT\n): (v: T) => GroupByFuncResult {\n  return (v: T) => v[field] as GroupByFuncResult;\n}\n", "export { BaseVertex, ContentVertex } from './base.ts';\nexport { User } from './user.ts';\nexport { Workspace } from './workspace.ts';\nexport { Note } from './note.ts';\nexport { Tag } from './tag.ts';\nexport { Filter } from './filter.ts';\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { IconProps, IconSize } from './types.ts';\n\nconst STYLE: any = {\n  mixBlendMode: 'overlay',\n};\n\nexport function IconNewTask({ size = IconSize.Small, className }: IconProps) {\n  return (\n    <svg\n      className={className}\n      width={size}\n      height={size}\n      viewBox=\"0 0 18 18\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <rect\n        x=\"1.5\"\n        y=\"1.5\"\n        width=\"14.9375\"\n        height=\"14.9375\"\n        rx=\"1.5\"\n        fill=\"#FBF6EF\"\n        stroke=\"#3184DD\"\n      />\n      <g filter=\"url(#filter0_bd_1176_23785)\">\n        <rect\n          x=\"1.06274\"\n          y=\"1.0625\"\n          width=\"15.9356\"\n          height=\"15.9375\"\n          rx=\"2\"\n          fill=\"url(#paint0_radial_1176_23785)\"\n          fillOpacity=\"0.3\"\n          shapeRendering=\"crispEdges\"\n        />\n        <rect\n          x=\"1.56274\"\n          y=\"1.5625\"\n          width=\"14.9356\"\n          height=\"14.9375\"\n          rx=\"1.5\"\n          stroke=\"#CCCCCC\"\n          strokeOpacity=\"0.3\"\n          style={STYLE}\n          shapeRendering=\"crispEdges\"\n        />\n      </g>\n      <path\n        opacity=\"0.6\"\n        d=\"M9 12L9 6\"\n        stroke=\"#3184DD\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M6 9L12 9\"\n        stroke=\"#1960CF\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <defs>\n        <filter\n          id=\"filter0_bd_1176_23785\"\n          x=\"0.0627441\"\n          y=\"0.0625\"\n          width=\"17.9355\"\n          height=\"17.9375\"\n          filterUnits=\"userSpaceOnUse\"\n          colorInterpolationFilters=\"sRGB\"\n        >\n          <feFlood floodOpacity=\"0\" result=\"BackgroundImageFix\" />\n          <feGaussianBlur in=\"BackgroundImage\" stdDeviation=\"0.5\" />\n          <feComposite\n            in2=\"SourceAlpha\"\n            operator=\"in\"\n            result=\"effect1_backgroundBlur_1176_23785\"\n          />\n          <feColorMatrix\n            in=\"SourceAlpha\"\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n            result=\"hardAlpha\"\n          />\n          <feOffset />\n          <feGaussianBlur stdDeviation=\"0.5\" />\n          <feComposite in2=\"hardAlpha\" operator=\"out\" />\n          <feColorMatrix\n            type=\"matrix\"\n            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.2 0\"\n          />\n          <feBlend\n            mode=\"normal\"\n            in2=\"effect1_backgroundBlur_1176_23785\"\n            result=\"effect2_dropShadow_1176_23785\"\n          />\n          <feBlend\n            mode=\"normal\"\n            in=\"SourceGraphic\"\n            in2=\"effect2_dropShadow_1176_23785\"\n            result=\"shape\"\n          />\n        </filter>\n        <radialGradient\n          id=\"paint0_radial_1176_23785\"\n          cx=\"0\"\n          cy=\"0\"\n          r=\"1\"\n          gradientUnits=\"userSpaceOnUse\"\n          gradientTransform=\"translate(2.28856 2.28846) rotate(45.0034) scale(20.804)\"\n        >\n          <stop stopColor=\"white\" />\n          <stop offset=\"1\" stopColor=\"#E5E5E5\" />\n        </radialGradient>\n      </defs>\n    </svg>\n  );\n}\n", "{\n  \"en\": {\n    \"pinnedTasks\": \"My Pinned Tasks\",\n    \"pinTaskCta\": \"Pin your top tasks to organize your task list\",\n    \"pinnedNotes\": \"My Pinned Notes\",\n    \"pinNotesCta\": \"Pin your top notes to organize your notes\",\n    \"newTask\": \"New Task\",\n    \"saveDraft\": \"Save to\",\n    \"cardMoved\": \"Card moved to {workspace}\",\n    \"draftSaved\": \"Task saved to {workspace}\"\n  }\n}", "import React from 'https://esm.sh/react@18.2.0';\nimport { styleguide } from '../../../../../../../../styles/styleguide.ts';\nimport {\n  cn,\n  makeStyles,\n} from '../../../../../../../../styles/css-objects/index.ts';\nexport enum GridColumns {\n  DragAnchor = 'dragAnchor',\n  Type = 'icon',\n  Title = 'title',\n  Expander = 'expander',\n  ContentIndicator = 'contentIndicator',\n  Workspace = 'workspace',\n  Assignees = 'assignees',\n  Tags = 'tags',\n  Extra = 'extra',\n  DueDate = 'dueDate',\n  Pin = 'pin',\n  Menu = 'menu',\n}\n\nexport const useGridStyles = makeStyles(\n  () => ({\n    container: {\n      display: 'grid',\n      gridTemplateColumns: [\n        // [`[${GridColumns.DragAnchor}]`, styleguide.gridbase * 3],\n        [`[${GridColumns.Type}]`, styleguide.gridbase * 4],\n        [`[${GridColumns.Title}]`, 'minmax(min-content, auto)'],\n        [`[${GridColumns.Expander}]`, styleguide.gridbase * 4],\n        [`[${GridColumns.ContentIndicator}]`, styleguide.gridbase * 4],\n        [`[${GridColumns.Workspace}]`, styleguide.gridbase * 10],\n        [`[${GridColumns.Assignees}]`, 'max-content'],\n        [`[${GridColumns.Tags}]`, 'max-content'],\n        [\n          `[${GridColumns.Extra}]`,\n          `minmax(max-content, ${styleguide.gridbase * 20}px)`,\n        ],\n        [`[${GridColumns.DueDate}]`, 'max-content'],\n        [`[${GridColumns.Pin}]`, styleguide.gridbase * 3],\n        [`[${GridColumns.Menu}]`, styleguide.gridbase * 4],\n      ],\n      gridAutoRows: 'min-content',\n      alignItems: 'stretch',\n    },\n    table: {\n      width: '100%',\n      borderCollapse: 'collapse',\n    },\n  }),\n  'table_01387e'\n);\n\nexport interface ItemsTableProps {\n  className?: string;\n  children?: React.ReactNode;\n}\n\nexport const _ItemsTable: React.FC<ItemsTableProps> = ({\n  children,\n  className,\n}) => {\n  const styles = useGridStyles();\n  return <div className={cn(styles.container)}>{children}</div>;\n};\n\nexport const ItemsTable: React.FC<ItemsTableProps> = ({\n  children,\n  className,\n}) => {\n  const styles = useGridStyles();\n  return (\n    <table className={cn(styles.table)}>\n      <tbody>{children}</tbody>\n    </table>\n  );\n};\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { IconProps, IconSize } from './types.ts';\n\nexport function IconArrowDown({ size = IconSize.Small, className }: IconProps) {\n  return (\n    <svg\n      className={className}\n      width={size}\n      height={size}\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        opacity=\"0.8\"\n        d=\"M10 8L6 4\"\n        stroke=\"#4D4D4D\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.8\"\n        d=\"M6 12L10 8\"\n        stroke=\"#262626\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n    </svg>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { IconProps, IconSize } from './types.ts';\n\nexport function IconPinOff({ className, size = IconSize.Small }: IconProps) {\n  return (\n    <svg\n      className={className}\n      width={size}\n      height={size}\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        opacity=\"0.6\"\n        d=\"M2.75 7.125L8.875 13.25L9.75 12.375L10.625 8.875L14.125 5.375L10.625 1.875L7.125 5.375L3.625 6.25L2.75 7.125Z\"\n        fill=\"#CCCCCC\"\n        stroke=\"#B3B3B3\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M1 15L5.8125 10.1875\"\n        stroke=\"#8C8C8C\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M2.75 7.125L8.875 13.25\"\n        stroke=\"#8C8C8C\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M8.875 13.25L9.75 12.375L10.625 8.875\"\n        stroke=\"#8C8C8C\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M10.625 8.875L14.125 5.375\"\n        stroke=\"#8C8C8C\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M2.75 7.125L3.625 6.25L7.125 5.375\"\n        stroke=\"#8C8C8C\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M10.625 1.875L7.125 5.375\"\n        stroke=\"#8C8C8C\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M9.74976 1L14.9998 6.25\"\n        stroke=\"#8C8C8C\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n    </svg>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { IconProps, IconSize } from './types.ts';\n\nexport function IconPinOn({ size = IconSize.Small, className }: IconProps) {\n  return (\n    <svg\n      className={className}\n      width={size}\n      height={size}\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        opacity=\"0.6\"\n        d=\"M2.75 7.125L8.875 13.25L9.75 12.375L10.625 8.875L14.125 5.375L10.625 1.875L7.125 5.375L3.625 6.25L2.75 7.125Z\"\n        fill=\"#8BC5EE\"\n        stroke=\"#3184DD\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M1 15L5.8125 10.1875\"\n        stroke=\"#3184DD\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M2.75 7.125L8.875 13.25\"\n        stroke=\"#3184DD\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M8.875 13.25L9.75 12.375L10.625 8.875\"\n        stroke=\"#6AB6EF\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M10.625 8.875L14.125 5.375\"\n        stroke=\"#6AB6EF\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M2.75 7.125L3.625 6.25L7.125 5.375\"\n        stroke=\"#57A5E9\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M10.625 1.875L7.125 5.375\"\n        stroke=\"#57A5E9\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M9.74976 1L14.9998 6.25\"\n        stroke=\"#3184DD\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        strokeLinejoin=\"round\"\n      />\n    </svg>\n  );\n}\n", "import React, {\n  KeyboardEvent,\n  MouseEvent,\n  MouseEventHandler,\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport {\n  Editable,\n  ReactEditor,\n  Slate,\n} from 'https://esm.sh/slate-react@0.87.1';\nimport { VertexManager } from '../../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport {\n  Note,\n  Tag,\n  User,\n  Workspace,\n} from '../../../../../../../../cfds/client/graph/vertices/index.ts';\nimport { layout, styleguide } from '../../../../../../../../styles/index.ts';\nimport { Button } from '../../../../../../../../styles/components/buttons.tsx';\nimport { CheckBox } from '../../../../../../../../styles/components/inputs/index.ts';\nimport { IconArrowDown } from '../../../../../../../../styles/components/new-icons/icon-arrow-down.tsx';\nimport { IconContent } from '../../../../../../../../styles/components/new-icons/icon-content.tsx';\nimport { IconDelete } from '../../../../../../../../styles/components/new-icons/icon-delete.tsx';\nimport {\n  DueDateState,\n  IconDueDate,\n} from '../../../../../../../../styles/components/new-icons/icon-due-date.tsx';\nimport { IconNewTask } from '../../../../../../../../styles/components/new-icons/icon-new-task.tsx';\nimport { IconNote } from '../../../../../../../../styles/components/new-icons/icon-note.tsx';\nimport { IconPinOff } from '../../../../../../../../styles/components/new-icons/icon-pin-off.tsx';\nimport { IconPinOn } from '../../../../../../../../styles/components/new-icons/icon-pin-on.tsx';\nimport { useToastController } from '../../../../../../../../styles/components/toast/index.tsx';\nimport {\n  Text,\n  TextSm,\n  useTypographyStyles,\n} from '../../../../../../../../styles/components/typography.tsx';\nimport {\n  cn,\n  makeStyles,\n} from '../../../../../../../../styles/css-objects/index.ts';\nimport { brandLightTheme as theme } from '../../../../../../../../styles/theme.tsx';\nimport { usePartialVertex } from '../../../../../../core/cfds/react/vertex.ts';\nimport {\n  createUseStrings,\n  format,\n} from '../../../../../../core/localization/index.tsx';\nimport { useTitleEditor } from '../../../../../../core/slate/index.tsx';\nimport { isHotkeyActive } from '../../../../../../core/slate/utils/hotkeys.ts';\nimport {\n  AssignButton,\n  Assignee,\n} from '../../../../../../shared/card/assignees-view.tsx';\nimport { RenderDraggableProps } from '../../../../../../shared/dragndrop/draggable.tsx';\nimport CardMenuView from '../../../../../../shared/item-menu/index.tsx';\nimport TagButton from '../../../../../../shared/tags/tag-button.tsx';\nimport TagView from '../../../../../../shared/tags/tag-view.tsx';\nimport { assignNote } from '../../../../../../shared/utils/assignees.ts';\nimport { moveCard } from '../../../../../../shared/utils/move.ts';\nimport { useWorkspaceColor } from '../../../../../../shared/workspace-icon/index.tsx';\nimport {\n  WorkspaceIndicator,\n  WorkspaceIndicatorButtonProps,\n} from '../../card-item/workspace-indicator.tsx';\nimport localization from '../list.strings.json' assert { type: 'json' };\nimport { GridColumns, useGridStyles } from './grid.tsx';\nimport { useLogger } from '../../../../../../core/cfds/react/logger.tsx';\nimport { formatTimeDiff } from '../../../../../../../../base/date.ts';\nimport { NoteStatus } from '../../../../../../../../cfds/base/scheme-types.ts';\nimport { NoteType } from '../../../../../../../../cfds/client/graph/vertices/note.ts';\n\nexport const ROW_HEIGHT = styleguide.gridbase * 5.5;\n\nconst useStyles = makeStyles(\n  (_, resolveClass) => ({\n    row: {\n      height: ROW_HEIGHT,\n    },\n    itemRow: {\n      position: 'relative',\n      // This is required to allow position relative for table\n      // rows on certain browsers\n      transform: 'scale(1)',\n      borderBottom: `1px solid ${theme.primary.p3}`,\n      ':hover': {\n        [GridColumns.DragAnchor]: {\n          opacity: 1,\n        },\n        visibleOnHover: {\n          opacity: 1,\n        },\n      },\n      boxShadow: theme.shadows.z2,\n      // [`& + ${resolveClass('itemRow')}`]: {\n      //   boxShadow: 'none',\n      // },\n      backgroundColor: theme.colors.background,\n    },\n    doneIndicator: {\n      pointerEvents: 'none',\n      position: 'absolute',\n      top: '50%',\n      left: styleguide.gridbase * 4,\n      width: 0,\n      height: 1,\n      backgroundColor: theme.mono.m4,\n      ...styleguide.transition.standard,\n      transitionProperty: 'width',\n    },\n    doneIndicatorActive: {\n      width: `calc(100% - ${styleguide.gridbase * 8}px)`,\n    },\n    cell: {},\n    cellInner: {\n      height: '100%',\n      alignItems: 'center',\n      basedOn: [layout.row],\n    },\n    iconCell: {\n      width: styleguide.gridbase * 4,\n      cellInner: {\n        width: styleguide.gridbase * 4,\n        alignItems: 'center',\n        justifyContent: 'center',\n      },\n    },\n    [GridColumns.DragAnchor]: {\n      cursor: 'grab',\n      opacity: 0,\n      // gridColumn: GridColumns.DragAnchor,\n    },\n    [GridColumns.Type]: {\n      width: styleguide.gridbase * 5,\n      // gridColumn: GridColumns.Type,\n    },\n    childPadding: {\n      width: styleguide.gridbase * 5,\n      background: theme.primary.p2,\n    },\n    [GridColumns.Title]: {\n      // gridColumn: GridColumns.Title,\n      width: '100%',\n      cursor: 'pointer',\n      position: 'relative',\n    },\n    titleContainer: {\n      position: 'absolute',\n      top: 0,\n      left: 0,\n      right: 0,\n      bottom: 0,\n      alignItems: 'center',\n      basedOn: [layout.row],\n    },\n    [GridColumns.Expander]: {\n      // gridColumn: GridColumns.Expander,\n      cursor: 'pointer',\n    },\n    expanderIcon: {\n      ...styleguide.transition.short,\n      transitionProperty: 'transform',\n      transform: 'rotate(90deg)',\n    },\n    expanderIconExpanded: {\n      transform: 'rotate(270deg)',\n    },\n    [GridColumns.ContentIndicator]: {\n      // gridColumn: GridColumns.ContentIndicator,\n    },\n\n    [GridColumns.Workspace]: {\n      // gridColumn: GridColumns.Workspace,\n      width: styleguide.gridbase * 10,\n      padding: [0, styleguide.gridbase * 0.5],\n      boxSizing: 'border-box',\n    },\n    wsIndicatorButton: {\n      alignItems: 'flex-start',\n    },\n    wsIndicator: {\n      width: styleguide.gridbase * 10,\n      boxSizing: 'border-box',\n      textAlign: 'start',\n      whiteSpace: 'nowrap',\n      overflow: 'hidden',\n      textOverflow: 'ellipsis',\n      userSelect: 'none',\n      backgroundColor: 'var(--ws-background)',\n      padding: [0, styleguide.gridbase * 0.5, styleguide.gridbase * 0.25],\n      height: styleguide.gridbase * 2,\n      lineHeight: `${styleguide.gridbase * 2}px`,\n      marginRight: styleguide.gridbase * 0.5,\n      borderRadius: [2, styleguide.gridbase, styleguide.gridbase, 2],\n      basedOn: [useTypographyStyles.textSmall],\n    },\n    [GridColumns.Assignees]: {\n      // gridColumn: GridColumns.Assignees,\n    },\n    assignee: {\n      marginRight: styleguide.gridbase * 0.5,\n    },\n    [GridColumns.Tags]: {\n      padding: [0, styleguide.gridbase],\n      // gridColumn: GridColumns.Tags,\n    },\n    tag: {\n      marginRight: styleguide.gridbase * 0.5,\n    },\n    [GridColumns.DueDate]: {\n      padding: [0, styleguide.gridbase * 0.5],\n      whiteSpace: 'nowrap',\n      // basedOn: [layout.row],\n    },\n    dueDateIcon: {\n      marginRight: styleguide.gridbase * 0.5,\n    },\n    [GridColumns.Pin]: {\n      // gridColumn: GridColumns.Pin,\n      width: styleguide.gridbase * 3,\n    },\n    [GridColumns.Extra]: {},\n    pinOff: {\n      opacity: 0,\n      ...styleguide.transition.short,\n      transitionProperty: 'opacity',\n    },\n    pinOffOver: {\n      opacity: 1,\n    },\n    [GridColumns.Menu]: {\n      // gridColumn: GridColumns.Menu,\n      // basedOn: [layout.row, layout.centerCenter],\n    },\n    nowrap: {\n      whiteSpace: 'nowrap',\n    },\n    titleEditor: {\n      width: '100%',\n      overflow: 'hidden',\n      textOverflow: 'ellipsis',\n    },\n    titleText: {\n      lineHeight: `${styleguide.gridbase * 3}px`,\n      basedOn: [useTypographyStyles.text],\n    },\n    fillRow: {\n      backgroundColor: 'transparent',\n      // gridColumn: `${GridColumns.Type}/-1`,\n    },\n    border: {\n      height: 1,\n      boxSizing: 'border-box',\n      gridColumn: `${GridColumns.Type}/-1`,\n      borderBottom: `1px solid ${theme.primary.p2}`,\n      boxShadow: theme.shadows.z2,\n    },\n    plusButton: {\n      height: styleguide.gridbase * 2,\n      width: styleguide.gridbase * 2,\n      borderRadius: styleguide.gridbase,\n      backgroundColor: theme.mono.m1,\n      opacity: 0,\n      ...styleguide.transition.short,\n      transitionProperty: 'opacity',\n    },\n    visibleOnHover: {\n      opacity: 0,\n    },\n    backdrop: {\n      position: 'absolute',\n      top: 0,\n      left: 0,\n      right: 0,\n      bottom: 0,\n    },\n  }),\n  'item_1cda8c'\n);\n\nexport { useStyles as useRowStyles };\n\nconst useStrings = createUseStrings(localization);\n\nexport const Row: React.FC<{\n  className?: string;\n  children: React.ReactNode;\n}> = ({ children, className }) => {\n  const styles = useStyles();\n\n  return (\n    <tr className={cn(styles.row, styles.fillRow, className)}>\n      <Cell colSpan={100}>{children}</Cell>\n    </tr>\n  );\n};\n\nexport interface ItemRowProps extends Partial<RenderDraggableProps> {\n  note: VertexManager<Note>;\n  index?: number;\n  onClick?: (note: VertexManager<Note>) => void;\n  isChild?: boolean;\n  onWorkspaceMoved?: (note: VertexManager<Note>) => void;\n}\n\ninterface CellProps {\n  className?: string;\n  innerClassName?: string;\n  colSpan?: number;\n  onClick?: MouseEventHandler;\n  children?: React.ReactNode;\n}\n\nexport const Cell: React.FC<CellProps> = ({\n  children,\n  className,\n  innerClassName,\n  ...rest\n}) => {\n  const styles = useStyles();\n\n  return (\n    <td className={cn(styles.cell, className)} {...rest}>\n      <div className={cn(styles.cellInner, innerClassName)}>{children}</div>\n    </td>\n  );\n};\n\nexport const ItemRow = React.forwardRef<HTMLTableRowElement, ItemRowProps>(\n  function (\n    { onWorkspaceMoved, note, isChild, onClick = () => {}, attributes },\n    ref\n  ) {\n    const styles = useStyles();\n    const gridStyles = useGridStyles();\n    const [isMouseOver, setIsMouseOver] = useState(false);\n    const { childCards } = usePartialVertex(note, ['childCards']);\n    const onMouseOver = useCallback(() => setIsMouseOver(true), []);\n    const onMouseLeave = useCallback(() => setIsMouseOver(false), []);\n    const onClickImpl = (e: MouseEvent) => {\n      e.stopPropagation();\n      onClick(note);\n    };\n\n    const [isExpanded, setIsExpanded] = useState(false);\n\n    return (\n      <React.Fragment>\n        <tr\n          className={cn(styles.row, styles.itemRow)}\n          ref={ref}\n          onMouseOver={onMouseOver}\n          onMouseLeave={onMouseLeave}\n        >\n          {/* <div className={cn(styles[GridColumns.DragAnchor])} {...attributes}>\n          ::\n        </div> */}\n          {isChild ? (\n            <React.Fragment>\n              <Cell className={cn(styles.childPadding)} />\n              <Cell className={cn(styles[GridColumns.Title])}>\n                <table className={cn(gridStyles.table)}>\n                  <TypeCell note={note} />\n                  <TitleCell note={note} onClick={onClickImpl} />\n                </table>\n              </Cell>\n            </React.Fragment>\n          ) : (\n            <React.Fragment>\n              <TypeCell note={note} />\n              <TitleCell note={note} onClick={onClickImpl} />\n            </React.Fragment>\n          )}\n          <ExpanderCell\n            note={note}\n            isExpanded={isExpanded}\n            setIsExpanded={setIsExpanded}\n          />\n          <ContentIndicatorCell note={note} />\n          <WorkspaceCell note={note} onWorkspaceMoved={onWorkspaceMoved} />\n          <AssigneesCell note={note} showMenu={isMouseOver} />\n          <TagsCell note={note} showMenu={isMouseOver} />\n          <td className={cn(styles.cell, styles[GridColumns.Extra])} />\n          <DateCell note={note} />\n          <PinCell isChild={isChild} note={note} isMouseOver={isMouseOver} />\n          <MenuCell note={note} />\n          <DoneIndicator note={note} />\n        </tr>\n        {isExpanded &&\n          childCards.map((x) => (\n            <ItemRow\n              note={x.manager as VertexManager<Note>}\n              key={x.key}\n              onClick={onClick}\n              isChild={true}\n            />\n          ))}\n      </React.Fragment>\n    );\n  }\n);\n\nexport function DraftItemRow({\n  note,\n  onWorkspaceMoved,\n  onCancel,\n}: {\n  note: VertexManager<Note>;\n  onWorkspaceMoved: (note: VertexManager<Note>) => void;\n  onCancel: () => void;\n}) {\n  const styles = useStyles();\n\n  const onClickImpl = (e: MouseEvent) => {\n    e.stopPropagation();\n  };\n\n  const onKeyDown = (e: KeyboardEvent) => {\n    if (\n      isHotkeyActive(e, {\n        metaKeys: [],\n        key: 'Escape',\n      })\n    ) {\n      e.stopPropagation();\n      onCancel();\n    }\n  };\n\n  return (\n    <tr className={cn(styles.row, styles.itemRow)} onKeyDown={onKeyDown}>\n      <TypeCell note={note} isDraft={true} />\n      <TitleCell note={note} isDraft={true} onClick={onClickImpl} />\n\n      <WorkspaceCell\n        note={note}\n        isDraft={true}\n        onWorkspaceMoved={onWorkspaceMoved}\n      />\n      <td className={cn(styles.cell, styles[GridColumns.Extra])} />\n      <td className={cn(styles.cell, styles[GridColumns.Extra])} />\n      <td className={cn(styles.cell, styles[GridColumns.Extra])} />\n      <td className={cn(styles.cell, styles[GridColumns.Extra])} />\n      <td className={cn(styles.cell, styles[GridColumns.Extra])} />\n      <td className={cn(styles.cell, styles[GridColumns.Pin])}>\n        <Button onClick={onCancel}>\n          <IconDelete />\n        </Button>\n      </td>\n    </tr>\n  );\n}\n\nconst DoneIndicator = ({ note }: { note: VertexManager<Note> }) => {\n  const styles = useStyles();\n  const partial = usePartialVertex(note, ['status']);\n  return (\n    <div\n      className={cn(\n        styles.doneIndicator,\n        partial.status === 'Done' && styles.doneIndicatorActive\n      )}\n    />\n  );\n};\n\nconst ExpanderCell = ({\n  note,\n  isExpanded,\n  setIsExpanded,\n}: {\n  note: VertexManager<Note>;\n  isExpanded: boolean;\n  setIsExpanded: React.Dispatch<React.SetStateAction<boolean>>;\n}) => {\n  const styles = useStyles();\n  const { childCards } = usePartialVertex(note, ['childCards']);\n\n  return (\n    <Cell\n      className={cn(styles[GridColumns.Expander])}\n      onClick={() => setIsExpanded((x) => !x)}\n    >\n      {!!childCards?.length && (\n        <IconArrowDown\n          className={cn(\n            styles.expanderIcon,\n            isExpanded && styles.expanderIconExpanded\n          )}\n        />\n      )}\n    </Cell>\n  );\n};\n\nconst ContentIndicatorCell = ({ note }: { note: VertexManager<Note> }) => {\n  const styles = useStyles();\n  const { bodyPreview } = usePartialVertex(note, ['bodyPreview']);\n\n  return (\n    <td\n      className={cn(\n        styles.cell,\n        styles.iconCell,\n        styles[GridColumns.ContentIndicator]\n      )}\n    >\n      {!!bodyPreview.trim().length && <IconContent />}\n    </td>\n  );\n};\n\nconst AssigneesCell = ({\n  note,\n  showMenu,\n}: {\n  note: VertexManager<Note>;\n  showMenu: boolean;\n}) => {\n  const styles = useStyles();\n  const logger = useLogger();\n  const [isInviteOpen, setIsInviteOpen] = useState(false);\n  const { assignees, workspace } = usePartialVertex(note, [\n    'assignees',\n    'workspace',\n  ]);\n  const { users } = usePartialVertex(\n    workspace?.manager as VertexManager<Workspace>,\n    ['users']\n  );\n  const workspaces = useMemo(\n    () => [workspace?.manager as VertexManager<Workspace>],\n    [workspace?.manager]\n  );\n\n  const userManagers = useMemo(\n    () => Array.from(users || []).map((x) => x.manager as VertexManager<User>),\n    [users]\n  );\n  const managers = useMemo(\n    () =>\n      Array.from(assignees || []).map((x) => x.manager as VertexManager<User>),\n    [assignees]\n  );\n  const onUsersInvited = (users: VertexManager<User>[]) => {\n    for (const user of users) {\n      assignNote(logger, 'list', note.getVertexProxy(), user.getVertexProxy());\n    }\n  };\n\n  const onInviteUserSelected = () => {\n    setIsInviteOpen(true);\n  };\n\n  return (\n    <Cell className={cn(styles.assignees)}>\n      {managers.map((x) => (\n        <Assignee\n          key={x.key}\n          user={x}\n          cardManager={note}\n          users={userManagers}\n          assignees={managers}\n          className={cn(styles.assignee)}\n          size=\"small\"\n          onInviteUserSelected={onInviteUserSelected}\n          source=\"list\"\n        />\n      ))}\n      <AssignButton\n        source=\"list\"\n        cardManager={note}\n        users={userManagers}\n        assignees={managers}\n        className={cn(styles.visibleOnHover, styles.assignee)}\n        onInviteUserSelected={onInviteUserSelected}\n      />\n    </Cell>\n  );\n};\n\nconst TagsCell = ({\n  note,\n  showMenu,\n}: {\n  note: VertexManager<Note>;\n  showMenu: boolean;\n}) => {\n  const styles = useStyles();\n  const logger = useLogger();\n  const { tags, workspace } = usePartialVertex(note, ['tags', 'workspace']);\n  const managers = useMemo(\n    () => Array.from(tags).map(([, x]) => x.manager as VertexManager<Tag>),\n    [tags]\n  );\n  const tagsMng = new Map<VertexManager<Tag>, VertexManager<Tag>>();\n  for (const [p, c] of tags) {\n    tagsMng.set(\n      p.manager as VertexManager<Tag>,\n      c.manager as VertexManager<Tag>\n    );\n  }\n  const onDelete = (tag: Tag) => {\n    const proxy = note.getVertexProxy();\n    const newTags = proxy.tags;\n    const tagToDelete = tag.parentTag || tag;\n    newTags.delete(tagToDelete);\n    proxy.tags = newTags;\n    logger.log({\n      severity: 'INFO',\n      event: 'MetadataChanged',\n      metadataType: 'tag',\n      uiSource: 'list',\n      vertex: note.key,\n      removed: tag.key,\n    });\n  };\n  const onTag = (tag: Tag) => {\n    const proxy = note.getVertexProxy();\n    const newTags = proxy.tags;\n\n    const tagKey = tag.parentTag || tag;\n\n    const removedTag = newTags.get(tagKey);\n    // const exists = newTags.has(tagKey);\n    newTags.set(tagKey, tag);\n    // proxy.tags = newTags;\n    logger.log({\n      severity: 'INFO',\n      event: 'MetadataChanged',\n      metadataType: 'tag',\n      removed: removedTag?.key,\n      added: tag.key,\n    });\n  };\n  return (\n    <Cell className={cn(styles[GridColumns.Tags])}>\n      {managers.map((x) => (\n        <TagView\n          className={cn(styles.tag)}\n          showMenu=\"hover\"\n          key={x.key}\n          tag={x}\n          onSelected={onTag}\n          onDelete={onDelete}\n        />\n      ))}\n      {/* <TagButton cardTagsMng={}/> */}\n      <TagButton\n        onTagged={onTag}\n        className={cn(styles.visibleOnHover)}\n        noteId={note}\n      />\n    </Cell>\n  );\n};\n\nconst TypeCell = ({\n  note,\n  isDraft,\n}: {\n  note: VertexManager<Note>;\n  isDraft?: boolean;\n}) => {\n  const styles = useStyles();\n  const partialCard = usePartialVertex(note, ['type']);\n  const isActionable = partialCard.type === NoteType.Task;\n\n  return (\n    <Cell className={cn(styles.iconCell, styles[GridColumns.Type])}>\n      {isDraft ? (\n        <IconNewTask />\n      ) : isActionable ? (\n        <ItemCheckbox note={note} />\n      ) : (\n        <IconNote />\n      )}\n    </Cell>\n  );\n};\n\nconst ItemCheckbox = ({ note }: { note: VertexManager<Note> }) => {\n  const partial = usePartialVertex(note, ['status']);\n  return (\n    <CheckBox\n      name={note.key}\n      checked={partial.status === 'Done'}\n      onChange={() => (partial.status === 'Done' ? 'ToDo' : 'Done')}\n    />\n  );\n};\n\nconst TitleNode = React.forwardRef(\n  (\n    { className, ...props }: { className?: string },\n    ref: React.ForwardedRef<HTMLSpanElement>\n  ) => {\n    const styles = useStyles();\n    return (\n      <Text\n        ref={ref}\n        className={cn(styles.titleText, styles.nowrap, className)}\n        {...props}\n      />\n    );\n  }\n);\nconst DraftTitleNode = React.forwardRef(\n  (\n    { className, ...props }: { className?: string },\n    ref: React.ForwardedRef<HTMLSpanElement>\n  ) => {\n    const styles = useStyles();\n    return (\n      <Text ref={ref} className={cn(styles.titleText, className)} {...props} />\n    );\n  }\n);\n\nfunction TitleCell({\n  note,\n  onClick,\n  isDraft,\n}: {\n  note: VertexManager<Note>;\n  onClick?: MouseEventHandler;\n  isDraft?: boolean;\n}) {\n  const styles = useStyles();\n  const { editor, plugins, handlers } = useTitleEditor(\n    note,\n    isDraft ? DraftTitleNode : TitleNode\n  );\n  useEffect(() => {\n    if (!isDraft) {\n      return;\n    }\n\n    let cancelled = false;\n    setTimeout(() => {\n      if (cancelled) {\n        return;\n      }\n      ReactEditor.focus(editor);\n    }, 0);\n\n    return () => {\n      cancelled = true;\n    };\n  }, [isDraft, editor]);\n  return (\n    <Cell className={cn(styles.title)} onClick={isDraft ? undefined : onClick}>\n      <div className={cn(styles.titleContainer)}>\n        <Slate editor={editor} {...handlers}>\n          <Editable\n            className={cn(styles.titleEditor, !isDraft && styles.nowrap)}\n            {...plugins}\n            readOnly={!isDraft}\n          />\n        </Slate>\n      </div>\n    </Cell>\n  );\n}\n\nfunction WorkspaceDraftIndicatorComponent() {\n  const styles = useStyles();\n  const strings = useStrings();\n\n  return <div className={cn(styles.wsIndicator)}>{strings.saveDraft}</div>;\n}\n\nfunction WorkspaceIndicatorComponent({\n  workspace,\n}: WorkspaceIndicatorButtonProps) {\n  const styles = useStyles();\n  const { name } = usePartialVertex(workspace, ['name']);\n  const color = useWorkspaceColor(workspace);\n  const strings = useStrings();\n  const style = useMemo<any>(\n    () => ({\n      '--ws-background': color.background,\n      '--ws-active': color.active,\n      '--ws-inactive': color.inactive,\n    }),\n    [color]\n  );\n\n  return (\n    <div className={cn(styles.wsIndicator)} style={style}>\n      {name || strings.saveDraft}\n    </div>\n  );\n}\n\nconst WorkspaceCell = ({\n  note,\n  isDraft,\n  onWorkspaceMoved,\n}: {\n  note: VertexManager<Note>;\n  isDraft?: boolean;\n  onWorkspaceMoved?: (note: VertexManager<Note>) => void;\n}) => {\n  const styles = useStyles();\n  const logger = useLogger();\n  const { workspace } = usePartialVertex(note, ['workspace']);\n  const wsManager = workspace.manager as VertexManager<Workspace>;\n  const toastController = useToastController();\n  const strings = useStrings();\n\n  const setWorkspace = (workspace: VertexManager<Workspace>) => {\n    if (isDraft) {\n      const proxy = note.getVertexProxy();\n      proxy.workspace = workspace.getVertexProxy();\n    } else {\n      moveCard(note, workspace, note.graph, logger, 'list');\n    }\n    if (onWorkspaceMoved) {\n      onWorkspaceMoved(note);\n    }\n    toastController.displayToast({\n      text: format(isDraft ? strings.draftSaved : strings.cardMoved, {\n        workspace: workspace.getVertexProxy().name,\n      }),\n      duration: 1500,\n    });\n  };\n\n  return (\n    <Cell\n      className={cn(styles[GridColumns.Workspace])}\n      colSpan={isDraft ? 3 : 1}\n    >\n      <WorkspaceIndicator\n        menuClassName={cn(styles.wsIndicatorButton)}\n        workspace={wsManager}\n        isExpanded={false}\n        setWorkspace={setWorkspace}\n        validateMove={!isDraft}\n        ButtonComponent={\n          isDraft\n            ? WorkspaceDraftIndicatorComponent\n            : WorkspaceIndicatorComponent\n        }\n      />\n    </Cell>\n  );\n};\n\nconst DateCell = ({ note }: { note: VertexManager<Note> }) => {\n  const styles = useStyles();\n  const { dueDate } = usePartialVertex(note, ['dueDate']);\n  let content = null;\n  const isLate = dueDate ? dueDate < new Date() : false;\n\n  if (dueDate) {\n    content = (\n      <React.Fragment>\n        <IconDueDate\n          className={cn(styles.dueDateIcon)}\n          state={isLate ? DueDateState.Late : DueDateState.None}\n        />\n        <TextSm>{formatTimeDiff(dueDate)}</TextSm>\n      </React.Fragment>\n    );\n  }\n  return <Cell className={cn(styles[GridColumns.DueDate])}>{content}</Cell>;\n};\n\nconst PinCell = ({\n  note,\n  isMouseOver,\n  isChild,\n}: {\n  note: VertexManager<Note>;\n  isMouseOver: boolean;\n  isChild?: boolean;\n}) => {\n  const styles = useStyles();\n  const { isPinned } = usePartialVertex(note, ['isPinned']);\n\n  const togglePin = () => {\n    const proxy = note.getVertexProxy();\n    proxy.isPinned = !proxy.isPinned;\n  };\n\n  return (\n    <Cell className={cn(styles.iconCell, styles[GridColumns.Pin])}>\n      {!isChild && (\n        <Button onClick={togglePin}>\n          {isPinned ? (\n            <IconPinOn />\n          ) : (\n            <IconPinOff\n              className={cn(styles.pinOff, isMouseOver && styles.pinOffOver)}\n            />\n          )}\n        </Button>\n      )}\n    </Cell>\n  );\n};\n\nconst MenuCell = ({ note }: { note: VertexManager<Note> }) => {\n  const styles = useStyles();\n\n  return (\n    <Cell\n      className={cn(\n        styles.iconCell,\n        styles.visibleOnHover,\n        styles[GridColumns.Menu]\n      )}\n    >\n      <CardMenuView cardManager={note} source=\"list\" />\n    </Cell>\n  );\n};\n", "export { ItemsTable } from './grid.tsx';\nexport { ItemRow, Row } from './item.tsx';\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { NS_NOTES } from '../../../../../../../cfds/base/scheme-types.ts';\nimport { VertexManager } from '../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport {\n  Note,\n  Workspace,\n} from '../../../../../../../cfds/client/graph/vertices/index.ts';\nimport { NoteType } from '../../../../../../../cfds/client/graph/vertices/note.ts';\nimport { styleguide } from '../../../../../../../styles/styleguide.ts';\nimport {\n  Button,\n  useButtonStyles,\n} from '../../../../../../../styles/components/buttons.tsx';\nimport { IconNewTask } from '../../../../../../../styles/components/new-icons/icon-new-task.tsx';\nimport { Text } from '../../../../../../../styles/components/typography.tsx';\nimport {\n  cn,\n  makeStyles,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { brandLightTheme as theme } from '../../../../../../../styles/theme.tsx';\nimport {\n  useGraphManager,\n  useRootUser,\n} from '../../../../../core/cfds/react/graph.tsx';\nimport { createUseStrings } from '../../../../../core/localization/index.tsx';\nimport localization from './list.strings.json' assert { type: 'json' };\nimport { Row } from './table/index.tsx';\nimport { DraftItemRow, ROW_HEIGHT } from './table/item.tsx';\n\nconst useStyles = makeStyles(\n  () => ({\n    row: {\n      borderBottom: `1px solid ${theme.primary.p3}`,\n    },\n    icon: {\n      marginRight: styleguide.gridbase,\n    },\n    button: {\n      height: ROW_HEIGHT,\n      boxShadow: theme.shadows.z2,\n      boxSizing: 'border-box',\n      padding: [0, styleguide.gridbase],\n      backgroundColor: theme.colors.background,\n      basedOn: [useButtonStyles.button],\n    },\n  }),\n  'inline-task-button_8162e3'\n);\n\nconst useStrings = createUseStrings(localization);\n\nexport interface InlineTaskButtonProps {\n  draft: VertexManager<Note>;\n  setDraft: (note: VertexManager<Note> | null) => void;\n}\n\nexport function InlineTaskButton({ draft, setDraft }: InlineTaskButtonProps) {\n  const styles = useStyles();\n  const strings = useStrings();\n  const graph = useGraphManager();\n  const rootUser = useRootUser();\n  const onClick = () => {\n    const wss = Array.from(\n      rootUser.getVertexProxy().settings.workspaces\n    ).filter((x) => x instanceof Workspace);\n    const ws = wss[0];\n\n    const v = graph.createVertex<Note>(\n      NS_NOTES,\n      {\n        createdBy: rootUser.key,\n        body: {\n          root: { children: [{ tagName: 'p', children: [{ text: '' }] }] },\n        },\n        title: {\n          root: { children: [{ tagName: 'p', children: [{ text: '' }] }] },\n        },\n        type: NoteType.Task,\n        assignees: new Set([rootUser.key]),\n        workspace: ws.key,\n      },\n      undefined,\n      true\n    );\n    setDraft(v.manager as VertexManager<Note>);\n  };\n  const onSave = (note: VertexManager<Note>) => {\n    const proxy = note.getVertexProxy();\n    proxy.tags = new Map(proxy.workspace.taskTags);\n    proxy.isLocal = false;\n    setDraft(null);\n  };\n  const onCancel = () => {\n    const proxy = draft.getVertexProxy();\n    proxy.isDeleted = 1;\n    setDraft(null);\n  };\n  if (!draft) {\n    return (\n      <Row className={cn(styles.row)}>\n        <Button className={cn(styles.button)} onClick={onClick}>\n          <IconNewTask className={styles.icon} />\n          <Text>{strings.newTask}</Text>\n        </Button>\n      </Row>\n    );\n  }\n\n  return (\n    <DraftItemRow onWorkspaceMoved={onSave} note={draft} onCancel={onCancel} />\n  );\n}\n", "import React, { useCallback, useState } from 'https://esm.sh/react@18.2.0';\nimport { VertexManager } from '../../../../../../../cfds/client/graph/vertex-manager.ts';\nimport {\n  Note,\n  NoteType,\n} from '../../../../../../../cfds/client/graph/vertices/note.ts';\nimport { styleguide } from '../../../../../../../styles/styleguide.ts';\nimport { useToastController } from '../../../../../../../styles/components/toast/index.tsx';\nimport { LabelSm } from '../../../../../../../styles/components/typography.tsx';\nimport {\n  cn,\n  makeStyles,\n} from '../../../../../../../styles/css-objects/index.ts';\nimport { createUseStrings } from '../../../../../core/localization/index.tsx';\nimport { useDocumentRouter } from '../../../../../core/react-utils/index.ts';\nimport { Scroller } from '../../../../../core/react-utils/scrolling.tsx';\nimport {\n  CANCELLATION_REASONS,\n  DragAndDropContext,\n  Draggable,\n} from '../../../../../shared/dragndrop/index.ts';\nimport { EmptyListState } from './empty-state.tsx';\nimport { InfiniteScroll } from './infinite-scroll.tsx';\nimport { InlineTaskButton } from './inline-task-button.tsx';\nimport localization from './list.strings.json' assert { type: 'json' };\nimport { ItemRow, ItemsTable, Row } from './table/index.tsx';\nimport { useLogger } from '../../../../../core/cfds/react/logger.tsx';\nimport { useFilter } from '../../../../index.tsx';\nimport { useQuery2 } from '../../../../../core/cfds/react/query.ts';\nimport { RenderDraggableProps } from '../../../../../shared/dragndrop/draggable.tsx';\n\nconst useStyles = makeStyles((theme) => ({\n  item: {\n    position: 'relative',\n    marginBottom: styleguide.gridbase * 2,\n  },\n  listRoot: {\n    height: '100%',\n    overflowY: 'auto',\n  },\n}));\n\nconst useStrings = createUseStrings(localization);\n\nexport interface ListViewProps {\n  className?: string;\n}\n\nconst PAGE_SIZE = 20;\n\ninterface CardsData {\n  pinned: readonly VertexManager<Note>[];\n  unpinned: readonly VertexManager<Note>[];\n}\n\nexport function ListView({ className }: ListViewProps) {\n  const filter = useFilter();\n  const pinnedNotesQuery = useQuery2(filter.buildQuery('listViewPinned', true));\n  const unpinnedNotesQuery = useQuery2(\n    filter.buildQuery('listViewUnpinned', false)\n  );\n  if (pinnedNotesQuery.count + unpinnedNotesQuery.count <= 0) {\n    return <EmptyListState />;\n  }\n  return (\n    <InnerListView\n      noteType={filter.noteType}\n      className={className}\n      cards={{\n        pinned: pinnedNotesQuery.results,\n        unpinned: unpinnedNotesQuery.results,\n      }}\n    />\n  );\n}\n\nconst EMPTY_ARRAY: VertexManager<Note>[] = [];\n\n// function getCardSize(containerWidth: number) {\n//   return containerWidth < 640 ? CardSize.Small : CardSize.Regular;\n// }\n\nexport function InnerListView({\n  cards,\n  className,\n  noteType,\n}: {\n  cards: CardsData;\n  className?: string;\n  noteType?: NoteType;\n}) {\n  const strings = useStrings();\n  const styles = useStyles();\n  const [limit, setLimit] = useState(PAGE_SIZE);\n  const logger = useLogger();\n  const toastController = useToastController();\n  // const containerRef = useRef();\n  const docRouter = useDocumentRouter();\n\n  // const size = useElementSize(containerRef.current);\n  // const cardSize = getCardSize(size.width);\n\n  const onNoteSelected = useCallback(\n    (note: VertexManager<Note>) => {\n      docRouter.goTo(note);\n    },\n    [docRouter]\n  );\n\n  // usePartialVertices(sortBy === SortBy.Priority ? cards.pinned : EMPTY_ARRAY, [\n  //   'sortStamp',\n  // ]);\n  // usePartialVertices(\n  //   sortBy === SortBy.Priority ? cards.unpinned : EMPTY_ARRAY,\n  //   ['sortStamp']\n  // );\n  const [draft, setDraft] = useState<null | VertexManager<Note>>(null);\n\n  let visibleCards = cards.unpinned;\n  // if (sortBy === SortBy.Priority) {\n  //   visibleCards = visibleCards.sort(sortMngStampCompare);\n  // }\n  visibleCards = visibleCards\n    .slice(0, limit)\n    .filter((x) => x.key !== draft?.key);\n  // useEffect(() => {\n  //   setLimit(PAGE_SIZE);\n  // }, [sortBy]);\n  // const onDrop = (\n  //   item: VertexManager<Note>,\n  //   relativeTo: VertexManager<Note>,\n  //   dragPosition: DragPosition\n  // ) => {\n  //   console.log(`DROP`, item);\n  //   return;\n  //   setDragSort(visibleCards, item, relativeTo, dragPosition);\n  // };\n  const onDragStarted = () => {\n    logger.log({\n      severity: 'INFO',\n      event: 'Start',\n      flow: 'dnd',\n      uiSource: 'list',\n    });\n  };\n\n  const onReportDrop = () => {\n    logger.log({\n      severity: 'INFO',\n      event: 'End',\n      flow: 'dnd',\n      uiSource: 'list',\n    });\n  };\n\n  const onDragCancelled = ({ reason }: { reason: string }) => {\n    logger.log({\n      severity: 'INFO',\n      event: 'Cancel',\n      flow: 'dnd',\n      uiSource: 'list',\n    });\n    if (reason === CANCELLATION_REASONS.DISABLED) {\n      toastController.displayToast({\n        text: `Drag and drop is not supported in the selected sort mode`,\n        duration: 5000,\n      });\n    }\n  };\n  let headerText = '';\n  if (noteType === NoteType.Note) {\n    headerText = cards.pinned.length\n      ? strings.pinnedNotes\n      : strings.pinNotesCta;\n  } else if (noteType === NoteType.Task) {\n    headerText = cards.pinned.length ? strings.pinnedTasks : strings.pinTaskCta;\n  }\n  return (\n    <DragAndDropContext\n      disabled={true}\n      onDragStarted={onDragStarted}\n      onDrop={onReportDrop}\n      onDragCancelled={onDragCancelled}\n    >\n      <Scroller>\n        {(ref) => (\n          <div ref={ref} className={cn(styles.listRoot, className)}>\n            <ItemsTable>\n              {!!headerText && (\n                <Row>\n                  <LabelSm>{headerText}</LabelSm>\n                </Row>\n              )}\n\n              {/* <Droppable items={cards.pinned} onDrop={onDrop}>\n                    {({ attributes }) => (\n                      <div {...attributes} style={{ display: 'contents' }}> */}\n              {cards.pinned.map((c, index) => (\n                <Draggable key={c.key} index={index} data={c}>\n                  {(\n                    draggableProps: RenderDraggableProps,\n                    ref: React.MutableRefObject<HTMLTableRowElement>\n                  ) => (\n                    <ItemRow\n                      index={index}\n                      note={c}\n                      key={c.key}\n                      ref={ref}\n                      onClick={onNoteSelected}\n                      {...draggableProps}\n                    />\n                  )}\n                </Draggable>\n              ))}\n\n              <Row>{/* <RaisedButton>Bla</RaisedButton> */}</Row>\n              {noteType === NoteType.Task && (\n                <InlineTaskButton draft={draft!} setDraft={setDraft} />\n              )}\n              {visibleCards.map((c) => (\n                <ItemRow note={c} key={c.key} onClick={onNoteSelected} />\n              ))}\n            </ItemsTable>\n            <InfiniteScroll\n              limit={limit}\n              setLimit={setLimit}\n              pageSize={PAGE_SIZE}\n              recordsLength={cards.unpinned.length}\n              isVisible={true}\n            />\n            {/* <Droppable items={visibleCards} onDrop={onDrop}>\n              {({ attributes }) => (\n                <div {...attributes} ref={containerRef}>\n                  {visibleCards.map((c, index) => (\n                    <Draggable key={c.key} data={c} index={index}>\n                      {(\n                        draggableProps,\n                        ref: React.MutableRefObject<HTMLDivElement>\n                      ) => (\n                        <DraggableCard\n                          className={cn(styles.item)}\n                          card={c}\n                          size={cardSize}\n                          ref={ref}\n                          showChildCards={true}\n                          {...draggableProps}\n                        />\n                      )}\n                    </Draggable>\n                  ))}\n                </div>\n              )}\n            </Droppable>\n            <InfiniteScroll\n              limit={limit}\n              setLimit={setLimit}\n              pageSize={PAGE_SIZE}\n              recordsLength={cards.length}\n              isVisible={true}\n            /> */}\n          </div>\n        )}\n      </Scroller>\n    </DragAndDropContext>\n  );\n}\n", "import React, { useEffect, useMemo } from 'https://esm.sh/react@18.2.0';\nimport { useGraphManager } from '../../../../../core/cfds/react/graph.tsx';\nimport { useLogger } from '../../../../../core/cfds/react/logger.tsx';\nimport { useSharedQuery } from '../../../../../core/cfds/react/query.ts';\nimport { usePartialFilter } from '../../../../index.tsx';\nimport { InnerListView } from '../list-view/index.tsx';\n\nexport interface SearchResultsProps {\n  className?: string;\n}\n\nexport function SearchResults({ className }: SearchResultsProps) {\n  const logger = useLogger();\n  const graph = useGraphManager();\n  const searchEngine = graph.noteSearchEngine;\n  const { textQuery } = usePartialFilter(['textQuery']);\n  const selectedWorkspacesQuery = useSharedQuery('selectedWorkspaces');\n  useEffect(() => {\n    logger.log({\n      severity: 'INFO',\n      event: 'Start',\n      flow: 'search',\n    });\n    return () => {\n      logger.log({\n        severity: 'INFO',\n        event: 'End',\n        flow: 'search',\n      });\n    };\n  }, [logger]);\n  const results = useMemo(() => {\n    const items = searchEngine.search(textQuery, (note) =>\n      selectedWorkspacesQuery.hasVertex(note)\n    );\n    return {\n      unpinned: items,\n      pinned: [],\n    };\n  }, [searchEngine, selectedWorkspacesQuery, textQuery]);\n\n  return <InnerListView className={className} cards={results}></InnerListView>;\n}\n", "import React, { useEffect, useState } from 'https://esm.sh/react@18.2.0';\nimport { layout, styleguide } from '../../../../../../styles/index.ts';\nimport { H2 } from '../../../../../../styles/components/typography.tsx';\nimport { cn, makeStyles } from '../../../../../../styles/css-objects/index.ts';\nimport { MediaQueries } from '../../../../../../styles/responsive.ts';\nimport { createUseStrings } from '../../../../core/localization/index.tsx';\nimport { ToolbarCenterItem } from '../toolbar/index.tsx';\nimport { BoardView } from './board-view/index.tsx';\nimport localization from './cards-display.strings.json' assert { type: 'json' };\nimport {\n  DisplayBar,\n  MOBILE_PADDING,\n  SIDES_PADDING,\n  TABLET_PADDING,\n  ViewType,\n} from './display-bar/index.tsx';\nimport { FiltersView } from './display-bar/filters/index.tsx';\nimport { ActiveFiltersView } from './display-bar/filters/active-filters.tsx';\nimport { SearchField } from './display-bar/search-field.tsx';\nimport { ListView } from './list-view/index.tsx';\nimport { SearchResults } from './search-results/index.tsx';\nimport { useFilter } from '../../../index.tsx';\nimport { useSharedQuery } from '../../../../core/cfds/react/query.ts';\n\nconst useStyles = makeStyles((theme) => ({\n  displayRoot: {\n    flexShrink: 0,\n    flexGrow: 0,\n    overflowY: 'auto',\n    height: '100%',\n    width: '100%',\n    basedOn: [layout.row],\n  },\n  displayMain: {\n    position: 'relative',\n    height: '100%',\n    overflow: 'hidden',\n    flexShrink: 1,\n    flexGrow: 1,\n    basedOn: [layout.column, layout.flex],\n    backgroundColor: theme.background[100],\n  },\n  displayContent: {\n    boxSizing: 'border-box',\n    padding: [styleguide.gridbase * 2, 0],\n    overflow: 'hidden',\n    basedOn: [layout.flexSpacer],\n  },\n  title: {\n    marginTop: styleguide.gridbase * 2,\n    padding: [0, styleguide.gridbase * 2],\n    height: styleguide.gridbase * 6,\n    boxSizing: 'border-box',\n  },\n  contentView: {\n    padding: [0, SIDES_PADDING],\n    [MediaQueries.TabletOnly]: {\n      padding: [0, TABLET_PADDING],\n    },\n    [MediaQueries.Mobile]: {\n      padding: [0, MOBILE_PADDING],\n    },\n  },\n  filters: {\n    padding: [0, SIDES_PADDING],\n    [MediaQueries.TabletOnly]: {\n      padding: [0, TABLET_PADDING],\n    },\n    [MediaQueries.Mobile]: {\n      padding: [0, MOBILE_PADDING],\n    },\n  },\n  activeFilters: {\n    padding: [styleguide.gridbase * 2, SIDES_PADDING],\n\n    [MediaQueries.TabletOnly]: {\n      padding: [styleguide.gridbase * 2, TABLET_PADDING],\n    },\n    [MediaQueries.TabletOnly]: {\n      padding: [styleguide.gridbase * 2, MOBILE_PADDING],\n    },\n  },\n}));\n\nconst useStrings = createUseStrings(localization);\n\nexport function CardsDisplay() {\n  const styles = useStyles();\n  const [viewType, setViewType] = useState(ViewType.List);\n  // const [noteType, setNoteType] = useState(NoteType.Task);\n  // const [sortBy, setSortBy] = useState(SortBy.Priority);\n  // const [groupBy, setGroupBy] = useState<GroupBy>(\n  //   selectedWorkspaces.length < 1 ? { type: 'workspace' } : { type: 'assignee' }\n  // );\n  // const [query, setQuery] = useState('');\n  const [showFilters, setShowFilters] = useState(false);\n  const strings = useStrings();\n  const filter = useFilter();\n  const selectedWorkspacesQuery = useSharedQuery('selectedWorkspaces');\n  // const length = useReffedValue(selectedWorkspaces.length);\n  // const tasksFilter = useFiltersController(selectedWorkspaces);\n  // const notesFilter = useFiltersController(selectedWorkspaces);\n  // const filtersController =\n  //   noteType === NoteType.Task ? tasksFilter : notesFilter;\n  useEffect(() => {\n    if (viewType === ViewType.Board) {\n      filter.groupBy =\n        selectedWorkspacesQuery.count > 1 ? 'workspace' : 'assignee';\n    }\n  }, [viewType, filter, selectedWorkspacesQuery]);\n  // useSyncUrlParam(\n  //   'filter',\n  //   true,\n  //   filtersController.activeFilters,\n  //   filtersController.setActiveFilters,\n  //   {\n  //     isReady: !filtersController.isLoading,\n  //     route: '/',\n  //   }\n  // );\n\n  let content = null;\n  const isInSearch = (filter.textQuery?.length || 0) > 0;\n  if (isInSearch) {\n    content = <SearchResults className={cn(styles.contentView)} />;\n  } else {\n    if (viewType === ViewType.List) {\n      content = <ListView className={cn(styles.contentView)} />;\n    } else if (viewType === ViewType.Board) {\n      content = <BoardView className={cn(styles.contentView)} />;\n    }\n  }\n\n  return (\n    <div className={cn(styles.displayRoot)}>\n      <div className={cn(styles.displayMain)}>\n        {!isInSearch ? (\n          <DisplayBar\n            viewType={viewType}\n            setViewType={setViewType}\n            showFilters={showFilters}\n            setShowFilters={setShowFilters}\n          />\n        ) : (\n          <H2 className={cn(styles.title)}>{strings.searchResults}</H2>\n        )}\n        <ToolbarCenterItem className={cn(layout.flexSpacer)}>\n          <SearchField\n            query={filter.textQuery}\n            setQuery={(q) => {\n              filter.textQuery = q;\n            }}\n          />\n        </ToolbarCenterItem>\n        <FiltersView\n          isVisible={showFilters}\n          setIsVisible={setShowFilters}\n          className={cn(styles.filters)}\n        />\n        <ActiveFiltersView className={cn(styles.activeFilters)} />\n        <div className={cn(styles.displayContent)}>{content}</div>\n      </div>\n    </div>\n  );\n}\n", "{\n  \"en\": {\n    \"noSelectionTitle\": \"You haven't chosen any workspace\",\n    \"noSelectionText\": \"Choose workspaces and start getting things done\",\n    \"orVideo\": \"Or kick back and watch our amazing tutorial\"\n  }\n}", "import React, { useState } from 'https://esm.sh/react@18.2.0';\nimport { layout, styleguide } from '../../../../../../styles/index.ts';\nimport { H3, Text } from '../../../../../../styles/components/texts.tsx';\nimport { cn, makeStyles } from '../../../../../../styles/css-objects/index.ts';\nimport { MediaQueries } from '../../../../../../styles/responsive.ts';\nimport { createUseStrings } from '../../../../core/localization/index.tsx';\nimport localization from './empty-state.strings.json' assert { type: 'json' };\n\nconst useStrings = createUseStrings(localization);\n\nconst useStyles = makeStyles(\n  (theme) => ({\n    root: {\n      position: 'relative',\n      paddingTop: styleguide.gridbase * 8,\n      height: '100%',\n      width: '100%',\n      boxSizing: 'border-box',\n      alignItems: 'center',\n      basedOn: [layout.column],\n      backgroundColor: theme.background[100],\n    },\n    container: {\n      alignItems: 'center',\n      height: '100%',\n      basedOn: [layout.column],\n    },\n    textPart: {\n      display: 'block',\n      marginBottom: styleguide.gridbase,\n      flexShrink: 0,\n    },\n    illustration: {\n      paddingBottom: styleguide.gridbase * 8,\n      flexShrink: 1,\n    },\n    arrowIllustration: {\n      position: 'absolute',\n      left: styleguide.gridbase * 3,\n      top: styleguide.gridbase * 8,\n      [MediaQueries.Mobile]: {\n        display: 'none !important',\n      },\n    },\n  }),\n  'empty-state_2a41ab'\n);\n\nexport function EmptyState({ className }: { className?: string }) {\n  const styles = useStyles();\n  const strings = useStrings();\n  const [handPoint, setHandPoint] = useState<{ x: number; y: number }>({\n    x: 0,\n    y: 0,\n  });\n\n  return (\n    <div className={cn(className, styles.root)}>\n      <div className={cn(styles.container)}>\n        <H3 className={cn(styles.textPart)}>{strings.noSelectionTitle}</H3>\n        <Text className={cn(styles.textPart)}>{strings.noSelectionText}</Text>\n        <ArrowIllustration\n          handPoint={handPoint}\n          className={cn(styles.arrowIllustration)}\n        />\n        <Illustration\n          className={cn(styles.illustration)}\n          setHandLocation={setHandPoint}\n        />\n      </div>\n    </div>\n  );\n}\n\nfunction ArrowIllustration({\n  className,\n  handPoint,\n}: {\n  className: string;\n  handPoint: { x: number; y: number };\n}) {\n  return (\n    <svg\n      className={className}\n      width=\"422\"\n      height=\"210\"\n      viewBox=\"0 0 422 210\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M420.41 208.681C396.736 175.564 356.437 158.407 316.936 148.432C277.435 138.457 236.205 133.802 198.699 117.842C126.746 87.5183 89.7718 31.6583 18.8828 12.9053\"\n        stroke=\"#CCC5BC\"\n        strokeWidth=\"2\"\n        strokeMiterlimit=\"10\"\n      />\n      <path\n        d=\"M25.5329 0.935059L0.262939 9.04806L19.8139 26.8701L25.5329 0.935059Z\"\n        fill=\"#CCC5BC\"\n      />\n    </svg>\n  );\n}\n\nfunction Illustration({\n  className,\n  setHandLocation,\n}: {\n  className?: string;\n  setHandLocation: (point: { x: number; y: number }) => void;\n}) {\n  // const handRef = useRef<SVGPathElement>();\n  // useEffect(() => {\n  //   const setSize = () => {\n  //     if (!handRef.current) {\n  //       setHandLocation(null);\n  //     }\n\n  //     const boundingRect = handRef.current.getBoundingClientRect();\n  //     setHandLocation({\n  //       x: boundingRect.x,\n  //       y: boundingRect.y,\n  //     });\n  //   };\n  //   window.addEventListener('resize', setSize);\n  //   setSize();\n  //   return () => {\n  //     window.removeEventListener('resize', setSize);\n  //   };\n  // }, [setHandLocation]);\n  return (\n    <svg\n      className={className}\n      width=\"868\"\n      height=\"646\"\n      viewBox=\"0 0 868 646\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M860.219 276.926C859.578 274.676 858.939 272.434 858.258 270.193C858.049 269.474 857.839 268.755 857.619 268.036C857.179 266.579 856.728 265.114 856.267 263.655C852 249.89 847.187 236.2 842.343 222.566C839.733 215.207 836.995 207.877 834.07 200.602C823.699 174.847 810.898 149.772 792.569 126.651C791.51 125.306 790.43 123.971 789.34 122.655C788.407 121.524 787.474 120.405 786.519 119.283C785.481 118.069 784.443 116.855 783.384 115.66C782.346 114.475 781.298 113.297 780.228 112.13C780.175 112.064 780.123 112.008 780.07 111.953C779.053 110.842 778.036 109.73 777.008 108.638C776.86 108.489 776.724 108.339 776.578 108.19C775.865 107.424 775.141 106.668 774.408 105.911C773.821 105.284 773.223 104.669 772.605 104.052C772.134 103.557 771.64 103.071 771.149 102.577C770.53 101.942 769.901 101.315 769.261 100.691C768.831 100.261 768.39 99.8223 767.939 99.3927C767.279 98.7391 766.607 98.0855 765.936 97.441C764.877 96.4232 763.809 95.4146 762.718 94.3968C761.921 93.6411 761.103 92.8931 760.285 92.1465C759.928 91.8296 759.582 91.5112 759.226 91.1851C758.534 90.5589 757.842 89.9342 757.139 89.3263C753.135 85.7489 749.003 82.266 744.767 78.8669C743.813 78.1005 742.86 77.3357 741.884 76.5876C740.438 75.4388 738.98 74.3083 737.502 73.1976C737.093 72.8807 736.684 72.5714 736.274 72.2637C736.001 72.058 735.729 71.8523 735.456 71.6573C735.172 71.4425 734.89 71.2368 734.606 71.0311C733.338 70.0788 732.058 69.1449 730.769 68.2109C730.602 68.0799 730.423 67.958 730.245 67.8376C730.068 67.7066 729.888 67.5847 729.721 67.4644C729.344 67.1932 728.967 66.9235 728.579 66.6523C725.245 64.2801 721.858 61.9642 718.409 59.6956C685.044 37.7589 646.124 20.5012 604.423 10.3038C604.077 10.2109 603.721 10.1271 603.375 10.0418C573.753 2.88854 542.75 -0.707134 511.356 0.115604C493.312 0.592488 475.633 2.38423 458.332 5.25162C457.976 5.308 457.63 5.36437 457.284 5.42836C408.737 13.5994 363.063 30.2309 319.928 49.9918C319.571 50.1503 319.225 50.3179 318.879 50.4779C301.841 58.303 285.211 66.6233 268.948 75.0945C268.35 75.4023 267.763 75.7207 267.165 76.0285C263.16 78.1203 259.175 80.2214 255.212 82.3315C235.1 93.0241 215.2 103.959 195.1 114.661C191.87 116.379 188.641 118.107 185.401 119.806C185.034 120.002 184.678 120.197 184.31 120.385C184.027 120.543 183.734 120.692 183.439 120.851C183.388 120.878 183.324 120.916 183.262 120.944C180.137 122.588 177.013 124.221 173.867 125.838C170.544 127.556 167.199 129.246 163.843 130.908C153.777 135.895 143.313 140.321 131.652 142.628C120.748 144.785 109.57 145.812 99.2222 149.417C90.2676 152.545 82.1946 157.009 74.9911 162.145C70.9652 165.021 67.1594 168.084 63.5629 171.306C62.3353 172.408 61.141 173.52 59.9665 174.649C58.8648 175.696 57.7859 176.759 56.7267 177.842C49.7857 184.884 43.6415 192.438 38.0526 200.039C17.2297 228.345 4.67865 260.208 1.08222 292.62C-0.658331 308.3 -0.312345 324.11 2.21426 339.733C2.30834 340.405 2.42367 341.078 2.539 341.75C2.61184 342.189 2.69682 342.637 2.78028 343.076C2.97907 344.141 3.17938 345.204 3.39941 346.269C6.48293 361.331 11.829 375.947 18.2055 390.394C25.7018 407.38 34.1527 424.181 39.2393 441.728C41.9131 450.917 43.5899 460.284 43.643 469.706C43.7052 479.371 42.0284 488.962 40.4032 498.515C37.4365 515.884 34.7202 533.786 42.5003 550.671C48.6234 563.966 60.0636 575.411 73.7695 584.595C113.514 622.188 171.34 638.364 227.879 642.866C257.611 645.234 287.548 644.784 317.366 644.844C347.845 644.903 378.323 644.963 408.802 645.022C470.712 645.144 532.621 645.264 594.531 645.386C625.668 645.447 658.254 647.679 689.079 643.233C720.51 638.701 748.291 625.127 769.258 603.814C790.058 582.671 799.969 555.17 798.738 527.402C800.856 513.437 801.204 499.306 802.92 485.31C805.216 466.652 810.512 448.273 818.784 430.642C822.978 421.714 827.937 412.993 833.599 404.551C839.24 396.156 845.584 388.05 851.141 379.617C861.416 364.04 867.1 347.521 867.887 330.031C868.691 312.17 865.125 294.342 860.219 276.926Z\"\n        fill=\"#F5ECDC\"\n      />\n      <path\n        d=\"M474.369 574.574C482.216 586.81 490.994 597.716 496.314 611.814C500.57 623.252 505.225 634.424 511.875 644H608.3C606.438 628.306 604.443 612.612 602.182 606.494C596.729 591.731 588.616 578.298 580.636 564.732C573.321 552.097 567.07 539.196 563.745 524.965C560.287 509.67 545.923 481.208 545.79 480.676C544.992 477.617 544.726 474.159 544.194 470.834C540.337 466.711 537.411 464.317 537.411 464.184C539.273 464.184 475.832 431.599 443.912 432.53C443.513 431.067 441.385 431.067 441.119 432.663H439.124C437.262 432.663 437.262 435.855 439.124 435.855C439.789 435.855 442.05 454.741 442.715 454.741C442.449 456.071 442.183 457.268 441.784 458.465C441.917 463.785 441.784 474.691 440.853 476.819C439.656 479.878 431.543 505.281 429.947 512.596C425.292 534.408 419.573 603.036 419.573 644.266H486.206C483.147 620.725 479.024 597.583 474.369 574.574Z\"\n        fill=\"#C35A39\"\n      />\n      <path\n        d=\"M474.369 574.574C479.024 597.583 483.014 620.725 486.605 644H511.875C505.225 634.424 500.57 623.119 496.314 611.814C491.127 597.583 482.216 586.81 474.369 574.574Z\"\n        fill=\"#5C3D39\"\n      />\n      <path\n        d=\"M545.125 269.073C544.726 256.571 539.938 244.069 537.411 231.833C532.49 207.627 519.855 186.081 500.304 170.786C500.038 170.52 499.772 170.52 499.506 170.52C499.373 170.387 499.107 170.254 498.841 170.254C487.403 170.121 476.098 175.042 467.054 181.825C463.729 184.352 460.803 187.278 458.941 191.002C456.281 196.322 456.281 202.839 455.483 208.558C453.488 221.193 451.493 233.163 453.621 246.064C454.552 251.916 456.148 257.502 457.877 263.221C459.34 268.009 459.872 272.664 463.995 275.59C467.586 278.25 470.379 282.772 474.901 283.969C479.955 285.299 483.413 291.151 488.068 289.954C495.25 288.092 504.028 279.447 511.343 280.644C517.594 281.708 523.712 283.304 530.096 283.171C534.219 283.038 539.805 282.506 542.997 279.58C545.524 277.053 545.125 272.531 545.125 269.073Z\"\n        fill=\"#855140\"\n      />\n      <path\n        d=\"M435.533 295.008C433.804 297.402 431.011 300.86 430.346 303.786C430.745 302.988 431.011 302.19 431.41 301.392C431.011 302.323 430.745 303.387 430.479 304.451C430.213 305.382 429.947 306.446 429.814 307.51V307.643C429.814 308.707 429.681 309.638 429.681 310.702C429.681 311.234 429.814 311.899 429.814 312.697C430.08 312.963 430.213 313.894 429.947 315.091C430.479 317.618 431.011 320.012 431.809 322.539C432.208 323.869 432.607 325.066 433.139 326.396C433.272 326.662 434.602 329.854 434.336 329.322C434.735 329.987 435.001 330.652 435.134 330.785C435.799 331.982 436.331 333.312 436.996 334.509C438.326 336.903 439.789 339.43 441.252 341.691C444.045 346.213 446.971 350.469 450.03 354.725C450.828 355.922 455.749 361.774 451.759 357.119C453.222 358.848 454.552 360.71 456.015 362.439C459.074 366.163 462.133 369.754 465.724 372.946C466.256 373.478 466.921 374.01 467.453 374.542C469.315 375.473 471.044 376.936 472.906 378C474.635 378.931 476.364 379.862 478.093 380.66C478.891 380.793 480.753 381.724 481.152 381.857C484.876 383.187 488.733 383.985 492.59 384.783C493.654 384.916 494.718 384.916 495.915 385.049C498.043 385.182 500.171 385.182 502.299 385.182C504.161 385.182 505.89 384.916 507.752 384.783C508.55 384.65 509.481 384.517 510.412 384.384C514.801 383.453 518.924 381.724 523.18 380.66C523.845 380.261 524.643 379.995 525.308 379.596C527.037 378.665 528.766 377.734 530.362 376.803C532.49 375.473 534.618 374.01 536.746 372.68C537.544 372.015 538.342 371.35 539.007 370.685C542.066 367.892 544.859 364.966 547.519 361.907C549.115 360.045 550.711 358.316 552.307 356.454C552.972 355.656 553.637 354.858 554.302 354.06C554.435 353.794 556.43 351.134 556.164 351.666C556.696 350.868 557.228 350.07 557.76 349.405C560.819 340.76 564.144 332.115 567.469 323.603C563.745 320.943 559.888 318.682 556.031 316.421C540.736 307.776 524.643 300.594 508.284 294.21C500.57 291.151 492.723 288.358 484.876 285.565C476.896 282.772 468.916 279.58 460.537 277.984C452.956 276.388 445.242 276.654 437.661 277.851C439.523 283.437 439.124 290.087 435.533 295.008Z\"\n        fill=\"#E68B60\"\n      />\n      <path\n        d=\"M522.515 304.584C517.195 284.235 515.2 263.487 516.663 242.606C517.461 241.941 517.195 241.143 516.663 240.611C516.264 239.148 513.471 239.281 513.338 241.01C505.092 247.261 493.92 249.788 483.945 252.847C483.28 252.98 483.014 253.512 482.881 253.911C482.349 254.177 481.95 254.842 481.95 255.507C484.344 271.334 485.142 305.648 486.738 306.18H486.871C487.27 306.978 488.467 307.244 489.265 306.845C495.25 308.441 501.368 309.239 507.619 309.239C512.54 309.239 518.126 309.239 521.983 306.047C522.648 305.781 522.781 305.116 522.515 304.584Z\"\n        fill=\"#E68B60\"\n      />\n      <path\n        opacity=\"0.5\"\n        d=\"M503.363 273.462C511.21 268.009 513.338 258.566 516.264 250.054C516.397 247.527 516.53 245.133 516.663 242.606C517.461 241.941 517.195 241.143 516.663 240.611C516.264 239.148 513.471 239.281 513.338 241.01C505.092 247.261 493.92 249.788 483.945 252.847C483.28 252.98 483.014 253.512 482.881 253.911C482.349 254.177 481.95 254.842 481.95 255.507C482.881 261.625 483.546 270.403 484.078 279.048C490.994 279.048 497.644 277.452 503.363 273.462Z\"\n        fill=\"#AF471E\"\n      />\n      <path\n        d=\"M338.31 150.437C337.778 149.639 336.448 149.639 336.182 150.703C335.118 155.624 337.379 155.092 336.847 160.013C336.182 165.599 332.325 176.239 330.33 181.293C326.34 191.8 322.483 202.44 319.025 213.08C315.7 223.454 311.045 234.493 308.385 245.133C306.39 253.645 307.055 264.285 313.173 271.201C321.818 280.644 333.256 268.807 335.251 262.157C342.034 239.946 343.497 208.824 349.083 186.347C350.679 179.83 352.807 167.86 353.339 161.077C354.137 152.565 348.285 146.181 338.31 150.437Z\"\n        fill=\"#E68B60\"\n      />\n      <path\n        d=\"M546.056 480.543C545.258 477.484 544.992 474.026 544.46 470.701C540.603 466.578 537.544 464.051 537.677 464.051C539.539 464.051 476.098 431.599 444.178 432.397C443.779 430.934 441.651 430.934 441.385 432.53H439.39C437.528 432.53 437.528 435.722 439.39 435.722C440.055 435.722 442.449 454.608 442.981 454.608C442.715 455.938 442.449 457.135 442.183 458.332C442.316 462.056 442.183 468.44 441.917 472.696C445.641 472.962 449.365 472.962 453.222 472.829C445.508 515.522 441.385 558.747 440.853 602.105C440.853 602.77 441.917 602.77 441.917 602.105C442.449 558.747 446.572 515.389 454.286 472.696C458.01 472.563 461.734 472.297 465.458 472.297C475.832 472.164 489.93 469.238 529.83 481.474C534.884 483.07 540.204 482.804 545.391 483.868C546.189 484.001 547.12 484.267 547.918 484.533C546.721 482.139 546.056 480.676 546.056 480.543Z\"\n        fill=\"#5C3D39\"\n      />\n      <path\n        d=\"M523.712 190.337C518.658 167.86 487.935 166.397 473.438 180.229C466.123 187.278 462.266 197.253 461.069 207.228C459.606 218.267 460.271 229.838 463.463 240.478C465.857 248.591 469.448 257.236 475.433 263.354C485.142 273.063 504.959 265.881 513.205 259.497C522.249 252.448 525.84 238.483 528.101 227.178C530.495 214.942 526.372 202.573 523.712 190.337Z\"\n        fill=\"#E68B60\"\n      />\n      <path\n        d=\"M746.62 563.535C739.704 561.274 732.389 555.289 724.808 555.555C723.212 555.555 722.547 557.018 722.68 558.215C722.148 558.348 721.749 558.614 721.217 558.88C715.232 561.673 709.513 564.998 703.661 567.924C702.065 568.722 702.331 570.451 703.395 571.382C703.794 572.18 704.592 572.712 705.789 572.313C709.646 571.116 713.37 569.919 717.094 568.456C720.951 566.86 724.409 564.865 728.931 565.796C735.182 567.126 740.236 568.722 746.62 567.791C748.881 567.259 748.482 564.067 746.62 563.535Z\"\n        fill=\"#E68B60\"\n      />\n      <path\n        d=\"M353.339 117.586C351.211 112.665 348.817 109.074 347.088 103.887C347.088 103.222 346.556 102.424 345.758 102.69C342.965 103.488 342.566 106.547 342.965 109.739C340.97 106.281 338.576 102.956 336.049 99.8969C333.921 97.3699 328.468 89.6559 325.808 91.5179C325.276 91.9169 325.01 92.3159 324.744 92.8479C323.68 91.7839 322.483 90.0549 321.02 91.3849C319.291 92.9809 320.355 97.1039 321.153 99.0989C322.35 101.759 324.212 104.153 326.074 106.281C327.404 107.877 328.734 109.473 330.064 111.069C329.133 113.463 326.074 113.463 324.611 115.458C323.547 116.921 323.547 118.517 324.079 120.379C321.685 123.039 318.493 125.832 320.621 130.221C321.951 132.881 324.212 134.743 326.473 136.472C328.734 143.521 328.468 151.235 331.527 158.151C332.059 159.481 332.99 160.811 334.187 161.476C335.384 162.008 348.817 169.855 353.073 159.082V158.949C353.073 158.816 353.073 158.683 353.073 158.55C353.871 153.895 355.467 147.644 355.999 142.989C356.531 138.467 357.462 133.546 357.196 129.024C357.196 124.768 354.802 121.31 353.339 117.586Z\"\n        fill=\"#E68B60\"\n      />\n      <path\n        d=\"M746.487 556.22L734.517 554.624C734.384 554.624 734.251 554.491 734.118 554.491C727.202 551.831 720.286 553.56 713.503 555.954C710.045 557.151 706.72 558.747 703.129 559.279C696.479 560.21 693.021 555.954 690.228 550.501C689.563 549.171 688.1 549.171 687.169 549.836C683.312 550.634 679.588 551.033 675.598 551.166C673.736 551.299 673.071 553.161 673.736 554.491C673.736 554.89 673.869 555.289 674.135 555.821C677.46 560.476 680.918 565.131 684.243 569.786C685.706 571.781 687.036 573.643 688.632 575.372C694.351 581.623 704.725 585.746 712.705 587.874C714.966 588.406 716.163 585.879 714.833 584.283C712.838 581.756 707.119 579.096 705.523 576.303C702.464 571.249 707.385 568.589 711.242 566.594C713.37 565.53 718.424 564.599 720.419 563.402C723.212 562.604 726.138 562.205 729.064 562.205C735.581 562.072 741.566 563.136 747.817 560.343C749.812 559.279 748.349 556.486 746.487 556.22Z\"\n        fill=\"#E68B60\"\n      />\n      <path\n        d=\"M589.946 337.169C587.153 331.716 582.631 327.726 577.577 324.401C564.543 315.623 550.445 308.175 536.48 300.993C535.549 300.594 534.751 300.993 534.352 301.658C533.953 301.658 533.554 301.791 533.155 302.19C511.21 324.002 494.053 349.937 482.615 378.399C482.349 379.197 481.285 379.064 481.019 378.399C477.162 365.232 473.438 352.198 470.246 338.898C467.719 328.258 466.256 318.948 468.118 308.175C469.847 298.333 471.975 288.624 474.369 278.915C474.768 277.319 455.483 275.324 448.7 275.058C441.385 274.792 423.297 276.654 416.115 277.851C400.554 280.511 399.091 281.309 383.397 282.905C383.264 282.905 383.131 282.905 382.998 282.905C378.077 282.772 374.486 282.373 371.161 281.974C366.772 281.575 362.915 281.176 357.462 281.442C355.733 281.575 354.403 280.112 354.536 278.383C354.536 278.25 354.536 277.984 354.536 277.851C355.334 267.344 349.615 256.305 348.551 245.133C348.019 239.414 347.354 233.695 348.418 227.976C349.216 223.587 351.078 219.464 352.408 215.208C354.536 208.292 354.802 201.642 351.61 195.258C351.211 194.593 351.477 191.667 351.61 191.268C353.339 184.884 354.669 178.5 355.733 171.983C355.999 170.52 353.605 168.791 352.142 169.057C347.487 170.121 342.832 171.318 338.177 172.382C334.32 173.313 330.33 175.175 326.606 176.372C324.345 177.037 324.611 188.874 321.818 194.061C301.336 232.631 288.967 290.619 292.691 309.638C296.681 329.854 324.478 348.208 342.034 352.73C363.314 358.183 381.535 350.203 403.347 352.73C418.642 354.592 418.509 361.375 419.44 374.542C420.77 393.694 426.356 432.131 433.006 450.352C434.735 455.14 436.597 461.391 441.784 463.652C446.971 465.913 465.325 453.145 499.24 468.307C508.417 472.43 529.83 471.898 538.076 472.031C538.475 472.031 538.874 471.898 539.007 471.765C547.12 471.765 552.573 460.327 555.765 454.342C561.351 443.702 566.272 432.663 570.794 421.624C575.715 409.92 578.375 397.152 583.828 385.714C588.217 376.67 593.005 369.621 594.468 358.715C594.867 351.533 593.138 343.553 589.946 337.169Z\"\n        fill=\"#FFFBF5\"\n      />\n      <path\n        d=\"M565.075 369.754C558.159 371.616 555.1 380.394 554.967 386.778C554.967 392.231 556.43 397.684 556.829 403.137C557.361 409.654 556.297 416.038 555.765 422.555C555.233 428.274 555.632 433.86 556.297 439.579C556.696 442.904 557.095 446.096 557.627 449.421C562.149 440.377 566.272 430.934 570.262 421.624C575.183 409.92 577.843 397.152 583.296 385.714C583.429 385.448 583.562 385.182 583.695 384.916C580.104 377.468 573.188 367.493 565.075 369.754Z\"\n        fill=\"#5C3D39\"\n      />\n      <path\n        d=\"M473.305 268.807C469.847 262.689 462.931 258.034 461.069 250.985C460.138 247.394 460.67 243.404 461.069 239.68C461.601 234.626 462 229.705 461.867 224.784C461.734 215.74 462.665 206.563 459.207 197.918C458.01 198.051 454.685 198.849 453.488 199.647C453.754 199.248 454.02 198.982 454.286 198.583C455.084 197.519 453.621 196.056 452.823 197.12C451.227 199.248 449.897 201.376 448.966 203.77C448.966 203.903 448.833 203.903 448.833 204.036C447.37 207.627 446.705 211.617 446.439 215.607C445.774 225.316 448.168 235.158 443.912 244.468C440.72 251.384 437.927 257.236 439.124 265.083C439.922 270.004 441.385 274.925 444.045 279.181C447.503 284.9 451.759 285.831 458.276 286.23C461.867 286.363 468.251 289.289 473.571 290.087C475.566 290.353 477.428 288.757 477.561 286.762C477.96 280.511 476.497 274.526 473.305 268.807Z\"\n        fill=\"#B76751\"\n      />\n      <path\n        d=\"M671.874 560.742C680.652 559.811 689.43 557.683 697.809 554.89C695.016 549.969 693.42 547.708 693.42 546.378C693.021 542.255 696.479 540.127 693.686 530.817C681.184 490.651 650.195 467.775 639.156 441.308C628.649 416.038 623.462 393.295 611.625 368.557C602.98 350.336 592.473 332.78 574.252 322.007C572.789 321.209 558.292 327.194 556.164 333.578C554.568 338.366 554.568 343.553 554.435 348.607C554.302 355.124 554.169 361.508 553.903 368.025C553.637 380.926 553.238 393.694 554.568 406.595C555.499 415.506 557.095 424.949 564.41 431.067C568.533 434.392 588.35 456.337 600.586 482.671C609.763 502.355 629.846 524.832 645.673 538.664C655.116 546.91 652.722 555.422 668.682 557.151C670.145 557.417 670.677 559.811 671.874 560.742Z\"\n        fill=\"#FFFBF5\"\n      />\n      <path\n        d=\"M570.927 610.883C566.272 592.662 561.085 574.441 553.371 557.151C549.381 548.24 544.46 540.127 539.805 531.615C535.416 523.502 533.022 514.857 530.894 505.946C528.633 496.769 526.239 487.459 521.052 479.479C520.653 478.947 519.722 479.479 520.121 480.011C529.431 494.375 529.431 512.33 536.613 527.758C540.736 536.536 546.189 544.516 550.312 553.294C554.435 562.072 557.893 571.116 560.952 580.293C564.277 590.534 567.203 600.908 569.863 611.282C570.129 611.814 571.06 611.548 570.927 610.883Z\"\n        fill=\"#5C3D39\"\n      />\n      <path\n        d=\"M471.576 306.579C471.044 306.047 470.246 306.845 470.778 307.377C475.965 312.298 485.275 314.426 486.738 322.406C486.871 323.071 487.935 322.805 487.802 322.14C486.206 313.894 476.896 311.766 471.576 306.579Z\"\n        fill=\"#AF471E\"\n      />\n      <path\n        d=\"M507.087 325.465C504.028 324.667 500.969 324.268 497.777 324.268C497.112 324.268 497.112 325.332 497.777 325.332C500.836 325.332 503.895 325.731 506.821 326.396C507.486 326.662 507.752 325.598 507.087 325.465Z\"\n        fill=\"#AF471E\"\n      />\n      <path\n        d=\"M347.088 192.997C340.172 194.327 333.123 195.258 326.074 196.056C325.409 196.189 325.409 197.253 326.074 197.12C333.256 196.322 340.305 195.258 347.354 194.061C348.152 193.928 347.886 192.864 347.088 192.997Z\"\n        fill=\"#5C3D39\"\n      />\n      <path\n        d=\"M690.76 545.58C683.977 546.511 677.327 548.107 670.81 550.235C670.145 550.501 670.411 551.565 671.076 551.299C677.593 549.171 684.243 547.575 691.026 546.644C691.824 546.511 691.558 545.447 690.76 545.58Z\"\n        fill=\"#5C3D39\"\n      />\n      <path\n        d=\"M348.551 124.768C347.088 121.443 345.226 118.251 344.827 114.527C344.694 113.862 343.63 113.862 343.763 114.527C344.029 117.054 344.827 119.315 345.891 121.576C347.354 124.768 350.546 129.29 348.684 132.748C347.487 134.876 345.093 136.073 343.63 137.935C342.167 139.797 341.768 142.058 341.901 144.319C342.034 144.984 343.098 144.984 342.965 144.319C342.566 140.728 344.428 138.467 346.822 136.206C348.285 134.876 349.748 133.546 350.147 131.551C350.679 129.29 349.482 126.763 348.551 124.768Z\"\n        fill=\"#AF471E\"\n      />\n      <path\n        d=\"M341.369 120.512C341.103 119.714 340.837 119.049 340.571 118.384C340.571 117.719 340.438 117.054 339.906 116.655C339.906 116.655 339.773 116.655 339.773 116.522C336.049 109.074 329.798 103.089 326.606 95.2416C326.34 94.5766 325.276 94.8427 325.542 95.5077C328.734 103.089 334.586 108.941 338.443 116.123C337.113 116.256 336.049 117.719 335.384 119.049C334.985 118.517 334.586 117.985 334.187 117.453C333.788 116.921 332.857 117.453 333.256 117.985C333.788 118.783 334.32 119.448 334.852 120.246C334.852 120.379 334.985 120.512 335.118 120.645C335.517 121.31 335.916 121.842 336.448 122.507C336.847 123.039 337.778 122.507 337.379 121.975C336.98 121.31 336.448 120.778 336.049 120.113C336.581 118.916 338.177 116.123 339.507 118.517C339.773 119.049 339.374 120.778 339.241 121.443C339.108 123.571 338.842 125.699 338.576 127.827C338.576 127.96 338.576 128.093 338.709 128.093C338.31 130.088 337.379 132.349 334.852 131.285C333.788 130.886 332.724 129.29 331.793 128.492L326.34 122.773C325.808 122.241 325.143 123.039 325.542 123.571L331.394 129.689C332.458 130.886 333.788 132.482 335.517 132.881V133.014C335.517 134.477 334.586 135.94 333.655 137.137C332.325 138.866 330.596 138.068 329 137.004C328.468 136.605 327.936 137.536 328.468 137.935C330.064 138.999 332.059 140.063 333.788 138.6C335.251 137.403 336.448 135.009 336.581 133.147V133.014C339.241 132.615 339.906 128.625 340.039 126.497C340.039 126.364 340.039 126.231 339.906 126.098C340.039 124.369 340.305 122.773 340.438 121.044C340.571 121.443 341.635 121.177 341.369 120.512Z\"\n        fill=\"#AF471E\"\n      />\n      <path\n        d=\"M741.965 561.673C736.246 560.875 729.862 559.146 724.143 560.875C718.424 562.737 712.705 564.865 707.518 567.791C706.853 568.19 707.518 569.121 708.05 568.722C712.971 566.062 718.158 564.067 723.478 562.205C729.463 560.077 735.581 561.806 741.699 562.604C742.364 562.737 742.63 561.673 741.965 561.673Z\"\n        fill=\"#AF471E\"\n      />\n      <path\n        d=\"M505.624 210.154C505.89 213.346 504.427 216.139 502.432 216.272C500.437 216.405 498.708 213.878 498.575 210.686C498.309 207.494 499.772 204.701 501.767 204.568C503.629 204.435 505.358 206.962 505.624 210.154Z\"\n        fill=\"#5C3D39\"\n      />\n      <path\n        d=\"M473.704 212.681C473.97 215.873 472.507 218.666 470.512 218.799C468.517 218.932 466.788 216.405 466.655 213.213C466.389 210.021 467.852 207.228 469.847 207.095C471.709 206.962 473.438 209.356 473.704 212.681Z\"\n        fill=\"#5C3D39\"\n      />\n      <path\n        d=\"M483.413 233.296C479.822 230.37 478.625 227.178 479.024 222.656C479.423 218.134 480.088 213.612 480.886 209.09C481.019 208.425 480.088 208.159 479.955 208.824C479.024 213.878 478.093 219.198 477.96 224.385C477.827 228.508 479.689 231.434 482.881 233.961C483.28 234.493 483.945 233.695 483.413 233.296Z\"\n        fill=\"#AF471E\"\n      />\n      <path\n        d=\"M490.728 230.104C488.999 229.306 487.137 228.641 485.408 228.109C484.743 227.976 484.477 228.907 485.142 229.04C486.871 229.572 488.6 230.237 490.329 230.902C490.861 231.168 491.393 230.237 490.728 230.104Z\"\n        fill=\"#AF471E\"\n      />\n      <path\n        d=\"M512.673 197.785C508.683 195.125 503.23 193.263 498.043 193.928C496.713 194.061 495.117 194.726 494.186 195.657C493.654 196.189 493.255 196.854 493.255 197.519C493.255 199.514 496.181 200.445 498.176 200.445C500.969 200.312 503.895 200.312 506.688 200.179C508.683 200.179 510.678 200.312 512.54 199.514C513.338 198.982 513.205 198.184 512.673 197.785Z\"\n        fill=\"#C27155\"\n      />\n      <path\n        d=\"M478.359 198.184C478.093 197.652 477.561 197.253 476.763 196.987C475.034 196.322 473.039 196.588 471.31 196.987C469.847 197.386 458.542 201.908 461.734 202.972C462 203.105 462.399 203.105 462.798 203.105C467.719 202.972 473.97 203.504 477.561 200.844C478.625 200.046 478.891 199.115 478.359 198.184Z\"\n        fill=\"#C27155\"\n      />\n      <path\n        d=\"M495.117 241.808C494.718 241.808 483.147 241.276 480.753 241.941C478.625 242.473 477.561 245.266 480.088 245.931H480.221C482.482 246.862 484.61 246.33 487.004 246.463C494.984 246.596 496.181 241.675 495.117 241.808Z\"\n        fill=\"#FFFBF5\"\n      />\n      <path\n        d=\"M483.679 246.995C482.482 246.995 481.418 246.862 480.221 246.463C480.221 246.463 480.088 246.463 479.955 246.463C478.758 246.064 478.093 245.266 478.226 244.202C478.226 242.872 479.29 241.675 480.753 241.409C482.748 240.877 490.595 241.143 493.92 241.276C494.585 241.276 495.117 241.276 495.25 241.276C495.516 241.276 495.782 241.409 495.915 241.675C496.181 242.074 496.048 242.739 495.649 243.537C495.117 244.335 493.122 247.128 487.137 246.995C486.472 246.995 485.807 246.995 485.142 246.995C484.61 246.995 484.211 246.995 483.679 246.995ZM480.354 245.399C481.95 246.064 483.413 245.931 485.009 245.931C485.674 245.931 486.339 245.931 487.004 245.931C491.925 246.064 493.787 244.202 494.452 243.404C494.851 242.872 494.984 242.606 494.984 242.34C494.718 242.34 494.319 242.34 493.787 242.34C490.728 242.207 482.748 241.941 480.886 242.473C479.822 242.739 479.157 243.67 479.157 244.335C479.157 244.867 479.822 245.266 480.354 245.399Z\"\n        fill=\"#AF471E\"\n      />\n      <path\n        d=\"M580.104 258.034C579.572 256.704 578.907 255.507 577.976 254.443C576.779 252.98 575.316 251.384 573.853 249.522C562.016 235.69 552.706 221.725 551.509 202.839C550.578 188.076 546.987 174.909 533.421 167.594C522.249 161.476 509.082 158.284 496.314 159.215C484.344 160.146 469.581 165.067 462 175.042C459.872 177.835 458.542 180.894 455.882 183.421C453.089 185.948 449.631 187.677 447.104 190.47C443.912 193.795 442.05 198.317 444.045 202.706C444.045 202.839 444.178 202.839 444.178 202.972C445.907 206.563 454.552 208.957 458.143 207.893C459.473 207.494 460.537 206.563 461.601 205.632C468.65 199.647 477.827 197.785 486.605 195.79C491.659 194.593 493.787 190.204 498.575 188.475C502.033 187.278 505.757 187.544 507.619 191.002C510.811 196.721 512.407 203.371 512.673 210.021C513.072 219.464 510.412 228.774 511.609 238.217C512.54 245.532 516.264 250.586 521.318 255.374C525.973 260.694 530.096 266.413 529.963 273.861C529.83 278.25 527.436 286.23 531.16 289.821C542.997 301.392 556.696 280.378 565.607 277.053C572.39 274.26 583.429 267.61 580.104 258.034Z\"\n        fill=\"#B76751\"\n      />\n      <path\n        d=\"M559.09 263.62C556.962 254.975 552.839 247.261 546.987 240.478C543.795 236.887 540.337 233.296 538.608 228.774C537.012 224.252 537.145 219.331 536.879 214.543C536.081 198.982 532.49 182.49 521.185 171.052C520.653 170.52 519.988 171.318 520.387 171.85C532.49 184.086 535.283 201.642 535.948 218.134C536.081 222.257 536.347 226.38 537.943 230.237C539.406 233.695 541.933 236.621 544.46 239.547C550.844 246.862 555.632 254.709 558.026 264.152C558.292 264.551 559.356 264.285 559.09 263.62Z\"\n        fill=\"#5C3D39\"\n      />\n      <path\n        d=\"M455.749 205.499C453.887 206.962 451.626 207.095 449.631 205.898C449.099 205.499 448.567 206.43 449.099 206.829C451.36 208.159 454.153 208.159 456.281 206.43C456.813 205.898 456.281 204.967 455.749 205.499Z\"\n        fill=\"#5C3D39\"\n      />\n      <path\n        d=\"M482.216 457.933C473.305 443.436 465.724 428.274 459.34 412.447C459.074 411.782 458.01 412.048 458.276 412.713C464.66 428.54 472.374 443.835 481.285 458.465C481.684 459.13 482.615 458.598 482.216 457.933Z\"\n        fill=\"#5C3D39\"\n      />\n      <path\n        d=\"M469.315 449.022C464.261 443.037 459.473 436.786 455.217 430.136C454.818 429.604 453.887 430.136 454.286 430.668C458.675 437.318 463.463 443.702 468.65 449.687C469.049 450.352 469.847 449.554 469.315 449.022Z\"\n        fill=\"#5C3D39\"\n      />\n      <path\n        d=\"M361.452 371.217L399.49 219.73C363.447 208.558 337.512 184.884 317.296 161.077C275.534 112 222.201 113.995 222.201 113.995L184.163 265.482C184.163 265.482 244.545 280.112 268.884 313.761C277.928 326.13 328.468 370.286 361.452 371.217Z\"\n        fill=\"#88C3EF\"\n      />\n      <path\n        d=\"M143.731 163.072L159.292 52.5488C246.673 52.5488 299.607 114.394 299.607 114.394L284.046 224.917C284.046 224.917 209.965 165.599 143.731 163.072Z\"\n        fill=\"#DFEDF3\"\n      />\n      <path\n        d=\"M762.314 467.908C762.314 467.908 703.927 476.553 625.457 453.544L638.89 378.532C638.89 378.532 731.724 397.95 779.737 390.236L762.314 467.908Z\"\n        fill=\"#BFB6AC\"\n      />\n      <path\n        d=\"M695.548 421.491C695.548 421.491 618.541 422.688 527.436 392.098L510.811 498.232C510.811 498.232 593.537 519.911 673.204 526.561L695.548 421.491Z\"\n        fill=\"#93AD8B\"\n      />\n      <path\n        d=\"M717.759 404.999C717.759 404.999 640.752 406.196 549.647 375.606L533.022 481.74C533.022 481.74 615.748 503.419 695.415 510.069L717.759 404.999Z\"\n        fill=\"#C8D6C4\"\n      />\n    </svg>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { Route } from 'https://esm.sh/react-router-dom@6.7.0';\nimport { makeStyles, cn } from '../../../../../styles/css-objects/index.ts';\nimport Toolbar, { useStyles as toolbarStyles } from './toolbar/index.tsx';\nimport { layout } from '../../../../../styles/index.ts';\nimport DueDateEditor from '../../../shared/components/due-date-editor/index.tsx';\nimport NoteView from './note-editor/index.tsx';\nimport { CardsDisplay } from './cards-display/index.tsx';\nimport { EmptyState } from './empty-state/index.tsx';\nimport { useSharedQuery } from '../../../core/cfds/react/query.ts';\n\nconst useStyles = makeStyles((theme) => ({\n  blurred: {\n    filter: 'blur(2px)',\n  },\n  main: {\n    width: '100%',\n    height: '100%',\n    flexShrink: 0,\n    flexGrow: 0,\n    basedOn: [layout.column],\n  },\n  content: {\n    position: 'relative',\n    width: '100%',\n    height: `calc(100% - ${toolbarStyles.toolbar.rules.height}px)`,\n    flexShrink: 1,\n    basedOn: [layout.column, layout.flex],\n  },\n  router: {\n    flexShrink: 0,\n    flexGrow: 0,\n    overflowY: 'auto',\n    width: '100%',\n    height: '100%',\n    basedOn: [layout.row],\n  },\n}));\n\ninterface ContentProps {\n  className?: string;\n}\n\nexport default function WorkspaceContentView({ className }: ContentProps) {\n  const styles = useStyles();\n  const selectedWorkspacesQuery = useSharedQuery('selectedWorkspaces');\n\n  return (\n    <div className={cn(styles.main, className)}>\n      <Toolbar />\n      <DueDateEditor>\n        <div className={cn(styles.content)}>\n          <div className={cn(styles.router)}>\n            <Route path={`/:workspaceId/notes/:noteId`}>\n              <NoteView />\n            </Route>\n            <Route path=\"/\">\n              selectedWorkspacesQuery.length ? (\n              <CardsDisplay />\n              ) : (\n              <EmptyState />)\n            </Route>\n          </div>\n        </div>\n      </DueDateEditor>\n    </div>\n  );\n}\n", "import React, { useMemo } from 'https://esm.sh/react@18.2.0';\nimport { useGraphManager } from '../../core/cfds/react/graph.tsx';\nimport WorkspaceContentView from './workspace-view/index.tsx';\n\ninterface WorkspaceSelectorProps {\n  className?: string;\n}\nexport default function WorkspaceSelectorView({\n  className,\n}: WorkspaceSelectorProps) {\n  const graph = useGraphManager();\n\n  return <WorkspaceContentView className={className} />;\n}\n", "import React, {\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport { styleguide } from '../styleguide.ts';\nimport { layout } from '../layout.ts';\nimport Layer from './layer.tsx';\nimport { makeStyles, cn, keyframes } from '../css-objects/index.ts';\nimport { createUniversalPortal } from '../utils/ssr.ts';\n\nconst hideAnim = keyframes(\n  {\n    from: {\n      opacity: 1,\n      transform: 'translateY(0)',\n    },\n    to: {\n      opacity: 0,\n      transform: 'translateY(-50%)',\n    },\n  },\n  'backdrop_dd7122'\n);\n\nconst backdropShow = keyframes(\n  {\n    from: {\n      opacity: 0,\n    },\n    to: {\n      opacity: 1,\n    },\n  },\n  'backdrop_e31823'\n);\n\nconst backdropHide = keyframes(\n  {\n    from: {\n      opacity: 1,\n    },\n    to: {\n      opacity: 0,\n    },\n  },\n  'backdrop_fa2a0d'\n);\n\nconst useStyles = makeStyles(\n  (theme) => ({\n    backdrop: {\n      backgroundColor: 'rgba(8, 25, 43, 0.2)',\n      position: 'absolute',\n      top: 0,\n      left: 0,\n      right: 0,\n      bottom: 0,\n      basedOn: [layout.column, layout.centerCenter],\n      animation: `${backdropShow} 0.15s linear backwards`,\n    },\n    highContrast: {\n      backgroundColor: 'rgba(255, 255, 255, 0.9)',\n    },\n    backdropHide: {\n      animation: `${backdropHide} 0.15s linear both`,\n    },\n    hide: {\n      animation: `${hideAnim} 0.15s ${styleguide.transition.timing.standard} both`,\n    },\n  }),\n  'backdrop_2fa637'\n);\n\nexport { useStyles as useBackdropStyles };\n\nexport interface BackdropProps {\n  open: boolean;\n  onClickOutside?: any;\n  className?: string;\n  onClose?: (e: any) => void;\n  onOpen?: () => void;\n  rootId?: string;\n  highContrast?: boolean;\n}\nexport const Backdrop: React.FC<BackdropProps> = ({\n  open,\n  children,\n  onClickOutside,\n  onOpen,\n  className,\n  rootId,\n  highContrast,\n}) => {\n  const styles = useStyles();\n  // const domState = useScopedObservable(DomState);\n  const timeout = useRef<number>();\n  const [visible, setVisible] = useState(open);\n  const [css, setCss] = useState(null);\n  const onOpenRef = useRef(onOpen);\n  useEffect(() => {\n    onOpenRef.current = onOpen;\n  }, [onOpen]);\n  const mounted = useRef(true);\n  useEffect(() => {\n    mounted.current = true;\n    return () => {\n      mounted.current = false;\n    };\n  }, []);\n\n  useEffect(() => {\n    if (timeout.current) {\n      clearTimeout(timeout.current);\n      timeout.current = null;\n    }\n    if (!open) {\n      timeout.current = setTimeout(() => {\n        if (!mounted.current) {\n          return;\n        }\n        setVisible(false);\n      }, 200);\n      setCss(styles.hide);\n    } else {\n      setCss('');\n      setVisible(true);\n      onOpenRef.current?.();\n    }\n  }, [open, styles]);\n\n  const ignoreClick = useCallback((e) => {\n    e.stopPropagation();\n    e.preventDefault();\n  }, []);\n\n  const backgroundClick = useCallback(\n    (e) => {\n      ignoreClick(e);\n      onClickOutside && onClickOutside();\n    },\n    [ignoreClick, onClickOutside]\n  );\n  if (!visible) {\n    return null;\n  }\n  const root = rootId && document.getElementById(rootId);\n\n  return createUniversalPortal(\n    <Layer priority={3}>\n      {({ zIndex }) => (\n        <div\n          className={cn(\n            styles.backdrop,\n            css && styles.backdropHide,\n            highContrast && styles.highContrast,\n            className\n          )}\n          style={{ zIndex }}\n          onClick={backgroundClick}\n        >\n          {children}\n        </div>\n      )}\n    </Layer>,\n    root\n  );\n};\n", "{\n  \"en\": {\n    \"myWorkspaces\": \"My Workspaces\",\n    \"selectAll\": \"Select All\",\n    \"unselectAll\": \"Unselect All\",\n    \"add\": \"New Workspace\",\n    \"addShort\": \"Add\",\n    \"invite\": \"Invite to Workspace\",\n    \"inviteShort\": \"Invite\",\n    \"workspaceSettings\": \"Settings\",\n    \"hideWorkspace\": \"Hide for me\",\n    \"showWorkspace\": \"Show for me\",\n    \"hiddenWorkspaces\": \"Hidden Workspaces\",\n    \"hiddenWorkspacesShort\": \"Hidden\",\n    \"inDemo\": \"This is not available while in demo\"\n  }\n}\n", "import React, { useCallback, useState } from 'https://esm.sh/react@18.2.0';\nimport { useNavigate } from 'https://esm.sh/react-router@6.7.0';\nimport { layout, styleguide } from '../../../../styles/index.ts';\nimport { useTypographyStyles } from '../../../../styles/components/typography.tsx';\nimport { cn, makeStyles } from '../../../../styles/css-objects/index.ts';\nimport { brandLightTheme as theme } from '../../../../styles/theme.tsx';\nimport { createUseStrings } from '../../core/localization/index.tsx';\n// import InvitationDialog from '../../shared/invitation-dialog/index.tsx';\nimport { useLogger } from '../../core/cfds/react/logger.tsx';\nimport localization from './workspace-bar.strings.json' assert { type: 'json' };\n\nconst useStyles = makeStyles(\n  () => ({\n    root: {\n      width: '100%',\n      flexShrink: 0,\n    },\n    action: {\n      cursor: 'pointer',\n      userSelect: 'none',\n      height: styleguide.gridbase * 5,\n      boxSizing: 'border-box',\n      width: '100%',\n      backgroundColor: theme.colors.secondaryButton,\n      color: theme.colors.barActionText,\n      padding: styleguide.gridbase * 2,\n      alignItems: 'center',\n      marginBottom: styleguide.gridbase,\n      ':last-child': {\n        marginBottom: 0,\n      },\n      ':hover': {\n        backgroundColor: theme.colors.secondaryButtonActive,\n        color: theme.colors.text,\n      },\n      basedOn: [layout.row],\n    },\n    disabled: {\n      cursor: 'not-allowed',\n    },\n    actionIcon: {\n      marginRight: styleguide.gridbase,\n      basedOn: [layout.column, layout.centerCenter],\n    },\n    actionText: {\n      whiteSpace: 'nowrap',\n      color: 'currentColor',\n      basedOn: [useTypographyStyles.button, layout.column, layout.centerCenter],\n    },\n  }),\n  'actions_2eb8a6'\n);\n\nconst useStrings = createUseStrings(localization);\n\nexport interface WorkspaceBarActionsProps {\n  expanded: boolean;\n  className?: string;\n}\n\nexport function WorkspaceBarActions({\n  expanded,\n  className,\n}: WorkspaceBarActionsProps) {\n  const styles = useStyles();\n  const strings = useStrings();\n  const logger = useLogger();\n  const navigate = useNavigate();\n  const [isShareOpen, setIsShareOpen] = useState(false);\n\n  const createNew = useCallback(() => {\n    logger.log({\n      severity: 'INFO',\n      event: 'Start',\n      flow: 'create',\n      type: 'workspace',\n      source: 'bar:workspace',\n    });\n    navigate('/new');\n  }, [history, logger]);\n\n  return (\n    <div className={cn(styles.root, className)}>\n      <div className={cn(styles.action)} onClick={createNew}>\n        <div className={cn(styles.actionIcon)}>\n          <IconPlus />\n        </div>\n        <div className={cn(styles.actionText)}>\n          {expanded ? strings.add : strings.addShort}\n        </div>\n      </div>\n      <div className={cn(styles.action)} onClick={() => setIsShareOpen(true)}>\n        <div className={cn(styles.actionIcon)}>\n          <IconInvite />\n        </div>\n        <div className={cn(styles.actionText)}>\n          {expanded ? strings.invite : strings.inviteShort}\n        </div>\n      </div>\n      {/* <InvitationDialog\n        open={isShareOpen}\n        hide={() => setIsShareOpen(false)}\n        source=\"workspace-bar\"\n      /> */}\n    </div>\n  );\n}\n\nfunction IconPlus() {\n  return (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        opacity=\"0.6\"\n        d=\"M8 13L8 3\"\n        stroke=\"#945A52\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M3 8L13 8\"\n        stroke=\"#6C2C23\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n    </svg>\n  );\n}\n\nfunction IconInvite() {\n  return (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        opacity=\"0.7\"\n        d=\"M11 5C11 6.65685 9.65685 8 8 8C6.34315 8 5 6.65685 5 5\"\n        stroke=\"#6C2C23\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M11 5C11 3.34315 9.65685 2 8 2C6.34315 2 5 3.34315 5 5\"\n        stroke=\"#6C2C23\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        d=\"M2 15V14C2 10.6863 4.68629 8 8 8V8\"\n        stroke=\"#6C2C23\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.7\"\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M9.12602 14H2C1.44772 14 1 14.4477 1 15C1 15.5523 1.44772 16 2 16H10.3542C9.76377 15.4789 9.32838 14.7862 9.12602 14Z\"\n        fill=\"#6C2C23\"\n      />\n      <path\n        opacity=\"0.7\"\n        fill-rule=\"evenodd\"\n        clip-rule=\"evenodd\"\n        d=\"M12.9002 9.00122C11.6376 7.76331 9.90793 7 8 7V9C8.97444 9 9.88377 9.27875 10.6526 9.76086C11.2868 9.30045 12.0615 9.02175 12.9002 9.00122Z\"\n        fill=\"#6C2C23\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M13 15L13 11\"\n        stroke=\"#945A52\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M11 13L15 13\"\n        stroke=\"#6C2C23\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n    </svg>\n  );\n}\n", "import { MouseEvent } from 'https://esm.sh/react@18.2.0';\n\nexport type ToggleAction = 'single' | 'range' | 'clearOthers' | 'clearAll';\n\nexport type SelectionItem = string;\n\nexport interface SelectionResult {\n  actionType: ToggleAction;\n  toggleType: 'selected' | 'deselected';\n  allSelectedItems: SelectionItem[];\n}\n\nexport function toggleSelectionItem(\n  items: SelectionItem[],\n  toggled: SelectionItem,\n  selectedKeys: SelectionItem[],\n  lastSelectedKey?: string,\n  actionType: ToggleAction = 'single'\n): SelectionResult {\n  const toggledIndex = items.findIndex((x) => x === toggled);\n  if (toggledIndex === -1) {\n    debugger;\n    return {\n      actionType: 'clearAll',\n      toggleType: 'deselected',\n      allSelectedItems: [],\n    };\n  }\n\n  if ((!lastSelectedKey && actionType === 'range') || !actionType) {\n    actionType = 'single';\n  }\n\n  switch (actionType) {\n    case 'range': {\n      const lastSelectedIndex = items.findIndex((x) => x === lastSelectedKey);\n      const slice = items.slice(\n        Math.min(lastSelectedIndex, toggledIndex),\n        Math.max(lastSelectedIndex, toggledIndex) + 1\n      );\n      const selected = selectedKeys.includes(toggled);\n      let allSelectedItems = selectedKeys;\n      if (selected) {\n        allSelectedItems = selectedKeys.filter((x) => !slice.includes(x));\n      } else {\n        allSelectedItems = Array.from(new Set([...selectedKeys, ...slice]));\n      }\n      return {\n        actionType: 'range',\n        toggleType: selected ? 'selected' : 'deselected',\n        allSelectedItems,\n      };\n    }\n    case 'clearOthers': {\n      return {\n        actionType: 'clearOthers',\n        toggleType: 'selected',\n        allSelectedItems: [toggled],\n      };\n    }\n\n    case 'clearAll':\n      return {\n        actionType: 'clearAll',\n        toggleType: 'deselected',\n        allSelectedItems: [],\n      };\n\n    case 'single':\n    default: {\n      const newSelected = selectedKeys.filter((x) => x !== toggled);\n      const toggleType =\n        newSelected.length === selectedKeys.length ? 'selected' : 'deselected';\n      if (toggleType === 'selected') {\n        newSelected.push(toggled);\n      }\n      return {\n        actionType: 'single',\n        toggleType,\n        allSelectedItems: newSelected,\n      };\n    }\n  }\n}\n\nexport function toggleActionFromEvent(e: MouseEvent): ToggleAction {\n  if (e.ctrlKey) {\n    return 'clearOthers';\n  }\n  if (e.shiftKey) {\n    return 'range';\n  }\n  return 'single';\n}\n", "import React, {\n  MouseEvent,\n  MouseEventHandler,\n  useCallback,\n  useMemo,\n  useRef,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport { useLocation, useNavigate } from 'https://esm.sh/react-router@6.7.0';\nimport * as SetUtils from '../../../../base/set.ts';\nimport { VertexManager } from '../../../../cfds/client/graph/vertex-manager.ts';\nimport { Workspace } from '../../../../cfds/client/graph/vertices/workspace.ts';\nimport { layout, styleguide } from '../../../../styles/index.ts';\nimport { useBackdropStyles } from '../../../../styles/components/backdrop.tsx';\nimport { Button } from '../../../../styles/components/buttons.tsx';\nimport { IconOverflow } from '../../../../styles/components/icons/index.ts';\nimport Layer from '../../../../styles/components/layer.tsx';\nimport { LogoIcon, LogoText } from '../../../../styles/components/logo.tsx';\nimport Menu, { MenuItem } from '../../../../styles/components/menu.tsx';\nimport { IconPinOff } from '../../../../styles/components/new-icons/icon-pin-off.tsx';\nimport { IconPinOn } from '../../../../styles/components/new-icons/icon-pin-on.tsx';\nimport Tooltip from '../../../../styles/components/tooltip/index.tsx';\nimport {\n  LabelSm,\n  TextSm,\n  useTypographyStyles,\n} from '../../../../styles/components/typography.tsx';\nimport { cn, makeStyles } from '../../../../styles/css-objects/index.ts';\nimport {\n  Devices,\n  MediaQueries,\n  useCurrentDevice,\n} from '../../../../styles/responsive.ts';\nimport { brandLightTheme as theme } from '../../../../styles/theme.tsx';\nimport { Scroller } from '../../../../styles/utils/scrolling/index.tsx';\nimport { createUniversalPortal } from '../../../../styles/utils/ssr.ts';\nimport { sortWorkspaces } from '../../app/workspace-content/workspace-view/cards-display/card-item/workspace-indicator.tsx';\nimport {\n  useGraphManager,\n  usePartialCurrentUser,\n  usePartialUserSettings,\n  useRootUser,\n  useUserSettings,\n} from '../../core/cfds/react/graph.tsx';\nimport {\n  useExistingQuery,\n  useSharedQuery,\n} from '../../core/cfds/react/query.ts';\nimport {\n  usePartialVertex,\n  usePartialVertices,\n  useVertex,\n  useVertices,\n} from '../../core/cfds/react/vertex.ts';\nimport { createUseStrings } from '../../core/localization/index.tsx';\nimport { useWorkspaceColor } from '../../shared/workspace-icon/index.tsx';\nimport { WorkspaceBarActions } from './actions.tsx';\nimport localization from './workspace-bar.strings.json' assert { type: 'json' };\nimport {\n  toggleActionFromEvent,\n  toggleSelectionItem,\n} from './ws-selection-utils.ts';\nimport { User } from '../../../../cfds/client/graph/vertices/user.ts';\nimport { UserSettings } from '../../../../cfds/client/graph/vertices/user-settings.ts';\nimport { useLogger } from '../../core/cfds/react/logger.tsx';\nimport { Query } from '../../../../cfds/client/graph/query.ts';\n\nconst EXPANDED_WIDTH = styleguide.gridbase * 25;\nconst COLLAPSED_WIDTH = styleguide.gridbase * 14;\n\nconst useStyles = makeStyles(\n  () => ({\n    root: {\n      flexShrink: 0,\n      width: '90vw',\n      maxWidth: EXPANDED_WIDTH,\n      // overflowY: 'hidden',\n      // overflowX: 'visible',\n      height: '100%',\n      ...styleguide.transition.standard,\n      transitionProperty: 'width',\n      [MediaQueries.Mobile]: {\n        position: 'absolute',\n        top: 0,\n        left: 0,\n        transitionProperty: 'transform',\n        transform: 'translateX(0)',\n      },\n      boxShadow: theme.shadows.z4,\n      backgroundColor: theme.colors.background,\n      basedOn: [layout.column],\n    },\n\n    collapsed: {\n      [MediaQueries.Tablet]: {\n        width: COLLAPSED_WIDTH,\n      },\n      [MediaQueries.Mobile]: {\n        transform: 'translateX(-100%)',\n        boxShadow: 'none',\n        openBarButton: {\n          boxShadow: theme.shadows.z4,\n        },\n      },\n    },\n    backdrop: {\n      basedOn: [useBackdropStyles.backdrop],\n    },\n    mobileTabButton: {\n      [MediaQueries.Tablet]: {\n        display: 'none !important',\n      },\n      position: 'absolute',\n      top: styleguide.gridbase,\n      left: 0,\n      width: styleguide.gridbase * 6,\n      height: styleguide.gridbase * 5,\n      backgroundColor: theme.colors.background,\n      ...styleguide.transition.standard,\n      transitionProperty: 'transform',\n    },\n    header: {\n      width: '100%',\n      flexShrink: 0,\n      height: styleguide.gridbase * 17,\n      justifyContent: 'space-between',\n      basedOn: [layout.column],\n    },\n    logoContainer: {\n      boxSizing: 'border-box',\n      width: '100%',\n      marginTop: styleguide.gridbase * 3,\n      padding: [0, styleguide.gridbase * 2],\n      alignItems: 'center',\n      basedOn: [layout.row],\n    },\n    logoIcon: {\n      flexShrink: 0,\n    },\n    logoText: {},\n    openBarButton: {\n      [MediaQueries.Mobile]: {\n        position: 'absolute',\n        left: '100%',\n        transform: 'translateX(-16px)',\n        backgroundColor: theme.colors.background,\n        width: styleguide.gridbase * 6,\n        height: styleguide.gridbase * 5,\n        borderRadius: `0 ${styleguide.gridbase * 2.5}px ${\n          styleguide.gridbase * 2.5\n        }px 0`,\n      },\n    },\n    rotated: {\n      transform: 'rotate(180deg)',\n    },\n    toggleView: {\n      padding: [0, styleguide.gridbase * 2],\n      boxSizing: 'border-box',\n      marginBottom: styleguide.gridbase * 0.5,\n      width: '100%',\n      // alignItems: 'center',\n      // justifyContent: 'space-between',\n      whiteSpace: 'nowrap',\n      basedOn: [layout.column],\n    },\n    toggleActions: {\n      marginTop: styleguide.gridbase,\n      justifyContent: 'space-between',\n      flexWrap: 'wrap',\n      basedOn: [layout.row],\n    },\n    toggleViewButton: {\n      cursor: 'pointer',\n      textDecoration: 'underline',\n      basedOn: [useTypographyStyles.text],\n    },\n    toggleViewButtonDisabled: {\n      cursor: 'not-allowed',\n      color: theme.colors.placeholderText,\n    },\n    list: {\n      overflowY: 'auto',\n      overflowX: 'hidden',\n      flexGrow: 1,\n      flexShrink: 1,\n      flexBasis: '100%',\n    },\n    listItem: {\n      height: styleguide.gridbase * 4,\n      flexShrink: 0,\n      marginBottom: styleguide.gridbase * 0.5,\n      ':hover': {\n        itemMenu: {\n          opacity: 1,\n        },\n        pinButton: {\n          opacity: 1,\n        },\n      },\n      basedOn: [layout.row],\n    },\n\n    itemTab: {\n      cursor: 'pointer',\n      userSelect: 'none',\n      height: '100%',\n      width: '100%',\n      minWidth: COLLAPSED_WIDTH + styleguide.gridbase * 3,\n      borderBottomRightRadius: styleguide.gridbase * 2,\n      borderTopRightRadius: styleguide.gridbase * 2,\n      maxWidth: styleguide.gridbase * 20.5,\n      paddingLeft: styleguide.gridbase * 2,\n      paddingRight: styleguide.gridbase,\n\n      boxSizing: 'border-box',\n      alignItems: 'center',\n      whiteSpace: 'nowrap',\n      basedOn: [layout.row],\n      ':hover': {\n        border: `2px solid ${theme.mono.m6}`,\n        borderLeft: 'none',\n        paddingRight: styleguide.gridbase - 2,\n      },\n    },\n    listItemExpanded: {\n      itemTab: {\n        borderBottomRightRadius: styleguide.gridbase * 2,\n        borderTopRightRadius: styleguide.gridbase * 2,\n      },\n    },\n    listItemSelected: {\n      itemTab: {\n        backgroundColor: 'var(--ws-background)',\n      },\n    },\n    itemText: {\n      overflowX: 'hidden',\n      flexGrow: 1,\n      flexShrink: 1,\n      textOverflow: 'ellipsis',\n      basedOn: [useTypographyStyles.text],\n    },\n    itemToggle: {\n      marginLeft: styleguide.gridbase * 0.5,\n      height: styleguide.gridbase * 2,\n      width: styleguide.gridbase * 2,\n      borderRadius: styleguide.gridbase,\n      flexShrink: 0,\n      background: 'var(--ws-inactive)',\n      basedOn: [layout.column, layout.centerCenter],\n    },\n    itemToggleChecked: {\n      background: 'var(--ws-active)',\n    },\n    itemMenu: {\n      opacity: 0,\n      ...styleguide.transition.short,\n      transitionProperty: 'opacity',\n    },\n    expander: {\n      height: styleguide.gridbase * 4,\n      padding: [styleguide.gridbase, styleguide.gridbase * 2],\n      boxSizing: 'border-box',\n      alignItems: 'center',\n      basedOn: [layout.row],\n      color: theme.colors.text,\n      ':disabled': {\n        color: theme.colors.grayedText,\n      },\n    },\n    expanderText: {\n      color: 'inherit',\n      basedOn: [layout.flexSpacer, useTypographyStyles.bold],\n    },\n    expanderIcon: {\n      color: 'inherit',\n      marginLeft: styleguide.gridbase,\n      transform: 'rotate(90deg)',\n    },\n    expanderIconOpen: {\n      transform: 'rotate(270deg)',\n    },\n    pinButton: {\n      opacity: 0,\n      ...styleguide.transition.short,\n      transitionProperty: 'opacity',\n    },\n    pinButtonPinned: {\n      opacity: 1,\n    },\n  }),\n  'workspaces-bar_881015'\n);\n\nconst useStrings = createUseStrings(localization);\n\nfunction WorkspaceCheckbox({ toggled }: { toggled: boolean }) {\n  const styles = useStyles();\n  return (\n    <div className={cn(styles.itemToggle, toggled && styles.itemToggleChecked)}>\n      {toggled && <CheckIcon />}\n    </div>\n  );\n}\n\nexport interface WorkspacesBarProps {\n  expanded: boolean;\n  setExpanded: React.Dispatch<React.SetStateAction<boolean>>;\n  // selectedWorkspaces: string[];\n  // setSelectedWorkspaces: React.Dispatch<React.SetStateAction<string[]>>;\n  className?: string;\n}\n\nfunction CheckIcon() {\n  return (\n    <svg\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        opacity=\"0.6\"\n        d=\"M6.82617 10.739L11 5\"\n        stroke=\"white\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.6\"\n        d=\"M5 8.13037L6.82605 10.739\"\n        stroke=\"white\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n    </svg>\n  );\n}\n\nfunction CollapseIcon({ className }: { className?: string }) {\n  return (\n    <svg\n      width=\"24\"\n      height=\"24\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      className={className}\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <g clipPath=\"url(#clip0_591_1399)\">\n        <path\n          opacity=\"0.6\"\n          d=\"M9 12L15 18\"\n          stroke=\"#3184DD\"\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n        <path\n          opacity=\"0.6\"\n          d=\"M15 6L9 12\"\n          stroke=\"#1960CF\"\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n        />\n      </g>\n      <defs>\n        <clipPath id=\"clip0_591_1399\">\n          <rect width=\"24\" height=\"24\" fill=\"white\" />\n        </clipPath>\n      </defs>\n    </svg>\n  );\n}\n\ninterface WorkspaceToggleViewProps {\n  expanded: boolean;\n  onSelectAll: () => void;\n  onUnselectAll: () => void;\n  selectedRatio: number;\n  className?: string;\n}\n\nfunction WorkspaceToggleView({\n  selectedRatio,\n  onSelectAll,\n  onUnselectAll,\n  className,\n  expanded,\n}: WorkspaceToggleViewProps) {\n  const strings = useStrings();\n  const styles = useStyles();\n\n  return (\n    <div className={cn(styles.toggleView)}>\n      {expanded && (\n        <div>\n          <LabelSm>{strings.myWorkspaces}</LabelSm>\n        </div>\n      )}\n      <div className={cn(styles.toggleActions)}>\n        <TextSm\n          onClick={onSelectAll}\n          className={cn(\n            styles.toggleViewButton,\n            selectedRatio === 1 && styles.toggleViewButtonDisabled\n          )}\n        >\n          Select All\n        </TextSm>\n        <TextSm\n          onClick={onUnselectAll}\n          className={cn(\n            styles.toggleViewButton,\n            selectedRatio === 0 && styles.toggleViewButtonDisabled\n          )}\n        >\n          Unselect All\n        </TextSm>\n      </div>\n    </div>\n  );\n}\n\nfunction WorkspaceListItem({\n  workspace,\n  expanded,\n  isSelected,\n  onClick,\n  isHidden,\n  setIsHidden,\n  isPinned,\n  setIsPinned,\n}: {\n  workspace: VertexManager<Workspace>;\n  expanded: boolean;\n  isSelected: boolean;\n  isHidden: boolean;\n  setIsHidden: (hidden?: boolean) => void;\n  isPinned: boolean;\n  setIsPinned: (pinned?: boolean) => void;\n  onClick: MouseEventHandler;\n}) {\n  const color = useWorkspaceColor(workspace);\n  const { name } = usePartialVertex(workspace, ['name']);\n  const styles = useStyles();\n  const strings = useStrings();\n  const [isSettingsOpen, setIsSettingsOpen] = useState(false);\n\n  const style = useMemo<any>(\n    () => ({\n      '--ws-background': color.background,\n      '--ws-inactive': color.inactive,\n      '--ws-active': color.active,\n    }),\n    [color]\n  );\n\n  const textRef = useRef<HTMLDivElement>(null);\n  const isOverflowing =\n    textRef.current &&\n    textRef.current.offsetWidth < textRef.current.scrollWidth;\n\n  const renderButton = useCallback(() => <IconOverflow />, []);\n\n  return (\n    <div\n      className={cn(\n        styles.listItem,\n        expanded && styles.listItemExpanded,\n        isSelected && styles.listItemSelected\n      )}\n      style={style}\n    >\n      <Tooltip text={name} disabled={!isOverflowing} position=\"right\">\n        <div\n          className={cn(styles.itemTab)}\n          onClick={onClick}\n          onContextMenu={onClick}\n        >\n          <div ref={textRef} className={cn(styles.itemText)}>\n            {name}\n          </div>\n\n          <WorkspaceCheckbox toggled={isSelected} />\n        </div>\n      </Tooltip>\n      <div className={cn(layout.flexSpacer)} />\n      {expanded && (\n        <React.Fragment>\n          <Button\n            className={cn(styles.pinButton, isPinned && styles.pinButtonPinned)}\n            onClick={() => setIsPinned()}\n          >\n            {isPinned ? <IconPinOn /> : <IconPinOff />}\n          </Button>\n          <Menu\n            renderButton={renderButton}\n            direction=\"out\"\n            position=\"right\"\n            align=\"start\"\n            className={cn(styles.itemMenu)}\n          >\n            <MenuItem onClick={() => setIsSettingsOpen(true)}>\n              {strings.workspaceSettings}\n            </MenuItem>\n            <MenuItem onClick={() => setIsHidden()}>\n              {isHidden ? strings.showWorkspace : strings.hideWorkspace}\n            </MenuItem>\n          </Menu>\n        </React.Fragment>\n      )}\n      {/* <WorkspaceSettingsDialog\n        workspaceManager={workspace}\n        isOpen={isSettingsOpen}\n        hide={() => setIsSettingsOpen(false)}\n        source=\"bar:workspace\"\n      /> */}\n    </div>\n  );\n}\n\nfunction ExpanderIcon({ className }: { className?: string }) {\n  return (\n    <svg\n      className={className}\n      width=\"16\"\n      height=\"16\"\n      viewBox=\"0 0 16 16\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        opacity=\"0.8\"\n        d=\"M10 8L6 4\"\n        stroke=\"currentColor\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n      <path\n        opacity=\"0.8\"\n        d=\"M6 12L10 8\"\n        stroke=\"currentColor\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n      />\n    </svg>\n  );\n}\n\nfunction WorkspacesList({ expanded }: WorkspacesBarProps) {\n  const styles = useStyles();\n  const strings = useStrings();\n  const [showHidden, setShowHidden] = useState(false);\n  const settings = usePartialUserSettings([\n    'hiddenWorkspaces',\n    'pinnedWorkspaces',\n  ]);\n  const { hiddenWorkspaces, pinnedWorkspaces } = settings;\n  const workspacesQuery = useSharedQuery('workspaces');\n  const workspaces = useVertices(workspacesQuery.results);\n  const hidden = workspaces.filter((x) => hiddenWorkspaces.has(x.key));\n\n  const visible = workspaces\n    .filter((x) => !hiddenWorkspaces.has(x.key))\n    .sort((x, y) => sortWorkspaces(x, y, pinnedWorkspaces, hiddenWorkspaces));\n  const location = useLocation();\n  const navigate = useNavigate();\n  const logger = useLogger();\n  const lastSelectedKey = useRef<string>();\n  const selectedWorkspacesQuery = useSharedQuery('selectedWorkspaces');\n  const toggle = (e: MouseEvent, wsMng: VertexManager<Workspace>) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    //Route back to / if not there already\n    if (location.pathname !== '/') {\n      navigate('/');\n      logger.log({\n        severity: 'INFO',\n        event: 'Click',\n        uiSource: 'workspace-bar',\n        routeInfo: location.pathname + location.search + location.hash,\n      });\n      return;\n    }\n    const proxy = wsMng.getVertexProxy();\n    const collection = hidden.includes(proxy) ? hidden : visible;\n\n    const toggleAction = toggleActionFromEvent(e);\n    const r = toggleSelectionItem(\n      collection.map((x) => x.key),\n      wsMng.key,\n      Array.from(selectedWorkspacesQuery.keys()),\n      lastSelectedKey.current,\n      toggleAction\n    );\n    const selectedKeys = new Set<string>(r ? r.allSelectedItems : []);\n    const prevSelectedKeys = new Set(selectedWorkspacesQuery.keys());\n    workspacesQuery.forEach((ws) => (ws.selected = selectedKeys.has(ws.key)));\n    const didSelect = r?.toggleType === 'selected';\n    if (didSelect) {\n      lastSelectedKey.current = wsMng.key;\n    }\n    logger.log({\n      severity: 'INFO',\n      event: 'FilterChange',\n      type: 'workspace',\n      added: Array.from(SetUtils.subtract(selectedKeys, prevSelectedKeys)),\n      removed: Array.from(SetUtils.subtract(prevSelectedKeys, selectedKeys)),\n      uiSource: 'workspace-bar',\n      action: r.actionType,\n    });\n  };\n\n  const setIsHidden = useCallback(\n    (ws: Workspace, hidden: boolean | undefined) => {\n      hidden = Boolean(hidden);\n      hidden\n        ? settings.hiddenWorkspaces.add(ws.key)\n        : settings.hiddenWorkspaces.delete(ws.key);\n      logger.log({\n        severity: 'INFO',\n        event: 'MetadataChanged',\n        type: 'hide',\n        flag: hidden,\n        vertex: ws.key,\n        uiSource: 'workspace-bar',\n      });\n    },\n    [settings, logger]\n  );\n\n  const setIsPinned = useCallback(\n    (ws: Workspace, pinned: boolean | undefined) => {\n      pinned = Boolean(pinned);\n      pinned\n        ? settings.pinnedWorkspaces.add(ws.key)\n        : settings.pinnedWorkspaces.delete(ws.key);\n      logger.log({\n        severity: 'INFO',\n        event: 'MetadataChanged',\n        type: 'pin',\n        flag: pinned,\n        vertex: ws.key,\n        uiSource: 'workspace-bar',\n      });\n    },\n    [settings, logger]\n  );\n\n  return (\n    <Scroller>\n      {(ref) => (\n        <div ref={ref} className={cn(styles.list)}>\n          {visible.map((ws) => (\n            <WorkspaceListItem\n              setIsHidden={(hidden) => setIsHidden(ws, hidden)}\n              setIsPinned={(pinned) => setIsPinned(ws, pinned)}\n              isHidden={false}\n              isPinned={pinnedWorkspaces.has(ws.key)}\n              key={ws.key}\n              workspace={ws.manager as VertexManager<Workspace>}\n              expanded={expanded}\n              onClick={() => (ws.selected = !ws.selected)}\n              isSelected={ws.selected}\n            />\n          ))}\n          <Button\n            className={cn(styles.expander)}\n            disabled={!hidden.length}\n            onClick={() => setShowHidden((x) => !x)}\n          >\n            <div className={cn(styles.expanderText)}>\n              {expanded\n                ? strings.hiddenWorkspaces\n                : strings.hiddenWorkspacesShort}\n            </div>\n            <ExpanderIcon\n              className={cn(\n                styles.expanderIcon,\n                showHidden && styles.expanderIconOpen\n              )}\n            />\n          </Button>\n          {showHidden &&\n            hidden.map((ws) => (\n              <WorkspaceListItem\n                setIsHidden={(hidden) => setIsHidden(ws, hidden)}\n                setIsPinned={(pinned) => setIsPinned(ws, pinned)}\n                isHidden={true}\n                isPinned={false}\n                key={ws.key}\n                workspace={ws.manager as VertexManager<Workspace>}\n                expanded={expanded}\n                onClick={(e) => (ws.selected = !ws.selected)}\n                isSelected={ws.selected}\n              />\n            ))}\n        </div>\n      )}\n    </Scroller>\n  );\n}\n\nfunction WorkspaceBarInternal({\n  expanded,\n  setExpanded,\n  className,\n}: WorkspacesBarProps) {\n  const styles = useStyles();\n  const { hiddenWorkspaces, pinnedWorkspaces } = usePartialUserSettings([\n    'hiddenWorkspaces',\n    'pinnedWorkspaces',\n  ]);\n\n  const workspacesQuery = useSharedQuery('workspaces');\n  const selectedWorkspacesQuery = useSharedQuery('selectedWorkspaces');\n  const logger = useLogger();\n  const selectAll = useCallback(() => {\n    workspacesQuery.forEach(\n      (ws) => (ws.selected = !hiddenWorkspaces.has(ws.key))\n    );\n    logger.log({\n      severity: 'INFO',\n      event: 'FilterChange',\n      uiSource: 'workspace-bar',\n      added: 'ALL',\n    });\n  }, [workspacesQuery, logger, hiddenWorkspaces]);\n  const unselectAll = useCallback(() => {\n    workspacesQuery.forEach((ws) => (ws.selected = false));\n    logger.log({\n      severity: 'INFO',\n      event: 'FilterChange',\n      uiSource: 'workspace-bar',\n      removed: 'ALL',\n    });\n  }, [workspacesQuery, logger]);\n\n  return (\n    <Layer priority={2}>\n      {(style) => (\n        <div\n          style={style}\n          className={cn(styles.root, !expanded && styles.collapsed, className)}\n        >\n          <div className={cn(styles.header)}>\n            <div className={cn(styles.logoContainer)}>\n              <LogoIcon className={cn(styles.logoIcon)} />\n              {expanded && <LogoText className={cn(styles.logoText)} />}\n              <div className={cn(layout.flexSpacer)} />\n              <Button\n                className={cn(styles.openBarButton)}\n                onClick={() => setExpanded((x) => !x)}\n              >\n                <CollapseIcon\n                  className={expanded ? styles.rotated : undefined}\n                />\n              </Button>\n            </div>\n            <WorkspaceToggleView\n              expanded={expanded}\n              selectedRatio={\n                workspacesQuery.count &&\n                selectedWorkspacesQuery.count / workspacesQuery.count\n              }\n              onSelectAll={selectAll}\n              onUnselectAll={unselectAll}\n            />\n          </div>\n          <WorkspacesList expanded={expanded} setExpanded={setExpanded} />\n          <WorkspaceBarActions expanded={expanded} />\n        </div>\n      )}\n    </Layer>\n  );\n}\n\nfunction MobileBar({ expanded, setExpanded, ...rest }: WorkspacesBarProps) {\n  const styles = useStyles();\n\n  return createUniversalPortal(\n    <Layer priority={3}>\n      {(style) => (\n        <React.Fragment>\n          {expanded && (\n            <div\n              style={style}\n              className={cn(styles.backdrop)}\n              onClick={() => setExpanded(false)}\n            />\n          )}\n          <WorkspaceBarInternal\n            {...rest}\n            expanded={expanded}\n            setExpanded={setExpanded}\n          />\n        </React.Fragment>\n      )}\n    </Layer>\n  );\n}\n\nfunction DesktopBar(props: WorkspacesBarProps) {\n  return <WorkspaceBarInternal {...props} />;\n}\n\nexport function WorkspacesBar(props: WorkspacesBarProps) {\n  const device = useCurrentDevice();\n  const isMobile = device < Devices.Tablet;\n  if (isMobile) {\n    return <MobileBar {...props} />;\n  }\n  return <DesktopBar {...props} />;\n}\n", "import React, {\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport { Route } from 'https://esm.sh/react-router@6.7.0';\nimport { BrowserRouter } from 'https://esm.sh/react-router-dom@6.7.0';\nimport { layout } from '../../../styles/index.ts';\nimport { cn, makeStyles } from '../../../styles/css-objects/index.ts';\nimport { Devices, useCurrentDevice } from '../../../styles/responsive.ts';\nimport {\n  darkTheme,\n  lightTheme,\n  ThemeProvider,\n} from '../../../styles/theme.tsx';\nimport { useGraphManager } from '../core/cfds/react/graph.tsx';\nimport { VertexManager } from '../../../cfds/client/graph/vertex-manager.ts';\nimport { Filter } from '../../../cfds/client/graph/vertices/filter.ts';\nimport { Workspace } from '../../../cfds/client/graph/vertices/workspace.ts';\nimport LoadingView from './loading-view.tsx';\nimport { CreateWorkspaceView } from './new-workspace/index.tsx';\nimport WorkspaceContentView from './workspace-content/index.tsx';\nimport { WorkspacesBar } from './workspaces-bar/index.tsx';\nimport { useSharedQuery } from '../core/cfds/react/query.ts';\nimport { usePartialVertex, useVertex } from '../core/cfds/react/vertex.ts';\nimport { VertexId } from '../../../cfds/client/graph/vertex.ts';\n\nconst useStyles = makeStyles((theme: any) => ({\n  blurred: {\n    filter: 'blur(2px)',\n  },\n  root: {\n    height: '100vh',\n    width: '100vw',\n    basedOn: [layout.row],\n  },\n  content: {\n    height: '100%',\n    overflow: 'hidden',\n    // width: `calc(100% - ${WORKSPACE_BAR_WIDTH}px)`,\n    basedOn: [layout.column, layout.flexSpacer],\n  },\n}));\n\nexport interface FilterContext {\n  filter: VertexManager<Filter>;\n  setFilter: (filter: VertexId<Filter>) => void;\n}\n\nconst filterContext = React.createContext<FilterContext | undefined>(undefined);\n\nexport interface FilterContextProviderProps {\n  filterKey?: string;\n  children: React.ReactNode;\n}\n\nexport const FilterKeyTasks = 'TasksFilter';\nexport const FilterKeyNotes = 'NotesFilter';\n\nexport function FilterContextProvider({\n  filterKey,\n  children,\n}: FilterContextProviderProps) {\n  const graph = useGraphManager();\n  const [filter, setFilter] = useState<VertexManager<Filter>>(\n    graph.getVertexManager<Filter>(filterKey || FilterKeyTasks)\n  );\n  return (\n    <filterContext.Provider\n      value={{\n        filter,\n        setFilter: (id) => setFilter(graph.getVertexManager<Filter>(id)),\n      }}\n    >\n      {children}\n    </filterContext.Provider>\n  );\n}\n\nexport function useFilterContext(): FilterContext {\n  return useContext(filterContext)!;\n}\n\nexport function useFilter(): Filter {\n  return useVertex(useFilterContext().filter);\n}\n\nexport function usePartialFilter(keys: (keyof Filter)[]): Filter {\n  return usePartialVertex(useFilterContext().filter, keys);\n}\n\ninterface AppProps {}\n\n// const isDarkTheme = window.matchMedia && window.matchMedia(\"(prefers-color-scheme: dark)\");\nconst isDarkTheme = false;\n\nfunction Root({ style }: AppProps & { style?: any }) {\n  const styles = useStyles();\n\n  // const [selectedWorkspaces, setSelectedWorkspaces] = useState<string[]>([]);\n\n  const [loading, setLoading] = useState(true);\n  const graph = useGraphManager();\n\n  useEffect(() => {\n    graph.loadLocalContents().then(() => setLoading(false));\n  }, [graph]);\n\n  const device = useCurrentDevice();\n\n  const [expanded, setExpanded] = useState(device > Devices.Tablet);\n  // const selectedWorkspacesQuery = useSharedQuery('selectedWorkspaces');\n  const workspacesQuery = useSharedQuery('workspaces');\n\n  // const currentUser = user?.currentUser;\n  // const history = useHistoryStatic();\n\n  // useEffect(() => {\n  //   if (currentUser?.firstLogin) {\n  //     history.push(CREATE_WORKSPACE);\n  //   }\n  // }, [currentUser?.firstLogin, history]);\n  // useSyncUrlParam(\n  //   'selectedWorkspaces',\n  //   true,\n  //   Array.from(selectedWorkspacesQuery.keys()),\n  //   (keys) =>\n  //     workspacesQuery.forEach((ws) => (ws.selected = keys.includes(ws.key))),\n  //   {\n  //     route: '/',\n  //   }\n  // );\n\n  // const onWorkspaceCreated = useCallback((wsKey: string) => {\n  //   setSelectedWorkspaces((current) => [...current, wsKey]);\n  // }, []);\n\n  return (\n    <div className={cn(styles.root)} style={style}>\n      <FilterContextProvider>\n        {!loading ? (\n          <>\n            <WorkspacesBar expanded={expanded} setExpanded={setExpanded} />\n            <div className={cn(styles.content)}>\n              <BrowserRouter>\n                <Route path=\"/new\">\n                  <CreateWorkspaceView\n                    source=\"bar:workspace\"\n                    onWorkspaceCreated={(wsKey) => {\n                      workspacesQuery.forEach(\n                        (ws) => (ws.selected = ws.key === wsKey)\n                      );\n                      // Depending on exact timings, our query may miss\n                      // the newly created workspace. Ensure it's always\n                      // selected.\n                      graph.getVertex<Workspace>(wsKey).selected = true;\n                    }}\n                  />\n                </Route>\n                <Route path=\"/\">\n                  <WorkspaceContentView />\n                </Route>\n              </BrowserRouter>\n            </div>\n          </>\n        ) : (\n          <LoadingView />\n        )}\n      </FilterContextProvider>\n    </div>\n  );\n}\n\nexport default function AppView() {\n  //const wsLoadedRef = useRef(false);\n  const theme = useMemo(() => (isDarkTheme ? darkTheme : lightTheme), []);\n  return (\n    <ThemeProvider theme={theme} isRoot={true}>\n      {({ style }) => <Root style={style} />}\n    </ThemeProvider>\n  );\n}\n", "import { GraphManager } from '../../../../../cfds/client/graph/graph-manager.ts';\nimport { VertexManager } from '../../../../../cfds/client/graph/vertex-manager.ts';\nimport { User } from '../../../../../cfds/client/graph/vertices/user.ts';\nimport React, {\n  useContext,\n  useEffect,\n  useMemo,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport { NoteSearchEngine } from '../../../../../cfds/client/graph/note-search.ts';\nimport { useLogger } from './logger.tsx';\nimport { NS_FILTER } from '../../../../../cfds/base/scheme-types.ts';\nimport { usePartialVertex, useVertex } from './vertex.ts';\nimport { UserSettings } from '../../../../../cfds/client/graph/vertices/user-settings.ts';\nimport { FilterKeyNotes, FilterKeyTasks } from '../../../app/index.tsx';\nimport { NoteType } from '../../../../../cfds/client/graph/vertices/note.ts';\nimport { SharedQueriesManager } from '../../../../../cfds/client/graph/shared-queries.ts';\n\ntype ContextProps = {\n  graphManager?: GraphManager;\n  sessionId?: string;\n};\n\nexport const CFDSContext = React.createContext<ContextProps>({});\n\nexport function useGraphManager(): GraphManager {\n  return useContext(CFDSContext).graphManager!;\n}\n\nexport function useSharedQueriesManager(): SharedQueriesManager {\n  return useGraphManager().sharedQueriesManager;\n}\n\nexport function useRootUser(): VertexManager<User> {\n  const graph = useGraphManager();\n  const key = graph.rootKey;\n  const user = useMemo<VertexManager<User>>(\n    () => graph && graph.getVertexManager<User>(key),\n    [graph, key]\n  );\n  return user;\n}\n\nexport function usePartialCurrentUser<K extends keyof User>(\n  keys?: K[]\n): Pick<User, K> & User {\n  const graph = useGraphManager();\n  return usePartialVertex(graph.getRootVertexManager<User>(), keys || []);\n}\n\nexport function useCurrentUser(): User {\n  const graph = useGraphManager();\n  return useVertex(graph.getRootVertexManager<User>());\n}\n\nexport function useUserSettings(): UserSettings {\n  const u = usePartialCurrentUser(['settings']);\n  return useVertex(u.settings.manager as VertexManager<UserSettings>);\n}\n\nexport function usePartialUserSettings<K extends keyof UserSettings>(\n  keys?: K[]\n): Pick<UserSettings, K> & UserSettings {\n  const u = usePartialCurrentUser(['settings']);\n  return usePartialVertex(\n    u.settings.manager as VertexManager<UserSettings>,\n    keys || []\n  );\n}\n\nexport function useCfdsContext(): ContextProps {\n  return useContext(CFDSContext);\n}\n\ninterface CfdsClientProviderProps {\n  userId: string;\n  sessionId: string;\n  children: React.ReactNode;\n}\n\n// const kDemoDataPromise: Promise<ReadonlyJSONObject> = fetch('/demo.json').then(\n//   response => response.json()\n// );\n\nexport function CfdsClientProvider({\n  userId,\n  sessionId,\n  children,\n}: CfdsClientProviderProps) {\n  const logger = useLogger();\n  const sessionPtrKey = `${userId}/${sessionId}`;\n\n  const graphManager = useMemo(() => {\n    const manager = new GraphManager(\n      userId,\n      (key: string) => key !== sessionPtrKey,\n      'http://localhost'\n    );\n\n    // Create local filters for our main UI tabs\n    manager.createVertex(\n      NS_FILTER,\n      { owner: userId, noteType: NoteType.Note },\n      FilterKeyNotes,\n      true\n    );\n    manager.createVertex(\n      NS_FILTER,\n      { owner: userId, noteType: NoteType.Task },\n      FilterKeyTasks,\n      true\n    );\n    // Load cached contents, then select pinned workspaces which is the default\n    // mode after reload.\n    manager.loadLocalContents().finally(() => {\n      const user = manager.getRootVertex<User>();\n      if (user.isNull) {\n        return;\n      }\n      const settings = user.settings;\n      if (settings.isNull) {\n        return;\n      }\n      const pinnedWorkspaces = settings.pinnedWorkspaces;\n      manager.sharedQueriesManager.workspaces.forEach((ws) => {\n        if (pinnedWorkspaces.has(ws.key)) {\n          ws.selected = true;\n        }\n      });\n    });\n    // kDemoDataPromise.then(data => graphManager.importSubGraph(data, true));\n\n    return manager;\n  }, [userId, sessionId, sessionPtrKey]);\n\n  useEffect(() => {\n    const sessionIntervalId = setInterval(() => {\n      logger.log({\n        severity: 'INFO',\n        event: 'SessionAlive',\n        foreground: document.visibilityState === 'visible',\n      });\n    }, 10 * 1000);\n\n    return () => {\n      clearInterval(sessionIntervalId);\n    };\n  }, [logger, graphManager]);\n\n  const ctx = useMemo<ContextProps>(\n    () => ({\n      graphManager: graphManager,\n      sessionId,\n      searchEngine: new NoteSearchEngine(graphManager),\n    }),\n    [graphManager, sessionId]\n  );\n\n  return <CFDSContext.Provider value={ctx}>{children}</CFDSContext.Provider>;\n}\n", "import React from 'https://esm.sh/react@18.2.0';\n\ninterface LoginIllustrationProps {\n  className?: string;\n}\n\nconst MASK_ALPHA_STYLE: any = { 'mask-type': 'alpha' };\n\nexport const LoginIllustration = ({ className }: LoginIllustrationProps) => (\n  <svg\n    className={className}\n    width=\"743\"\n    height=\"577\"\n    viewBox=\"0 0 743 577\"\n    fill=\"none\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <mask\n      id=\"mask0_531_12634\"\n      style={MASK_ALPHA_STYLE}\n      maskUnits=\"userSpaceOnUse\"\n      x=\"0\"\n      y=\"0\"\n      width=\"743\"\n      height=\"577\"\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M732.598 270.993C723.101 236.662 707.884 200.574 686.866 166.328C683.057 160.11 679.04 153.954 674.839 147.875C674.7 147.666 674.553 147.467 674.404 147.258C659.369 125.579 641.881 104.961 621.923 86.3865C620.428 84.9958 618.924 83.6215 617.402 82.2553C609.602 75.2375 601.436 68.5418 592.897 62.2201C592.445 61.8816 592.002 61.5499 591.548 61.2197C590.261 60.2711 588.966 59.3322 587.661 58.4027C583.122 55.1763 578.487 52.0455 573.747 49.0375C572.522 48.2541 571.287 47.4803 570.052 46.7242C569.608 46.4457 569.156 46.1673 568.703 45.8984C559.694 40.3847 550.329 35.2803 540.616 30.6373C540.556 30.6032 540.486 30.5759 540.424 30.5417C536.625 28.7238 532.772 26.9851 528.867 25.3159C523.58 23.0545 518.197 20.924 512.711 18.9328C506.823 16.7941 500.824 14.8193 494.701 13.0287C494.283 12.8976 493.866 12.7762 493.45 12.6547C478.658 8.36788 463.214 5.08964 447.091 2.94144C379.793 -6.0321 300.878 4.81941 210.161 45.2816C144.603 74.5251 72.7835 138.336 41 202.33C22.2955 239.984 6.11992 282.385 1.39908 325.169C1.39089 325.273 1.38134 325.378 1.3636 325.481C1.33767 325.672 1.31992 325.863 1.30218 326.046C0.615687 332.464 0.188506 338.89 0.0492962 345.308C-0.21138 357.43 0.552907 369.526 2.5537 381.501C4.45896 392.901 7.47516 404.188 11.7893 415.285C22.2941 442.33 39.5984 465.922 59.2256 487.113C63.4428 491.67 67.7651 496.114 72.1556 500.452C75.5827 503.844 79.0424 507.218 82.565 510.54C84.9916 512.843 87.4441 515.123 89.9308 517.366C90.9312 518.279 91.9398 519.184 92.9565 520.071C98.1564 524.672 103.495 529.106 109.027 533.298C110.018 534.054 111.018 534.794 112.019 535.533C112.305 535.742 112.592 535.951 112.88 536.16C113.367 536.516 113.863 536.864 114.358 537.204C120.914 541.847 127.759 545.926 134.872 549.447C135.22 549.621 135.576 549.795 135.933 549.951C137.228 550.586 138.533 551.194 139.846 551.785C144.689 553.959 149.646 555.881 154.725 557.542C154.985 557.638 155.238 557.725 155.498 557.794C157.802 558.551 160.133 559.247 162.49 559.891C164.673 560.482 166.864 561.039 169.064 561.56C171.969 562.246 174.883 562.873 177.813 563.447C182.161 564.299 186.543 565.031 190.935 565.673C192.292 565.874 193.657 566.065 195.023 566.238C199.928 566.891 204.849 567.43 209.771 567.908C210.606 567.985 211.45 568.073 212.293 568.142C212.466 568.16 212.641 568.176 212.814 568.186C212.962 568.204 213.101 568.22 213.25 568.23C213.345 568.238 213.433 568.247 213.528 568.256C213.676 568.273 213.833 568.282 213.98 568.29C215.693 568.455 217.406 568.594 219.12 568.742C219.39 568.767 219.668 568.785 219.937 568.803C224.624 569.185 229.32 569.507 234.017 569.794C234.46 569.82 234.895 569.846 235.338 569.872C243.859 570.367 252.381 570.723 260.913 571.011C268.304 571.254 275.696 571.455 283.088 571.628C290.454 571.811 297.81 571.984 305.176 572.159C330.542 572.759 355.916 573.342 381.292 573.924C388.509 574.089 395.736 574.263 402.962 574.429C405.737 574.49 408.502 574.558 411.275 574.62C412.562 574.646 413.849 574.681 415.136 574.715C431.658 575.115 448.198 575.662 464.746 576.124C466.477 576.176 468.216 576.219 469.956 576.263C470.26 576.271 470.556 576.281 470.861 576.289C472.687 576.333 474.521 576.384 476.349 576.42C492.618 576.828 508.888 577.08 525.15 576.977C528.933 576.959 532.715 576.915 536.498 576.855C537.837 576.829 539.177 576.803 540.516 576.768C558.299 576.36 576.212 575.125 593.814 572.246C597.144 571.707 600.466 571.107 603.77 570.428C604.075 570.377 604.387 570.315 604.691 570.245C606.013 569.977 607.335 569.698 608.648 569.402C621.474 566.559 634.048 562.689 646.196 557.481C674.841 545.201 701.251 525.662 717.607 498.748C727.007 483.27 732.129 465.851 735.155 448.093C737.685 433.266 739.259 418.206 740.347 403.153C740.373 402.815 740.399 402.475 740.425 402.137C740.711 398.128 740.964 394.11 741.19 390.102C743.467 350.274 743.258 309.551 732.598 270.993Z\"\n        fill=\"white\"\n      />\n    </mask>\n    <g mask=\"url(#mask0_531_12634)\">\n      <path\n        d=\"M732.345 270.925C722.849 236.593 707.631 200.505 686.613 166.26C682.804 160.042 678.788 153.885 674.587 147.807C674.448 147.598 674.3 147.398 674.151 147.19C659.115 125.511 641.628 104.893 621.671 86.3183C620.175 84.9276 618.671 83.5532 617.149 82.187C609.35 75.1693 601.184 68.4736 592.644 62.1518C592.193 61.812 591.749 61.4817 591.296 61.1514C590.009 60.2029 588.714 59.2639 587.409 58.3345C582.87 55.1081 578.235 51.9773 573.495 48.9692C572.269 48.1872 571.034 47.412 569.799 46.6559C569.356 46.3775 568.904 46.0991 568.451 45.8302C559.442 40.3164 550.076 35.2121 540.363 30.569C540.303 30.5349 540.233 30.5076 540.172 30.4735C536.372 28.6556 532.52 26.9168 528.615 25.2477C523.328 22.9862 517.945 20.8558 512.458 18.8645C506.571 16.7259 500.571 14.751 494.449 12.9604C494.031 12.8294 493.613 12.7079 493.197 12.5865C478.405 8.29964 462.961 5.0214 446.839 2.87321C379.541 -6.10034 300.625 4.75117 209.91 45.2133C144.352 74.4582 72.5323 138.268 40.7489 202.262C22.043 239.915 5.8688 282.317 1.1466 325.101C1.13841 325.204 1.12885 325.309 1.11248 325.413C1.08654 325.604 1.0688 325.795 1.05106 325.978C0.364567 332.395 -0.0626151 338.822 -0.20046 345.24C-0.461136 357.362 0.303151 369.458 2.30394 381.433C4.2092 392.833 7.2254 404.121 11.5395 415.217C22.0444 442.262 39.3486 465.854 58.9758 487.045C63.193 491.602 67.5153 496.046 71.9073 500.384C75.3343 503.776 78.794 507.15 82.3166 510.471C84.7432 512.775 87.1957 515.054 89.6824 517.298C90.6828 518.211 91.6914 519.116 92.7081 520.003C97.908 524.604 103.247 529.038 108.779 533.229C109.769 533.986 110.77 534.725 111.77 535.465C112.057 535.674 112.343 535.883 112.631 536.091C113.119 536.448 113.614 536.796 114.11 537.135C120.666 541.779 127.51 545.858 134.624 549.379C134.972 549.552 135.328 549.727 135.684 549.884C136.979 550.519 138.284 551.127 139.597 551.718C144.441 553.893 149.398 555.814 154.476 557.475C154.737 557.571 154.989 557.658 155.25 557.728C157.554 558.484 159.885 559.18 162.242 559.824C164.424 560.415 166.616 560.972 168.816 561.493C171.72 562.18 174.634 562.806 177.564 563.381C181.913 564.232 186.295 564.964 190.687 565.607C192.044 565.807 193.408 565.998 194.775 566.172C199.678 566.824 204.601 567.363 209.523 567.841C210.358 567.919 211.201 568.006 212.045 568.075C212.218 568.093 212.393 568.11 212.566 568.119C212.713 568.137 212.853 568.153 213.001 568.163C213.097 568.171 213.184 568.181 213.28 568.189C213.427 568.206 213.584 568.215 213.732 568.223C215.444 568.388 217.157 568.527 218.871 568.675C219.142 568.701 219.419 568.718 219.689 568.736C224.376 569.118 229.072 569.44 233.768 569.727C234.212 569.753 234.647 569.779 235.091 569.805C243.612 570.3 252.134 570.656 260.666 570.944C268.057 571.187 275.449 571.388 282.841 571.561C290.207 571.744 297.563 571.917 304.929 572.092C330.295 572.693 355.669 573.275 381.045 573.857C388.262 574.022 395.488 574.197 402.715 574.362C405.49 574.423 408.255 574.493 411.028 574.553C412.315 574.579 413.602 574.614 414.889 574.648C431.411 575.048 447.951 575.596 464.499 576.057C466.23 576.109 467.969 576.152 469.709 576.196C470.013 576.204 470.309 576.214 470.614 576.222C472.44 576.266 474.274 576.317 476.102 576.353C492.371 576.761 508.641 577.014 524.903 576.91C528.686 576.892 532.468 576.848 536.251 576.788C537.59 576.762 538.93 576.736 540.269 576.701C558.052 576.293 575.965 575.058 593.567 572.179C596.897 571.64 600.219 571.04 603.525 570.362C603.829 570.31 604.141 570.248 604.446 570.179C605.767 569.91 607.089 569.631 608.402 569.335C621.229 566.492 633.803 562.622 645.951 557.414C674.595 545.135 701.005 525.595 717.361 498.681C726.762 483.203 731.884 465.784 734.91 448.026C737.44 433.201 739.013 418.139 740.101 403.086C740.127 402.747 740.153 402.408 740.179 402.07C740.466 398.061 740.718 394.043 740.945 390.035C743.216 350.206 743.007 309.483 732.345 270.925Z\"\n        fill=\"#F7EBDB\"\n      />\n    </g>\n    <mask\n      id=\"mask1_531_12634\"\n      style={MASK_ALPHA_STYLE}\n      maskUnits=\"userSpaceOnUse\"\n      x=\"0\"\n      y=\"0\"\n      width=\"743\"\n      height=\"577\"\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M732.598 270.993C723.101 236.662 707.884 200.574 686.866 166.328C683.057 160.11 679.04 153.954 674.839 147.875C674.7 147.666 674.553 147.467 674.404 147.258C659.369 125.579 641.881 104.961 621.923 86.3865C620.428 84.9958 618.924 83.6215 617.402 82.2553C609.602 75.2375 601.436 68.5418 592.897 62.2201C592.445 61.8816 592.002 61.5499 591.548 61.2197C590.261 60.2711 588.966 59.3322 587.661 58.4027C583.122 55.1763 578.487 52.0455 573.747 49.0375C572.522 48.2541 571.287 47.4803 570.052 46.7242C569.608 46.4457 569.156 46.1673 568.703 45.8984C559.694 40.3847 550.329 35.2803 540.616 30.6373C540.556 30.6032 540.486 30.5759 540.424 30.5417C536.625 28.7238 532.772 26.9851 528.867 25.3159C523.58 23.0545 518.197 20.924 512.711 18.9328C506.823 16.7941 500.824 14.8193 494.701 13.0287C494.283 12.8976 493.866 12.7762 493.45 12.6547C478.658 8.36788 463.214 5.08964 447.091 2.94144C379.793 -6.0321 300.878 4.81941 210.161 45.2816C144.603 74.5251 72.7835 138.336 41 202.33C22.2955 239.984 6.11992 282.385 1.39908 325.169C1.39089 325.273 1.38134 325.378 1.3636 325.481C1.33767 325.672 1.31992 325.863 1.30218 326.046C0.615687 332.464 0.188506 338.89 0.0492962 345.308C-0.21138 357.43 0.552907 369.526 2.5537 381.501C4.45896 392.901 7.47516 404.188 11.7893 415.285C22.2941 442.33 39.5984 465.922 59.2256 487.113C63.4428 491.67 67.7651 496.114 72.1556 500.452C75.5827 503.844 79.0424 507.218 82.565 510.54C84.9916 512.843 87.4441 515.123 89.9308 517.366C90.9312 518.279 91.9398 519.184 92.9565 520.071C98.1564 524.672 103.495 529.106 109.027 533.298C110.018 534.054 111.018 534.794 112.019 535.533C112.305 535.742 112.592 535.951 112.88 536.16C113.367 536.516 113.863 536.864 114.358 537.204C120.914 541.847 127.759 545.926 134.872 549.447C135.22 549.621 135.576 549.795 135.933 549.951C137.228 550.586 138.533 551.194 139.846 551.785C144.689 553.959 149.646 555.881 154.725 557.542C154.985 557.638 155.238 557.725 155.498 557.794C157.802 558.551 160.133 559.247 162.49 559.891C164.673 560.482 166.864 561.039 169.064 561.56C171.969 562.246 174.883 562.873 177.813 563.447C182.161 564.299 186.543 565.031 190.935 565.673C192.292 565.874 193.657 566.065 195.023 566.238C199.928 566.891 204.849 567.43 209.771 567.908C210.606 567.985 211.45 568.073 212.293 568.142C212.466 568.16 212.641 568.176 212.814 568.186C212.962 568.204 213.101 568.22 213.25 568.23C213.345 568.238 213.433 568.247 213.528 568.256C213.676 568.273 213.833 568.282 213.98 568.29C215.693 568.455 217.406 568.594 219.12 568.742C219.39 568.767 219.668 568.785 219.937 568.803C224.624 569.185 229.32 569.507 234.017 569.794C234.46 569.82 234.895 569.846 235.338 569.872C243.859 570.367 252.381 570.723 260.913 571.011C268.304 571.254 275.696 571.455 283.088 571.628C290.454 571.811 297.81 571.984 305.176 572.159C330.542 572.759 355.916 573.342 381.292 573.924C388.509 574.089 395.736 574.263 402.962 574.429C405.737 574.49 408.502 574.558 411.275 574.62C412.562 574.646 413.849 574.681 415.136 574.715C431.658 575.115 448.198 575.662 464.746 576.124C466.477 576.176 468.216 576.219 469.956 576.263C470.26 576.271 470.556 576.281 470.861 576.289C472.687 576.333 474.521 576.384 476.349 576.42C492.618 576.828 508.888 577.08 525.15 576.977C528.933 576.959 532.715 576.915 536.498 576.855C537.837 576.829 539.177 576.803 540.516 576.768C558.299 576.36 576.212 575.125 593.814 572.246C597.144 571.707 600.466 571.107 603.77 570.428C604.075 570.377 604.387 570.315 604.691 570.245C606.013 569.977 607.335 569.698 608.648 569.402C621.474 566.559 634.048 562.689 646.196 557.481C674.841 545.201 701.251 525.662 717.607 498.748C727.007 483.27 732.129 465.851 735.155 448.093C737.685 433.266 739.259 418.206 740.347 403.153C740.373 402.815 740.399 402.475 740.425 402.137C740.711 398.128 740.964 394.11 741.19 390.102C743.467 350.274 743.258 309.551 732.598 270.993Z\"\n        fill=\"white\"\n      />\n    </mask>\n    <g mask=\"url(#mask1_531_12634)\">\n      <path\n        d=\"M660.953 370.888L658.058 390.506L657.883 391.707L212.399 441.978L212.208 442.004L96.2907 356.436L97.5081 335.192L544.167 306.06L660.953 370.888Z\"\n        fill=\"#C6A987\"\n      />\n    </g>\n    <mask\n      id=\"mask2_531_12634\"\n      style={MASK_ALPHA_STYLE}\n      maskUnits=\"userSpaceOnUse\"\n      x=\"0\"\n      y=\"0\"\n      width=\"743\"\n      height=\"577\"\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M732.598 270.993C723.101 236.662 707.884 200.574 686.866 166.328C683.057 160.11 679.04 153.954 674.839 147.875C674.7 147.666 674.553 147.467 674.404 147.258C659.369 125.579 641.881 104.961 621.923 86.3865C620.428 84.9958 618.924 83.6215 617.402 82.2553C609.602 75.2375 601.436 68.5418 592.897 62.2201C592.445 61.8816 592.002 61.5499 591.548 61.2197C590.261 60.2711 588.966 59.3322 587.661 58.4027C583.122 55.1763 578.487 52.0455 573.747 49.0375C572.522 48.2541 571.287 47.4803 570.052 46.7242C569.608 46.4457 569.156 46.1673 568.703 45.8984C559.694 40.3847 550.329 35.2803 540.616 30.6373C540.556 30.6032 540.486 30.5759 540.424 30.5417C536.625 28.7238 532.772 26.9851 528.867 25.3159C523.58 23.0545 518.197 20.924 512.711 18.9328C506.823 16.7941 500.824 14.8193 494.701 13.0287C494.283 12.8976 493.866 12.7762 493.45 12.6547C478.658 8.36788 463.214 5.08964 447.091 2.94144C379.793 -6.0321 300.878 4.81941 210.161 45.2816C144.603 74.5251 72.7835 138.336 41 202.33C22.2955 239.984 6.11992 282.385 1.39908 325.169C1.39089 325.273 1.38134 325.378 1.3636 325.481C1.33767 325.672 1.31992 325.863 1.30218 326.046C0.615687 332.464 0.188506 338.89 0.0492962 345.308C-0.21138 357.43 0.552907 369.526 2.5537 381.501C4.45896 392.901 7.47516 404.188 11.7893 415.285C22.2941 442.33 39.5984 465.922 59.2256 487.113C63.4428 491.67 67.7651 496.114 72.1556 500.452C75.5827 503.844 79.0424 507.218 82.565 510.54C84.9916 512.843 87.4441 515.123 89.9308 517.366C90.9312 518.279 91.9398 519.184 92.9565 520.071C98.1564 524.672 103.495 529.106 109.027 533.298C110.018 534.054 111.018 534.794 112.019 535.533C112.305 535.742 112.592 535.951 112.88 536.16C113.367 536.516 113.863 536.864 114.358 537.204C120.914 541.847 127.759 545.926 134.872 549.447C135.22 549.621 135.576 549.795 135.933 549.951C137.228 550.586 138.533 551.194 139.846 551.785C144.689 553.959 149.646 555.881 154.725 557.542C154.985 557.638 155.238 557.725 155.498 557.794C157.802 558.551 160.133 559.247 162.49 559.891C164.673 560.482 166.864 561.039 169.064 561.56C171.969 562.246 174.883 562.873 177.813 563.447C182.161 564.299 186.543 565.031 190.935 565.673C192.292 565.874 193.657 566.065 195.023 566.238C199.928 566.891 204.849 567.43 209.771 567.908C210.606 567.985 211.45 568.073 212.293 568.142C212.466 568.16 212.641 568.176 212.814 568.186C212.962 568.204 213.101 568.22 213.25 568.23C213.345 568.238 213.433 568.247 213.528 568.256C213.676 568.273 213.833 568.282 213.98 568.29C215.693 568.455 217.406 568.594 219.12 568.742C219.39 568.767 219.668 568.785 219.937 568.803C224.624 569.185 229.32 569.507 234.017 569.794C234.46 569.82 234.895 569.846 235.338 569.872C243.859 570.367 252.381 570.723 260.913 571.011C268.304 571.254 275.696 571.455 283.088 571.628C290.454 571.811 297.81 571.984 305.176 572.159C330.542 572.759 355.916 573.342 381.292 573.924C388.509 574.089 395.736 574.263 402.962 574.429C405.737 574.49 408.502 574.558 411.275 574.62C412.562 574.646 413.849 574.681 415.136 574.715C431.658 575.115 448.198 575.662 464.746 576.124C466.477 576.176 468.216 576.219 469.956 576.263C470.26 576.271 470.556 576.281 470.861 576.289C472.687 576.333 474.521 576.384 476.349 576.42C492.618 576.828 508.888 577.08 525.15 576.977C528.933 576.959 532.715 576.915 536.498 576.855C537.837 576.829 539.177 576.803 540.516 576.768C558.299 576.36 576.212 575.125 593.814 572.246C597.144 571.707 600.466 571.107 603.77 570.428C604.075 570.377 604.387 570.315 604.691 570.245C606.013 569.977 607.335 569.698 608.648 569.402C621.474 566.559 634.048 562.689 646.196 557.481C674.841 545.201 701.251 525.662 717.607 498.748C727.007 483.27 732.129 465.851 735.155 448.093C737.685 433.266 739.259 418.206 740.347 403.153C740.373 402.815 740.399 402.475 740.425 402.137C740.711 398.128 740.964 394.11 741.19 390.102C743.467 350.274 743.258 309.551 732.598 270.993Z\"\n        fill=\"white\"\n      />\n    </mask>\n    <g mask=\"url(#mask2_531_12634)\">\n      <path\n        d=\"M661.109 370.958L657.883 391.707L212.4 441.978L213.695 419.49L661.109 370.958Z\"\n        fill=\"#AA8C68\"\n      />\n    </g>\n    <mask\n      id=\"mask3_531_12634\"\n      style={MASK_ALPHA_STYLE}\n      maskUnits=\"userSpaceOnUse\"\n      x=\"0\"\n      y=\"0\"\n      width=\"743\"\n      height=\"577\"\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M732.598 270.993C723.101 236.662 707.884 200.574 686.866 166.328C683.057 160.11 679.04 153.954 674.839 147.875C674.7 147.666 674.553 147.467 674.404 147.258C659.369 125.579 641.881 104.961 621.923 86.3865C620.428 84.9958 618.924 83.6215 617.402 82.2553C609.602 75.2375 601.436 68.5418 592.897 62.2201C592.445 61.8816 592.002 61.5499 591.548 61.2197C590.261 60.2711 588.966 59.3322 587.661 58.4027C583.122 55.1763 578.487 52.0455 573.747 49.0375C572.522 48.2541 571.287 47.4803 570.052 46.7242C569.608 46.4457 569.156 46.1673 568.703 45.8984C559.694 40.3847 550.329 35.2803 540.616 30.6373C540.556 30.6032 540.486 30.5759 540.424 30.5417C536.625 28.7238 532.772 26.9851 528.867 25.3159C523.58 23.0545 518.197 20.924 512.711 18.9328C506.823 16.7941 500.824 14.8193 494.701 13.0287C494.283 12.8976 493.866 12.7762 493.45 12.6547C478.658 8.36788 463.214 5.08964 447.091 2.94144C379.793 -6.0321 300.878 4.81941 210.161 45.2816C144.603 74.5251 72.7835 138.336 41 202.33C22.2955 239.984 6.11992 282.385 1.39908 325.169C1.39089 325.273 1.38134 325.378 1.3636 325.481C1.33767 325.672 1.31992 325.863 1.30218 326.046C0.615687 332.464 0.188506 338.89 0.0492962 345.308C-0.21138 357.43 0.552907 369.526 2.5537 381.501C4.45896 392.901 7.47516 404.188 11.7893 415.285C22.2941 442.33 39.5984 465.922 59.2256 487.113C63.4428 491.67 67.7651 496.114 72.1556 500.452C75.5827 503.844 79.0424 507.218 82.565 510.54C84.9916 512.843 87.4441 515.123 89.9308 517.366C90.9312 518.279 91.9398 519.184 92.9565 520.071C98.1564 524.672 103.495 529.106 109.027 533.298C110.018 534.054 111.018 534.794 112.019 535.533C112.305 535.742 112.592 535.951 112.88 536.16C113.367 536.516 113.863 536.864 114.358 537.204C120.914 541.847 127.759 545.926 134.872 549.447C135.22 549.621 135.576 549.795 135.933 549.951C137.228 550.586 138.533 551.194 139.846 551.785C144.689 553.959 149.646 555.881 154.725 557.542C154.985 557.638 155.238 557.725 155.498 557.794C157.802 558.551 160.133 559.247 162.49 559.891C164.673 560.482 166.864 561.039 169.064 561.56C171.969 562.246 174.883 562.873 177.813 563.447C182.161 564.299 186.543 565.031 190.935 565.673C192.292 565.874 193.657 566.065 195.023 566.238C199.928 566.891 204.849 567.43 209.771 567.908C210.606 567.985 211.45 568.073 212.293 568.142C212.466 568.16 212.641 568.176 212.814 568.186C212.962 568.204 213.101 568.22 213.25 568.23C213.345 568.238 213.433 568.247 213.528 568.256C213.676 568.273 213.833 568.282 213.98 568.29C215.693 568.455 217.406 568.594 219.12 568.742C219.39 568.767 219.668 568.785 219.937 568.803C224.624 569.185 229.32 569.507 234.017 569.794C234.46 569.82 234.895 569.846 235.338 569.872C243.859 570.367 252.381 570.723 260.913 571.011C268.304 571.254 275.696 571.455 283.088 571.628C290.454 571.811 297.81 571.984 305.176 572.159C330.542 572.759 355.916 573.342 381.292 573.924C388.509 574.089 395.736 574.263 402.962 574.429C405.737 574.49 408.502 574.558 411.275 574.62C412.562 574.646 413.849 574.681 415.136 574.715C431.658 575.115 448.198 575.662 464.746 576.124C466.477 576.176 468.216 576.219 469.956 576.263C470.26 576.271 470.556 576.281 470.861 576.289C472.687 576.333 474.521 576.384 476.349 576.42C492.618 576.828 508.888 577.08 525.15 576.977C528.933 576.959 532.715 576.915 536.498 576.855C537.837 576.829 539.177 576.803 540.516 576.768C558.299 576.36 576.212 575.125 593.814 572.246C597.144 571.707 600.466 571.107 603.77 570.428C604.075 570.377 604.387 570.315 604.691 570.245C606.013 569.977 607.335 569.698 608.648 569.402C621.474 566.559 634.048 562.689 646.196 557.481C674.841 545.201 701.251 525.662 717.607 498.748C727.007 483.27 732.129 465.851 735.155 448.093C737.685 433.266 739.259 418.206 740.347 403.153C740.373 402.815 740.399 402.475 740.425 402.137C740.711 398.128 740.964 394.11 741.19 390.102C743.467 350.274 743.258 309.551 732.598 270.993Z\"\n        fill=\"white\"\n      />\n    </mask>\n    <g mask=\"url(#mask3_531_12634)\">\n      <path\n        d=\"M661.296 370.999L213.419 421.369L97.5054 335.799L545.383 285.429L661.296 370.999Z\"\n        fill=\"#E5CBAC\"\n      />\n    </g>\n    <mask\n      id=\"mask4_531_12634\"\n      style={MASK_ALPHA_STYLE}\n      maskUnits=\"userSpaceOnUse\"\n      x=\"0\"\n      y=\"0\"\n      width=\"743\"\n      height=\"577\"\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M732.598 270.993C723.101 236.662 707.884 200.574 686.866 166.328C683.057 160.11 679.04 153.954 674.839 147.875C674.7 147.666 674.553 147.467 674.404 147.258C659.369 125.579 641.881 104.961 621.923 86.3865C620.428 84.9958 618.924 83.6215 617.402 82.2553C609.602 75.2375 601.436 68.5418 592.897 62.2201C592.445 61.8816 592.002 61.5499 591.548 61.2197C590.261 60.2711 588.966 59.3322 587.661 58.4027C583.122 55.1763 578.487 52.0455 573.747 49.0375C572.522 48.2541 571.287 47.4803 570.052 46.7242C569.608 46.4457 569.156 46.1673 568.703 45.8984C559.694 40.3847 550.329 35.2803 540.616 30.6373C540.556 30.6032 540.486 30.5759 540.424 30.5417C536.625 28.7238 532.772 26.9851 528.867 25.3159C523.58 23.0545 518.197 20.924 512.711 18.9328C506.823 16.7941 500.824 14.8193 494.701 13.0287C494.283 12.8976 493.866 12.7762 493.45 12.6547C478.658 8.36788 463.214 5.08964 447.091 2.94144C379.793 -6.0321 300.878 4.81941 210.161 45.2816C144.603 74.5251 72.7835 138.336 41 202.33C22.2955 239.984 6.11992 282.385 1.39908 325.169C1.39089 325.273 1.38134 325.378 1.3636 325.481C1.33767 325.672 1.31992 325.863 1.30218 326.046C0.615687 332.464 0.188506 338.89 0.0492962 345.308C-0.21138 357.43 0.552907 369.526 2.5537 381.501C4.45896 392.901 7.47516 404.188 11.7893 415.285C22.2941 442.33 39.5984 465.922 59.2256 487.113C63.4428 491.67 67.7651 496.114 72.1556 500.452C75.5827 503.844 79.0424 507.218 82.565 510.54C84.9916 512.843 87.4441 515.123 89.9308 517.366C90.9312 518.279 91.9398 519.184 92.9565 520.071C98.1564 524.672 103.495 529.106 109.027 533.298C110.018 534.054 111.018 534.794 112.019 535.533C112.305 535.742 112.592 535.951 112.88 536.16C113.367 536.516 113.863 536.864 114.358 537.204C120.914 541.847 127.759 545.926 134.872 549.447C135.22 549.621 135.576 549.795 135.933 549.951C137.228 550.586 138.533 551.194 139.846 551.785C144.689 553.959 149.646 555.881 154.725 557.542C154.985 557.638 155.238 557.725 155.498 557.794C157.802 558.551 160.133 559.247 162.49 559.891C164.673 560.482 166.864 561.039 169.064 561.56C171.969 562.246 174.883 562.873 177.813 563.447C182.161 564.299 186.543 565.031 190.935 565.673C192.292 565.874 193.657 566.065 195.023 566.238C199.928 566.891 204.849 567.43 209.771 567.908C210.606 567.985 211.45 568.073 212.293 568.142C212.466 568.16 212.641 568.176 212.814 568.186C212.962 568.204 213.101 568.22 213.25 568.23C213.345 568.238 213.433 568.247 213.528 568.256C213.676 568.273 213.833 568.282 213.98 568.29C215.693 568.455 217.406 568.594 219.12 568.742C219.39 568.767 219.668 568.785 219.937 568.803C224.624 569.185 229.32 569.507 234.017 569.794C234.46 569.82 234.895 569.846 235.338 569.872C243.859 570.367 252.381 570.723 260.913 571.011C268.304 571.254 275.696 571.455 283.088 571.628C290.454 571.811 297.81 571.984 305.176 572.159C330.542 572.759 355.916 573.342 381.292 573.924C388.509 574.089 395.736 574.263 402.962 574.429C405.737 574.49 408.502 574.558 411.275 574.62C412.562 574.646 413.849 574.681 415.136 574.715C431.658 575.115 448.198 575.662 464.746 576.124C466.477 576.176 468.216 576.219 469.956 576.263C470.26 576.271 470.556 576.281 470.861 576.289C472.687 576.333 474.521 576.384 476.349 576.42C492.618 576.828 508.888 577.08 525.15 576.977C528.933 576.959 532.715 576.915 536.498 576.855C537.837 576.829 539.177 576.803 540.516 576.768C558.299 576.36 576.212 575.125 593.814 572.246C597.144 571.707 600.466 571.107 603.77 570.428C604.075 570.377 604.387 570.315 604.691 570.245C606.013 569.977 607.335 569.698 608.648 569.402C621.474 566.559 634.048 562.689 646.196 557.481C674.841 545.201 701.251 525.662 717.607 498.748C727.007 483.27 732.129 465.851 735.155 448.093C737.685 433.266 739.259 418.206 740.347 403.153C740.373 402.815 740.399 402.475 740.425 402.137C740.711 398.128 740.964 394.11 741.19 390.102C743.467 350.274 743.258 309.551 732.598 270.993Z\"\n        fill=\"white\"\n      />\n    </mask>\n    <g mask=\"url(#mask4_531_12634)\">\n      <path\n        d=\"M436.903 365.615L278.411 383.44L237.392 353.158L395.884 335.334L436.903 365.615Z\"\n        fill=\"#2B1919\"\n      />\n    </g>\n    <mask\n      id=\"mask5_531_12634\"\n      style={MASK_ALPHA_STYLE}\n      maskUnits=\"userSpaceOnUse\"\n      x=\"0\"\n      y=\"0\"\n      width=\"743\"\n      height=\"577\"\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M732.598 270.993C723.101 236.662 707.884 200.574 686.866 166.328C683.057 160.11 679.04 153.954 674.839 147.875C674.7 147.666 674.553 147.467 674.404 147.258C659.369 125.579 641.881 104.961 621.923 86.3865C620.428 84.9958 618.924 83.6215 617.402 82.2553C609.602 75.2375 601.436 68.5418 592.897 62.2201C592.445 61.8816 592.002 61.5499 591.548 61.2197C590.261 60.2711 588.966 59.3322 587.661 58.4027C583.122 55.1763 578.487 52.0455 573.747 49.0375C572.522 48.2541 571.287 47.4803 570.052 46.7242C569.608 46.4457 569.156 46.1673 568.703 45.8984C559.694 40.3847 550.329 35.2803 540.616 30.6373C540.556 30.6032 540.486 30.5759 540.424 30.5417C536.625 28.7238 532.772 26.9851 528.867 25.3159C523.58 23.0545 518.197 20.924 512.711 18.9328C506.823 16.7941 500.824 14.8193 494.701 13.0287C494.283 12.8976 493.866 12.7762 493.45 12.6547C478.658 8.36788 463.214 5.08964 447.091 2.94144C379.793 -6.0321 300.878 4.81941 210.161 45.2816C144.603 74.5251 72.7835 138.336 41 202.33C22.2955 239.984 6.11992 282.385 1.39908 325.169C1.39089 325.273 1.38134 325.378 1.3636 325.481C1.33767 325.672 1.31992 325.863 1.30218 326.046C0.615687 332.464 0.188506 338.89 0.0492962 345.308C-0.21138 357.43 0.552907 369.526 2.5537 381.501C4.45896 392.901 7.47516 404.188 11.7893 415.285C22.2941 442.33 39.5984 465.922 59.2256 487.113C63.4428 491.67 67.7651 496.114 72.1556 500.452C75.5827 503.844 79.0424 507.218 82.565 510.54C84.9916 512.843 87.4441 515.123 89.9308 517.366C90.9312 518.279 91.9398 519.184 92.9565 520.071C98.1564 524.672 103.495 529.106 109.027 533.298C110.018 534.054 111.018 534.794 112.019 535.533C112.305 535.742 112.592 535.951 112.88 536.16C113.367 536.516 113.863 536.864 114.358 537.204C120.914 541.847 127.759 545.926 134.872 549.447C135.22 549.621 135.576 549.795 135.933 549.951C137.228 550.586 138.533 551.194 139.846 551.785C144.689 553.959 149.646 555.881 154.725 557.542C154.985 557.638 155.238 557.725 155.498 557.794C157.802 558.551 160.133 559.247 162.49 559.891C164.673 560.482 166.864 561.039 169.064 561.56C171.969 562.246 174.883 562.873 177.813 563.447C182.161 564.299 186.543 565.031 190.935 565.673C192.292 565.874 193.657 566.065 195.023 566.238C199.928 566.891 204.849 567.43 209.771 567.908C210.606 567.985 211.45 568.073 212.293 568.142C212.466 568.16 212.641 568.176 212.814 568.186C212.962 568.204 213.101 568.22 213.25 568.23C213.345 568.238 213.433 568.247 213.528 568.256C213.676 568.273 213.833 568.282 213.98 568.29C215.693 568.455 217.406 568.594 219.12 568.742C219.39 568.767 219.668 568.785 219.937 568.803C224.624 569.185 229.32 569.507 234.017 569.794C234.46 569.82 234.895 569.846 235.338 569.872C243.859 570.367 252.381 570.723 260.913 571.011C268.304 571.254 275.696 571.455 283.088 571.628C290.454 571.811 297.81 571.984 305.176 572.159C330.542 572.759 355.916 573.342 381.292 573.924C388.509 574.089 395.736 574.263 402.962 574.429C405.737 574.49 408.502 574.558 411.275 574.62C412.562 574.646 413.849 574.681 415.136 574.715C431.658 575.115 448.198 575.662 464.746 576.124C466.477 576.176 468.216 576.219 469.956 576.263C470.26 576.271 470.556 576.281 470.861 576.289C472.687 576.333 474.521 576.384 476.349 576.42C492.618 576.828 508.888 577.08 525.15 576.977C528.933 576.959 532.715 576.915 536.498 576.855C537.837 576.829 539.177 576.803 540.516 576.768C558.299 576.36 576.212 575.125 593.814 572.246C597.144 571.707 600.466 571.107 603.77 570.428C604.075 570.377 604.387 570.315 604.691 570.245C606.013 569.977 607.335 569.698 608.648 569.402C621.474 566.559 634.048 562.689 646.196 557.481C674.841 545.201 701.251 525.662 717.607 498.748C727.007 483.27 732.129 465.851 735.155 448.093C737.685 433.266 739.259 418.206 740.347 403.153C740.373 402.815 740.399 402.475 740.425 402.137C740.711 398.128 740.964 394.11 741.19 390.102C743.467 350.274 743.258 309.551 732.598 270.993Z\"\n        fill=\"white\"\n      />\n    </mask>\n    <g mask=\"url(#mask5_531_12634)\">\n      <path\n        d=\"M335.447 324.896L285.554 330.501L265.29 316.912L307.645 312.303L335.447 324.896Z\"\n        fill=\"#2B1919\"\n      />\n      <path\n        d=\"M477.371 254.682C477.607 257.14 475.823 259.343 473.356 259.607L160.743 296.347L159.833 296.447L151.913 297.312C149.4 297.585 147.153 295.755 146.915 293.243L129.473 110.279C129.237 107.811 131.03 105.608 133.487 105.345L141.935 104.425L142.845 104.325L454.939 70.3706C457.442 70.0977 459.691 71.9279 459.927 74.4391L477.371 254.682Z\"\n        fill=\"#2B1919\"\n      />\n      <path\n        d=\"M472.463 249.903C472.672 252.143 471.052 254.154 468.804 254.39L177.238 288.864L176.41 288.955L169.2 289.739C166.915 289.984 164.866 288.318 164.658 286.033L159.65 234.991L157.902 217.149L148.68 123.205L147.678 112.955C147.46 110.715 149.089 108.704 151.329 108.468L159.021 107.63L159.849 107.538L450.944 75.8503C453.219 75.5951 455.268 77.2615 455.486 79.5557L456.524 89.9705L465.855 183.632L467.658 201.72L472.463 249.903Z\"\n        fill=\"white\"\n      />\n      <path\n        d=\"M160.743 296.348L159.833 296.448L141.936 104.425L142.847 104.325L160.743 296.348Z\"\n        fill=\"#87423A\"\n      />\n      <path\n        d=\"M307.645 312.303V277.636L263.462 281.764L265.29 316.912\"\n        fill=\"#2B1919\"\n      />\n    </g>\n    <mask\n      id=\"mask6_531_12634\"\n      style={MASK_ALPHA_STYLE}\n      maskUnits=\"userSpaceOnUse\"\n      x=\"0\"\n      y=\"0\"\n      width=\"743\"\n      height=\"577\"\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M732.598 270.993C723.101 236.662 707.884 200.574 686.866 166.328C683.057 160.11 679.04 153.954 674.839 147.875C674.7 147.666 674.553 147.467 674.404 147.258C659.369 125.579 641.881 104.961 621.923 86.3865C620.428 84.9958 618.924 83.6215 617.402 82.2553C609.602 75.2375 601.436 68.5418 592.897 62.2201C592.445 61.8816 592.002 61.5499 591.548 61.2197C590.261 60.2711 588.966 59.3322 587.661 58.4027C583.122 55.1763 578.487 52.0455 573.747 49.0375C572.522 48.2541 571.287 47.4803 570.052 46.7242C569.608 46.4457 569.156 46.1673 568.703 45.8984C559.694 40.3847 550.329 35.2803 540.616 30.6373C540.556 30.6032 540.486 30.5759 540.424 30.5417C536.625 28.7238 532.772 26.9851 528.867 25.3159C523.58 23.0545 518.197 20.924 512.711 18.9328C506.823 16.7941 500.824 14.8193 494.701 13.0287C494.283 12.8976 493.866 12.7762 493.45 12.6547C478.658 8.36788 463.214 5.08964 447.091 2.94144C379.793 -6.0321 300.878 4.81941 210.161 45.2816C144.603 74.5251 72.7835 138.336 41 202.33C22.2955 239.984 6.11992 282.385 1.39908 325.169C1.39089 325.273 1.38134 325.378 1.3636 325.481C1.33767 325.672 1.31992 325.863 1.30218 326.046C0.615687 332.464 0.188506 338.89 0.0492962 345.308C-0.21138 357.43 0.552907 369.526 2.5537 381.501C4.45896 392.901 7.47516 404.188 11.7893 415.285C22.2941 442.33 39.5984 465.922 59.2256 487.113C63.4428 491.67 67.7651 496.114 72.1556 500.452C75.5827 503.844 79.0424 507.218 82.565 510.54C84.9916 512.843 87.4441 515.123 89.9308 517.366C90.9312 518.279 91.9398 519.184 92.9565 520.071C98.1564 524.672 103.495 529.106 109.027 533.298C110.018 534.054 111.018 534.794 112.019 535.533C112.305 535.742 112.592 535.951 112.88 536.16C113.367 536.516 113.863 536.864 114.358 537.204C120.914 541.847 127.759 545.926 134.872 549.447C135.22 549.621 135.576 549.795 135.933 549.951C137.228 550.586 138.533 551.194 139.846 551.785C144.689 553.959 149.646 555.881 154.725 557.542C154.985 557.638 155.238 557.725 155.498 557.794C157.802 558.551 160.133 559.247 162.49 559.891C164.673 560.482 166.864 561.039 169.064 561.56C171.969 562.246 174.883 562.873 177.813 563.447C182.161 564.299 186.543 565.031 190.935 565.673C192.292 565.874 193.657 566.065 195.023 566.238C199.928 566.891 204.849 567.43 209.771 567.908C210.606 567.985 211.45 568.073 212.293 568.142C212.466 568.16 212.641 568.176 212.814 568.186C212.962 568.204 213.101 568.22 213.25 568.23C213.345 568.238 213.433 568.247 213.528 568.256C213.676 568.273 213.833 568.282 213.98 568.29C215.693 568.455 217.406 568.594 219.12 568.742C219.39 568.767 219.668 568.785 219.937 568.803C224.624 569.185 229.32 569.507 234.017 569.794C234.46 569.82 234.895 569.846 235.338 569.872C243.859 570.367 252.381 570.723 260.913 571.011C268.304 571.254 275.696 571.455 283.088 571.628C290.454 571.811 297.81 571.984 305.176 572.159C330.542 572.759 355.916 573.342 381.292 573.924C388.509 574.089 395.736 574.263 402.962 574.429C405.737 574.49 408.502 574.558 411.275 574.62C412.562 574.646 413.849 574.681 415.136 574.715C431.658 575.115 448.198 575.662 464.746 576.124C466.477 576.176 468.216 576.219 469.956 576.263C470.26 576.271 470.556 576.281 470.861 576.289C472.687 576.333 474.521 576.384 476.349 576.42C492.618 576.828 508.888 577.08 525.15 576.977C528.933 576.959 532.715 576.915 536.498 576.855C537.837 576.829 539.177 576.803 540.516 576.768C558.299 576.36 576.212 575.125 593.814 572.246C597.144 571.707 600.466 571.107 603.77 570.428C604.075 570.377 604.387 570.315 604.691 570.245C606.013 569.977 607.335 569.698 608.648 569.402C621.474 566.559 634.048 562.689 646.196 557.481C674.841 545.201 701.251 525.662 717.607 498.748C727.007 483.27 732.129 465.851 735.155 448.093C737.685 433.266 739.259 418.206 740.347 403.153C740.373 402.815 740.399 402.475 740.425 402.137C740.711 398.128 740.964 394.11 741.19 390.102C743.467 350.274 743.258 309.551 732.598 270.993Z\"\n        fill=\"white\"\n      />\n    </mask>\n    <g mask=\"url(#mask6_531_12634)\">\n      <path\n        d=\"M388.665 342.96L387.345 343.106L374.791 344.508L373.462 344.654L362.121 345.919L360.791 346.075L349.221 347.367L347.891 347.512L336.632 348.769L335.312 348.915L287.128 354.303L285.808 354.449L273.219 355.851L271.898 355.997L260.356 357.289L259.027 357.435L257.952 356.634L259.282 356.488L270.824 355.196L272.145 355.05L284.734 353.648L286.054 353.494L334.228 348.114L335.558 347.968L346.817 346.711L348.146 346.566L359.717 345.274L361.047 345.118L372.388 343.853L373.717 343.707L386.261 342.305L387.59 342.159L388.665 342.96Z\"\n        fill=\"#87423A\"\n      />\n      <path\n        d=\"M397.021 349.188L395.684 349.333L268.703 363.515L267.374 363.662L266.3 362.86L267.629 362.714L394.61 348.531L395.947 348.387L396.411 348.732L397.021 349.188Z\"\n        fill=\"#87423A\"\n      />\n      <path\n        d=\"M404.732 354.94L403.403 355.087L276.422 369.26L275.085 369.414L274.011 368.613L275.34 368.459L402.329 354.285L403.649 354.131L404.405 354.695L404.732 354.94Z\"\n        fill=\"#87423A\"\n      />\n      <path\n        d=\"M412.715 360.894L411.395 361.04L398.842 362.441L397.514 362.587L386.181 363.853H386.171L384.851 364.007L373.271 365.301L371.943 365.445L360.682 366.702L359.362 366.847L311.188 372.227H311.178L309.858 372.383L297.27 373.784L295.95 373.93L284.406 375.223L283.077 375.369L282.003 374.568L283.332 374.422L294.876 373.129L296.195 372.983L308.784 371.581L310.104 371.426H310.114L358.288 366.047L359.608 365.901L370.869 364.644L372.197 364.5L383.777 363.206L385.097 363.051L396.438 361.786L397.768 361.64L410.312 360.239L411.641 360.093L412.715 360.894Z\"\n        fill=\"#87423A\"\n      />\n      <path\n        d=\"M284.406 375.223L283.077 375.369L282.003 374.568L275.085 369.414L274.011 368.613L267.374 363.662L266.3 362.86L259.027 357.435L257.952 356.634L259.282 356.488L260.356 357.289L267.629 362.714L268.703 363.515L275.34 368.459L276.422 369.26L283.332 374.422L284.406 375.223Z\"\n        fill=\"#87423A\"\n      />\n      <path\n        d=\"M297.27 373.784L295.95 373.93L294.876 373.129L293.391 372.028L292.317 371.227L287.948 367.977L286.874 367.176L285.399 366.074L284.324 365.273L280.246 362.223L279.172 361.422L277.689 360.321L276.613 359.519L271.898 355.997L270.824 355.196L272.145 355.05L273.219 355.851L277.943 359.373L279.017 360.174L280.502 361.276L281.576 362.077L285.654 365.118L286.736 365.919L288.211 367.02L289.286 367.821L293.646 371.081L294.72 371.882L296.195 372.983L297.27 373.784Z\"\n        fill=\"#87423A\"\n      />\n      <path\n        d=\"M311.178 372.227L309.858 372.383L308.784 371.581L306.135 369.605L305.061 368.805L301.857 366.42L300.783 365.619L298.143 363.652L297.069 362.851L294.147 360.675L293.073 359.874L290.432 357.899L289.359 357.098L285.808 354.449L284.734 353.648L286.054 353.494L287.128 354.303L290.687 356.952L291.761 357.753L294.41 359.72L295.484 360.521L298.398 362.697L299.48 363.498L302.121 365.473L303.195 366.274L306.39 368.659L307.465 369.461L310.104 371.426H310.114L311.178 372.227Z\"\n        fill=\"#87423A\"\n      />\n      <path\n        d=\"M360.682 366.702L359.362 366.847L358.288 366.047L351.651 361.104L351.369 360.894L350.577 360.303L350.295 360.093L343.659 355.151L343.649 355.141L342.585 354.35L342.575 354.34L335.948 349.397L335.312 348.915L334.874 348.596L334.228 348.114L335.558 347.968L336.203 348.449L336.632 348.769L337.277 349.251L343.914 354.194L344.996 354.995L351.624 359.948L351.906 360.157L352.698 360.749L352.981 360.958L359.608 365.901L360.682 366.702Z\"\n        fill=\"#87423A\"\n      />\n      <path\n        d=\"M373.271 365.301L371.943 365.445L370.869 364.644L364.706 360.048L363.959 359.492L363.631 359.246L362.885 358.691L356.713 354.094L356.24 353.739L355.639 353.293L355.166 352.938L349.002 348.34L347.928 347.539L347.891 347.512L346.817 346.711L348.146 346.566L349.221 347.367L349.257 347.395L350.331 348.196L356.495 352.792L356.967 353.138L357.569 353.593H357.577L358.051 353.939L364.214 358.537L364.961 359.1L365.279 359.338H365.288L366.035 359.902L372.197 364.5L373.271 365.301Z\"\n        fill=\"#87423A\"\n      />\n      <path\n        d=\"M386.171 363.853L384.851 364.007L383.777 363.206L377.904 358.827L376.867 358.045H376.858L376.83 358.026L375.793 357.244H375.784L369.912 352.874L369.138 352.301L368.838 352.073L368.064 351.5L362.202 347.122L361.128 346.32L360.791 346.075L359.717 345.274L361.047 345.118L362.121 345.919L362.456 346.174L363.532 346.976L369.403 351.346L370.167 351.919L370.477 352.145L371.251 352.72L377.113 357.098L378.16 357.882L378.187 357.899L379.234 358.683L385.097 363.051L386.171 363.853Z\"\n        fill=\"#87423A\"\n      />\n      <path\n        d=\"M398.842 362.441L397.514 362.587L396.438 361.786L391.251 357.917L390.177 357.116L389.53 356.634L388.456 355.833L383.257 351.964L382.183 351.163L381.811 350.88L380.736 350.079L375.547 346.211L374.473 345.41L373.462 344.654L372.388 343.853L373.717 343.707L374.791 344.508L375.803 345.264L376.877 346.065L382.066 349.934L383.148 350.736L383.512 351.008L384.596 351.81L389.785 355.687L390.859 356.488L391.505 356.971L392.579 357.771L397.768 361.64L398.842 362.441Z\"\n        fill=\"#87423A\"\n      />\n      <path\n        d=\"M412.715 360.894L411.395 361.04L410.312 360.239L404.15 355.642L403.403 355.087L403.075 354.841L402.329 354.285L396.157 349.689L395.684 349.333L395.083 348.888L394.61 348.531L388.446 343.935L387.372 343.134L387.345 343.106L386.261 342.305L387.59 342.159L388.665 342.96L388.701 342.988L389.776 343.789L395.947 348.387L396.411 348.732L397.021 349.188L397.495 349.533L403.649 354.131L404.405 354.695L404.732 354.94L405.479 355.496L411.641 360.093L412.715 360.894Z\"\n        fill=\"#87423A\"\n      />\n    </g>\n    <mask\n      id=\"mask7_531_12634\"\n      style={MASK_ALPHA_STYLE}\n      maskUnits=\"userSpaceOnUse\"\n      x=\"0\"\n      y=\"0\"\n      width=\"743\"\n      height=\"577\"\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M732.598 270.993C723.101 236.662 707.884 200.574 686.866 166.328C683.057 160.11 679.04 153.954 674.839 147.875C674.7 147.666 674.553 147.467 674.404 147.258C659.369 125.579 641.881 104.961 621.923 86.3865C620.428 84.9958 618.924 83.6215 617.402 82.2553C609.602 75.2375 601.436 68.5418 592.897 62.2201C592.445 61.8816 592.002 61.5499 591.548 61.2197C590.261 60.2711 588.966 59.3322 587.661 58.4027C583.122 55.1763 578.487 52.0455 573.747 49.0375C572.522 48.2541 571.287 47.4803 570.052 46.7242C569.608 46.4457 569.156 46.1673 568.703 45.8984C559.694 40.3847 550.329 35.2803 540.616 30.6373C540.556 30.6032 540.486 30.5759 540.424 30.5417C536.625 28.7238 532.772 26.9851 528.867 25.3159C523.58 23.0545 518.197 20.924 512.711 18.9328C506.823 16.7941 500.824 14.8193 494.701 13.0287C494.283 12.8976 493.866 12.7762 493.45 12.6547C478.658 8.36788 463.214 5.08964 447.091 2.94144C379.793 -6.0321 300.878 4.81941 210.161 45.2816C144.603 74.5251 72.7835 138.336 41 202.33C22.2955 239.984 6.11992 282.385 1.39908 325.169C1.39089 325.273 1.38134 325.378 1.3636 325.481C1.33767 325.672 1.31992 325.863 1.30218 326.046C0.615687 332.464 0.188506 338.89 0.0492962 345.308C-0.21138 357.43 0.552907 369.526 2.5537 381.501C4.45896 392.901 7.47516 404.188 11.7893 415.285C22.2941 442.33 39.5984 465.922 59.2256 487.113C63.4428 491.67 67.7651 496.114 72.1556 500.452C75.5827 503.844 79.0424 507.218 82.565 510.54C84.9916 512.843 87.4441 515.123 89.9308 517.366C90.9312 518.279 91.9398 519.184 92.9565 520.071C98.1564 524.672 103.495 529.106 109.027 533.298C110.018 534.054 111.018 534.794 112.019 535.533C112.305 535.742 112.592 535.951 112.88 536.16C113.367 536.516 113.863 536.864 114.358 537.204C120.914 541.847 127.759 545.926 134.872 549.447C135.22 549.621 135.576 549.795 135.933 549.951C137.228 550.586 138.533 551.194 139.846 551.785C144.689 553.959 149.646 555.881 154.725 557.542C154.985 557.638 155.238 557.725 155.498 557.794C157.802 558.551 160.133 559.247 162.49 559.891C164.673 560.482 166.864 561.039 169.064 561.56C171.969 562.246 174.883 562.873 177.813 563.447C182.161 564.299 186.543 565.031 190.935 565.673C192.292 565.874 193.657 566.065 195.023 566.238C199.928 566.891 204.849 567.43 209.771 567.908C210.606 567.985 211.45 568.073 212.293 568.142C212.466 568.16 212.641 568.176 212.814 568.186C212.962 568.204 213.101 568.22 213.25 568.23C213.345 568.238 213.433 568.247 213.528 568.256C213.676 568.273 213.833 568.282 213.98 568.29C215.693 568.455 217.406 568.594 219.12 568.742C219.39 568.767 219.668 568.785 219.937 568.803C224.624 569.185 229.32 569.507 234.017 569.794C234.46 569.82 234.895 569.846 235.338 569.872C243.859 570.367 252.381 570.723 260.913 571.011C268.304 571.254 275.696 571.455 283.088 571.628C290.454 571.811 297.81 571.984 305.176 572.159C330.542 572.759 355.916 573.342 381.292 573.924C388.509 574.089 395.736 574.263 402.962 574.429C405.737 574.49 408.502 574.558 411.275 574.62C412.562 574.646 413.849 574.681 415.136 574.715C431.658 575.115 448.198 575.662 464.746 576.124C466.477 576.176 468.216 576.219 469.956 576.263C470.26 576.271 470.556 576.281 470.861 576.289C472.687 576.333 474.521 576.384 476.349 576.42C492.618 576.828 508.888 577.08 525.15 576.977C528.933 576.959 532.715 576.915 536.498 576.855C537.837 576.829 539.177 576.803 540.516 576.768C558.299 576.36 576.212 575.125 593.814 572.246C597.144 571.707 600.466 571.107 603.77 570.428C604.075 570.377 604.387 570.315 604.691 570.245C606.013 569.977 607.335 569.698 608.648 569.402C621.474 566.559 634.048 562.689 646.196 557.481C674.841 545.201 701.251 525.662 717.607 498.748C727.007 483.27 732.129 465.851 735.155 448.093C737.685 433.266 739.259 418.206 740.347 403.153C740.373 402.815 740.399 402.475 740.425 402.137C740.711 398.128 740.964 394.11 741.19 390.102C743.467 350.274 743.258 309.551 732.598 270.993Z\"\n        fill=\"white\"\n      />\n    </mask>\n    <g mask=\"url(#mask7_531_12634)\">\n      <path\n        d=\"M615.561 463.318C614.013 465.649 612.525 467.883 611.143 469.987C611.107 472.51 608.909 546.993 607.482 597.805C606.17 598.101 604.847 598.379 603.526 598.648C603.222 598.718 602.909 598.779 602.605 598.831C599.3 599.509 595.979 600.11 592.647 600.649C592.074 589.814 592.472 551.086 591.977 541.912C591.438 531.851 590.968 523.12 590.603 516.433C590.585 516.12 590.567 515.816 590.559 515.52C590.428 513.181 590.316 511.112 590.22 509.345C590.012 505.371 589.881 502.919 589.855 502.363C588.794 503.972 587.446 506.015 585.846 508.442C584.194 510.929 582.281 513.807 580.141 517.033C579.915 517.364 579.69 517.704 579.463 518.05C574.254 525.85 567.811 535.511 560.654 546.207C554.296 555.738 531.949 589.586 524.871 600.196C523.532 600.23 522.194 600.257 520.853 600.283C520.253 600.292 519.644 600.301 519.045 600.309C518.679 600.317 518.323 600.317 517.967 600.327C515.14 600.362 512.323 600.397 509.505 600.405C514.844 591.022 535.626 558.112 540.835 548.964C546.314 539.329 551.627 529.998 556.558 521.346C556.749 521.008 556.94 520.676 557.123 520.346C560.323 514.728 563.349 509.415 566.15 504.502C575.803 487.588 582.759 475.414 584.602 472.265C585.115 472.048 585.628 471.83 586.149 471.622C591.359 469.5 596.75 467.831 602.228 466.405C602.654 466.292 603.08 466.188 603.507 466.075C604.524 465.822 605.542 465.57 606.568 465.327C606.864 465.257 607.177 465.179 607.481 465.11C610.089 464.493 612.707 463.926 615.342 463.361C615.412 463.352 615.491 463.335 615.561 463.318Z\"\n        fill=\"white\"\n      />\n      <path\n        d=\"M625.195 431.542L624.578 432.517L603.508 466.075L577.933 506.807L577.75 507.111L562.742 531.278L545.036 559.775L519.045 600.311C518.679 600.319 518.323 600.319 517.967 600.328L544.271 559.289L561.984 530.766L576.933 506.687L577.542 505.722L602.229 466.408L623.448 432.623L624.065 431.649L625.195 431.542Z\"\n        fill=\"#AD7D68\"\n      />\n      <path\n        d=\"M607.346 470.135L603.53 598.647C603.226 598.717 602.913 598.778 602.609 598.83L606.434 470.153C606.737 470.135 607.042 470.135 607.346 470.135Z\"\n        fill=\"#AD7D68\"\n      />\n      <path\n        d=\"M639.016 403.732C638.773 400.462 638.242 397.184 637.668 393.983C637.66 393.957 637.66 393.922 637.65 393.896C636.458 387.218 634.676 380.67 632.546 374.235C631.875 372.174 631.154 370.131 630.415 368.096C630.32 367.843 630.232 367.583 630.137 367.33C629.962 366.861 629.789 366.391 629.606 365.922C629.536 365.713 629.458 365.514 629.379 365.305C628.58 363.174 627.744 361.062 626.893 358.948C625.675 355.922 624.414 352.904 623.145 349.895L620.692 344.156C620.04 342.642 619.397 341.121 618.753 339.599C616.44 334.12 614.118 328.624 611.622 323.234C611.187 322.295 610.743 321.356 610.299 320.425C606.709 312.946 602.446 305.607 596.421 299.824C594.864 298.337 593.212 297.008 591.473 295.824C589.065 294.163 586.516 292.763 583.873 291.512C583.021 291.112 582.178 290.72 581.307 290.364C581.273 290.346 581.246 290.33 581.22 290.32C579.662 289.642 578.098 289.007 576.515 288.398C576.559 288.303 576.603 288.207 576.654 288.112C576.663 288.086 576.68 288.05 576.698 288.024C576.959 287.503 576.177 287.042 575.907 287.563C575.872 287.625 575.845 287.685 575.819 287.746C575.758 287.85 575.714 287.963 575.662 288.068C574.906 287.79 574.158 287.503 573.401 287.216C572.853 287.016 572.617 287.895 573.166 288.095C573.862 288.356 574.557 288.626 575.261 288.887C572.991 293.46 570.861 298.097 568.896 302.801C568.852 302.905 568.808 303.002 568.765 303.105C567.782 305.453 566.851 307.818 565.956 310.201C565.443 311.558 564.633 313.193 564.052 314.854C563.825 315.496 563.634 316.149 563.505 316.793C563.27 318.028 563.262 319.236 563.705 320.314C564.445 322.097 565.392 323.837 566.401 325.55C566.818 326.262 567.244 326.976 567.67 327.68C568.253 328.654 568.826 329.619 569.375 330.576C572.271 335.672 575.235 340.715 578.288 345.716C578.497 346.072 578.714 346.428 578.94 346.776C578.94 346.794 578.958 346.81 578.966 346.828C584.331 355.594 589.923 364.212 595.732 372.681C595.958 373.012 596.175 373.334 596.402 373.656C590.584 373.968 584.81 372.952 579.062 372.142C577.166 371.872 575.271 371.603 573.367 371.333C572.984 371.281 572.601 371.229 572.209 371.176C568.653 370.671 565.096 370.168 561.539 369.663C561.279 369.628 561.088 369.732 560.982 369.985C559.095 374.628 556.704 379.011 553.825 383.089C553.617 383.394 553.4 383.698 553.183 384.002C552.775 383.742 552.399 383.498 552.087 383.281C551.444 382.855 551.043 382.541 551.112 382.481C551.582 382.142 551.13 381.351 550.66 381.699C549.887 382.264 550.026 382.89 550.531 383.455C551.026 384.02 551.879 384.533 552.53 384.899C551.939 385.681 551.331 386.465 550.704 387.221C550.33 387.672 550.974 388.317 551.347 387.864C552.025 387.038 552.686 386.185 553.33 385.333C557.078 387.49 560.869 389.568 564.704 391.559C565.148 391.786 565.591 392.021 566.035 392.238C566.878 392.681 567.73 393.107 568.583 393.525C573.339 395.898 578.167 398.116 583.07 400.151C584.653 400.803 586.245 401.438 587.844 402.055C592.557 403.873 597.341 405.508 602.193 406.907C605.523 407.889 608.88 408.75 612.272 409.498C616.272 410.377 620.298 411.09 624.358 411.621C627.732 412.072 631.74 412.969 635.132 412.195C638.098 411.517 639.21 409.265 639.14 406.377C639.129 405.498 639.086 404.619 639.016 403.732Z\"\n        fill=\"#E68B60\"\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M593.571 510.405C595.928 511.335 597.633 512.996 598.11 515.684C598.617 518.565 598.498 521.694 598.382 524.743C598.333 526.039 598.284 527.32 598.284 528.562C598.284 529.335 598.29 530.11 598.296 530.885C598.31 532.54 598.323 534.196 598.276 535.848C598.232 537.161 598.119 538.492 597.319 539.562C596.101 541.188 593.989 541.649 591.98 541.91C591.657 541.949 591.339 541.983 591.028 542.017C590.576 542.066 590.14 542.114 589.728 542.17L560.658 546.205L540.839 548.961L535.266 549.735L508.03 553.519C505.929 553.81 503.827 554.117 501.724 554.423C494.93 555.412 488.122 556.404 481.289 556.928C479.898 557.032 478.506 557.109 477.124 557.145C475.142 557.198 473.159 557.188 471.194 557.093C470.889 557.093 470.585 557.077 470.289 557.059C468.358 556.955 466.436 556.78 464.514 556.537C461.68 556.189 458.853 555.694 456.019 555.05C449.005 553.459 442.072 551.42 435.151 549.386C433.869 549.009 432.587 548.632 431.305 548.259C430.957 548.151 430.611 548.05 430.263 547.95C430.08 547.896 429.897 547.843 429.713 547.789C426.374 546.816 423.044 545.842 419.704 544.859C410.391 542.12 401.087 539.329 391.782 536.528C389.886 535.963 387.982 535.39 386.086 534.815C386.017 534.955 385.895 535.058 385.695 535.05C383.268 534.972 380.65 534.702 378.494 533.407C373.793 530.595 376.109 525.327 378.035 520.947C378.51 519.867 378.961 518.841 379.277 517.919C379.459 517.385 379.64 516.844 379.822 516.3C380.978 512.845 382.18 509.251 384.051 506.171C384.168 505.967 384.3 505.765 384.432 505.562C384.447 505.539 384.462 505.516 384.477 505.493C385.53 503.892 386.782 502.457 388.33 501.284C393.7 497.212 400.693 497.661 406.992 498.066C407.313 498.087 407.631 498.107 407.948 498.127C416.94 498.684 425.94 498.449 434.923 497.866C439.036 497.604 443.142 497.283 447.246 496.961C448.28 496.878 449.313 496.793 450.347 496.709C457.584 496.118 464.821 495.526 472.065 495.169C472.369 495.152 472.673 495.134 472.978 495.126C473.107 495.116 473.246 495.108 473.386 495.108C475.725 494.996 478.064 494.909 480.403 494.865C483.254 494.795 486.116 494.778 488.977 494.83C506.639 495.142 524.231 497.177 541.675 500.029C542.465 500.159 543.256 500.29 544.048 500.429C551.44 501.655 558.797 503.039 566.154 504.499C566.537 504.575 566.92 504.652 567.304 504.729C567.764 504.821 568.224 504.914 568.684 505.004C573.023 505.873 577.363 506.761 581.693 507.674C582.739 507.888 583.807 508.077 584.887 508.268C585.207 508.325 585.527 508.382 585.849 508.439C587.319 508.701 588.789 508.978 590.223 509.344C591.371 509.631 592.493 509.969 593.571 510.405ZM379.234 532.745C380.451 533.111 381.66 533.475 382.868 533.841C381.599 533.668 380.33 533.345 379.234 532.745Z\"\n        fill=\"#C25A3E\"\n      />\n      <path\n        d=\"M262.077 535.455C261.598 535.268 261.097 535.077 260.604 534.904C256.137 533.221 252.201 531.851 251.298 531.519C251.797 530.737 252.319 529.961 252.814 529.171C253.251 528.469 251.528 528.238 251.074 528.944C250.663 529.617 250.176 530.288 249.747 530.965L248.399 530.482C247.693 530.211 246.974 529.953 246.251 529.685C246.106 529.569 245.965 529.505 245.837 529.472C246.173 529.175 246.18 528.728 245.492 528.637C245.35 528.618 245.208 528.597 245.066 528.578C244.64 528.52 244.239 528.66 243.965 528.878C243.832 528.975 243.7 529.072 243.569 529.169C243.352 529.341 243.368 529.565 243.476 529.733C244.238 530.879 246.938 531.53 248.993 532.146C246.348 536.252 242.208 541.839 237.358 548.018L237.362 548.028C228.013 559.989 216.127 574.191 207.886 584.205C218.342 582.179 228.765 580.076 239.185 577.92C252.511 566.225 267.778 551.406 273.734 545.216C275.243 543.637 276.163 542.623 276.282 542.356C276.759 541.287 269.069 538.104 262.077 535.455Z\"\n        fill=\"#E68B60\"\n      />\n      <path\n        d=\"M541.995 280.581C541.961 280.32 541.717 278.025 541.353 274.615C541.335 274.45 541.318 274.285 541.301 274.12C541.283 274.007 541.275 273.885 541.267 273.772C541.207 273.233 541.153 272.658 541.084 272.077C541.04 271.685 541.006 271.295 540.962 270.877C540.762 268.999 540.554 266.947 540.336 264.824C539.64 258.051 538.874 250.554 538.379 245.589C538.188 243.771 538.048 242.293 537.943 241.31C537.917 240.998 537.891 240.727 537.874 240.519C537.84 240.24 537.822 240.067 537.822 239.988C534.44 241.058 531.082 242.205 527.726 243.431C527.657 243.457 527.587 243.483 527.518 243.509C524.778 244.5 522.039 245.562 519.318 246.666C517.804 247.274 516.3 247.919 514.796 248.561C513.84 248.969 512.353 249.405 511.188 250.144C510.318 250.684 509.64 251.388 509.457 252.388C509.422 252.579 509.465 253.884 509.553 255.797C509.57 256.068 509.579 256.354 509.596 256.649C509.744 259.884 510.005 264.458 510.275 268.528C510.388 270.172 510.492 271.737 510.605 273.102C510.675 273.927 510.744 274.675 510.796 275.328C510.822 275.537 510.84 275.745 510.858 275.945C510.901 276.336 510.935 276.675 510.979 276.953C511.04 277.431 511.092 277.745 511.144 277.849C511.292 278.145 511.474 278.388 511.709 278.535C512.196 278.848 513.265 278.805 513.822 278.891C513.979 278.917 514.657 278.961 515.718 279.013C521.074 279.291 536.083 279.908 541.179 280.769C541.466 280.821 541.752 280.873 542.049 280.926C542.021 280.816 542.004 280.693 541.995 280.581Z\"\n        fill=\"#E68B60\"\n      />\n      <path\n        d=\"M545.822 219.282C545.552 220.826 545.244 222.386 544.872 223.942C544.823 224.167 544.773 224.402 544.715 224.626C544.415 225.885 544.07 227.15 543.688 228.414C543.54 228.926 543.374 229.436 543.207 229.955C542.944 230.743 542.671 231.529 542.38 232.297C542.002 233.325 541.589 234.34 541.14 235.335C541.035 235.566 540.931 235.806 540.818 236.037C540.109 237.583 539.322 239.079 538.439 240.505C538.156 240.981 537.856 241.456 537.547 241.913C536.142 244.03 534.488 246.006 532.585 247.703C532.345 247.908 532.114 248.114 531.867 248.309C531.388 248.71 530.902 249.084 530.399 249.438C527.302 251.613 523.767 252.835 520.131 253.757C516.254 254.748 512.31 255.481 508.335 255.948C507.978 255.991 507.601 256.034 507.224 256.076C503.58 256.506 499.614 256.973 496.064 256.223C489.767 254.889 485.781 248.999 485.1 242.878C484.806 240.181 485.025 237.467 485.45 234.801C485.476 234.657 485.494 234.512 485.521 234.367C485.551 234.16 485.581 233.961 485.62 233.763C485.635 233.663 485.659 233.555 485.674 233.456C485.756 232.977 485.848 232.499 485.939 232.021C486.74 227.882 487.66 223.749 488.633 219.637C488.993 218.107 489.365 216.569 489.76 215.051C489.9 214.53 490.029 214.009 490.169 213.497C490.622 211.799 491.091 210.112 491.588 208.427C491.745 207.916 491.902 207.396 492.068 206.886C493.567 202.038 495.315 197.27 497.448 192.659C498.168 191.087 498.907 189.46 499.935 188.06C500.182 187.719 500.456 187.387 500.739 187.076C501.982 185.742 503.578 184.794 505.224 184.049C508.98 182.311 513.112 181.618 517.239 181.843C517.403 181.853 517.488 181.958 517.499 182.086C520.699 181.284 523.996 182.292 526.906 183.717C533.302 186.863 539.884 191.013 543.291 197.481C546.812 204.167 547.097 211.97 545.822 219.282Z\"\n        fill=\"#E68B60\"\n      />\n      <path\n        d=\"M494.099 214.534C493.78 216.646 494.361 218.484 495.397 218.641C496.433 218.798 497.532 217.213 497.851 215.102C498.17 212.991 497.589 211.152 496.553 210.995C495.517 210.838 494.419 212.423 494.099 214.534Z\"\n        fill=\"#2B1919\"\n      />\n      <path\n        d=\"M492.42 212.969C492.898 212.63 492.289 211.952 491.82 212.29C491.681 212.394 491.542 212.491 491.394 212.595C491.247 212.482 491.082 212.499 490.942 212.595C490.795 212.69 490.69 212.881 490.725 213.082C490.542 213.213 490.36 213.352 490.178 213.474C490.108 213.526 490.031 213.577 489.961 213.631C488.604 214.596 487.257 215.561 485.927 216.561C484.718 217.466 483.466 218.465 482.77 219.821C482.709 219.917 482.657 220.012 482.613 220.118C482.526 220.309 482.456 220.492 482.404 220.665C481.387 223.822 484.561 225.3 487.021 226.682C487.029 226.682 487.029 226.69 487.039 226.69C487.831 227.134 488.726 227.908 489.569 227.333C490.518 226.716 490.891 224.055 491.178 223.011C491.935 220.246 493.231 216.15 491.875 213.359C492.063 213.239 492.246 213.1 492.42 212.969Z\"\n        fill=\"#E68B60\"\n      />\n      <path\n        d=\"M504.751 203.987C502.768 201.109 498.378 200.534 496.247 202.326C493.873 204.335 495.368 207.074 497.856 207.675C498.917 207.927 501.761 209.145 502.682 209.292C503.778 209.475 504.787 208.814 505.318 207.692C505.881 206.474 505.446 204.996 504.751 203.987Z\"\n        fill=\"#996048\"\n      />\n      <path\n        d=\"M493.593 233.538C492.399 234.983 490.822 235.431 488.981 235.417C488.023 235.417 486.96 235.375 486.028 235.076C485.822 235.009 485.636 234.916 485.45 234.806C485.476 234.661 485.494 234.516 485.521 234.372C485.551 234.164 485.581 233.965 485.62 233.767C485.99 233.998 486.379 234.202 486.837 234.31C488.817 234.77 491.436 234.728 492.827 233.038C493.201 232.585 493.965 233.085 493.593 233.538Z\"\n        fill=\"#C46A47\"\n      />\n      <path\n        d=\"M559.083 209.43C558.908 205.151 557.787 200.873 555.552 197.36C553.943 194.847 551.908 192.603 549.622 190.638C547.169 188.525 544.43 186.725 541.631 185.273C537.509 183.134 533.065 181.655 528.508 180.899C519.682 179.411 510.447 180.586 502.368 184.672C502.046 184.838 502.046 185.629 502.056 185.742C502.056 185.794 502.056 185.856 502.048 185.908C501.917 189.777 502.239 194.212 505.117 197.143C505.256 197.282 505.413 197.413 505.561 197.534C506.595 198.578 507.978 199.247 509.334 199.977C510.673 200.699 512.439 201.752 512.813 203.369C513.239 205.256 511.395 207.091 511.021 208.909C510.681 210.5 510.916 211.735 511.509 212.734C511.726 213.108 511.996 213.446 512.3 213.769C512.3 213.769 512.3 213.769 512.308 213.777C513.587 215.116 515.525 216.038 517.317 217.099C518.517 217.795 519.639 218.559 520.464 219.542C521.612 220.942 522.551 222.742 522.491 224.602C522.318 225.245 522.169 225.898 522.047 226.542C522.022 226.603 522.004 226.663 521.978 226.733C521.978 226.75 521.986 226.759 521.996 226.776C521.987 226.811 521.978 226.854 521.978 226.89C521.169 231.282 521.526 235.499 525.292 238.89C526.796 240.239 527.396 241.638 527.726 243.43C527.796 243.804 527.857 244.204 527.909 244.621C528.014 245.526 527.971 246.499 528.831 247.082C529.561 247.577 530.804 247.49 531.639 247.577C531.97 247.611 532.292 247.639 532.622 247.673C534.231 247.838 535.84 248.003 537.44 248.16C537.7 248.186 537.875 247.925 537.901 247.708C537.971 246.952 538.136 246.248 538.379 245.586C539.492 242.412 542.248 240.126 545.074 237.908C546.97 236.412 548.883 234.942 550.353 233.255C551.275 232.559 555.927 227.281 558.318 217.499C558.935 214.952 559.214 212.195 559.083 209.43Z\"\n        fill=\"#996048\"\n      />\n      <path\n        d=\"M524.638 219.831C524.586 219.553 524.516 219.274 524.421 219.005C524.248 218.5 523.985 218.031 523.621 217.615C523.613 217.597 523.595 217.589 523.586 217.571C523.194 217.119 522.724 216.797 522.203 216.596H522.195C521.508 216.318 520.743 216.248 519.959 216.336C519.959 216.328 519.951 216.336 519.951 216.336C519.394 216.388 518.829 216.519 518.29 216.702C518.238 216.71 518.195 216.727 518.151 216.745C517.855 216.849 517.586 216.972 517.316 217.101C516.351 217.563 515.507 218.171 514.925 218.832C514.803 218.971 514.847 219.119 514.942 219.224C513.369 221.493 510.411 225.902 513.464 227.833C514.029 228.189 514.646 228.433 515.282 228.573C515.96 228.738 516.657 228.781 517.369 228.729C517.9 228.695 518.421 228.608 518.934 228.469C519.995 228.182 521.021 227.677 521.848 227.008C521.856 227.008 521.856 227 521.856 227C521.9 226.966 521.944 226.939 521.978 226.897C522.213 226.714 522.43 226.514 522.63 226.296C524.055 224.744 525.038 222.091 524.638 219.831Z\"\n        fill=\"#E68B60\"\n      />\n      <path\n        d=\"M518.51 220.74C518.38 220.169 517.489 220.358 517.62 220.931C518.136 223.191 516.427 225.18 514.118 225.013C513.534 224.971 513.482 225.88 514.066 225.922C516.973 226.131 519.16 223.58 518.51 220.74Z\"\n        fill=\"#C46A47\"\n      />\n      <path\n        d=\"M579.989 194.038C578.867 190.35 576.136 187.35 572.788 185.516C572.127 185.142 571.431 184.82 570.727 184.551C566.162 182.786 561.075 183.23 556.675 185.273C554.075 186.482 551.449 188.299 549.623 190.638C548.344 192.255 547.457 194.133 547.223 196.221C547.205 196.422 547.3 196.552 547.44 196.613C545.892 200.005 549.1 203.04 551.778 204.926C554.092 206.551 556.526 208.135 559.083 209.43C561.179 210.49 563.361 211.361 565.639 211.908C569.144 212.744 574.404 213.239 577.005 210.126C577.301 209.778 577.526 209.386 577.683 208.978C578.3 207.421 577.988 205.569 576.77 204.5C576.667 204.405 576.562 204.317 576.448 204.24C576.526 204.196 576.613 204.152 576.691 204.1C580.118 202.1 581.145 197.856 579.989 194.038Z\"\n        fill=\"#996048\"\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M490.829 211.081C490.873 211.308 490.899 211.525 490.907 211.751C490.933 212.03 490.941 212.308 490.94 212.596C490.931 213.143 490.888 213.7 490.792 214.257C490.514 215.96 489.836 217.526 488.845 218.735C488.663 218.979 488.453 219.214 488.228 219.431C487.08 220.543 485.758 221.126 484.419 221.126C484.166 221.126 483.915 221.108 483.663 221.065C483.219 220.995 482.801 220.856 482.401 220.665C481.366 220.16 480.496 219.265 479.879 218.047C479.054 216.404 478.785 214.369 479.123 212.316C479.202 211.829 479.316 211.36 479.463 210.898C479.533 210.646 479.619 210.403 479.724 210.168C480.185 208.994 480.862 207.952 481.697 207.142C483.046 205.82 484.671 205.237 486.254 205.507C487.837 205.768 489.186 206.838 490.038 208.525C490.394 209.22 490.646 209.994 490.785 210.803C490.811 210.89 490.821 210.986 490.829 211.073V211.081ZM483.81 220.169C485.106 220.388 486.445 219.892 487.593 218.779C488.767 217.631 489.584 215.97 489.896 214.106C489.921 213.95 489.947 213.785 489.956 213.628C490.042 212.967 490.051 212.325 489.982 211.698C489.956 211.376 489.912 211.062 489.842 210.75C489.713 210.107 489.504 209.498 489.225 208.941C488.505 207.515 487.391 206.61 486.104 206.401C485.904 206.367 485.704 206.35 485.504 206.35C484.398 206.35 483.294 206.845 482.329 207.793C481.651 208.455 481.094 209.281 480.686 210.22C480.556 210.507 480.443 210.811 480.347 211.115C480.2 211.551 480.095 212.003 480.017 212.464C479.705 214.325 479.948 216.16 480.695 217.63C481.209 218.656 481.922 219.404 482.766 219.821C483.096 219.996 483.444 220.108 483.81 220.169Z\"\n        fill=\"white\"\n      />\n      <path\n        d=\"M524.478 218.334C519.255 213.662 511.87 212.577 505.143 211.885C496.732 211.018 488.241 210.707 479.804 210.174C479.219 210.137 479.221 211.047 479.804 211.084C487.378 211.563 494.966 211.936 502.528 212.555C509.742 213.148 518.195 213.932 523.835 218.978C524.269 219.367 524.916 218.725 524.478 218.334Z\"\n        fill=\"white\"\n      />\n      <path\n        d=\"M582.575 291.116C579.273 289.004 575.361 287.604 571.775 286.052C568.165 284.49 564.527 282.99 560.864 281.555C552.267 278.19 543.529 275.18 534.68 272.55C528.267 270.644 520.045 268.916 515.374 275.094C503.754 279.98 492.206 285.04 480.749 290.295C476.197 292.384 470.354 294.2 467.157 298.301C463.728 302.697 464.708 309.175 465.067 314.331C466.023 328.094 466.137 324.773 467.855 338.455L474.228 342.551L479.69 436.845C503.024 438.762 524.581 443.136 547.964 443.673C552.971 431.384 558.099 417.791 561.588 406.694C566.689 390.476 571.476 374.16 575.946 357.757C580.303 341.776 585.422 325.454 586.742 308.87C587.212 302.95 588.378 294.828 582.575 291.116Z\"\n        fill=\"#E68B60\"\n      />\n      <path\n        d=\"M500.29 316.39C499.116 313.982 497.942 311.564 496.767 309.156C493.959 303.391 491.15 297.616 488.341 291.851C487.88 290.895 487.41 289.938 486.949 288.981C486.941 288.973 486.941 288.973 486.931 288.963C488.654 288.285 490.401 287.659 492.175 287.085C492.732 286.903 492.487 286.025 491.932 286.207C486.219 288.05 480.818 290.442 475.662 293.276C472.67 294.911 469.766 296.702 466.94 298.607H466.93C460.887 302.677 455.182 307.294 449.738 312.217C442.895 318.399 436.45 325.079 430.233 331.757C425.399 336.948 420.633 342.192 415.764 347.332C415.268 347.853 414.772 348.384 414.276 348.905C413.051 350.201 411.824 351.497 410.589 352.784C409.363 354.053 408.128 355.306 406.867 356.532C406.65 356.749 406.431 356.967 406.206 357.175C404.772 358.565 403.302 359.906 401.788 361.193C401.476 361.463 401.162 361.724 400.84 361.984C400.727 362.08 400.615 362.167 400.492 362.263C397.822 364.401 394.882 366.219 391.552 367.114C387.934 368.089 384.135 368.002 380.457 367.497C378.465 367.236 374.03 366.618 368.465 365.836C367.3 365.671 366.092 365.496 364.839 365.322C362.466 364.984 359.952 364.618 357.387 364.244C356.761 364.157 356.134 364.061 355.5 363.974C350.935 363.304 346.264 362.609 341.969 361.947C340.796 361.756 339.656 361.582 338.552 361.408C337.613 361.251 336.708 361.104 335.83 360.965C330.979 360.173 327.082 359.487 325.083 359.008C323.996 358.755 324.369 357.947 324.995 357.225C325.343 356.817 325.779 356.434 326.073 356.181C326.187 356.094 326.282 356.024 326.344 355.972C326.284 356.016 326.179 356.086 326.039 356.189C325.97 356.233 325.892 356.293 325.805 356.354C325.431 356.615 325.083 356.919 324.752 357.25C323.875 358.111 323.109 359.154 322.318 360.041C321.283 361.214 320.239 362.388 319.204 363.563C318.9 363.903 318.604 364.242 318.3 364.58C318.169 364.727 318.039 364.876 317.908 365.024C317.717 365.25 317.743 365.58 318.003 365.746C320.203 367.12 322.412 368.477 324.647 369.798C325.091 370.058 325.526 370.319 325.968 370.572C327.403 371.423 328.839 372.25 330.281 373.068C332.551 374.355 334.829 375.616 337.124 376.833C345.316 381.233 353.708 385.268 362.264 388.921C369.707 392.104 377.282 395 384.943 397.6C389.239 399.06 393.63 400.512 398.004 400.609C399.726 400.653 401.439 400.488 403.152 400.027C404.178 399.756 405.204 399.374 406.221 398.879C409.491 397.279 412.326 394.914 415.187 392.696C418.761 389.931 422.326 387.166 425.9 384.391C427.595 383.079 429.292 381.766 430.987 380.443C436.431 376.226 441.874 372.009 447.318 367.782C456.371 360.764 465.414 353.746 474.467 346.738C474.884 346.408 475.302 346.095 475.718 345.773C475.718 345.773 475.726 345.773 475.726 345.765C476.188 345.399 476.657 345.035 477.118 344.679C481.467 341.313 485.805 337.939 490.154 334.574C492.179 333 494.197 331.435 496.223 329.869C498.013 328.478 500.213 327.174 501.701 325.451C504.159 322.581 501.655 319.181 500.29 316.39Z\"\n        fill=\"#E68B60\"\n      />\n      <path\n        d=\"M635.616 362.948C634.712 361.122 633.808 359.296 632.895 357.469C632.4 356.479 631.904 355.486 631.409 354.487C629.948 351.548 628.469 348.6 626.973 345.661C622.321 336.521 617.503 327.444 612.225 318.67C609.104 313.47 605.826 308.382 602.321 303.443C599.634 299.651 596.668 296.017 592.93 293.208C592.329 292.747 591.703 292.313 591.068 291.903C589.737 291.034 588.347 290.278 586.92 289.572C584.66 288.442 582.312 287.485 579.972 286.563C571.91 283.406 563.772 280.301 555.424 277.936C552.667 277.154 549.893 276.458 547.093 275.867C545.641 275.571 544.179 275.292 542.701 275.049C542.693 275.049 542.675 275.049 542.666 275.041C542.395 274.997 542.135 274.954 541.866 274.91L541.848 274.779L540.77 265.275C540.744 265.022 540.596 264.857 540.334 264.823C540.326 264.823 540.326 264.823 540.317 264.823C530.116 263.64 519.856 264.918 510.272 268.527C509.759 268.728 509.246 268.927 508.733 269.136C508.541 269.213 508.41 269.362 508.41 269.579C508.376 272.022 508.359 274.457 508.341 276.901C498.497 279.997 488.801 283.537 479.288 287.536C474.367 289.605 469.358 291.667 464.819 294.492C464.731 294.544 464.636 294.596 464.55 294.657C460.307 297.335 456.567 300.71 453.045 304.249C450.331 306.98 447.654 309.745 445.001 312.528C439.757 318.006 434.601 323.564 429.374 329.05C425.226 333.407 421.069 337.773 416.921 342.129C415.304 343.824 413.573 345.477 411.982 347.216C411.538 347.693 411.113 348.172 410.703 348.668C409.808 349.728 409.424 350.494 410.06 351.799C410.226 352.129 410.4 352.459 410.591 352.781C411.966 355.121 414.027 357.329 415.574 359.469C417.496 362.104 419.409 364.748 421.339 367.364C421.339 367.372 421.347 367.372 421.347 367.382C424.538 371.756 427.756 376.113 430.991 380.443C431.826 381.583 432.678 382.713 433.521 383.843C433.66 384.026 433.929 384.173 434.156 384.008C443 377.591 451.722 370.999 460.322 364.233C463.869 361.451 467.391 358.616 470.896 355.763C472.748 367.772 474.262 379.825 475.418 391.903C475.661 394.364 475.879 396.834 476.087 399.303C476.452 403.572 476.765 407.843 477.035 412.112C477.131 413.669 477.218 415.225 477.305 416.782C477.436 419 477.54 421.208 477.644 423.418C477.757 425.819 477.383 429.166 478.853 431.271C479.018 431.506 479.201 431.706 479.4 431.88C480.6 432.924 482.418 432.94 484.105 432.888C484.783 432.87 485.435 432.844 486.018 432.862C494.176 433.115 502.314 433.932 510.366 435.245C510.018 435.689 509.67 436.14 509.366 436.62C509.036 437.115 509.827 437.576 510.148 437.089C510.54 436.488 510.965 435.941 511.401 435.42C512.348 435.577 513.296 435.742 514.245 435.925C514.818 436.02 515.062 435.151 514.48 435.038C513.688 434.89 512.897 434.767 512.106 434.63C514.959 431.682 518.724 430.056 522.715 429.03C525.862 428.238 529.168 427.812 532.307 427.439C533.837 427.256 535.368 427.073 536.898 426.908C543.046 426.212 549.221 425.586 555.351 424.725C556.368 424.578 557.378 424.429 558.395 424.274C561.221 423.838 561.438 421.761 562.143 419.239C562.978 416.221 563.786 413.178 564.577 410.134C564.864 409.012 565.152 407.882 565.429 406.76C565.821 405.177 566.212 403.596 566.586 402.012C567.273 399.186 567.943 396.359 568.587 393.525C569.526 389.411 570.431 385.289 571.309 381.168C571.309 381.15 571.317 381.142 571.317 381.124C572.021 377.864 572.699 374.594 573.369 371.333C574.465 366.038 575.526 360.733 576.586 355.428C576.586 355.42 576.586 355.41 576.594 355.402C576.612 355.263 576.646 355.123 576.672 354.984C576.68 355.002 576.69 355.01 576.698 355.018V355.026C578.646 358.722 581.072 362.14 583.724 365.41C585.542 367.654 587.394 370.288 589.559 372.211C591.351 373.802 593.376 373.054 595.56 372.706C595.621 372.698 595.673 372.688 595.733 372.68C607.073 370.802 618.298 368.332 629.378 365.306C629.517 365.272 629.665 365.228 629.804 365.185C630.134 365.107 630.456 365.011 630.778 364.914C632.308 364.506 633.822 364.071 635.343 363.627C635.642 363.531 635.746 363.218 635.616 362.948Z\"\n        fill=\"#2B1919\"\n      />\n      <path\n        d=\"M547.569 443.665C547.022 438.109 546.274 432.577 545.361 427.116C545.317 426.856 545.021 426.768 544.804 426.804C542.186 427.212 539.578 427.621 536.961 428.029C536.943 427.656 536.927 427.282 536.899 426.908C536.752 423.995 536.577 421.073 536.394 418.159C536.368 417.907 536.203 417.724 535.933 417.708C529.872 417.395 523.803 417.091 517.732 416.838C510.593 416.552 503.453 416.343 496.305 416.333C490.383 416.315 484.453 416.429 478.521 416.725C478.113 416.743 477.713 416.759 477.304 416.786C477.199 416.794 477.087 416.794 476.982 416.804C476.747 416.812 476.521 417.005 476.53 417.265C476.695 423.118 476.94 428.97 477.208 434.814C459.425 430.171 441.512 425.988 423.51 422.284C419.241 421.405 414.937 420.492 410.605 419.614C394.092 416.258 377.178 413.38 360.464 414.822C350.759 415.666 341.246 418.196 332.732 422.988C329.202 424.979 325.792 427.205 322.444 429.562C317.062 433.362 311.87 437.485 306.714 441.467C299.096 447.363 291.608 453.416 284.234 459.616L284.226 459.625C274.756 467.59 265.478 475.781 256.347 484.139C245.043 494.479 233.965 505.061 222.989 515.749C221.537 517.167 220.085 518.593 218.641 520.01C213.276 525.271 207.927 530.549 202.596 535.846C202.37 536.072 202.465 536.532 202.797 536.611C205.335 537.133 207.867 537.672 210.397 538.229C211.658 538.507 212.919 538.786 214.181 539.072L214.99 539.255C216.12 539.516 217.251 539.768 218.381 540.037C218.877 540.15 219.364 540.264 219.851 540.376C221.546 540.767 223.243 541.175 224.93 541.593C227.225 542.15 229.521 542.723 231.808 543.306C233.374 543.706 234.939 544.114 236.505 544.531C236.844 544.609 237.191 544.705 237.531 544.802C238.062 544.941 238.591 545.08 239.122 545.227C239.392 545.297 239.653 545.367 239.914 545.444C240.383 545.558 240.845 545.687 241.305 545.818C241.965 545.993 242.626 546.166 243.278 546.357C244.217 546.61 245.156 546.871 246.095 547.139C246.738 547.313 247.382 547.496 248.017 547.679C251.008 548.53 253.99 549.401 256.964 550.296C261.426 551.627 265.87 553.018 270.296 554.453C273.904 555.627 277.522 556.827 281.113 558.072C284.33 559.176 287.731 560.785 291.208 560.584C294.27 560.419 296.704 558.662 299.087 556.896C301.775 554.913 304.392 552.836 306.957 550.714C307.148 550.566 307.323 550.401 307.514 550.244C306.678 557.531 303.819 575.212 302.95 582.49C328.316 583.091 353.69 583.674 379.064 584.257C382.569 571.795 388.151 548.967 391.776 536.531C392.906 532.636 394.054 528.731 395.202 524.835C396.785 519.444 398.41 514.069 400.011 508.686C411.421 512.678 423.082 515.921 434.908 518.4C439.369 519.321 443.847 520.148 448.351 520.86C453.674 521.704 459.029 522.39 464.404 522.921C466.682 523.148 468.961 523.339 471.247 523.504C471.543 523.53 471.848 523.548 472.152 523.565C474.378 523.73 476.604 523.852 478.839 523.957C481.447 524.078 484.065 524.156 486.683 524.2C490.639 524.26 494.674 524.278 498.718 524.113C508.397 523.756 518.092 522.382 526.841 518.234C532.44 515.583 537.423 511.642 540.884 506.46C542.154 504.556 543.19 502.53 544.041 500.435C545.875 495.895 546.85 491 547.425 486.147C547.894 482.252 548.216 478.337 548.415 474.407C548.935 464.187 548.587 453.873 547.569 443.665Z\"\n        fill=\"#FCBD58\"\n      />\n      <path\n        d=\"M635.616 362.948C634.712 361.122 633.808 359.296 632.895 357.469C632.4 356.479 631.904 355.486 631.409 354.487C629.948 351.548 628.469 348.6 626.973 345.661C622.321 336.521 617.503 327.444 612.225 318.67C609.104 313.47 605.826 308.382 602.321 303.443C599.634 299.651 596.668 296.017 592.93 293.208C592.329 292.747 591.703 292.313 591.068 291.903C589.737 291.034 588.347 290.278 586.92 289.572C585.894 290.207 584.877 290.851 583.877 291.512C583.738 291.599 583.599 291.694 583.469 291.782C578.425 295.13 573.599 298.851 569.025 302.887C568.938 302.957 568.86 303.034 568.773 303.104C566.694 304.938 564.669 306.834 562.703 308.791C561.078 310.391 559.495 312.035 557.947 313.704C552.895 319.157 548.234 324.948 544.017 330.941C532.112 347.811 522.215 366.724 518.129 387.099C518.121 387.143 518.111 387.195 518.103 387.238C516.808 393.761 516.068 400.795 516.46 407.665C516.591 409.857 516.834 412.031 517.208 414.17C517.355 415.065 517.538 415.962 517.739 416.84C518.747 421.17 520.357 425.301 522.722 429.031C525.869 428.24 529.174 427.814 532.314 427.44C533.843 427.257 535.375 427.074 536.905 426.909C543.053 426.213 549.227 425.588 555.358 424.727C556.375 424.579 557.385 424.431 558.402 424.275C561.228 423.84 561.445 421.762 562.149 419.24C562.985 416.223 563.793 413.179 564.584 410.136C564.871 409.014 565.159 407.884 565.436 406.762C565.827 405.179 566.219 403.597 566.593 402.014C567.28 399.187 567.95 396.361 568.594 393.526C569.533 389.413 570.438 385.291 571.315 381.169C571.315 381.151 571.324 381.143 571.324 381.125C572.028 377.865 572.706 374.595 573.376 371.334C574.472 366.039 575.533 360.734 576.593 355.429C576.593 355.421 576.593 355.411 576.601 355.403C576.619 355.264 576.653 355.125 576.679 354.986C576.687 355.003 576.697 355.011 576.705 355.02V355.028C578.653 358.724 581.079 362.141 583.731 365.411C585.549 367.655 587.401 370.289 589.565 372.212C591.357 373.803 593.383 373.055 595.566 372.707C595.628 372.699 595.68 372.69 595.74 372.681C607.08 370.804 618.305 368.333 629.385 365.307C629.524 365.273 629.671 365.23 629.811 365.186C630.141 365.108 630.463 365.013 630.785 364.916C632.315 364.508 633.829 364.072 635.35 363.629C635.642 363.531 635.746 363.218 635.616 362.948Z\"\n        fill=\"#442828\"\n      />\n      <path\n        d=\"M496.681 520.927C491.881 513.744 486.272 507.17 480.064 501.161C477.907 499.064 475.681 497.047 473.386 495.108C473.255 494.986 473.115 494.873 472.986 494.768C472.69 494.507 472.395 494.255 472.099 494.028C466.933 489.716 461.455 485.75 455.777 482.123C445.968 475.827 435.551 470.514 425.028 466.088C404.167 457.314 381.861 451.993 359.278 450.461C358.052 450.374 356.835 450.304 355.6 450.235C347.555 449.843 339.485 449.93 331.433 450.505C315.416 451.653 299.545 454.732 284.24 459.61L284.232 459.618C274.761 467.583 265.483 475.774 256.353 484.132C245.048 494.472 233.97 505.055 222.994 515.742C221.542 517.16 220.09 518.587 218.646 520.003C213.281 525.264 207.933 530.542 202.602 535.839C202.375 536.065 202.471 536.525 202.802 536.605C205.341 537.126 207.872 537.665 210.403 538.222C211.664 538.5 212.925 538.779 214.186 539.065L214.995 539.248C216.125 539.509 217.257 539.761 218.387 540.03C218.882 540.144 219.37 540.257 219.857 540.369C221.552 540.76 223.248 541.168 224.935 541.586C227.231 542.143 229.526 542.716 231.814 543.299C233.379 543.699 234.945 544.107 236.51 544.525C236.85 544.602 237.197 544.698 237.536 544.795C238.067 544.934 238.597 545.073 239.128 545.221C239.388 545.29 239.659 545.36 239.919 545.429C240.381 545.551 240.85 545.672 241.31 545.812C241.971 545.986 242.631 546.16 243.284 546.351C243.874 546.508 244.475 546.673 245.066 546.838C245.414 546.933 245.752 547.029 246.1 547.134C246.743 547.307 247.387 547.49 248.022 547.673C251.014 548.525 253.996 549.395 256.97 550.291C261.431 551.621 265.875 553.012 270.301 554.448C273.91 555.622 277.528 556.821 281.118 558.066C284.335 559.17 287.736 560.779 291.214 560.579C294.275 560.413 296.71 558.657 299.093 556.891C301.78 554.908 304.398 552.831 306.962 550.708C307.153 550.561 307.328 550.396 307.519 550.239C306.684 557.526 303.825 575.207 302.955 582.485C328.321 583.085 353.696 583.668 379.07 584.251C382.575 571.789 388.157 548.961 391.782 536.525C392.912 532.63 394.06 528.726 395.207 524.829C396.79 519.438 398.416 514.064 400.017 508.681C411.427 512.673 423.087 515.916 434.913 518.394C439.375 519.315 443.853 520.142 448.357 520.855C453.679 521.698 459.035 522.385 464.409 522.916C466.687 523.142 468.966 523.333 471.253 523.498C471.549 523.524 471.853 523.542 472.157 523.56C474.383 523.725 476.609 523.846 478.845 523.952C481.453 524.073 484.071 524.151 486.688 524.194C490.645 524.255 494.679 524.272 498.723 524.107C498.064 523.041 497.386 521.971 496.681 520.927Z\"\n        fill=\"#E29F3D\"\n      />\n      <path\n        d=\"M338.024 364.304C337.614 364.183 337.023 363.009 336.58 362.548C336.458 362.426 336.345 362.347 336.249 362.365C336.249 362.365 336.18 362.122 336.05 361.687C335.989 361.486 335.919 361.243 335.833 360.965C335.746 360.678 335.642 360.356 335.537 360C335.328 358.687 335.006 357.408 334.632 356.147C334.545 355.851 334.459 355.556 334.362 355.26C333.875 353.686 333.336 352.121 332.902 350.512C332.78 350.068 332.693 349.633 332.605 349.217C332.554 348.904 332.502 348.608 332.44 348.312C332.102 346.537 331.692 345.077 329.554 344.25C328.641 343.894 327.719 343.502 326.797 343.102C324.318 342.042 321.796 340.91 319.24 340.293C316.658 339.667 313.883 340.59 311.335 341.537C306.517 340.232 300.683 340.258 296.012 341.563C295.221 341.78 294.22 342.406 294.316 343.276C293.359 343.301 292.359 343.632 292.003 344.545C291.863 344.901 291.872 345.205 291.969 345.476C290.952 345.746 289.9 346.224 289.603 347.284C289.586 347.354 289.569 347.423 289.56 347.501C289.438 348.241 289.794 348.849 290.334 349.363C289.942 349.432 289.568 349.605 289.255 349.971C288.412 350.954 288.969 352.102 289.663 352.971C289.689 353.007 289.715 353.041 289.759 353.075C289.976 353.361 290.228 353.649 290.489 353.926C291.863 355.422 293.602 356.866 295.211 357.891C295.585 358.126 295.967 358.309 296.359 358.466C296.846 358.762 297.334 359.057 297.819 359.335C298.271 359.605 298.724 359.856 299.176 360.101C302.351 361.849 305.663 363.318 309.011 364.702C309.602 364.944 310.202 365.189 310.793 365.423C312.054 365.937 313.324 366.432 314.585 366.937C317.21 367.981 319.836 369.016 322.472 370.042C323.089 370.285 323.707 370.52 324.316 370.754C326.307 371.536 328.29 372.302 330.281 373.068C331.968 373.712 333.655 374.355 335.342 374.999C335.533 375.069 335.829 374.912 335.855 374.703C336.098 372.894 336.446 371.112 336.899 369.354C336.977 369.032 337.064 368.719 337.152 368.407C337.49 367.198 337.874 365.998 338.308 364.816C338.388 364.601 338.223 364.358 338.024 364.304Z\"\n        fill=\"#E68B60\"\n      />\n      <path\n        d=\"M317.9 347.412C315.93 344.778 314.104 343.104 310.754 342.72C306.293 342.211 301.727 342.218 297.246 342.337C296.662 342.352 296.659 343.262 297.246 343.247C300.665 343.155 304.082 343.192 307.497 343.39C309.175 343.487 311.087 343.454 312.693 343.991C314.662 344.649 315.919 346.274 317.114 347.871C317.46 348.335 318.252 347.882 317.9 347.412Z\"\n        fill=\"#C46A47\"\n      />\n      <path\n        d=\"M314.944 350.142C312.191 348.144 309.838 346.289 306.39 345.773C302.277 345.159 298.054 345.214 293.908 345.203C293.322 345.201 293.321 346.112 293.908 346.113C297.649 346.123 301.409 346.116 305.131 346.532C308.97 346.962 311.454 348.727 314.484 350.927C314.959 351.272 315.413 350.483 314.944 350.142Z\"\n        fill=\"#C46A47\"\n      />\n      <path\n        d=\"M312.113 354.154C310.41 353.704 309.261 352.495 307.777 351.649C306.381 350.852 304.815 350.635 303.247 350.405C299.523 349.861 295.778 349.521 292.018 349.346C291.432 349.319 291.434 350.229 292.018 350.257C295.973 350.441 299.944 350.767 303.855 351.41C305.547 351.688 306.976 352.17 308.403 353.158C309.54 353.946 310.513 354.674 311.871 355.033C312.438 355.182 312.679 354.304 312.113 354.154Z\"\n        fill=\"#C46A47\"\n      />\n      <path\n        d=\"M327.212 346.709C324.524 345.301 321.789 344 319.001 342.805C318.469 342.577 318.005 343.36 318.541 343.591C321.329 344.786 324.065 346.087 326.752 347.496C327.27 347.767 327.732 346.982 327.212 346.709Z\"\n        fill=\"#C46A47\"\n      />\n      <path\n        d=\"M610.561 403.55C606.249 394.219 602.003 384.862 597.824 375.479C597.578 374.927 596.68 375.295 596.926 375.848C601.106 385.231 605.352 394.588 609.663 403.919C609.917 404.469 610.815 404.102 610.561 403.55Z\"\n        fill=\"#C46A47\"\n      />\n      <path\n        d=\"M475.583 296.097C475.34 295.565 474.555 296.028 474.797 296.557C482.15 312.71 482.167 331.664 474.843 347.83C474.603 348.359 475.388 348.822 475.629 348.29C483.102 331.796 483.085 312.577 475.583 296.097Z\"\n        fill=\"#87423A\"\n      />\n      <path\n        d=\"M588.89 302.452C585.764 317.469 582.101 332.367 577.906 347.12C577.746 347.684 578.647 347.816 578.805 347.259C583.001 332.506 586.664 317.608 589.789 302.591C589.908 302.016 589.009 301.88 588.89 302.452Z\"\n        fill=\"#2B1919\"\n      />\n      <path\n        d=\"M557.564 207.095C554.562 202.673 551.969 198.021 549.788 193.142C549.55 192.609 548.765 193.071 549.002 193.602C551.183 198.481 553.775 203.133 556.777 207.555C557.105 208.036 557.894 207.581 557.564 207.095Z\"\n        fill=\"#442828\"\n      />\n      <path\n        d=\"M396.21 509.535C389.281 507.016 382.28 504.697 375.206 502.616C369.228 500.856 363.715 499.864 358.144 503.304C352.469 506.807 347.453 511.717 342.412 516.051C336.954 520.743 331.578 525.532 326.291 530.414C320.262 535.981 314.35 541.673 308.548 547.475C308.133 547.89 308.777 548.534 309.192 548.119C321.51 535.801 334.337 523.999 347.661 512.775C350.924 510.027 354.147 507.087 357.682 504.69C361.688 501.976 365.778 501.244 370.51 502.288C379.141 504.192 387.678 507.394 395.97 510.41C396.52 510.613 396.758 509.734 396.21 509.535Z\"\n        fill=\"#2B1919\"\n      />\n      <path\n        d=\"M648.717 412.194C648.691 412.228 648.673 412.263 648.648 412.297C648.447 412.602 648.239 412.924 648.031 413.262C641.387 423.497 626.77 445.959 615.342 463.36C613.821 465.682 612.429 467.804 611.203 469.656C604.272 470.23 595.672 470.899 586.149 471.621C574.497 472.5 561.462 473.455 548.418 474.404C522.565 476.282 496.66 478.161 481.347 479.439C481.277 479.542 480.929 485.283 480.398 494.865C480.293 496.813 480.181 498.917 480.058 501.161C479.702 507.674 479.293 515.396 478.841 523.953C478.31 534.048 477.727 545.311 477.118 557.145C476.796 563.415 476.285 608.255 475.954 614.76C474.128 614.726 472.292 614.672 470.466 614.629C470.162 614.62 469.866 614.611 469.562 614.603C467.823 614.559 466.083 614.515 464.352 614.464C464.352 607.776 464.516 562.832 464.508 556.536C464.49 544.075 464.456 532.588 464.403 522.917C464.333 510.134 464.22 500.525 464.046 496.011C461.272 500.264 455.68 509.134 448.35 520.856C443.359 528.857 437.55 538.178 431.297 548.257C426.087 556.64 406.157 589.784 400.514 598.888C399.227 598.854 397.94 598.819 396.653 598.793C396.245 598.785 395.835 598.775 395.426 598.767C395.078 598.759 394.721 598.749 394.373 598.741C392.364 598.697 390.355 598.646 388.338 598.602C393.922 588.88 414.017 554.736 419.695 544.858C424.807 535.952 429.913 527.084 434.904 518.395C439.105 511.091 443.235 503.908 447.235 496.96C450.149 491.882 453 486.925 455.766 482.125C457.879 478.455 459.932 474.88 461.923 471.411L462.392 470.602C466.297 463.81 469.957 457.445 473.305 451.636C473.627 451.08 473.94 450.523 474.262 449.975C476.983 445.245 479.479 440.905 481.714 437.028C482.549 435.584 483.339 434.201 484.097 432.888C487.053 427.748 489.418 423.636 491.063 420.774C492.262 418.705 494.114 417.148 496.298 416.33C497.177 415.992 498.106 415.774 499.063 415.696C501.81 415.469 504.959 415.2 508.454 414.904C508.82 414.869 509.202 414.843 509.576 414.817C511.977 414.608 514.525 414.391 517.194 414.164C529.595 413.12 544.717 411.825 560.352 410.495C561.752 410.373 563.161 410.252 564.569 410.129C577.3 409.033 590.23 407.929 602.187 406.902C616.561 405.667 629.527 404.545 639.005 403.728C644.37 403.272 649.526 410.942 648.717 412.194Z\"\n        fill=\"white\"\n      />\n      <path\n        d=\"M593.583 515.084C557.166 520.4 520.728 525.563 484.269 530.572C483.689 530.651 483.895 531.538 484.472 531.459C520.932 526.449 557.371 521.286 593.788 515.97C594.367 515.888 594.161 515.001 593.583 515.084Z\"\n        fill=\"#2B1919\"\n      />\n      <path\n        d=\"M473.41 479.874L472.984 494.771L472.976 495.127L472.159 523.563L471.194 557.094L470.473 614.63C470.169 614.622 469.873 614.612 469.568 614.604L470.289 557.059L471.254 523.501L472.063 495.169L472.097 494.03L472.505 479.839C472.811 479.856 473.115 479.866 473.41 479.874Z\"\n        fill=\"#AD7D68\"\n      />\n      <path\n        d=\"M503.452 424.586L502.835 425.561L456.191 499.851L456.008 500.155L440.999 524.321L423.293 552.818L395.433 598.772C395.084 598.764 394.728 598.755 394.38 598.747L422.528 552.333L440.242 523.81L455.19 499.73L455.799 498.766L501.705 425.667L502.322 424.693L503.452 424.586Z\"\n        fill=\"#AD7D68\"\n      />\n      <path\n        d=\"M648.649 412.299C648.448 412.603 648.241 412.925 648.032 413.264L586.665 418.273L586.317 418.307L558.176 420.75L524.985 423.62L502.837 425.559L501.707 425.663L502.323 424.688L503.453 424.585L524.923 422.707L558.141 419.828L586.177 417.394L587.307 417.298L648.649 412.299Z\"\n        fill=\"#AD7D68\"\n      />\n      <path\n        d=\"M537.202 224.58C535.47 227.388 533.093 229.619 530.189 231.182C529.696 231.447 530.134 232.199 530.628 231.933C533.659 230.302 536.147 227.947 537.954 225.019C538.248 224.542 537.496 224.106 537.202 224.58Z\"\n        fill=\"#442828\"\n      />\n      <path\n        d=\"M520.275 187.268C516.479 186.374 512.66 187.098 509.478 189.359C509.025 189.681 509.459 190.435 509.917 190.11C512.913 187.982 516.459 187.261 520.044 188.106C520.589 188.236 520.821 187.397 520.275 187.268Z\"\n        fill=\"#442828\"\n      />\n      <path\n        d=\"M528.118 204.242C525.106 204.738 522.398 205.977 520.025 207.892C519.59 208.244 520.208 208.855 520.64 208.507C522.896 206.687 525.494 205.551 528.35 205.082C528.9 204.99 528.667 204.152 528.118 204.242Z\"\n        fill=\"#442828\"\n      />\n      <path\n        d=\"M582.437 274.189C571.558 269.841 559.923 268.65 548.305 268.399C555.617 267.215 562.723 264.886 569.305 261.425C576.844 257.468 586.001 251.598 587.401 242.45C587.435 242.197 587.288 241.875 586.975 241.902C577.932 242.65 569.158 245.216 561.165 249.294C558.408 250.703 555.747 252.294 553.2 254.051C549.365 256.694 545.8 259.72 542.556 263.086C542.425 262.207 542.079 261.433 541.13 260.989C540.008 260.468 538.478 260.415 537.287 260.207C535.765 259.946 534.235 259.712 532.704 259.503C529.738 259.095 526.764 258.781 523.782 258.564C521.025 258.363 518.26 258.242 515.503 258.208C515.173 258.2 514.843 258.19 514.512 258.19C512.486 258.182 509.738 257.79 507.956 259.016C506.747 259.833 506.174 261.242 505.774 262.65C505.609 263.215 505.477 263.772 505.348 264.293C505.035 265.537 504.783 266.78 504.566 268.041C503.913 270.041 503.357 272.067 502.983 274.12C502.766 275.285 502.583 276.764 503.661 277.589C504.826 278.468 506.766 277.937 508.069 277.737C510.939 277.293 513.765 276.754 516.599 276.276C519.321 275.807 522.052 275.389 524.826 275.154C525.461 275.103 526.095 275.051 526.74 275.015C531.096 274.711 535.462 274.685 539.827 274.876C543.209 281.068 551.131 283.668 558.054 284.163C558.601 284.207 559.158 284.233 559.723 284.259C562.583 284.398 565.662 284.363 568.628 283.921C574.55 283.059 580.072 280.616 582.698 274.824C582.829 274.546 582.715 274.293 582.437 274.189Z\"\n        fill=\"white\"\n      />\n      <path\n        d=\"M541.208 263.491C541.178 266.56 540.521 269.482 539.217 272.261C538.981 272.765 539.73 273.207 539.967 272.701C541.336 269.784 542.046 266.713 542.077 263.491C542.083 262.931 541.213 262.93 541.208 263.491Z\"\n        fill=\"#AFD0DB\"\n      />\n      <path\n        d=\"M515.505 258.206C515.174 258.198 514.844 258.189 514.514 258.189C512.487 258.18 509.74 257.789 507.957 259.014C506.748 259.832 506.175 261.24 505.775 262.649C506.314 263.814 507.358 264.666 509.115 264.857C512.184 265.187 514.871 262.979 515.462 260.005C515.592 259.32 515.61 258.728 515.505 258.206Z\"\n        fill=\"#AFD0DB\"\n      />\n      <path\n        d=\"M524.609 268.337C521.94 266.45 518.079 267.224 516.549 270.199C515.548 272.146 515.644 274.434 516.601 276.278C519.322 275.808 522.053 275.391 524.828 275.156C525.462 275.104 526.097 275.052 526.741 275.017C527.549 272.668 526.652 269.781 524.609 268.337Z\"\n        fill=\"#AFD0DB\"\n      />\n      <path\n        d=\"M561.167 249.293C558.41 250.701 555.748 252.293 553.202 254.049C553.506 254.944 553.932 255.728 554.393 256.231C556.576 258.597 560.498 258.788 562.48 256.066C564.333 253.51 563.255 250.936 561.167 249.293Z\"\n        fill=\"#AFD0DB\"\n      />\n      <path\n        d=\"M565.68 276.051C561.027 275.12 558.845 280.251 559.723 284.26C562.583 284.4 565.662 284.364 568.628 283.922C568.827 283.583 568.994 283.226 569.133 282.835C570.09 280.085 568.707 276.66 565.68 276.051Z\"\n        fill=\"#AFD0DB\"\n      />\n    </g>\n    <mask\n      id=\"mask8_531_12634\"\n      style={MASK_ALPHA_STYLE}\n      maskUnits=\"userSpaceOnUse\"\n      x=\"0\"\n      y=\"0\"\n      width=\"743\"\n      height=\"577\"\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M732.598 270.993C723.101 236.662 707.884 200.574 686.866 166.328C683.057 160.11 679.04 153.954 674.839 147.875C674.7 147.666 674.553 147.467 674.404 147.258C659.369 125.579 641.881 104.961 621.923 86.3865C620.428 84.9958 618.924 83.6215 617.402 82.2553C609.602 75.2375 601.436 68.5418 592.897 62.2201C592.445 61.8816 592.002 61.5499 591.548 61.2197C590.261 60.2711 588.966 59.3322 587.661 58.4027C583.122 55.1763 578.487 52.0455 573.747 49.0375C572.522 48.2541 571.287 47.4803 570.052 46.7242C569.608 46.4457 569.156 46.1673 568.703 45.8984C559.694 40.3847 550.329 35.2803 540.616 30.6373C540.556 30.6032 540.486 30.5759 540.424 30.5417C536.625 28.7238 532.772 26.9851 528.867 25.3159C523.58 23.0545 518.197 20.924 512.711 18.9328C506.823 16.7941 500.824 14.8193 494.701 13.0287C494.283 12.8976 493.866 12.7762 493.45 12.6547C478.658 8.36788 463.214 5.08964 447.091 2.94144C379.793 -6.0321 300.878 4.81941 210.161 45.2816C144.603 74.5251 72.7835 138.336 41 202.33C22.2955 239.984 6.11992 282.385 1.39908 325.169C1.39089 325.273 1.38134 325.378 1.3636 325.481C1.33767 325.672 1.31992 325.863 1.30218 326.046C0.615687 332.464 0.188506 338.89 0.0492962 345.308C-0.21138 357.43 0.552907 369.526 2.5537 381.501C4.45896 392.901 7.47516 404.188 11.7893 415.285C22.2941 442.33 39.5984 465.922 59.2256 487.113C63.4428 491.67 67.7651 496.114 72.1556 500.452C75.5827 503.844 79.0424 507.218 82.565 510.54C84.9916 512.843 87.4441 515.123 89.9308 517.366C90.9312 518.279 91.9398 519.184 92.9565 520.071C98.1564 524.672 103.495 529.106 109.027 533.298C110.018 534.054 111.018 534.794 112.019 535.533C112.305 535.742 112.592 535.951 112.88 536.16C113.367 536.516 113.863 536.864 114.358 537.204C120.914 541.847 127.759 545.926 134.872 549.447C135.22 549.621 135.576 549.795 135.933 549.951C137.228 550.586 138.533 551.194 139.846 551.785C144.689 553.959 149.646 555.881 154.725 557.542C154.985 557.638 155.238 557.725 155.498 557.794C157.802 558.551 160.133 559.247 162.49 559.891C164.673 560.482 166.864 561.039 169.064 561.56C171.969 562.246 174.883 562.873 177.813 563.447C182.161 564.299 186.543 565.031 190.935 565.673C192.292 565.874 193.657 566.065 195.023 566.238C199.928 566.891 204.849 567.43 209.771 567.908C210.606 567.985 211.45 568.073 212.293 568.142C212.466 568.16 212.641 568.176 212.814 568.186C212.962 568.204 213.101 568.22 213.25 568.23C213.345 568.238 213.433 568.247 213.528 568.256C213.676 568.273 213.833 568.282 213.98 568.29C215.693 568.455 217.406 568.594 219.12 568.742C219.39 568.767 219.668 568.785 219.937 568.803C224.624 569.185 229.32 569.507 234.017 569.794C234.46 569.82 234.895 569.846 235.338 569.872C243.859 570.367 252.381 570.723 260.913 571.011C268.304 571.254 275.696 571.455 283.088 571.628C290.454 571.811 297.81 571.984 305.176 572.159C330.542 572.759 355.916 573.342 381.292 573.924C388.509 574.089 395.736 574.263 402.962 574.429C405.737 574.49 408.502 574.558 411.275 574.62C412.562 574.646 413.849 574.681 415.136 574.715C431.658 575.115 448.198 575.662 464.746 576.124C466.477 576.176 468.216 576.219 469.956 576.263C470.26 576.271 470.556 576.281 470.861 576.289C472.687 576.333 474.521 576.384 476.349 576.42C492.618 576.828 508.888 577.08 525.15 576.977C528.933 576.959 532.715 576.915 536.498 576.855C537.837 576.829 539.177 576.803 540.516 576.768C558.299 576.36 576.212 575.125 593.814 572.246C597.144 571.707 600.466 571.107 603.77 570.428C604.075 570.377 604.387 570.315 604.691 570.245C606.013 569.977 607.335 569.698 608.648 569.402C621.474 566.559 634.048 562.689 646.196 557.481C674.841 545.201 701.251 525.662 717.607 498.748C727.007 483.27 732.129 465.851 735.155 448.093C737.685 433.266 739.259 418.206 740.347 403.153C740.373 402.815 740.399 402.475 740.425 402.137C740.711 398.128 740.964 394.11 741.19 390.102C743.467 350.274 743.258 309.551 732.598 270.993Z\"\n        fill=\"white\"\n      />\n    </mask>\n    <g mask=\"url(#mask8_531_12634)\">\n      <path\n        d=\"M229.907 600.233C227.291 590.122 214.584 545.738 211.843 535.666C206.494 515.925 200.982 496.224 194.96 476.676C188.072 454.329 180.473 432.136 171.651 410.463C165.292 394.84 158.299 379.488 150.458 364.547C145.735 355.563 140.723 346.722 135.384 338.093C130.67 330.475 125.889 321.903 118.338 316.708C114.653 314.178 109.91 312.629 105.371 312.871C105.102 312.88 104.841 312.899 104.582 312.928C102.09 313.168 99.6944 313.957 97.5599 315.42C90.3742 320.374 90.9024 330.264 91.6626 337.911C93.3945 355.361 99.0994 372.022 105.891 388.116C107.045 390.858 108.229 393.571 109.431 396.273C118.127 415.84 127.237 435.215 135.635 454.935C150.036 488.71 173.217 557.289 185.252 591.988C186.685 592.691 188.129 593.364 189.581 594.018C194.94 596.422 200.423 598.549 206.041 600.386C206.329 600.492 206.609 600.588 206.897 600.664C209.446 601.501 212.024 602.27 214.631 602.983C217.045 603.637 219.469 604.252 221.904 604.829C225.117 605.59 228.339 606.282 231.582 606.916C231.043 604.686 230.484 602.455 229.907 600.233Z\"\n        fill=\"#4A6144\"\n      />\n      <path\n        d=\"M275.498 533.848C273.084 521.659 270.534 509.452 267.707 497.293C264.233 482.392 260.319 467.587 255.662 453.071C251.891 441.297 246.369 429.262 235.46 422.509C233.027 420.989 230.371 419.796 227.591 419.075C227.332 419.008 227.052 418.93 226.774 418.873C226.484 418.806 226.196 418.738 225.899 418.671C223.147 418.113 220.011 417.892 217.616 419.267C212.959 421.932 213.066 428.541 213.46 433.187C214.922 450.637 217.875 467.905 221.329 485.096C223.475 495.86 225.832 506.567 228.121 517.274C232.305 536.753 241.99 584.787 246.166 604.267C251.591 604.989 257.037 605.586 262.481 606.114C263.405 606.2 264.337 606.297 265.27 606.373C265.463 606.392 265.655 606.411 265.848 606.421C266.011 606.44 266.166 606.459 266.328 606.469C266.435 606.478 266.53 606.488 266.637 606.497C266.8 606.516 266.974 606.526 267.137 606.535C269.032 606.718 270.927 606.873 272.823 607.036C273.122 607.065 273.429 607.084 273.728 607.103C278.913 607.526 284.107 607.883 289.303 608.199C286.741 592.915 278.518 549.076 275.498 533.848Z\"\n        fill=\"#4A6144\"\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M135.385 338.093C140.724 346.722 145.736 355.563 150.459 364.547C158.299 379.488 165.293 394.84 171.653 410.462C166.911 410.492 162.159 410.202 157.435 409.587C152.942 409.01 148.517 408.135 144.179 406.99C143.881 406.923 143.574 406.836 143.275 406.75C129.653 403.055 116.955 396.658 105.892 388.116C99.1008 372.022 93.3959 355.361 91.664 337.911C90.9038 330.264 90.3756 320.374 97.5613 315.42C99.6958 313.957 102.091 313.168 104.583 312.928C104.842 312.899 105.103 312.88 105.372 312.871C109.911 312.629 114.654 314.178 118.339 316.708C125.161 321.401 129.722 328.851 134.015 335.864C134.474 336.613 134.93 337.358 135.385 338.093ZM235.461 422.508C246.369 429.261 251.891 441.295 255.662 453.069C260.318 467.585 264.233 482.391 267.707 497.293C260.742 499.265 253.219 499.399 246.12 497.918L246.064 497.906C245.763 497.843 245.456 497.778 245.157 497.706C242.945 497.197 240.78 496.523 238.692 495.706C232.286 493.185 226.514 489.51 221.329 485.094C217.875 467.903 214.922 450.636 213.46 433.186C213.066 428.54 212.959 421.93 217.616 419.266C220.011 417.89 223.147 418.112 225.899 418.67C226.101 418.715 226.299 418.761 226.496 418.807C226.589 418.829 226.681 418.85 226.774 418.872C226.992 418.917 227.211 418.974 227.421 419.029C227.478 419.044 227.535 419.059 227.591 419.074C230.371 419.794 233.027 420.987 235.461 422.508Z\"\n        fill=\"#789173\"\n      />\n      <path\n        d=\"M206.897 600.665C206.607 600.589 206.329 600.492 206.041 600.387C205.81 599.454 205.57 598.531 205.33 597.597C199.154 573.567 182.282 515.435 174.605 491.847C166.938 468.26 158.521 444.912 149.383 421.863C147.382 416.812 145.342 411.782 143.274 406.751C135.789 388.521 127.988 370.417 120.398 352.245C114.954 339.2 109.615 326.117 104.583 312.929C104.843 312.901 105.103 312.882 105.372 312.872C111.519 328.975 118.127 344.916 124.823 360.817C131.298 376.2 137.849 391.553 144.179 406.992C147.325 414.669 150.423 422.375 153.424 430.109C162.399 453.226 170.634 476.641 178.128 500.286C185.033 522.121 201.26 578.472 206.897 600.665Z\"\n        fill=\"#374234\"\n      />\n      <path\n        d=\"M266.636 606.499C266.531 606.489 266.435 606.479 266.328 606.47C266.164 606.46 266.01 606.441 265.848 606.422C261.134 579.641 250.573 524.353 245.157 497.706C244.637 495.109 244.109 492.503 243.57 489.905C240.512 475.024 237.539 460.104 233.892 445.356C231.651 436.332 229.092 427.385 225.899 418.67C226.196 418.737 226.486 418.805 226.773 418.872C230.39 428.78 233.18 438.987 235.615 449.251C239.433 465.383 242.878 481.631 246.119 497.918C249.044 512.483 251.796 527.076 254.536 541.65C256.806 553.731 264.51 594.387 266.636 606.499Z\"\n        fill=\"#374234\"\n      />\n      <path\n        d=\"M169.06 589.059C163.789 577.65 161.067 565.35 157.578 553.334C154.322 542.12 150.047 531.241 146.185 520.222C126.726 464.706 93.976 420.771 67.5371 398.035C55.3877 387.578 42.0441 378.556 27.7492 371.34C27.7505 371.345 27.7519 371.351 27.7519 371.356C25.1274 369.772 22.451 368.284 19.7665 366.88C4.06312 358.66 -26.0511 352.308 -43.208 347.868C-43.5506 347.779 -43.9136 348.101 -43.799 348.46C-31.1855 388.128 -2.82911 427.533 19.1878 463.042C30.2085 480.816 43.0267 497.416 57.8047 512.231C73.5682 528.034 90.4835 543.018 107.983 556.872C117.44 564.358 127.228 571.44 137.475 577.809C142.697 581.055 148.032 584.135 153.5 586.948C158.213 589.372 163.478 591.599 168.772 589.768C169.086 589.657 169.195 589.353 169.06 589.059Z\"\n        fill=\"#4A6144\"\n      />\n    </g>\n    <mask\n      id=\"mask9_531_12634\"\n      style={MASK_ALPHA_STYLE}\n      maskUnits=\"userSpaceOnUse\"\n      x=\"0\"\n      y=\"0\"\n      width=\"743\"\n      height=\"577\"\n    >\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M732.598 270.993C723.101 236.662 707.884 200.574 686.866 166.328C683.057 160.11 679.04 153.954 674.839 147.875C674.7 147.666 674.553 147.467 674.404 147.258C659.369 125.579 641.881 104.961 621.923 86.3865C620.428 84.9958 618.924 83.6215 617.402 82.2553C609.602 75.2375 601.436 68.5418 592.897 62.2201C592.445 61.8816 592.002 61.5499 591.548 61.2197C590.261 60.2711 588.966 59.3322 587.661 58.4027C583.122 55.1763 578.487 52.0455 573.747 49.0375C572.522 48.2541 571.287 47.4803 570.052 46.7242C569.608 46.4457 569.156 46.1673 568.703 45.8984C559.694 40.3847 550.329 35.2803 540.616 30.6373C540.556 30.6032 540.486 30.5759 540.424 30.5417C536.625 28.7238 532.772 26.9851 528.867 25.3159C523.58 23.0545 518.197 20.924 512.711 18.9328C506.823 16.7941 500.824 14.8193 494.701 13.0287C494.283 12.8976 493.866 12.7762 493.45 12.6547C478.658 8.36788 463.214 5.08964 447.091 2.94144C379.793 -6.0321 300.878 4.81941 210.161 45.2816C144.603 74.5251 72.7835 138.336 41 202.33C22.2955 239.984 6.11992 282.385 1.39908 325.169C1.39089 325.273 1.38134 325.378 1.3636 325.481C1.33767 325.672 1.31992 325.863 1.30218 326.046C0.615687 332.464 0.188506 338.89 0.0492962 345.308C-0.21138 357.43 0.552907 369.526 2.5537 381.501C4.45896 392.901 7.47516 404.188 11.7893 415.285C22.2941 442.33 39.5984 465.922 59.2256 487.113C63.4428 491.67 67.7651 496.114 72.1556 500.452C75.5827 503.844 79.0424 507.218 82.565 510.54C84.9916 512.843 87.4441 515.123 89.9308 517.366C90.9312 518.279 91.9398 519.184 92.9565 520.071C98.1564 524.672 103.495 529.106 109.027 533.298C110.018 534.054 111.018 534.794 112.019 535.533C112.305 535.742 112.592 535.951 112.88 536.16C113.367 536.516 113.863 536.864 114.358 537.204C120.914 541.847 127.759 545.926 134.872 549.447C135.22 549.621 135.576 549.795 135.933 549.951C137.228 550.586 138.533 551.194 139.846 551.785C144.689 553.959 149.646 555.881 154.725 557.542C154.985 557.638 155.238 557.725 155.498 557.794C157.802 558.551 160.133 559.247 162.49 559.891C164.673 560.482 166.864 561.039 169.064 561.56C171.969 562.246 174.883 562.873 177.813 563.447C182.161 564.299 186.543 565.031 190.935 565.673C192.292 565.874 193.657 566.065 195.023 566.238C199.928 566.891 204.849 567.43 209.771 567.908C210.606 567.985 211.45 568.073 212.293 568.142C212.466 568.16 212.641 568.176 212.814 568.186C212.962 568.204 213.101 568.22 213.25 568.23C213.345 568.238 213.433 568.247 213.528 568.256C213.676 568.273 213.833 568.282 213.98 568.29C215.693 568.455 217.406 568.594 219.12 568.742C219.39 568.767 219.668 568.785 219.937 568.803C224.624 569.185 229.32 569.507 234.017 569.794C234.46 569.82 234.895 569.846 235.338 569.872C243.859 570.367 252.381 570.723 260.913 571.011C268.304 571.254 275.696 571.455 283.088 571.628C290.454 571.811 297.81 571.984 305.176 572.159C330.542 572.759 355.916 573.342 381.292 573.924C388.509 574.089 395.736 574.263 402.962 574.429C405.737 574.49 408.502 574.558 411.275 574.62C412.562 574.646 413.849 574.681 415.136 574.715C431.658 575.115 448.198 575.662 464.746 576.124C466.477 576.176 468.216 576.219 469.956 576.263C470.26 576.271 470.556 576.281 470.861 576.289C472.687 576.333 474.521 576.384 476.349 576.42C492.618 576.828 508.888 577.08 525.15 576.977C528.933 576.959 532.715 576.915 536.498 576.855C537.837 576.829 539.177 576.803 540.516 576.768C558.299 576.36 576.212 575.125 593.814 572.246C597.144 571.707 600.466 571.107 603.77 570.428C604.075 570.377 604.387 570.315 604.691 570.245C606.013 569.977 607.335 569.698 608.648 569.402C621.474 566.559 634.048 562.689 646.196 557.481C674.841 545.201 701.251 525.662 717.607 498.748C727.007 483.27 732.129 465.851 735.155 448.093C737.685 433.266 739.259 418.206 740.347 403.153C740.373 402.815 740.399 402.475 740.425 402.137C740.711 398.128 740.964 394.11 741.19 390.102C743.467 350.274 743.258 309.551 732.598 270.993Z\"\n        fill=\"white\"\n      />\n    </mask>\n    <g mask=\"url(#mask9_531_12634)\">\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M379.11 204.53C352.792 220.002 319.662 212.445 305.099 187.672C290.537 162.9 300.817 128.553 326.397 111.892C352.07 95.1703 385.812 106.891 400.374 131.664C414.938 156.436 405.415 189.066 379.11 204.53ZM367.91 140.973C363.308 143.679 361.647 149.406 364.195 153.741C366.744 158.075 372.556 159.409 377.157 156.702C381.76 153.997 383.433 148.262 380.885 143.928C378.337 139.593 372.513 138.267 367.91 140.973Z\"\n        fill=\"#67B4F0\"\n      />\n      <path\n        d=\"M207.389 247.1L211.766 254.545C213.235 257.042 216.583 257.805 219.234 256.245L327.91 192.359L310.687 163.059C299.042 169.742 287.396 176.424 275.752 183.106C259.156 192.628 242.561 202.151 225.966 211.674C215.558 217.646 201.175 229.64 205.712 243.4C206.134 244.67 206.691 245.911 207.389 247.1Z\"\n        fill=\"#67B4F0\"\n      />\n      <path\n        d=\"M229.795 244.597C232.414 245.661 235.067 246.649 237.738 247.577C240.435 248.514 243.107 250.125 246.027 250.538C250.315 251.144 251.183 248.66 252.329 245.059C253.337 241.894 254.154 238.664 254.946 235.439C255.1 234.808 255.531 230.811 256.11 230.501C256.092 230.511 229.795 244.597 229.795 244.597Z\"\n        fill=\"#67B4F0\"\n      />\n      <path\n        d=\"M289.3 209.617C289.3 209.617 307.714 217.104 309.699 215.129C311.683 213.154 315.615 195.52 315.615 195.52L289.3 209.617Z\"\n        fill=\"#67B4F0\"\n      />\n      <path\n        d=\"M246.62 231.383C246.62 231.383 265.034 238.87 267.019 236.896C269.003 234.922 272.935 217.287 272.935 217.287L246.62 231.383Z\"\n        fill=\"#67B4F0\"\n      />\n      <path\n        d=\"M207.389 247.1L208.406 248.829L306.984 190.88L303.92 185.667L205.712 243.4C206.134 244.67 206.691 245.911 207.389 247.1Z\"\n        fill=\"#105CD1\"\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M374.35 196.437C353.146 208.902 321.971 201.66 313.152 180.24C302.961 155.488 311.802 133.755 333.005 121.29C354.21 108.825 379.756 117.724 391.495 137.692C403.234 157.66 395.555 183.971 374.35 196.437ZM367.91 140.973C363.308 143.679 361.647 149.406 364.195 153.741C366.744 158.075 372.556 159.409 377.156 156.702C381.76 153.997 383.433 148.262 380.885 143.928C378.337 139.593 372.513 138.267 367.91 140.973Z\"\n        fill=\"#105CD1\"\n      />\n    </g>\n  </svg>\n);\n", "import React, {\n  useState,\n  useRef,\n  useContext,\n  FormEvent,\n} from 'https://esm.sh/react@18.2.0';\n\nimport { makeStyles, cn } from '../../../../styles/css-objects/index.ts';\nimport { styleguide, layout } from '../../../../styles/index.ts';\nimport { TextField } from '../../../../styles/components/inputs/index.ts';\nimport {\n  RaisedButton,\n  useRaisedButtonStyles,\n} from '../../../../styles/components/buttons.tsx';\nimport { IconGoogle } from '../../../../styles/components/icons/index.ts';\nimport { Dialog } from '../../../../styles/components/dialog/index.tsx';\nimport { toastContext } from '../../../../styles/components/toast/index.tsx';\nimport { OnLoginInfoFunc } from './index.tsx';\nimport { H1, H2 } from '../../../../styles/components/texts.tsx';\n\nconst useStyles = makeStyles((theme) => ({\n  form: {\n    alignItems: 'stretch',\n    width: '100%',\n    maxWidth: styleguide.gridbase * 37,\n    textAlign: 'center',\n    basedOn: [layout.column],\n  },\n  h1: {\n    marginBottom: styleguide.gridbase * 2,\n  },\n  h2: {\n    marginBottom: styleguide.gridbase * 3,\n  },\n  text: {\n    marginBottom: styleguide.gridbase * 3,\n  },\n  button: {\n    height: styleguide.gridbase * 5,\n    margin: 0,\n    marginBottom: styleguide.gridbase * 3,\n  },\n  googleButton: {\n    color: theme.background.text,\n    border: `1px solid ${theme.primary[500]}`,\n    backgroundColor: theme.background[0],\n    padding: 0,\n    ':hover': {\n      ':not(disabled)': {\n        backgroundColor: theme.background[0],\n      },\n    },\n    googleIcon: {\n      width: styleguide.gridbase * 5,\n      height: styleguide.gridbase * 5,\n    },\n    basedOn: [useRaisedButtonStyles.raisedButton],\n  },\n  googleIcon: {},\n  link: {\n    color: theme.primary[500],\n    cursor: 'pointer',\n  },\n  error: {\n    color: 'red',\n  },\n}));\n\nconst EMAIL_REGEX =\n  /(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])/; // eslint-disable-line\n\nenum AUTH_STATE {\n  SIGN_UP = 'sign-up',\n  LOGIN = 'login',\n  RESET_PASSWORD = 'reset-password',\n}\n\ntype GoToState = (state: AUTH_STATE) => void;\n\ninterface SignUpFormProps {\n  goToState: GoToState;\n  onLogin: OnLoginInfoFunc;\n}\nfunction SignUpForm({ goToState, onLogin }: SignUpFormProps) {\n  const styles = useStyles();\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [confirmPassword, setConfirmPassword] = useState('');\n  const [name, setName] = useState('');\n  const [error, setError] = useState('');\n  const [processing, setProcessing] = useState(false);\n\n  const onSubmit = async (e: FormEvent) => {\n    e.stopPropagation();\n    e.preventDefault();\n    if (!email || !password || !name) {\n      return setError('Please fill all the fields');\n    }\n\n    if (!EMAIL_REGEX.test(email)) {\n      return setError('Please enter a valid email address');\n    }\n\n    if (password.length < 6) {\n      return setError('Password must be at least 6 characters');\n    }\n\n    if (confirmPassword !== password) {\n      return setError('Passwords do not match');\n    }\n\n    // const auth = getAuth();\n\n    try {\n      // setProcessing(true);\n      // setError('');\n      // const { user } = await createUserWithEmailAndPassword(\n      //   auth,\n      //   email,\n      //   password\n      // );\n\n      // await updateProfile(user, {\n      //   displayName: name,\n      // });\n      onLogin({\n        userId: 'test',\n        isNew: true,\n      });\n    } catch (error) {\n      const { message } = error;\n      setError(message);\n    } finally {\n      setProcessing(false);\n    }\n  };\n\n  // const googleSignIn = async (e: any) => {\n  //   try {\n  //     setProcessing(true);\n  //     await signInWithGoogle(e);\n  //   } catch (err) {\n  //     setProcessing(false);\n  //     setError(err.message);\n  //   }\n  // };\n\n  return (\n    <form className={cn(styles.form)} onSubmit={onSubmit}>\n      <H1 className={cn(styles.h1)}>Sign Up</H1>\n      <H2 className={cn(styles.h2)}>Create your free account</H2>\n      <TextField\n        className={cn(styles.text)}\n        value={email}\n        type=\"email\"\n        //name=\"email\"\n        placeholder=\"Email\"\n        autoComplete=\"Username\"\n        onChange={(e: any) => setEmail(e.target.value)}\n        required\n      />\n      <TextField\n        className={cn(styles.text)}\n        value={password}\n        type=\"password\"\n        //name=\"password\"\n        placeholder=\"Password\"\n        autoComplete=\"new-password\"\n        onChange={(e: any) => setPassword(e.target.value)}\n        required\n      />\n      <TextField\n        className={cn(styles.text)}\n        value={confirmPassword}\n        type=\"password\"\n        name=\"validatePassword\"\n        placeholder=\"Confirm Password\"\n        autoComplete=\"new-password\"\n        onChange={(e: any) => setConfirmPassword(e.target.value)}\n        required\n      />\n      <TextField\n        className={cn(styles.text)}\n        value={name}\n        type=\"text\"\n        name=\"name\"\n        placeholder=\"Full name\"\n        onChange={(e: any) => setName(e.target.value)}\n        required\n      />\n      {error && <p className={cn(styles.error)}>{error}</p>}\n      <RaisedButton\n        className={cn(styles.button)}\n        disabled={!email || !password || processing}\n      >\n        Sign up\n      </RaisedButton>\n      {/* {isElectron() ? null : (\n        <RaisedButton\n          className={cn(styles.button, styles.googleButton)}\n          onClick={googleSignIn}\n          type=\"button\"\n        >\n          <IconGoogle className={cn(styles.googleIcon)} />\n          <span className={cn(layout.flex)}>Sign in with Google</span>\n          <div className={cn(styles.googleIcon)} />\n        </RaisedButton>\n      )} */}\n      <p>\n        Already have an account?{' '}\n        <span\n          className={cn(styles.link)}\n          onClick={() => goToState(AUTH_STATE.LOGIN)}\n        >\n          Log in\n        </span>\n      </p>\n    </form>\n  );\n}\n\ninterface LoginFormProps {\n  goToState: GoToState;\n  // signInWithGoogle: (e: any) => Promise<void>;\n  onLogin: OnLoginInfoFunc;\n}\nfunction LoginForm({ goToState, onLogin }: LoginFormProps) {\n  const styles = useStyles();\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [error, setError] = useState('');\n  const [processing, setProcessing] = useState(false);\n\n  const onSubmit = async (e: FormEvent) => {\n    e.stopPropagation();\n    e.preventDefault();\n\n    if (!email || !password) {\n      return setError('Please enter email address and password');\n    }\n\n    if (!EMAIL_REGEX.test(email)) {\n      return setError('Please enter a valid email address');\n    }\n\n    if (password.length < 6) {\n      return setError('Password must be at least 6 characters');\n    }\n    setProcessing(true);\n    setError('');\n\n    // const auth = getAuth();\n\n    try {\n      // const { user } = await signInWithEmailAndPassword(auth, email, password);\n      onLogin({ userId: 'test' });\n    } catch (error) {\n      const { message } = error;\n      setProcessing(false);\n      setError(message);\n    }\n  };\n  // const googleSignIn = async (e) => {\n  //   try {\n  //     setProcessing(true);\n  //     await signInWithGoogle(e);\n  //   } catch (err) {\n  //     setProcessing(false);\n  //     setError(err.message);\n  //   }\n  // };\n  return (\n    <form className={cn(styles.form)} onSubmit={onSubmit}>\n      <H1 className={cn(styles.h1)}>Sign In</H1>\n      <H2 className={cn(styles.h2)}>Welcome back to Ovvio</H2>\n      <TextField\n        className={cn(styles.text)}\n        value={email}\n        type=\"email\"\n        name=\"email\"\n        placeholder=\"email\"\n        autoComplete=\"username\"\n        onChange={(e: any) => setEmail(e.target.value)}\n        required\n      />\n      <TextField\n        className={cn(styles.text)}\n        value={password}\n        type=\"password\"\n        name=\"password\"\n        placeholder=\"password\"\n        autoComplete=\"current-password\"\n        onChange={(e: any) => setPassword(e.target.value)}\n        required\n      />\n      {error && <p className={cn(styles.error)}>{error}</p>}\n      <RaisedButton\n        className={cn(styles.button)}\n        disabled={!email || !password || processing}\n      >\n        Log in\n      </RaisedButton>\n      {/* {isElectron() ? null : (\n        <RaisedButton\n          className={cn(styles.button, styles.googleButton)}\n          onClick={googleSignIn}\n          type=\"button\"\n        >\n          <IconGoogle className={cn(styles.googleIcon)} />\n          <span className={cn(layout.flex)}>Sign in with Google</span>\n          <div className={cn(styles.googleIcon)} />\n        </RaisedButton>\n      )} */}\n      <p\n        className={cn(styles.link)}\n        onClick={() => goToState(AUTH_STATE.RESET_PASSWORD)}\n      >\n        Forgot password?\n      </p>\n      <p>\n        Don't have an account yet?{' '}\n        <span\n          className={cn(styles.link)}\n          onClick={() => goToState(AUTH_STATE.SIGN_UP)}\n        >\n          Sign up\n        </span>\n      </p>\n    </form>\n  );\n}\n\ninterface ResetPasswordFormProps {\n  goToState: GoToState;\n}\nfunction ResetPasswordForm({ goToState }: ResetPasswordFormProps) {\n  const styles = useStyles();\n  const toastProvider = useContext(toastContext);\n\n  const [email, setEmail] = useState('');\n  const [error, setError] = useState('');\n  const [processing, setProcessing] = useState(false);\n\n  const onSubmit = async (e: FormEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    if (!email || !EMAIL_REGEX.test(email)) {\n      return setError('Please enter a valid email address');\n    }\n\n    setProcessing(true);\n\n    // const auth = getAuth();\n    try {\n      // await sendPasswordResetEmail(auth, email);\n      toastProvider.displayToast({\n        duration: 2000,\n        text: 'Email sent. check your inbox',\n      });\n      goToState(AUTH_STATE.LOGIN);\n    } catch (err) {\n      if (err.code === 'auth/invalid-email') {\n        return setError('Please enter a valid email address');\n      }\n      if (err.code === 'auth/user-not-found') {\n        return setError('The requested email does not exist');\n      }\n      setError('Something went wrong, please try again');\n    } finally {\n      setProcessing(false);\n    }\n  };\n  return (\n    <form className={cn(styles.form)} onSubmit={onSubmit}>\n      <H1 className={cn(styles.h1)}>Forgot Password?</H1>\n      <H2 className={cn(styles.h2)}>\n        Enter your email to receive your password reset instructions\n      </H2>\n      <TextField\n        className={cn(styles.text)}\n        value={email}\n        type=\"email\"\n        name=\"email\"\n        placeholder=\"email\"\n        onChange={(e) => setEmail(e.currentTarget.value)}\n        required\n      />\n      {error && <p className={cn(styles.error)}>{error}</p>}\n      <RaisedButton\n        className={cn(styles.button)}\n        disabled={!email || processing}\n      >\n        RESET PASSWORD\n      </RaisedButton>\n      <p\n        className={cn(styles.link)}\n        onClick={() => goToState(AUTH_STATE.LOGIN)}\n      >\n        Back to login\n      </p>\n    </form>\n  );\n}\n\ninterface AuthFormViewProps {\n  onLogin: OnLoginInfoFunc;\n}\nexport default function AuthFormView({ onLogin }: AuthFormViewProps) {\n  const [loginState, setLoginState] = useState(AUTH_STATE.SIGN_UP);\n  const [requestPassword, setRequestPassword] = useState(false);\n  const [knownEmail, setKnownEmail] = useState('');\n  const [currentPassword, setCurrentPassword] = useState('');\n  const credentials = useRef(null);\n\n  // const auth = getAuth();\n\n  // const signInWithGoogle = async (e) => {\n  //   e.preventDefault();\n  //   e.stopPropagation();\n  //   try {\n  //     const userCred = await signInWithPopup(auth, new GoogleAuthProvider());\n\n  //     const additionalUserInfo = await getAdditionalUserInfo(userCred);\n\n  //     onLogin({\n  //       user: userCred.user,\n  //       isNew: additionalUserInfo ? additionalUserInfo.isNewUser : false,\n  //     });\n  //   } catch (error) {\n  //     if (error.code === 'auth/account-exists-with-different-credential') {\n  //       const { credential, email } = error;\n\n  //       const methods = await fetchSignInMethodsForEmail(auth, email);\n\n  //       if (methods[0] === 'password') {\n  //         setKnownEmail(email);\n  //         setCurrentPassword('');\n  //         setRequestPassword(true);\n  //         credentials.current = credential;\n  //       }\n  //     } else {\n  //       throw error;\n  //     }\n  //   }\n  // };\n  const linkAccount = async (event: any) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    // const userCred = await signInWithEmailAndPassword(\n    //   auth,\n    //   knownEmail,\n    //   currentPassword\n    // );\n\n    // await linkWithCredential(userCred.user, this.state._credentials);\n    onLogin({ userId: 'test' });\n  };\n  const dismissLink = () => {\n    setKnownEmail('');\n    setCurrentPassword('');\n    setRequestPassword(false);\n    credentials.current = null;\n  };\n\n  let content = null;\n  if (loginState === AUTH_STATE.SIGN_UP) {\n    content = (\n      <SignUpForm\n        goToState={setLoginState}\n        // signInWithGoogle={signInWithGoogle}\n        onLogin={onLogin}\n      />\n    );\n  } else if (loginState === AUTH_STATE.RESET_PASSWORD) {\n    content = <ResetPasswordForm goToState={setLoginState} />;\n  } else {\n    content = (\n      <LoginForm\n        goToState={setLoginState}\n        // signInWithGoogle={signInWithGoogle}\n        onLogin={onLogin}\n      />\n    );\n  }\n  return (\n    <React.Fragment>\n      {content}\n      <Dialog\n        className={cn(layout.column)}\n        open={requestPassword}\n        onClickOutside={dismissLink}\n      >\n        <form onSubmit={linkAccount}>\n          <p>\n            The email '{knownEmail}' is already registered, please enter the\n            password to link your Google account\n          </p>\n          <TextField type=\"email\" readOnly={true} value={knownEmail} />\n          <TextField\n            name=\"currentPassword\"\n            type=\"password\"\n            value={currentPassword}\n            onChange={(e) => setCurrentPassword(e.currentTarget.value)}\n          />\n          <RaisedButton>Link accounts</RaisedButton>\n        </form>\n      </Dialog>\n    </React.Fragment>\n  );\n}\n", "import React, {\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'https://esm.sh/react@18.2.0';\nimport { uniqueId } from '../../../../base/common.ts';\nimport { layout, styleguide } from '../../../../styles/index.ts';\nimport { RaisedButton } from '../../../../styles/components/buttons.tsx';\nimport { cn, makeStyles } from '../../../../styles/css-objects/index.ts';\nimport { MediaQueries } from '../../../../styles/responsive.ts';\nimport { CfdsClientProvider } from '../../core/cfds/react/graph.tsx';\nimport { LoginIllustration } from './illustrations.tsx';\nimport AuthForm from './AuthForm.tsx';\nimport { GlobalLogger, newLogger } from '../../../../logging/log.ts';\nimport { LoggerProvider } from '../../core/cfds/react/logger.tsx';\nimport { VertexManager } from '../../../../cfds/client/graph/vertex-manager.ts';\nimport { User } from '../../../../cfds/client/graph/vertices/user.ts';\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    alignItems: 'stretch',\n    basedOn: [layout.row, layout.flex],\n  },\n  ladyContainer: {\n    backgroundColor: theme.background[100],\n    flexBasis: '50%',\n    basedOn: [layout.column, layout.centerCenter, layout.flexSpacer],\n    [MediaQueries.Mobile]: {\n      display: 'none',\n    },\n  },\n  illustration: {\n    boxSizing: 'border-box',\n    padding: styleguide.gridbase * 2,\n    width: '100%',\n    maxWidth: styleguide.gridbase * 80,\n  },\n  formContainer: {\n    backgroundColor: theme.background[0],\n    flexBasis: '50%',\n    flexShrink: 1,\n    basedOn: [layout.column, layout.centerCenter, layout.flex],\n    [MediaQueries.Mobile]: {\n      flexBasis: '100%',\n    },\n  },\n  plant: {\n    alignSelf: 'flex-end',\n    marginRight: styleguide.gridbase * 8,\n  },\n}));\n\ninterface OnLoginInfo {\n  userId: string;\n  isNew?: boolean;\n}\n\nexport type OnLoginInfoFunc = (info: OnLoginInfo) => Promise<void>;\n\ninterface LoginPageProps {\n  onLogin: OnLoginInfoFunc;\n}\nconst LoginPage = ({ onLogin }: LoginPageProps) => {\n  const styles = useStyles();\n  return (\n    <div className={cn(styles.root)}>\n      <div className={cn(styles.ladyContainer)}>\n        <LoginIllustration className={cn(styles.illustration)} />\n      </div>\n      <div className={cn(styles.formContainer)}>\n        <AuthForm onLogin={onLogin} />\n      </div>\n    </div>\n  );\n};\n\nexport interface SessionInfo {\n  userId: string;\n  sessionId: string;\n  // searchParams?: MarketingParams;\n}\n\ninterface LoginViewProps {\n  children: React.ReactNode;\n}\nexport default function LoginView({ children }: LoginViewProps) {\n  // const isLoading = useRef(true);\n  // const history = useHistory();\n\n  const [sessionInfo, setSessionInfo] = useState<SessionInfo>({\n    userId: 'ofri',\n    sessionId: uniqueId(),\n  });\n\n  const [processing, setProcessing] = useState(false);\n\n  // const auth = getAuth();\n\n  // const dataRef = useRef({\n  //   history,\n  // });\n\n  // useEffect(() => {\n  //   dataRef.current = {\n  //     history,\n  //   };\n  // });\n\n  // useEffect(() => {\n  //   return auth.onAuthStateChanged(async (user) => {\n  //     if (isLoading.current) {\n  //       isLoading.current = false;\n  //       if (user) {\n  //         const sessionId = uniqueId();\n  //         const u = new UserStore(\n  //           new CurrentUser(user, SessionOrigin.ALREADY_SIGNED_IN, sessionId)\n  //         );\n  //         setProcessing(true);\n  //         const marketingParams =\n  //           dataRef.current.history.extractMarketingParams(true);\n  //         try {\n  //           await u.save();\n  //         } catch {\n  //           await auth.signOut();\n  //           setProcessing(false);\n  //           return;\n  //         }\n\n  //         setSessionInfo({\n  //           user: u,\n  //           sessionId,\n  //           searchParams: marketingParams,\n  //           anonymous: user.isAnonymous,\n  //         });\n  //       }\n  //       setProcessing(false);\n  //     } else if (!user) {\n  //       setSessionInfo(undefined);\n  //     }\n  //   });\n  // }, [auth]);\n  const onLogin: OnLoginInfoFunc = async (info) => {\n    setProcessing(true);\n\n    // try {\n    //   const sessionId = uniqueId();\n    //   const origin =\n    //     info.isNew !== undefined && info.isNew\n    //       ? SessionOrigin.SIGN_UP\n    //       : SessionOrigin.SIGN_IN;\n    //   const u = new UserStore(new CurrentUser(info.user, origin, sessionId));\n    //   await u.save();\n    //   const marketingParams = history.extractMarketingParams(true);\n    //   setSessionInfo({\n    //     user: u,\n    //     sessionId,\n    //     searchParams: marketingParams,\n    //     anonymous: info.user.isAnonymous,\n    //   });\n    // } catch {\n    //   auth.signOut();\n    // } finally {\n    //   setProcessing(false);\n    // }\n  };\n\n  // electronSSOSignInOnLoad(onLogin).then(() => {});\n\n  if (processing) {\n    return null;\n  }\n\n  if (sessionInfo) {\n    return (\n      <LoggerProvider sessionInfo={sessionInfo}>\n        <CfdsClientProvider\n          userId={sessionInfo.userId}\n          sessionId={sessionInfo.sessionId}\n        >\n          {children}\n        </CfdsClientProvider>\n      </LoggerProvider>\n    );\n  }\n\n  return <LoginPage onLogin={onLogin} />;\n}\n\nexport const LogoutButton = () => (\n  <RaisedButton onClick={() => {} /*getAuth().signOut()*/}>Logout</RaisedButton>\n);\n", "export enum Features {\n  BoardView = 'BoardView',\n  ExportDemoData = 'ExportDemoData',\n  Userpilot = 'Userpilot',\n  Mobile = 'Mobile',\n}\n\nexport type FeatureConfig = {\n  status: 'disabled' | 'beta' | 'active';\n};\n\nconst featureStatus: Record<Features, FeatureConfig> = {\n  [Features.BoardView]: { status: 'active' },\n  [Features.ExportDemoData]: { status: 'beta' },\n  [Features.Userpilot]: { status: 'active' },\n  [Features.Mobile]: { status: 'beta' },\n};\n\nexport function getFeatureConfig(feature: Features) {\n  return featureStatus[feature];\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { Features, getFeatureConfig } from './features.tsx';\n\nexport { Features };\n\nexport interface FeatureProps {\n  id: Features;\n  nonActiveComponent?: React.ComponentType<{}>;\n  children: React.ReactNode;\n}\n\nfunction NoopComponent() {\n  return null;\n}\n\nexport function isFeatureActive(featureId: Features) {\n  const featureConf = getFeatureConfig(featureId);\n\n  const query = new URLSearchParams(window.location.search);\n  const forceProd =\n    (query.get('forceProd') || 'false').toLowerCase() === 'true';\n\n  switch (featureConf.status) {\n    // case 'active': {\n    //   return true;\n    // }\n    // case 'beta': {\n    //   return !(config.isProduction || forceProd);\n    // }\n    case 'disabled':\n    default: {\n      return false;\n    }\n  }\n}\n\nexport function useIsFeatureActive(featureId: Features) {\n  return isFeatureActive(featureId);\n}\n\nexport const Feature: React.FC<FeatureProps> = ({\n  id,\n  children,\n  nonActiveComponent,\n}) => {\n  const isFeatureActive = useIsFeatureActive(id);\n  const FallbackComponent = nonActiveComponent || NoopComponent;\n  const content = isFeatureActive ? children : <FallbackComponent />;\n\n  return <React.Fragment>{content}</React.Fragment>;\n};\n", "import React, { useEffect, useState } from 'https://esm.sh/react@18.2.0';\nimport { layout, styleguide } from '../../../styles/index.ts';\nimport { Bold, H3 } from '../../../styles/components/texts.tsx';\nimport { cn, makeStyles } from '../../../styles/css-objects/index.ts';\nimport { Breakpoints } from '../../../styles/responsive.ts';\nimport { Features, useIsFeatureActive } from '../core/feature-toggle/index.tsx';\n\nconst useStyles = makeStyles((theme) => ({\n  blockRoot: {\n    backgroundColor: '#e8ecfc',\n    padding: [styleguide.gridbase],\n    textAlign: 'center',\n    basedOn: [layout.column, layout.centerCenter, layout.flex],\n  },\n}));\n\nfunction isOnMobile() {\n  // if (config.isDev) {\n  //   return false;\n  // }\n  if (window.innerWidth <= Breakpoints.Medium || window.innerHeight <= 400) {\n    return true;\n  }\n  if (\n    navigator.userAgent.match(/Android/i) ||\n    navigator.userAgent.match(/webOS/i) ||\n    navigator.userAgent.match(/iPhone/i) ||\n    navigator.userAgent.match(/iPad/i) ||\n    navigator.userAgent.match(/iPod/i) ||\n    navigator.userAgent.match(/BlackBerry/i) ||\n    navigator.userAgent.match(/Windows Phone/i)\n  ) {\n    return true;\n  }\n  return false;\n}\n\nfunction MobileBlockView() {\n  const styles = useStyles();\n  return (\n    <div className={cn(styles.blockRoot)}>\n      <H3>Hey there</H3>\n      <Bold>\n        We currently do not support mobile devices, please visit this site from\n        a computer\n      </Bold>\n    </div>\n  );\n}\n\ninterface MobileBlockerProps {\n  children: React.ReactNode;\n}\nfunction MobileBlockerImpl({ children }: MobileBlockerProps) {\n  const [isBlocking, setIsBlocking] = useState(() => isOnMobile());\n\n  useEffect(() => {\n    const handler = () => {\n      setIsBlocking(isOnMobile());\n    };\n    addEventListener('resize', handler);\n\n    return () => removeEventListener('resize', handler);\n  }, [isBlocking]);\n\n  if (isBlocking) {\n    return <MobileBlockView />;\n  }\n\n  return <React.Fragment>{children}</React.Fragment>;\n}\n\nexport function MobileBlocker({ children }: MobileBlockerProps) {\n  const isMobileSupported = useIsFeatureActive(Features.Mobile);\n\n  if (!isMobileSupported) {\n    return <MobileBlockerImpl>{children}</MobileBlockerImpl>;\n  }\n  return <React.Fragment>{children}</React.Fragment>;\n}\n", "import React, { Fragment, lazy, Suspense } from 'https://esm.sh/react@18.2.0';\nimport {\n  createBrowserRouter,\n  Route,\n  RouterProvider,\n} from 'https://esm.sh/react-router-dom@6.7.0';\nimport { ToastProvider } from '../../../styles/components/toast/index.tsx';\n// import OvvioRouter from '../core/react-utils/history/index.tsx';\n// import { electronConstants } from '../shared/constants/electron-constants';\n// import TitleBarContainer from '../shared/electron-title-bar';\nimport LoginScreen from './login/index.tsx';\nimport { MobileBlocker } from './mobile-blocker.tsx';\n\n// if (isElectron()) {\n//   window\n//     .require('electron')\n//     .ipcRenderer.send('on-app-loaded', { constants: electronConstants });\n// }\n\nconst LazyApp = lazy(() => import('./index.tsx'));\n\nconst router = createBrowserRouter([]);\n\nexport default function LoginAsync() {\n  return (\n    // <FirebaseAppInit>\n    // <EventLoggerProvider>\n    <React.StrictMode>\n      <RouterProvider router={router} />\n      {/* <TitleBarContainer> */}\n      <ToastProvider>\n        <Route path=\"/\">\n          <LoginScreen>\n            <MobileBlocker>\n              <Suspense fallback={<Fragment />}>\n                <LazyApp />\n              </Suspense>\n            </MobileBlocker>\n          </LoginScreen>\n        </Route>\n      </ToastProvider>\n      {/* </TitleBarContainer> */}\n    </React.StrictMode>\n    //   </EventLoggerProvider>\n    // </FirebaseAppInit>\n  );\n}\n", "import React from 'https://esm.sh/react@18.2.0';\nimport { render } from 'https://esm.sh/react-dom@18.2.0';\nimport './index.css' assert { type: 'css' };\nimport AppAsync from './app/app-async.tsx';\n// import { unregister as unregisterServiceWorker } from './registerServiceWorker.js';\n\nrender(<AppAsync />, document.getElementById('root'));\n// unregisterServiceWorker();\n", "import React, { Fragment, lazy, Suspense } from 'https://esm.sh/react@18.2.0';\nimport { StyleProvider } from '../../../styles/css-objects/context.tsx';\n\nconst LazyLogin = lazy(() => import('./login-async.tsx'));\n\nexport default function AppAsync() {\n  return (\n    <StyleProvider dev={false}>\n      <Fragment>\n        <Suspense fallback={<Fragment />}>\n          <LazyLogin />\n        </Suspense>\n      </Fragment>\n    </StyleProvider>\n  );\n}\n"],
  "mappings": "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O,UAAgBL,CAAG,EAC5C,GAAI,EAAEK,aAAgBC,IACpB,OAIF,IAAIC,EAAa,GACjB,OAAW,CAACC,CAAK,IAAKC,GAAiBR,CAAI,EACzC,GAAIO,IAAU,aAAeA,IAAU,QAAUA,IAAU,QAAS,CAClED,EAAa,GACb,KACF,CAEEA,GAIJ,KAAK,kBAAkB,IAAIF,EAAK,IAAKxC,GAAoBwC,CAAI,CAAC,CAChE,CAEA,MAAM,cAA8B,CAClC,IAAMK,EAAQ,YAAY,IAAI,EAC9B,MAAMC,GAAmB,gBAAgB,EAAE,IACzC,KAAK,OAAO,eAAe,EAC1BC,GAAQ,CACFA,EAAI,WACP,KAAK,iBAAiBA,EAAI,IAAKA,EAAI,yBAAyB,EAAI,CAAC,CAErE,GAEF,EACA,KAAK,SAAW,GAChBC,GAAI,CACF,SAAU,OACV,KAAM,uBACN,MAAO,YAAY,IAAI,EAAIH,EAC3B,KAAM,eACN,UAAW,KAAK,kBAAkB,KAAK,EAAE,MAC3C,CAAC,CAEH,CACF,EAcMlC,GAAa,CACjB,OAAQ,CACN,eACA,eACA,eACA,qBACA,eACA,eACA,eACA,eACA,qBACA,eACA,eACA,eACA,2BACA,eACA,eACA,eACA,qBACA,iCACA,eACA,qBACA,eACA,eACA,qBACA,qBACA,uCACA,qBACA,qBACA,qBACA,qBACA,SACA,SACA,eACA,eACA,qBACA,iCACA,qBACA,qBACA,iCACA,eACA,qBACA,iCACA,2BACA,2BACA,qBACA,2BACA,SACA,2BACA,2BACA,qBACA,qBACA,eACA,SACA,eACA,2BACA,qBACA,2BACA,2BACA,2BACA,eACA,qBACA,qBACA,2BACA,qBACA,iCACA,eACA,qBACA,2BACA,2BACA,SACA,qBACA,qBACA,SACA,eACA,iCACA,2BACA,eACA,qBACA,qBACA,2BACA,2BACA,eACA,qBACA,qBACA,SACA,qBACA,2BACA,2BACA,iCACA,qBACA,2BACA,2BACA,qBACA,2BACA,qBACA,qBACA,qBACA,SACA,qBACA,2BACA,iCACA,2BACA,qBACA,2BACA,iCACA,2BACA,qBACA,SACA,qBACA,qBACA,qBACA,2BACA,iCACA,eACA,qBACA,qBACA,mDACA,qBACA,qBACA,eACA,2BACA,2BACA,2BACA,qBACA,2BACA,qBACA,qBACA,2BACA,eACA,uCACA,iCACA,2BACA,2BACA,2BACA,qBACA,iCACA,qBACA,qBACA,SACA,iCACA,qBACA,qBACA,2BACA,2BACA,2BACA,2BACA,qBACA,eACA,2BACA,qBACA,2BACA,2BACA,iCACA,2BACA,2BACA,iCACA,iCACA,2BACA,uCACA,iCACA,qBACA,SACA,qBACA,eACA,iCACA,iCACA,qBACA,qBACA,2BACA,uCACA,iCACA,qBACA,2BACA,qBACA,2BACA,iCACA,2BACA,iCACA,uCACA,qBACA,2BACA,2BACA,2BACA,iCACA,2BACA,iCACA,2BACA,qBACA,2BACA,qBACA,2BACA,2BACA,qBACA,qBACA,eACA,iCACA,uCACA,2BACA,2BACA,2BACA,wCACA,2BACA,2BACA,qBACA,qBACA,iCACA,eACA,qBACA,2BACA,iCACA,2BACA,iCACA,qBACA,qBACA,eACA,2BACA,2BACA,SACA,2BACA,6CACA,qBACA,iCACA,2BACA,uCACA,2BACA,iCACA,qBACA,SACA,uCACA,SACA,iCACA,SACA,2BACA,uCACA,qBACA,uCACA,2BACA,iCACA,2BACA,2BACA,2BACA,iCACA,eACA,2BACA,iCACA,iCACA,uCACA,iCACA,iCACA,iCACA,qBACA,eACA,iCACA,qBACA,uCACA,2BACA,iCACA,eACA,iCACA,qBACA,6CACA,2BACA,qBACA,2BACA,qBACA,qBACA,uCACA,qBACA,uCACA,qBACA,uCACA,qBACA,uCACA,iCACA,qBACA,qBACA,2BACA,qBACA,iCACA,iCACA,iCACA,2BACA,qBACA,qBACA,2BACA,iCACA,2BACA,2BACA,iCACA,SACA,uCACA,2BACA,iCACA,iCACA,2BACA,qBACA,eACA,2BACA,2BACA,qBACA,uCACA,2BACA,iCACA,qBACA,qBACA,qBACA,2BACA,qBACA,2BACA,eACA,2BACA,iCACA,2BACA,2BACA,2BACA,iCACA,iCACA,2BACA,2BACA,qBACA,iCACA,eACA,2BACA,2BACA,qBACA,6CACA,iCACA,2BACA,qBACA,iCACA,SACA,2BACA,qBACA,uCACA,iCACA,iCACA,iCACA,uCACA,uCACA,2BACA,iCACA,2BACA,2BACA,qBACA,uCACA,qBACA,qBACA,iCACA,iCACA,iCACA,uCACA,iCACA,iCACA,iCACA,2BACA,uCACA,6CACA,uCACA,2BACA,SACA,iCACA,uCACA,2BACA,iCACA,2BACA,eACA,2BACA,2BACA,iCACA,qBACA,mDACA,2BACA,6CACA,2BACA,6CACA,2BACA,2BACA,qBACA,qBACA,qBACA,qBACA,2BACA,2BACA,qBACA,iCACA,6CACA,qBACA,2BACA,2BACA,iCACA,qBACA,2BACA,eACA,2BACA,2BACA,2BACA,2BACA,2BACA,8CACA,2BACA,2BACA,iCACA,iCACA,uCACA,qBACA,2BACA,2BACA,uCACA,qBACA,2BACA,2BACA,qBACA,iCACA,qBACA,qBACA,iCACA,2BACA,qBACA,eACA,qBACA,eACA,iCACA,iCACA,uCACA,uCACA,iCACA,iCACA,6CACA,qBACA,iCACA,2BACA,uCACA,iCACA,iCACA,qBACA,2BACA,2BACA,6CACA,2BACA,uCACA,2BACA,2BACA,qBACA,2BACA,6CACA,qBACA,2BACA,iCACA,iCACA,qBACA,2BACA,iCACA,iCACA,iCACA,qBACA,iCACA,qBACA,qBACA,qBACA,qBACA,2BACA,2BACA,2BACA,iCACA,2BACA,2BACA,2BACA,2BACA,qBACA,6CACA,iCACA,qBACA,2BACA,2BACA,2BACA,qBACA,qBACA,2BACA,2BACA,iCACA,iCACA,qBACA,qBACA,iCACA,2BACA,SACA,qBACA,2BACA,iCACA,iCACA,qBACA,2BACA,2BACA,iCACA,2BACA,uCACA,eACA,IACA,QACA,QACA,QACA,QACA,UACA,MACA,OACA,KACA,KACA,MACA,MACA,MACA,SACA,KACA,KAEA,KACA,UACA,OACA,SACA,QACA,QAEA,OACA,MACA,KACA,MACA,SACA,QACA,OACA,QACA,WAEA,MACA,SACA,KACA,OACA,UACA,QACA,OACA,OACA,SACA,OACA,OACA,MACA,QACA,MACA,OACA,UACA,MAEA,KAEA,MACA,SACA,MACA,SACA,OACA,UACA,SACA,KACA,MAEA,MACA,OACA,SACA,OACA,UACA,MACA,MACA,UACA,MACA,MACA,QACA,IACA,KACA,KACA,MACA,KACA,KACA,OACA,KACA,QACA,KACA,OACA,SACA,OACA,OACA,OACA,QACA,OAEA,OACA,KACA,OACA,OACA,UACA,KACA,SACA,KACA,MACA,MACA,MACA,KACA,MACA,KACA,OAEA,OACA,KACA,QACA,QACA,MACA,QACA,YACA,MACA,OACA,MAEA,OACA,MACA,MACA,SACA,MACA,QACA,QACA,OACA,SACA,YACA,KACA,OACA,OAEA,OACA,OACA,SACA,MACA,QACA,SACA,OACA,aACA,OACA,QACA,UACA,QACA,OACA,SACA,UACA,UACA,UAEA,OACA,QACA,UACA,OACA,KACA,MAGA,QACA,KACA,KAEA,OACA,OACA,MACA,SACA,MACA,KACA,MACA,OACA,OACA,UACA,QACA,OACA,SACA,OACA,SACA,QACA,UACA,QACA,QACA,MACA,OACA,QACA,MACA,QACA,OACA,OACA,QAEA,QACA,WAEA,MACA,QACA,SACA,OACA,SACA,SACA,WACA,aACA,QACF,EACA,QAAS,CACP,QAAS,MACT,QAAS,MACT,QAAS,MACT,QAAS,MACT,QAAS,MACT,OAAQ,OACR,OAAQ,MACR,MAAO,KACP,MAAO,GACP,MAAO,KACP,MAAO,KACP,MAAO,MACP,MAAO,MACP,MAAO,KACP,MAAO,MACP,MAAO,KACP,MAAO,MACP,MAAO,GACP,KAAM,OACN,KAAM,OACN,KAAM,MACN,KAAM,KACN,KAAM,MACN,KAAM,MACN,KAAM,KACN,KAAM,GACN,KAAM,GACN,KAAM,GACN,KAAM,GACN,KAAM,GACN,KAAM,GACN,IAAK,IACL,IAAK,MACL,IAAK,GACL,IAAK,GACL,IAAK,GA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UAAAC,CAAU,EAAyB,CACzE,OACC,oBAAC,OACA,MAAM,6BACN,MAAM,MACN,OAAO,MACP,QAAQ,cACR,UAAWA,GACX,oBAAC,KAAE,KAAK,OAAO,SAAS,WACvB,oBAAC,QACA,KAAK,UACL,EAAE,iZACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,0IACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,8pBACH,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,UACL,GAAG,SACH,GAAG,SACH,UAAU,iCACX,EACA,oBAAC,WACA,GAAG,UACH,GAAG,SACH,KAAK,UACL,GAAG,MACH,GAAG,QACH,UAAU,+BACX,EACA,oBAAC,QACA,KAAK,UACL,EAAE,4SACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,2JACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,yDACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,4DACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,wIACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,sJACH,EACA,oBAAC,WACA,GAAG,SACH,GAAG,SACH,KAAK,UACL,GAAG,QACH,GAAG,QACH,UAAU,gCACX,EACA,oBAAC,QACA,KAAK,UACL,EAAE,uHACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,0MACH,EACA,oBAAC,KAAE,KAAK,WACP,oBAAC,QAAK,EAAE,uDAAuD,EAC/D,oBAAC,QAAK,EAAE,2JAA2J,CACpK,EACA,oBAAC,QACA,KAAK,UACL,EAAE,+GACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,uGACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,yKACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,4CACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,2CACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,2CACH,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,OACL,GAAG,QACH,GAAG,QACJ,EACA,oBAAC,QACA,KAAK,OACL,EAAE,mIACH,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,OACL,GAAG,QACH,GAAG,QACJ,EACA,oBAAC,QACA,KAAK,OACL,EAAE,2CACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,iDACH,EACA,oBAAC,KACA,KAAK,UACL,UAAU,4BACV,oBAAC,WACA,GAAG,QACH,GAAG,QACH,GAAG,QACH,GAAG,QACH,UAAU,8BACX,EACA,oBAAC,QAAK,EAAE,iIAAiI,EACzI,oBAAC,QAAK,EAAE,iDAAiD,CAC1D,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,UACL,GAAG,QACH,GAAG,QACH,UAAU,kCACX,EACA,oBAAC,QACA,KAAK,UACL,EAAE,yDACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,+EACH,EACA,oBAAC,QACA,KAAK,OACL,EAAE,8DACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,qDACH,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,UACL,GAAG,QACH,GAAG,OACH,UAAU,kCACX,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,UACL,GAAG,QACH,GAAG,QACH,UAAU,iCACX,EACA,oBAAC,QACA,KAAK,UACL,EAAE,4DACH,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,UACL,GAAG,QACH,GAAG,QACH,UAAU,gCACX,EACA,oBAAC,QACA,KAAK,UACL,EAAE,2JACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,2IACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,0JACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,wVACH,EACA,oBAAC,QACA,KAAK,OACL,EAAE,sDACH,EACA,oBAAC,QACA,KAAK,OACL,EAAE,gFACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,mSACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,4DACH,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,UACL,GAAG,SACH,GAAG,SACH,UAAU,kCACX,EACA,oBAAC,QACA,KAAK,UACL,EAAE,kKACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,uDACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,uNACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,qIACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,mKACH,EACA,oBAAC,QAAK,EAAE,2CAA2C,EACnD,oBAAC,QACA,KAAK,UACL,EAAE,wGACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,8IACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,kLACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,2VACH,EACA,oBAAC,QACA,KAAK,OACL,EAAE,iGACH,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,UACL,GAAG,QACH,GAAG,QACH,UAAU,kCACX,EACA,oBAAC,QACA,KAAK,UACL,EAAE,4DACH,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,UACL,GAAG,OACH,GAAG,QACH,UAAU,kCACX,EACA,oBAAC,QACA,KAAK,UACL,EAAE,mJACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,wDACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,iEACH,EACA,oBAAC,QACA,KAAK,OACL,EAAE,kDACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,iDACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,2CACH,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,OACL,GAAG,QACH,GAAG,QACJ,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,OACL,GAAG,QACH,GAAG,QACJ,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,OACL,GAAG,QACH,GAAG,QACJ,EACA,oBAAC,KAAE,KAAK,WACP,oBAAC,QAAK,EAAE,+KAA+K,EACvL,oBAAC,QAAK,EAAE,qIAAqI,CAC9I,EACA,oBAAC,QACA,KAAK,UACL,EAAE,2IACH,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,UACL,GAAG,QACH,GAAG,QACJ,EACA,oBAAC,WACA,GAAG,SACH,GAAG,UACH,KAAK,UACL,GAAG,QACH,GAAG,QACJ,EACA,oBAAC,WACA,GAAG,UACH,GAAG,SACH,KAAK,UACL,GAAG,QACH,GAAG,QACJ,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,UACL,GAAG,QACH,GAAG,QACJ,EACA,oBAAC,WACA,GAAG,UACH,GAAG,SACH,KAAK,UACL,GAAG,QACH,GAAG,QACJ,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,UACL,GAAG,QACH,GAAG,QACJ,EACA,oBAAC,QACA,KAAK,UACL,EAAE,6IACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,kJACH,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,UACL,GAAG,QACH,GAAG,QACH,UAAU,kCACX,EACA,oBAAC,QACA,KAAK,UACL,EAAE,wDACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,mDACH,EACA,oBAAC,WACA,GAAG,UACH,GAAG,SACH,KAAK,UACL,GAAG,OACH,GAAG,QACH,UAAU,gCACX,EACA,oBAAC,QACA,KAAK,UACL,EAAE,wDACH,EACA,oBAAC,QACA,KAAK,OACL,EAAE,uFACH,EACA,oBAAC,WACA,GAAG,SACH,GAAG,UACH,KAAK,UACL,GAAG,QACH,GAAG,QACH,UAAU,gCACX,EACA,oBAAC,KACA,KAAK,UACL,UAAU,6BACV,oBAAC,QAAK,EAAE,6HAA6H,EACrI,oBAAC,WACA,GAAG,QACH,GAAG,QACH,GAAG,OACH,GAAG,QACH,UAAU,8BACX,EACA,oBAAC,QAAK,EAAE,8CAA8C,CACvD,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,UACL,GAAG,QACH,GAAG,QACH,UAAU,kCACX,EACA,oBAAC,QACA,KAAK,UACL,EAAE,2DACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,oFACH,EACA,oBAAC,QACA,KAAK,OACL,EAAE,gEACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,wDACH,EACA,oBAAC,WACA,GAAG,UACH,GAAG,SACH,KAAK,UACL,GAAG,QACH,GAAG,OACH,UAAU,iCACX,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,UACL,GAAG,QACH,GAAG,QACJ,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,UACL,GAAG,OACH,GAAG,QACJ,EACA,oBAAC,WACA,GAAG,UACH,GAAG,UACH,KAAK,UACL,GAAG,QACH,GAAG,QACH,UAAU,kCACX,EACA,oBAAC,QACA,KAAK,UACL,EAAE,2KACH,EACA,oBAAC,QACA,KAAK,OACL,EAAE,yDACH,EACA,oBAAC,QACA,KAAK,OACL,EAAE,qFACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,2JACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,yDACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,sGACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,oGACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,4KACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,uKACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,yRACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,8KACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,8PACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,yDACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,6IACH,EACA,oBAAC,QACA,KAAK,OACL,EAAE,wFACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,wDACH,EACA,oBAAC,QACA,KAAK,OACL,EAAE,wEACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,4HACH,EACA,oBAAC,WACA,GAAG,SACH,GAAG,UACH,KAAK,UACL,GAAG,QACH,GAAG,QACJ,EACA,oBAAC,WACA,GAAG,UACH,GAAG,SACH,KAAK,UACL,GAAG,QACH,GAAG,QACJ,EACA,oBAAC,WACA,GAAG,SACH,GAAG,UACH,KAAK,UACL,GAAG,QACH,GAAG,QACH,UAAU,iCACX,EACA,oBAAC,WACA,GAAG,SACH,GAAG,UACH,KAAK,UACL,GAAG,QACH,GAAG,QACJ,EACA,oBAAC,QACA,KAAK,UACL,EAAE,2DACH,EACA,oBAAC,QACA,KAAK,UACL,EAAE,2DAC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",
  "names": ["useSSRInstantEffect", "effect", "deps", "import_react_18_2", "import_react_dom_18_2", "isServerSide", "_isNextJs", "isNextJs", "useIsomorphicLayoutEffect", "createUniversalPortal", "init_ssr", "__esmMin", "children", "container", "key", "rootKey", "ReactDOM", "StyleTag", "dev", "ctx", "StyleContext", "reffedDev", "isServerSide", "ssrStyle", "style", "initialRules", "tryAppendRule", "rule", "index", "sheet", "error", "i", "React", "getCss", "c", "res", "x", "useEnsureAttached", "import_react_18_2", "CssRegistry", "__CssRegistry", "StyleProvider", "init_context", "__esmMin", "init_ssr", "styles", "css", "fn", "listener", "children", "componentToHex", "component", "hex", "rgbToHex", "g", "b", "hexToRgb", "r", "makeTransparent", "a", "background", "backR", "backG", "backB", "diffAlpha", "newColor", "useTheme", "themeContext", "ThemeProvider", "theme", "children", "isRoot", "style", "key", "value", "React", "import_react_18_2", "lightColorWheel", "brandLightTheme", "lightTheme", "darkTheme", "cssTheme", "init_theme", "__esmMin", "genId", "chars", "autoId", "i", "defaultUnitForProperty", "prop", "getSeparatorForKey", "key", "stringify", "val", "x", "formatKey", "toCss", "obj", "currentSelector", "isClass", "keepSelector", "ns", "selector", "isMediaQuery", "currentRuleBuilder", "result", "basedOn", "sel", "k", "rule", "getStyle", "object", "styles", "accum", "isCssFn", "classnames", "arr", "useStylesInternal", "ctxAttach", "useEnsureAttached", "useIsomorphicLayoutEffect", "cn", "makeStyles", "opts", "cssTheme", "cname", "useStyles", "keyframes", "def", "name", "css", "frame", "style", "animation", "__CssRegistry", "import_react_18_2", "init_css_objects", "__esmMin", "init_context", "init_theme", "init_ssr", "uniqueId", "length", "chars", "autoId", "i", "unionIter", "args", "iter", "v", "newInstance", "instance", "mapIterable", "input", "mapper", "filterIterable", "filter", "init_common", "__esmMin", "timing", "duration", "transition", "styleguide", "init_styleguide", "__esmMin", "layout", "init_layout", "__esmMin", "init_css_objects", "makeStyles", "import_react_18_2", "rotator", "offset", "dash", "duration", "useStyles", "SpinnerView", "spinner_view_default", "init_spinner_view", "__esmMin", "init_css_objects", "init_styleguide", "keyframes", "makeStyles", "theme", "size", "styleguide", "color", "styles", "props", "style", "React", "cn", "useWindowSize", "size", "setSize", "handler", "import_react_18_2", "init_use_window_size", "__esmMin", "getDevice", "screenWidth", "MediaQueries", "useCurrentDevice", "init_responsive", "__esmMin", "init_ssr", "init_use_window_size", "isServerSide", "width", "useWindowSize", "import_react_18_2", "FontFamily", "useStyles", "H1", "H2", "H3", "H4", "Text", "TextSm", "Bold", "Label", "LabelSm", "init_typography", "__esmMin", "init_css_objects", "init_responsive", "init_theme", "makeStyles", "brandLightTheme", "MediaQueries", "React", "children", "className", "props", "ref", "styles", "cn", "makeButton", "useStyles", "className", "React", "props", "ref", "styles", "cn", "import_react_18_2", "colorTransition", "useButtonStyles", "useFabStyles", "useIconButtonStyles", "useSecondaryButtonStyles", "useRaisedButtonStyles", "useLinkButtonStyles", "Button", "FabButton", "IconButton", "LinkButton", "RaisedButton", "SecondaryButton", "init_buttons", "__esmMin", "init_css_objects", "init_styleguide", "init_layout", "init_spinner_view", "init_typography", "init_theme", "styleguide", "makeStyles", "FontFamily", "layout", "brandLightTheme", "theme", "children", "disabled", "color", "processing", "rest", "spinner_view_default", "useMountedIndicator", "isMountedRef", "import_react_18_2", "init_use_mounted_indicator", "__esmMin", "useTransitionedOpen", "open", "animationDuration", "styleguide", "visibility", "setVisibility", "prevOpen", "isMounted", "useMountedIndicator", "animDuration", "nextState", "timeout", "useTransitioningChildren", "children", "duration", "timers", "TimersCounter", "toArray", "x", "newChildren", "setNewChildren", "setWrapped", "fn", "args", "c", "childArray", "item", "newProps", "timerId", "things", "i", "React", "existing", "index", "TransitionGroup", "import_react_18_2", "useStyles", "init_transition", "__esmMin", "init_styleguide", "init_css_objects", "init_use_mounted_indicator", "makeStyles", "theme", "key", "timeoutId", "action", "Toast", "message", "dismiss", "transitionState", "styles", "useStyles", "processing", "setProcessing", "onClick", "React", "cn", "layout", "Button", "ToastsView", "messages", "ReactDOM", "TransitionGroup", "msg", "ToastProvider", "children", "setMessages", "mounted", "presentToast", "toastInfo", "uniqueId", "msgs", "x", "toastContext", "import_react_18_2", "import_react_dom_18_2", "enterAnimation", "exitAnimation", "exitAnimationLast", "useToastController", "init_toast", "__esmMin", "init_css_objects", "init_common", "init_styleguide", "init_layout", "init_buttons", "init_transition", "keyframes", "makeStyles", "theme", "styleguide", "init_styles", "__esmMin", "init_layout", "init_styleguide", "SeverityFromCode", "code", "SeverityCodes", "normalizeLogEntry", "e", "res", "uniqueId", "field", "length", "chars", "autoId", "i", "init_entry", "__esmMin", "import_mod", "kLogFileExpirationMs", "kLogFileMaxSizeBytes", "ConsoleLogStream", "init_stream", "__esmMin", "init_entry", "severity", "SeverityFromCode", "textLog", "setGlobalLoggerStreams", "streams", "gLogStreams", "resetGlobalLoggerStreams", "kDefaultLoggerStreams", "log", "entry", "outputStreams", "SeverityCodes", "gLogLevel", "e", "normalizeLogEntry", "stream", "GlobalLogger", "init_log", "__esmMin", "init_entry", "init_stream", "ConsoleLogStream", "notImplemented", "error", "log", "notReached", "msg", "assert", "condition", "init_error", "__esmMin", "init_log", "avg", "values", "result", "count", "v", "randomInt", "min", "max", "MovingAverage", "init_math", "__esmMin", "readingsCount", "equal", "arr1", "arr2", "comparator", "i", "append", "arr", "values", "v", "init_array", "__esmMin", "init_math", "numbersEqual", "n1", "n2", "mapsEqual", "m1", "m2", "key", "value", "deepEqual", "objectsEqual", "obj1", "obj2", "keys1", "keys2", "k", "setsEqual", "s1", "s2", "s2Copy", "v1", "match", "v2", "a", "b", "isNumber", "isMapLike", "isArray", "equal", "x", "y", "isObject", "v", "isString", "isBoolean", "isUndefined", "isDefined", "isNoValue", "isImmutable", "isGenerator", "obj", "init_comparisons", "__esmMin", "init_array", "init_base", "__esmMin", "_noClone", "v", "HashSet", "HashMap", "init_hash_map", "__esmMin", "hash", "eq", "clone", "key", "map", "values", "candidate", "len", "i", "arr", "entryClone", "entry", "result", "e1", "e2", "value", "e", "dictToPrimitive", "map", "result", "k", "dictFromPrimitive", "dictEquals", "dic1", "dic2", "comparer", "v1", "v2", "key", "value1", "value2", "isDictionary", "val", "HashMap", "init_dict", "__esmMin", "init_hash_map", "getCoreTypeOrUndef", "value", "isDictionary", "isGenerator", "getCoreType", "type", "notReached", "isClonable", "v", "isComparable", "isEquatable", "isEncodable", "isReadonlyCoreObject", "init_utils", "__esmMin", "init_comparisons", "init_error", "init_dict", "init_base", "coreValueClone", "e", "opts", "internalCoreValueClone", "coreObjectClone", "obj", "objectsCache", "getCoreType", "arr", "v", "set", "result", "cached", "newObj", "k", "newMap", "item", "isClonable", "fRes", "notReached", "init_clone", "__esmMin", "init_error", "init_base", "init_utils", "murmurhash2_32_gc", "str", "seed", "l", "h", "i", "k", "MurmurHash3", "sharedMurmur3", "init_hash", "__esmMin", "init_math", "randomInt", "key", "h1", "k1", "top", "len", "serializeDate", "date", "isNumber", "deserializeDate", "d", "r", "formatTimeDiff", "now", "year", "month", "day", "daysDiff", "init_date", "__esmMin", "init_comparisons", "isEncodedSet", "v", "getCoreType", "obj", "isEncodedDate", "isEncodedEncodable", "BaseEncoder", "JSONBaseEncoder", "init_base_encoder", "__esmMin", "init_comparisons", "init_date", "init_dict", "init_base", "init_utils", "opts", "key", "value", "options", "isEncodable", "iterableFilter", "isDictionary", "isObject", "keyFilter", "k", "isGenerator", "encoder", "iterable", "result", "item", "arr", "set", "n", "_options", "str", "b", "date", "serializeDate", "dictToPrimitive", "g", "md5cycle", "x", "k", "a", "b", "c", "d", "ff", "gg", "hh", "ii", "add32", "cmn", "q", "s", "t", "init", "update", "state", "len", "i", "md5blk", "finalize", "n", "l", "tail", "hex", "md5blks", "rhex", "j", "hex_chr", "init_md5", "__esmMin", "ChecksumEncoder", "MD5Checksum", "Murmur3Checksum", "init_checksum", "__esmMin", "init_math", "init_common", "init_hash", "init_date", "init_base_encoder", "init_utils", "init_md5", "BaseEncoder", "opts", "newInstance", "data", "keys", "typeSafe", "state", "k", "key", "value", "_options", "options", "type", "getCoreType", "converted", "encoder", "set", "checksums", "iterableFilter", "v", "arr", "g", "obj", "keyFilter", "n", "b", "str", "date", "serializeDate", "init", "update", "finalize", "randomInt", "MurmurHash3", "encodableValueHash", "v", "options", "kMurmurEncoder", "init_hash", "__esmMin", "init_checksum", "Murmur3Checksum", "coreValueCompare", "v1", "v2", "options", "MinComparableValue", "MaxComparableValue", "extRes", "type1", "getCoreType", "type2", "coreIterableCompare", "isComparable", "isEquatable", "notReached", "hash1", "encodableValueHash", "hash2", "i1", "i2", "iter1", "iter2", "val1", "val2", "iterableFilter", "cmp", "init_comparable", "__esmMin", "init_error", "init_base", "init_hash", "init_utils", "subtract", "v1", "v2", "s2", "result", "v", "equals", "filter", "s1", "equalsC", "union", "i1", "i2", "inPlace", "unionIter", "iter", "item", "set", "other", "map", "input", "mapper", "mapToArray", "s", "update", "iterable", "from", "hasByValue", "isImmutable", "x", "deepEqual", "addByValue", "foundMatch", "subtractByValue", "unionByValue", "toggleMembership", "init_set", "__esmMin", "init_comparisons", "coreIterableEquals", "i1", "i2", "iterableFilter", "options", "iter1", "iter2", "val1", "val2", "coreValueEquals", "setLongMatch", "s1", "s2", "matchCount", "v1", "foundMatch", "v2", "e1", "e2", "t1", "getCoreType", "t2", "numbersEqual", "arr1", "arr2", "i", "equals", "obj1", "obj2", "k", "dictEquals", "g1", "g2", "isEquatable", "isComparable", "init_equals", "__esmMin", "init_dict", "init_base", "init_utils", "init_comparisons", "init_set", "init_core_types", "__esmMin", "init_base", "init_utils", "init_clone", "init_comparable", "init_equals", "isDecoderConfig", "v", "init_utils", "__esmMin", "init_encoding", "__esmMin", "init_utils", "init_hash", "isEncodedRef", "v", "getCoreType", "isEncodedRefObject", "obj", "RefSet", "BaseCyclicalEncoder", "init_cyclical", "__esmMin", "init_comparisons", "init_clone", "init_base", "init_utils", "val", "key", "value", "options", "isObject", "refSet", "refsMap", "refId", "ref", "refData", "coreValueClone", "set", "item", "iterableFilter", "_", "k", "JSONEncoder", "JSONCyclicalEncoder", "JSONDecoder", "JSONCyclicalDecoder", "init_json", "__esmMin", "init_base", "init_utils", "init_base_encoder", "init_cyclical", "init_common", "init_date", "JSONBaseEncoder", "newInstance", "value", "key", "_options", "BaseCyclicalEncoder", "prev", "refId", "map", "options", "a", "b", "e", "obj", "encoder", "encodedValue", "defaultValue", "val", "item", "isEncodedSet", "isEncodedDate", "isEncodedEncodable", "getCoreType", "offset", "v", "set", "deserializeDate", "jsonObj", "k", "isEncodedRefObject", "isEncodedRef", "Change", "init_change", "__esmMin", "init_error", "init_encoding", "config", "isDecoderConfig", "assert", "encoder", "_options", "FieldChange", "init_field_change", "__esmMin", "init_error", "init_types", "init_encoding", "init_change", "Change", "config", "isDecoderConfig", "decoder", "typeOP", "getTypeOperations", "assert", "other", "valueTypeEquals", "encoder", "_options", "value", "valueType", "CoreTypeOperations", "init_core_type", "__esmMin", "init_field_change", "init_core_types", "encType", "valueType", "value", "refs", "getCoreTypeOrUndef", "val1", "val2", "options", "coreValueEquals", "coreValueClone", "key", "encoder", "value2", "FieldChange", "value1", "keyMapping", "deleteRefs", "MapTypeOperations", "init_map_type", "__esmMin", "init_dict", "init_core_type", "init_field_change", "init_core_types", "CoreTypeOperations", "isRef", "valueType", "curValue", "changes", "options", "change", "FieldChange", "curMap", "k", "v", "coreValueEquals", "map1", "map2", "insertMap", "deleteMap", "key", "value1", "value2", "value", "dict", "dictFromPrimitive", "newMap", "refs", "keyMapping", "deleteRefs", "result", "PrimitiveTypeOperations", "init_primitive_type", "__esmMin", "init_types", "init_core_type", "init_field_change", "CoreTypeOperations", "curValue", "changes", "options", "change", "FieldChange", "valueTypeEquals", "value1", "value2", "value", "SetTypeOperations", "init_set_type", "__esmMin", "init_core_type", "init_field_change", "init_core_types", "init_set", "CoreTypeOperations", "isRef", "valueType", "curValue", "changes", "options", "change", "FieldChange", "unionByValue", "newValue", "subtractByValue", "refs", "value", "val", "keyMapping", "deleteRefs", "result", "v", "value1", "value2", "added", "removed", "desValue", "from", "StringTypeOperations", "init_string_type", "__esmMin", "init_types", "init_core_types", "init_primitive_type", "PrimitiveTypeOperations", "isRef", "refs", "value", "kNonAlphaNumericRegex_", "kWhitespaceRegex_", "kLinebreakRegex_", "kBlanklineEndRegex_", "kBlanklineStartRegex_", "DIFF_DELETE", "DIFF_INSERT", "DIFF_EQUAL", "DiffMatchPatch", "Patch", "init_diff_match_patch", "__esmMin", "text1", "text2", "opt_checklines", "opt_deadline", "deadline", "checklines", "commonlength", "commonprefix", "commonsuffix", "diffs", "longtext", "shorttext", "i", "hm", "text1_a", "text1_b", "text2_a", "text2_b", "mid_common", "diffs_a", "diffs_b", "a", "linearray", "pointer", "count_delete", "count_insert", "text_delete", "text_insert", "subDiff", "j", "text1_length", "text2_length", "max_d", "v_offset", "v_length", "v1", "v2", "x", "delta", "front", "k1start", "k1end", "k2start", "k2end", "d", "k1", "k1_offset", "x1", "y1", "k2_offset", "x2", "k2", "y2", "y", "text1a", "text2a", "text1b", "text2b", "diffsb", "lineArray", "lineHash", "diff_linesToCharsMunge_", "text", "chars", "lineStart", "lineEnd", "lineArrayLength", "line", "maxLines", "chars1", "chars2", "pointermin", "pointermax", "pointermid", "pointerstart", "pointerend", "text_length", "best", "length", "pattern", "found", "dmp", "diff_halfMatchI_", "seed", "best_common", "best_longtext_a", "best_longtext_b", "best_shorttext_a", "best_shorttext_b", "prefixLength", "suffixLength", "hm1", "hm2", "changes", "equalities", "equalitiesLength", "lastEquality", "length_insertions1", "length_deletions1", "length_insertions2", "length_deletions2", "deletion", "insertion", "overlap_length1", "overlap_length2", "diff_cleanupSemanticScore_", "one", "two", "char1", "char2", "nonAlphaNumeric1", "nonAlphaNumeric2", "whitespace1", "whitespace2", "lineBreak1", "lineBreak2", "blankLine1", "blankLine2", "equality1", "edit", "equality2", "commonOffset", "commonString", "bestEquality1", "bestEdit", "bestEquality2", "bestScore", "score", "pre_ins", "pre_del", "post_ins", "post_del", "loc", "last_chars1", "last_chars2", "html", "pattern_amp", "pattern_lt", "pattern_gt", "pattern_para", "op", "levenshtein", "insertions", "deletions", "data", "diffsLength", "tokens", "param", "n", "s", "match_bitapScore_", "e", "accuracy", "proximity", "score_threshold", "best_loc", "matchmask", "bin_min", "bin_mid", "bin_max", "last_rd", "start", "finish", "rd", "charMatch", "patch", "padding", "prefix", "suffix", "opt_b", "opt_c", "patches", "patchDiffLength", "char_count1", "char_count2", "prepatch_text", "postpatch_text", "diff_type", "diff_text", "patchesCopy", "patchCopy", "nullPadding", "results", "expected_loc", "start_loc", "end_loc", "index1", "index2", "mod", "paddingLength", "extraLength", "patch_size", "bigpatch", "start1", "start2", "precontext", "empty", "postcontext", "textline", "textPointer", "patchHeader", "m", "sign", "coords1", "coords2", "kDMP", "init_defs", "__esmMin", "init_diff_match_patch", "DiffMatchPatch", "kReservedCodePoints", "kNewlineCodePoint", "StringRep", "init_string_rep", "__esmMin", "init_error", "init_hash_map", "init_core_types", "init_hash", "init_flat_rep", "opts", "HashMap", "v", "encodableValueHash", "v1", "v2", "coreValueEquals", "iter", "dict", "reverseMapping", "result", "value", "isElementSpacer", "encodedChar", "assert", "str", "len", "i", "codePoint", "kElementSpacer", "recursiveFlattenTextNodes", "changeNodes", "node", "isTextNode", "atom", "flattenTextNode", "isElementNode", "MergeContext", "init_merge_context", "__esmMin", "init_diff_match_patch", "init_error", "init_defs", "init_core_types", "init_flat_rep", "init_string_rep", "init_tree", "init_array", "origValues", "eqOpts", "index", "start", "end", "i", "value", "insertions", "curValue", "change", "assert", "deletions", "idx", "origAtom", "insertedValues", "v", "getCoreType", "insertedValue", "strRep", "StringRep", "curStr", "newStr", "textDiffs", "kDMP", "result", "diff", "append", "diffs", "length", "text1Idx", "text2Idx", "changeIdx", "op", "text", "DIFF_EQUAL", "DIFF_DELETE", "DIFF_INSERT", "isTreeNode", "node", "isReadonlyCoreObject", "isDepthMarker", "isPointer", "isPointerValue", "isElementSpacer", "obj", "getFrozenTextNode", "char", "dict", "gFrozenTextNodes", "result", "coreValueClone", "kCoreValueTreeNodeOpts", "unfreezeTextNode", "pointersForNode", "ptrSet", "local", "offset", "ptr", "flattenTextNode", "sortedPointers", "trailingTextNode", "idx", "c", "ptrAtom", "emittedEmptyText", "splitTextNodeOnPointers", "sortedPtrsForNode", "p1", "p2", "comparePointers", "nodeText", "start", "flattenChildNodes", "parent", "parentDepth", "flattenText", "children", "didOpen", "child", "atom", "flattenTreeNode", "depth", "isTextNode", "v", "isElementNode", "kElementSpacer", "flattenRichText", "rt", "flattenSiblingNodes", "stripDuplicatePointers", "ptrs", "HashSet", "encodableValueHash", "p", "iter", "pointers", "flatAtom", "cleanCloneTreeAtomField", "key", "_opts", "getCoreType", "reconstructPointers", "flatRep", "outPtrs", "pendingTextNode", "reconstructTextNodes", "ptrOffsetter", "lastTextNode", "coreValueEquals", "kFilterTextField", "i", "reconstructRichText", "root", "path", "charPointersMap", "deletedNode", "newNode", "newOffset", "value", "lastChild", "notReached", "convertPtrsToValues", "kCoreValuePtrToValue", "filterExpiredPointers", "isExpiredPointer", "filteredPointersRep", "filter", "outFilteredPointers", "flatDestForPointerProjection", "dstRt", "needFilter", "flat", "pointerIsExpired", "expiration", "hasPointersToProject", "skipExpired", "projectPointers", "srcRt", "filterDest", "ptrsToProject", "flatRepSrc", "strRep", "StringRep", "str1", "str2", "textDiffs", "kDMP", "mergeCtx", "MergeContext", "srcIdx", "ptrValue", "stripFormattingFilter", "hasOpenParagraph", "isTrivialTextNode", "copy", "init_flat_rep", "__esmMin", "init_error", "init_defs", "init_hash_map", "init_core_types", "init_encoding", "init_merge_context", "init_string_rep", "init_tree", "HashMap", "v1", "v2", "isRichText", "v", "isReadonlyCoreObject", "isElementNode", "onlyNoneLocal", "treeAtomKeyFilterIgnoreText", "key", "obj", "isPointer", "isTextNode", "node", "isNodeSameLocality", "n1", "n2", "isTrivialTextNode", "k", "comparePointers", "ptr1", "ptr2", "initRichText", "initRichTextRoot", "dfs", "root", "mutate", "_depth", "_path", "children", "child", "value", "assert", "isExpiredPointer", "buffer", "purgeExpiredPointers", "rt", "now", "foundExpired", "ptr", "newPtrs", "result", "pointersForNode", "ptrSet", "local", "offset", "treeToPlaintext", "prevDepth", "depth", "kCoreValueTreeNodeOpts", "init_tree", "__esmMin", "init_error", "init_core_types", "init_flat_rep", "isRefNode", "atom", "isReadonlyCoreObject", "isRefMarker", "init_model", "__esmMin", "init_core_types", "init_tree", "RichTextChange", "init_richtext_change", "__esmMin", "init_change", "init_core_types", "init_encoding", "Change", "config", "isDecoderConfig", "encoder", "opts", "coreValueClone", "other", "coreValueEquals", "cleanCopyElementNodes", "flatRep", "atom", "isElementNode", "copy", "coreValueClone", "kCoreValueTreeNodeOpts", "decodeStringDiff", "diff", "strRep", "cmd", "MergeContext", "values", "convertPtrsToValues", "reconstructTextNodes", "config", "RichTextChange", "rt1", "rt2", "local", "coreValueEquals", "StringRep", "str1", "flattenRichText", "str2", "textDiffs", "kDMP", "patch", "base", "changes", "mergeCtx", "c", "reconstructRichText", "init_diff_patch", "__esmMin", "init_richtext_change", "init_tree", "init_merge_context", "init_string_rep", "init_defs", "init_flat_rep", "init_core_types", "userDefinedRules", "inlineElementTags", "init_setup", "__esmMin", "init_tree", "n", "firstChild", "isElementNode", "getKeysForNode", "node", "tagsCache", "tags", "isElementNode", "ELEMENT_KEYS", "isTextNode", "TEXT_KEYS", "isRefMarker", "REF_MARKER_KEYS", "NON_KEYS", "getRuleActions", "parent", "grandParent", "key", "rules", "rule", "checkCondition", "condition", "nodeTagName", "nodeIsElement", "convertNodeCondition", "keys", "ELEMENT_KEY", "NOT_ELEMENT_KEY", "TEXT_KEY", "NOT_TEXT_KEY", "REF_MARKER_KEY", "NOT_REF_MARKER_KEY", "convertRuleCondition", "converted", "union", "convertSetupRules", "uRule", "userDefinedRules", "init_rules", "__esmMin", "init_model", "init_tree", "init_setup", "init_set", "normalizeRichText", "richText", "coreValueClone", "stripTrivialTextNodes", "reconstructRichText", "flattenRichText", "runNodeRules", "initRichTextRoot", "hasPointers", "node", "ptrSet", "_", "pointersForNode", "rt", "_depth", "path", "dfs", "isTrivialTextNode", "parent", "idx", "assert", "grandParent", "gpIndex", "i", "counter", "result", "child", "action", "getRuleActions", "newParent", "toI", "isElementNode", "isTextNode", "tIndex", "newNode", "fTextOrInline", "isTextOrInline", "j", "newP", "brother", "firstChild", "isNodeSameLocality", "inlineElementTags", "init_normalize", "__esmMin", "init_error", "init_core_types", "init_flat_rep", "init_tree", "init_rules", "init_setup", "kCoreValueOpts", "expiredPointersBuffer", "RichText3TypeOperations", "init_richtext3_type", "__esmMin", "init_model", "init_types", "init_core_types", "init_diff_patch", "init_flat_rep", "init_normalize", "init_tree", "init_core_type", "treeAtomKeyFilterIgnoreText", "CoreTypeOperations", "curValue", "changes", "_options", "initRichText", "patch", "val", "normalizeRichText", "value", "isRichText", "key", "encoder", "options", "local", "flat", "flattenRichText", "func", "onlyNoneLocal", "value2", "empty", "diff", "value1", "_value", "val1", "val2", "coreValueEquals", "coreValueClone", "pointer", "isExpiredPointer", "purgeExpiredPointers", "refs", "node", "dfs", "isRefMarker", "keyMapping", "deleteRefs", "_depth", "path", "children", "DateTypeOperations", "init_date_type", "__esmMin", "init_date", "init_types", "init_core_types", "init_primitive_type", "PrimitiveTypeOperations", "value", "options", "date", "deserializeDate", "isRefValueType", "type", "getTypeOperations", "op", "typeOperations", "getTypeOperationsByValue", "value", "typeOP", "registerTypeOperations", "register", "StringTypeOperations", "PrimitiveTypeOperations", "DateTypeOperations", "SetTypeOperations", "MapTypeOperations", "RichText3TypeOperations", "valueTypeEquals", "value1", "value2", "options", "init_types", "__esmMin", "init_map_type", "init_primitive_type", "init_set_type", "init_string_type", "init_richtext3_type", "init_core_types", "init_date_type", "decodeChange", "decoder", "type", "FieldChange", "RichTextChange", "notReached", "init_decode", "__esmMin", "init_field_change", "init_richtext_change", "init_error", "isValidData", "scheme", "data", "requiredFields", "k", "validateFieldTypes", "fieldsScheme", "key", "value", "type", "getTypeOperations", "serialize", "encoder", "options", "overrides", "assert", "e", "log", "deserialize", "decoder", "decValue", "equals", "fields", "data1", "data2", "valueTypeEquals", "clone", "onlyFields", "result", "typeOP", "diff", "schemeFields", "changes", "addChanges", "field", "fChanges", "change", "value1", "value2", "patch", "newValue", "getRefs", "refs", "normalize", "needGC", "gc", "diffKeys", "decodedDataChanges", "dec", "v", "decodeChange", "concatChanges", "changes1", "changes2", "fromChanges", "rewriteRefs", "keyMapping", "deleteRefs", "init_object", "__esmMin", "init_error", "init_types", "init_decode", "init_log", "SchemeNamespace", "namespaces", "NS_WORKSPACE", "NS_NOTES", "NS_TAGS", "NS_USERS", "NS_USER_SETTINGS", "NS_ORGANIZATION", "NS_FILTER", "TYPE_STR", "TYPE_NUMBER", "TYPE_DATE", "TYPE_RICHTEXT_V3", "TYPE_STR_SET", "TYPE_SET", "TYPE_REF", "TYPE_REF_SET", "TYPE_MAP", "TYPE_REF_MAP", "kRecordIdField", "SchemeDef", "FilterSortByValues", "init_scheme_types", "__esmMin", "init_types", "key", "namespace", "fieldDescriptors", "repositoryFieldName", "fields", "removeFields", "newFields", "f", "runRegister", "manager", "SCHEME_WORKSPACE_1", "SCHEME_USER_1", "SCHEME_NOTE_1", "SCHEME_TAG_1", "SCHEME_NOTE_2", "namespace", "data", "NS_NOTES", "att", "isString", "tagMap", "v", "SCHEME_NOTE_3", "notReached", "SCHEME_WORKSPACE_2", "NS_WORKSPACE", "SCHEME_WORKSPACE_3", "SCHEME_NOTE_4", "SCHEME_WORKSPACE_4", "SCHEME_USER_2", "SCHEME_USER_SETTINGS_1", "SCHEME_TAG_2", "SCHEME_FILTER_1", "SCHEME_NOTE_5", "NS_TAGS", "NS_USERS", "SCHEME_BASE_1", "SCHEME_CONTENT_BASE_1", "init_scheme_versions", "__esmMin", "init_comparisons", "init_scheme_types", "init_tree", "init_error", "SchemeDef", "TYPE_DATE", "TYPE_NUMBER", "rec", "TYPE_STR", "TYPE_REF", "TYPE_REF_SET", "TYPE_MAP", "TYPE_REF_MAP", "TYPE_STR_SET", "TYPE_SET", "NS_USER_SETTINGS", "TYPE_RICHTEXT_V3", "initRichText", "NS_FILTER", "normalizeFieldDescriptors", "descriptors", "types", "requiredFields", "k", "desc", "isString", "Scheme", "SchemeVersion", "managerLoadFunc", "SchemeManager", "init_scheme", "__esmMin", "init_error", "init_comparisons", "init_core_types", "init_encoding", "init_json", "init_object", "init_scheme_types", "init_scheme_versions", "init_types", "config", "isDecoderConfig", "decoder", "namespace", "version", "scheme", "fieldName", "type", "assert", "isNoValue", "isRefValueType", "data", "oldScheme", "oldNS", "oldVersion", "oldData", "newVersion", "newData", "clone", "curVersion", "upFunc", "otherScheme", "coreValueEquals", "encoder", "other", "JSONEncoder", "obj", "JSONDecoder", "kRecordIdField", "NS_WORKSPACE", "NS_NOTES", "NS_TAGS", "NS_USERS", "NS_ORGANIZATION", "ns", "key", "keyLen", "start", "end", "def", "newScheme", "manager", "runRegister", "instance", "schemeDefs", "extraNamespaces", "schVersion", "prevScheme", "v", "checksumSerOptions", "Record", "init_record", "__esmMin", "init_error", "init_comparisons", "init_scheme", "init_object", "init_encoding", "init_json", "init_scheme_types", "init_checksum", "config", "isDecoderConfig", "assert", "isObject", "Scheme", "isValidData", "csEncoder", "MD5Checksum", "serialize", "getRefs", "fieldName", "kRecordIdField", "repoId", "key", "defaultValue", "data", "isNoValue", "value", "success", "other", "local", "equals", "scheme", "result", "clone", "onlyFields", "record", "diff", "changes", "patch", "diffKeys", "newScheme", "normalize", "gc", "needGC", "encoder", "options", "dataEncoder", "decoder", "deserialize", "JSONCyclicalEncoder", "obj", "JSONCyclicalDecoder", "valid", "msg", "keyMapping", "deleteRefs", "rewriteRefs", "isMutation", "pack", "mutationPackAppend", "mutation", "append", "mutationPackOptimize", "mutationPackIter", "m", "mutationPackGetFirst", "mutationPackDeleteFirst", "mutationPackIsEmpty", "seenFields", "i", "fieldName", "mutationPackClone", "mutationPackHasRemote", "_f", "local", "mutationPackHasField", "fields", "field", "init_mutations", "__esmMin", "init_array", "diff", "value1", "value2", "typeOP", "options", "lTypeOP", "getTypeOperationsByValue", "patch", "value", "changes", "concatChanges", "changes1", "changes2", "result", "c", "init_utils", "__esmMin", "init_types", "ensureLocalItem", "item", "assert", "snapshotEquals", "snap1", "snap2", "options", "coreValueEquals", "DEFAULT_LIMIT", "SingleUndoManager", "init_single", "__esmMin", "init_error", "init_object", "init_utils", "init_core_types", "obj", "last", "prevLast", "group", "snapshot", "lastLocal", "local", "resetRedoList", "lastGroup", "snapList", "newSnap", "prevSnapshot", "prev1", "prev2", "mergedSnapshot", "lastRedo", "lastUndo", "newRedoSnap", "lastAfter", "base", "baseClone", "clone", "changes1", "diff", "changes2", "changes", "concatChanges", "newData", "patch", "localFields", "key", "newLocal", "field", "index", "equalsOptions", "UndoContext", "init_context", "__esmMin", "init_tree", "init_mutations", "init_single", "key", "obj", "isRichText", "graph", "options", "vOpt", "SingleUndoManager", "mutations", "changedLocally", "vMng", "pack", "undoManager", "mutationPackHasRemote", "keyOptions", "filter", "maxGroup", "manager", "lastLocal", "result", "last", "UndoManager", "init_manager", "__esmMin", "init_context", "graph", "options", "context", "UndoContext", "mutations", "composeRichText", "resolver", "rt", "local", "reconstructRichText", "composeFlatRichText", "decomposeRichText", "updater", "decomposeFlatRichText", "depth", "v", "flattenRichText", "isRefMarker", "replacementRT", "innerAtom", "isDepthMarker", "flatRepGenerator", "atom", "isRefNode", "_updateLinkedDoc", "copy", "key", "markerDepth", "innerAtoms", "innerAtm", "done", "next", "refMarker", "extractRefs", "root", "outSet", "node", "dfs", "init_composer", "__esmMin", "init_error", "init_flat_rep", "init_model", "init_tree", "triggerParent", "vertCallback", "parentScheme", "vert", "mutation", "parent", "callback", "assert", "sideEffects", "mutationPackIsEmpty", "triggerChildren", "childScheme", "child", "triggerCompose", "t1", "t2", "init_propagation_triggers", "__esmMin", "init_error", "init_mutations", "KeyFromVertexId", "id", "getDidMutateMethodName", "fieldName", "result", "gCachedDidMutateNames", "keyDictToVertDict", "graph", "keyDict", "k", "v", "vertDictToKeyDict", "vertDict", "extractFieldRefs", "value", "local", "Vertex", "isDictionary", "isRichText", "extractRefs", "assert", "isGenerator", "vert", "kNoRefsValue", "_Vertex", "kFieldTriggersBase", "init_vertex", "__esmMin", "init_dict", "init_mutations", "init_core_types", "init_composer", "init_tree", "init_comparisons", "init_error", "init_propagation_triggers", "init_types", "cls", "triggers", "src", "rawTriggers", "classHierarchy", "func", "triggerCompose", "finalizedTriggers", "mgr", "record", "prevVertex", "config", "_val", "notImplemented", "parent", "flag", "oldValue", "neighbor", "ns", "other", "onlyFields", "coreValueCompare", "edge", "pack", "remainingMutations", "mutationPackClone", "mutationPackIsEmpty", "mutationPackGetFirst", "handlerName", "mutationPackAppend", "mutationPackDeleteFirst", "mutation", "mutationPackIter", "callback", "opts", "fields", "proto", "descriptors", "key", "desc", "mut", "scheme", "keys", "triggerChildren", "commonPrefixLen", "str1", "str2", "len", "end", "commonSuffixLen", "idx1", "idx2", "count", "fixedCharCodeAt", "str", "idx", "code", "hi", "low", "assert", "increment", "appendPathComponent", "path", "comps", "c", "ltrChars", "rtlChars", "dirRegex", "init_string", "__esmMin", "init_error", "present", "fromTimestamp", "uniqueId", "past", "MIN_REF_DATE", "timestamp", "key", "serializeDate", "between", "prev", "next", "assert", "tmp", "prefixLen", "commonPrefixLen", "result", "minChar", "CHAR_CODE_MIN", "maxChar", "CHAR_CODE_MAX", "randomInt", "i", "charCode", "j", "RANDOM_SUFFIX_LEN", "ELEN", "init_orderstamp", "__esmMin", "init_string", "init_error", "init_math", "init_date", "init_common", "Workspace", "init_workspace", "__esmMin", "init_set", "init_base", "init_note", "BaseVertex", "rootKey", "u", "name", "users", "map", "icon", "img", "html", "vert", "Note", "note", "BaseVertex", "ContentVertex", "kFieldTriggersBase", "kFieldTriggersContent", "init_base", "__esmMin", "init_error", "init_vertex", "init_orderstamp", "init_mutations", "init_workspace", "init_propagation_triggers", "init_comparable", "Vertex", "mgr", "record", "prevVertex", "config", "Workspace", "d", "assert", "parentDeleted", "v", "fromTimestamp", "local", "oldValue", "parent", "prevIsDeleted", "mut", "result", "field", "mutationPackIter", "prevLastMod", "mutationPackAppend", "fieldName", "other", "coreValueCompare", "key", "ws", "triggerChildren", "gAllocatedKeys", "TreeKeys", "init_tree_keys", "__esmMin", "init_hash_map", "init_core_types", "init_encoding", "init_tree", "root", "HashMap", "v", "encodableValueHash", "kCoreValueTreeNodeOpts", "v1", "v2", "coreValueEquals", "node", "dfs", "keys", "nodeKey", "counts", "idx", "id", "other", "thisCounts", "otherCounts", "key", "value", "docFromRT", "rt", "result", "TreeKeys", "composeRanges", "docToRT", "doc", "pointers", "decomposeRanges", "isDocument", "unkeyedDocToDoc", "findLastTextNode", "textNode", "node", "dfs", "isTextNode", "notReached", "findFirstTextNode", "lastTextNode", "firstTextNode", "ptr", "isPointer", "range", "assert", "nodesByFlatIndexes", "idx", "nodesToIndexes", "key", "anchorOffset", "focusOffset", "dir", "buildRangePointer", "type", "projectRanges", "src", "dst", "filter", "projectPointers", "init_doc_state", "__esmMin", "init_tree", "init_error", "init_tree_keys", "init_flat_rep", "treeToMarkdown", "root", "result", "prevDepth", "node", "depth", "dfs", "isTextNode", "init_markdown", "__esmMin", "init_tree", "stripWhitelines", "str", "kStripWhitelinesReges", "Note", "kFieldTriggersNote", "init_note", "__esmMin", "init_base", "init_scheme_types", "init_tree", "init_composer", "init_vertex", "init_mutations", "init_doc_state", "init_clone", "init_flat_rep", "init_markdown", "init_propagation_triggers", "init_core_types", "init_set", "ContentVertex", "mgr", "record", "prevVertex", "config", "coreValueEquals", "local", "oldValue", "users", "map", "u", "attachments", "v", "coreObjectClone", "set", "copy", "graph", "docFromRT", "composeRichText", "key", "note", "initRichText", "rt", "oldRefs", "projectRanges", "ptr", "updatedBody", "decomposeRichText", "childV", "NS_NOTES", "docToRT", "newRefs", "deletedKeys", "subtract", "bodyRT", "extractRefs", "treeToMarkdown", "childKey", "childCards", "child", "res", "d", "reconstructRichText", "stripFormattingFilter", "flattenRichText", "projectPointers", "parentKey", "parent", "status", "keyDictToVertDict", "vertDictToKeyDict", "type", "val", "current", "x", "pins", "mutationPackAppend", "pinnedBy", "updatedPins", "triggerParent", "triggerChildren", "Vertex", "Tag", "kFieldTriggersTag", "init_tag", "__esmMin", "init_base", "init_vertex", "init_comparable", "init_propagation_triggers", "BaseVertex", "n", "key", "tag", "parentTag", "local", "oldValue", "queryManager", "t1", "t2", "coreValueCompare", "triggerChildren", "Vertex", "User", "init_user", "__esmMin", "init_error", "init_base", "init_scheme_types", "init_comparable", "BaseVertex", "url", "email", "assert", "n", "NS_USER_SETTINGS", "other", "rootKey", "coreValueCompare", "UserSettings", "init_user_settings", "__esmMin", "init_set", "init_scheme_versions", "init_vertex", "Vertex", "p", "d", "seenTutorials", "map", "v", "set", "copy", "workspaceColors", "step", "vertexBuilder", "manager", "record", "prevVertex", "config", "Workspace", "User", "Tag", "Note", "UserSettings", "Vertex", "init_vertex_builder", "__esmMin", "init_scheme_types", "init_vertex", "init_note", "init_tag", "init_user", "init_workspace", "init_user_settings", "delay", "delayMs", "func", "reject", "resolve", "promise", "res", "rej", "e", "retry", "timeoutMs", "maxDelayMs", "timingFunc", "easeInQuad", "startTime", "factor", "err", "TryAgain", "NoRetry", "RetryBaseErr", "clip", "value", "min", "max", "easeInOutSine", "init_time", "__esmMin", "origError", "bsearch", "arr", "value", "comparator", "x", "y", "start", "end", "mid", "r", "init_algorithms", "__esmMin", "defaultComparator", "a", "b", "defaultEQ", "SortedQueue", "init_queue", "__esmMin", "init_algorithms", "comparator", "eq", "v", "arr", "idx", "bsearch", "compareCoroutines", "c1", "c2", "mapGenerator", "iter", "mapper", "result", "v", "getRelativeTimestamp", "gTimestampCounter", "gPrevTimestamp", "kTimestampReadingThrottle", "kSingleFrameMs", "kSchedulerCycleTimeMs", "gActiveCoroutine", "Coroutine", "CoroutineScheduler", "kSharedScheduler", "init_coroutine", "__esmMin", "init_timer", "id", "generator", "doneHandler", "name", "g", "resolve", "promise", "res", "coroutine", "other", "dt", "cycleTimeMs", "priority", "NextEventLoopCycleTimer", "queue", "timeLimitMs", "startTime", "executedCoroutines", "c", "avgRunningTime", "normalStartTime", "normalQueue", "backgroundQueue", "backgroundRunTime", "startTimerTickerIfNeeded", "gTimerTicker", "gScheduledTimers", "startTime", "now", "MAX_TIMER_PROCESSING_MS", "timer", "assert", "stopTimerTickerIfNeeded", "processPendingNextEventLoopTimers", "scheduledTimers", "gScheduledNextEventLoopCycleTimers", "gScheduledTimeoutHandler", "gTimerId", "BaseTimer", "SimpleTimer", "BaseDynamicTimer", "EaseInOutSineTimer", "MicroTaskTimer", "NextEventLoopCycleTimer", "init_timer", "__esmMin", "init_error", "init_time", "init_queue", "init_coroutine", "SortedQueue", "t1", "t2", "callback", "label", "other", "dt", "intervalMs", "repeat", "name", "delayMs", "result", "minFreqMs", "maxFreqMs", "durationMs", "flag", "lastResetTime", "f", "freqDiff", "sleepDur", "easeInOutSine", "idx", "getDeleteMethodName", "prop", "import_eventemitter3_4_0", "EVENT_DID_CHANGE", "EVENT_CRITICAL_ERROR", "gVertexBuilder", "VertexManager", "SetProxy", "DictionaryProxy", "init_vertex_manager", "__esmMin", "init_mutations", "init_core_types", "init_vertex_builder", "init_timer", "init_flat_rep", "init_types", "init_error", "init_vertex", "init_set", "init_scheme_types", "init_dict", "vertexBuilder", "EventEmitter", "graph", "key", "initialState", "local", "SimpleTimer", "repo", "f", "id", "res", "kRecordIdField", "assert", "scheme", "record", "fieldName", "edge", "prevRecord", "newRecord", "vert", "pack", "mutationPackAppend", "dynamicFields", "mutationPackIsEmpty", "handler", "target", "oldValue", "success", "deleteMethodName", "mut", "value", "coreValueEquals", "setProxy", "isDictionary", "dictProxy", "mutations", "mutationPackOptimize", "vertex", "addedEdges", "removedEdges", "mutationPackIter", "newValue", "kNoRefsValue", "newRefs", "extractFieldRefs", "oldRefs", "adjList", "addedRefs", "subtract", "removedRefs", "srcKey", "dstKey", "refsChange", "sideEffects", "outMutations", "snapshot", "changed", "oldRecValue", "newRecValue", "projectPointers", "ptr", "onlyFields", "data", "coreValueClone", "other", "didMutateCallback", "v", "callback", "import_eventemitter3_4_0", "EVENT_LOADING_FINISHED", "EVENT_VERTEX_CHANGED", "EVENT_VERTEX_DELETED", "EVENT_VERTEX_SOURCE_CLOSED", "VertexSource", "init_vertex_source", "__esmMin", "EventEmitter", "groupByFunctionResultToGroupId", "res", "Vertex", "VertexManager", "EVENT_QUERY_RESULTS_CHANGED", "gQueryId", "Query", "UnionQuery", "init_query", "__esmMin", "init_comparable", "init_graph_manager", "init_vertex_source", "init_vertex", "init_vertex_manager", "init_error", "init_common", "init_timer", "init_coroutine", "init_log", "VertexSource", "sourceOrProducer", "predicate", "sortDescriptorOrOpts", "nameOrOpts", "GlobalLogger", "key", "SimpleTimer", "opts", "d", "EVENT_VERTEX_SOURCE_CLOSED", "source", "sortDescriptor", "name", "resolve", "promise", "query", "results", "result", "graph", "GraphManager", "vert", "mgr1", "mgr2", "limit", "src", "CoroutineScheduler", "handler", "f", "EVENT_VERTEX_CHANGED", "EVENT_VERTEX_DELETED", "assert", "EVENT_LOADING_FINISHED", "groupedResultKeys", "groupId", "keySet", "pack", "wasInSourceKeys", "prevGroupIds", "vertex", "newGroupIds", "prevSet", "set", "startTime", "Coroutine", "runningTime", "a", "b", "sortDesc", "v1", "v2", "ret", "coreValueCompare", "sortedGroups", "groupKey", "keys", "arr", "mapIterable", "k", "v", "groupByFunc", "resArr", "sources", "loadingCount", "q", "notReached", "processedKeys", "unionIter", "SharedQueriesManager", "init_shared_queries", "__esmMin", "init_comparable", "init_error", "init_scheme_types", "init_query", "init_vertex_source", "graph", "Query", "vert", "coreValueCompare", "NS_NOTES", "NS_WORKSPACE", "NS_TAGS", "NS_USERS", "tag", "v", "key", "name", "source", "predicate", "sortDesc", "queries", "result", "EVENT_VERTEX_SOURCE_CLOSED", "notReached", "hashEdge", "edge", "eqEdges", "e1", "e2", "filterEdges", "vertKey", "fieldName", "dict", "edges", "SimpleAdjacencyList", "init_adj_list", "__esmMin", "init_error", "init_set", "init_hash_map", "src", "dst", "outSet", "HashSet", "success", "inSet", "assert", "seenKeys", "key", "unionIter", "typeFromCode", "code", "messageForCode", "Code", "serviceUnavailable", "ServerError", "toJS", "error", "result", "log", "fromJS", "obj", "init_errors", "__esmMin", "init_log", "msg", "info", "internalInfo", "Edit", "init_edit", "__esmMin", "init_object", "init_scheme", "init_json", "init_encoding", "config", "isDecoderConfig", "decoder", "decodedDataChanges", "Scheme", "encoder", "JSONEncoder", "other", "obj", "JSONDecoder", "edits", "fieldName", "e", "versionNumberCreate", "major", "minor", "patch", "VersionNumber", "init_defs", "__esmMin", "commitContentsIsRecord", "c", "Record", "commitContentsSerialize", "encoder", "commitContentsDeserialize", "decoder", "Edit", "compareCommitsByValue", "c1", "c2", "coreValueEquals", "Commit", "init_commit", "__esmMin", "init_record", "init_edit", "init_utils", "init_common", "init_equals", "init_error", "init_defs", "config", "VersionNumber", "isDecoderConfig", "parents", "contents", "uniqueId", "contentsEncoder", "other", "assert", "MutationError", "OrderedMapState", "OrderedMap", "Link", "OrderedMapIter", "init_orderedmap", "__esmMin", "init_error", "dictInst", "key", "value", "link", "assert", "next", "prev", "count", "node", "state", "includeKeys", "includeValues", "probablyLink", "v", "linkValue", "LRUCache", "init_lru_cache", "__esmMin", "init_orderedmap", "limit", "evictionHandler", "OrderedMap", "key", "value", "map", "valueExists", "commitsWithUniqueRecords", "commits", "hashes", "result", "c", "h", "commitContentsIsRecord", "compareCommitsDesc", "c1", "c2", "coreValueEquals", "coreValueCompare", "import_eventemitter3_4_0", "EVENT_NEW_COMMIT", "Repository", "MemRepoStorage", "init_repo", "__esmMin", "init_core_types", "init_set", "init_errors", "init_commit", "init_object", "init_record", "init_error", "init_json", "init_edit", "init_log", "init_scheme_types", "init_lru_cache", "EventEmitter", "storage", "id", "serviceUnavailable", "key", "pendingCommit", "childrenPerCommit", "assert", "p", "children", "c1Ancestors", "c2Ancestors", "parentId", "parent", "checksum", "r", "contents", "notReached", "session", "leaves", "commitsToMerge", "lca", "base", "Record", "changes", "concatChanges", "mergeRecord", "mergeCommit", "Commit", "e", "ServerError", "head", "value", "lastRecordCommit", "fullCommit", "deltaCommit", "baseRecord", "edit", "Edit", "commitEncoder", "JSONCyclicalEncoder", "deltaLength", "fullLength", "log", "record", "repoFieldName", "kRecordIdField", "commit", "maxCommits", "LRUCache", "_id", "keyMap", "limit", "mapToArray", "k", "localCommit", "set", "repoIdFromKey", "key", "sepIdx", "assert", "import_idb_7_1", "K_DB_VERSION", "IDBRepositoryBackup", "init_idbbackup", "__esmMin", "init_json", "init_date", "init_log", "init_commit", "init_string", "init_error", "dbName", "db", "repoId", "commits", "txn", "store", "promises", "c", "JSONCyclicalEncoder", "serializeDate", "e", "log", "p", "result", "cursor", "prefix", "increment", "arr", "Commit", "JSONCyclicalDecoder", "import_base64", "BitField", "BloomFilter", "init_bloom", "__esmMin", "init_error", "init_hash", "init_encoding", "size", "byteLength", "idx", "byteOffset", "bitMask", "value", "buf", "options", "isDecoderConfig", "fpr", "maxHashes", "m", "k", "assert", "i", "MurmurHash3", "filter", "count", "h", "v", "hash", "encoder", "_options", "b64Encode", "decoder", "b64Decode", "seed", "K_DEFAULT_TTL_MS", "SyncMessage", "init_message", "__esmMin", "init_bloom", "init_common", "init_json", "init_utils", "init_defs", "init_commit", "config", "isDecoderConfig", "VersionNumber", "v", "values", "Commit", "encoder", "_options", "c", "JSONCyclicalEncoder", "decoder", "obj", "JSONCyclicalDecoder", "peerFilter", "localSize", "peerSize", "expectedSyncCycles", "includeMissing", "numberOfEntries", "fpr", "localFilter", "BloomFilter", "missingPeerValues", "id", "syncConfigGetCycles", "config", "actualSyncFreqMs", "import_eventemitter3_4_0", "kSyncConfigClient", "EVENT_ONLINE_STATUS_CHANGED", "EVENT_PROTOCOL_VERSION_CHANGED", "BaseClient", "init_base_client", "__esmMin", "init_timer", "init_message", "init_time", "init_log", "init_json", "init_math", "init_defs", "EventEmitter", "serverUrl", "syncConfig", "EaseInOutSineTimer", "e", "log", "MovingAverage", "v", "f", "value", "reqMsg", "msg", "JSONCyclicalEncoder", "respText", "start", "retry", "syncDurationMs", "syncResp", "json", "SyncMessage", "JSONCyclicalDecoder", "persistedCount", "VersionNumber", "cycleCount", "i", "serverFilter", "id", "RepoClient", "init_repo_client", "__esmMin", "init_message", "init_base_client", "init_common", "BaseClient", "repo", "serverUrl", "syncConfig", "SyncMessage", "mapIterable", "c", "values", "extractTextFromNote", "note", "result", "treeToPlaintext", "regex", "str", "replace", "replacement", "i", "import_bulksearch_0_1", "NoteSearchEngine", "customLang", "regex_whitespace", "regex_split", "regex_a", "regex_e", "regex_i", "regex_o", "regex_u", "regex_y", "regex_n", "regex_c", "regex_s", "regex_and", "regex_pairs", "init_note_search", "__esmMin", "init_coroutine", "init_mutations", "init_note", "init_tree", "init_vertex_source", "init_log", "graph", "BulkSearch", "key", "pack", "EVENT_VERTEX_CHANGED", "text", "filter", "vert", "Note", "skipChange", "field", "mutationPackIter", "start", "CoroutineScheduler", "mgr", "log", "K_HOT_COMMITS_WINDOW_MS", "EVENT_VERTEX_DID_CHANGE", "GraphManager", "init_graph_manager", "__esmMin", "init_record", "init_scheme", "init_error", "init_common", "init_manager", "init_mutations", "init_vertex", "init_vertex_manager", "init_scheme_types", "init_timer", "init_set", "init_shared_queries", "init_vertex_source", "init_adj_list", "init_repo", "init_idbbackup", "init_repo_client", "init_base_client", "init_string", "init_note_search", "VertexSource", "rootKey", "ptrFilterFunc", "baseServerUrl", "SimpleAdjacencyList", "uniqueId", "MicroTaskTimer", "UndoManager", "SharedQueriesManager", "IDBRepositoryBackup", "NoteSearchEngine", "EVENT_VERTEX_SOURCE_CLOSED", "repoId", "commits", "id", "repo", "Repository", "MemRepoStorage", "EVENT_NEW_COMMIT", "c", "NS_NOTES", "client", "RepoClient", "appendPathComponent", "kSyncConfigClient", "key", "KeyFromVertexId", "namespace", "initialData", "local", "discoveredBy", "ns", "mgr", "scheme", "SchemeManager", "record", "Record", "VertexManager", "EVENT_DID_CHANGE", "pack", "refsChange", "EVENT_CRITICAL_ERROR", "pendingMutations", "mutationPackAppend", "mutations", "i", "mut", "EVENT_VERTEX_CHANGED", "srcKey", "distance", "excludeNs", "editRecord", "skipMissingRefs", "result", "keysQueue", "excludedNsSet", "deletedKeys", "rewriteKeys", "depth", "vert", "k", "edgeMgr", "unionIter", "encodedGraph", "vertManagers", "decodedGraph", "createdManagers", "assert", "keysMapping", "origKey", "encodedRecord", "newKey", "LogClient", "init_log_client", "__esmMin", "init_base_client", "init_message", "BaseClient", "storage", "serverUrl", "syncConfig", "SyncMessage", "values", "entries", "persistedCount", "e", "writeCount", "LoggerProvider", "sessionInfo", "children", "ctx", "setCtx", "GlobalLogger", "storage", "LogClientIDBStorage", "client", "LogClient", "kSyncConfigClient", "streams", "ConsoleLogStream", "setGlobalLoggerStreams", "unloadHandler", "resetGlobalLoggerStreams", "React", "loggerContext", "useLogger", "import_react_18_2", "import_with_async_ittr", "K_DB_VERSION", "init_logger", "__esmMin", "init_log", "init_log_client", "init_base_client", "init_stream", "dbName", "db", "entries", "txn", "store", "promises", "e", "log", "p", "isRevokedProxy", "vertex", "_", "err", "register", "manager", "onChange", "keys", "opts", "EMPTY_OPTS", "callback", "pack", "didChange", "field", "mutationPackIter", "EVENT_DID_CHANGE", "useVertexByKey", "key", "graph", "useGraphManager", "vertexMng", "useVertex", "useVertexManager", "id", "VertexManager", "Vertex", "useVerticesManagers", "iter", "mapIterable", "usePartialVertex", "vertId", "setReload", "keysStr", "x", "vertexId", "filterFunc", "fn", "useVertices", "vertexManagers", "usePartialVertices", "vertexIds", "reload", "unSubs", "m", "useCurrentUser", "import_react_18_2", "init_vertex", "__esmMin", "init_graph", "init_vertex_manager", "init_mutations", "init_common", "LogoIcon", "className", "styles", "useStyles", "cn", "LogoText", "init_logo", "__esmMin", "init_styleguide", "init_css_objects", "init_responsive", "init_layout", "makeStyles", "theme", "layout", "styleguide", "MediaQueries", "LoadingView", "styles", "useStyles", "React", "cn", "LogoIcon", "import_react_18_2", "breath", "init_loading_view", "__esmMin", "init_styleguide", "init_logo", "init_css_objects", "keyframes", "makeStyles", "theme", "resolveClass", "styleguide", "Layer", "children", "priority", "zIndex", "context", "newZIndex", "React", "import_react_18_2", "init_layer", "__esmMin", "import_react_18_2", "useStyles", "H1", "H2", "H3", "H4", "Text", "Bold", "init_texts", "__esmMin", "init_css_objects", "makeStyles", "theme", "React", "className", "children", "rest", "ref", "styles", "cn", "useQuery2", "query", "closeOnCleanup", "counter", "setCounter", "assert", "Query", "startTime", "cleanup", "useExistingQuery", "opts", "logger", "useLogger", "result", "setResult", "mapResult", "listener", "results", "EVENT_QUERY_RESULTS_CHANGED", "useSharedQuery", "name", "q", "useGraphManager", "import_react_18_2", "init_query", "__esmMin", "init_scheme_types", "init_graph", "init_logger", "init_error", "ChangesIndicator", "styles", "useStyles", "hasPendingChanges", "useSharedQuery", "React", "cn", "Text", "import_react_18_2", "init_changes_indicator", "__esmMin", "init_styles", "init_texts", "init_css_objects", "init_query", "makeStyles", "theme", "styleguide", "import_react_18_2", "useStyles", "IconBase", "IconBase_default", "init_IconBase", "__esmMin", "init_css_objects", "init_styleguide", "init_layout", "makeStyles", "layout", "styleguide", "React", "children", "size", "className", "style", "ref", "styles", "cn", "import_react_18_2", "init_IconAdd", "__esmMin", "init_IconBase", "import_react_18_2", "IconCreateNew_default", "init_IconCreateNew", "__esmMin", "init_IconBase", "React", "fill", "opacity", "className", "ref", "IconBase_default", "init_IconFilter", "__esmMin", "init_theme", "init_IconBase", "import_react_18_2", "useMenuStyles", "init_IconMenu", "__esmMin", "init_IconBase", "init_css_objects", "init_styleguide", "init_theme", "makeStyles", "styleguide", "import_react_18_2", "init_IconNotifications", "__esmMin", "init_theme", "init_IconBase", "import_react_18_2", "init_IconSearch", "__esmMin", "init_theme", "init_IconBase", "import_react_18_2", "init_IconSettings", "__esmMin", "init_theme", "init_IconBase", "init_IconTag", "__esmMin", "init_IconBase", "init_IconAlignCenter", "__esmMin", "init_IconBase", "import_react_18_2", "init_IconAlignLeft", "__esmMin", "init_IconBase", "init_IconAlignRight", "__esmMin", "init_IconBase", "IconBold", "IconBold_default", "init_IconBold", "__esmMin", "init_IconBase", "fill", "className", "IconBase_default", "IconBulletList", "IconBulletList_default", "init_IconBulletList", "__esmMin", "init_IconBase", "fill", "className", "IconBase_default", "IconItalic", "IconItalic_default", "init_IconItalic", "__esmMin", "init_IconBase", "fill", "className", "IconBase_default", "import_react_18_2", "IconLink", "IconLink_default", "init_IconLink", "__esmMin", "init_IconBase", "fill", "className", "width", "height", "React", "IconBase_default", "IconNumberList", "IconNumberList_default", "init_IconNumberList", "__esmMin", "init_IconBase", "fill", "className", "IconBase_default", "import_react_18_2", "IconStrikethrough", "IconStrikethrough_default", "init_IconStrikethrough", "__esmMin", "init_IconBase", "fill", "className", "React", "IconBase_default", "IconTask", "IconTask_default", "init_IconTask", "__esmMin", "init_IconBase", "fill", "className", "IconBase_default", "IconUnderline", "IconUnderline_default", "init_IconUnderline", "__esmMin", "init_IconBase", "fill", "className", "IconBase_default", "init_IconDropDown", "__esmMin", "init_IconBase", "init_IconGoogle", "__esmMin", "init_IconBase", "init_IconNote", "__esmMin", "init_IconBase", "IconDropDownArrow", "IconDropDownArrow_default", "init_IconDropDownArrow", "__esmMin", "init_IconBase", "fill", "className", "IconBase_default", "import_react_18_2", "init_IconTasksTick", "__esmMin", "init_IconBase", "import_react_18_2", "IconOverflow", "IconOverflow_default", "init_IconOverflow", "__esmMin", "init_IconBase", "fill", "className", "React", "IconBase_default", "import_react_18_2", "IconClose", "IconClose_default", "init_IconClose", "__esmMin", "init_IconBase", "fill", "className", "size", "React", "IconBase_default", "init_IconDelete", "__esmMin", "init_IconBase", "init_IconEdit", "__esmMin", "init_IconBase", "init_IconViewNote", "__esmMin", "init_IconBase", "IconKeyboard", "IconKeyboard_default", "init_IconKeyboard", "__esmMin", "init_IconBase", "fill", "className", "pathClassName", "IconBase_default", "import_react_18_2", "IconBack", "IconBack_default", "init_IconBack", "__esmMin", "init_IconBase", "fill", "className", "React", "IconBase_default", "import_react_18_2", "init_IconContactUs", "__esmMin", "init_IconBase", "IconCalendar", "IconCalendar_default", "init_IconCalendar", "__esmMin", "init_IconBase", "fill", "className", "IconBase_default", "import_react_18_2", "init_IconSorting", "__esmMin", "init_theme", "init_IconBase", "init_IconImage", "__esmMin", "init_IconBase", "init_IconAssignee", "__esmMin", "init_IconBase", "init_IconDueDate", "__esmMin", "init_IconBase", "import_react_18_2", "init_IconAttachment", "__esmMin", "init_IconBase", "init_IconCamera", "__esmMin", "init_IconBase", "init_IconExportMail", "__esmMin", "init_IconBase", "init_IconExportPdf", "__esmMin", "init_IconBase", "init_IconDuplicate", "__esmMin", "init_IconBase", "import_react_18_2", "IconExpander", "IconExpander_default", "init_IconExpander", "__esmMin", "init_IconBase", "fill", "className", "React", "IconBase_default", "init_icons", "__esmMin", "init_IconAdd", "init_IconCreateNew", "init_IconFilter", "init_IconMenu", "init_IconNotifications", "init_IconSearch", "init_IconSettings", "init_IconTag", "init_IconAlignCenter", "init_IconAlignLeft", "init_IconAlignRight", "init_IconBold", "init_IconBulletList", "init_IconItalic", "init_IconLink", "init_IconNumberList", "init_IconStrikethrough", "init_IconTask", "init_IconUnderline", "init_IconDropDown", "init_IconGoogle", "init_IconNote", "init_IconDropDownArrow", "init_IconTasksTick", "init_IconOverflow", "init_IconClose", "init_IconDelete", "init_IconEdit", "init_IconViewNote", "init_IconKeyboard", "init_IconBack", "init_IconContactUs", "init_IconCalendar", "init_IconSorting", "init_IconImage", "init_IconAssignee", "init_IconDueDate", "init_IconAttachment", "init_IconCamera", "init_IconExportMail", "init_IconExportPdf", "init_IconDuplicate", "init_IconExpander", "useScrollingRerendering", "el", "scrollingContext", "offset", "setOffset", "handler", "Scroller", "children", "setEl", "React", "import_react_18_2", "init_scrolling", "__esmMin", "init_ssr", "isServerSide", "isOverflowing", "style", "popper", "boundingRect", "x", "y", "offsetX", "offsetY", "points", "overflow", "point", "calcFn", "fn", "anchor", "el", "rect", "import_react_18_2", "import_prop_types_15_8", "popIn", "zIndex", "useStyles", "Popper", "positionCalculator", "PopperElement", "popper_default", "init_popper", "__esmMin", "init_styleguide", "init_transition", "init_css_objects", "init_scrolling", "init_layer", "init_ssr", "keyframes", "styleguide", "makeStyles", "theme", "open", "animationDuration", "className", "rest", "visibility", "useTransitionedOpen", "createUniversalPortal", "React", "cn", "args", "PropTypes", "position", "align", "children", "direction", "styles", "recalc", "setRecalc", "setStyle", "offset", "useScrollingRerendering", "p", "a", "newStyle", "key", "val", "handler", "Layer", "useMenuClose", "MenuContext", "isElement", "x", "Menu", "children", "renderButton", "popupClassName", "backdropClassName", "className", "align", "position", "direction", "onClick", "sizeByButton", "style", "styles", "useStyles", "open", "setOpen", "anchor", "backdrop", "minWidthStyle", "setMinWidthStyle", "menuCtx", "close", "e", "newContext", "openMenu", "width", "content", "React", "popper_default", "cn", "Button", "Backdrop", "import_react_18_2", "import_react_dom_18_2", "SecondaryMenuItem", "MenuItem", "MenuItemStyle", "MenuAction", "init_menu", "__esmMin", "init_css_objects", "init_styleguide", "init_layout", "init_buttons", "init_popper", "init_typography", "init_layer", "init_icons", "makeStyles", "theme", "styleguide", "layout", "text", "Text", "IconExpander_default", "selected", "props", "ref", "ctx", "invoke", "r", "IconComponent", "iconWidth", "iconHeight", "visible", "rest", "ReactDOM", "Layer", "zIndex", "isWindowsOS", "isMacOS", "init_utils", "__esmMin", "ToolbarMenu", "className", "styles", "useStyles", "logger", "useLogger", "React", "Menu", "cn", "IconOverflow_default", "MenuItem", "import_react_18_2", "import_react_router_6_7", "isWindows", "init_header", "__esmMin", "init_styles", "init_buttons", "init_icons", "init_menu", "init_typography", "init_css_objects", "init_query", "init_vertex", "init_utils", "init_logger", "makeStyles", "theme", "layout", "styleguide", "MenuItemStyle", "isWindowsOS", "Toolbar", "children", "styles", "useStyles", "React", "Layer", "zIndex", "cn", "TOOLBAR_LEFT_ID", "TOOLBAR_CENTER_ID", "layout", "ChangesIndicator", "TOOLBAR_RIGHT_ID", "ToolbarMenu", "import_react_18_2", "import_react_dom_18_2", "TOOLBAR_HEIGHT", "ToolbarRightItem", "ToolbarCenterItem", "SIDE_TO_ID", "ExternalToolbarItem", "init_toolbar", "__esmMin", "init_styles", "init_layer", "init_css_objects", "init_responsive", "init_ssr", "init_changes_indicator", "init_header", "styleguide", "makeStyles", "theme", "MediaQueries", "className", "side", "isServerSide", "id", "el", "ReactDOM", "init_types", "__esmMin", "IconCheck", "size", "className", "color", "colorMap", "COLOR_MAP", "React", "import_react_18_2", "init_icon_check", "__esmMin", "init_theme", "init_types", "brandLightTheme", "Checkmark", "isChecked", "styles", "useStyles", "React", "cn", "IconCheck", "CheckBox", "checked", "onChange", "name", "disabled", "className", "rest", "ref", "onClick", "e", "labelProps", "import_react_18_2", "BORDER_WIDTH", "CheckBox_default", "init_CheckBox", "__esmMin", "init_layout", "init_css_objects", "init_styleguide", "init_theme", "init_icon_check", "makeStyles", "styleguide", "brandLightTheme", "layout", "import_react_18_2", "useStyles", "TextField_default", "init_TextField", "__esmMin", "init_typography", "init_css_objects", "init_styleguide", "init_theme", "makeStyles", "styleguide", "FontFamily", "brandLightTheme", "React", "props", "ref", "styles", "className", "rest", "cn", "getLocaleWeekDays", "DAYS", "getMonthName", "index", "MONTHS", "formatTimeDiff", "date", "now", "year", "month", "day", "daysDiff", "init_dateutils", "__esmMin", "getDaysInMonth", "year", "month", "isDateEqual", "a", "b", "MonthView", "selectedDate", "onChange", "styles", "useStyles", "daysCount", "days", "i", "fd", "ld", "weeks", "React", "cn", "getLocaleWeekDays", "d", "Button", "DatePicker", "value", "className", "startDate", "setMonth", "setYear", "back", "x", "next", "H3", "getMonthName", "import_react_18_2", "init_date_picker", "__esmMin", "init_css_objects", "init_styleguide", "init_layout", "init_buttons", "init_texts", "init_dateutils", "makeStyles", "theme", "layout", "styleguide", "init_states", "__esmMin", "import_react_18_2", "useStyles", "init_checkbox_icon", "__esmMin", "init_styleguide", "init_css_objects", "init_states", "makeStyles", "theme", "styleguide", "import_react_18_2", "useStyles", "init_partial_checkbox", "__esmMin", "init_css_objects", "init_styleguide", "init_layout", "init_layer", "init_states", "init_checkbox_icon", "makeStyles", "theme", "styleguide", "layout", "init_inputs", "__esmMin", "init_CheckBox", "init_TextField", "init_date_picker", "init_partial_checkbox", "Illustration", "className", "init_create_workspace_illustration", "__esmMin", "format", "str", "dict", "current", "key", "value", "varName", "formattedValue", "index", "useCurrentLanguage", "ctx", "createUseStrings", "strings", "lang", "import_react_18_2", "init_localization", "__esmMin", "React", "useWorkspaceColor", "workspaceId", "graph", "useGraphManager", "workspaceKey", "KeyFromVertexId", "colorMap", "usePartialUserSettings", "workspacesQuery", "useSharedQuery", "existingColor", "COLOR_MAP", "key", "colorCounts", "i", "color", "nextColor", "WorkspaceIcon", "className", "workspaceManager", "size", "styleguide", "styles", "useStyles", "ws", "usePartialVertex", "icon", "React", "cn", "import_react_18_2", "import_assert", "init_workspace_icon", "__esmMin", "init_styles", "init_css_objects", "init_theme", "init_graph", "init_vertex", "init_query", "makeStyles", "theme", "layout", "brandLightTheme", "DropDownItem", "children", "value", "className", "props", "onChange", "DropDownContext", "React", "MenuItem", "DropDown", "renderSelected", "onOpen", "noop", "ctx", "Menu", "import_react_18_2", "init_drop_down", "__esmMin", "init_menu", "new_workspace_strings_default", "init_new_workspace_strings", "__esmMin", "WorkspaceItem", "workspace", "className", "styles", "useStyles", "name", "usePartialVertex", "React", "cn", "WorkspaceIcon", "styleguide", "Text", "WorkspacesDropdown", "allWorkspaces", "setWorkspace", "placeholder", "chooseWorkspace", "useStrings", "noSelection", "renderSelected", "isOpen", "layout", "IconDropDownArrow_default", "DropDown", "ws", "DropDownItem", "import_react_18_2", "init_workspaces_dropdown", "__esmMin", "init_vertex", "init_localization", "init_workspace_icon", "init_styles", "init_icons", "init_drop_down", "init_texts", "init_css_objects", "init_new_workspace_strings", "makeStyles", "theme", "createUseStrings", "new_workspace_strings_default", "DuplicateToggle", "shouldDuplicate", "setShouldDuplicate", "styles", "useStyles", "strings", "useStrings", "onClick", "x", "React", "cn", "DuplicateWorkspaceView", "allWorkspaces", "setWorkspace", "workspace", "className", "WorkspacesDropdown", "import_react_18_2", "init_duplicate_workspace", "__esmMin", "init_styles", "init_typography", "init_css_objects", "init_theme", "init_localization", "init_workspaces_dropdown", "init_new_workspace_strings", "makeStyles", "layout", "styleguide", "brandLightTheme", "createUseStrings", "new_workspace_strings_default", "duplicateWorkspace", "name", "graph", "src", "subGraph", "NS_USERS", "r", "NS_WORKSPACE", "createNewWorkspace", "graphManager", "opts", "copyFrom", "WorkspaceForm", "source", "onWorkspaceCreated", "styles", "useStyles", "setName", "logger", "useLogger", "useGraphManager", "nameRef", "createRef", "workspacesQuery", "useSharedQuery", "duplicateWs", "setDuplicateWs", "flowId", "uniqueId", "createWorkspace", "wsResult", "React", "H2", "Text", "DuplicateWorkspaceView", "cn", "TextField_default", "e", "RaisedButton", "Illustration", "import_react_18_2", "init_workspace_form", "__esmMin", "init_scheme_types", "init_styleguide", "init_buttons", "init_inputs", "init_texts", "init_css_objects", "init_graph", "init_query", "init_create_workspace_illustration", "init_duplicate_workspace", "init_logger", "init_common", "makeStyles", "theme", "styleguide", "import_react_18_2", "import_react_router_6_7", "import_index_d", "useStyles", "CreateWorkspaceView", "init_new_workspace", "__esmMin", "init_css_objects", "init_styles", "init_toolbar", "init_workspace_form", "makeStyles", "theme", "layout", "styleguide", "source", "onWorkspaceCreated", "styles", "ws", "setWs", "navigate", "onCreated", "result", "closeView", "React", "cn", "Toolbar", "WorkspaceForm", "DialogHeader", "children", "styles", "useStyles", "React", "H2", "cn", "Dialog", "open", "onClickOutside", "className", "onClose", "onOpen", "renderIndicator", "timeout", "visible", "setVisible", "css", "setCss", "onOpenRef", "mounted", "root", "ignoreClick", "e", "backgroundClick", "ReactDOM", "Layer", "zIndex", "IconButton", "IconClose_default", "import_react_18_2", "import_react_dom_18_2", "show", "hideAnim", "backdropShow", "backdropHide", "DialogContent", "DialogActions", "init_dialog", "__esmMin", "init_css_objects", "init_texts", "init_styleguide", "init_layout", "init_icons", "init_buttons", "init_layer", "keyframes", "makeStyles", "theme", "layout", "styleguide", "useDueDate", "dd", "dueDateContext", "assert", "dueDateReducer", "state", "action", "DueDateEditor", "children", "styles", "useStyles", "logger", "useLogger", "dispatch", "value", "card", "onDateSelected", "date", "proxy", "onClose", "React", "Dialog", "DialogContent", "DialogHeader", "DatePicker", "cn", "import_react_18_2", "init_due_date_editor", "__esmMin", "init_dialog", "init_css_objects", "init_inputs", "init_styleguide", "init_logger", "init_error", "makeStyles", "theme", "styleguide", "FloatingBackButton", "styles", "useStyles", "navigate", "location", "logger", "useLogger", "onClick", "text", "React", "Layer", "style", "Button", "cn", "IconBack_default", "Text", "import_react_18_2", "import_react_router_6_7", "init_floating_back_button", "__esmMin", "init_css_objects", "init_styles", "init_buttons", "init_texts", "init_icons", "init_layer", "init_responsive", "init_logger", "makeStyles", "theme", "styleguide", "MediaQueries", "layout", "useScrollParent", "scrollingContext", "Scroller", "children", "el", "setEl", "React", "import_react_18_2", "init_scrolling", "__esmMin", "getPlatformHotkey", "shortcut", "hotkey", "CURRENT_PLATFORM", "x", "isKeyPressed", "event", "key", "keyCode", "KEY_MAP", "isHotkeyActive", "k", "META_KEY_MAP", "codeA", "codeZ", "init_hotkeys", "__esmMin", "init_utils", "isMacOS", "char", "SuggestionItem", "isSelected", "children", "onItemSelected", "item", "styles", "useStyles", "ref", "scrollParent", "useScrollParent", "onClick", "e", "React", "cn", "InnerSuggestionComponent", "ItemSuggestionComponent", "items", "keyForItem", "registerKeyDown", "selectedIndex", "setSelectedIndex", "length", "selectedItem", "x", "index", "MentionElementNode", "attributes", "trigger", "element", "MentionComponent", "anchor", "editor", "selected", "open", "setOpen", "content", "filter", "contentRef", "closeMention", "path", "CfdsEditor", "closeMentionRef", "isKeyPressed", "SuggestionComponent", "props", "popper_default", "Scroller", "import_react_18_2", "import_slate_0_87", "import_slate_react_0_87", "SuggestionItemIcon", "init_mention_node", "__esmMin", "init_scrolling", "init_styles", "init_popper", "init_css_objects", "init_with_cfds", "init_hotkeys", "makeStyles", "theme", "styleguide", "layout", "import_slate_0_87", "ElementUtils", "init_element_utils", "__esmMin", "init_error", "editor", "match", "nodes", "n", "p", "node", "at", "path", "notReached", "value", "onlyChild", "root", "condition", "fragment", "all", "some", "conditionVal", "setNodeAs", "setNodesOptions", "import_slate_0_87", "import_slate_react_0_87", "SelectionUtils", "init_selection_utils", "__esmMin", "init_with_cfds", "init_element_utils", "editor", "at", "a", "b", "nodeA", "pathA", "pathB", "ElementUtils", "node", "path", "index", "offset", "end", "sel", "CfdsEditor", "letterBoost", "expected", "input", "origChars", "correctCount", "wrongCount", "c", "wordDist", "clamp", "diff", "kDMP", "levenshteinDist", "weightedLevenDist", "preDist", "commonPrefixLen", "sufDist", "commonSuffixLen", "dist", "splitWords", "str", "phraseDist", "expectedWords", "inputWords", "matchCount", "matchSum", "iw", "ew", "suggestResults", "userInput", "values", "getValue", "v", "entries", "e1", "e2", "e", "init_suggestions", "__esmMin", "init_string", "init_defs", "isMention", "node", "filterSortMentions", "items", "query", "getSortValue", "suggestResults", "withMentions", "editor", "isInline", "apply", "element", "mentionEditor", "operation", "SelectionUtils", "createMentionsPlugin", "trigger", "canOpen", "MentionComponent", "pluginId", "uniqueId", "handlers", "registerKeyDown", "fn", "e", "isKeyPressed", "path", "index", "point", "mention", "ElementUtils", "props", "React", "MentionElementNode", "import_react_18_2", "import_slate_0_87", "init_mentions", "__esmMin", "init_mention_node", "init_common", "init_hotkeys", "init_selection_utils", "init_element_utils", "init_suggestions", "TagSuggestion", "item", "rest", "styles", "useStyles", "name", "usePartialVertex", "React", "SuggestionItem", "SuggestionItemIcon", "cn", "TagItemComponent", "TagsSuggestionComponent", "filter", "SuggestionComponent", "closeMention", "card", "useCurrentCard", "partial", "sharedQueries", "useSharedQueriesManager", "childTagsQuery", "useQuery2", "Query", "tag", "cardTagChild", "filteredTags", "filterSortMentions", "t", "mgr", "tags", "createTagsPlugin", "options", "createMentionsPlugin", "import_react_18_2", "init_tags", "__esmMin", "init_styles", "init_css_objects", "init_query", "init_vertex", "init_mentions", "init_card", "init_mention_node", "init_graph", "makeStyles", "theme", "styleguide", "createTypeguard", "key", "handler", "mergePlugins", "plugins", "keyboardHandlers", "isKeyDownHandler", "renderers", "isRenderElementHandler", "leafRenderers", "isRenderLeafHandler", "decorators", "isDecorateHandler", "event", "props", "renderer", "el", "entry", "ranges", "decorator", "createPluginStack", "merged", "renderElement", "renderLeaf", "init_plugins", "__esmMin", "init_equals", "createAutoReplaceHandler", "trigger", "prefix", "editor", "onTriggered", "canTrigger", "hotkey", "getPlatformHotkey", "event", "isHotkeyActive", "parent", "ElementUtils", "node", "path", "SlateNode", "textPath", "fullPath", "alteredNode", "import_slate_0_87", "init_auto_replace", "__esmMin", "init_element_utils", "init_hotkeys", "getColorForString", "str", "seed", "colors", "index", "murmurhash2_32_gc", "getColorForUserId", "uid", "MURMUR_SEED_USER", "COLORS_USERS", "init_colors", "__esmMin", "init_hash", "useAnimateWidth", "ref", "animateProp", "size", "useAnimateSize", "useAnimateHeight", "el", "animateSizeKey", "lastValue", "setSize", "currSize", "abort", "desiredSize", "import_react_18_2", "init_animate", "__esmMin", "import_react_18_2", "useStyles", "Tooltip", "tooltip_default", "init_tooltip", "__esmMin", "init_css_objects", "init_styleguide", "init_layout", "init_popper", "makeStyles", "theme", "styleguide", "layout", "text", "children", "locked", "className", "position", "align", "disabled", "styles", "buttonRef", "isOpen", "setIsOpen", "button", "React", "childProps", "onMouseOver", "onMouseLeave", "onTooltipMouseOver", "e", "onTooltipMouseLeave", "cloned", "popper_default", "cn", "getInitials", "name", "x", "AvatarView", "user", "size", "className", "style", "styles", "useStyles", "avatarUrl", "usePartialVertex", "React", "tooltip_default", "cn", "import_react_18_2", "avatar_default", "init_avatar", "__esmMin", "init_styles", "init_tooltip", "init_typography", "init_css_objects", "init_theme", "init_vertex", "makeStyles", "styleguide", "layout", "brandLightTheme", "resolveUrl", "doc", "vertex", "VertexManager", "Note", "notImplemented", "createDocumentRouter", "navigate", "link", "useDocumentRouter", "useFocusOnMount", "ref", "import_react_18_2", "import_react_router_dom_6_7", "init_react_utils", "__esmMin", "init_error", "init_note", "init_vertex_manager", "MentionItem", "isSelected", "children", "onClick", "styles", "useStyles", "ref", "scrollParent", "useScrollParent", "parent", "el", "scrollOffset", "height", "React", "cn", "MentionPopup", "trigger", "onSelected", "getItems", "renderItem", "close", "useMenuClose", "useFocusOnMount", "filter", "setFilter", "onChange", "target", "value", "selectedIndex", "setSelectedIndex", "select", "item", "items", "onKeyDown", "e", "x", "TextField_default", "Scroller", "i", "import_react_18_2", "init_mention", "__esmMin", "init_css_objects", "init_styles", "init_inputs", "init_menu", "init_react_utils", "init_scrolling", "makeStyles", "theme", "styleguide", "layout", "assignNote", "logger", "source", "card", "user", "insteadOf", "assignees", "init_assignees", "__esmMin", "calculateDist", "sortValue", "filter", "wordDist", "SelectionPopup", "onSelected", "trigger", "getItems", "renderItem", "React", "MentionPopup", "item", "x", "a", "b", "value", "opts", "SelectionButton", "className", "children", "style", "styles", "useStyles", "Menu", "cn", "import_react_18_2", "init_selection_button", "__esmMin", "init_suggestions", "init_styleguide", "init_menu", "init_css_objects", "init_mention", "makeStyles", "theme", "styleguide", "IconPlus", "className", "size", "React", "import_react_18_2", "init_icon_plus", "__esmMin", "init_types", "AddAssigneeIcon", "className", "fill", "stroke", "styles", "useStyles", "theme", "useTheme", "React", "cn", "UserSpan", "userManager", "user", "usePartialVertex", "DefaultAvatar", "size", "avatar_default", "Assignee", "cardManager", "users", "source", "assignees", "renderSelected", "DEFAULT_RENDER", "onInviteUserSelected", "style", "logger", "useLogger", "getItems", "u", "a", "REMOVE_ASSIGNEE", "INVITE_USER", "onSelected", "value", "card", "current", "assignNote", "SelectionButton", "renderItem", "isOpen", "AssignButton", "selected", "IconPlus", "calcStyle", "isExpanded", "reverse", "index", "styleguide", "AssigneesView", "assignClassName", "cardType", "renderAssignee", "isInviteOpen", "setIsInviteOpen", "partialCard", "workspaceManager", "workspaces", "onUsersInvited", "assignStyle", "import_react_18_2", "RenderedItem", "init_assignees_view", "__esmMin", "init_css_objects", "init_styles", "init_avatar", "init_theme", "init_mention", "init_assignees", "init_selection_button", "init_icons", "init_vertex", "init_icon_plus", "init_logger", "makeStyles", "layout", "brandLightTheme", "item", "props", "MentionItem", "IconClose_default", "getRandomCardPlaceholder", "rand", "PLACEHOLDERS", "useCardPlaceholderText", "placeholder", "import_react_18_2", "init_placeholder", "__esmMin", "import_react_18_2", "showAnim", "useStyles", "PillContext", "PillAction", "PillContent", "Pill", "init_pill", "__esmMin", "init_animate", "init_styleguide", "init_css_objects", "keyframes", "makeStyles", "theme", "styleguide", "React", "children", "className", "styles", "visible", "cn", "extended", "color", "pillStyle", "isHover", "setIsHover", "ref", "showAction", "width", "useAnimateWidth", "style", "onMouseEnter", "onMouseLeave", "AddTagActionPopup", "close", "onTagged", "noteId", "styles", "useStyles", "theme", "useTheme", "graph", "useGraphManager", "partialNote", "usePartialVertex", "existingTags", "unionIter", "childTagsQuery", "useSharedQuery", "React", "MentionPopup", "filter", "filteredRes", "suggestResults", "tag", "TAG_NOT_FOUND", "item", "props", "MentionItem", "cn", "IconCreateNew_default", "TagButton", "className", "isSmall", "Menu", "IconPlus", "import_react_18_2", "init_tag_button", "__esmMin", "init_suggestions", "init_styles", "init_icons", "init_menu", "init_icon_plus", "init_types", "init_css_objects", "init_theme", "init_query", "init_mention", "init_graph", "init_vertex", "init_common", "makeStyles", "layout", "styleguide", "TagPillView", "tagMng", "className", "showMenu", "styles", "useStyles", "partialTag", "usePartialVertex", "ref", "style", "useAnimateWidth", "tagName", "menuOnHover", "NOOP_STYLE", "React", "cn", "layout", "IconDropDownArrow_default", "TagView", "tag", "onSelected", "buttonClassName", "onDelete", "renderSelected", "siblings", "onChange", "t", "DELETE_TAG", "renderButton", "DropDown", "DropDownItem", "IconClose_default", "import_react_18_2", "showAnim", "init_tag_view", "__esmMin", "init_styles", "init_icons", "init_drop_down", "init_typography", "init_css_objects", "init_theme", "init_vertex", "init_animate", "keyframes", "makeStyles", "brandLightTheme", "styleguide", "AssigneesIcon", "props", "fill", "className", "React", "import_react_18_2", "init_assignees_icon", "__esmMin", "TagIcon", "props", "fill", "className", "React", "import_react_18_2", "init_tag_icon", "__esmMin", "sortStampCompare", "a", "b", "aSort", "bSort", "init_sorting", "__esmMin", "duplicateCard", "graph", "rootKey", "opts", "DEFAULT_DUPLICATE_OPTS", "checkRecords", "outRecords", "newRootKey", "deepDuplicateImpl", "fixSorting", "tryAppendText", "key", "data", "NS_NOTES", "root", "refKey", "parentNoteNewKey", "newKey", "uniqueId", "newData", "newBody", "isRichText", "node", "dfs", "isRefMarker", "oldTaskKey", "newTaskKey", "sortedRecords", "a", "b", "sortStampCompare", "timeStamp", "fromTimestamp", "lastTextNode", "rt", "textNode", "isTextNode", "noteData", "text", "title", "lastNode", "DUP_TITLE_SUFFIX", "init_duplicate", "__esmMin", "init_common", "init_orderstamp", "init_scheme_types", "init_model", "init_tree", "init_sorting", "IconDelete", "size", "className", "React", "import_react_18_2", "init_icon_delete", "__esmMin", "init_types", "IconDuplicate", "size", "className", "React", "import_react_18_2", "init_icon_duplicate", "__esmMin", "init_types", "IconTask", "color", "size", "className", "colorOpts", "COLOR_MAP", "React", "import_react_18_2", "init_icon_task", "__esmMin", "init_theme", "init_types", "brandLightTheme", "IconNote", "color", "size", "className", "colorOpts", "COLOR_MAP", "React", "import_react_18_2", "init_icon_note", "__esmMin", "init_theme", "init_types", "brandLightTheme", "IconViewNote", "size", "className", "React", "import_react_18_2", "init_icon_view_note", "__esmMin", "init_types", "IconOpen", "size", "className", "React", "import_react_18_2", "init_icon_open", "__esmMin", "init_types", "IconDueDate", "size", "className", "state", "colors", "COLOR_MAP", "React", "import_react_18_2", "init_icon_due_date", "__esmMin", "init_theme", "init_types", "brandLightTheme", "EditCardAction", "cardManager", "source", "editor", "props", "logger", "useLogger", "docRouter", "useDocumentRouter", "React", "MenuAction", "IconOpen", "EditDueDateAction", "dueDateEditor", "useDueDate", "IconDueDate", "ViewInNoteAction", "navigate", "pCard", "usePartialVertex", "openNote", "IconViewNote", "cardHasChildren", "card", "child", "DeleteCardAction", "onDeleted", "open", "setOpen", "resolveRef", "useVertex", "onOpen", "resolve", "closeDialog", "isCancelled", "onDeleteClick", "hasChildren", "msg", "deleteText", "IconDelete", "Dialog", "DialogContent", "H3", "Text", "DialogActions", "Button", "RaisedButton", "DuplicateCardAction", "editorRootKey", "graph", "useGraphManager", "newCard", "duplicateCard", "cardEntry", "ElementUtils", "n", "CardElement", "path", "IconDuplicate", "ConvertNoteAction", "toastController", "useToastController", "type", "text", "onClick", "p", "newType", "dismiss", "IconTask", "IconNote", "import_react_18_2", "import_react_router_6_7", "import_slate_0_87", "init_actions", "__esmMin", "init_duplicate", "init_note", "init_buttons", "init_dialog", "init_icon_delete", "init_icon_duplicate", "init_icon_task", "init_icon_note", "init_icon_view_note", "init_icon_open", "init_icon_due_date", "init_types", "init_menu", "init_texts", "init_toast", "init_graph", "init_react_utils", "init_card", "init_element_utils", "init_due_date_editor", "init_vertex", "init_logger", "CardMenuView", "cardManager", "allowsEdit", "onDeleted", "className", "source", "editorRootKey", "direction", "position", "editor", "logger", "useLogger", "partialNote", "usePartialVertex", "React", "Menu", "IconOverflow_default", "EditCardAction", "EditDueDateAction", "ViewInNoteAction", "DuplicateCardAction", "ConvertNoteAction", "DeleteCardAction", "import_react_18_2", "init_item_menu", "__esmMin", "init_menu", "init_icons", "init_actions", "init_logger", "init_vertex", "CardActions", "editorRootKey", "card", "className", "styles", "useStyles", "editor", "React", "cn", "DueDateIndicator", "CardMenuView", "dueDate", "usePartialVertex", "dueDateEditor", "useDueDate", "logger", "useLogger", "onClick", "isOverdue", "Tooltip", "formatTimeDiff", "IconButton", "IconCalendar_default", "import_react_18_2", "import_slate_react_0_87", "init_card_actions", "__esmMin", "init_due_date_editor", "init_vertex", "init_item_menu", "init_dateutils", "init_styles", "init_buttons", "init_icons", "init_tooltip", "init_css_objects", "init_logger", "makeStyles", "theme", "styleguide", "layout", "LoadingCardNode", "attributes", "children", "styles", "useStyles", "React", "cn", "Placeholder", "element", "isEmpty", "placeholder", "useCardPlaceholderText", "Text", "AssigneeDropDown", "assignable", "color", "prefix", "showExpanded", "name", "usePartialVertex", "ref", "width", "useAnimateWidth", "style", "s", "IconDropDownArrow_default", "InlineAssignee", "user", "workspaceManager", "cardManager", "users", "userManagers", "u", "assignees", "assigneesManagers", "expanded", "setExpanded", "userKey", "getColorForUserId", "renderSelected", "Assignee", "InlineTag", "tag", "tagMng", "brandLightTheme", "onSelected", "t", "onDelete", "TagView", "AssigneePill", "Pill", "PillContent", "PillAction", "import_react_18_2", "import_slate_0_87", "import_slate_react_0_87", "animName", "CardNode", "ShortCardMetadata", "ExtendedCardMetadata", "init_card_node", "__esmMin", "init_styles", "init_colors", "init_icons", "init_inputs", "init_texts", "init_css_objects", "init_theme", "init_graph", "init_vertex", "init_animate", "init_element_utils", "init_selection_utils", "init_assignees_view", "init_placeholder", "init_pill", "init_tag_button", "init_tag_view", "init_card", "init_assignees_icon", "init_tag_icon", "init_card_actions", "init_note", "keyframes", "styleguide", "makeStyles", "theme", "resolveClass", "layout", "editor", "rootCard", "useCurrentCard", "cardId", "useGraphManager", "card", "useTheme", "divRef", "selected", "focused", "isExpanded", "setIsExpanded", "node", "path", "SelectionUtils", "thisNode", "ElementUtils", "CardElement", "isActionable", "done", "onChecked", "useAnimateHeight", "EditableCardContext", "CheckBox_default", "CardActions", "workspace", "tags", "parentTag", "className", "wsMng", "tagsMng", "c", "renderAssignee", "onTagSelected", "currentTags", "onTagDeleted", "TagIcon", "_", "TagButton", "AssigneesIcon", "AssigneesView", "useMountedIndicator", "isMountedRef", "import_react_18_2", "init_base_utils", "__esmMin", "UserSuggestion", "item", "rest", "name", "usePartialVertex", "React", "SuggestionItem", "SuggestionItemIcon", "avatar_default", "UserItemComponent", "AssigneesSuggestionComponent", "filter", "SuggestionComponent", "closeMention", "card", "useCurrentCard", "partial", "wsMng", "isMounted", "useMountedIndicator", "items", "u", "x", "filteredTags", "filterSortMentions", "t", "keyForItem", "userItem", "user", "assignees", "createAssigneesPlugin", "options", "createMentionsPlugin", "import_react_18_2", "init_assignees", "__esmMin", "init_vertex", "init_base_utils", "init_avatar", "init_mentions", "init_card", "init_mention_node", "EditableCardContext", "cardManager", "children", "React", "cardContext", "useCurrentCard", "isCardProps", "props", "CARD_TYPE", "isLoadingCardProps", "CardElement", "renderCard", "CardNode", "LoadingCardNode", "createNote", "parent", "currentUser", "options", "likeSibling", "body", "title", "assignees", "NS_NOTES", "x", "createCardPlugin", "editor", "getContainingNote", "getCurrentUser", "logger", "mergePlugins", "createAutoReplaceHandler", "node", "path", "el", "createTagsPlugin", "createAssigneesPlugin", "e", "currentNode", "currentPath", "SelectionUtils", "ElementUtils", "containing", "child", "insertAt", "import_react_18_2", "import_slate_0_87", "ALLOWED_ELEMENTS", "init_card", "__esmMin", "init_scheme_types", "init_tags", "init_element_utils", "init_selection_utils", "init_plugins", "init_auto_replace", "init_card_node", "init_assignees", "init_note", "value", "card", "note", "at", "cardPath", "parentNoteMng", "localKey", "text", "reffedPath", "withCfds", "editor", "apply", "insertFragment", "isVoid", "cfdsEditor", "uniqueId", "operation", "fragment", "sanitizedFragment", "node", "localKey", "newNode", "el", "CardElement", "isCfdsInternal", "slateRangeToCfdsRange", "range", "anchor", "focus", "import_slate_0_87", "import_slate_react_0_87", "findKey", "CfdsEditor", "init_with_cfds", "__esmMin", "init_common", "init_card", "init_error", "selection", "parent", "child", "i", "current", "inner", "notReached", "anchorPath", "focusPath", "registerOnCriticalError", "manager", "onCriticalError", "EVENT_CRITICAL_ERROR", "useOnCriticalError", "graphMng", "useGraphManager", "import_react_18_2", "init_graph_use", "__esmMin", "init_vertex_manager", "init_graph", "makeExpirationDate", "expirationInMs", "expirationBuffer", "useUndoContext", "editor", "vMng", "field", "addBodyRefs", "graph", "useGraphManager", "options", "_", "mut", "mutationPackHasField", "childKeys", "v", "Note", "undoCtx", "handleSelection", "selection", "slateSelection", "CfdsEditor", "SlateRange", "useCfdsEditor", "vertexMng", "selectionId", "opts", "vertex", "usePartialVertex", "undoAddBodyRefs", "DEFAULT_OPTS", "useOnCriticalError", "richtext", "onChange", "newValue", "ranges", "value", "slateValue", "SET_EXTERNAL_SELECTION", "intervalId", "proxy", "rt", "isCfdsInternal", "import_react_18_2", "import_slate_0_87", "import_slate_react_0_87", "init_use_cfds_editor", "__esmMin", "init_mutations", "init_vertex", "init_with_cfds", "init_graph", "init_note", "init_graph_use", "import_slate_0_87", "ListUtils", "init_list_utils", "__esmMin", "init_element_utils", "value", "editor", "path", "node", "p", "listType", "texts", "text", "newPath", "item", "itemNode", "itemPath", "itemRef", "containerNode", "containerPath", "containerPathRef", "itemIndex", "splitPath", "_", "indexAfterSplit", "newContainer", "updatedContainer", "ElementUtils", "isListItemProps", "props", "LIST_ITEM_TYPE", "ListItemElementNode", "styles", "useStyles", "dir", "isRtl", "level", "listContext", "React", "cn", "Text", "renderElementItem", "createListItemPlugin", "editor", "ListItemElement", "path", "ElementUtils", "parent", "ListUtils", "import_react_18_2", "import_slate_0_87", "init_list_item_element", "__esmMin", "init_element_utils", "init_texts", "init_list_utils", "init_css_objects", "makeStyles", "theme", "levelStyles", "value", "isBulletListProps", "props", "BULLET_LIST_TYPE", "BulletListElementNode", "styles", "useStyles", "level", "listContext", "React", "cn", "renderBulletList", "createBulletListPlugin", "editor", "mergePlugins", "createAutoReplaceHandler", "node", "path", "ListUtils", "import_react_18_2", "init_bullet_list_element", "__esmMin", "init_css_objects", "init_plugins", "init_auto_replace", "init_list_utils", "init_list_item_element", "makeStyles", "createNewNote", "graph", "ws", "data", "type", "baseData", "KeyFromVertexId", "emptyDoc", "NS_NOTES", "init_create", "__esmMin", "init_scheme_types", "init_vertex", "withCards", "editor", "getNote", "insertFragment", "normalizeNode", "fragment", "sanitized", "node", "CardElement", "noteMgr", "duplicatedTask", "duplicateCard", "createNewNote", "initRichText", "entry", "path", "import_slate_0_87", "init_with_cards", "__esmMin", "init_duplicate", "init_tree", "init_create", "init_card", "isHeaderProps", "props", "HEADING_1_TYPE", "HeaderElementNode", "styles", "useStyles", "React", "H2", "cn", "renderHeader", "selectionStartEndPoints", "editor", "rangeOfBlockAtPoint", "point", "headerNode", "rootPath", "rangeStart", "lastNodeIndex", "lastNode", "rangeEnd", "createEnterHandler", "tagName", "e", "isKeyPressed", "selectionStart", "selectionEnd", "setPrefix", "setSuffix", "createHeaderPlugin", "mergePlugins", "createAutoReplaceHandler", "node", "path", "import_react_18_2", "import_slate_0_87", "init_header_element", "__esmMin", "init_styles", "init_texts", "init_css_objects", "init_plugins", "init_auto_replace", "init_hotkeys", "makeStyles", "styleguide", "isHeader2Props", "props", "HEADING_2_TYPE", "Header2ElementNode", "styles", "useStyles", "React", "H3", "cn", "renderHeader2", "createHeader2Plugin", "editor", "mergePlugins", "createAutoReplaceHandler", "node", "path", "createEnterHandler", "import_react_18_2", "import_slate_0_87", "init_header2_element", "__esmMin", "init_styles", "init_css_objects", "init_plugins", "init_auto_replace", "init_texts", "init_header_element", "makeStyles", "theme", "styleguide", "isNumberedListProps", "props", "NUMBERED_LIST_TYPE", "NumberedListElementNode", "styles", "useStyles", "level", "listContext", "React", "cn", "renderNumberedList", "createNumberedListPlugin", "editor", "mergePlugins", "createAutoReplaceHandler", "node", "path", "ListUtils", "import_react_18_2", "init_numbered_list_element", "__esmMin", "init_css_objects", "init_plugins", "init_auto_replace", "init_list_utils", "init_list_item_element", "makeStyles", "Leaf", "props", "styles", "useStyles", "leaf", "classes", "cn", "MARK_PROPS", "p", "React", "renderLeaf", "createKeyDownHandlers", "editor", "handler", "handlers", "isHotkeyActive", "LeafUtils", "createLeafPlugin", "import_react_18_2", "import_slate_0_87", "BOLD_SHORTCUT", "ITALIC_SHORTCUT", "STRIKETHROUGH_SHORTCUT", "UNDERLINE_SHORTCUT", "init_leaves", "__esmMin", "init_css_objects", "init_hotkeys", "makeStyles", "shortcut", "prop", "getPlatformHotkey", "at", "mark", "leaves", "x", "text", "path", "all", "some", "markVal", "createBaseRender", "editor", "Component", "Paragraph", "props", "React", "createNestedContainersHandler", "ElementUtils", "ListUtils", "node", "path", "createBaseBodyPlugin", "mergePlugins", "createLeafPlugin", "createBaseTitlePlugin", "DefaultComponent", "onFocusNext", "e", "isKeyPressed", "import_react_18_2", "import_slate_0_87", "import_slate_react_0_87", "init_base", "__esmMin", "init_texts", "init_css_objects", "init_plugins", "init_element_utils", "init_hotkeys", "init_list_utils", "init_leaves", "children", "attributes", "cn", "useStyles", "isLinkLeafProps", "props", "leaf", "isMention", "LinkLeaf", "children", "attributes", "styles", "useStyles", "ref", "isOpen", "setIsOpen", "onMouseEnter", "onMouseLeave", "onClick", "e", "link", "React", "cn", "popper_default", "IconLink_default", "import_react_18_2", "init_link_leaf", "__esmMin", "init_mentions", "init_styles", "init_icons", "init_popper", "init_css_objects", "makeStyles", "theme", "styleguide", "layout", "getUrlRanges", "str", "ranges", "index", "letters", "rangeEnd", "createLinkDecoration", "node", "path", "isMention", "EMPTY", "data", "props", "isLinkLeafProps", "React", "LinkLeaf", "import_react_18_2", "import_slate_0_87", "init_link_decoration", "__esmMin", "init_mentions", "init_link_leaf", "createOvvioEditor", "getNote", "withCfds", "withCards", "withMentions", "useBodyEditor", "noteManager", "sessionId", "useCfdsContext", "noteManagerRef", "currentUser", "useCurrentUser", "editor", "logger", "useLogger", "plugins", "createPluginStack", "createBaseRender", "createHeader2Plugin", "createHeaderPlugin", "createListItemPlugin", "createBulletListPlugin", "createNumberedListPlugin", "createCardPlugin", "createLinkDecoration", "createBaseBodyPlugin", "handlers", "useCfdsEditor", "useTitleEditor", "note", "DefaultComponent", "source", "opts", "onFocusNext", "DEFAULT_OPTS", "user", "noteRef", "createTagsPlugin", "createAssigneesPlugin", "createBaseTitlePlugin", "isDefined", "import_react_18_2", "import_slate_0_87", "import_slate_react_0_87", "noop", "init_slate", "__esmMin", "init_graph", "init_use_cfds_editor", "init_with_cfds", "init_bullet_list_element", "init_card", "init_with_cards", "init_header_element", "init_header2_element", "init_list_item_element", "init_numbered_list_element", "init_mentions", "init_tags", "init_plugins", "init_base", "init_assignees", "init_vertex", "init_comparisons", "init_link_decoration", "init_logger", "FocusReporter", "cardManager", "source", "focused", "logger", "useLogger", "import_react_18_2", "import_slate_react_0_87", "init_focus_reporter", "__esmMin", "init_logger", "HeaderButton", "editor", "headerType", "styles", "useStyles", "selection", "isActive", "ElementUtils", "node", "otherTags", "ALLOWED_ELEMENTS", "x", "onClick", "e", "n", "texts", "HEADER_MAP", "React", "Tooltip", "Button", "cn", "makeMarkButton", "mark", "tooltip", "IconComponent", "marks", "handler", "LeafUtils", "TaskButton", "isVisible", "rootManager", "setVisible", "user", "useCurrentUser", "logger", "useLogger", "selectionState", "entry", "CardElement", "path", "IconTask_default", "ListButton", "listType", "list", "LIST_MAP", "el", "SelectionUtils", "isParagraph", "ListUtils", "import_react_18_2", "import_slate_0_87", "import_slate_react_0_87", "BoldButton", "ItalicButton", "StrikethroughButton", "UnderlineButton", "FloatingMenu", "init_floating_menu", "__esmMin", "init_styles", "init_buttons", "init_icons", "init_tooltip", "init_css_objects", "init_vertex", "init_card", "init_leaves", "init_element_utils", "init_list_utils", "init_selection_utils", "init_logger", "makeStyles", "theme", "styleguide", "layout", "IconBold_default", "IconItalic_default", "IconStrikethrough_default", "IconUnderline_default", "IconNumberList_default", "IconBulletList_default", "listsVisible", "setListsVisible", "index", "visible", "current", "v", "handleClick", "showSeparator", "body_editor_strings_default", "init_body_editor_strings", "__esmMin", "shouldShowPlaceholder", "editor", "node", "ElementUtils", "CardElement", "TaskCtaView", "onClick", "styles", "useStyles", "strings", "useStrings", "React", "cn", "Text", "import_react_18_2", "import_slate_0_87", "import_slate_react_0_87", "init_task_cta_view", "__esmMin", "init_css_objects", "init_texts", "init_styleguide", "init_element_utils", "init_card", "init_localization", "init_body_editor_strings", "makeStyles", "theme", "styleguide", "createUseStrings", "body_editor_strings_default", "usePlaceholder", "cardManager", "title", "usePartialVertex", "import_react_18_2", "import_slate_0_87", "import_slate_react_0_87", "useStyles", "body_editor_default", "init_body_editor", "__esmMin", "init_vertex", "init_slate", "init_card", "init_selection_utils", "init_styleguide", "init_css_objects", "init_focus_reporter", "init_floating_menu", "init_task_cta_view", "init_logger", "makeStyles", "theme", "styleguide", "React", "className", "isRtl", "ref", "styles", "placeholder", "editor", "plugins", "handlers", "useBodyEditor", "logger", "useLogger", "SelectionUtils", "onCtaClick", "onClick", "e", "cn", "EditableCardContext", "FocusReporter", "FloatingMenu", "TaskCtaView", "mapKey", "key", "isMacOS", "Shortcut", "children", "keys", "macOSKeys", "styles", "useStyles", "actualKeys", "React", "cn", "layout", "x", "i", "hasPlus", "Text", "LegendTooltip", "anchor", "open", "onClose", "popper_default", "Bold", "Button", "IconClose_default", "LegendView", "legendState", "changeState", "H3", "shouldBeOpen", "LegendButton", "showTooltip", "setShowTooltip", "setLegendState", "logger", "useLogger", "t", "click", "hideTooltip", "newState", "IconButton", "IconKeyboard_default", "import_react_18_2", "blinkAnim", "init_legend_view", "__esmMin", "init_icons", "init_buttons", "init_css_objects", "init_styles", "init_texts", "init_popper", "init_utils", "init_logger", "keyframes", "theme", "makeStyles", "styleguide", "IconContent", "className", "size", "React", "import_react_18_2", "init_icon_content", "__esmMin", "init_types", "TagPill", "tag", "setTag", "onDelete", "isExpanded", "styles", "useStyles", "name", "usePartialVertex", "renderSelected", "React", "Pill", "cn", "PillContent", "Text", "PillAction", "IconDropDownArrow_default", "TagView", "CardTags", "card", "size", "source", "tags", "workspace", "logger", "useLogger", "cardTags", "tagManager", "proxy", "newTags", "tagToDelete", "onTag", "tagKey", "currentTag", "coreValueCompare", "TagButton", "t", "import_react_18_2", "init_card_tag_view", "__esmMin", "init_vertex", "init_pill", "init_tag_button", "init_tag_view", "init_styles", "init_icons", "init_texts", "init_css_objects", "init_card_item", "init_logger", "init_comparable", "makeStyles", "theme", "layout", "styleguide", "stripAssigneesNotInWorkspace", "card", "wsUsers", "newAssignees", "u", "child", "moveCard", "cardManager", "destinationMng", "graph", "logger", "source", "result", "duplicateCard", "init_move", "__esmMin", "init_duplicate", "WorkspaceIndicatorButton", "workspace", "isExpanded", "className", "readOnly", "styles", "useStyles", "name", "usePartialVertex", "ref", "style", "useAnimateWidth", "theme", "useTheme", "React", "cn", "WorkspaceIcon", "styleguide", "Text", "IconDropDownArrow_default", "CardWorkspaceIndicator", "card", "source", "workspaceManager", "graph", "useGraphManager", "toastController", "useToastController", "logger", "useLogger", "navigate", "WorkspaceIndicator", "ws", "newCard", "moveCard", "setWorkspace", "menuClassName", "ButtonComponent", "validateMove", "renderButton", "changeTo", "setChangeTo", "onWsChanged", "onMove", "Menu", "SelectWorkspaceMenu", "MoveWorkspaceDialog", "sortWorkspaces", "ws1", "ws2", "pinnedWorkspaces", "hiddenWorkspaces", "coreValueCompare", "value", "onChange", "user", "useCurrentUser", "workspacesQuery", "useSharedQuery", "workspaces", "useVertices", "sortedWorkspaces", "x", "onSelect", "wsMng", "Scroller", "MenuItem", "close", "isOpen", "Dialog", "DialogContent", "H2", "DialogActions", "Button", "RaisedButton", "import_react_18_2", "import_react_router_6_7", "showAnim", "init_workspace_indicator", "__esmMin", "init_styles", "init_buttons", "init_dialog", "init_icons", "init_menu", "init_texts", "init_toast", "init_css_objects", "init_theme", "init_graph", "init_vertex", "init_animate", "init_scrolling", "init_move", "init_workspace_icon", "init_logger", "init_comparable", "init_query", "keyframes", "makeStyles", "layout", "getStrikethroughSVG", "fill", "TITLE_LINE_HEIGHT", "Title", "card", "source", "editor", "plugins", "handlers", "useTitleEditor", "TitleNode", "React", "CardHeader", "className", "isExpanded", "hideMenu", "size", "styles", "useStyles", "cn", "CardWorkspaceIndicator", "CardTags", "layout", "AssigneesView", "CardMenuView", "StatusCheckbox", "theme", "useTheme", "logger", "useLogger", "pCard", "usePartialVertex", "isDone", "onChange", "CheckBox_default", "ChildCard", "index", "isVisible", "CardItem", "import_react_18_2", "import_slate_react_0_87", "init_card_item", "__esmMin", "init_note", "init_vertex", "init_react_utils", "init_animate", "init_slate", "init_item_menu", "init_assignees_view", "init_styles", "init_icons", "init_inputs", "init_texts", "init_css_objects", "init_theme", "init_card_footer", "init_card_tag_view", "init_workspace_indicator", "init_logger", "styleguide", "makeStyles", "props", "ref", "Text", "showChildCards", "rest", "childListRef", "documentRouter", "useDocumentRouter", "childCards", "expanded", "setExpanded", "style", "useAnimateHeight", "isInHover", "setIsInHover", "isTask", "onMouseEnter", "onMouseLeave", "onClick", "CardFooter", "x", "IconExpander_default", "child", "DueDateIndicator", "card", "source", "styles", "useStyles", "dueDate", "usePartialVertex", "dueDateEditor", "useDueDate", "logger", "useLogger", "theme", "useTheme", "onClick", "e", "color", "React", "Button", "cn", "IconCalendar_default", "Text", "formatTimeDiff", "ContentIndicator", "bodyPreview", "IconContent", "CardFooter", "className", "size", "layout", "import_react_18_2", "FOOTER_HEIGHT", "init_card_footer", "__esmMin", "init_date", "init_vertex", "init_due_date_editor", "init_styles", "init_buttons", "init_icons", "init_icon_content", "init_texts", "init_css_objects", "init_theme", "init_card_item", "init_logger", "styleguide", "makeStyles", "Title", "children", "attributes", "React", "H1", "TitleEditorView", "cardManager", "className", "isRtl", "focusNext", "onDelete", "styles", "useStyles", "editor", "plugins", "handlers", "useTitleEditor", "cn", "CardHeader", "layout", "EditableCardContext", "FocusReporter", "CardMenuView", "CardFooter", "import_react_18_2", "import_slate_react_0_87", "init_title_editor", "__esmMin", "init_css_objects", "init_styles", "init_texts", "init_slate", "init_card", "init_item_menu", "init_focus_reporter", "init_card_footer", "init_card_item", "makeStyles", "theme", "styleguide", "CardEditorContent", "cardManager", "showWS", "styles", "useStyles", "rtl", "bodyEditorRef", "focusNext", "React", "Scroller", "ref", "cn", "e", "TitleEditorView", "body_editor_default", "LegendButton", "import_react_18_2", "init_content", "__esmMin", "init_css_objects", "init_styles", "init_responsive", "init_body_editor", "init_scrolling", "init_legend_view", "init_title_editor", "makeStyles", "theme", "styleguide", "layout", "MediaQueries", "NoteNotFound", "React", "NoteView", "noteId", "routeNoteId", "InnerNoteView", "styles", "useStyles", "cardManager", "useGraphManager", "card", "useVertex", "content", "CardEditorContent", "ErrorBoundary", "cn", "FloatingBackButton", "import_react_18_2", "import_react_router_dom_6_7", "kAllowEditorCrashes", "init_note_editor", "__esmMin", "init_layout", "init_css_objects", "init_vertex", "init_floating_back_button", "init_graph", "init_content", "makeStyles", "theme", "layout", "props", "error", "errorInfo", "generateId", "_id", "init", "disabled", "dndReducer", "state", "action", "START_DRAG", "payload", "CANCEL_DRAG", "END_DRAG", "SET_OVER_INDEX", "SET_DISABLED", "DragAndDropContext", "children", "onDragStarted", "onDragCancelled", "onDrop", "dispatch", "listeners", "id", "ctx", "data", "index", "dropZone", "placeholderStyle", "e", "item", "relativeTo", "dragPosition", "React", "dragCtx", "useDndContext", "gid", "import_react_18_2", "init_context", "__esmMin", "CANCELLATION_REASONS", "cancellation_reasons_default", "init_cancellation_reasons", "__esmMin", "isAllowsDropResult", "result", "Droppable", "children", "allowsDrop", "item", "items", "onDrop", "id", "ctx", "useDndContext", "DROP_ZONE", "onDropImpl", "e", "dragOverData", "disabled", "dragData", "cancellation_reasons_default", "relativeTo", "dragPosition", "res", "onDragOver", "onDragLeave", "isInDrag", "isDragOver", "attributes", "React", "dropZoneContext", "import_react_18_2", "init_droppable", "__esmMin", "init_cancellation_reasons", "init_context", "getBoundingBoxes", "el", "useDragPositionCalculator", "isDragActive", "boundingBoxCache", "e", "prevPos", "target", "rect", "calcDragPosition", "pos", "yPos", "p", "xPos", "PosMap", "throttle", "fn", "limit", "lastRun", "result", "args", "import_react_18_2", "DragPositions", "init_util", "__esmMin", "Draggable", "children", "data", "index", "effectAllowed", "id", "ctx", "useDndContext", "disabled", "isInDrag", "setIsInDrag", "dropZoneId", "dropZoneContext", "calcPosition", "useDragPositionCalculator", "dragPosition", "setDragPosition", "val", "cancelled", "ref", "placeHolder", "onDragStart", "e", "serialized", "placeholderStyle", "el", "rect", "onDragEnter", "pos", "onDragOver", "throttle", "current", "onDragLeave", "onDrop", "onDragEnd", "cancellation_reasons_default", "dropOverBefore", "import_react_18_2", "init_draggable", "__esmMin", "init_cancellation_reasons", "init_context", "init_droppable", "init_util", "init_dragndrop", "__esmMin", "init_context", "init_draggable", "init_droppable", "init_cancellation_reasons", "setDragSort", "items", "item", "relativeTo", "dragPosition", "index", "nextIndex", "nextStamp", "present", "past", "between", "import_react_18_2", "useStyles", "DraggableCard", "init_draggable_card", "__esmMin", "init_orderstamp", "init_animate", "init_styles", "init_css_objects", "init_card_item", "makeStyles", "theme", "styleguide", "React", "attributes", "isInDrag", "isDragActive", "dropOverBefore", "placeholderStyle", "isDraggedOver", "className", "cardProps", "ref", "styles", "dragRef", "height", "useAnimateHeight", "style", "cn", "CardItem", "BoardCard", "card", "index", "styles", "useStyles", "React", "Draggable", "props", "ref", "DraggableCard", "cn", "import_react_18_2", "init_board_card", "__esmMin", "init_styleguide", "init_css_objects", "init_draggable", "init_card_item", "init_draggable_card", "makeStyles", "theme", "styleguide", "ColumnTitle", "title", "onCreateCard", "styles", "useStyles", "sentinel", "setSentinel", "scrollParent", "useScrollParent", "isSticky", "setIsSticky", "observer", "records", "record", "targetInfo", "rootBoundsInfo", "React", "Layer", "style", "cn", "H4", "layout", "Button", "IconCreateNew_default", "ref", "Column", "children", "rest", "BoardColumn", "props", "Droppable", "droppableProps", "import_react_18_2", "init_board_column", "__esmMin", "init_styles", "init_buttons", "init_icons", "init_layer", "init_texts", "init_css_objects", "init_scrolling", "init_droppable", "makeStyles", "theme", "styleguide", "board_strings_default", "init_board_strings", "__esmMin", "AssigneesBoardView", "query", "useQuery2", "logger", "useLogger", "strings", "useStrings", "toast", "useToastController", "sortedUsers", "usePartialVertices", "filterIterable", "id", "coreValueCompare", "onDragCancelled", "reason", "context", "cancellation_reasons_default", "wsName", "format", "onDrop", "destinationUser", "items", "item", "relativeTo", "dragPosition", "card", "u", "setDragSort", "allowsDrop", "user", "note", "React", "DragAndDropContext", "BoardColumn", "index", "BoardCard", "import_react_18_2", "init_assignees_board_view", "__esmMin", "init_vertex", "init_localization", "init_dragndrop", "init_toast", "init_draggable_card", "init_board_card", "init_board_column", "init_board_strings", "init_query", "init_logger", "init_common", "init_comparable", "createUseStrings", "board_strings_default", "TagBoardView", "query", "useQuery2", "logger", "useLogger", "groups", "groupBy", "usePartialFilter", "graph", "useGraphManager", "childTagManagers", "mapIterable", "filterIterable", "k", "sortedChildTags", "usePartialVertices", "unassigned", "strings", "useStrings", "onDrop", "tag", "items", "item", "relativeTo", "dragPosition", "note", "setDragSort", "React", "DragAndDropContext", "BoardColumn", "args", "index", "BoardCard", "card", "import_react_18_2", "init_tag_board_view", "__esmMin", "init_vertex", "init_localization", "init_dragndrop", "init_draggable_card", "init_board_card", "init_board_column", "init_board_strings", "init_logger", "init_query", "init_app", "init_graph", "init_common", "createUseStrings", "board_strings_default", "WorkspaceBoardView", "query", "useQuery2", "groups", "workspaces", "usePartialVertices", "logger", "useLogger", "toast", "useToastController", "strings", "useStrings", "columns", "coreValueCompare", "onDragCancelled", "onDrop", "workspace", "items", "item", "relativeTo", "dragPosition", "React", "DragAndDropContext", "column", "BoardColumn", "card", "index", "BoardCard", "import_react_18_2", "init_workspace_board_view", "__esmMin", "init_toast", "init_vertex", "init_localization", "init_dragndrop", "init_board_card", "init_board_column", "init_board_strings", "init_logger", "init_comparable", "init_query", "createUseStrings", "board_strings_default", "BoardView", "className", "styles", "useStyles", "filter", "useFilter", "query", "useQuery2", "content", "groupBy", "React", "WorkspaceBoardView", "TagBoardView", "AssigneesBoardView", "Scroller", "ref", "cn", "import_react_18_2", "init_board_view", "__esmMin", "init_styles", "init_css_objects", "init_scrolling", "init_assignees_board_view", "init_tag_board_view", "init_workspace_board_view", "init_query", "init_app", "makeStyles", "theme", "styleguide", "layout", "cards_display_strings_default", "init_cards_display_strings", "__esmMin", "IconSort", "size", "className", "React", "import_react_18_2", "init_icon_sort", "__esmMin", "init_types", "IconFilter", "size", "className", "React", "import_react_18_2", "init_icon_filter", "__esmMin", "init_types", "TabButton", "children", "renderContent", "value", "style", "isSelected", "setSelected", "className", "onSelected", "styles", "useStyles", "onClick", "e", "content", "React", "Button", "cn", "TabsHeader", "selected", "count", "selectedIndex", "tab", "i", "newProps", "import_react_18_2", "init_tabs", "__esmMin", "init_css_objects", "init_styleguide", "init_layout", "init_buttons", "init_theme", "init_typography", "makeStyles", "theme", "layout", "styleguide", "brandLightTheme", "IconCompose", "size", "className", "React", "import_react_18_2", "init_icon_compose", "__esmMin", "init_types", "ComposeButton", "styles", "useStyles", "logger", "useLogger", "docRouter", "useDocumentRouter", "selectedWorkspacesQuery", "useSharedQuery", "container", "setContainer", "graph", "useGraphManager", "createCard", "ws", "note", "createNewNote", "React", "Button", "ComposeInternalButton", "div", "Menu", "cn", "SelectWorkspaceMenu", "import_react_18_2", "useStrings", "init_compose_button", "__esmMin", "init_note", "init_styles", "init_buttons", "init_menu", "init_icon_compose", "init_typography", "init_css_objects", "init_responsive", "init_theme", "init_localization", "init_react_utils", "init_workspace_indicator", "init_cards_display_strings", "init_logger", "init_create", "init_query", "init_graph", "makeStyles", "brandLightTheme", "styleguide", "layout", "MediaQueries", "createUseStrings", "cards_display_strings_default", "className", "ref", "strings", "IconCompose", "IconGroup", "size", "className", "React", "import_react_18_2", "init_icon_group", "__esmMin", "init_types", "GroupByTagButton", "tag", "parentTag", "childName", "usePartialVertex", "parentName", "React", "Text", "GroupByDropDown", "styles", "useStyles", "logger", "useLogger", "strings", "useStrings", "partialFilter", "usePartialFilter", "parentTagsQuery", "useSharedQuery", "setGroup", "group", "renderButton", "content", "cn", "IconGroup", "setTag", "Menu", "MenuItem", "SecondaryMenuItem", "import_react_18_2", "init_group_by_drop_down", "__esmMin", "init_styles", "init_icon_group", "init_menu", "init_texts", "init_css_objects", "init_localization", "init_cards_display_strings", "init_logger", "init_app", "init_query", "init_vertex", "makeStyles", "theme", "styleguide", "layout", "createUseStrings", "cards_display_strings_default", "IconListView", "size", "className", "isToggled", "color", "brandLightTheme", "React", "import_react_18_2", "init_icon_list_view", "__esmMin", "init_theme", "init_types", "IconBoardView", "size", "className", "isToggled", "color", "brandLightTheme", "React", "import_react_18_2", "init_icon_board_view", "__esmMin", "init_theme", "init_types", "ViewToggle", "className", "styles", "useStyles", "logger", "useLogger", "strings", "useStrings", "partialFilter", "usePartialFilter", "setView", "type", "React", "cn", "tooltip_default", "Button", "IconListView", "IconBoardView", "import_react_18_2", "HEIGHT", "init_view_toggle", "__esmMin", "init_styles", "init_buttons", "init_icon_list_view", "init_icon_board_view", "init_tooltip", "init_css_objects", "init_localization", "init_display_bar", "init_cards_display_strings", "init_logger", "init_app", "styleguide", "makeStyles", "theme", "layout", "createUseStrings", "cards_display_strings_default", "SortByDropDown", "source", "styles", "useStyles", "strings", "useStrings", "logger", "useLogger", "partialFilter", "usePartialFilter", "sortBy", "renderSelected", "React", "cn", "IconSort", "Text", "onChange", "val", "DropDown", "FilterSortByValues", "x", "DropDownItem", "ExtraFilters", "props", "content", "GroupByDropDown", "FilterButton", "showFilters", "setShowFilters", "filterButtonClicked", "Button", "IconFilter", "NoteTypeToggle", "filterContext", "useFilterContext", "graph", "useGraphManager", "TabsHeader", "type", "FilterKeyNotes", "FilterKeyTasks", "TabButton", "DisplayBar", "setViewType", "className", "rest", "viewType", "ViewToggle", "layout", "ToolbarRightItem", "ComposeButton", "import_react_18_2", "BUTTON_HEIGHT", "SIDES_PADDING", "MOBILE_PADDING", "TABLET_PADDING", "init_display_bar", "__esmMin", "init_note", "init_styles", "init_buttons", "init_icon_sort", "init_icon_filter", "init_drop_down", "init_tabs", "init_texts", "init_css_objects", "init_theme", "init_responsive", "init_localization", "init_toolbar", "init_cards_display_strings", "init_compose_button", "init_group_by_drop_down", "init_view_toggle", "init_scheme_types", "init_logger", "init_app", "init_graph", "styleguide", "makeStyles", "brandLightTheme", "MediaQueries", "useButtonStyles", "createUseStrings", "cards_display_strings_default", "getChecked", "checked", "CheckedIcon", "React", "PartialIcon", "FilterCheckbox", "onChecked", "styles", "useStyles", "isChecked", "onChange", "e", "cn", "import_react_18_2", "SIZE", "init_filter_checkbox", "__esmMin", "init_css_objects", "init_styles", "styleguide", "makeStyles", "theme", "filters_strings_default", "init_filters_strings", "__esmMin", "AssigneeView", "selected", "user", "onToggle", "u", "usePartialVertex", "styles", "useStyles", "React", "cn", "RadioCheckBox", "FilterBackdrop", "style", "onClick", "click", "e", "createUniversalPortal", "FiltersView", "className", "isVisible", "setIsVisible", "Layer", "InternalFiltersView", "toggleTag", "filter", "tag", "childTag", "getTagState", "filterTags", "childMgr", "TagSection", "strings", "useStrings", "showMore", "setShowMore", "parentTag", "useVertex", "childTagsQuery", "useExistingQuery", "useFilter", "visibleTags", "useVertices", "hasMore", "SECTION_SIZE", "x", "selectedWorkspacesQuery", "useSharedQuery", "selectedWorkspaces", "parentTagsQuery", "assigneesSet", "ws", "update", "assignees", "coreValueCompare", "toggleMembership", "checked", "onChecked", "FilterCheckbox", "import_react_18_2", "init_filters", "__esmMin", "init_styles", "init_layer", "init_typography", "init_css_objects", "init_theme", "init_ssr", "init_vertex", "init_localization", "init_filter_checkbox", "init_filters_strings", "init_query", "init_set", "init_comparable", "init_app", "makeStyles", "styleguide", "brandLightTheme", "layout", "createUseStrings", "filters_strings_default", "CloseIcon", "onClick", "theme", "useTheme", "styles", "useStyles", "React", "cn", "AssigneePill", "user", "onDelete", "name", "usePartialVertex", "TagPill", "tag", "ActiveFiltersView", "className", "filter", "useFilter", "showClear", "coreValueCompare", "Button", "import_react_18_2", "init_active_filters", "__esmMin", "init_styles", "init_buttons", "init_typography", "init_css_objects", "init_theme", "init_vertex", "init_app", "init_comparable", "makeStyles", "layout", "styleguide", "brandLightTheme", "SearchField", "query", "setQuery", "styles", "useStyles", "strings", "useStrings", "logger", "useLogger", "React", "cn", "TextField_default", "e", "Button", "import_react_18_2", "init_search_field", "__esmMin", "init_styles", "init_buttons", "init_inputs", "init_css_objects", "init_localization", "init_cards_display_strings", "init_theme", "init_TextField", "init_logger", "makeStyles", "styleguide", "layout", "brandLightTheme", "createUseStrings", "cards_display_strings_default", "EmptyActivity", "className", "style", "React", "import_react_18_2", "init_empty_illustration", "__esmMin", "EmptyListState", "styles", "useStyles", "React", "cn", "layout", "Text", "EmptyActivity", "import_react_18_2", "init_empty_state", "__esmMin", "init_css_objects", "init_texts", "init_styles", "init_empty_illustration", "makeStyles", "theme", "InfiniteScroll", "recordsLength", "limit", "setLimit", "pageSize", "isVisible", "styles", "useStyles", "parentEl", "useScrollParent", "previousLimit", "canLoadMore", "didMount", "setDidMount", "handler", "THRESHOLD", "x", "canMount", "React", "cn", "spinner_view_default", "styleguide", "import_react_18_2", "init_infinite_scroll", "__esmMin", "init_scrolling", "init_styles", "init_spinner_view", "init_css_objects", "makeStyles", "theme", "layout", "init_filter", "__esmMin", "init_comparable", "init_set", "init_scheme_types", "init_query", "init_vertices", "init_note", "init_vertices", "__esmMin", "init_base", "init_user", "init_workspace", "init_note", "init_tag", "init_filter", "IconNewTask", "size", "className", "React", "STYLE", "import_react_18_2", "init_icon_new_task", "__esmMin", "init_types", "list_strings_default", "init_list_strings", "__esmMin", "import_react_18_2", "useGridStyles", "ItemsTable", "init_grid", "__esmMin", "init_styleguide", "init_css_objects", "makeStyles", "styleguide", "children", "className", "styles", "React", "cn", "IconArrowDown", "size", "className", "React", "import_react_18_2", "init_icon_arrow_down", "__esmMin", "init_types", "IconPinOff", "className", "size", "React", "import_react_18_2", "init_icon_pin_off", "__esmMin", "init_types", "IconPinOn", "size", "className", "React", "import_react_18_2", "init_icon_pin_on", "__esmMin", "init_types", "DraftItemRow", "note", "onWorkspaceMoved", "onCancel", "styles", "useStyles", "onClickImpl", "e", "onKeyDown", "isHotkeyActive", "React", "cn", "TypeCell", "TitleCell", "WorkspaceCell", "Button", "IconDelete", "onClick", "isDraft", "editor", "plugins", "handlers", "useTitleEditor", "DraftTitleNode", "TitleNode", "cancelled", "Cell", "WorkspaceDraftIndicatorComponent", "strings", "useStrings", "WorkspaceIndicatorComponent", "workspace", "name", "usePartialVertex", "color", "useWorkspaceColor", "style", "import_react_18_2", "import_slate_react_0_87", "ROW_HEIGHT", "Row", "ItemRow", "DoneIndicator", "ExpanderCell", "ContentIndicatorCell", "AssigneesCell", "TagsCell", "ItemCheckbox", "DateCell", "PinCell", "MenuCell", "init_item", "__esmMin", "init_styles", "init_buttons", "init_inputs", "init_icon_arrow_down", "init_icon_content", "init_icon_delete", "init_icon_due_date", "init_icon_new_task", "init_icon_note", "init_icon_pin_off", "init_icon_pin_on", "init_toast", "init_typography", "init_css_objects", "init_theme", "init_vertex", "init_localization", "init_slate", "init_hotkeys", "init_assignees_view", "init_item_menu", "init_tag_button", "init_tag_view", "init_assignees", "init_move", "init_workspace_icon", "init_workspace_indicator", "init_list_strings", "init_grid", "init_logger", "init_date", "init_note", "styleguide", "makeStyles", "_", "resolveClass", "brandLightTheme", "layout", "createUseStrings", "list_strings_default", "children", "className", "innerClassName", "rest", "isChild", "attributes", "ref", "gridStyles", "useGridStyles", "isMouseOver", "setIsMouseOver", "childCards", "onMouseOver", "onMouseLeave", "isExpanded", "setIsExpanded", "x", "partial", "IconArrowDown", "bodyPreview", "IconContent", "showMenu", "logger", "useLogger", "isInviteOpen", "setIsInviteOpen", "assignees", "users", "workspaces", "userManagers", "managers", "onUsersInvited", "user", "assignNote", "onInviteUserSelected", "Assignee", "AssignButton", "tags", "tagsMng", "c", "onDelete", "tag", "proxy", "newTags", "tagToDelete", "onTag", "tagKey", "removedTag", "TagView", "TagButton", "isActionable", "IconNewTask", "IconNote", "CheckBox_default", "props", "Text", "wsManager", "toastController", "useToastController", "setWorkspace", "moveCard", "format", "WorkspaceIndicator", "dueDate", "content", "isLate", "IconDueDate", "TextSm", "formatTimeDiff", "isPinned", "togglePin", "IconPinOn", "IconPinOff", "CardMenuView", "init_table", "__esmMin", "init_grid", "init_item", "InlineTaskButton", "draft", "setDraft", "styles", "useStyles", "strings", "useStrings", "graph", "useGraphManager", "rootUser", "useRootUser", "onClick", "ws", "x", "Workspace", "v", "NS_NOTES", "onSave", "note", "proxy", "onCancel", "React", "DraftItemRow", "Row", "cn", "Button", "IconNewTask", "Text", "import_react_18_2", "init_inline_task_button", "__esmMin", "init_scheme_types", "init_vertices", "init_note", "init_styleguide", "init_buttons", "init_icon_new_task", "init_typography", "init_css_objects", "init_theme", "init_graph", "init_localization", "init_list_strings", "init_table", "init_item", "makeStyles", "brandLightTheme", "styleguide", "ROW_HEIGHT", "useButtonStyles", "createUseStrings", "list_strings_default", "ListView", "className", "filter", "useFilter", "pinnedNotesQuery", "useQuery2", "unpinnedNotesQuery", "React", "EmptyListState", "InnerListView", "cards", "noteType", "strings", "useStrings", "styles", "useStyles", "limit", "setLimit", "PAGE_SIZE", "logger", "useLogger", "toastController", "useToastController", "docRouter", "useDocumentRouter", "onNoteSelected", "note", "draft", "setDraft", "visibleCards", "x", "onDragStarted", "onReportDrop", "onDragCancelled", "reason", "cancellation_reasons_default", "headerText", "DragAndDropContext", "Scroller", "ref", "cn", "ItemsTable", "Row", "LabelSm", "c", "index", "Draggable", "draggableProps", "ItemRow", "InlineTaskButton", "InfiniteScroll", "import_react_18_2", "init_list_view", "__esmMin", "init_note", "init_styleguide", "init_toast", "init_typography", "init_css_objects", "init_localization", "init_react_utils", "init_scrolling", "init_dragndrop", "init_empty_state", "init_infinite_scroll", "init_inline_task_button", "init_list_strings", "init_table", "init_logger", "init_app", "init_query", "makeStyles", "theme", "styleguide", "createUseStrings", "list_strings_default", "SearchResults", "className", "logger", "useLogger", "searchEngine", "useGraphManager", "textQuery", "usePartialFilter", "selectedWorkspacesQuery", "useSharedQuery", "results", "note", "React", "InnerListView", "import_react_18_2", "init_search_results", "__esmMin", "init_graph", "init_logger", "init_query", "init_app", "init_list_view", "CardsDisplay", "styles", "useStyles", "viewType", "setViewType", "showFilters", "setShowFilters", "strings", "useStrings", "filter", "useFilter", "selectedWorkspacesQuery", "useSharedQuery", "content", "isInSearch", "React", "SearchResults", "cn", "ListView", "BoardView", "H2", "DisplayBar", "ToolbarCenterItem", "layout", "SearchField", "q", "FiltersView", "ActiveFiltersView", "import_react_18_2", "init_cards_display", "__esmMin", "init_styles", "init_typography", "init_css_objects", "init_responsive", "init_localization", "init_toolbar", "init_board_view", "init_cards_display_strings", "init_display_bar", "init_filters", "init_active_filters", "init_search_field", "init_list_view", "init_search_results", "init_app", "init_query", "makeStyles", "theme", "styleguide", "SIDES_PADDING", "MediaQueries", "TABLET_PADDING", "MOBILE_PADDING", "createUseStrings", "cards_display_strings_default", "empty_state_strings_default", "init_empty_state_strings", "__esmMin", "EmptyState", "className", "styles", "useStyles", "strings", "useStrings", "handPoint", "setHandPoint", "React", "cn", "H3", "Text", "ArrowIllustration", "Illustration", "setHandLocation", "import_react_18_2", "init_empty_state", "__esmMin", "init_styles", "init_texts", "init_css_objects", "init_responsive", "init_localization", "init_empty_state_strings", "createUseStrings", "empty_state_strings_default", "makeStyles", "theme", "styleguide", "layout", "MediaQueries", "WorkspaceContentView", "className", "styles", "useStyles", "selectedWorkspacesQuery", "useSharedQuery", "React", "cn", "Toolbar", "DueDateEditor", "NoteView", "CardsDisplay", "EmptyState", "import_react_18_2", "import_react_router_dom_6_7", "init_workspace_view", "__esmMin", "init_css_objects", "init_toolbar", "init_styles", "init_due_date_editor", "init_note_editor", "init_cards_display", "init_empty_state", "init_query", "makeStyles", "theme", "layout", "WorkspaceSelectorView", "className", "graph", "useGraphManager", "React", "WorkspaceContentView", "import_react_18_2", "init_workspace_content", "__esmMin", "init_graph", "init_workspace_view", "import_react_18_2", "hideAnim", "backdropShow", "backdropHide", "useStyles", "init_backdrop", "__esmMin", "init_styleguide", "init_layout", "init_layer", "init_css_objects", "init_ssr", "keyframes", "makeStyles", "theme", "layout", "styleguide", "workspace_bar_strings_default", "init_workspace_bar_strings", "__esmMin", "WorkspaceBarActions", "expanded", "className", "styles", "useStyles", "strings", "useStrings", "logger", "useLogger", "navigate", "isShareOpen", "setIsShareOpen", "createNew", "React", "cn", "IconPlus", "IconInvite", "import_react_18_2", "import_react_router_6_7", "init_actions", "__esmMin", "init_styles", "init_typography", "init_css_objects", "init_theme", "init_localization", "init_logger", "init_workspace_bar_strings", "makeStyles", "styleguide", "brandLightTheme", "layout", "createUseStrings", "workspace_bar_strings_default", "toggleSelectionItem", "items", "toggled", "selectedKeys", "lastSelectedKey", "actionType", "toggledIndex", "x", "lastSelectedIndex", "slice", "selected", "allSelectedItems", "newSelected", "toggleType", "toggleActionFromEvent", "e", "init_ws_selection_utils", "__esmMin", "WorkspaceCheckbox", "toggled", "styles", "useStyles", "React", "cn", "CheckIcon", "CollapseIcon", "className", "WorkspaceToggleView", "selectedRatio", "onSelectAll", "onUnselectAll", "expanded", "strings", "useStrings", "LabelSm", "TextSm", "WorkspaceListItem", "workspace", "isSelected", "onClick", "isHidden", "setIsHidden", "isPinned", "setIsPinned", "color", "useWorkspaceColor", "name", "usePartialVertex", "isSettingsOpen", "setIsSettingsOpen", "style", "textRef", "isOverflowing", "renderButton", "IconOverflow_default", "tooltip_default", "layout", "Button", "IconPinOn", "IconPinOff", "Menu", "MenuItem", "ExpanderIcon", "WorkspacesList", "showHidden", "setShowHidden", "settings", "usePartialUserSettings", "hiddenWorkspaces", "pinnedWorkspaces", "workspacesQuery", "useSharedQuery", "workspaces", "useVertices", "hidden", "x", "visible", "y", "sortWorkspaces", "location", "navigate", "logger", "useLogger", "lastSelectedKey", "selectedWorkspacesQuery", "toggle", "e", "wsMng", "proxy", "collection", "toggleAction", "toggleActionFromEvent", "r", "toggleSelectionItem", "selectedKeys", "prevSelectedKeys", "ws", "subtract", "pinned", "Scroller", "ref", "WorkspaceBarInternal", "setExpanded", "selectAll", "unselectAll", "Layer", "LogoIcon", "LogoText", "WorkspaceBarActions", "MobileBar", "rest", "createUniversalPortal", "DesktopBar", "props", "WorkspacesBar", "useCurrentDevice", "import_react_18_2", "import_react_router_6_7", "EXPANDED_WIDTH", "COLLAPSED_WIDTH", "init_workspaces_bar", "__esmMin", "init_set", "init_styles", "init_backdrop", "init_buttons", "init_icons", "init_layer", "init_logo", "init_menu", "init_icon_pin_off", "init_icon_pin_on", "init_tooltip", "init_typography", "init_css_objects", "init_responsive", "init_theme", "init_scrolling", "init_ssr", "init_workspace_indicator", "init_graph", "init_query", "init_vertex", "init_localization", "init_workspace_icon", "init_actions", "init_workspace_bar_strings", "init_ws_selection_utils", "init_logger", "styleguide", "makeStyles", "MediaQueries", "brandLightTheme", "createUseStrings", "workspace_bar_strings_default", "app_exports", "__export", "FilterContextProvider", "FilterKeyNotes", "FilterKeyTasks", "AppView", "useFilter", "useFilterContext", "usePartialFilter", "filterKey", "children", "graph", "useGraphManager", "filter", "setFilter", "React", "filterContext", "id", "useVertex", "keys", "usePartialVertex", "Root", "style", "styles", "useStyles", "loading", "setLoading", "device", "useCurrentDevice", "expanded", "setExpanded", "workspacesQuery", "useSharedQuery", "cn", "LoadingView", "WorkspacesBar", "CreateWorkspaceView", "wsKey", "ws", "WorkspaceSelectorView", "theme", "isDarkTheme", "darkTheme", "lightTheme", "ThemeProvider", "import_react_18_2", "import_react_router_6_7", "import_react_router_dom_6_7", "init_app", "__esmMin", "init_styles", "init_css_objects", "init_responsive", "init_theme", "init_graph", "init_loading_view", "init_new_workspace", "init_workspace_content", "init_workspaces_bar", "init_query", "init_vertex", "makeStyles", "layout", "useGraphManager", "CFDSContext", "useSharedQueriesManager", "useRootUser", "graph", "key", "usePartialCurrentUser", "keys", "usePartialVertex", "usePartialUserSettings", "u", "useCfdsContext", "CfdsClientProvider", "userId", "sessionId", "children", "logger", "useLogger", "sessionPtrKey", "graphManager", "manager", "GraphManager", "NS_FILTER", "FilterKeyNotes", "FilterKeyTasks", "user", "settings", "pinnedWorkspaces", "ws", "sessionIntervalId", "ctx", "NoteSearchEngine", "React", "import_react_18_2", "init_graph", "__esmMin", "init_graph_manager", "init_note_search", "init_logger", "init_scheme_types", "init_vertex", "init_app", "init_note", "import_react_18_2", "MASK_ALPHA_STYLE", "LoginIllustration", "init_illustrations", "__esmMin", "className", "React", "SignUpForm", "goToState", "onLogin", "styles", "useStyles", "email", "setEmail", "password", "setPassword", "confirmPassword", "setConfirmPassword", "name", "setName", "error", "setError", "processing", "setProcessing", "onSubmit", "e", "EMAIL_REGEX", "message", "React", "cn", "H1", "H2", "TextField_default", "RaisedButton", "LoginForm", "ResetPasswordForm", "toastProvider", "toastContext", "err", "AuthFormView", "loginState", "setLoginState", "requestPassword", "setRequestPassword", "knownEmail", "setKnownEmail", "currentPassword", "setCurrentPassword", "credentials", "linkAccount", "event", "dismissLink", "content", "Dialog", "layout", "import_react_18_2", "init_AuthForm", "__esmMin", "init_css_objects", "init_styles", "init_inputs", "init_buttons", "init_dialog", "init_toast", "init_texts", "makeStyles", "theme", "styleguide", "useRaisedButtonStyles", "LoginView", "children", "sessionInfo", "setSessionInfo", "uniqueId", "processing", "setProcessing", "onLogin", "info", "React", "LoggerProvider", "CfdsClientProvider", "LoginPage", "import_react_18_2", "useStyles", "init_login", "__esmMin", "init_common", "init_styles", "init_buttons", "init_css_objects", "init_responsive", "init_graph", "init_illustrations", "init_AuthForm", "init_logger", "makeStyles", "theme", "layout", "MediaQueries", "styleguide", "styles", "cn", "LoginIllustration", "AuthFormView", "getFeatureConfig", "feature", "featureStatus", "init_features", "__esmMin", "isFeatureActive", "featureId", "featureConf", "getFeatureConfig", "forceProd", "useIsFeatureActive", "import_react_18_2", "init_feature_toggle", "__esmMin", "init_features", "isOnMobile", "MobileBlockView", "styles", "useStyles", "React", "cn", "H3", "Bold", "MobileBlockerImpl", "children", "isBlocking", "setIsBlocking", "handler", "MobileBlocker", "useIsFeatureActive", "import_react_18_2", "init_mobile_blocker", "__esmMin", "init_styles", "init_texts", "init_css_objects", "init_responsive", "init_feature_toggle", "makeStyles", "theme", "styleguide", "layout", "login_async_exports", "__export", "LoginAsync", "React", "router", "ToastProvider", "LoginView", "MobileBlocker", "LazyApp", "import_react_18_2", "import_react_router_dom_6_7", "init_login_async", "__esmMin", "init_toast", "init_login", "init_mobile_blocker", "import_react_18_2", "import_react_dom_18_2", "import_react_18_2", "init_context", "LazyLogin", "AppAsync", "React", "StyleProvider", "React", "AppAsync"]
}
